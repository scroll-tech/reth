<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">

    <title>scroll-reth - reth fork diff overview</title>

    <link rel="icon" type="image/x-icon" href="">

    <style>
        .line-stat {
            width: 14rem;
            float: right;
        }
        .line-stat div {
            width: 50%;
        }
        .text-add-ignored {
            color: #93ad93;
            font-style: italic;
        }
        .text-delete-ignored {
            color: #c47777;
            font-style: italic;
        }
        .toplevelstat {
            margin-left: 0 !important;
            width: 15rem;
        }
    </style>

    
<style>
    .term-container {
        background: #171717;
        border-radius: 5px;
        color: white;
        word-break: break-word;
        overflow-wrap: break-word;
        font-family: "SFMono-Regular", Monaco, Menlo, Consolas, "Liberation Mono", Courier, monospace;
        font-size: 12px;
        line-height: 20px;
        padding: 14px 18px;
        white-space: pre-wrap;
    }

    .term-container img { max-width: 100%; }

    .term a { color: inherit; text-decoration: underline; text-decoration-style: dashed; }
    .term a:hover { color: #2882F9 }

    @keyframes blink-animation {
        to {
            visibility: hidden;
        }
    }

    .term-fg1 { } /* don't bold beccause it looks weird */
    .term-fg2 { color: #838887; } /* faint (decreased intensity) - same as gray really */
    .term-fg3 { font-style: italic; } /* italic */
    .term-fg4 { text-decoration: underline; } /* underline */
    .term-fg5 { animation: blink-animation 1s steps(3, start) infinite; } /* blink */
    .term-fg9 { text-decoration: line-through; } /* crossed-out */

    .term-fg30 { color: #666666; } /* black (but we can't use black, so a diff color) */
    .term-fg31 { color: #ff7070; } /* red */
    .term-fg32 { color: #b0f986; } /* green */
    .term-fg33 { color: #c6c502; } /* yellow */
    .term-fg34 { color: #8db7e0; } /* blue */
    .term-fg35 { color: #f271fb; } /* magenta */
    .term-fg36 { color: #6bf7ff; } /* cyan */

    /* high intense colors */
    .term-fgi1 { color: #5ef765; }
    .term-fgi90 { color: #838887; } /* grey */
    .term-fgi91 { color: #ff3333; } /* red */
    .term-fgi92 { color: #00FF00; } /* green */
    .term-fgi93 { color: #fffc67; } /* yellow */
    .term-fgi94 { color: #6871ff; } /* blue */
    .term-fgi95 { color: #ff76ff; } /* magenta */
    .term-fgi96 { color: #60fcff; } /* cyan */

    /* background colors */
    .term-bg40 { background: #676767; } /* grey */
    .term-bg41 { background: #ff4343; } /* red */
    .term-bg42 { background: #99ff5f; } /* green */

    /* custom foreground/background combos for readability */
    .term-fg31.term-bg40 { color: #F8A39F; }

    /* xterm colors */
    .term-fgx16 { color: #000000; }
    .term-fgx17 { color: #00005f; }
    .term-fgx18 { color: #000087; }
    .term-fgx19 { color: #0000af; }
    .term-fgx20 { color: #0000d7; }
    .term-fgx21 { color: #0000ff; }
    .term-fgx22 { color: #005f00; }
    .term-fgx23 { color: #005f5f; }
    .term-fgx24 { color: #005f87; }
    .term-fgx25 { color: #005faf; }
    .term-fgx26 { color: #005fd7; }
    .term-fgx27 { color: #005fff; }
    .term-fgx28 { color: #008700; }
    .term-fgx29 { color: #00875f; }
    .term-fgx30 { color: #008787; }
    .term-fgx31 { color: #0087af; }
    .term-fgx32 { color: #0087d7; }
    .term-fgx33 { color: #0087ff; }
    .term-fgx34 { color: #00af00; }
    .term-fgx35 { color: #00af5f; }
    .term-fgx36 { color: #00af87; }
    .term-fgx37 { color: #00afaf; }
    .term-fgx38 { color: #00afd7; }
    .term-fgx39 { color: #00afff; }
    .term-fgx40 { color: #00d700; }
    .term-fgx41 { color: #00d75f; }
    .term-fgx42 { color: #00d787; }
    .term-fgx43 { color: #00d7af; }
    .term-fgx44 { color: #00d7d7; }
    .term-fgx45 { color: #00d7ff; }
    .term-fgx46 { color: #00ff00; }
    .term-fgx47 { color: #00ff5f; }
    .term-fgx48 { color: #00ff87; }
    .term-fgx49 { color: #00ffaf; }
    .term-fgx50 { color: #00ffd7; }
    .term-fgx51 { color: #00ffff; }
    .term-fgx52 { color: #5f0000; }
    .term-fgx53 { color: #5f005f; }
    .term-fgx54 { color: #5f0087; }
    .term-fgx55 { color: #5f00af; }
    .term-fgx56 { color: #5f00d7; }
    .term-fgx57 { color: #5f00ff; }
    .term-fgx58 { color: #5f5f00; }
    .term-fgx59 { color: #5f5f5f; }
    .term-fgx60 { color: #5f5f87; }
    .term-fgx61 { color: #5f5faf; }
    .term-fgx62 { color: #5f5fd7; }
    .term-fgx63 { color: #5f5fff; }
    .term-fgx64 { color: #5f8700; }
    .term-fgx65 { color: #5f875f; }
    .term-fgx66 { color: #5f8787; }
    .term-fgx67 { color: #5f87af; }
    .term-fgx68 { color: #5f87d7; }
    .term-fgx69 { color: #5f87ff; }
    .term-fgx70 { color: #5faf00; }
    .term-fgx71 { color: #5faf5f; }
    .term-fgx72 { color: #5faf87; }
    .term-fgx73 { color: #5fafaf; }
    .term-fgx74 { color: #5fafd7; }
    .term-fgx75 { color: #5fafff; }
    .term-fgx76 { color: #5fd700; }
    .term-fgx77 { color: #5fd75f; }
    .term-fgx78 { color: #5fd787; }
    .term-fgx79 { color: #5fd7af; }
    .term-fgx80 { color: #5fd7d7; }
    .term-fgx81 { color: #5fd7ff; }
    .term-fgx82 { color: #5fff00; }
    .term-fgx83 { color: #5fff5f; }
    .term-fgx84 { color: #5fff87; }
    .term-fgx85 { color: #5fffaf; }
    .term-fgx86 { color: #5fffd7; }
    .term-fgx87 { color: #5fffff; }
    .term-fgx88 { color: #870000; }
    .term-fgx89 { color: #87005f; }
    .term-fgx90 { color: #870087; }
    .term-fgx91 { color: #8700af; }
    .term-fgx92 { color: #8700d7; }
    .term-fgx93 { color: #8700ff; }
    .term-fgx94 { color: #875f00; }
    .term-fgx95 { color: #875f5f; }
    .term-fgx96 { color: #875f87; }
    .term-fgx97 { color: #875faf; }
    .term-fgx98 { color: #875fd7; }
    .term-fgx99 { color: #875fff; }
    .term-fgx100 { color: #878700; }
    .term-fgx101 { color: #87875f; }
    .term-fgx102 { color: #878787; }
    .term-fgx103 { color: #8787af; }
    .term-fgx104 { color: #8787d7; }
    .term-fgx105 { color: #8787ff; }
    .term-fgx106 { color: #87af00; }
    .term-fgx107 { color: #87af5f; }
    .term-fgx108 { color: #87af87; }
    .term-fgx109 { color: #87afaf; }
    .term-fgx110 { color: #87afd7; }
    .term-fgx111 { color: #87afff; }
    .term-fgx112 { color: #87d700; }
    .term-fgx113 { color: #87d75f; }
    .term-fgx114 { color: #87d787; }
    .term-fgx115 { color: #87d7af; }
    .term-fgx116 { color: #87d7d7; }
    .term-fgx117 { color: #87d7ff; }
    .term-fgx118 { color: #87ff00; }
    .term-fgx119 { color: #87ff5f; }
    .term-fgx120 { color: #87ff87; }
    .term-fgx121 { color: #87ffaf; }
    .term-fgx122 { color: #87ffd7; }
    .term-fgx123 { color: #87ffff; }
    .term-fgx124 { color: #af0000; }
    .term-fgx125 { color: #af005f; }
    .term-fgx126 { color: #af0087; }
    .term-fgx127 { color: #af00af; }
    .term-fgx128 { color: #af00d7; }
    .term-fgx129 { color: #af00ff; }
    .term-fgx130 { color: #af5f00; }
    .term-fgx131 { color: #af5f5f; }
    .term-fgx132 { color: #af5f87; }
    .term-fgx133 { color: #af5faf; }
    .term-fgx134 { color: #af5fd7; }
    .term-fgx135 { color: #af5fff; }
    .term-fgx136 { color: #af8700; }
    .term-fgx137 { color: #af875f; }
    .term-fgx138 { color: #af8787; }
    .term-fgx139 { color: #af87af; }
    .term-fgx140 { color: #af87d7; }
    .term-fgx141 { color: #af87ff; }
    .term-fgx142 { color: #afaf00; }
    .term-fgx143 { color: #afaf5f; }
    .term-fgx144 { color: #afaf87; }
    .term-fgx145 { color: #afafaf; }
    .term-fgx146 { color: #afafd7; }
    .term-fgx147 { color: #afafff; }
    .term-fgx148 { color: #afd700; }
    .term-fgx149 { color: #afd75f; }
    .term-fgx150 { color: #afd787; }
    .term-fgx151 { color: #afd7af; }
    .term-fgx152 { color: #afd7d7; }
    .term-fgx153 { color: #afd7ff; }
    .term-fgx154 { color: #afff00; }
    .term-fgx155 { color: #afff5f; }
    .term-fgx156 { color: #afff87; }
    .term-fgx157 { color: #afffaf; }
    .term-fgx158 { color: #afffd7; }
    .term-fgx159 { color: #afffff; }
    .term-fgx160 { color: #d70000; }
    .term-fgx161 { color: #d7005f; }
    .term-fgx162 { color: #d70087; }
    .term-fgx163 { color: #d700af; }
    .term-fgx164 { color: #d700d7; }
    .term-fgx165 { color: #d700ff; }
    .term-fgx166 { color: #d75f00; }
    .term-fgx167 { color: #d75f5f; }
    .term-fgx168 { color: #d75f87; }
    .term-fgx169 { color: #d75faf; }
    .term-fgx170 { color: #d75fd7; }
    .term-fgx171 { color: #d75fff; }
    .term-fgx172 { color: #d78700; }
    .term-fgx173 { color: #d7875f; }
    .term-fgx174 { color: #d78787; }
    .term-fgx175 { color: #d787af; }
    .term-fgx176 { color: #d787d7; }
    .term-fgx177 { color: #d787ff; }
    .term-fgx178 { color: #d7af00; }
    .term-fgx179 { color: #d7af5f; }
    .term-fgx180 { color: #d7af87; }
    .term-fgx181 { color: #d7afaf; }
    .term-fgx182 { color: #d7afd7; }
    .term-fgx183 { color: #d7afff; }
    .term-fgx184 { color: #d7d700; }
    .term-fgx185 { color: #d7d75f; }
    .term-fgx186 { color: #d7d787; }
    .term-fgx187 { color: #d7d7af; }
    .term-fgx188 { color: #d7d7d7; }
    .term-fgx189 { color: #d7d7ff; }
    .term-fgx190 { color: #d7ff00; }
    .term-fgx191 { color: #d7ff5f; }
    .term-fgx192 { color: #d7ff87; }
    .term-fgx193 { color: #d7ffaf; }
    .term-fgx194 { color: #d7ffd7; }
    .term-fgx195 { color: #d7ffff; }
    .term-fgx196 { color: #ff0000; }
    .term-fgx197 { color: #ff005f; }
    .term-fgx198 { color: #ff0087; }
    .term-fgx199 { color: #ff00af; }
    .term-fgx200 { color: #ff00d7; }
    .term-fgx201 { color: #ff00ff; }
    .term-fgx202 { color: #ff5f00; }
    .term-fgx203 { color: #ff5f5f; }
    .term-fgx204 { color: #ff5f87; }
    .term-fgx205 { color: #ff5faf; }
    .term-fgx206 { color: #ff5fd7; }
    .term-fgx207 { color: #ff5fff; }
    .term-fgx208 { color: #ff8700; }
    .term-fgx209 { color: #ff875f; }
    .term-fgx210 { color: #ff8787; }
    .term-fgx211 { color: #ff87af; }
    .term-fgx212 { color: #ff87d7; }
    .term-fgx213 { color: #ff87ff; }
    .term-fgx214 { color: #ffaf00; }
    .term-fgx215 { color: #ffaf5f; }
    .term-fgx216 { color: #ffaf87; }
    .term-fgx217 { color: #ffafaf; }
    .term-fgx218 { color: #ffafd7; }
    .term-fgx219 { color: #ffafff; }
    .term-fgx220 { color: #ffd700; }
    .term-fgx221 { color: #ffd75f; }
    .term-fgx222 { color: #ffd787; }
    .term-fgx223 { color: #ffd7af; }
    .term-fgx224 { color: #ffd7d7; }
    .term-fgx225 { color: #ffd7ff; }
    .term-fgx226 { color: #ffff00; }
    .term-fgx227 { color: #ffff5f; }
    .term-fgx228 { color: #ffff87; }
    .term-fgx229 { color: #ffffaf; }
    .term-fgx230 { color: #ffffd7; }
    .term-fgx231 { color: #ffffff; }
    .term-fgx232 { color: #080808; }
    .term-fgx233 { color: #121212; }
    .term-fgx234 { color: #1c1c1c; }
    .term-fgx235 { color: #262626; }
    .term-fgx236 { color: #303030; }
    .term-fgx237 { color: #3a3a3a; }
    .term-fgx238 { color: #444444; }
    .term-fgx239 { color: #4e4e4e; }
    .term-fgx240 { color: #585858; }
    .term-fgx241 { color: #626262; }
    .term-fgx242 { color: #6c6c6c; }
    .term-fgx243 { color: #767676; }
    .term-fgx244 { color: #808080; }
    .term-fgx245 { color: #8a8a8a; }
    .term-fgx246 { color: #949494; }
    .term-fgx247 { color: #9e9e9e; }
    .term-fgx248 { color: #a8a8a8; }
    .term-fgx249 { color: #b2b2b2; }
    .term-fgx250 { color: #bcbcbc; }
    .term-fgx251 { color: #c6c6c6; }
    .term-fgx252 { color: #d0d0d0; }
    .term-fgx253 { color: #dadada; }
    .term-fgx254 { color: #e4e4e4; }
    .term-fgx255 { color: #eeeeee; }
</style>

</head>
<body>
    <div class="col-xl-10 col-xxl-8 mx-auto px-3 py-1 py-md-3">
        <main class="container-fluid">
            <div class="row">
                <div>
                    <div class="float-end">
                        <div class="form-check form-switch">
                            <i class="bi bi-brightness-low" id="dark-mode-icon"></i>
                            <input class="form-check-input" type="checkbox" role="switch" id="dark-mode-toggle" data-bs-toggle="tooltip"
                                   data-bs-placement="bottom" data-bs-title="Toggle Dark Mode"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"role="button" aria-expanded="true" aria-controls="id-c98de7d82f3dbb4b7513f933">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h1>scroll-reth</h1></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                    <span class="text-end">diff:</span>
                
                
                    <span class="text-end">ignored:</span>
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 toplevelstat">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+4502</span></div>
                    <div class="text-start"><span class="text-danger">-523</span></div>
                
                
                    <div class="text-end"><span class="text-add-ignored">+110</span></div>
                    <div class="text-start"><span class="text-delete-ignored">-38</span></div>
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse show border-1 ps-3 my-3" id="id-c98de7d82f3dbb4b7513f933">
        <div><p>This is an overview of the changes in <a href="https://github.com/scroll-tech/reth"><code>scroll-reth</code></a>,
a fork of <a href="https://github.com/paradigmxyz/reth"><code>reth</code></a>.</p>
</div>
        <div>
            
            
        </div>
        <div>
            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-47f030157fe2327993d6fb0a"role="button" aria-expanded="false" aria-controls="id-47f030157fe2327993d6fb0a">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/scroll</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+2319</span></div>
                    <div class="text-start"><span class="text-danger">-0</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-47f030157fe2327993d6fb0a">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b50dd0b2955d89b7ae314f08" role="button"
                       aria-expanded="false" aria-controls="id-b50dd0b2955d89b7ae314f08">
                        <code>crates/scroll/execution/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/execution/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+24</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b50dd0b2955d89b7ae314f08"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;execution&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;execution&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..7a6af2b39798d54f023cced578c14a11c0b6b2c3</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;execution&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,24 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-execution&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-revm.workspace = true</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-scroll-storage&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-revm&#47;scroll&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+test-utils = [&quot;reth-revm&#47;test-utils&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9e94978eab9201388743bab0" role="button"
                       aria-expanded="false" aria-controls="id-9e94978eab9201388743bab0">
                        <code>crates/scroll/execution/src/context.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/execution/src/context.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+75</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9e94978eab9201388743bab0"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;context.rs scroll-reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;context.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..020aa0a7e318bbf422a447fb310bc9384a12f756</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;context.rs</span>
<span class="term-fg36">@@ -0,0 +1,75 @@</span>
<span class="term-fg32">+#![allow(clippy::useless_conversion)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+use reth_revm::{cached::CachedReadsDbMut, revm::CacheDB, DatabaseRef};</span>
<span class="term-fg32">+use reth_revm::{</span>
<span class="term-fg32">+    database::{EvmStateProvider, StateProviderDatabase},</span>
<span class="term-fg32">+    revm::State,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+use reth_scroll_storage::ScrollStateProviderDatabase;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Finalize the execution of the type and return the output</span>
<span class="term-fg32">+pub trait FinalizeExecution {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The output of the finalization.</span>
<span class="term-fg32">+    type Output;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Finalize the state and return the output.</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; FinalizeExecution for State&lt;ScrollStateProviderDatabase&lt;DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::states::ScrollBundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        let bundle = self.take_bundle();</span>
<span class="term-fg32">+        (bundle, &amp;self.database.post_execution_context).into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; FinalizeExecution for State&lt;&amp;mut ScrollStateProviderDatabase&lt;DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::states::ScrollBundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        let bundle = self.take_bundle();</span>
<span class="term-fg32">+        (bundle, &amp;self.database.post_execution_context).into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; FinalizeExecution for State&lt;StateProviderDatabase&lt;DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::db::BundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        self.take_bundle().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; FinalizeExecution for State&lt;&amp;mut StateProviderDatabase&lt;DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::db::BundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        self.take_bundle().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl&lt;DB: DatabaseRef&gt; FinalizeExecution for State&lt;CacheDB&lt;DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::db::BundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        self.take_bundle().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl&lt;DB: DatabaseRef&gt; FinalizeExecution for State&lt;CachedReadsDbMut&lt;&#39;_, DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::db::BundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        self.take_bundle().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ec79940ef682667dad36976b" role="button"
                       aria-expanded="false" aria-controls="id-ec79940ef682667dad36976b">
                        <code>crates/scroll/execution/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/execution/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ec79940ef682667dad36976b"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..150a0e9700dacb86422e6fc878a7afceeed4f25f</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,6 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll execution related implementations.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![warn(unused_crate_dependencies)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use context::FinalizeExecution;</span>
<span class="term-fg32">+mod context;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5e3dc0812fc25d77d8704728" role="button"
                       aria-expanded="false" aria-controls="id-5e3dc0812fc25d77d8704728">
                        <code>crates/scroll/primitives/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/primitives/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+86</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5e3dc0812fc25d77d8704728"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..4a02302764159b982efb4e5d4d0a2646602d5143</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,86 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-primitives&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# alloy</span>
<span class="term-fg32">+alloy-consensus.workspace = true</span>
<span class="term-fg32">+alloy-eips.workspace = true</span>
<span class="term-fg32">+alloy-primitives.workspace = true</span>
<span class="term-fg32">+alloy-rlp.workspace = true</span>
<span class="term-fg32">+alloy-serde.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-codecs = { workspace = true, optional = true }</span>
<span class="term-fg32">+reth-codecs-derive = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+poseidon-bn254 = { workspace = true, features = [&quot;bn254&quot;] }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# required by reth-codecs</span>
<span class="term-fg32">+bytes.workspace = true</span>
<span class="term-fg32">+modular-bitfield = { workspace = true, optional = true }</span>
<span class="term-fg32">+serde.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# misc</span>
<span class="term-fg32">+arbitrary = { workspace = true, features = [&quot;derive&quot;], optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dev-dependencies]</span>
<span class="term-fg32">+alloy-primitives = { workspace = true, features = [&quot;arbitrary&quot;] }</span>
<span class="term-fg32">+arbitrary = { workspace = true, features = [&quot;derive&quot;] }</span>
<span class="term-fg32">+bincode.workspace = true</span>
<span class="term-fg32">+rand.workspace = true</span>
<span class="term-fg32">+reth-codecs = { workspace = true, features = [&quot;test-utils&quot;] }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+proptest-arbitrary-interop.workspace = true</span>
<span class="term-fg32">+proptest.workspace = true</span>
<span class="term-fg32">+test-fuzz.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+default = [</span>
<span class="term-fg32">+	&quot;reth-codec&quot;,</span>
<span class="term-fg32">+	&quot;std&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+std = [</span>
<span class="term-fg32">+	&quot;serde&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;alloy-primitives&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;reth-codecs&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;alloy-consensus&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;alloy-eips&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;alloy-rlp&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;alloy-serde&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;bytes&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;proptest&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;rand&#47;std&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+arbitrary = [</span>
<span class="term-fg32">+	&quot;dep:arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;alloy-primitives&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;alloy-consensus&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;alloy-eips&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;alloy-serde&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;reth-codecs&#47;arbitrary&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+reth-codec = [</span>
<span class="term-fg32">+	&quot;dep:reth-codecs&quot;,</span>
<span class="term-fg32">+	&quot;dep:reth-codecs-derive&quot;,</span>
<span class="term-fg32">+	&quot;modular-bitfield&quot;,</span>
<span class="term-fg32">+	&quot;std&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+serde = [</span>
<span class="term-fg32">+	&quot;alloy-primitives&#47;serde&quot;,</span>
<span class="term-fg32">+	&quot;alloy-consensus&#47;serde&quot;,</span>
<span class="term-fg32">+	&quot;alloy-eips&#47;serde&quot;,</span>
<span class="term-fg32">+	&quot;bytes&#47;serde&quot;,</span>
<span class="term-fg32">+	&quot;rand&#47;serde&quot;,</span>
<span class="term-fg32">+	&quot;reth-codecs&#47;serde&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-92c870a9f483e83ad83b1efd" role="button"
                       aria-expanded="false" aria-controls="id-92c870a9f483e83ad83b1efd">
                        <code>crates/scroll/primitives/src/account_extension.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/primitives/src/account_extension.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+43</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-92c870a9f483e83ad83b1efd"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;account_extension.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;account_extension.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..6c732c18c38f725833f080a4188224be6c034cb9</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;account_extension.rs</span>
<span class="term-fg36">@@ -0,0 +1,43 @@</span>
<span class="term-fg32">+use crate::{hash_code, POSEIDON_EMPTY};</span>
<span class="term-fg32">+use alloy_primitives::B256;</span>
<span class="term-fg32">+use serde::{Deserialize, Serialize};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The extension for a Scroll account&#39;s representation in storage.</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; The extension is used in order to maintain backwards compatibility if more fields need to be</span>
<span class="term-fg32">+&#47;&#47;&#47; added to the account (see [reth codecs](reth_codecs::test_utils) for details).</span>
<span class="term-fg32">+#[derive(Clone, Copy, Debug, Default, PartialEq, Eq, Serialize, Deserialize)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;reth-codec&quot;, derive(reth_codecs::Compact))]</span>
<span class="term-fg32">+#[cfg_attr(any(test, feature = &quot;arbitrary&quot;), derive(arbitrary::Arbitrary))]</span>
<span class="term-fg32">+pub struct AccountExtension {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Size in bytes of the account&#39;s bytecode.</span>
<span class="term-fg32">+    pub code_size: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Poseidon hash of the account&#39;s bytecode. `None` means there is no</span>
<span class="term-fg32">+    &#47;&#47;&#47; bytecode for the account.</span>
<span class="term-fg32">+    pub poseidon_code_hash: Option&lt;B256&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl AccountExtension {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates an empty [`AccountExtension`].</span>
<span class="term-fg32">+    pub const fn empty() -&gt; Self {</span>
<span class="term-fg32">+        Self { code_size: 0, poseidon_code_hash: None }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates an [`AccountExtension`] from the provided bytecode.</span>
<span class="term-fg32">+    pub fn from_bytecode&lt;T: AsRef&lt;[u8]&gt;&gt;(code: &amp;T) -&gt; Self {</span>
<span class="term-fg32">+        let code = code.as_ref();</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            code_size: code.len() as u64,</span>
<span class="term-fg32">+            poseidon_code_hash: (!code.is_empty()).then_some(hash_code(code)),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(u64, B256)&gt; for AccountExtension {</span>
<span class="term-fg32">+    fn from(value: (u64, B256)) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            code_size: value.0,</span>
<span class="term-fg32">+            poseidon_code_hash: (value.1 != POSEIDON_EMPTY).then_some(value.1),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0fc886f22ba8e9fd0e081712" role="button"
                       aria-expanded="false" aria-controls="id-0fc886f22ba8e9fd0e081712">
                        <code>crates/scroll/primitives/src/execution_context.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/primitives/src/execution_context.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0fc886f22ba8e9fd0e081712"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;execution_context.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;execution_context.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..0175e70cb1a2f4c55557cad40996b3a89ee2b8a6</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;execution_context.rs</span>
<span class="term-fg36">@@ -0,0 +1,12 @@</span>
<span class="term-fg32">+use alloy_primitives::{map::HashMap, B256};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A Keccak code hash.</span>
<span class="term-fg32">+type KeccakHash = B256;</span>
<span class="term-fg32">+&#47;&#47;&#47; A Poseidon code hash.</span>
<span class="term-fg32">+type PoseidonHash = B256;</span>
<span class="term-fg32">+&#47;&#47;&#47; Size of a contract&#39;s code in bytes.</span>
<span class="term-fg32">+type CodeSize = u64;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Scroll post execution context maps a Keccak code hash of a contract&#39;s bytecode to its code size</span>
<span class="term-fg32">+&#47;&#47;&#47; and Poseidon code hash.</span>
<span class="term-fg32">+pub type ScrollPostExecutionContext = HashMap&lt;KeccakHash, (CodeSize, PoseidonHash)&gt;;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d781e9b93278de9f805b81f8" role="button"
                       aria-expanded="false" aria-controls="id-d781e9b93278de9f805b81f8">
                        <code>crates/scroll/primitives/src/l1_transaction.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/primitives/src/l1_transaction.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+308</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d781e9b93278de9f805b81f8"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;l1_transaction.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;l1_transaction.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..3f71d1e807544be1c5532f26b140e3a09ddf6db7</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;l1_transaction.rs</span>
<span class="term-fg36">@@ -0,0 +1,308 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll L1 message transaction</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use alloy_consensus::Transaction;</span>
<span class="term-fg32">+use alloy_primitives::{</span>
<span class="term-fg32">+    private::alloy_rlp::{Encodable, Header},</span>
<span class="term-fg32">+    Address, Bytes, ChainId, PrimitiveSignature as Signature, TxKind, B256, U256,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use alloy_rlp::Decodable;</span>
<span class="term-fg32">+use bytes::BufMut;</span>
<span class="term-fg32">+use serde::{Deserialize, Serialize};</span>
<span class="term-fg32">+#[cfg(any(test, feature = &quot;reth-codec&quot;))]</span>
<span class="term-fg32">+use {reth_codecs::Compact, reth_codecs_derive::add_arbitrary_tests};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; L1 message transaction type id, 0x7e in hex.</span>
<span class="term-fg32">+pub const L1_MESSAGE_TRANSACTION_TYPE: u8 = 126;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A message transaction sent from the settlement layer to the L2 for execution.</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; The signature of the L1 message is already verified on the L1 and as such doesn&#39;t contain</span>
<span class="term-fg32">+&#47;&#47;&#47; a signature field. Gas for the transaction execution on Scroll is already paid for on the L1.</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; # Bincode compatibility</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; `bincode` crate doesn&#39;t work with optionally serializable serde fields and some of the execution</span>
<span class="term-fg32">+&#47;&#47;&#47; types require optional serialization for RPC compatibility. Since `TxL1Message` doesn&#39;t</span>
<span class="term-fg32">+&#47;&#47;&#47; contain optionally serializable fields, no `bincode` compatible bridge implementation is</span>
<span class="term-fg32">+&#47;&#47;&#47; required.</span>
<span class="term-fg32">+#[derive(Clone, Debug, Default, PartialEq, Eq, Hash)]</span>
<span class="term-fg32">+#[cfg_attr(any(test, feature = &quot;serde&quot;), derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+#[cfg_attr(any(test, feature = &quot;serde&quot;), serde(rename_all = &quot;camelCase&quot;))]</span>
<span class="term-fg32">+#[cfg_attr(any(test, feature = &quot;arbitrary&quot;), derive(arbitrary::Arbitrary))]</span>
<span class="term-fg32">+#[cfg_attr(any(test, feature = &quot;reth-codec&quot;), derive(Compact))]</span>
<span class="term-fg32">+#[cfg_attr(any(test, feature = &quot;reth-codec&quot;), add_arbitrary_tests(compact, rlp))]</span>
<span class="term-fg32">+pub struct TxL1Message {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The queue index of the message in the L1 contract queue.</span>
<span class="term-fg32">+    #[cfg_attr(feature = &quot;serde&quot;, serde(with = &quot;alloy_serde::quantity&quot;))]</span>
<span class="term-fg32">+    pub queue_index: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The gas limit for the transaction. Gas is paid for when message is sent from the L1.</span>
<span class="term-fg32">+    #[cfg_attr(feature = &quot;serde&quot;, serde(with = &quot;alloy_serde::quantity&quot;, rename = &quot;gas&quot;))]</span>
<span class="term-fg32">+    pub gas_limit: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The destination for the transaction. `Address` is used in place of `TxKind` since contract</span>
<span class="term-fg32">+    &#47;&#47;&#47; creations aren&#39;t allowed via L1 message transactions.</span>
<span class="term-fg32">+    pub to: Address,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The value sent.</span>
<span class="term-fg32">+    pub value: U256,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The L1 sender of the transaction.</span>
<span class="term-fg32">+    pub sender: Address,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The input of the transaction.</span>
<span class="term-fg32">+    pub input: Bytes,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl TxL1Message {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns an empty signature for the [`TxL1Message`], which don&#39;t include a signature.</span>
<span class="term-fg32">+    pub fn signature() -&gt; Signature {</span>
<span class="term-fg32">+        Signature::new(U256::ZERO, U256::ZERO, false)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the destination of the transaction as a [`TxKind`].</span>
<span class="term-fg32">+    pub const fn to(&amp;self) -&gt; TxKind {</span>
<span class="term-fg32">+        TxKind::Call(self.to)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Decodes the inner [`TxL1Message`] fields from RLP bytes.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; NOTE: This assumes a RLP header has already been decoded, and _just_ decodes the following</span>
<span class="term-fg32">+    &#47;&#47;&#47; RLP fields in the following order:</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `queue_index`</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `gas_limit`</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `to`</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `value`</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `input`</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `sender`</span>
<span class="term-fg32">+    pub fn rlp_decode_fields(buf: &amp;mut &amp;[u8]) -&gt; alloy_rlp::Result&lt;Self&gt; {</span>
<span class="term-fg32">+        Ok(Self {</span>
<span class="term-fg32">+            queue_index: Decodable::decode(buf)?,</span>
<span class="term-fg32">+            gas_limit: Decodable::decode(buf)?,</span>
<span class="term-fg32">+            to: Decodable::decode(buf)?,</span>
<span class="term-fg32">+            value: Decodable::decode(buf)?,</span>
<span class="term-fg32">+            input: Decodable::decode(buf)?,</span>
<span class="term-fg32">+            sender: Decodable::decode(buf)?,</span>
<span class="term-fg32">+        })</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Decodes the transaction from RLP bytes.</span>
<span class="term-fg32">+    pub fn rlp_decode(buf: &amp;mut &amp;[u8]) -&gt; alloy_rlp::Result&lt;Self&gt; {</span>
<span class="term-fg32">+        let header = Header::decode(buf)?;</span>
<span class="term-fg32">+        if !header.list {</span>
<span class="term-fg32">+            return Err(alloy_rlp::Error::UnexpectedString);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        let remaining = buf.len();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let this = Self::rlp_decode_fields(buf)?;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        if buf.len() + header.payload_length != remaining {</span>
<span class="term-fg32">+            return Err(alloy_rlp::Error::ListLengthMismatch {</span>
<span class="term-fg32">+                expected: header.payload_length,</span>
<span class="term-fg32">+                got: remaining - buf.len(),</span>
<span class="term-fg32">+            });</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(this)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Outputs the length of the transaction&#39;s fields, without a RLP header.</span>
<span class="term-fg32">+    fn rlp_encoded_fields_length(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.queue_index.length() +</span>
<span class="term-fg32">+            self.gas_limit.length() +</span>
<span class="term-fg32">+            self.to.length() +</span>
<span class="term-fg32">+            self.value.length() +</span>
<span class="term-fg32">+            self.input.0.length() +</span>
<span class="term-fg32">+            self.sender.length()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Encode the fields of the transaction without a RLP header.</span>
<span class="term-fg32">+    &#47;&#47;&#47; &lt;https:&#47;&#47;github.com&#47;scroll-tech&#47;go-ethereum&#47;blob&#47;9fff27e4f34fb5097100ed76ee725ce056267f4b&#47;core&#47;types&#47;l1_message_tx.go#L12-L19&gt;</span>
<span class="term-fg32">+    fn rlp_encode_fields(&amp;self, out: &amp;mut dyn BufMut) {</span>
<span class="term-fg32">+        self.queue_index.encode(out);</span>
<span class="term-fg32">+        self.gas_limit.encode(out);</span>
<span class="term-fg32">+        self.to.encode(out);</span>
<span class="term-fg32">+        self.value.encode(out);</span>
<span class="term-fg32">+        self.input.encode(out);</span>
<span class="term-fg32">+        self.sender.encode(out);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create a RLP header for the transaction.</span>
<span class="term-fg32">+    fn rlp_header(&amp;self) -&gt; Header {</span>
<span class="term-fg32">+        Header { list: true, payload_length: self.rlp_encoded_fields_length() }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; RLP encodes the transaction.</span>
<span class="term-fg32">+    pub fn rlp_encode(&amp;self, out: &amp;mut dyn BufMut) {</span>
<span class="term-fg32">+        self.rlp_header().encode(out);</span>
<span class="term-fg32">+        self.rlp_encode_fields(out);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Get the length of the transaction when RLP encoded.</span>
<span class="term-fg32">+    pub fn rlp_encoded_length(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.rlp_header().length_with_payload()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Get the length of the transaction when EIP-2718 encoded. This is the</span>
<span class="term-fg32">+    &#47;&#47;&#47; 1 byte type flag + the length of the RLP encoded transaction.</span>
<span class="term-fg32">+    pub fn eip2718_encoded_length(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.rlp_encoded_length() + 1</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; EIP-2718 encode the transaction.</span>
<span class="term-fg32">+    pub fn eip2718_encode(&amp;self, out: &amp;mut dyn BufMut) {</span>
<span class="term-fg32">+        out.put_u8(L1_MESSAGE_TRANSACTION_TYPE);</span>
<span class="term-fg32">+        self.rlp_encode(out)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Calculates the in-memory size of the [`TxL1Message`] transaction.</span>
<span class="term-fg32">+    #[inline]</span>
<span class="term-fg32">+    pub fn size(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        size_of::&lt;u64&gt;() + &#47;&#47; queue_index</span>
<span class="term-fg32">+            size_of::&lt;u64&gt;() + &#47;&#47; gas_limit</span>
<span class="term-fg32">+            size_of::&lt;Address&gt;() + &#47;&#47; to</span>
<span class="term-fg32">+            size_of::&lt;U256&gt;() + &#47;&#47; value</span>
<span class="term-fg32">+            self.input.len() + &#47;&#47; input</span>
<span class="term-fg32">+            size_of::&lt;Address&gt;() &#47;&#47; sender</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Encodable for TxL1Message {</span>
<span class="term-fg32">+    fn encode(&amp;self, out: &amp;mut dyn BufMut) {</span>
<span class="term-fg32">+        self.rlp_encode(out)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn length(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.rlp_encoded_length()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Decodable for TxL1Message {</span>
<span class="term-fg32">+    fn decode(buf: &amp;mut &amp;[u8]) -&gt; alloy_rlp::Result&lt;Self&gt; {</span>
<span class="term-fg32">+        Self::rlp_decode(buf)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Transaction for TxL1Message {</span>
<span class="term-fg32">+    fn chain_id(&amp;self) -&gt; Option&lt;ChainId&gt; {</span>
<span class="term-fg32">+        None</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn nonce(&amp;self) -&gt; u64 {</span>
<span class="term-fg32">+        0u64</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn gas_limit(&amp;self) -&gt; u64 {</span>
<span class="term-fg32">+        self.gas_limit</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn gas_price(&amp;self) -&gt; Option&lt;u128&gt; {</span>
<span class="term-fg32">+        None</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn max_fee_per_gas(&amp;self) -&gt; u128 {</span>
<span class="term-fg32">+        0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn max_priority_fee_per_gas(&amp;self) -&gt; Option&lt;u128&gt; {</span>
<span class="term-fg32">+        None</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn max_fee_per_blob_gas(&amp;self) -&gt; Option&lt;u128&gt; {</span>
<span class="term-fg32">+        None</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn priority_fee_or_price(&amp;self) -&gt; u128 {</span>
<span class="term-fg32">+        0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn effective_gas_price(&amp;self, _base_fee: Option&lt;u64&gt;) -&gt; u128 {</span>
<span class="term-fg32">+        0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn is_dynamic_fee(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        false</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn kind(&amp;self) -&gt; TxKind {</span>
<span class="term-fg32">+        self.to()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn value(&amp;self) -&gt; U256 {</span>
<span class="term-fg32">+        self.value</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn input(&amp;self) -&gt; &amp;Bytes {</span>
<span class="term-fg32">+        &amp;self.input</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn ty(&amp;self) -&gt; u8 {</span>
<span class="term-fg32">+        L1_MESSAGE_TRANSACTION_TYPE</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn access_list(&amp;self) -&gt; Option&lt;&amp;alloy_eips::eip2930::AccessList&gt; {</span>
<span class="term-fg32">+        None</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn blob_versioned_hashes(&amp;self) -&gt; Option&lt;&amp;[B256]&gt; {</span>
<span class="term-fg32">+        None</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn authorization_list(&amp;self) -&gt; Option&lt;&amp;[alloy_eips::eip7702::SignedAuthorization]&gt; {</span>
<span class="term-fg32">+        None</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Scroll specific transaction fields</span>
<span class="term-fg32">+#[derive(Clone, Copy, Debug, Default, PartialEq, Eq, Serialize, Deserialize)]</span>
<span class="term-fg32">+#[serde(rename_all = &quot;camelCase&quot;)]</span>
<span class="term-fg32">+pub struct ScrollL1MessageTransactionFields {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The index of the transaction in the message queue.</span>
<span class="term-fg32">+    #[serde(with = &quot;alloy_serde::quantity&quot;)]</span>
<span class="term-fg32">+    pub queue_index: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The sender of the transaction on the L1.</span>
<span class="term-fg32">+    pub sender: Address,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(test)]</span>
<span class="term-fg32">+mod tests {</span>
<span class="term-fg32">+    use super::TxL1Message;</span>
<span class="term-fg32">+    use alloy_primitives::{address, bytes, hex, Bytes, U256};</span>
<span class="term-fg32">+    use arbitrary::Arbitrary;</span>
<span class="term-fg32">+    use bytes::BytesMut;</span>
<span class="term-fg32">+    use rand::Rng;</span>
<span class="term-fg32">+    use reth_codecs::{test_utils::UnusedBits, validate_bitflag_backwards_compat};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_bincode_roundtrip() {</span>
<span class="term-fg32">+        let mut bytes = [0u8; 1024];</span>
<span class="term-fg32">+        rand::thread_rng().fill(bytes.as_mut_slice());</span>
<span class="term-fg32">+        let tx = TxL1Message::arbitrary(&amp;mut arbitrary::Unstructured::new(&amp;bytes)).unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let encoded = bincode::serialize(&amp;tx).unwrap();</span>
<span class="term-fg32">+        let decoded: TxL1Message = bincode::deserialize(&amp;encoded).unwrap();</span>
<span class="term-fg32">+        assert_eq!(decoded, tx);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_eip2718_encode() {</span>
<span class="term-fg32">+        let tx =</span>
<span class="term-fg32">+            TxL1Message {</span>
<span class="term-fg32">+                queue_index: 947883,</span>
<span class="term-fg32">+                gas_limit: 2000000,</span>
<span class="term-fg32">+                to: address!(&quot;781e90f1c8fc4611c9b7497c3b47f99ef6969cbc&quot;),</span>
<span class="term-fg32">+                value: U256::ZERO,</span>
<span class="term-fg32">+                sender: address!(&quot;7885bcbd5cecef1336b5300fb5186a12ddd8c478&quot;),</span>
<span class="term-fg32">+                input: bytes!(&quot;8ef1332e000000000000000000000000c186fa914353c44b2e33ebe05f21846f1048beda0000000000000000000000003bad7ad0728f9917d1bf08af5782dcbd516cdd96000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e76ab00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000044493a4f84f464e58d4bfa93bcc57abfb14dbe1b8ff46cd132b5709aab227f269727943d2f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;),</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            ;</span>
<span class="term-fg32">+        let bytes = Bytes::from_static(&amp;hex!(&quot;7ef9015a830e76ab831e848094781e90f1c8fc4611c9b7497c3b47f99ef6969cbc80b901248ef1332e000000000000000000000000c186fa914353c44b2e33ebe05f21846f1048beda0000000000000000000000003bad7ad0728f9917d1bf08af5782dcbd516cdd96000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e76ab00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000044493a4f84f464e58d4bfa93bcc57abfb14dbe1b8ff46cd132b5709aab227f269727943d2f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000947885bcbd5cecef1336b5300fb5186a12ddd8c478&quot;));</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut encoded = BytesMut::default();</span>
<span class="term-fg32">+        tx.eip2718_encode(&amp;mut encoded);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        assert_eq!(encoded, bytes.as_ref())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_compaction_backwards_compatibility() {</span>
<span class="term-fg32">+        assert_eq!(TxL1Message::bitflag_encoded_bytes(), 2);</span>
<span class="term-fg32">+        validate_bitflag_backwards_compat!(TxL1Message, UnusedBits::NotZero);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-531cfccdec8f0e141811e393" role="button"
                       aria-expanded="false" aria-controls="id-531cfccdec8f0e141811e393">
                        <code>crates/scroll/primitives/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/primitives/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+17</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-531cfccdec8f0e141811e393"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..2f2796db6e234556b9c467b187e7e0d27cdf0dff</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,17 @@</span>
<span class="term-fg32">+&#47;&#47;! Primitive types for the Scroll extension of `Reth`.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![warn(unused_crate_dependencies)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use execution_context::ScrollPostExecutionContext;</span>
<span class="term-fg32">+mod execution_context;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use account_extension::AccountExtension;</span>
<span class="term-fg32">+mod account_extension;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use l1_transaction::{</span>
<span class="term-fg32">+    ScrollL1MessageTransactionFields, TxL1Message, L1_MESSAGE_TRANSACTION_TYPE,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+pub mod l1_transaction;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use poseidon::{hash_code, POSEIDON_EMPTY};</span>
<span class="term-fg32">+mod poseidon;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3a9f3cf262440b159ea9840f" role="button"
                       aria-expanded="false" aria-controls="id-3a9f3cf262440b159ea9840f">
                        <code>crates/scroll/primitives/src/poseidon.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/primitives/src/poseidon.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3a9f3cf262440b159ea9840f"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;poseidon.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;poseidon.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..4a5010167f51be151250d9169f04889d31334cea</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;poseidon.rs</span>
<span class="term-fg36">@@ -0,0 +1,10 @@</span>
<span class="term-fg32">+use alloy_primitives::{b256, B256};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The Poseidon hash of the empty string `&quot;&quot;`.</span>
<span class="term-fg32">+pub const POSEIDON_EMPTY: B256 =</span>
<span class="term-fg32">+    b256!(&quot;2098f5fb9e239eab3ceac3f27b81e481dc3124d55ffed523a839ee8446b64864&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Poseidon code hash</span>
<span class="term-fg32">+pub fn hash_code(code: &amp;[u8]) -&gt; B256 {</span>
<span class="term-fg32">+    poseidon_bn254::hash_code(code).into()</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-03060d2fb974d152458f97d1" role="button"
                       aria-expanded="false" aria-controls="id-03060d2fb974d152458f97d1">
                        <code>crates/scroll/revm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/revm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+50</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-03060d2fb974d152458f97d1"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;revm&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..7f1d25b9e9a2af66ee821e4c175004d8aa5262f6</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,50 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-revm&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# revm</span>
<span class="term-fg32">+revm = { version = &quot;18.0.0&quot;, features = [&quot;std&quot;], default-features = false }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# misc</span>
<span class="term-fg32">+serde = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+default = [&quot;std&quot;]</span>
<span class="term-fg32">+dev = [&quot;revm&#47;dev&quot;]</span>
<span class="term-fg32">+arbitrary = [</span>
<span class="term-fg32">+	&quot;revm&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives&#47;arbitrary&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+asm-keccak = [&quot;revm&#47;asm-keccak&quot;]</span>
<span class="term-fg32">+c-kzg = [&quot;revm&#47;c-kzg&quot;]</span>
<span class="term-fg32">+optimism = [&quot;revm&#47;optimism&quot;]</span>
<span class="term-fg32">+serde = [</span>
<span class="term-fg32">+	&quot;revm&#47;serde&quot;,</span>
<span class="term-fg32">+	&quot;serde&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives&#47;serde&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = []</span>
<span class="term-fg32">+test-utils = [&quot;revm&#47;test-utils&quot;]</span>
<span class="term-fg32">+std = [</span>
<span class="term-fg32">+	&quot;revm&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;serde&#47;std&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+blst = [&quot;revm&#47;blst&quot;]</span>
<span class="term-fg32">+optional_block_gas_limit =  [&quot;revm&#47;optional_block_gas_limit&quot;]</span>
<span class="term-fg32">+optional_eip3607 = [&quot;revm&#47;optional_eip3607&quot;]</span>
<span class="term-fg32">+optional_no_base_fee = [&quot;revm&#47;optional_no_base_fee&quot;]</span>
<span class="term-fg32">+secp256k1 = [&quot;revm&#47;secp256k1&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-72222a298f24b879f134d343" role="button"
                       aria-expanded="false" aria-controls="id-72222a298f24b879f134d343">
                        <code>crates/scroll/revm/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/revm/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+78</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-72222a298f24b879f134d343"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..750d8fdd1decbd715bd960756c5c33fd5071ce40</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,78 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll `revm` types redefinitions. Account types are redefined with two additional fields</span>
<span class="term-fg32">+&#47;&#47;! `code_size` and `poseidon_code_hash`, which are used during computation of the state root.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![warn(unused_crate_dependencies)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub mod states;</span>
<span class="term-fg32">+#[cfg(feature = &quot;test-utils&quot;)]</span>
<span class="term-fg32">+mod test_utils;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+pub use revm::{primitives::OptimismFields, L1BlockInfo, L1_BLOCK_CONTRACT};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use revm::{</span>
<span class="term-fg32">+    db::*,</span>
<span class="term-fg32">+    inspector_handle_register,</span>
<span class="term-fg32">+    primitives::{</span>
<span class="term-fg32">+        keccak256, AuthorizationList, Bytecode, BytecodeDecodeError, JumpTable,</span>
<span class="term-fg32">+        LegacyAnalyzedBytecode, TxEnv, TxKind,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    ContextPrecompile, ContextPrecompiles, Evm, EvmBuilder, EvmContext, GetInspector, Inspector,</span>
<span class="term-fg32">+    JournaledState,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+pub use crate::states::ScrollAccountInfo as AccountInfo;</span>
<span class="term-fg32">+#[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+pub use revm::primitives::AccountInfo;</span>
<span class="term-fg32">+pub use states::ScrollAccountInfo;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Shared module, available for all feature flags.</span>
<span class="term-fg32">+pub mod shared {</span>
<span class="term-fg32">+    pub use revm::{db::states::BundleState, primitives::AccountInfo};</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod handler {</span>
<span class="term-fg32">+    pub use revm::handler::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod interpreter {</span>
<span class="term-fg32">+    pub use revm::interpreter::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod inspectors {</span>
<span class="term-fg32">+    pub use revm::inspectors::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod precompile {</span>
<span class="term-fg32">+    pub use revm::precompile::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm-primitives` module structure</span>
<span class="term-fg32">+pub mod primitives {</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    pub use crate::states::ScrollAccountInfo as AccountInfo;</span>
<span class="term-fg32">+    pub use revm::primitives::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod db {</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    pub use crate::states::{</span>
<span class="term-fg32">+        ScrollBundleAccount as BundleAccount, ScrollBundleState as BundleState,</span>
<span class="term-fg32">+    };</span>
<span class="term-fg32">+    pub use revm::db::*;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+    pub mod states {</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        pub use crate::states::{</span>
<span class="term-fg32">+            ScrollBundleBuilder as BundleBuilder, ScrollBundleState as BundleState,</span>
<span class="term-fg32">+            ScrollPlainStateReverts as PlainStateReverts, ScrollStateChangeset as StateChangeset,</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        pub use revm::db::states::*;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7fc64fcd5bd16979ec4b0f7b" role="button"
                       aria-expanded="false" aria-controls="id-7fc64fcd5bd16979ec4b0f7b">
                        <code>crates/scroll/revm/src/states/account_info.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/revm/src/states/account_info.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+164</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7fc64fcd5bd16979ec4b0f7b"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;account_info.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;account_info.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..ad21e46f14ce7016c533eb2f0350deef9018ad5c</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;account_info.rs</span>
<span class="term-fg36">@@ -0,0 +1,164 @@</span>
<span class="term-fg32">+use reth_scroll_primitives::{hash_code, ScrollPostExecutionContext, POSEIDON_EMPTY};</span>
<span class="term-fg32">+use revm::primitives::{AccountInfo, Bytecode, B256, KECCAK_EMPTY, U256};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The Scroll account information. Code copy of [`AccountInfo`]. Provides additional `code_size`</span>
<span class="term-fg32">+&#47;&#47;&#47; and `poseidon_code_hash` fields needed in the state root computation.</span>
<span class="term-fg32">+#[derive(Clone, Debug, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollAccountInfo {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account balance.</span>
<span class="term-fg32">+    pub balance: U256,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account nonce.</span>
<span class="term-fg32">+    pub nonce: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account code keccak hash.</span>
<span class="term-fg32">+    pub code_hash: B256,</span>
<span class="term-fg32">+    &#47;&#47;&#47; code: if None, `code_by_hash` will be used to fetch it if code needs to be loaded from</span>
<span class="term-fg32">+    &#47;&#47;&#47; inside `revm`.</span>
<span class="term-fg32">+    pub code: Option&lt;Bytecode&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account code size.</span>
<span class="term-fg32">+    pub code_size: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account code Poseidon hash. [`POSEIDON_EMPTY`] if code is None or empty.</span>
<span class="term-fg32">+    pub poseidon_code_hash: B256,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(AccountInfo, &amp;ScrollPostExecutionContext)&gt; for ScrollAccountInfo {</span>
<span class="term-fg32">+    fn from((info, context): (AccountInfo, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        let context = context.get(&amp;info.code_hash).copied();</span>
<span class="term-fg32">+        let (code_size, poseidon_code_hash) = context</span>
<span class="term-fg32">+            .or_else(|| {</span>
<span class="term-fg32">+                info.code</span>
<span class="term-fg32">+                    .as_ref()</span>
<span class="term-fg32">+                    .map(|code| (code.len() as u64, hash_code(code.original_byte_slice())))</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .unwrap_or((0, POSEIDON_EMPTY));</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: info.balance,</span>
<span class="term-fg32">+            nonce: info.nonce,</span>
<span class="term-fg32">+            code_hash: info.code_hash,</span>
<span class="term-fg32">+            code: info.code,</span>
<span class="term-fg32">+            code_size,</span>
<span class="term-fg32">+            poseidon_code_hash,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Default for ScrollAccountInfo {</span>
<span class="term-fg32">+    fn default() -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            code_hash: KECCAK_EMPTY,</span>
<span class="term-fg32">+            code: Some(Bytecode::default()),</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            code_size: 0,</span>
<span class="term-fg32">+            poseidon_code_hash: POSEIDON_EMPTY,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl PartialEq for ScrollAccountInfo {</span>
<span class="term-fg32">+    fn eq(&amp;self, other: &amp;Self) -&gt; bool {</span>
<span class="term-fg32">+        self.balance == other.balance &amp;&amp;</span>
<span class="term-fg32">+            self.nonce == other.nonce &amp;&amp;</span>
<span class="term-fg32">+            self.code_hash == other.code_hash</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollAccountInfo {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates a new [`ScrollAccountInfo`] with the given fields.</span>
<span class="term-fg32">+    pub fn new(</span>
<span class="term-fg32">+        balance: U256,</span>
<span class="term-fg32">+        nonce: u64,</span>
<span class="term-fg32">+        code_hash: B256,</span>
<span class="term-fg32">+        code: Bytecode,</span>
<span class="term-fg32">+        poseidon_code_hash: B256,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        let code_size = code.len() as u64;</span>
<span class="term-fg32">+        Self { balance, nonce, code: Some(code), code_hash, code_size, poseidon_code_hash }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns a copy of this account with the [`Bytecode`] removed. This is</span>
<span class="term-fg32">+    &#47;&#47;&#47; useful when creating journals or snapshots of the state, where it is</span>
<span class="term-fg32">+    &#47;&#47;&#47; desirable to store the code blobs elsewhere.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; ## Note</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; This is distinct from [`ScrollAccountInfo::without_code`] in that it returns</span>
<span class="term-fg32">+    &#47;&#47;&#47; a new `ScrollAccountInfo` instance with the code removed.</span>
<span class="term-fg32">+    &#47;&#47;&#47; [`ScrollAccountInfo::without_code`] will modify and return the same instance.</span>
<span class="term-fg32">+    pub const fn copy_without_code(&amp;self) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: self.balance,</span>
<span class="term-fg32">+            nonce: self.nonce,</span>
<span class="term-fg32">+            code_hash: self.code_hash,</span>
<span class="term-fg32">+            code: None,</span>
<span class="term-fg32">+            code_size: self.code_size,</span>
<span class="term-fg32">+            poseidon_code_hash: self.poseidon_code_hash,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns account info without the code.</span>
<span class="term-fg32">+    pub fn without_code(mut self) -&gt; Self {</span>
<span class="term-fg32">+        self.take_bytecode();</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns if an account is empty.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; An account is empty if the following conditions are met.</span>
<span class="term-fg32">+    &#47;&#47;&#47; - code hash is zero or set to the Keccak256 hash of the empty string `&quot;&quot;`</span>
<span class="term-fg32">+    &#47;&#47;&#47; - balance is zero</span>
<span class="term-fg32">+    &#47;&#47;&#47; - nonce is zero</span>
<span class="term-fg32">+    pub fn is_empty(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        let code_empty = self.is_empty_code_hash() || self.code_hash.is_zero();</span>
<span class="term-fg32">+        code_empty &amp;&amp; self.balance.is_zero() &amp;&amp; self.nonce == 0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns `true` if the account is not empty.</span>
<span class="term-fg32">+    pub fn exists(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        !self.is_empty()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns `true` if account has no nonce and code.</span>
<span class="term-fg32">+    pub fn has_no_code_and_nonce(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.is_empty_code_hash() &amp;&amp; self.nonce == 0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return bytecode hash associated with this account.</span>
<span class="term-fg32">+    &#47;&#47;&#47; If account does not have code, it returns `KECCAK_EMPTY` hash.</span>
<span class="term-fg32">+    pub const fn code_hash(&amp;self) -&gt; B256 {</span>
<span class="term-fg32">+        self.code_hash</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns true if the code hash is the Keccak256 hash of the empty string `&quot;&quot;`.</span>
<span class="term-fg32">+    #[inline]</span>
<span class="term-fg32">+    pub fn is_empty_code_hash(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.code_hash == KECCAK_EMPTY</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Take bytecode from account. Code will be set to None.</span>
<span class="term-fg32">+    pub fn take_bytecode(&amp;mut self) -&gt; Option&lt;Bytecode&gt; {</span>
<span class="term-fg32">+        self.code.take()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns a [`ScrollAccountInfo`] with only balance.</span>
<span class="term-fg32">+    pub fn from_balance(balance: U256) -&gt; Self {</span>
<span class="term-fg32">+        Self { balance, ..Default::default() }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns a [`ScrollAccountInfo`] with defaults for balance and nonce.</span>
<span class="term-fg32">+    &#47;&#47;&#47; Computes the Keccak and Poseidon hash of the provided bytecode.</span>
<span class="term-fg32">+    pub fn from_bytecode(bytecode: Bytecode) -&gt; Self {</span>
<span class="term-fg32">+        let hash = bytecode.hash_slow();</span>
<span class="term-fg32">+        let code_size = bytecode.len() as u64;</span>
<span class="term-fg32">+        let poseidon_code_hash = hash_code(bytecode.bytecode());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            code: Some(bytecode),</span>
<span class="term-fg32">+            code_hash: hash,</span>
<span class="term-fg32">+            code_size,</span>
<span class="term-fg32">+            poseidon_code_hash,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5aca3b589ddcd36c7fd025c9" role="button"
                       aria-expanded="false" aria-controls="id-5aca3b589ddcd36c7fd025c9">
                        <code>crates/scroll/revm/src/states/bundle.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/revm/src/states/bundle.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+762</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5aca3b589ddcd36c7fd025c9"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..172e826fcab345d920eeba54edf1316531b97000</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle.rs</span>
<span class="term-fg36">@@ -0,0 +1,762 @@</span>
<span class="term-fg32">+use super::bundle_account::ScrollBundleAccount;</span>
<span class="term-fg32">+use crate::states::{</span>
<span class="term-fg32">+    changes::{ScrollPlainStateReverts, ScrollStateChangeset},</span>
<span class="term-fg32">+    reverts::ScrollReverts,</span>
<span class="term-fg32">+    ScrollAccountInfo, ScrollAccountInfoRevert, ScrollAccountRevert,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_scroll_primitives::ScrollPostExecutionContext;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::{</span>
<span class="term-fg32">+        states::{PlainStorageChangeset, StorageSlot},</span>
<span class="term-fg32">+        AccountStatus, BundleState, OriginalValuesKnown, RevertToSlot,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    primitives::{</span>
<span class="term-fg32">+        map::{Entry, HashMap, HashSet},</span>
<span class="term-fg32">+        Address, Bytecode, B256, KECCAK_EMPTY, U256,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use std::{</span>
<span class="term-fg32">+    collections::{hash_map, BTreeMap, BTreeSet},</span>
<span class="term-fg32">+    ops::RangeInclusive,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A code copy of the [`BundleState`] modified with Scroll compatible fields.</span>
<span class="term-fg32">+#[derive(Default, Debug, Clone, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollBundleState {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account state.</span>
<span class="term-fg32">+    pub state: HashMap&lt;Address, ScrollBundleAccount&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; All created contracts in this block.</span>
<span class="term-fg32">+    pub contracts: HashMap&lt;B256, Bytecode&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Changes to revert.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Note: Inside vector is *not* sorted by address.</span>
<span class="term-fg32">+    &#47;&#47;&#47; But it is unique by address.</span>
<span class="term-fg32">+    pub reverts: ScrollReverts,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The size of the plain state in the bundle state.</span>
<span class="term-fg32">+    pub state_size: usize,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The size of reverts in the bundle state.</span>
<span class="term-fg32">+    pub reverts_size: usize,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(BundleState, &amp;ScrollPostExecutionContext)&gt; for ScrollBundleState {</span>
<span class="term-fg32">+    fn from((bundle, context): (BundleState, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        &#47;&#47; we need to clone the reverts because there is no way to take ownership of</span>
<span class="term-fg32">+        &#47;&#47; the inner Vec from the `Reverts` wrapper.</span>
<span class="term-fg32">+        let reverts = bundle</span>
<span class="term-fg32">+            .reverts</span>
<span class="term-fg32">+            .iter()</span>
<span class="term-fg32">+            .map(|reverts| {</span>
<span class="term-fg32">+                reverts</span>
<span class="term-fg32">+                    .iter()</span>
<span class="term-fg32">+                    .map(|(add, revert)| (*add, (revert.clone(), context).into()))</span>
<span class="term-fg32">+                    .collect()</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let state = bundle</span>
<span class="term-fg32">+            .state</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|(add, account)| (add, (account, context).into()))</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            state,</span>
<span class="term-fg32">+            contracts: bundle.contracts,</span>
<span class="term-fg32">+            reverts: ScrollReverts::new(reverts),</span>
<span class="term-fg32">+            state_size: bundle.state_size,</span>
<span class="term-fg32">+            reverts_size: bundle.reverts_size,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl From&lt;BundleState&gt; for ScrollBundleState {</span>
<span class="term-fg32">+    fn from(bundle: BundleState) -&gt; Self {</span>
<span class="term-fg32">+        (bundle, &amp;ScrollPostExecutionContext::default()).into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl From&lt;(BundleState, &amp;())&gt; for ScrollBundleState {</span>
<span class="term-fg32">+    fn from((bundle, _): (BundleState, &amp;())) -&gt; Self {</span>
<span class="term-fg32">+        bundle.into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollBundleState {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return builder instance for further manipulation</span>
<span class="term-fg32">+    pub fn builder(revert_range: RangeInclusive&lt;u64&gt;) -&gt; ScrollBundleBuilder {</span>
<span class="term-fg32">+        ScrollBundleBuilder::new(revert_range)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create it with new and old values of both Storage and [`ScrollAccountInfo`].</span>
<span class="term-fg32">+    pub fn new(</span>
<span class="term-fg32">+        state: impl IntoIterator&lt;</span>
<span class="term-fg32">+            Item = (</span>
<span class="term-fg32">+                Address,</span>
<span class="term-fg32">+                Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+                Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+                HashMap&lt;U256, (U256, U256)&gt;,</span>
<span class="term-fg32">+            ),</span>
<span class="term-fg32">+        &gt;,</span>
<span class="term-fg32">+        reverts: impl IntoIterator&lt;</span>
<span class="term-fg32">+            Item = impl IntoIterator&lt;</span>
<span class="term-fg32">+                Item = (</span>
<span class="term-fg32">+                    Address,</span>
<span class="term-fg32">+                    Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;,</span>
<span class="term-fg32">+                    impl IntoIterator&lt;Item = (U256, U256)&gt;,</span>
<span class="term-fg32">+                ),</span>
<span class="term-fg32">+            &gt;,</span>
<span class="term-fg32">+        &gt;,</span>
<span class="term-fg32">+        contracts: impl IntoIterator&lt;Item = (B256, Bytecode)&gt;,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        &#47;&#47; Create state from iterator.</span>
<span class="term-fg32">+        let mut state_size = 0;</span>
<span class="term-fg32">+        let state = state</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|(address, original, present, storage)| {</span>
<span class="term-fg32">+                let account = ScrollBundleAccount::new(</span>
<span class="term-fg32">+                    original,</span>
<span class="term-fg32">+                    present,</span>
<span class="term-fg32">+                    storage</span>
<span class="term-fg32">+                        .into_iter()</span>
<span class="term-fg32">+                        .map(|(k, (o_val, p_val))| (k, StorageSlot::new_changed(o_val, p_val)))</span>
<span class="term-fg32">+                        .collect(),</span>
<span class="term-fg32">+                    AccountStatus::Changed,</span>
<span class="term-fg32">+                );</span>
<span class="term-fg32">+                state_size += account.size_hint();</span>
<span class="term-fg32">+                (address, account)</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; Create reverts from iterator.</span>
<span class="term-fg32">+        let mut reverts_size = 0;</span>
<span class="term-fg32">+        let reverts = reverts</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|block_reverts| {</span>
<span class="term-fg32">+                block_reverts</span>
<span class="term-fg32">+                    .into_iter()</span>
<span class="term-fg32">+                    .map(|(address, account, storage)| {</span>
<span class="term-fg32">+                        let account = match account {</span>
<span class="term-fg32">+                            Some(Some(account)) =&gt; ScrollAccountInfoRevert::RevertTo(account),</span>
<span class="term-fg32">+                            Some(None) =&gt; ScrollAccountInfoRevert::DeleteIt,</span>
<span class="term-fg32">+                            None =&gt; ScrollAccountInfoRevert::DoNothing,</span>
<span class="term-fg32">+                        };</span>
<span class="term-fg32">+                        let revert = ScrollAccountRevert {</span>
<span class="term-fg32">+                            account,</span>
<span class="term-fg32">+                            storage: storage</span>
<span class="term-fg32">+                                .into_iter()</span>
<span class="term-fg32">+                                .map(|(k, v)| (k, RevertToSlot::Some(v)))</span>
<span class="term-fg32">+                                .collect(),</span>
<span class="term-fg32">+                            previous_status: AccountStatus::Changed,</span>
<span class="term-fg32">+                            wipe_storage: false,</span>
<span class="term-fg32">+                        };</span>
<span class="term-fg32">+                        reverts_size += revert.size_hint();</span>
<span class="term-fg32">+                        (address, revert)</span>
<span class="term-fg32">+                    })</span>
<span class="term-fg32">+                    .collect::&lt;Vec&lt;_&gt;&gt;()</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect::&lt;Vec&lt;_&gt;&gt;();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            state,</span>
<span class="term-fg32">+            contracts: contracts.into_iter().collect(),</span>
<span class="term-fg32">+            reverts: ScrollReverts::new(reverts),</span>
<span class="term-fg32">+            state_size,</span>
<span class="term-fg32">+            reverts_size,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the approximate size of changes in the bundle state.</span>
<span class="term-fg32">+    &#47;&#47;&#47; The estimation is not precise, because the information about the number of</span>
<span class="term-fg32">+    &#47;&#47;&#47; destroyed entries that need to be removed is not accessible to the bundle state.</span>
<span class="term-fg32">+    pub fn size_hint(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.state_size + self.reverts_size + self.contracts.len()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return reference to the state.</span>
<span class="term-fg32">+    pub const fn state(&amp;self) -&gt; &amp;HashMap&lt;Address, ScrollBundleAccount&gt; {</span>
<span class="term-fg32">+        &amp;self.state</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Is bundle state empty.</span>
<span class="term-fg32">+    pub fn is_empty(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.len() == 0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return number of changed accounts.</span>
<span class="term-fg32">+    pub fn len(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.state.len()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Get account from state</span>
<span class="term-fg32">+    pub fn account(&amp;self, address: &amp;Address) -&gt; Option&lt;&amp;ScrollBundleAccount&gt; {</span>
<span class="term-fg32">+        self.state.get(address)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Get bytecode from state</span>
<span class="term-fg32">+    pub fn bytecode(&amp;self, hash: &amp;B256) -&gt; Option&lt;Bytecode&gt; {</span>
<span class="term-fg32">+        self.contracts.get(hash).cloned()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Extend the bundle with other state</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Update the `other` state only if `other` is not flagged as destroyed.</span>
<span class="term-fg32">+    pub fn extend_state(&amp;mut self, other_state: HashMap&lt;Address, ScrollBundleAccount&gt;) {</span>
<span class="term-fg32">+        for (address, other_account) in other_state {</span>
<span class="term-fg32">+            match self.state.entry(address) {</span>
<span class="term-fg32">+                Entry::Occupied(mut entry) =&gt; {</span>
<span class="term-fg32">+                    let this = entry.get_mut();</span>
<span class="term-fg32">+                    self.state_size -= this.size_hint();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                    &#47;&#47; if other was destroyed. replace `this` storage with</span>
<span class="term-fg32">+                    &#47;&#47; the `other one.</span>
<span class="term-fg32">+                    if other_account.was_destroyed() {</span>
<span class="term-fg32">+                        this.storage = other_account.storage;</span>
<span class="term-fg32">+                    } else {</span>
<span class="term-fg32">+                        &#47;&#47; otherwise extend this storage with other</span>
<span class="term-fg32">+                        for (key, storage_slot) in other_account.storage {</span>
<span class="term-fg32">+                            &#47;&#47; update present value or insert storage slot.</span>
<span class="term-fg32">+                            this.storage.entry(key).or_insert(storage_slot).present_value =</span>
<span class="term-fg32">+                                storage_slot.present_value;</span>
<span class="term-fg32">+                        }</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                    this.info = other_account.info;</span>
<span class="term-fg32">+                    this.status.transition(other_account.status);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                    &#47;&#47; Update the state size</span>
<span class="term-fg32">+                    self.state_size += this.size_hint();</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                hash_map::Entry::Vacant(entry) =&gt; {</span>
<span class="term-fg32">+                    &#47;&#47; just insert if empty</span>
<span class="term-fg32">+                    self.state_size += other_account.size_hint();</span>
<span class="term-fg32">+                    entry.insert(other_account);</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Extend the state with state that is build on top of it.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; If storage was wiped in `other` state, copy `this` plain state</span>
<span class="term-fg32">+    &#47;&#47;&#47; and put it inside `other` revert (if there is no duplicates of course).</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; If `this` and `other` accounts were both destroyed invalidate second</span>
<span class="term-fg32">+    &#47;&#47;&#47; wipe flag (from `other`). As wiping from database should be done only once</span>
<span class="term-fg32">+    &#47;&#47;&#47; and we already transferred all potentially missing storages to the `other` revert.</span>
<span class="term-fg32">+    pub fn extend(&amp;mut self, mut other: Self) {</span>
<span class="term-fg32">+        &#47;&#47; iterate over reverts and if its storage is wiped try to add previous bundle</span>
<span class="term-fg32">+        &#47;&#47; state as there is potential missing slots.</span>
<span class="term-fg32">+        for (address, revert) in other.reverts.iter_mut().flatten() {</span>
<span class="term-fg32">+            if revert.wipe_storage {</span>
<span class="term-fg32">+                &#47;&#47; If there is wipe storage in `other` revert</span>
<span class="term-fg32">+                &#47;&#47; we need to move storage from present state.</span>
<span class="term-fg32">+                if let Some(this_account) = self.state.get_mut(address) {</span>
<span class="term-fg32">+                    &#47;&#47; As this account was destroyed inside `other` bundle.</span>
<span class="term-fg32">+                    &#47;&#47; we are fine to wipe&#47;drain this storage and put it inside revert.</span>
<span class="term-fg32">+                    for (key, value) in this_account.storage.drain() {</span>
<span class="term-fg32">+                        revert</span>
<span class="term-fg32">+                            .storage</span>
<span class="term-fg32">+                            .entry(key)</span>
<span class="term-fg32">+                            .or_insert(RevertToSlot::Some(value.present_value));</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                    &#47;&#47; nullify `other` wipe as primary database wipe is done in `this`.</span>
<span class="term-fg32">+                    if this_account.was_destroyed() {</span>
<span class="term-fg32">+                        revert.wipe_storage = false;</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; Increment reverts size for each of the updated reverts.</span>
<span class="term-fg32">+            self.reverts_size += revert.size_hint();</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        &#47;&#47; Extension of state</span>
<span class="term-fg32">+        self.extend_state(other.state);</span>
<span class="term-fg32">+        &#47;&#47; Contract can be just extended, when counter is introduced we will take into account that.</span>
<span class="term-fg32">+        self.contracts.extend(other.contracts);</span>
<span class="term-fg32">+        &#47;&#47; Reverts can be just extended</span>
<span class="term-fg32">+        self.reverts.extend(other.reverts);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Generate a [`ScrollStateChangeset`] from the bundle state without consuming</span>
<span class="term-fg32">+    &#47;&#47;&#47; it.</span>
<span class="term-fg32">+    pub fn to_plain_state(&amp;self, is_value_known: OriginalValuesKnown) -&gt; ScrollStateChangeset {</span>
<span class="term-fg32">+        &#47;&#47; pessimistically pre-allocate assuming _all_ accounts changed.</span>
<span class="term-fg32">+        let state_len = self.state.len();</span>
<span class="term-fg32">+        let mut accounts = Vec::with_capacity(state_len);</span>
<span class="term-fg32">+        let mut storage = Vec::with_capacity(state_len);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        for (address, account) in &amp;self.state {</span>
<span class="term-fg32">+            &#47;&#47; append account info if it is changed.</span>
<span class="term-fg32">+            let was_destroyed = account.was_destroyed();</span>
<span class="term-fg32">+            if is_value_known.is_not_known() || account.is_info_changed() {</span>
<span class="term-fg32">+                let info = account.info.as_ref().map(ScrollAccountInfo::copy_without_code);</span>
<span class="term-fg32">+                accounts.push((*address, info));</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; append storage changes</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; NOTE: Assumption is that revert is going to remove whole plain storage from</span>
<span class="term-fg32">+            &#47;&#47; database so we can check if plain state was wiped or not.</span>
<span class="term-fg32">+            let mut account_storage_changed = Vec::with_capacity(account.storage.len());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            for (key, slot) in account.storage.iter().map(|(k, v)| (*k, *v)) {</span>
<span class="term-fg32">+                &#47;&#47; If storage was destroyed that means that storage was wiped.</span>
<span class="term-fg32">+                &#47;&#47; In that case we need to check if present storage value is different then ZERO.</span>
<span class="term-fg32">+                let destroyed_and_not_zero = was_destroyed &amp;&amp; !slot.present_value.is_zero();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                &#47;&#47; If account is not destroyed check if original values was changed,</span>
<span class="term-fg32">+                &#47;&#47; so we can update it.</span>
<span class="term-fg32">+                let not_destroyed_and_changed = !was_destroyed &amp;&amp; slot.is_changed();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                if is_value_known.is_not_known() ||</span>
<span class="term-fg32">+                    destroyed_and_not_zero ||</span>
<span class="term-fg32">+                    not_destroyed_and_changed</span>
<span class="term-fg32">+                {</span>
<span class="term-fg32">+                    account_storage_changed.push((key, slot.present_value));</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            if !account_storage_changed.is_empty() || was_destroyed {</span>
<span class="term-fg32">+                &#47;&#47; append storage changes to account.</span>
<span class="term-fg32">+                storage.push(PlainStorageChangeset {</span>
<span class="term-fg32">+                    address: *address,</span>
<span class="term-fg32">+                    wipe_storage: was_destroyed,</span>
<span class="term-fg32">+                    storage: account_storage_changed,</span>
<span class="term-fg32">+                });</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let contracts = self</span>
<span class="term-fg32">+            .contracts</span>
<span class="term-fg32">+            .iter()</span>
<span class="term-fg32">+            &#47;&#47; remove empty bytecodes</span>
<span class="term-fg32">+            .filter(|(b, _)| **b != KECCAK_EMPTY)</span>
<span class="term-fg32">+            .map(|(b, code)| (*b, code.clone()))</span>
<span class="term-fg32">+            .collect::&lt;Vec&lt;_&gt;&gt;();</span>
<span class="term-fg32">+        ScrollStateChangeset { accounts, storage, contracts }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Generate a [`ScrollStateChangeset`] and [`ScrollPlainStateReverts`] from the bundle</span>
<span class="term-fg32">+    &#47;&#47;&#47; state.</span>
<span class="term-fg32">+    pub fn to_plain_state_and_reverts(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        is_value_known: OriginalValuesKnown,</span>
<span class="term-fg32">+    ) -&gt; (ScrollStateChangeset, ScrollPlainStateReverts) {</span>
<span class="term-fg32">+        (self.to_plain_state(is_value_known), self.reverts.to_plain_state_reverts())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Take first N raw reverts from the [`ScrollBundleState`].</span>
<span class="term-fg32">+    pub fn take_n_reverts(&amp;mut self, reverts_to_take: usize) -&gt; ScrollReverts {</span>
<span class="term-fg32">+        &#47;&#47; split is done as [0, num) and [num, len].</span>
<span class="term-fg32">+        if reverts_to_take &gt; self.reverts.len() {</span>
<span class="term-fg32">+            return self.take_all_reverts();</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        let (detach, this) = self.reverts.split_at(reverts_to_take);</span>
<span class="term-fg32">+        let detached_reverts = ScrollReverts::new(detach.to_vec());</span>
<span class="term-fg32">+        self.reverts_size =</span>
<span class="term-fg32">+            this.iter().flatten().fold(0, |acc, (_, revert)| acc + revert.size_hint());</span>
<span class="term-fg32">+        self.reverts = ScrollReverts::new(this.to_vec());</span>
<span class="term-fg32">+        detached_reverts</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return and clear all reverts from [`ScrollBundleState`]</span>
<span class="term-fg32">+    pub fn take_all_reverts(&amp;mut self) -&gt; ScrollReverts {</span>
<span class="term-fg32">+        self.reverts_size = 0;</span>
<span class="term-fg32">+        core::mem::take(&amp;mut self.reverts)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Reverts the state changes by N transitions back.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; See also [`Self::revert_latest`]</span>
<span class="term-fg32">+    pub fn revert(&amp;mut self, mut num_transitions: usize) {</span>
<span class="term-fg32">+        if num_transitions == 0 {</span>
<span class="term-fg32">+            return;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        while self.revert_latest() {</span>
<span class="term-fg32">+            num_transitions -= 1;</span>
<span class="term-fg32">+            if num_transitions == 0 {</span>
<span class="term-fg32">+                &#47;&#47; break the loop.</span>
<span class="term-fg32">+                break;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Reverts the state changes of the latest transition</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Note: This is the same as `BundleState::revert(1)`</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns true if the state was reverted.</span>
<span class="term-fg32">+    pub fn revert_latest(&amp;mut self) -&gt; bool {</span>
<span class="term-fg32">+        &#47;&#47; revert the latest recorded state</span>
<span class="term-fg32">+        if let Some(reverts) = self.reverts.pop() {</span>
<span class="term-fg32">+            for (address, revert_account) in reverts {</span>
<span class="term-fg32">+                self.reverts_size -= revert_account.size_hint();</span>
<span class="term-fg32">+                match self.state.entry(address) {</span>
<span class="term-fg32">+                    Entry::Occupied(mut entry) =&gt; {</span>
<span class="term-fg32">+                        let account = entry.get_mut();</span>
<span class="term-fg32">+                        self.state_size -= account.size_hint();</span>
<span class="term-fg32">+                        if account.revert(revert_account) {</span>
<span class="term-fg32">+                            entry.remove();</span>
<span class="term-fg32">+                        } else {</span>
<span class="term-fg32">+                            self.state_size += account.size_hint();</span>
<span class="term-fg32">+                        }</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                    Entry::Vacant(entry) =&gt; {</span>
<span class="term-fg32">+                        &#47;&#47; create empty account that we will revert on.</span>
<span class="term-fg32">+                        &#47;&#47; Only place where this account is not existing is if revert is DeleteIt.</span>
<span class="term-fg32">+                        let mut account = ScrollBundleAccount::new(</span>
<span class="term-fg32">+                            None,</span>
<span class="term-fg32">+                            None,</span>
<span class="term-fg32">+                            HashMap::default(),</span>
<span class="term-fg32">+                            AccountStatus::LoadedNotExisting,</span>
<span class="term-fg32">+                        );</span>
<span class="term-fg32">+                        if !account.revert(revert_account) {</span>
<span class="term-fg32">+                            self.state_size += account.size_hint();</span>
<span class="term-fg32">+                            entry.insert(account);</span>
<span class="term-fg32">+                        }</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            return true;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        false</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; This builder is used to help to facilitate the initialization of [`ScrollBundleState`] struct.</span>
<span class="term-fg32">+&#47;&#47;&#47; This is a code copy of the [`revm::db::states::BundleBuilder`] to accommodate the</span>
<span class="term-fg32">+&#47;&#47;&#47; [`ScrollBundleState`].</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct ScrollBundleBuilder {</span>
<span class="term-fg32">+    states: HashSet&lt;Address&gt;,</span>
<span class="term-fg32">+    state_original: HashMap&lt;Address, ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+    state_present: HashMap&lt;Address, ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+    state_storage: HashMap&lt;Address, HashMap&lt;U256, (U256, U256)&gt;&gt;,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    reverts: BTreeSet&lt;(u64, Address)&gt;,</span>
<span class="term-fg32">+    revert_range: RangeInclusive&lt;u64&gt;,</span>
<span class="term-fg32">+    revert_account: HashMap&lt;(u64, Address), Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;&gt;,</span>
<span class="term-fg32">+    revert_storage: HashMap&lt;(u64, Address), Vec&lt;(U256, U256)&gt;&gt;,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    contracts: HashMap&lt;B256, Bytecode&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Default for ScrollBundleBuilder {</span>
<span class="term-fg32">+    fn default() -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            states: HashSet::default(),</span>
<span class="term-fg32">+            state_original: HashMap::default(),</span>
<span class="term-fg32">+            state_present: HashMap::default(),</span>
<span class="term-fg32">+            state_storage: HashMap::default(),</span>
<span class="term-fg32">+            reverts: BTreeSet::new(),</span>
<span class="term-fg32">+            revert_range: 0..=0,</span>
<span class="term-fg32">+            revert_account: HashMap::default(),</span>
<span class="term-fg32">+            revert_storage: HashMap::default(),</span>
<span class="term-fg32">+            contracts: HashMap::default(),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollBundleBuilder {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create builder instance</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; `revert_range` indicates the size of [`ScrollBundleState`] `reverts` field</span>
<span class="term-fg32">+    pub fn new(revert_range: RangeInclusive&lt;u64&gt;) -&gt; Self {</span>
<span class="term-fg32">+        Self { revert_range, ..Default::default() }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Apply a transformation to the builder.</span>
<span class="term-fg32">+    pub fn apply&lt;F&gt;(self, f: F) -&gt; Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        F: FnOnce(Self) -&gt; Self,</span>
<span class="term-fg32">+    {</span>
<span class="term-fg32">+        f(self)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Apply a mutable transformation to the builder.</span>
<span class="term-fg32">+    pub fn apply_mut&lt;F&gt;(&amp;mut self, f: F) -&gt; &amp;mut Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        F: FnOnce(&amp;mut Self),</span>
<span class="term-fg32">+    {</span>
<span class="term-fg32">+        f(self);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect address info of [`ScrollBundleState`] state</span>
<span class="term-fg32">+    pub fn state_address(mut self, address: Address) -&gt; Self {</span>
<span class="term-fg32">+        self.set_state_address(address);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect account info of [`ScrollBundleState`] state</span>
<span class="term-fg32">+    pub fn state_original_account_info(</span>
<span class="term-fg32">+        mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        original: ScrollAccountInfo,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        self.set_state_original_account_info(address, original);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect account info of [`ScrollBundleState`] state</span>
<span class="term-fg32">+    pub fn state_present_account_info(</span>
<span class="term-fg32">+        mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        present: ScrollAccountInfo,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        self.set_state_present_account_info(address, present);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect storage info of [`ScrollBundleState`] state</span>
<span class="term-fg32">+    pub fn state_storage(mut self, address: Address, storage: HashMap&lt;U256, (U256, U256)&gt;) -&gt; Self {</span>
<span class="term-fg32">+        self.set_state_storage(address, storage);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect address info of [`ScrollBundleState`] reverts</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; `block_number` must respect `revert_range`, or the input</span>
<span class="term-fg32">+    &#47;&#47;&#47; will be ignored during the final build process</span>
<span class="term-fg32">+    pub fn revert_address(mut self, block_number: u64, address: Address) -&gt; Self {</span>
<span class="term-fg32">+        self.set_revert_address(block_number, address);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect account info of [`ScrollBundleState`] reverts</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; `block_number` must respect `revert_range`, or the input</span>
<span class="term-fg32">+    &#47;&#47;&#47; will be ignored during the final build process</span>
<span class="term-fg32">+    pub fn revert_account_info(</span>
<span class="term-fg32">+        mut self,</span>
<span class="term-fg32">+        block_number: u64,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        account: Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        self.set_revert_account_info(block_number, address, account);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect storage info of [`ScrollBundleState`] reverts</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; `block_number` must respect `revert_range`, or the input</span>
<span class="term-fg32">+    &#47;&#47;&#47; will be ignored during the final build process</span>
<span class="term-fg32">+    pub fn revert_storage(</span>
<span class="term-fg32">+        mut self,</span>
<span class="term-fg32">+        block_number: u64,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        storage: Vec&lt;(U256, U256)&gt;,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        self.set_revert_storage(block_number, address, storage);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect contracts info</span>
<span class="term-fg32">+    pub fn contract(mut self, address: B256, bytecode: Bytecode) -&gt; Self {</span>
<span class="term-fg32">+        self.set_contract(address, bytecode);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set address info of [`ScrollBundleState`] state.</span>
<span class="term-fg32">+    pub fn set_state_address(&amp;mut self, address: Address) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.states.insert(address);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set original account info of [`ScrollBundleState`] state.</span>
<span class="term-fg32">+    pub fn set_state_original_account_info(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        original: ScrollAccountInfo,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.states.insert(address);</span>
<span class="term-fg32">+        self.state_original.insert(address, original);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set present account info of [`ScrollBundleState`] state.</span>
<span class="term-fg32">+    pub fn set_state_present_account_info(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        present: ScrollAccountInfo,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.states.insert(address);</span>
<span class="term-fg32">+        self.state_present.insert(address, present);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set storage info of [`ScrollBundleState`] state.</span>
<span class="term-fg32">+    pub fn set_state_storage(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        storage: HashMap&lt;U256, (U256, U256)&gt;,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.states.insert(address);</span>
<span class="term-fg32">+        self.state_storage.insert(address, storage);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set address info of [`ScrollBundleState`] reverts.</span>
<span class="term-fg32">+    pub fn set_revert_address(&amp;mut self, block_number: u64, address: Address) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.reverts.insert((block_number, address));</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set account info of [`ScrollBundleState`] reverts.</span>
<span class="term-fg32">+    pub fn set_revert_account_info(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        block_number: u64,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        account: Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.reverts.insert((block_number, address));</span>
<span class="term-fg32">+        self.revert_account.insert((block_number, address), account);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set storage info of [`ScrollBundleState`] reverts.</span>
<span class="term-fg32">+    pub fn set_revert_storage(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        block_number: u64,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        storage: Vec&lt;(U256, U256)&gt;,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.reverts.insert((block_number, address));</span>
<span class="term-fg32">+        self.revert_storage.insert((block_number, address), storage);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set contracts info.</span>
<span class="term-fg32">+    pub fn set_contract(&amp;mut self, address: B256, bytecode: Bytecode) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.contracts.insert(address, bytecode);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create [`ScrollBundleState`] instance based on collected information</span>
<span class="term-fg32">+    pub fn build(mut self) -&gt; ScrollBundleState {</span>
<span class="term-fg32">+        let mut state_size = 0;</span>
<span class="term-fg32">+        let state = self</span>
<span class="term-fg32">+            .states</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|address| {</span>
<span class="term-fg32">+                let storage = self</span>
<span class="term-fg32">+                    .state_storage</span>
<span class="term-fg32">+                    .remove(&amp;address)</span>
<span class="term-fg32">+                    .map(|s| {</span>
<span class="term-fg32">+                        s.into_iter()</span>
<span class="term-fg32">+                            .map(|(k, (o_val, p_val))| (k, StorageSlot::new_changed(o_val, p_val)))</span>
<span class="term-fg32">+                            .collect()</span>
<span class="term-fg32">+                    })</span>
<span class="term-fg32">+                    .unwrap_or_default();</span>
<span class="term-fg32">+                let bundle_account = ScrollBundleAccount::new(</span>
<span class="term-fg32">+                    self.state_original.remove(&amp;address),</span>
<span class="term-fg32">+                    self.state_present.remove(&amp;address),</span>
<span class="term-fg32">+                    storage,</span>
<span class="term-fg32">+                    AccountStatus::Changed,</span>
<span class="term-fg32">+                );</span>
<span class="term-fg32">+                state_size += bundle_account.size_hint();</span>
<span class="term-fg32">+                (address, bundle_account)</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut reverts_size = 0;</span>
<span class="term-fg32">+        let mut reverts_map = BTreeMap::new();</span>
<span class="term-fg32">+        for block_number in self.revert_range {</span>
<span class="term-fg32">+            reverts_map.insert(block_number, Vec::new());</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        self.reverts.into_iter().for_each(|(block_number, address)| {</span>
<span class="term-fg32">+            let account =</span>
<span class="term-fg32">+                match self.revert_account.remove(&amp;(block_number, address)).unwrap_or_default() {</span>
<span class="term-fg32">+                    Some(Some(account)) =&gt; ScrollAccountInfoRevert::RevertTo(account),</span>
<span class="term-fg32">+                    Some(None) =&gt; ScrollAccountInfoRevert::DeleteIt,</span>
<span class="term-fg32">+                    None =&gt; ScrollAccountInfoRevert::DoNothing,</span>
<span class="term-fg32">+                };</span>
<span class="term-fg32">+            let storage = self</span>
<span class="term-fg32">+                .revert_storage</span>
<span class="term-fg32">+                .remove(&amp;(block_number, address))</span>
<span class="term-fg32">+                .map(|s| s.into_iter().map(|(k, v)| (k, RevertToSlot::Some(v))).collect())</span>
<span class="term-fg32">+                .unwrap_or_default();</span>
<span class="term-fg32">+            let account_revert = ScrollAccountRevert {</span>
<span class="term-fg32">+                account,</span>
<span class="term-fg32">+                storage,</span>
<span class="term-fg32">+                previous_status: AccountStatus::Changed,</span>
<span class="term-fg32">+                wipe_storage: false,</span>
<span class="term-fg32">+            };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            if reverts_map.contains_key(&amp;block_number) {</span>
<span class="term-fg32">+                reverts_size += account_revert.size_hint();</span>
<span class="term-fg32">+                reverts_map</span>
<span class="term-fg32">+                    .entry(block_number)</span>
<span class="term-fg32">+                    .or_insert(Vec::new())</span>
<span class="term-fg32">+                    .push((address, account_revert));</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        });</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        ScrollBundleState {</span>
<span class="term-fg32">+            state,</span>
<span class="term-fg32">+            contracts: self.contracts,</span>
<span class="term-fg32">+            reverts: ScrollReverts::new(reverts_map.into_values().collect()),</span>
<span class="term-fg32">+            state_size,</span>
<span class="term-fg32">+            reverts_size,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Getter for `states` field</span>
<span class="term-fg32">+    pub const fn get_states(&amp;self) -&gt; &amp;HashSet&lt;Address&gt; {</span>
<span class="term-fg32">+        &amp;self.states</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `states` field</span>
<span class="term-fg32">+    pub fn get_states_mut(&amp;mut self) -&gt; &amp;mut HashSet&lt;Address&gt; {</span>
<span class="term-fg32">+        &amp;mut self.states</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `state_original` field</span>
<span class="term-fg32">+    pub fn get_state_original_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;Address, ScrollAccountInfo&gt; {</span>
<span class="term-fg32">+        &amp;mut self.state_original</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `state_present` field</span>
<span class="term-fg32">+    pub fn get_state_present_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;Address, ScrollAccountInfo&gt; {</span>
<span class="term-fg32">+        &amp;mut self.state_present</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `state_storage` field</span>
<span class="term-fg32">+    pub fn get_state_storage_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;Address, HashMap&lt;U256, (U256, U256)&gt;&gt; {</span>
<span class="term-fg32">+        &amp;mut self.state_storage</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `reverts` field</span>
<span class="term-fg32">+    pub fn get_reverts_mut(&amp;mut self) -&gt; &amp;mut BTreeSet&lt;(u64, Address)&gt; {</span>
<span class="term-fg32">+        &amp;mut self.reverts</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `revert_range` field</span>
<span class="term-fg32">+    pub fn get_revert_range_mut(&amp;mut self) -&gt; &amp;mut RangeInclusive&lt;u64&gt; {</span>
<span class="term-fg32">+        &amp;mut self.revert_range</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `revert_account` field</span>
<span class="term-fg32">+    pub fn get_revert_account_mut(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut HashMap&lt;(u64, Address), Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;&gt; {</span>
<span class="term-fg32">+        &amp;mut self.revert_account</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `revert_storage` field</span>
<span class="term-fg32">+    pub fn get_revert_storage_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;(u64, Address), Vec&lt;(U256, U256)&gt;&gt; {</span>
<span class="term-fg32">+        &amp;mut self.revert_storage</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `contracts` field</span>
<span class="term-fg32">+    pub fn get_contracts_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;B256, Bytecode&gt; {</span>
<span class="term-fg32">+        &amp;mut self.contracts</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6ae3fe88d5da6f85fd8b0a4a" role="button"
                       aria-expanded="false" aria-controls="id-6ae3fe88d5da6f85fd8b0a4a">
                        <code>crates/scroll/revm/src/states/bundle_account.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/revm/src/states/bundle_account.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+130</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6ae3fe88d5da6f85fd8b0a4a"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle_account.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle_account.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..29be890314d719b72b67dcb41e3375334d2777ce</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle_account.rs</span>
<span class="term-fg36">@@ -0,0 +1,130 @@</span>
<span class="term-fg32">+use crate::states::{ScrollAccountInfo, ScrollAccountInfoRevert, ScrollAccountRevert};</span>
<span class="term-fg32">+use reth_scroll_primitives::ScrollPostExecutionContext;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::{</span>
<span class="term-fg32">+        states::StorageSlot, AccountStatus, BundleAccount, RevertToSlot, StorageWithOriginalValues,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    interpreter::primitives::U256,</span>
<span class="term-fg32">+    primitives::map::HashMap,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The scroll account bundle. Originally defined in [`BundleAccount`], a</span>
<span class="term-fg32">+&#47;&#47;&#47; scroll version of the bundle is needed for the [`crate::states::ScrollBundleState`].</span>
<span class="term-fg32">+#[derive(Debug, Clone, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollBundleAccount {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The current account&#39;s information</span>
<span class="term-fg32">+    pub info: Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The original account&#39;s information</span>
<span class="term-fg32">+    pub original_info: Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Contains both original and present state.</span>
<span class="term-fg32">+    &#47;&#47;&#47; When extracting changeset we compare if original value is different from present value.</span>
<span class="term-fg32">+    &#47;&#47;&#47; If it is different we add it to changeset.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; If Account was destroyed we ignore original value and compare present state with</span>
<span class="term-fg32">+    &#47;&#47;&#47; [`U256::ZERO`].</span>
<span class="term-fg32">+    pub storage: StorageWithOriginalValues,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account status.</span>
<span class="term-fg32">+    pub status: AccountStatus,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(BundleAccount, &amp;ScrollPostExecutionContext)&gt; for ScrollBundleAccount {</span>
<span class="term-fg32">+    fn from((account, context): (BundleAccount, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        let info = account.info.map(|info| (info, context).into());</span>
<span class="term-fg32">+        let original_info = account.original_info.map(|info| (info, context).into());</span>
<span class="term-fg32">+        Self { info, original_info, storage: account.storage, status: account.status }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollBundleAccount {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates a [`ScrollBundleAccount`].</span>
<span class="term-fg32">+    pub const fn new(</span>
<span class="term-fg32">+        original_info: Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+        present_info: Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+        storage: StorageWithOriginalValues,</span>
<span class="term-fg32">+        status: AccountStatus,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        Self { info: present_info, original_info, storage, status }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; The approximate size of changes needed to store this account.</span>
<span class="term-fg32">+    &#47;&#47;&#47; `1 + storage_len`</span>
<span class="term-fg32">+    pub fn size_hint(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        1 + self.storage.len()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return storage slot if it exists.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; In case we know that account is newly created or destroyed, return `Some(U256::ZERO)`</span>
<span class="term-fg32">+    pub fn storage_slot(&amp;self, slot: U256) -&gt; Option&lt;U256&gt; {</span>
<span class="term-fg32">+        let slot = self.storage.get(&amp;slot).map(|s| s.present_value);</span>
<span class="term-fg32">+        if slot.is_some() {</span>
<span class="term-fg32">+            slot</span>
<span class="term-fg32">+        } else if self.status.is_storage_known() {</span>
<span class="term-fg32">+            Some(U256::ZERO)</span>
<span class="term-fg32">+        } else {</span>
<span class="term-fg32">+            None</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Fetch account info if it exists.</span>
<span class="term-fg32">+    pub fn account_info(&amp;self) -&gt; Option&lt;ScrollAccountInfo&gt; {</span>
<span class="term-fg32">+        self.info.clone()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Was this account destroyed.</span>
<span class="term-fg32">+    pub fn was_destroyed(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.status.was_destroyed()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return true of account info was changed.</span>
<span class="term-fg32">+    pub fn is_info_changed(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.info != self.original_info</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return true if contract was changed</span>
<span class="term-fg32">+    pub fn is_contract_changed(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.info.as_ref().map(|a| a.code_hash) != self.original_info.as_ref().map(|a| a.code_hash)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Revert account to previous state and return true if account can be removed.</span>
<span class="term-fg32">+    pub fn revert(&amp;mut self, revert: ScrollAccountRevert) -&gt; bool {</span>
<span class="term-fg32">+        self.status = revert.previous_status;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        match revert.account {</span>
<span class="term-fg32">+            ScrollAccountInfoRevert::DoNothing =&gt; (),</span>
<span class="term-fg32">+            ScrollAccountInfoRevert::DeleteIt =&gt; {</span>
<span class="term-fg32">+                self.info = None;</span>
<span class="term-fg32">+                if self.original_info.is_none() {</span>
<span class="term-fg32">+                    self.storage = HashMap::default();</span>
<span class="term-fg32">+                    return true;</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                &#47;&#47; set all storage to zero but preserve original values.</span>
<span class="term-fg32">+                self.storage.iter_mut().for_each(|(_, v)| {</span>
<span class="term-fg32">+                    v.present_value = U256::ZERO;</span>
<span class="term-fg32">+                });</span>
<span class="term-fg32">+                return false;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            ScrollAccountInfoRevert::RevertTo(info) =&gt; self.info = Some(info),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        &#47;&#47; revert storage</span>
<span class="term-fg32">+        for (key, slot) in revert.storage {</span>
<span class="term-fg32">+            match slot {</span>
<span class="term-fg32">+                RevertToSlot::Some(value) =&gt; {</span>
<span class="term-fg32">+                    &#47;&#47; Don&#39;t overwrite original values if present</span>
<span class="term-fg32">+                    &#47;&#47; if storage is not present set original value as current value.</span>
<span class="term-fg32">+                    self.storage</span>
<span class="term-fg32">+                        .entry(key)</span>
<span class="term-fg32">+                        .or_insert_with(|| StorageSlot::new(value))</span>
<span class="term-fg32">+                        .present_value = value;</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                RevertToSlot::Destroyed =&gt; {</span>
<span class="term-fg32">+                    &#47;&#47; if it was destroyed this means that storage was created and we need to remove</span>
<span class="term-fg32">+                    &#47;&#47; it.</span>
<span class="term-fg32">+                    self.storage.remove(&amp;key);</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        false</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-665e2db2f8e69e1af68b5a8e" role="button"
                       aria-expanded="false" aria-controls="id-665e2db2f8e69e1af68b5a8e">
                        <code>crates/scroll/revm/src/states/changes.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/revm/src/states/changes.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+67</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-665e2db2f8e69e1af68b5a8e"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;changes.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;changes.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..5343d47c9e03b1be347c872d2cc38ea67a1c5972</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;changes.rs</span>
<span class="term-fg36">@@ -0,0 +1,67 @@</span>
<span class="term-fg32">+use crate::states::ScrollAccountInfo;</span>
<span class="term-fg32">+use reth_scroll_primitives::ScrollPostExecutionContext;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::states::{PlainStateReverts, PlainStorageChangeset, PlainStorageRevert, StateChangeset},</span>
<span class="term-fg32">+    primitives::{Address, Bytecode, B256},</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy equivalent of the [`StateChangeset`] to accommodate for the [`ScrollAccountInfo`].</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct ScrollStateChangeset {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of **not** sorted accounts information.</span>
<span class="term-fg32">+    pub accounts: Vec&lt;(Address, Option&lt;ScrollAccountInfo&gt;)&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of **not** sorted storage.</span>
<span class="term-fg32">+    pub storage: Vec&lt;PlainStorageChangeset&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of contracts by bytecode hash. **not** sorted.</span>
<span class="term-fg32">+    pub contracts: Vec&lt;(B256, Bytecode)&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(StateChangeset, &amp;ScrollPostExecutionContext)&gt; for ScrollStateChangeset {</span>
<span class="term-fg32">+    fn from((changeset, context): (StateChangeset, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            accounts: changeset</span>
<span class="term-fg32">+                .accounts</span>
<span class="term-fg32">+                .into_iter()</span>
<span class="term-fg32">+                .map(|(add, acc)| (add, acc.map(|a| (a, context).into())))</span>
<span class="term-fg32">+                .collect(),</span>
<span class="term-fg32">+            storage: changeset.storage,</span>
<span class="term-fg32">+            contracts: changeset.contracts,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy of the [`PlainStateReverts`] to accommodate for [`ScrollAccountInfo`].</span>
<span class="term-fg32">+#[derive(Clone, Debug, Default)]</span>
<span class="term-fg32">+pub struct ScrollPlainStateReverts {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of account with removed contracts bytecode</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Note: If [`ScrollAccountInfo`] is None means that account needs to be removed.</span>
<span class="term-fg32">+    pub accounts: Vec&lt;Vec&lt;(Address, Option&lt;ScrollAccountInfo&gt;)&gt;&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of storage with its address.</span>
<span class="term-fg32">+    pub storage: Vec&lt;Vec&lt;PlainStorageRevert&gt;&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(PlainStateReverts, &amp;ScrollPostExecutionContext)&gt; for ScrollPlainStateReverts {</span>
<span class="term-fg32">+    fn from((reverts, context): (PlainStateReverts, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            accounts: reverts</span>
<span class="term-fg32">+                .accounts</span>
<span class="term-fg32">+                .into_iter()</span>
<span class="term-fg32">+                .map(|accounts| {</span>
<span class="term-fg32">+                    accounts</span>
<span class="term-fg32">+                        .into_iter()</span>
<span class="term-fg32">+                        .map(|(add, acc)| (add, acc.map(|a| (a, context).into())))</span>
<span class="term-fg32">+                        .collect()</span>
<span class="term-fg32">+                })</span>
<span class="term-fg32">+                .collect(),</span>
<span class="term-fg32">+            storage: reverts.storage,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollPlainStateReverts {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Constructs new [`ScrollPlainStateReverts`] with pre-allocated capacity.</span>
<span class="term-fg32">+    pub fn with_capacity(capacity: usize) -&gt; Self {</span>
<span class="term-fg32">+        Self { accounts: Vec::with_capacity(capacity), storage: Vec::with_capacity(capacity) }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-db68e67367fd24c23336fc10" role="button"
                       aria-expanded="false" aria-controls="id-db68e67367fd24c23336fc10">
                        <code>crates/scroll/revm/src/states/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/revm/src/states/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+16</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-db68e67367fd24c23336fc10"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;mod.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;mod.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..c6f9e969f8052c7920530aa1a2babd1aead61a63</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;mod.rs</span>
<span class="term-fg36">@@ -0,0 +1,16 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll `revm` states types redefinitions.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use account_info::ScrollAccountInfo;</span>
<span class="term-fg32">+mod account_info;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use bundle::{ScrollBundleBuilder, ScrollBundleState};</span>
<span class="term-fg32">+mod bundle;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use bundle_account::ScrollBundleAccount;</span>
<span class="term-fg32">+mod bundle_account;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use changes::{ScrollPlainStateReverts, ScrollStateChangeset};</span>
<span class="term-fg32">+mod changes;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use reverts::{ScrollAccountInfoRevert, ScrollAccountRevert, ScrollReverts};</span>
<span class="term-fg32">+mod reverts;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-29efb7625d248572ea747d4c" role="button"
                       aria-expanded="false" aria-controls="id-29efb7625d248572ea747d4c">
                        <code>crates/scroll/revm/src/states/reverts.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/revm/src/states/reverts.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+153</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-29efb7625d248572ea747d4c"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;reverts.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;reverts.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..e10034000d8bb3e8cb724f96e93438c527b6236a</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;reverts.rs</span>
<span class="term-fg36">@@ -0,0 +1,153 @@</span>
<span class="term-fg32">+use crate::states::{changes::ScrollPlainStateReverts, ScrollAccountInfo};</span>
<span class="term-fg32">+use reth_scroll_primitives::ScrollPostExecutionContext;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::{</span>
<span class="term-fg32">+        states::{reverts::AccountInfoRevert, PlainStorageRevert},</span>
<span class="term-fg32">+        AccountRevert, AccountStatus, RevertToSlot,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    primitives::{map::HashMap, Address, U256},</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use std::ops::{Deref, DerefMut};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy of a [`revm::db::states::reverts::Reverts`] compatible with the</span>
<span class="term-fg32">+&#47;&#47;&#47; [`crate::states::ScrollBundleState`].</span>
<span class="term-fg32">+#[derive(Clone, Debug, Default, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollReverts(Vec&lt;Vec&lt;(Address, ScrollAccountRevert)&gt;&gt;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Deref for ScrollReverts {</span>
<span class="term-fg32">+    type Target = Vec&lt;Vec&lt;(Address, ScrollAccountRevert)&gt;&gt;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn deref(&amp;self) -&gt; &amp;Self::Target {</span>
<span class="term-fg32">+        &amp;self.0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl DerefMut for ScrollReverts {</span>
<span class="term-fg32">+    fn deref_mut(&amp;mut self) -&gt; &amp;mut Self::Target {</span>
<span class="term-fg32">+        &amp;mut self.0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollReverts {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create new reverts</span>
<span class="term-fg32">+    pub const fn new(reverts: Vec&lt;Vec&lt;(Address, ScrollAccountRevert)&gt;&gt;) -&gt; Self {</span>
<span class="term-fg32">+        Self(reverts)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Extend reverts with other reverts.</span>
<span class="term-fg32">+    pub fn extend(&amp;mut self, other: Self) {</span>
<span class="term-fg32">+        self.0.extend(other.0);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Sort account inside transition by their address.</span>
<span class="term-fg32">+    pub fn sort(&amp;mut self) {</span>
<span class="term-fg32">+        for revert in &amp;mut self.0 {</span>
<span class="term-fg32">+            revert.sort_by_key(|(address, _)| *address);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Generate a [`ScrollPlainStateReverts`].</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Note that account are sorted by address.</span>
<span class="term-fg32">+    pub fn to_plain_state_reverts(&amp;self) -&gt; ScrollPlainStateReverts {</span>
<span class="term-fg32">+        let mut state_reverts = ScrollPlainStateReverts::with_capacity(self.0.len());</span>
<span class="term-fg32">+        for reverts in &amp;self.0 {</span>
<span class="term-fg32">+            &#47;&#47; pessimistically pre-allocate assuming _all_ accounts changed.</span>
<span class="term-fg32">+            let mut accounts = Vec::with_capacity(reverts.len());</span>
<span class="term-fg32">+            let mut storage = Vec::with_capacity(reverts.len());</span>
<span class="term-fg32">+            for (address, revert_account) in reverts {</span>
<span class="term-fg32">+                match &amp;revert_account.account {</span>
<span class="term-fg32">+                    ScrollAccountInfoRevert::RevertTo(acc) =&gt; {</span>
<span class="term-fg32">+                        &#47;&#47; cloning is cheap, because account info has 3 small</span>
<span class="term-fg32">+                        &#47;&#47; fields and a Bytes</span>
<span class="term-fg32">+                        accounts.push((*address, Some(acc.clone())))</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                    ScrollAccountInfoRevert::DeleteIt =&gt; accounts.push((*address, None)),</span>
<span class="term-fg32">+                    ScrollAccountInfoRevert::DoNothing =&gt; (),</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                if revert_account.wipe_storage || !revert_account.storage.is_empty() {</span>
<span class="term-fg32">+                    storage.push(PlainStorageRevert {</span>
<span class="term-fg32">+                        address: *address,</span>
<span class="term-fg32">+                        wiped: revert_account.wipe_storage,</span>
<span class="term-fg32">+                        storage_revert: revert_account</span>
<span class="term-fg32">+                            .storage</span>
<span class="term-fg32">+                            .iter()</span>
<span class="term-fg32">+                            .map(|(k, v)| (*k, *v))</span>
<span class="term-fg32">+                            .collect::&lt;Vec&lt;_&gt;&gt;(),</span>
<span class="term-fg32">+                    });</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            state_reverts.accounts.push(accounts);</span>
<span class="term-fg32">+            state_reverts.storage.push(storage);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        state_reverts</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy of a [`AccountRevert`] compatible with  [`ScrollReverts`].</span>
<span class="term-fg32">+#[derive(Clone, Default, Debug, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollAccountRevert {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account info revert</span>
<span class="term-fg32">+    pub account: ScrollAccountInfoRevert,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Storage revert</span>
<span class="term-fg32">+    pub storage: HashMap&lt;U256, RevertToSlot&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Previous status</span>
<span class="term-fg32">+    pub previous_status: AccountStatus,</span>
<span class="term-fg32">+    &#47;&#47;&#47; If true wipes storage</span>
<span class="term-fg32">+    pub wipe_storage: bool,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(AccountRevert, &amp;ScrollPostExecutionContext)&gt; for ScrollAccountRevert {</span>
<span class="term-fg32">+    fn from((account, context): (AccountRevert, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            account: (account.account, context).into(),</span>
<span class="term-fg32">+            storage: account.storage,</span>
<span class="term-fg32">+            previous_status: account.previous_status,</span>
<span class="term-fg32">+            wipe_storage: account.wipe_storage,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollAccountRevert {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The approximate size of changes needed to store this account revert.</span>
<span class="term-fg32">+    &#47;&#47;&#47; `1 + storage_reverts_len`</span>
<span class="term-fg32">+    pub fn size_hint(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        1 + self.storage.len()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns `true` if there is nothing to revert,</span>
<span class="term-fg32">+    &#47;&#47;&#47; by checking that:</span>
<span class="term-fg32">+    &#47;&#47;&#47; * both account info and storage have been left untouched</span>
<span class="term-fg32">+    &#47;&#47;&#47; * we don&#39;t need to wipe storage</span>
<span class="term-fg32">+    pub fn is_empty(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.account == ScrollAccountInfoRevert::DoNothing &amp;&amp;</span>
<span class="term-fg32">+            self.storage.is_empty() &amp;&amp;</span>
<span class="term-fg32">+            !self.wipe_storage</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy of a [`AccountInfoRevert`] compatible with the</span>
<span class="term-fg32">+&#47;&#47;&#47; [`ScrollAccountInfo`].</span>
<span class="term-fg32">+#[derive(Clone, Default, Debug, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub enum ScrollAccountInfoRevert {</span>
<span class="term-fg32">+    #[default]</span>
<span class="term-fg32">+    &#47;&#47;&#47; Nothing changed</span>
<span class="term-fg32">+    DoNothing,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account was created and on revert we need to remove it with all storage.</span>
<span class="term-fg32">+    DeleteIt,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account was changed and on revert we need to put old state.</span>
<span class="term-fg32">+    RevertTo(ScrollAccountInfo),</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(AccountInfoRevert, &amp;ScrollPostExecutionContext)&gt; for ScrollAccountInfoRevert {</span>
<span class="term-fg32">+    fn from((account, context): (AccountInfoRevert, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        match account {</span>
<span class="term-fg32">+            AccountInfoRevert::DoNothing =&gt; Self::DoNothing,</span>
<span class="term-fg32">+            AccountInfoRevert::DeleteIt =&gt; Self::DeleteIt,</span>
<span class="term-fg32">+            AccountInfoRevert::RevertTo(account) =&gt; Self::RevertTo((account, context).into()),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-51b7b9d96c7252ca16399471" role="button"
                       aria-expanded="false" aria-controls="id-51b7b9d96c7252ca16399471">
                        <code>crates/scroll/revm/src/test_utils.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/revm/src/test_utils.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+97</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-51b7b9d96c7252ca16399471"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;test_utils.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;test_utils.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..f6538100dd87cc83df74cd33e8abac6753658e21</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;test_utils.rs</span>
<span class="term-fg36">@@ -0,0 +1,97 @@</span>
<span class="term-fg32">+use crate::{</span>
<span class="term-fg32">+    shared::AccountInfo,</span>
<span class="term-fg32">+    states::{</span>
<span class="term-fg32">+        ScrollAccountInfoRevert, ScrollAccountRevert, ScrollPlainStateReverts, ScrollStateChangeset,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    ScrollAccountInfo,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_scroll_primitives::{hash_code, POSEIDON_EMPTY};</span>
<span class="term-fg32">+use revm::db::{</span>
<span class="term-fg32">+    states::{reverts::AccountInfoRevert, PlainStateReverts, StateChangeset},</span>
<span class="term-fg32">+    AccountRevert,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+impl From&lt;StateChangeset&gt; for ScrollStateChangeset {</span>
<span class="term-fg32">+    fn from(changeset: StateChangeset) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            accounts: changeset</span>
<span class="term-fg32">+                .accounts</span>
<span class="term-fg32">+                .into_iter()</span>
<span class="term-fg32">+                .map(|(add, acc)| (add, acc.map(Into::into)))</span>
<span class="term-fg32">+                .collect(),</span>
<span class="term-fg32">+            storage: changeset.storage,</span>
<span class="term-fg32">+            contracts: changeset.contracts,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+impl From&lt;PlainStateReverts&gt; for ScrollPlainStateReverts {</span>
<span class="term-fg32">+    fn from(reverts: PlainStateReverts) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            accounts: reverts</span>
<span class="term-fg32">+                .accounts</span>
<span class="term-fg32">+                .into_iter()</span>
<span class="term-fg32">+                .map(|accounts| {</span>
<span class="term-fg32">+                    accounts.into_iter().map(|(add, acc)| (add, acc.map(Into::into))).collect()</span>
<span class="term-fg32">+                })</span>
<span class="term-fg32">+                .collect(),</span>
<span class="term-fg32">+            storage: reverts.storage,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+impl From&lt;AccountInfoRevert&gt; for ScrollAccountInfoRevert {</span>
<span class="term-fg32">+    fn from(account: AccountInfoRevert) -&gt; Self {</span>
<span class="term-fg32">+        match account {</span>
<span class="term-fg32">+            AccountInfoRevert::DoNothing =&gt; Self::DoNothing,</span>
<span class="term-fg32">+            AccountInfoRevert::DeleteIt =&gt; Self::DeleteIt,</span>
<span class="term-fg32">+            AccountInfoRevert::RevertTo(account) =&gt; Self::RevertTo(account.into()),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+impl From&lt;AccountRevert&gt; for ScrollAccountRevert {</span>
<span class="term-fg32">+    fn from(account: AccountRevert) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            account: account.account.into(),</span>
<span class="term-fg32">+            storage: account.storage,</span>
<span class="term-fg32">+            previous_status: account.previous_status,</span>
<span class="term-fg32">+            wipe_storage: account.wipe_storage,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+impl From&lt;AccountInfo&gt; for ScrollAccountInfo {</span>
<span class="term-fg32">+    fn from(info: AccountInfo) -&gt; Self {</span>
<span class="term-fg32">+        let (code_size, poseidon_code_hash) = info</span>
<span class="term-fg32">+            .code</span>
<span class="term-fg32">+            .as_ref()</span>
<span class="term-fg32">+            .map(|code| (code.len() as u64, hash_code(code.original_byte_slice())))</span>
<span class="term-fg32">+            .unwrap_or((0, POSEIDON_EMPTY));</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: info.balance,</span>
<span class="term-fg32">+            nonce: info.nonce,</span>
<span class="term-fg32">+            code_hash: info.code_hash,</span>
<span class="term-fg32">+            code: info.code,</span>
<span class="term-fg32">+            code_size,</span>
<span class="term-fg32">+            poseidon_code_hash,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion causes a loss of information.</span>
<span class="term-fg32">+impl From&lt;ScrollAccountInfo&gt; for AccountInfo {</span>
<span class="term-fg32">+    fn from(info: ScrollAccountInfo) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: info.balance,</span>
<span class="term-fg32">+            nonce: info.nonce,</span>
<span class="term-fg32">+            code_hash: info.code_hash,</span>
<span class="term-fg32">+            code: info.code,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cb2f58a6da733bc735851ca9" role="button"
                       aria-expanded="false" aria-controls="id-cb2f58a6da733bc735851ca9">
                        <code>crates/scroll/storage/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/storage/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+36</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cb2f58a6da733bc735851ca9"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;storage&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;storage&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..9c5cc3744d5578ac6211f386bc896d0d1ddc6405</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;storage&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,36 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-storage&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# alloy</span>
<span class="term-fg32">+alloy-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-revm.workspace = true</span>
<span class="term-fg32">+reth-storage-errors.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+reth-scroll-revm.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dev-dependencies]</span>
<span class="term-fg32">+eyre.workspace = true</span>
<span class="term-fg32">+reth-codecs = { workspace = true, features = [&quot;test-utils&quot;] }</span>
<span class="term-fg32">+reth-primitives-traits.workspace = true</span>
<span class="term-fg32">+reth-revm = { workspace = true, features = [&quot;test-utils&quot;] }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d1b3eebea9da50a93a1b5993" role="button"
                       aria-expanded="false" aria-controls="id-d1b3eebea9da50a93a1b5993">
                        <code>crates/scroll/storage/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/scroll/storage/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+185</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d1b3eebea9da50a93a1b5993"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;storage&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;storage&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..1810369a8096676f8920c7b6ac00660477ace047</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;storage&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,185 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll storage implementation.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![cfg_attr(all(not(test), feature = &quot;scroll&quot;), warn(unused_crate_dependencies))]</span>
<span class="term-fg32">+&#47;&#47; The `scroll` feature must be enabled to use this crate.</span>
<span class="term-fg32">+#![cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use alloy_primitives::{Address, B256, U256};</span>
<span class="term-fg32">+use reth_revm::{database::EvmStateProvider, primitives::Bytecode, Database, DatabaseRef};</span>
<span class="term-fg32">+use reth_scroll_primitives::{AccountExtension, ScrollPostExecutionContext};</span>
<span class="term-fg32">+use reth_scroll_revm::shared::AccountInfo;</span>
<span class="term-fg32">+use reth_storage_errors::provider::ProviderError;</span>
<span class="term-fg32">+use std::ops::{Deref, DerefMut};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A similar construct as `StateProviderDatabase` which captures additional Scroll context for</span>
<span class="term-fg32">+&#47;&#47;&#47; touched accounts during execution.</span>
<span class="term-fg32">+#[derive(Clone, Debug)]</span>
<span class="term-fg32">+pub struct ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Scroll post execution context.</span>
<span class="term-fg32">+    pub post_execution_context: ScrollPostExecutionContext,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The database.</span>
<span class="term-fg32">+    pub db: DB,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB&gt; Deref for ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    type Target = DB;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn deref(&amp;self) -&gt; &amp;Self::Target {</span>
<span class="term-fg32">+        &amp;self.db</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB&gt; DerefMut for ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    fn deref_mut(&amp;mut self) -&gt; &amp;mut Self::Target {</span>
<span class="term-fg32">+        &amp;mut self.db</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB&gt; ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates a [`ScrollStateProviderDatabase`] from the provided DB.</span>
<span class="term-fg32">+    pub fn new(db: DB) -&gt; Self {</span>
<span class="term-fg32">+        Self { db, post_execution_context: Default::default() }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Consume [`ScrollStateProviderDatabase`] and return inner [`EvmStateProvider`].</span>
<span class="term-fg32">+    pub fn into_inner(self) -&gt; DB {</span>
<span class="term-fg32">+        self.db</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; Database for ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    type Error = ProviderError;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Retrieves basic account information for a given address. Caches the Scroll account extension</span>
<span class="term-fg32">+    &#47;&#47;&#47; for the touched account if it has bytecode.</span>
<span class="term-fg32">+    fn basic(&amp;mut self, address: Address) -&gt; Result&lt;Option&lt;AccountInfo&gt;, Self::Error&gt; {</span>
<span class="term-fg32">+        let Some(account) = self.db.basic_account(address)? else { return Ok(None) };</span>
<span class="term-fg32">+        let Some(code_hash) = account.bytecode_hash else { return Ok(Some(account.into())) };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        if let Some(AccountExtension { code_size, poseidon_code_hash: Some(hash) }) =</span>
<span class="term-fg32">+            account.account_extension</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+            self.post_execution_context.entry(code_hash).or_insert((code_size, hash));</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(Some(account.into()))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn code_by_hash(&amp;mut self, code_hash: B256) -&gt; Result&lt;Bytecode, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.bytecode_by_hash(code_hash)?.unwrap_or_default().0)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn storage(&amp;mut self, address: Address, index: U256) -&gt; Result&lt;U256, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.storage(address, B256::new(index.to_be_bytes()))?.unwrap_or_default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn block_hash(&amp;mut self, number: u64) -&gt; Result&lt;B256, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.block_hash(number)?.unwrap_or_default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; DatabaseRef for ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    type Error = ProviderError;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn basic_ref(&amp;self, address: Address) -&gt; Result&lt;Option&lt;AccountInfo&gt;, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.basic_account(address)?.map(Into::into))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn code_by_hash_ref(&amp;self, code_hash: B256) -&gt; Result&lt;Bytecode, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.bytecode_by_hash(code_hash)?.unwrap_or_default().0)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn storage_ref(&amp;self, address: Address, index: U256) -&gt; Result&lt;U256, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.storage(address, B256::new(index.to_be_bytes()))?.unwrap_or_default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn block_hash_ref(&amp;self, number: u64) -&gt; Result&lt;B256, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.block_hash(number)?.unwrap_or_default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(test)]</span>
<span class="term-fg32">+mod tests {</span>
<span class="term-fg32">+    use crate::ScrollStateProviderDatabase;</span>
<span class="term-fg32">+    use alloy_primitives::{keccak256, Address, Bytes, U256};</span>
<span class="term-fg32">+    use reth_codecs::{test_utils::UnusedBits, validate_bitflag_backwards_compat};</span>
<span class="term-fg32">+    use reth_primitives_traits::Account;</span>
<span class="term-fg32">+    use reth_revm::{test_utils::StateProviderTest, Database};</span>
<span class="term-fg32">+    use reth_scroll_primitives::{hash_code, AccountExtension};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_ensure_account_backwards_compatibility() {</span>
<span class="term-fg32">+        &#47;&#47; See `reth-codecs&#47;src&#47;test-utils` for details.</span>
<span class="term-fg32">+        assert_eq!(Account::bitflag_encoded_bytes(), 2);</span>
<span class="term-fg32">+        assert_eq!(AccountExtension::bitflag_encoded_bytes(), 1);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; In case of failure, refer to the documentation of the</span>
<span class="term-fg32">+        &#47;&#47; [`validate_bitflag_backwards_compat`] macro for detailed instructions on handling</span>
<span class="term-fg32">+        &#47;&#47; it.</span>
<span class="term-fg32">+        validate_bitflag_backwards_compat!(Account, UnusedBits::NotZero);</span>
<span class="term-fg32">+        validate_bitflag_backwards_compat!(AccountExtension, UnusedBits::NotZero);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_scroll_post_execution_context() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        let mut db = StateProviderTest::default();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; insert an eoa in the db</span>
<span class="term-fg32">+        let eoa_address = Address::random();</span>
<span class="term-fg32">+        let eoa = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::MAX,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            account_extension: Some(AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        db.insert_account(eoa_address, eoa, None, Default::default());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; insert a contract account in the db</span>
<span class="term-fg32">+        let contract_address = Address::random();</span>
<span class="term-fg32">+        let bytecode = Bytes::copy_from_slice(&amp;[0x0, 0x1, 0x2, 0x3, 0x4, 0x5]);</span>
<span class="term-fg32">+        let bytecode_hash = keccak256(&amp;bytecode);</span>
<span class="term-fg32">+        let contract = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::MAX,</span>
<span class="term-fg32">+            bytecode_hash: Some(bytecode_hash),</span>
<span class="term-fg32">+            account_extension: Some(AccountExtension::from_bytecode(&amp;bytecode)),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        db.insert_account(contract_address, contract, Some(bytecode.clone()), Default::default());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; insert an empty contract account in the db</span>
<span class="term-fg32">+        let empty_contract_address = Address::random();</span>
<span class="term-fg32">+        let empty_bytecode = Bytes::copy_from_slice(&amp;[]);</span>
<span class="term-fg32">+        let empty_contract = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::MAX,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            account_extension: Some(AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        db.insert_account(</span>
<span class="term-fg32">+            empty_contract_address,</span>
<span class="term-fg32">+            empty_contract,</span>
<span class="term-fg32">+            Some(empty_bytecode),</span>
<span class="term-fg32">+            Default::default(),</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut provider = ScrollStateProviderDatabase::new(db);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check eoa is in db</span>
<span class="term-fg32">+        let _ = provider.basic(eoa_address)?.unwrap();</span>
<span class="term-fg32">+        &#47;&#47; check contract is in db</span>
<span class="term-fg32">+        let _ = provider.basic(contract_address)?.unwrap();</span>
<span class="term-fg32">+        &#47;&#47; check empty contract is in db</span>
<span class="term-fg32">+        let _ = provider.basic(empty_contract_address)?.unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check provider context only contains contract</span>
<span class="term-fg32">+        let post_execution_context = provider.post_execution_context;</span>
<span class="term-fg32">+        assert_eq!(post_execution_context.len(), 1);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check post execution context is correct for contract</span>
<span class="term-fg32">+        let (code_size, poseidon_code_hash) = post_execution_context.get(&amp;bytecode_hash).unwrap();</span>
<span class="term-fg32">+        assert_eq!(*code_size, 6);</span>
<span class="term-fg32">+        assert_eq!(*poseidon_code_hash, hash_code(&amp;bytecode));</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-fcd2da3b7aa1ac4f05d04f63"role="button" aria-expanded="false" aria-controls="id-fcd2da3b7aa1ac4f05d04f63">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/ethereum</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+60</span></div>
                    <div class="text-start"><span class="text-danger">-8</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-fcd2da3b7aa1ac4f05d04f63">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ebd2ffb73a88ef08e7f04bfc" role="button"
                       aria-expanded="false" aria-controls="id-ebd2ffb73a88ef08e7f04bfc">
                        <code>crates/ethereum/evm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/evm/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/ethereum/evm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+9</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ebd2ffb73a88ef08e7f04bfc"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;evm&#47;Cargo.toml scroll-reth&#47;crates&#47;ethereum&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">index 17e870e61113458c1bc459d7e306e85cbe39aafa..52555b23abe36bf8a0b5ad5459962d8b7a9891c8 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;evm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -23,6 +23,9 @@</span>
 # Ethereum
 revm-primitives.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+</span>
 # Alloy
 alloy-primitives.workspace = true
 alloy-eips.workspace = true
<span class="term-fg36">@@ -38,6 +41,8 @@</span> reth-execution-types.workspace = true
 secp256k1.workspace = true
 serde_json.workspace = true
 alloy-genesis.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
&nbsp;
 [features]
 default = [&quot;std&quot;]
<span class="term-fg36">@@ -52,3 +57,7 @@</span> 	&quot;alloy-primitives&#47;std&quot;,
 	&quot;revm-primitives&#47;std&quot;,
 	&quot;secp256k1&#47;std&quot;
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-testing-utils&#47;scroll&quot;,</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2fc8506f58396296ce3fbe3d" role="button"
                       aria-expanded="false" aria-controls="id-2fc8506f58396296ce3fbe3d">
                        <code>crates/ethereum/evm/src/execute.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/evm/src/execute.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/ethereum/evm/src/execute.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+34</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2fc8506f58396296ce3fbe3d"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;evm&#47;src&#47;execute.rs scroll-reth&#47;crates&#47;ethereum&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">index 8642df89698d84fa5d96c7b051574871709334ec..e22cf55e5c2388a4bd4290b6ebd0c78b9494b582 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg36">@@ -21,7 +21,8 @@</span>     system_calls::{OnStateHook, SystemCaller},
     ConfigureEvm, TxEnvOverrides,
 };
 use reth_primitives::{BlockWithSenders, Receipt};
<span class="term-fg31">-use reth_revm::db::State;</span>
<span class="term-fg32">+use reth_revm::db::{BundleState, State};</span>
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use revm_primitives::{
     db::{Database, DatabaseCommit},
     EnvWithHandlerCfg, ResultAndState, U256,
<span class="term-fg36">@@ -60,12 +61,15 @@</span> where
     EvmConfig:
         Clone + Unpin + Sync + Send + &#39;static + ConfigureEvm&lt;Header = alloy_consensus::Header&gt;,
 {
<span class="term-fg31">-    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        EthExecutionStrategy&lt;DB, EvmConfig&gt;;</span>
<span class="term-fg32">+    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = EthExecutionStrategy&lt;DB, EvmConfig&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn create_strategy&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Strategy&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         let state =
             State::builder().with_database(db).with_bundle_update().without_state_clear().build();
<span class="term-fg36">@@ -125,6 +129,7 @@</span>
 impl&lt;DB, EvmConfig&gt; BlockExecutionStrategy&lt;DB&gt; for EthExecutionStrategy&lt;DB, EvmConfig&gt;
 where
     DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     EvmConfig: ConfigureEvm&lt;Header = alloy_consensus::Header&gt;,
 {
     type Error = BlockExecutionError;
<span class="term-fg36">@@ -334,6 +339,10 @@</span>         let beacon_root_contract_account = Account {
             balance: U256::ZERO,
             bytecode_hash: Some(keccak256(BEACON_ROOTS_CODE.clone())),
             nonce: 1,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;BEACON_ROOTS_CODE,</span>
<span class="term-fg32">+            )),</span>
         };
&nbsp;
         db.insert_account(
<span class="term-fg36">@@ -353,6 +362,10 @@</span>         let withdrawal_requests_contract_account = Account {
             nonce: 1,
             balance: U256::ZERO,
             bytecode_hash: Some(keccak256(WITHDRAWAL_REQUEST_PREDEPLOY_CODE.clone())),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;WITHDRAWAL_REQUEST_PREDEPLOY_CODE,</span>
<span class="term-fg32">+            )),</span>
         };
&nbsp;
         db.insert_account(
<span class="term-fg36">@@ -716,6 +729,10 @@</span>         let blockhashes_contract_account = Account {
             balance: U256::ZERO,
             bytecode_hash: Some(keccak256(HISTORY_STORAGE_CODE.clone())),
             nonce: 1,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;HISTORY_STORAGE_CODE,</span>
<span class="term-fg32">+            )),</span>
         };
&nbsp;
         db.insert_account(
<span class="term-fg36">@@ -1068,7 +1085,13 @@</span>         let sender_address = public_key_to_address(sender_key_pair.public_key());
&nbsp;
         db.insert_account(
             sender_address,
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(ETH_TO_WEI), bytecode_hash: None },</span>
<span class="term-fg32">+            Account {</span>
<span class="term-fg32">+                nonce: 1,</span>
<span class="term-fg32">+                balance: U256::from(ETH_TO_WEI),</span>
<span class="term-fg32">+                bytecode_hash: None,</span>
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+            },</span>
             None,
             HashMap::default(),
         );
<span class="term-fg36">@@ -1150,7 +1173,13 @@</span>
         &#47;&#47; Insert the sender account into the state with a nonce of 1 and a balance of 1 ETH in Wei
         db.insert_account(
             sender_address,
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(ETH_TO_WEI), bytecode_hash: None },</span>
<span class="term-fg32">+            Account {</span>
<span class="term-fg32">+                nonce: 1,</span>
<span class="term-fg32">+                balance: U256::from(ETH_TO_WEI),</span>
<span class="term-fg32">+                bytecode_hash: None,</span>
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+            },</span>
             None,
             HashMap::default(),
         );</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-865b17055e46605858d80698" role="button"
                       aria-expanded="false" aria-controls="id-865b17055e46605858d80698">
                        <code>crates/ethereum/node/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/node/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/ethereum/node/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-865b17055e46605858d80698"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;node&#47;Cargo.toml scroll-reth&#47;crates&#47;ethereum&#47;node&#47;Cargo.toml</span>
<span class="term-fg1">index e6f47483b5866cfddb01473e08b533607743d2a9..3058a6b056424a197f8bd45ad6cc87b82679515e 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;node&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;node&#47;Cargo.toml</span>
<span class="term-fg36">@@ -85,3 +85,4 @@</span>     &quot;reth-trie-db&#47;test-utils&quot;,
     &quot;revm&#47;test-utils&quot;,
     &quot;reth-evm&#47;test-utils&quot;,
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b5a60cb93eaf19447028a791" role="button"
                       aria-expanded="false" aria-controls="id-b5a60cb93eaf19447028a791">
                        <code>crates/ethereum/node/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/node/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/ethereum/node/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b5a60cb93eaf19447028a791"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;node&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;ethereum&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 421cee37fb038e54502311c6120840766f85e3da..e86240a7433415a4ac6c5d659e38806b0c9400e4 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -7,6 +7,9 @@</span>     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use reth_revm as _;
 use revm as _;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-997454a4e08a0d8597f0a06f" role="button"
                       aria-expanded="false" aria-controls="id-997454a4e08a0d8597f0a06f">
                        <code>crates/ethereum/node/tests/e2e/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/node/tests/e2e/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/ethereum/node/tests/e2e/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-997454a4e08a0d8597f0a06f"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;e2e&#47;main.rs scroll-reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg1">index 4ed8ac5fcb635b10b14775b983a9379be44a6795..3459db247654c4b711a52b2e42e86111125e5363 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg36">@@ -1,4 +1,7 @@</span>
 #![allow(missing_docs)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 mod blobs;
 mod dev;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f6074760a6370878579aeb8a" role="button"
                       aria-expanded="false" aria-controls="id-f6074760a6370878579aeb8a">
                        <code>crates/ethereum/node/tests/it/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/node/tests/it/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/ethereum/node/tests/it/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f6074760a6370878579aeb8a"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;it&#47;main.rs scroll-reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg1">index 0f85adda31d0847f57e5047648129f97e62cfbbc..18240081f1e4f9af277fe57029f36d4cd42f4353 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg36">@@ -1,4 +1,7 @@</span>
 #![allow(missing_docs)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 mod builder;
 mod exex;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9ed6f24c330f8a27df2024dc" role="button"
                       aria-expanded="false" aria-controls="id-9ed6f24c330f8a27df2024dc">
                        <code>crates/ethereum/payload/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/payload/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/ethereum/payload/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9ed6f24c330f8a27df2024dc"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;payload&#47;Cargo.toml scroll-reth&#47;crates&#47;ethereum&#47;payload&#47;Cargo.toml</span>
<span class="term-fg1">index 4e0880d1d153097f90fd0971908651c6acb10937..0a06e0f3d68296e9a56d349d7950f2bc2f5e8b26 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;payload&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;payload&#47;Cargo.toml</span>
<span class="term-fg36">@@ -25,7 +25,6 @@</span> reth-basic-payload-builder.workspace = true
 reth-evm.workspace = true
 reth-evm-ethereum.workspace = true
 reth-errors.workspace = true
<span class="term-fg31">-reth-trie.workspace = true</span>
 reth-chain-state.workspace = true
 reth-chainspec.workspace = true
&nbsp;
<span class="term-fg36">@@ -39,3 +38,6 @@</span> alloy-primitives.workspace = true
&nbsp;
 # misc
 tracing.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fc6f3714e71099d9aef84e2a" role="button"
                       aria-expanded="false" aria-controls="id-fc6f3714e71099d9aef84e2a">
                        <code>crates/ethereum/payload/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/payload/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/ethereum/payload/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fc6f3714e71099d9aef84e2a"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;payload&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;ethereum&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 43bb045048845f9f82a6b0f5547d5f15f46b79de..da1f47d66b0cde5f7cc7212944a6c787c6a9f071 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -8,6 +8,9 @@</span> )]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![allow(clippy::useless_let_if_seq)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_consensus::{Header, EMPTY_OMMER_ROOT_HASH};
 use alloy_eips::{eip4844::MAX_DATA_GAS_PER_BLOCK, eip7685::Requests, merge::BEACON_NONCE};
<span class="term-fg36">@@ -35,7 +38,6 @@</span> use reth_transaction_pool::{
     error::InvalidPoolTransactionError, noop::NoopTransactionPool, BestTransactions,
     BestTransactionsAttributes, TransactionPool, ValidPoolTransaction,
 };
<span class="term-fg31">-use reth_trie::HashedPostState;</span>
 use revm::{
     db::{states::bundle_state::BundleRetention, State},
     primitives::{
<span class="term-fg36">@@ -389,7 +391,7 @@</span>         execution_outcome.receipts_root_slow(block_number).expect(&quot;Number is in range&quot;);
     let logs_bloom = execution_outcome.block_logs_bloom(block_number).expect(&quot;Number is in range&quot;);
&nbsp;
     &#47;&#47; calculate the state root
<span class="term-fg31">-    let hashed_state = HashedPostState::from_bundle_state(&amp;execution_outcome.state().state);</span>
<span class="term-fg32">+    let hashed_state = db.database.db.hashed_post_state(execution_outcome.state());</span>
     let (state_root, trie_output) = {
         db.database.inner().state_root_with_updates(hashed_state.clone()).inspect_err(|err| {
             warn!(target: &quot;payload_builder&quot;,</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-a6ee76bba94bb540b1a9d4d2"role="button" aria-expanded="false" aria-controls="id-a6ee76bba94bb540b1a9d4d2">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/optimism</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+57</span></div>
                    <div class="text-start"><span class="text-danger">-27</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-a6ee76bba94bb540b1a9d4d2">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-00af610f4dd194e2b89f2781" role="button"
                       aria-expanded="false" aria-controls="id-00af610f4dd194e2b89f2781">
                        <code>crates/optimism/bin/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/bin/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/bin/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-00af610f4dd194e2b89f2781"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;bin&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;bin&#47;Cargo.toml</span>
<span class="term-fg1">index 45f4492e82b60cf492ff5ff5223a2fe3e0d13fe9..efbea77454cca22287f6a2f83a225e606f75e2d4 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;bin&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;bin&#47;Cargo.toml</span>
<span class="term-fg36">@@ -46,6 +46,7 @@</span> 	&quot;reth-optimism-payload-builder&#47;optimism&quot;,
 	&quot;reth-optimism-rpc&#47;optimism&quot;,
 	&quot;reth-provider&#47;optimism&quot;
 ]
<span class="term-fg32">+scroll = []</span>
&nbsp;
 dev = [
 	&quot;reth-optimism-cli&#47;dev&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-778b51ec0047944d8aad810d" role="button"
                       aria-expanded="false" aria-controls="id-778b51ec0047944d8aad810d">
                        <code>crates/optimism/bin/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/bin/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/bin/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-778b51ec0047944d8aad810d"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 21c28f7c5470f38893c52fa10198a0feed2323f7..b3e274e678f577e7f76827917b387f033c2011a7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -24,8 +24,9 @@</span>     html_favicon_url = &quot;https:&#47;&#47;avatars0.githubusercontent.com&#47;u&#47;97369466?s=256&quot;,
     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
<span class="term-fg31">-#![cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
&nbsp;
 &#47;&#47;&#47; Re-exported from `reth_optimism_cli`.
 pub mod cli {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9d5929b80f1c2b521d842c2f" role="button"
                       aria-expanded="false" aria-controls="id-9d5929b80f1c2b521d842c2f">
                        <code>crates/optimism/bin/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/bin/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/bin/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9d5929b80f1c2b521d842c2f"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;main.rs scroll-reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;main.rs</span>
<span class="term-fg1">index 6494298ba393b461323b9430d440a640cb1e0e61..4fb016b34757ec8d0cec23cefa495145c0b58804 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,6 +1,7 @@</span>
 #![allow(missing_docs, rustdoc::missing_crate_level_docs)]
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
<span class="term-fg31">-#![cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
&nbsp;
 use clap::Parser;
 use reth_node_builder::{engine_tree_config::TreeConfig, EngineNodeLauncher};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-260ef2d8936aefaa68a93ce4" role="button"
                       aria-expanded="false" aria-controls="id-260ef2d8936aefaa68a93ce4">
                        <code>crates/optimism/cli/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/cli/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/cli/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-260ef2d8936aefaa68a93ce4"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;cli&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;cli&#47;Cargo.toml</span>
<span class="term-fg1">index b61a4628f4d2b5abc96356d8414385deceef1d37..b13eac3b52ea749688a268a563ef17ef7f2d90e4 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;cli&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;cli&#47;Cargo.toml</span>
<span class="term-fg36">@@ -123,3 +123,4 @@</span> 	&quot;reth-execution-types&#47;serde&quot;,
 	&quot;reth-provider&#47;serde&quot;,
 	&quot;reth-optimism-primitives&#47;serde&quot;,
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d675ca266c64079ebf917c0a" role="button"
                       aria-expanded="false" aria-controls="id-d675ca266c64079ebf917c0a">
                        <code>crates/optimism/cli/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/cli/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/cli/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d675ca266c64079ebf917c0a"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;cli&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;cli&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 23eaa99b521330609777f97db7bdd0bab92857ee..900d4ddf4c9943083928def576acbb18c3ce24ef 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;cli&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;cli&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -7,8 +7,9 @@</span>     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(all(not(test), feature = &quot;optimism&quot;), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
<span class="term-fg31">-#![cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
&nbsp;
 &#47;&#47;&#47; Optimism chain specification parser.
 pub mod chainspec;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4f5205e099cc8c1169c393d1" role="button"
                       aria-expanded="false" aria-controls="id-4f5205e099cc8c1169c393d1">
                        <code>crates/optimism/consensus/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/consensus/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/consensus/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4f5205e099cc8c1169c393d1"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;consensus&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;consensus&#47;Cargo.toml</span>
<span class="term-fg1">index 0dffceaddca990215aa790a2fdeee46c5b370ea6..bfe2e3d52665579072d09180dd57a8c3f758d321 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;consensus&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;consensus&#47;Cargo.toml</span>
<span class="term-fg36">@@ -36,3 +36,4 @@</span> reth-optimism-chainspec.workspace = true
&nbsp;
 [features]
 optimism = [&quot;reth-primitives&#47;optimism&quot;]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4eff7ab68db5362d641d9005" role="button"
                       aria-expanded="false" aria-controls="id-4eff7ab68db5362d641d9005">
                        <code>crates/optimism/consensus/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/consensus/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/consensus/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4eff7ab68db5362d641d9005"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;consensus&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;consensus&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 69d943785821e5721fd72da5843904d3da511fa4..35c8d6a9d8fdac9122c59de1812ac61fdb733b36 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;consensus&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;consensus&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -6,8 +6,9 @@</span>     html_favicon_url = &quot;https:&#47;&#47;avatars0.githubusercontent.com&#47;u&#47;97369466?s=256&quot;,
     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
<span class="term-fg31">-#![cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
&nbsp;
 use alloy_consensus::{Header, EMPTY_OMMER_ROOT_HASH};
 use alloy_primitives::{B64, U256};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-95eccd4e02962a94f1288209" role="button"
                       aria-expanded="false" aria-controls="id-95eccd4e02962a94f1288209">
                        <code>crates/optimism/evm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/evm/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/evm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-95eccd4e02962a94f1288209"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;evm&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">index 807f224ca4b8ea23d95fe5334014ee9262822c70..901d9c31534ee83c48d7ad9175851b6429428915 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;evm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -33,6 +33,9 @@</span> reth-optimism-consensus.workspace = true
 reth-optimism-chainspec.workspace = true
 reth-optimism-forks.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+</span>
 # revm
 revm.workspace = true
 revm-primitives.workspace = true
<span class="term-fg36">@@ -70,3 +73,4 @@</span> 	&quot;reth-optimism-consensus&#47;optimism&quot;,
 	&quot;revm&#47;optimism&quot;,
 	&quot;revm-primitives&#47;optimism&quot;
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-76db8a4a6707d743f1204c87" role="button"
                       aria-expanded="false" aria-controls="id-76db8a4a6707d743f1204c87">
                        <code>crates/optimism/evm/src/execute.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/evm/src/execute.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/evm/src/execute.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-76db8a4a6707d743f1204c87"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;execute.rs scroll-reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">index 1c93d2b71d03aabaa302c8853a977856f2d10f98..8546b9867b3a09af336c94c25c9eb42e09516bbd 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg36">@@ -22,6 +22,8 @@</span> use reth_optimism_consensus::validate_block_post_execution;
 use reth_optimism_forks::OpHardfork;
 use reth_primitives::{BlockWithSenders, Receipt, TxType};
 use reth_revm::{Database, State};
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
<span class="term-fg32">+use revm::db::BundleState;</span>
 use revm_primitives::{db::DatabaseCommit, EnvWithHandlerCfg, ResultAndState, U256};
 use tracing::trace;
&nbsp;
<span class="term-fg36">@@ -53,12 +55,15 @@</span> where
     EvmConfig:
         Clone + Unpin + Sync + Send + &#39;static + ConfigureEvm&lt;Header = alloy_consensus::Header&gt;,
 {
<span class="term-fg31">-    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        OpExecutionStrategy&lt;DB, EvmConfig&gt;;</span>
<span class="term-fg32">+    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = OpExecutionStrategy&lt;DB, EvmConfig&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn create_strategy&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Strategy&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         let state =
             State::builder().with_database(db).with_bundle_update().without_state_clear().build();
<span class="term-fg36">@@ -112,6 +117,7 @@</span>
 impl&lt;DB, EvmConfig&gt; BlockExecutionStrategy&lt;DB&gt; for OpExecutionStrategy&lt;DB, EvmConfig&gt;
 where
     DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     EvmConfig: ConfigureEvm&lt;Header = alloy_consensus::Header&gt;,
 {
     type Error = BlockExecutionError;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1e9e05f446b902765cc8d4a5" role="button"
                       aria-expanded="false" aria-controls="id-1e9e05f446b902765cc8d4a5">
                        <code>crates/optimism/evm/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/evm/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/evm/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1e9e05f446b902765cc8d4a5"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 176864de6dc57829c3752646bac7a71394ba11f8..df56087e492c65b8044c570464e92ec3ef13da05 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -7,8 +7,9 @@</span>     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![cfg_attr(not(feature = &quot;std&quot;), no_std)]
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
<span class="term-fg31">-#![cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
&nbsp;
 extern crate alloc;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2abade80a322d68c76f7cc8c" role="button"
                       aria-expanded="false" aria-controls="id-2abade80a322d68c76f7cc8c">
                        <code>crates/optimism/node/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/node/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/node/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2abade80a322d68c76f7cc8c"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;node&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;node&#47;Cargo.toml</span>
<span class="term-fg1">index 5f100f0a28d1c7c409115538f7dc5beaa5d83b39..4c080d7d0e855473ea1f26e58912158940dcfc11 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;node&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;node&#47;Cargo.toml</span>
<span class="term-fg36">@@ -130,3 +130,4 @@</span> reth-codec = [
     &quot;reth-primitives&#47;reth-codec&quot;,
     &quot;reth-optimism-primitives&#47;reth-codec&quot;,
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a1ceb69e8074c729921ff319" role="button"
                       aria-expanded="false" aria-controls="id-a1ceb69e8074c729921ff319">
                        <code>crates/optimism/node/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/node/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/node/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a1ceb69e8074c729921ff319"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;node&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 7af0f3b8a722f3be89f2441ced4248d4587ea825..f228ae1fa2fdc1ee7541ca84805a5b99b2a885b3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -6,8 +6,9 @@</span>     html_favicon_url = &quot;https:&#47;&#47;avatars0.githubusercontent.com&#47;u&#47;97369466?s=256&quot;,
     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
<span class="term-fg31">-#![cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
&nbsp;
 &#47;&#47;&#47; CLI argument parsing for the optimism node.
 pub mod args;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-33a20336e4c69ab45583a5db" role="button"
                       aria-expanded="false" aria-controls="id-33a20336e4c69ab45583a5db">
                        <code>crates/optimism/node/tests/e2e/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/node/tests/e2e/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/node/tests/e2e/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-33a20336e4c69ab45583a5db"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;e2e&#47;main.rs scroll-reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg1">index 7f4b22ba7e04eb795bc6286c44f1464f5c9f6c1c..d0c12c52cd61cc88872dc69bb9b017f300198ec7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg36">@@ -1,6 +1,9 @@</span>
 #![allow(missing_docs)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
<span class="term-fg31">-#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
 mod p2p;
&nbsp;
 const fn main() {}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cbd780937b4aa27de3d111da" role="button"
                       aria-expanded="false" aria-controls="id-cbd780937b4aa27de3d111da">
                        <code>crates/optimism/node/tests/it/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/node/tests/it/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/node/tests/it/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cbd780937b4aa27de3d111da"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;it&#47;main.rs scroll-reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg1">index d0533fc4541ca1543d060df932dad643f9e3ab5c..6ac5cf6cf1c660ff7b1f0aee082b93b0ad0bc2df 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg36">@@ -1,9 +1,12 @@</span>
 #![allow(missing_docs)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
<span class="term-fg31">-#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
 mod builder;
&nbsp;
<span class="term-fg31">-#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
 mod priority;
&nbsp;
 const fn main() {}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cdc68573ce087818cc8824a0" role="button"
                       aria-expanded="false" aria-controls="id-cdc68573ce087818cc8824a0">
                        <code>crates/optimism/payload/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/payload/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/payload/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cdc68573ce087818cc8824a0"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;payload&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;payload&#47;Cargo.toml</span>
<span class="term-fg1">index 7f47da7e23606048ab1af463c18f61894dd55f0b..8bf0c4e3ea92a204823a985ff20d4de888973ba7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;payload&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;payload&#47;Cargo.toml</span>
<span class="term-fg36">@@ -26,7 +26,6 @@</span> reth-payload-builder-primitives.workspace = true
 reth-payload-util.workspace = true
 reth-payload-primitives = { workspace = true, features = [&quot;op&quot;] }
 reth-basic-payload-builder.workspace = true
<span class="term-fg31">-reth-trie.workspace = true</span>
 reth-chain-state.workspace = true
&nbsp;
 # op-reth
<span class="term-fg36">@@ -59,4 +58,5 @@</span> 	&quot;reth-optimism-evm&#47;optimism&quot;,
 	&quot;revm&#47;optimism&quot;,
 	&quot;reth-execution-types&#47;optimism&quot;,
 	&quot;reth-optimism-consensus&#47;optimism&quot;
<span class="term-fg31">-]</span>
<span class="term-fg31">\ No newline at end of file</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = []</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c9a2518906aeed132c67a25f" role="button"
                       aria-expanded="false" aria-controls="id-c9a2518906aeed132c67a25f">
                        <code>crates/optimism/payload/src/builder.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/payload/src/builder.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/payload/src/builder.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-13</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c9a2518906aeed132c67a25f"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;builder.rs scroll-reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;builder.rs</span>
<span class="term-fg1">index fbf99c78d9e7c30eda1515b809f09920c3962a95..8edd6d1c9e047ccc2ba049b4a39c816224d8fc49 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;builder.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;builder.rs</span>
<span class="term-fg36">@@ -21,12 +21,14 @@</span> use reth_payload_util::PayloadTransactions;
 use reth_primitives::{
     proofs, Block, BlockBody, BlockExt, Receipt, SealedHeader, TransactionSigned, TxType,
 };
<span class="term-fg31">-use reth_provider::{ProviderError, StateProofProvider, StateProviderFactory, StateRootProvider};</span>
<span class="term-fg32">+use reth_provider::{</span>
<span class="term-fg32">+    HashedPostStateProvider, ProviderError, StateProofProvider, StateProviderFactory,</span>
<span class="term-fg32">+    StateRootProvider,</span>
<span class="term-fg32">+};</span>
 use reth_revm::database::StateProviderDatabase;
 use reth_transaction_pool::{
     noop::NoopTransactionPool, BestTransactionsAttributes, TransactionPool,
 };
<span class="term-fg31">-use reth_trie::HashedPostState;</span>
 use revm::{
     db::{states::bundle_state::BundleRetention, State},
     primitives::{
<span class="term-fg36">@@ -338,7 +340,7 @@</span>     ) -&gt; Result&lt;BuildOutcomeKind&lt;OpBuiltPayload&gt;, PayloadBuilderError&gt;
     where
         EvmConfig: ConfigureEvm&lt;Header = Header&gt;,
         DB: Database&lt;Error = ProviderError&gt; + AsRef&lt;P&gt;,
<span class="term-fg31">-        P: StateRootProvider,</span>
<span class="term-fg32">+        P: StateRootProvider + HashedPostStateProvider,</span>
     {
         let ExecutedPayload { info, withdrawals_root } = match self.execute(&amp;mut state, &amp;ctx)? {
             BuildOutcomeKind::Better { payload } | BuildOutcomeKind::Freeze(payload) =&gt; payload,
<span class="term-fg36">@@ -366,17 +368,16 @@</span>         let logs_bloom =
             execution_outcome.block_logs_bloom(block_number).expect(&quot;Number is in range&quot;);
&nbsp;
         &#47;&#47; &#47;&#47; calculate the state root
<span class="term-fg31">-        let hashed_state = HashedPostState::from_bundle_state(&amp;execution_outcome.state().state);</span>
<span class="term-fg32">+        let state_provider = state.database.as_ref();</span>
<span class="term-fg32">+        let hashed_state = state_provider.hashed_post_state(execution_outcome.state());</span>
         let (state_root, trie_output) = {
<span class="term-fg31">-            state.database.as_ref().state_root_with_updates(hashed_state.clone()).inspect_err(</span>
<span class="term-fg31">-                |err| {</span>
<span class="term-fg31">-                    warn!(target: &quot;payload_builder&quot;,</span>
<span class="term-fg31">-                    parent_header=%ctx.parent().hash(),</span>
<span class="term-fg31">-                        %err,</span>
<span class="term-fg31">-                        &quot;failed to calculate state root for payload&quot;</span>
<span class="term-fg31">-                    );</span>
<span class="term-fg31">-                },</span>
<span class="term-fg31">-            )?</span>
<span class="term-fg32">+            state_provider.state_root_with_updates(hashed_state.clone()).inspect_err(|err| {</span>
<span class="term-fg32">+                warn!(target: &quot;payload_builder&quot;,</span>
<span class="term-fg32">+                parent_header=%ctx.parent().hash(),</span>
<span class="term-fg32">+                    %err,</span>
<span class="term-fg32">+                    &quot;failed to calculate state root for payload&quot;</span>
<span class="term-fg32">+                );</span>
<span class="term-fg32">+            })?</span>
         };
&nbsp;
         &#47;&#47; create the block header</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-25281fcb592fdecaf80f6a39" role="button"
                       aria-expanded="false" aria-controls="id-25281fcb592fdecaf80f6a39">
                        <code>crates/optimism/payload/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/payload/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/payload/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-25281fcb592fdecaf80f6a39"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 8447026d783a3fd65a755da88e20b9b75f5734e8..ab7f9897bc83bb711dd1d5a99a5d4e473fc55f22 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -8,8 +8,9 @@</span> )]
 #![cfg_attr(all(not(test), feature = &quot;optimism&quot;), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![allow(clippy::useless_let_if_seq)]
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
<span class="term-fg31">-#![cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
&nbsp;
 pub mod builder;
 pub use builder::OpPayloadBuilder;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0be788e7485e9be61cae2ab5" role="button"
                       aria-expanded="false" aria-controls="id-0be788e7485e9be61cae2ab5">
                        <code>crates/optimism/rpc/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/rpc/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/rpc/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0be788e7485e9be61cae2ab5"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;rpc&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg1">index 50194f39aa3c941f14a0272f6e2e95000277c824..09a0b81170d7da5d5f4e93a481b55920753ee9f3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg36">@@ -75,3 +75,4 @@</span> 	&quot;revm&#47;optimism&quot;,
 	&quot;reth-optimism-consensus&#47;optimism&quot;,
 	&quot;reth-optimism-payload-builder&#47;optimism&quot;
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ee0293050f8261485c028a1c" role="button"
                       aria-expanded="false" aria-controls="id-ee0293050f8261485c028a1c">
                        <code>crates/optimism/rpc/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/rpc/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/optimism/rpc/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ee0293050f8261485c028a1c"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;rpc&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;rpc&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 0fa0debdf33dbb4dbc78f71a53d0f84c27f331be..0f925459abab1bedb3c22c01e93f55eab2a6531e 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;rpc&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;rpc&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -7,8 +7,9 @@</span>     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(all(not(test), feature = &quot;optimism&quot;), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
<span class="term-fg31">-#![cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
&nbsp;
 pub mod error;
 pub mod eth;</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-5f85560b7543c66512b1025e"role="button" aria-expanded="false" aria-controls="id-5f85560b7543c66512b1025e">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/primitives</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+534</span></div>
                    <div class="text-start"><span class="text-danger">-134</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-5f85560b7543c66512b1025e">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2d2d58b81b2d00a619da3f99" role="button"
                       aria-expanded="false" aria-controls="id-2d2d58b81b2d00a619da3f99">
                        <code>crates/primitives-traits/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives-traits/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/primitives-traits/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2d2d58b81b2d00a619da3f99"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives-traits&#47;Cargo.toml scroll-reth&#47;crates&#47;primitives-traits&#47;Cargo.toml</span>
<span class="term-fg1">index df4491b2d126f719746ed52a8bf1d933491d3dce..87a96bec480e76640c16d4225eafce3b0d8f6a96 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives-traits&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives-traits&#47;Cargo.toml</span>
<span class="term-fg36">@@ -21,7 +21,10 @@</span> alloy-eips.workspace = true
 alloy-genesis.workspace = true
 alloy-primitives.workspace = true
 alloy-rlp.workspace = true
<span class="term-fg31">-revm-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# revm-primitives scroll re-export</span>
<span class="term-fg32">+revm-primitives = { package = &quot;reth-scroll-revm&quot;, path = &quot;..&#47;scroll&#47;revm&quot;, features = [&quot;serde&quot;] }</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
&nbsp;
 # misc
 byteorder = { workspace = true, optional = true }
<span class="term-fg36">@@ -65,7 +68,8 @@</span> 	&quot;serde?&#47;std&quot;
 ]
 test-utils = [
 	&quot;arbitrary&quot;,
<span class="term-fg31">-	&quot;reth-codecs?&#47;test-utils&quot;</span>
<span class="term-fg32">+	&quot;reth-codecs?&#47;test-utils&quot;,</span>
<span class="term-fg32">+	&quot;revm-primitives&#47;test-utils&quot;</span>
 ]
 arbitrary = [
 	&quot;std&quot;,
<span class="term-fg36">@@ -76,7 +80,8 @@</span> 	&quot;dep:proptest&quot;,
 	&quot;dep:proptest-arbitrary-interop&quot;,
 	&quot;alloy-eips&#47;arbitrary&quot;,
 	&quot;revm-primitives&#47;arbitrary&quot;,
<span class="term-fg31">-	&quot;reth-codecs?&#47;arbitrary&quot;</span>
<span class="term-fg32">+	&quot;reth-codecs?&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives?&#47;arbitrary&quot;</span>
 ]
 serde-bincode-compat = [
 	&quot;serde&quot;,
<span class="term-fg36">@@ -92,12 +97,17 @@</span>     &quot;alloy-primitives&#47;serde&quot;,
     &quot;bytes&#47;serde&quot;,
     &quot;rand&#47;serde&quot;,
     &quot;reth-codecs?&#47;serde&quot;,
<span class="term-fg31">-    &quot;revm-primitives&#47;serde&quot;,</span>
     &quot;roaring&#47;serde&quot;,
 	&quot;revm-primitives&#47;serde&quot;,
<span class="term-fg32">+	&quot;reth-scroll-primitives?&#47;serde&quot;</span>
 ]
 reth-codec = [
 	&quot;dep:reth-codecs&quot;,
 	&quot;dep:modular-bitfield&quot;,
 	&quot;dep:byteorder&quot;,
 ]
<span class="term-fg32">+</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+	&quot;revm-primitives&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-82643b9769a6eb97ba57bdb4" role="button"
                       aria-expanded="false" aria-controls="id-82643b9769a6eb97ba57bdb4">
                        <code>crates/primitives-traits/src/account.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives-traits/src/account.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/primitives-traits/src/account.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+110</span></div>
                            <div class="text-start"><span class="text-danger">-10</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-82643b9769a6eb97ba57bdb4"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives-traits&#47;src&#47;account.rs scroll-reth&#47;crates&#47;primitives-traits&#47;src&#47;account.rs</span>
<span class="term-fg1">index c8504f3b63cba932923146ca3960e189d565a1c1..27c03dc96b6eb5e65c2a238f6a9204187ac5382a 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives-traits&#47;src&#47;account.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives-traits&#47;src&#47;account.rs</span>
<span class="term-fg36">@@ -36,6 +36,15 @@</span>     &#47;&#47;&#47; Account balance.
     pub balance: U256,
     &#47;&#47;&#47; Hash of the account&#39;s bytecode.
     pub bytecode_hash: Option&lt;B256&gt;,
<span class="term-fg32">+    &#47;&#47;&#47; The extension for a Scroll account. This `Option` should always be `Some` and is used</span>
<span class="term-fg32">+    &#47;&#47;&#47; in order to maintain backward compatibility in case additional fields are added on the</span>
<span class="term-fg32">+    &#47;&#47;&#47; `Account` due to the way storage compaction is performed.</span>
<span class="term-fg32">+    &#47;&#47;&#47; Adding the `code_size` and the `poseidon_code_hash` fields on the `Account` without the</span>
<span class="term-fg32">+    &#47;&#47;&#47; extension caused the used bits of the bitflag struct to reach 16 bits, meaning no</span>
<span class="term-fg32">+    &#47;&#47;&#47; additional bitflag was available. See [reth codecs](reth_codecs::test_utils) for more</span>
<span class="term-fg32">+    &#47;&#47;&#47; details.</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    pub account_extension: Option&lt;reth_scroll_primitives::AccountExtension&gt;,</span>
 }
&nbsp;
 impl Account {
<span class="term-fg36">@@ -49,13 +58,32 @@</span>     &#47;&#47;&#47; &amp;&amp; bytecode = None (or hash is [`KECCAK_EMPTY`]).
     pub fn is_empty(&amp;self) -&gt; bool {
         self.nonce == 0 &amp;&amp;
             self.balance.is_zero() &amp;&amp;
<span class="term-fg31">-            self.bytecode_hash.map_or(true, |hash| hash == KECCAK_EMPTY)</span>
<span class="term-fg32">+            self.bytecode_hash.is_none_or(|hash| hash == KECCAK_EMPTY)</span>
     }
&nbsp;
     &#47;&#47;&#47; Returns an account bytecode&#39;s hash.
     &#47;&#47;&#47; In case of no bytecode, returns [`KECCAK_EMPTY`].
     pub fn get_bytecode_hash(&amp;self) -&gt; B256 {
         self.bytecode_hash.unwrap_or(KECCAK_EMPTY)
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Convert an [`revm_primitives::shared::AccountInfo`] into an [`Account`]</span>
<span class="term-fg32">+    pub fn from_account_info(info: revm_primitives::shared::AccountInfo) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: info.balance,</span>
<span class="term-fg32">+            nonce: info.nonce,</span>
<span class="term-fg32">+            bytecode_hash: (info.code_hash != KECCAK_EMPTY).then_some(info.code_hash),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(</span>
<span class="term-fg32">+                info.code</span>
<span class="term-fg32">+                    .map(|code| {</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                            &amp;code.original_byte_slice(),</span>
<span class="term-fg32">+                        )</span>
<span class="term-fg32">+                    })</span>
<span class="term-fg32">+                    .unwrap_or(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+            ),</span>
<span class="term-fg32">+        }</span>
     }
 }
&nbsp;
<span class="term-fg36">@@ -172,6 +200,10 @@</span>         Self {
             nonce: value.nonce.unwrap_or_default(),
             balance: value.balance,
             bytecode_hash: value.code.as_ref().map(keccak256),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                value.code.as_ref().unwrap_or_default(),</span>
<span class="term-fg32">+            )),</span>
         }
     }
 }
<span class="term-fg36">@@ -183,6 +215,8 @@</span>         Self {
             balance: revm_acc.balance,
             nonce: revm_acc.nonce,
             bytecode_hash: (code_hash != KECCAK_EMPTY).then_some(code_hash),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some((revm_acc.code_size, revm_acc.poseidon_code_hash).into()),</span>
         }
     }
 }
<span class="term-fg36">@@ -194,10 +228,37 @@</span>             balance: reth_acc.balance,
             nonce: reth_acc.nonce,
             code_hash: reth_acc.bytecode_hash.unwrap_or(KECCAK_EMPTY),
             code: None,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: reth_acc.account_extension.unwrap_or_default().code_size,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: reth_acc</span>
<span class="term-fg32">+                .account_extension</span>
<span class="term-fg32">+                .unwrap_or_default()</span>
<span class="term-fg32">+                .poseidon_code_hash</span>
<span class="term-fg32">+                .unwrap_or(reth_scroll_primitives::POSEIDON_EMPTY),</span>
         }
     }
 }
&nbsp;
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+impl From&lt;Account&gt; for revm_primitives::shared::AccountInfo {</span>
<span class="term-fg32">+    fn from(reth_acc: Account) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: reth_acc.balance,</span>
<span class="term-fg32">+            nonce: reth_acc.nonce,</span>
<span class="term-fg32">+            code_hash: reth_acc.bytecode_hash.unwrap_or(KECCAK_EMPTY),</span>
<span class="term-fg32">+            code: None,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;scroll&quot;, feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl From&lt;revm_primitives::shared::AccountInfo&gt; for Account {</span>
<span class="term-fg32">+    fn from(info: revm_primitives::shared::AccountInfo) -&gt; Self {</span>
<span class="term-fg32">+        Self::from_account_info(info)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 #[cfg(test)]
 mod tests {
     use alloy_primitives::{hex_literal::hex, B256, U256};
<span class="term-fg36">@@ -224,7 +285,13 @@</span>     }
&nbsp;
     #[test]
     fn test_empty_account() {
<span class="term-fg31">-        let mut acc = Account { nonce: 0, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg32">+        let mut acc = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         &#47;&#47; Nonce 0, balance 0, and bytecode hash set to None is considered empty.
         assert!(acc.is_empty());
&nbsp;
<span class="term-fg36">@@ -276,12 +343,23 @@</span>
     #[test]
     fn test_account_has_bytecode() {
         &#47;&#47; Account with no bytecode (None)
<span class="term-fg31">-        let acc_no_bytecode = Account { nonce: 1, balance: U256::from(1000), bytecode_hash: None };</span>
<span class="term-fg32">+        let acc_no_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(1000),</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         assert!(!acc_no_bytecode.has_bytecode(), &quot;Account should not have bytecode&quot;);
&nbsp;
         &#47;&#47; Account with bytecode hash set to KECCAK_EMPTY (should have bytecode)
<span class="term-fg31">-        let acc_empty_bytecode =</span>
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(1000), bytecode_hash: Some(KECCAK_EMPTY) };</span>
<span class="term-fg32">+        let acc_empty_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(1000),</span>
<span class="term-fg32">+            bytecode_hash: Some(KECCAK_EMPTY),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         assert!(acc_empty_bytecode.has_bytecode(), &quot;Account should have bytecode&quot;);
&nbsp;
         &#47;&#47; Account with a non-empty bytecode hash
<span class="term-fg36">@@ -289,6 +367,10 @@</span>         let acc_with_bytecode = Account {
             nonce: 1,
             balance: U256::from(1000),
             bytecode_hash: Some(B256::from_slice(&amp;[0x11u8; 32])),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;[0x11u8; 32],</span>
<span class="term-fg32">+            )),</span>
         };
         assert!(acc_with_bytecode.has_bytecode(), &quot;Account should have bytecode&quot;);
     }
<span class="term-fg36">@@ -296,12 +378,23 @@</span>
     #[test]
     fn test_account_get_bytecode_hash() {
         &#47;&#47; Account with no bytecode (should return KECCAK_EMPTY)
<span class="term-fg31">-        let acc_no_bytecode = Account { nonce: 0, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg32">+        let acc_no_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         assert_eq!(acc_no_bytecode.get_bytecode_hash(), KECCAK_EMPTY, &quot;Should return KECCAK_EMPTY&quot;);
&nbsp;
         &#47;&#47; Account with bytecode hash set to KECCAK_EMPTY
<span class="term-fg31">-        let acc_empty_bytecode =</span>
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(1000), bytecode_hash: Some(KECCAK_EMPTY) };</span>
<span class="term-fg32">+        let acc_empty_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(1000),</span>
<span class="term-fg32">+            bytecode_hash: Some(KECCAK_EMPTY),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         assert_eq!(
             acc_empty_bytecode.get_bytecode_hash(),
             KECCAK_EMPTY,
<span class="term-fg36">@@ -310,8 +403,15 @@</span>         );
&nbsp;
         &#47;&#47; Account with a valid bytecode hash
         let bytecode_hash = B256::from_slice(&amp;[0x11u8; 32]);
<span class="term-fg31">-        let acc_with_bytecode =</span>
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(1000), bytecode_hash: Some(bytecode_hash) };</span>
<span class="term-fg32">+        let acc_with_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(1000),</span>
<span class="term-fg32">+            bytecode_hash: Some(bytecode_hash),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;[0x11u8; 32],</span>
<span class="term-fg32">+            )),</span>
<span class="term-fg32">+        };</span>
         assert_eq!(
             acc_with_bytecode.get_bytecode_hash(),
             bytecode_hash,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0fc48621a146f5987abffa83" role="button"
                       aria-expanded="false" aria-controls="id-0fc48621a146f5987abffa83">
                        <code>crates/primitives/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/primitives/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+15</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0fc48621a146f5987abffa83"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;Cargo.toml scroll-reth&#47;crates&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">index 9787c9f3a6a9da33416da5f2a6f42701c8711cdf..721daf865deef65b09ed918d477832de33f0e8ed 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg36">@@ -16,7 +16,6 @@</span> # reth
 reth-primitives-traits = { workspace = true, features = [&quot;serde&quot;] }
 reth-ethereum-forks.workspace = true
 reth-static-file-types.workspace = true
<span class="term-fg31">-revm-primitives = { workspace = true, features = [&quot;serde&quot;] }</span>
 reth-codecs = { workspace = true, optional = true }
&nbsp;
 # ethereum
<span class="term-fg36">@@ -28,6 +27,10 @@</span> alloy-rpc-types = { workspace = true, optional = true }
 alloy-serde = { workspace = true, optional = true }
 alloy-eips = { workspace = true, features = [&quot;serde&quot;] }
 alloy-trie = { workspace = true, features = [&quot;serde&quot;] }
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+revm-primitives = { package = &quot;reth-scroll-revm&quot;, path = &quot;..&#47;scroll&#47;revm&quot;, features = [&quot;serde&quot;] }</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true, features = [&quot;serde&quot;] }</span>
&nbsp;
 # optimism
 op-alloy-rpc-types = { workspace = true, optional = true }
<span class="term-fg36">@@ -67,7 +70,7 @@</span> reth-codecs = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-primitives-traits = { workspace = true, features = [&quot;arbitrary&quot;] }
 reth-testing-utils.workspace = true
 reth-trie-common = { workspace = true, features = [&quot;arbitrary&quot;] }
<span class="term-fg31">-revm-primitives = { workspace = true, features = [&quot;arbitrary&quot;] }</span>
<span class="term-fg32">+revm-primitives = { package = &quot;reth-scroll-revm&quot;, path = &quot;..&#47;scroll&#47;revm&quot;, features = [&quot;arbitrary&quot;] }</span>
&nbsp;
 alloy-eips = { workspace = true, features = [&quot;arbitrary&quot;] }
 alloy-genesis.workspace = true
<span class="term-fg36">@@ -130,7 +133,8 @@</span> 	&quot;op-alloy-consensus?&#47;arbitrary&quot;,
 	&quot;op-alloy-rpc-types?&#47;arbitrary&quot;,
 	&quot;reth-codecs?&#47;arbitrary&quot;,
 	&quot;alloy-trie&#47;arbitrary&quot;,
<span class="term-fg31">-	&quot;reth-trie-common&#47;arbitrary&quot;</span>
<span class="term-fg32">+	&quot;reth-trie-common&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives?&#47;arbitrary&quot;</span>
 ]
 secp256k1 = [&quot;dep:secp256k1&quot;]
 c-kzg = [
<span class="term-fg36">@@ -148,7 +152,7 @@</span> alloy-compat = [
 	&quot;dep:alloy-rpc-types&quot;,
 	&quot;dep:alloy-serde&quot;,
 	&quot;dep:op-alloy-rpc-types&quot;,
<span class="term-fg31">-    &quot;dep:alloy-network&quot;,</span>
<span class="term-fg32">+	&quot;dep:alloy-network&quot;,</span>
 ]
 test-utils = [
 	&quot;reth-primitives-traits&#47;test-utils&quot;,
<span class="term-fg36">@@ -156,6 +160,7 @@</span> 	&quot;reth-chainspec&#47;test-utils&quot;,
 	&quot;reth-codecs?&#47;test-utils&quot;,
 	&quot;reth-trie-common&#47;test-utils&quot;,
 	&quot;arbitrary&quot;,
<span class="term-fg32">+	&quot;revm-primitives&#47;test-utils&quot;</span>
 ]
 serde-bincode-compat = [
 	&quot;serde_with&quot;,
<span class="term-fg36">@@ -164,6 +169,12 @@</span> 	&quot;alloy-consensus&#47;serde-bincode-compat&quot;,
 	&quot;op-alloy-consensus?&#47;serde-bincode-compat&quot;,
 	&quot;reth-primitives-traits&#47;serde-bincode-compat&quot;,
 	&quot;reth-trie-common&#47;serde-bincode-compat&quot;,
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-trie-common&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-testing-utils&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives&quot;</span>
 ]
&nbsp;
 [[bench]]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9b1fa5b013ac0feeb5279670" role="button"
                       aria-expanded="false" aria-controls="id-9b1fa5b013ac0feeb5279670">
                        <code>crates/primitives/src/alloy_compat.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/alloy_compat.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/primitives/src/alloy_compat.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+102</span></div>
                            <div class="text-start"><span class="text-danger">-27</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9b1fa5b013ac0feeb5279670"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;alloy_compat.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;alloy_compat.rs</span>
<span class="term-fg1">index a72c83996c011cc0305385af3845014beeec1bd1..f190316bcc8e95e7436544c612999b67c6c8bd42 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;alloy_compat.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;alloy_compat.rs</span>
<span class="term-fg36">@@ -123,34 +123,64 @@</span>             AnyTxEnvelope::Ethereum(TxEnvelope::Eip7702(tx)) =&gt; {
                 let (tx, signature, hash) = tx.into_parts();
                 (Transaction::Eip7702(tx), signature, hash)
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg31">-            AnyTxEnvelope::Unknown(alloy_network::UnknownTxEnvelope { hash, inner }) =&gt; {</span>
<span class="term-fg32">+            #[cfg(any(feature = &quot;optimism&quot;, feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+            AnyTxEnvelope::Unknown(alloy_network::UnknownTxEnvelope { hash: _hash, inner }) =&gt; {</span>
                 use alloy_consensus::Transaction as _;
&nbsp;
<span class="term-fg31">-                if inner.ty() == crate::TxType::Deposit {</span>
<span class="term-fg31">-                    let fields: op_alloy_rpc_types::OpTransactionFields = inner</span>
<span class="term-fg31">-                        .fields</span>
<span class="term-fg31">-                        .clone()</span>
<span class="term-fg31">-                        .deserialize_into::&lt;op_alloy_rpc_types::OpTransactionFields&gt;()</span>
<span class="term-fg31">-                        .map_err(|e| ConversionError::Custom(e.to_string()))?;</span>
<span class="term-fg31">-                    (</span>
<span class="term-fg31">-                        Transaction::Deposit(op_alloy_consensus::TxDeposit {</span>
<span class="term-fg31">-                            source_hash: fields.source_hash.ok_or_else(|| {</span>
<span class="term-fg31">-                                ConversionError::Custom(&quot;MissingSourceHash&quot;.to_string())</span>
<span class="term-fg31">-                            })?,</span>
<span class="term-fg31">-                            from: tx.from,</span>
<span class="term-fg31">-                            to: revm_primitives::TxKind::from(inner.to()),</span>
<span class="term-fg31">-                            mint: fields.mint.filter(|n| *n != 0),</span>
<span class="term-fg31">-                            value: inner.value(),</span>
<span class="term-fg31">-                            gas_limit: inner.gas_limit(),</span>
<span class="term-fg31">-                            is_system_transaction: fields.is_system_tx.unwrap_or(false),</span>
<span class="term-fg31">-                            input: inner.input().clone(),</span>
<span class="term-fg31">-                        }),</span>
<span class="term-fg31">-                        op_alloy_consensus::TxDeposit::signature(),</span>
<span class="term-fg31">-                        hash,</span>
<span class="term-fg31">-                    )</span>
<span class="term-fg31">-                } else {</span>
<span class="term-fg31">-                    return Err(ConversionError::Custom(&quot;unknown transaction type&quot;.to_string()))</span>
<span class="term-fg32">+                match TryInto::&lt;crate::TxType&gt;::try_into(inner.ty())</span>
<span class="term-fg32">+                    .map_err(|e| ConversionError::Custom(e.to_string()))?</span>
<span class="term-fg32">+                {</span>
<span class="term-fg32">+                    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
<span class="term-fg32">+                    crate::TxType::Deposit =&gt; {</span>
<span class="term-fg32">+                        let fields: op_alloy_rpc_types::OpTransactionFields = inner</span>
<span class="term-fg32">+                            .fields</span>
<span class="term-fg32">+                            .clone()</span>
<span class="term-fg32">+                            .deserialize_into::&lt;op_alloy_rpc_types::OpTransactionFields&gt;()</span>
<span class="term-fg32">+                            .map_err(|e| ConversionError::Custom(e.to_string()))?;</span>
<span class="term-fg32">+                        (</span>
<span class="term-fg32">+                            Transaction::Deposit(op_alloy_consensus::TxDeposit {</span>
<span class="term-fg32">+                                source_hash: fields.source_hash.ok_or_else(|| {</span>
<span class="term-fg32">+                                    ConversionError::Custom(&quot;MissingSourceHash&quot;.to_string())</span>
<span class="term-fg32">+                                })?,</span>
<span class="term-fg32">+                                from: tx.from,</span>
<span class="term-fg32">+                                to: revm_primitives::TxKind::from(inner.to()),</span>
<span class="term-fg32">+                                mint: fields.mint.filter(|n| *n != 0),</span>
<span class="term-fg32">+                                value: inner.value(),</span>
<span class="term-fg32">+                                gas_limit: inner.gas_limit(),</span>
<span class="term-fg32">+                                is_system_transaction: fields.is_system_tx.unwrap_or(false),</span>
<span class="term-fg32">+                                input: inner.input().clone(),</span>
<span class="term-fg32">+                            }),</span>
<span class="term-fg32">+                            op_alloy_consensus::TxDeposit::signature(),</span>
<span class="term-fg32">+                            _hash,</span>
<span class="term-fg32">+                        )</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                    #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                    crate::TxType::L1Message =&gt; {</span>
<span class="term-fg32">+                        let fields =</span>
<span class="term-fg32">+                            inner</span>
<span class="term-fg32">+                                .fields</span>
<span class="term-fg32">+                                .clone()</span>
<span class="term-fg32">+                                .deserialize_into::&lt;reth_scroll_primitives::ScrollL1MessageTransactionFields&gt;()</span>
<span class="term-fg32">+                                .map_err(|e| ConversionError::Custom(e.to_string()))?;</span>
<span class="term-fg32">+                        (</span>
<span class="term-fg32">+                            Transaction::L1Message(reth_scroll_primitives::TxL1Message {</span>
<span class="term-fg32">+                                queue_index: fields.queue_index,</span>
<span class="term-fg32">+                                gas_limit: inner.gas_limit(),</span>
<span class="term-fg32">+                                to: inner.to().ok_or(ConversionError::Custom(</span>
<span class="term-fg32">+                                    &quot;Scroll L1 message transaction do not support create transaction&quot;</span>
<span class="term-fg32">+                                        .to_string(),</span>
<span class="term-fg32">+                                ))?,</span>
<span class="term-fg32">+                                value: inner.value(),</span>
<span class="term-fg32">+                                sender: fields.sender,</span>
<span class="term-fg32">+                                input: inner.input().clone(),</span>
<span class="term-fg32">+                            }),</span>
<span class="term-fg32">+                            reth_scroll_primitives::TxL1Message::signature(),</span>
<span class="term-fg32">+                            _hash,</span>
<span class="term-fg32">+                        )</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                    _ =&gt; {</span>
<span class="term-fg32">+                        return Err(ConversionError::Custom(&quot;unknown transaction type&quot;.to_string()))</span>
<span class="term-fg32">+                    }</span>
                 }
             }
             _ =&gt; return Err(ConversionError::Custom(&quot;unknown transaction type&quot;.to_string())),
<span class="term-fg36">@@ -161,7 +191,7 @@</span>     }
 }
&nbsp;
 #[cfg(test)]
<span class="term-fg31">-#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
 mod tests {
     use super::*;
     use alloy_primitives::{address, Address, B256, U256};
<span class="term-fg36">@@ -270,3 +300,48 @@</span>             panic!(&quot;Expected Deposit transaction&quot;);
         }
     }
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(test)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+mod tests {</span>
<span class="term-fg32">+    use super::*;</span>
<span class="term-fg32">+    use alloy_primitives::{address, U256};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_scroll_l1_message_tx() {</span>
<span class="term-fg32">+        &#47;&#47; https:&#47;&#47;scrollscan.com&#47;tx&#47;0x36199419dbdb7823235de4b73e3d90a61c7b1f343b7a682a271c3055249e81f9</span>
<span class="term-fg32">+        let input = r#&quot;{</span>
<span class="term-fg32">+            &quot;hash&quot;:&quot;0x36199419dbdb7823235de4b73e3d90a61c7b1f343b7a682a271c3055249e81f9&quot;,</span>
<span class="term-fg32">+            &quot;nonce&quot;:&quot;0x0&quot;,</span>
<span class="term-fg32">+            &quot;blockHash&quot;:&quot;0x4aca26460c31be3948e8466681ad87891326a964422c9370d4c1913f3bed4b10&quot;,</span>
<span class="term-fg32">+            &quot;blockNumber&quot;:&quot;0xabf06f&quot;,</span>
<span class="term-fg32">+            &quot;transactionIndex&quot;:&quot;0x0&quot;,</span>
<span class="term-fg32">+            &quot;from&quot;:&quot;0x7885bcbd5cecef1336b5300fb5186a12ddd8c478&quot;,</span>
<span class="term-fg32">+            &quot;to&quot;:&quot;0x781e90f1c8fc4611c9b7497c3b47f99ef6969cbc&quot;,</span>
<span class="term-fg32">+            &quot;value&quot;:&quot;0x0&quot;,</span>
<span class="term-fg32">+            &quot;gasPrice&quot;:&quot;0x0&quot;,</span>
<span class="term-fg32">+            &quot;gas&quot;:&quot;0x1e8480&quot;,</span>
<span class="term-fg32">+            &quot;input&quot;:&quot;0x8ef1332e000000000000000000000000c186fa914353c44b2e33ebe05f21846f1048beda0000000000000000000000003bad7ad0728f9917d1bf08af5782dcbd516cdd96000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e76ab00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000044493a4f84f464e58d4bfa93bcc57abfb14dbe1b8ff46cd132b5709aab227f269727943d2f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;,</span>
<span class="term-fg32">+            &quot;r&quot;:&quot;0x0&quot;,</span>
<span class="term-fg32">+            &quot;s&quot;:&quot;0x0&quot;,</span>
<span class="term-fg32">+            &quot;v&quot;:&quot;0x0&quot;,</span>
<span class="term-fg32">+            &quot;type&quot;:&quot;0x7e&quot;,</span>
<span class="term-fg32">+            &quot;queueIndex&quot;:&quot;0xe76ab&quot;,</span>
<span class="term-fg32">+            &quot;sender&quot;:&quot;0x7885bcbd5cecef1336b5300fb5186a12ddd8c478&quot;</span>
<span class="term-fg32">+        }&quot;#;</span>
<span class="term-fg32">+        let alloy_tx: WithOtherFields&lt;alloy_rpc_types::Transaction&lt;AnyTxEnvelope&gt;&gt; =</span>
<span class="term-fg32">+            serde_json::from_str(input).expect(&quot;failed to deserialize&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let TransactionSigned { transaction: reth_tx, .. } =</span>
<span class="term-fg32">+            alloy_tx.try_into().expect(&quot;failed to convert&quot;);</span>
<span class="term-fg32">+        if let Transaction::L1Message(l1_message_tx) = reth_tx {</span>
<span class="term-fg32">+            assert_eq!(l1_message_tx.queue_index, 0xe76ab);</span>
<span class="term-fg32">+            assert_eq!(l1_message_tx.gas_limit, 0x1e8480);</span>
<span class="term-fg32">+            assert_eq!(l1_message_tx.to, address!(&quot;781e90f1c8fc4611c9b7497c3b47f99ef6969cbc&quot;));</span>
<span class="term-fg32">+            assert_eq!(l1_message_tx.value, U256::ZERO);</span>
<span class="term-fg32">+            assert_eq!(l1_message_tx.sender, address!(&quot;7885bcbd5cecef1336b5300fb5186a12ddd8c478&quot;));</span>
<span class="term-fg32">+        } else {</span>
<span class="term-fg32">+            panic!(&quot;Expected L1 message transaction&quot;);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-974c1cb112eb628b77289596" role="button"
                       aria-expanded="false" aria-controls="id-974c1cb112eb628b77289596">
                        <code>crates/primitives/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/primitives/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-974c1cb112eb628b77289596"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 224e025f39d5c37301e45714d220b03dfc395644..7062858f4110e341c06be99c75e6b716b1d73d8a 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -19,6 +19,11 @@</span> #![cfg_attr(not(test), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![cfg_attr(not(feature = &quot;std&quot;), no_std)]
&nbsp;
<span class="term-fg32">+#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+use op_alloy_consensus as _;</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+use reth_scroll_primitives as _;</span>
<span class="term-fg32">+</span>
 extern crate alloc;
&nbsp;
 mod traits;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8ebdfbcb66644db6a96b9aa1" role="button"
                       aria-expanded="false" aria-controls="id-8ebdfbcb66644db6a96b9aa1">
                        <code>crates/primitives/src/proofs.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/proofs.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/primitives/src/proofs.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8ebdfbcb66644db6a96b9aa1"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;proofs.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;proofs.rs</span>
<span class="term-fg1">index 81c26d7180e0be9059d22fafe8cf6e17f78bf278..f1931bcab95e1367e7b4147ab0e51f8cf9c71a83 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;proofs.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;proofs.rs</span>
<span class="term-fg36">@@ -94,6 +94,8 @@</span>                 tx_type: TxType::Eip2930,
                 success: true,
                 cumulative_gas_used: 102068,
                 logs,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                l1_fee: U256::from(0xffffff),</span>
             },
             bloom,
         };</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cdff13dc9ca41670f8e8f6f3" role="button"
                       aria-expanded="false" aria-controls="id-cdff13dc9ca41670f8e8f6f3">
                        <code>crates/primitives/src/receipt.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/receipt.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/primitives/src/receipt.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+55</span></div>
                            <div class="text-start"><span class="text-danger">-25</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cdff13dc9ca41670f8e8f6f3"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;receipt.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;receipt.rs</span>
<span class="term-fg1">index 95d707d1b2d5709f6bc96d67c891ec625201bb14..4b9cc09f95d122e93eb3f9199f78495df3dbb1d3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;receipt.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;receipt.rs</span>
<span class="term-fg36">@@ -7,6 +7,8 @@</span>     constants::{EIP1559_TX_TYPE_ID, EIP2930_TX_TYPE_ID, EIP4844_TX_TYPE_ID, EIP7702_TX_TYPE_ID},
     Eip658Value, TxReceipt,
 };
 use alloy_eips::eip2718::Encodable2718;
<span class="term-fg32">+#[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+use alloy_primitives::U256;</span>
 use alloy_primitives::{Bloom, Log, B256};
 use alloy_rlp::{length_of_length, Decodable, Encodable, RlpDecodable, RlpEncodable};
 use bytes::{Buf, BufMut};
<span class="term-fg36">@@ -40,7 +42,7 @@</span>     pub cumulative_gas_used: u64,
     &#47;&#47;&#47; Log send from contracts.
     pub logs: Vec&lt;Log&gt;,
     &#47;&#47;&#47; Deposit nonce for Optimism deposit transactions
<span class="term-fg31">-    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
     pub deposit_nonce: Option&lt;u64&gt;,
     &#47;&#47;&#47; Deposit receipt version for Optimism deposit transactions
     &#47;&#47;&#47;
<span class="term-fg36">@@ -48,8 +50,14 @@</span>     &#47;&#47;&#47;
     &#47;&#47;&#47; The deposit receipt version was introduced in Canyon to indicate an update to how
     &#47;&#47;&#47; receipt hashes should be computed when set. The state transition process
     &#47;&#47;&#47; ensures this is only set for post-Canyon deposit transactions.
<span class="term-fg31">-    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
     pub deposit_receipt_version: Option&lt;u64&gt;,
<span class="term-fg32">+    &#47;&#47;&#47; Additional fee to cover l1 data availability costs.</span>
<span class="term-fg32">+    &#47;&#47;&#47; L1 fee is not part of the consensus encoding of a receipt.</span>
<span class="term-fg32">+    &#47;&#47;&#47; &lt;https:&#47;&#47;github.com&#47;scroll-tech&#47;go-ethereum&#47;blob&#47;9fff27e4f34fb5097100ed76ee725ce056267f4b&#47;core&#47;types&#47;receipt.go#L96-L102&gt;</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+    #[rlp(skip)]</span>
<span class="term-fg32">+    pub l1_fee: U256,</span>
 }
&nbsp;
 impl Receipt {
<span class="term-fg36">@@ -233,7 +241,7 @@</span>         let cumulative_gas_used = u64::arbitrary(u)?;
         let logs = Vec::&lt;Log&gt;::arbitrary(u)?;
&nbsp;
         &#47;&#47; Only receipts for deposit transactions may contain a deposit nonce
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         let (deposit_nonce, deposit_receipt_version) = if tx_type == TxType::Deposit {
             let deposit_nonce = Option::&lt;u64&gt;::arbitrary(u)?;
             let deposit_nonce_version =
<span class="term-fg36">@@ -248,10 +256,12 @@</span>             tx_type,
             success,
             cumulative_gas_used,
             logs,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             deposit_nonce,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             deposit_receipt_version,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            l1_fee: U256::arbitrary(u)?,</span>
         })
     }
 }
<span class="term-fg36">@@ -313,7 +323,7 @@</span>         let bloom = Decodable::decode(b)?;
         let logs = alloy_rlp::Decodable::decode(b)?;
&nbsp;
         let receipt = match tx_type {
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             TxType::Deposit =&gt; {
                 let remaining = |b: &amp;[u8]| rlp_head.payload_length - (started_len - b.len()) &gt; 0;
                 let deposit_nonce =
<span class="term-fg36">@@ -335,10 +345,12 @@</span>                 tx_type,
                 success,
                 cumulative_gas_used,
                 logs,
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_nonce: None,
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_receipt_version: None,
<span class="term-fg32">+                #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             },
         };
&nbsp;
<span class="term-fg36">@@ -397,7 +409,7 @@</span>                     EIP7702_TX_TYPE_ID =&gt; {
                         buf.advance(1);
                         Self::decode_receipt(buf, TxType::Eip7702)
                     }
<span class="term-fg31">-                    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                     op_alloy_consensus::DEPOSIT_TX_TYPE_ID =&gt; {
                         buf.advance(1);
                         Self::decode_receipt(buf, TxType::Deposit)
<span class="term-fg36">@@ -470,7 +482,7 @@</span>         rlp_head.payload_length += self.receipt.cumulative_gas_used.length();
         rlp_head.payload_length += self.bloom.length();
         rlp_head.payload_length += self.receipt.logs.length();
&nbsp;
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         if self.receipt.tx_type == TxType::Deposit {
             if let Some(deposit_nonce) = self.receipt.deposit_nonce {
                 rlp_head.payload_length += deposit_nonce.length();
<span class="term-fg36">@@ -490,7 +502,7 @@</span>         self.receipt.success.encode(out);
         self.receipt.cumulative_gas_used.encode(out);
         self.bloom.encode(out);
         self.receipt.logs.encode(out);
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         if self.receipt.tx_type == TxType::Deposit {
             if let Some(deposit_nonce) = self.receipt.deposit_nonce {
                 deposit_nonce.encode(out)
<span class="term-fg36">@@ -532,9 +544,13 @@</span>             }
             TxType::Eip7702 =&gt; {
                 out.put_u8(EIP7702_TX_TYPE_ID);
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             TxType::Deposit =&gt; {
                 out.put_u8(op_alloy_consensus::DEPOSIT_TX_TYPE_ID);
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            TxType::L1Message =&gt; {</span>
<span class="term-fg32">+                out.put_u8(reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE);</span>
             }
         }
         out.put_slice(payload.as_ref());
<span class="term-fg36">@@ -572,9 +588,13 @@</span>     use reth_codecs::Compact;
&nbsp;
     #[test]
     fn test_decode_receipt() {
<span class="term-fg31">-        #[cfg(not(feature = &quot;optimism&quot;))]</span>
<span class="term-fg32">+        #[cfg(all(not(feature = &quot;optimism&quot;), not(feature = &quot;scroll&quot;)))]</span>
         reth_codecs::test_utils::test_decode::&lt;Receipt&gt;(&amp;hex!(
             &quot;c428b52ffd23fc42696156b10200f034792b6a94c3850215c2fef7aea361a0c31b79d9a32652eefc0d4e2e730036061cff7344b6fc6132b50cda0ed810a991ae58ef013150c12b2522533cb3b3a8b19b7786a8b5ff1d3cdc84225e22b02def168c8858df&quot;
<span class="term-fg32">+        ));</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        reth_codecs::test_utils::test_decode::&lt;Receipt&gt;(&amp;hex!(</span>
<span class="term-fg32">+            &quot;c42128b52ffd23fc42696159c90200f034792b6a94c3850215c2fef7aea361a0c31b79d9a32652eefc0d4e2e730036061cff7344b6fc6132b50cda0ed810a991ae58ef013150c12b2522533cb3b3a8b19b7786a8b5ff1d3cdc84225e22b02def168c8858dfffffff&quot;</span>
         ));
         #[cfg(feature = &quot;optimism&quot;)]
         reth_codecs::test_utils::test_decode::&lt;Receipt&gt;(&amp;hex!(
<span class="term-fg36">@@ -601,10 +621,12 @@</span>                     ],
                     bytes!(&quot;0100ff&quot;),
                 )],
                 success: false,
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_nonce: None,
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_receipt_version: None,
<span class="term-fg32">+                #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             },
             bloom: [0; 256].into(),
         };
<span class="term-fg36">@@ -635,10 +657,12 @@</span>                     ],
                     bytes!(&quot;0100ff&quot;),
                 )],
                 success: false,
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_nonce: None,
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_receipt_version: None,
<span class="term-fg32">+                #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             },
             bloom: [0; 256].into(),
         };
<span class="term-fg36">@@ -647,7 +671,7 @@</span>         let receipt = ReceiptWithBloom::decode(&amp;mut &amp;data[..]).unwrap();
         assert_eq!(receipt, expected);
     }
&nbsp;
<span class="term-fg31">-    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
     #[test]
     fn decode_deposit_receipt_regolith_roundtrip() {
         let data = hex!(&quot;7ef9010c0182b741b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0833d3bbf&quot;);
<span class="term-fg36">@@ -673,7 +697,7 @@</span>         receipt.encode_inner(&amp;mut buf, false);
         assert_eq!(buf, &amp;data[..]);
     }
&nbsp;
<span class="term-fg31">-    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
     #[test]
     fn decode_deposit_receipt_canyon_roundtrip() {
         let data = hex!(&quot;7ef9010d0182b741b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0833d3bbf01&quot;);
<span class="term-fg36">@@ -717,10 +741,12 @@</span>                     vec![b256!(&quot;8cca58667b1e9ffa004720ac99a3d61a138181963b294d270d91c53d36402ae2&quot;)],
                     Bytes::from(vec![1; 0xffffff]),
                 ),
             ],
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             deposit_nonce: None,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             deposit_receipt_version: None,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            l1_fee: U256::from(0xffffff),</span>
         };
&nbsp;
         let mut data = vec![];
<span class="term-fg36">@@ -737,10 +763,12 @@</span>                 tx_type: TxType::Eip1559,
                 success: true,
                 cumulative_gas_used: 21000,
                 logs: vec![],
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_nonce: None,
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_receipt_version: None,
<span class="term-fg32">+                #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                l1_fee: U256::from(0xffffff),</span>
             },
             bloom: Bloom::default(),
         };
<span class="term-fg36">@@ -759,10 +787,12 @@</span>                 tx_type: TxType::Legacy,
                 success: true,
                 cumulative_gas_used: 21000,
                 logs: vec![],
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_nonce: None,
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_receipt_version: None,
<span class="term-fg32">+                #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                l1_fee: U256::from(0xffffff),</span>
             },
             bloom: Bloom::default(),
         };</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5d6d738e49f1c8eeb6da4ecf" role="button"
                       aria-expanded="false" aria-controls="id-5d6d738e49f1c8eeb6da4ecf">
                        <code>crates/primitives/src/traits.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/traits.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/primitives/src/traits.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5d6d738e49f1c8eeb6da4ecf"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;traits.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;traits.rs</span>
<span class="term-fg1">index ec4e75c8c6d034eadf1ff0fd0adfd7e22c15cee4..307443c00b8c9b421e7d0a6d17e2498d3be494c2 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;traits.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;traits.rs</span>
<span class="term-fg36">@@ -5,7 +5,7 @@</span> };
 use alloc::vec::Vec;
 use alloy_eips::{eip2718::Encodable2718, BlockNumHash};
 use reth_primitives_traits::{Block, BlockBody, BlockHeader, SealedHeader, SignedTransaction};
<span class="term-fg31">-use revm_primitives::{Address, B256};</span>
<span class="term-fg32">+use revm_primitives::primitives::{Address, B256};</span>
&nbsp;
 &#47;&#47;&#47; Extension trait for [`reth_primitives_traits::Block`] implementations
 &#47;&#47;&#47; allowing for conversions into common block parts containers such as [`SealedBlock`],</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8b21c2bd097110c552678cfc" role="button"
                       aria-expanded="false" aria-controls="id-8b21c2bd097110c552678cfc">
                        <code>crates/primitives/src/transaction/compat.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/transaction/compat.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/primitives/src/transaction/compat.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+20</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8b21c2bd097110c552678cfc"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;compat.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;compat.rs</span>
<span class="term-fg1">index 883c89c45f51e3d3f9569f312e01d42b0167e921..65ea1489655a952307063fd3d582f21de0c7f593 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;compat.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;compat.rs</span>
<span class="term-fg36">@@ -1,6 +1,6 @@</span>
 use crate::{Transaction, TransactionSigned};
 use alloy_primitives::{Address, TxKind, U256};
<span class="term-fg31">-#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
 use op_alloy_consensus::DepositTransaction;
 use revm_primitives::{AuthorizationList, TxEnv};
&nbsp;
<span class="term-fg36">@@ -12,7 +12,7 @@</span> }
&nbsp;
 impl FillTxEnv for TransactionSigned {
     fn fill_tx_env(&amp;self, tx_env: &amp;mut TxEnv, sender: Address) {
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         let envelope = alloy_eips::eip2718::Encodable2718::encoded_2718(self);
&nbsp;
         tx_env.caller = sender;
<span class="term-fg36">@@ -88,7 +88,7 @@</span>                 tx_env.max_fee_per_blob_gas.take();
                 tx_env.authorization_list =
                     Some(AuthorizationList::Signed(tx.authorization_list.clone()));
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Transaction::Deposit(tx) =&gt; {
                 tx_env.access_list.clear();
                 tx_env.gas_limit = tx.gas_limit;
<span class="term-fg36">@@ -109,9 +109,25 @@</span>                     enveloped_tx: Some(envelope.into()),
                 };
                 return;
             }
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Transaction::L1Message(tx) =&gt; {</span>
<span class="term-fg32">+                tx_env.access_list.clear();</span>
<span class="term-fg32">+                tx_env.gas_limit = tx.gas_limit;</span>
<span class="term-fg32">+                tx_env.gas_price = U256::ZERO;</span>
<span class="term-fg32">+                tx_env.gas_priority_fee = None;</span>
<span class="term-fg32">+                tx_env.transact_to = tx.to();</span>
<span class="term-fg32">+                tx_env.value = tx.value;</span>
<span class="term-fg32">+                tx_env.data = tx.input.clone();</span>
<span class="term-fg32">+                tx_env.chain_id = None;</span>
<span class="term-fg32">+                tx_env.nonce = None;</span>
<span class="term-fg32">+                tx_env.authorization_list = None;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                &#47;&#47; TODO (scroll): fill in the Scroll fields when revm fork is introduced in Reth.</span>
<span class="term-fg32">+                &#47;&#47; &lt;https:&#47;&#47;github.com&#47;scroll-tech&#47;revm&#47;blob&#47;scroll-evm-executor&#47;v49&#47;crates&#47;primitives&#47;src&#47;env.rs#L608-L611&gt;</span>
<span class="term-fg32">+            }</span>
         }
&nbsp;
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         if !self.is_deposit() {
             tx_env.optimism = revm_primitives::OptimismFields {
                 source_hash: None,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1527fcd6a93c3f240d7c3078" role="button"
                       aria-expanded="false" aria-controls="id-1527fcd6a93c3f240d7c3078">
                        <code>crates/primitives/src/transaction/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/transaction/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/primitives/src/transaction/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+162</span></div>
                            <div class="text-start"><span class="text-danger">-46</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1527fcd6a93c3f240d7c3078"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;mod.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;mod.rs</span>
<span class="term-fg1">index db789d1f6de8509b3a10945101b23caf511b9711..eff579cba59efc47de00a0d982ec344b461fb052 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;mod.rs</span>
<span class="term-fg36">@@ -19,12 +19,14 @@</span> use derive_more::{AsRef, Deref};
 use once_cell as _;
 #[cfg(not(feature = &quot;std&quot;))]
 use once_cell::sync::{Lazy as LazyLock, OnceCell as OnceLock};
<span class="term-fg31">-#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
 use op_alloy_consensus::DepositTransaction;
<span class="term-fg31">-#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
 use op_alloy_consensus::TxDeposit;
 use rayon::prelude::{IntoParallelIterator, ParallelIterator};
 use reth_primitives_traits::{InMemorySize, SignedTransaction};
<span class="term-fg32">+#[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+use reth_scroll_primitives::l1_transaction::TxL1Message;</span>
 use revm_primitives::{AuthorizationList, TxEnv};
 use serde::{Deserialize, Serialize};
 use signature::decode_with_eip155_chain_id;
<span class="term-fg36">@@ -123,11 +125,14 @@</span>     &#47;&#47;&#47; EOA for a single transaction. This allows for temporarily adding smart contract
     &#47;&#47;&#47; functionality to the EOA.
     Eip7702(TxEip7702),
     &#47;&#47;&#47; Optimism deposit transaction.
<span class="term-fg31">-    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
     Deposit(TxDeposit),
<span class="term-fg32">+    &#47;&#47;&#47; Scroll L1 messaging transaction.</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+    L1Message(TxL1Message),</span>
 }
&nbsp;
<span class="term-fg31">-#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
 impl DepositTransaction for Transaction {
     fn source_hash(&amp;self) -&gt; Option&lt;B256&gt; {
         match self {
<span class="term-fg36">@@ -177,10 +182,15 @@</span>             TxType::Eip7702 =&gt; {
                 let tx = TxEip7702::arbitrary(u)?;
                 Self::Eip7702(tx)
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             TxType::Deposit =&gt; {
                 let tx = TxDeposit::arbitrary(u)?;
                 Self::Deposit(tx)
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            TxType::L1Message =&gt; {</span>
<span class="term-fg32">+                let tx = TxL1Message::arbitrary(u)?;</span>
<span class="term-fg32">+                Self::L1Message(tx)</span>
             }
         };
&nbsp;
<span class="term-fg36">@@ -205,8 +215,10 @@</span>             Self::Eip2930(tx) =&gt; tx.signature_hash(),
             Self::Eip1559(tx) =&gt; tx.signature_hash(),
             Self::Eip4844(tx) =&gt; tx.signature_hash(),
             Self::Eip7702(tx) =&gt; tx.signature_hash(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(_) =&gt; B256::ZERO,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(_) =&gt; B256::ZERO,</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -218,8 +230,10 @@</span>             Self::Eip2930(TxEip2930 { chain_id: ref mut c, .. }) |
             Self::Eip1559(TxEip1559 { chain_id: ref mut c, .. }) |
             Self::Eip4844(TxEip4844 { chain_id: ref mut c, .. }) |
             Self::Eip7702(TxEip7702 { chain_id: ref mut c, .. }) =&gt; *c = chain_id,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(_) =&gt; { &#47;* noop *&#47; }
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(_) =&gt; { &#47;* noop *&#47; }</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -231,8 +245,10 @@</span>             Self::Eip2930(_) =&gt; TxType::Eip2930,
             Self::Eip1559(_) =&gt; TxType::Eip1559,
             Self::Eip4844(_) =&gt; TxType::Eip4844,
             Self::Eip7702(_) =&gt; TxType::Eip7702,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(_) =&gt; TxType::Deposit,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(_) =&gt; TxType::L1Message,</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -285,8 +301,10 @@</span>             Self::Eip2930(tx) =&gt; tx.encode_for_signing(out),
             Self::Eip1559(tx) =&gt; tx.encode_for_signing(out),
             Self::Eip4844(tx) =&gt; tx.encode_for_signing(out),
             Self::Eip7702(tx) =&gt; tx.encode_for_signing(out),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(_) =&gt; {}
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(_) =&gt; {}</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -307,8 +325,10 @@</span>             Self::Eip4844(blob_tx) =&gt; blob_tx.eip2718_encode(signature, out),
             Self::Eip7702(set_code_tx) =&gt; {
                 set_code_tx.eip2718_encode(signature, out);
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(deposit_tx) =&gt; deposit_tx.eip2718_encode(out),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(l1_message_tx) =&gt; l1_message_tx.eip2718_encode(out),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -320,8 +340,10 @@</span>             Self::Eip2930(tx) =&gt; tx.gas_limit = gas_limit,
             Self::Eip1559(tx) =&gt; tx.gas_limit = gas_limit,
             Self::Eip4844(tx) =&gt; tx.gas_limit = gas_limit,
             Self::Eip7702(tx) =&gt; tx.gas_limit = gas_limit,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.gas_limit = gas_limit,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.gas_limit = gas_limit,</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -333,8 +355,10 @@</span>             Self::Eip2930(tx) =&gt; tx.nonce = nonce,
             Self::Eip1559(tx) =&gt; tx.nonce = nonce,
             Self::Eip4844(tx) =&gt; tx.nonce = nonce,
             Self::Eip7702(tx) =&gt; tx.nonce = nonce,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(_) =&gt; { &#47;* noop *&#47; }
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(_) =&gt; { &#47;* noop *&#47; }</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -346,8 +370,10 @@</span>             Self::Eip2930(tx) =&gt; tx.value = value,
             Self::Eip1559(tx) =&gt; tx.value = value,
             Self::Eip4844(tx) =&gt; tx.value = value,
             Self::Eip7702(tx) =&gt; tx.value = value,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.value = value,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.value = value,</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -359,8 +385,10 @@</span>             Self::Eip2930(tx) =&gt; tx.input = input,
             Self::Eip1559(tx) =&gt; tx.input = input,
             Self::Eip4844(tx) =&gt; tx.input = input,
             Self::Eip7702(tx) =&gt; tx.input = input,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.input = input,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.input = input,</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -392,6 +420,13 @@</span>     &#47;&#47;&#47; Returns true if the transaction is an EIP-7702 transaction.
     #[inline]
     pub const fn is_eip7702(&amp;self) -&gt; bool {
         matches!(self, Self::Eip7702(_))
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns true if the transaction is a Scroll L1 messaging transaction.</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+    #[inline]</span>
<span class="term-fg32">+    pub fn is_l1_message(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        matches!(self, Self::L1Message(_))</span>
     }
&nbsp;
     &#47;&#47;&#47; Returns the [`TxLegacy`] variant if the transaction is a legacy transaction.
<span class="term-fg36">@@ -445,8 +480,10 @@</span>             Self::Eip2930(tx) =&gt; tx.size(),
             Self::Eip1559(tx) =&gt; tx.size(),
             Self::Eip4844(tx) =&gt; tx.size(),
             Self::Eip7702(tx) =&gt; tx.size(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.size(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.size(),</span>
         }
     }
 }
<span class="term-fg36">@@ -476,8 +513,12 @@</span>             }
             Self::Eip7702(tx) =&gt; {
                 tx.to_compact(buf);
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; {
<span class="term-fg32">+                tx.to_compact(buf);</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; {</span>
                 tx.to_compact(buf);
             }
         }
<span class="term-fg36">@@ -524,11 +565,16 @@</span>                     alloy_consensus::constants::EIP7702_TX_TYPE_ID =&gt; {
                         let (tx, buf) = TxEip7702::from_compact(buf, buf.len());
                         (Self::Eip7702(tx), buf)
                     }
<span class="term-fg31">-                    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                     op_alloy_consensus::DEPOSIT_TX_TYPE_ID =&gt; {
                         let (tx, buf) = TxDeposit::from_compact(buf, buf.len());
                         (Self::Deposit(tx), buf)
                     }
<span class="term-fg32">+                    #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                    reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE =&gt; {</span>
<span class="term-fg32">+                        let (tx, buf) = TxL1Message::from_compact(buf, buf.len());</span>
<span class="term-fg32">+                        (Self::L1Message(tx), buf)</span>
<span class="term-fg32">+                    }</span>
                     _ =&gt; unreachable!(
                         &quot;Junk data in database: unknown Transaction variant: {identifier}&quot;
                     ),
<span class="term-fg36">@@ -553,8 +599,10 @@</span>             Self::Eip2930(tx) =&gt; tx.chain_id(),
             Self::Eip1559(tx) =&gt; tx.chain_id(),
             Self::Eip4844(tx) =&gt; tx.chain_id(),
             Self::Eip7702(tx) =&gt; tx.chain_id(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.chain_id(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.chain_id(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -565,8 +613,10 @@</span>             Self::Eip2930(tx) =&gt; tx.nonce(),
             Self::Eip1559(tx) =&gt; tx.nonce(),
             Self::Eip4844(tx) =&gt; tx.nonce(),
             Self::Eip7702(tx) =&gt; tx.nonce(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.nonce(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.nonce(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -577,8 +627,10 @@</span>             Self::Eip2930(tx) =&gt; tx.gas_limit(),
             Self::Eip1559(tx) =&gt; tx.gas_limit(),
             Self::Eip4844(tx) =&gt; tx.gas_limit(),
             Self::Eip7702(tx) =&gt; tx.gas_limit(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.gas_limit(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.gas_limit(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -589,8 +641,10 @@</span>             Self::Eip2930(tx) =&gt; tx.gas_price(),
             Self::Eip1559(tx) =&gt; tx.gas_price(),
             Self::Eip4844(tx) =&gt; tx.gas_price(),
             Self::Eip7702(tx) =&gt; tx.gas_price(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.gas_price(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.gas_price(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -601,8 +655,10 @@</span>             Self::Eip2930(tx) =&gt; tx.max_fee_per_gas(),
             Self::Eip1559(tx) =&gt; tx.max_fee_per_gas(),
             Self::Eip4844(tx) =&gt; tx.max_fee_per_gas(),
             Self::Eip7702(tx) =&gt; tx.max_fee_per_gas(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.max_fee_per_gas(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.max_fee_per_gas(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -613,8 +669,10 @@</span>             Self::Eip2930(tx) =&gt; tx.max_priority_fee_per_gas(),
             Self::Eip1559(tx) =&gt; tx.max_priority_fee_per_gas(),
             Self::Eip4844(tx) =&gt; tx.max_priority_fee_per_gas(),
             Self::Eip7702(tx) =&gt; tx.max_priority_fee_per_gas(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.max_priority_fee_per_gas(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.max_priority_fee_per_gas(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -625,8 +683,10 @@</span>             Self::Eip2930(tx) =&gt; tx.max_fee_per_blob_gas(),
             Self::Eip1559(tx) =&gt; tx.max_fee_per_blob_gas(),
             Self::Eip4844(tx) =&gt; tx.max_fee_per_blob_gas(),
             Self::Eip7702(tx) =&gt; tx.max_fee_per_blob_gas(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.max_fee_per_blob_gas(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.max_fee_per_blob_gas(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -637,8 +697,10 @@</span>             Self::Eip2930(tx) =&gt; tx.priority_fee_or_price(),
             Self::Eip1559(tx) =&gt; tx.priority_fee_or_price(),
             Self::Eip4844(tx) =&gt; tx.priority_fee_or_price(),
             Self::Eip7702(tx) =&gt; tx.priority_fee_or_price(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.priority_fee_or_price(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.priority_fee_or_price(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -649,8 +711,10 @@</span>             Self::Eip2930(tx) =&gt; tx.effective_gas_price(base_fee),
             Self::Eip1559(tx) =&gt; tx.effective_gas_price(base_fee),
             Self::Eip4844(tx) =&gt; tx.effective_gas_price(base_fee),
             Self::Eip7702(tx) =&gt; tx.effective_gas_price(base_fee),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.effective_gas_price(base_fee),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.effective_gas_price(base_fee),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -658,8 +722,10 @@</span>     fn is_dynamic_fee(&amp;self) -&gt; bool {
         match self {
             Self::Legacy(_) | Self::Eip2930(_) =&gt; false,
             Self::Eip1559(_) | Self::Eip4844(_) | Self::Eip7702(_) =&gt; true,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(_) =&gt; false,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.is_dynamic_fee(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -670,8 +736,10 @@</span>             Self::Eip2930(tx) =&gt; tx.kind(),
             Self::Eip1559(tx) =&gt; tx.kind(),
             Self::Eip4844(tx) =&gt; tx.kind(),
             Self::Eip7702(tx) =&gt; tx.kind(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.kind(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.kind(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -682,8 +750,10 @@</span>             Self::Eip2930(tx) =&gt; tx.value(),
             Self::Eip1559(tx) =&gt; tx.value(),
             Self::Eip4844(tx) =&gt; tx.value(),
             Self::Eip7702(tx) =&gt; tx.value(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.value(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.value(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -694,8 +764,10 @@</span>             Self::Eip2930(tx) =&gt; tx.input(),
             Self::Eip1559(tx) =&gt; tx.input(),
             Self::Eip4844(tx) =&gt; tx.input(),
             Self::Eip7702(tx) =&gt; tx.input(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.input(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.input(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -706,8 +778,10 @@</span>             Self::Eip2930(tx) =&gt; tx.ty(),
             Self::Eip1559(tx) =&gt; tx.ty(),
             Self::Eip4844(tx) =&gt; tx.ty(),
             Self::Eip7702(tx) =&gt; tx.ty(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.ty(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.ty(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -718,8 +792,10 @@</span>             Self::Eip2930(tx) =&gt; tx.access_list(),
             Self::Eip1559(tx) =&gt; tx.access_list(),
             Self::Eip4844(tx) =&gt; tx.access_list(),
             Self::Eip7702(tx) =&gt; tx.access_list(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.access_list(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.access_list(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -730,8 +806,10 @@</span>             Self::Eip2930(tx) =&gt; tx.blob_versioned_hashes(),
             Self::Eip1559(tx) =&gt; tx.blob_versioned_hashes(),
             Self::Eip4844(tx) =&gt; tx.blob_versioned_hashes(),
             Self::Eip7702(tx) =&gt; tx.blob_versioned_hashes(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.blob_versioned_hashes(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.blob_versioned_hashes(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -742,8 +820,10 @@</span>             Self::Eip2930(tx) =&gt; tx.authorization_list(),
             Self::Eip1559(tx) =&gt; tx.authorization_list(),
             Self::Eip4844(tx) =&gt; tx.authorization_list(),
             Self::Eip7702(tx) =&gt; tx.authorization_list(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.authorization_list(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.authorization_list(),</span>
         }
     }
 }
<span class="term-fg36">@@ -799,9 +879,14 @@</span>     &#47;&#47;&#47; Returns `None` if the transaction&#39;s signature is invalid, see also [`Self::recover_signer`].
     pub fn recover_signer(&amp;self) -&gt; Option&lt;Address&gt; {
         &#47;&#47; Optimism&#39;s Deposit transaction does not have a signature. Directly return the
         &#47;&#47; `from` address.
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         if let Transaction::Deposit(TxDeposit { from, .. }) = self.transaction {
             return Some(from)
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        &#47;&#47; Scroll L1 messages don&#39;t have a signature.</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+        if let Transaction::L1Message(TxL1Message { sender, .. }) = self.transaction {</span>
<span class="term-fg32">+            return Some(sender)</span>
         }
&nbsp;
         let signature_hash = self.signature_hash();
<span class="term-fg36">@@ -827,7 +912,7 @@</span>         self.transaction.encode_for_signing(buffer);
&nbsp;
         &#47;&#47; Optimism&#39;s Deposit transaction does not have a signature. Directly return the
         &#47;&#47; `from` address.
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         {
             if let Transaction::Deposit(TxDeposit { from, .. }) = self.transaction {
                 return Some(from)
<span class="term-fg36">@@ -840,6 +925,10 @@</span>             &#47;&#47; NOTE: this is very hacky and only relevant for op-mainnet pre bedrock
             if self.is_legacy() &amp;&amp; self.signature == TxDeposit::signature() {
                 return Some(Address::ZERO)
             }
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+        if let Transaction::L1Message(TxL1Message { sender, .. }) = self.transaction {</span>
<span class="term-fg32">+            return Some(sender)</span>
         }
&nbsp;
         recover_signer_unchecked(&amp;self.signature, keccak256(buffer))
<span class="term-fg36">@@ -1237,9 +1326,13 @@</span>
     fn recover_signer(&amp;self) -&gt; Option&lt;Address&gt; {
         &#47;&#47; Optimism&#39;s Deposit transaction does not have a signature. Directly return the
         &#47;&#47; `from` address.
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         if let Transaction::Deposit(TxDeposit { from, .. }) = self.transaction {
             return Some(from)
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+        if let Transaction::L1Message(TxL1Message { sender, .. }) = self.transaction {</span>
<span class="term-fg32">+            return Some(sender)</span>
         }
         let signature_hash = self.signature_hash();
         recover_signer(&amp;self.signature, signature_hash)
<span class="term-fg36">@@ -1248,9 +1341,13 @@</span>
     fn recover_signer_unchecked(&amp;self) -&gt; Option&lt;Address&gt; {
         &#47;&#47; Optimism&#39;s Deposit transaction does not have a signature. Directly return the
         &#47;&#47; `from` address.
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         if let Transaction::Deposit(TxDeposit { from, .. }) = self.transaction {
             return Some(from)
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+        if let Transaction::L1Message(TxL1Message { sender, .. }) = self.transaction {</span>
<span class="term-fg32">+            return Some(sender)</span>
         }
         let signature_hash = self.signature_hash();
         recover_signer_unchecked(&amp;self.signature, signature_hash)
<span class="term-fg36">@@ -1332,8 +1429,10 @@</span>                 tx_env.max_fee_per_blob_gas.take();
                 tx_env.authorization_list =
                     Some(AuthorizationList::Signed(tx.authorization_list.clone()));
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Transaction::Deposit(_) =&gt; {}
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Transaction::L1Message(_) =&gt; {}</span>
         }
     }
 }
<span class="term-fg36">@@ -1497,8 +1596,10 @@</span>             Transaction::Eip4844(blob_tx) =&gt; blob_tx.eip2718_encoded_length(&amp;self.signature),
             Transaction::Eip7702(set_code_tx) =&gt; {
                 set_code_tx.eip2718_encoded_length(&amp;self.signature)
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Transaction::Deposit(deposit_tx) =&gt; deposit_tx.eip2718_encoded_length(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Transaction::L1Message(l1_message_tx) =&gt; l1_message_tx.eip2718_encoded_length(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -1531,10 +1632,15 @@</span>             TxType::Eip4844 =&gt; {
                 let (tx, signature, hash) = TxEip4844::rlp_decode_signed(buf)?.into_parts();
                 Ok(Self { transaction: Transaction::Eip4844(tx), signature, hash: hash.into() })
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             TxType::Deposit =&gt; Ok(Self::new_unhashed(
                 Transaction::Deposit(TxDeposit::rlp_decode(buf)?),
                 TxDeposit::signature(),
<span class="term-fg32">+            )),</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            TxType::L1Message =&gt; Ok(Self::new_unhashed(</span>
<span class="term-fg32">+                Transaction::L1Message(TxL1Message::rlp_decode(buf)?),</span>
<span class="term-fg32">+                TxL1Message::signature(),</span>
             )),
         }
     }
<span class="term-fg36">@@ -1587,18 +1693,22 @@</span>             transaction.signature_hash(),
         )
         .unwrap();
&nbsp;
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
         &#47;&#47; Both `Some(0)` and `None` values are encoded as empty string byte. This introduces
         &#47;&#47; ambiguity in roundtrip tests. Patch the mint value of deposit transaction here, so that
         &#47;&#47; it&#39;s `None` if zero.
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         if let Transaction::Deposit(ref mut tx_deposit) = transaction {
             if tx_deposit.mint == Some(0) {
                 tx_deposit.mint = None;
             }
         }
&nbsp;
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         let signature = if transaction.is_deposit() { TxDeposit::signature() } else { signature };
<span class="term-fg32">+        #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+        let signature =</span>
<span class="term-fg32">+            if transaction.is_l1_message() { TxL1Message::signature() } else { signature };</span>
<span class="term-fg32">+</span>
         Ok(Self::new_unhashed(transaction, signature))
     }
 }
<span class="term-fg36">@@ -1722,8 +1832,10 @@</span>         Eip2930(TxEip2930&lt;&#39;a&gt;),
         Eip1559(TxEip1559&lt;&#39;a&gt;),
         Eip4844(Cow&lt;&#39;a, TxEip4844&gt;),
         Eip7702(TxEip7702&lt;&#39;a&gt;),
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         Deposit(op_alloy_consensus::serde_bincode_compat::TxDeposit&lt;&#39;a&gt;),
<span class="term-fg32">+        #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+        L1Message(Cow&lt;&#39;a, reth_scroll_primitives::l1_transaction::TxL1Message&gt;),</span>
     }
&nbsp;
     impl&lt;&#39;a&gt; From&lt;&amp;&#39;a super::Transaction&gt; for Transaction&lt;&#39;a&gt; {
<span class="term-fg36">@@ -1734,10 +1846,12 @@</span>                 super::Transaction::Eip2930(tx) =&gt; Self::Eip2930(TxEip2930::from(tx)),
                 super::Transaction::Eip1559(tx) =&gt; Self::Eip1559(TxEip1559::from(tx)),
                 super::Transaction::Eip4844(tx) =&gt; Self::Eip4844(Cow::Borrowed(tx)),
                 super::Transaction::Eip7702(tx) =&gt; Self::Eip7702(TxEip7702::from(tx)),
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 super::Transaction::Deposit(tx) =&gt; {
                     Self::Deposit(op_alloy_consensus::serde_bincode_compat::TxDeposit::from(tx))
                 }
<span class="term-fg32">+                #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                super::Transaction::L1Message(tx) =&gt; Self::L1Message(Cow::Borrowed(tx)),</span>
             }
         }
     }
<span class="term-fg36">@@ -1750,8 +1864,10 @@</span>                 Transaction::Eip2930(tx) =&gt; Self::Eip2930(tx.into()),
                 Transaction::Eip1559(tx) =&gt; Self::Eip1559(tx.into()),
                 Transaction::Eip4844(tx) =&gt; Self::Eip4844(tx.into_owned()),
                 Transaction::Eip7702(tx) =&gt; Self::Eip7702(tx.into()),
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 Transaction::Deposit(tx) =&gt; Self::Deposit(tx.into()),
<span class="term-fg32">+                #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                Transaction::L1Message(tx) =&gt; Self::L1Message(tx.into_owned()),</span>
             }
         }
     }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b90ab83ee58fdf81942787ad" role="button"
                       aria-expanded="false" aria-controls="id-b90ab83ee58fdf81942787ad">
                        <code>crates/primitives/src/transaction/pooled.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/transaction/pooled.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/primitives/src/transaction/pooled.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b90ab83ee58fdf81942787ad"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;pooled.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;pooled.rs</span>
<span class="term-fg1">index 145660f44c712b6814abb543f0bc6e958bb0d379..078e150b212ffa610cf7e7983a7572d824d1c85c 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;pooled.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;pooled.rs</span>
<span class="term-fg36">@@ -69,9 +69,12 @@</span>                 Ok(Self::Eip7702(Signed::new_unchecked(tx, signature, hash)))
             }
             &#47;&#47; Not supported because missing blob sidecar
             tx @ TransactionSigned { transaction: Transaction::Eip4844(_), .. } =&gt; Err(tx),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             &#47;&#47; Not supported because deposit transactions are never pooled
             tx @ TransactionSigned { transaction: Transaction::Deposit(_), .. } =&gt; Err(tx),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            &#47;&#47; Not supported because l1 message transactions are never pooled</span>
<span class="term-fg32">+            tx @ TransactionSigned { transaction: Transaction::L1Message(_), .. } =&gt; Err(tx),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -384,8 +387,10 @@</span>                         Signed::new_unchecked(tx, typed_tx.signature, hash)
                     )),
                     Transaction::Eip1559(tx) =&gt; Ok(Self::Eip1559( Signed::new_unchecked(tx, typed_tx.signature, hash))),
                     Transaction::Eip7702(tx) =&gt; Ok(Self::Eip7702( Signed::new_unchecked(tx, typed_tx.signature, hash))),
<span class="term-fg31">-                    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg31">-                    Transaction::Deposit(_) =&gt; Err(RlpError::Custom(&quot;Optimism deposit transaction cannot be decoded to PooledTransactionsElement&quot;).into())</span>
<span class="term-fg32">+                    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
<span class="term-fg32">+                    Transaction::Deposit(_) =&gt; Err(RlpError::Custom(&quot;Optimism deposit transaction cannot be decoded to PooledTransactionsElement&quot;).into()),</span>
<span class="term-fg32">+                    #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                    Transaction::L1Message(_) =&gt; Err(RlpError::Custom(&quot;Scroll L1 message transaction cannot be decoded to PooledTransactionsElement&quot;).into())</span>
                 }
             }
         }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e996d8cf7609284eb0dd9c8a" role="button"
                       aria-expanded="false" aria-controls="id-e996d8cf7609284eb0dd9c8a">
                        <code>crates/primitives/src/transaction/tx_type.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/transaction/tx_type.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/primitives/src/transaction/tx_type.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+40</span></div>
                            <div class="text-start"><span class="text-danger">-10</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e996d8cf7609284eb0dd9c8a"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;tx_type.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;tx_type.rs</span>
<span class="term-fg1">index 784a976ab792b1bc5273f24e79a9c23055707681..9a2b0119124cdebec9d18749b05ff7ba813a8579 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;tx_type.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;tx_type.rs</span>
<span class="term-fg36">@@ -68,9 +68,13 @@</span>     &#47;&#47;&#47; EOA Contract Code Transactions - EIP-7702
     #[display(&quot;eip7702 (4)&quot;)]
     Eip7702 = 4_isize,
     &#47;&#47;&#47; Optimism Deposit transaction.
<span class="term-fg31">-    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
     #[display(&quot;deposit (126)&quot;)]
     Deposit = 126_isize,
<span class="term-fg32">+    &#47;&#47;&#47; Scroll L1 message transaction.</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+    #[display(&quot;l1 message (126)&quot;)]</span>
<span class="term-fg32">+    L1Message = 126_isize,</span>
 }
&nbsp;
 impl TxType {
<span class="term-fg36">@@ -82,8 +86,10 @@</span>     pub const fn has_access_list(&amp;self) -&gt; bool {
         match self {
             Self::Legacy =&gt; false,
             Self::Eip2930 | Self::Eip1559 | Self::Eip4844 | Self::Eip7702 =&gt; true,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit =&gt; false,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message =&gt; false,</span>
         }
     }
 }
<span class="term-fg36">@@ -131,8 +137,10 @@</span>             TxType::Eip2930 =&gt; EIP2930_TX_TYPE_ID,
             TxType::Eip1559 =&gt; EIP1559_TX_TYPE_ID,
             TxType::Eip4844 =&gt; EIP4844_TX_TYPE_ID,
             TxType::Eip7702 =&gt; EIP7702_TX_TYPE_ID,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             TxType::Deposit =&gt; op_alloy_consensus::DEPOSIT_TX_TYPE_ID,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            TxType::L1Message =&gt; reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE,</span>
         }
     }
 }
<span class="term-fg36">@@ -147,9 +155,14 @@</span> impl TryFrom&lt;u8&gt; for TxType {
     type Error = &amp;&#39;static str;
&nbsp;
     fn try_from(value: u8) -&gt; Result&lt;Self, Self::Error&gt; {
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         if value == Self::Deposit {
             return Ok(Self::Deposit)
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+        if value == Self::L1Message {</span>
<span class="term-fg32">+            return Ok(Self::L1Message)</span>
         }
&nbsp;
         if value == Self::Legacy {
<span class="term-fg36">@@ -205,11 +218,16 @@</span>             Self::Eip7702 =&gt; {
                 buf.put_u8(EIP7702_TX_TYPE_ID);
                 COMPACT_EXTENDED_IDENTIFIER_FLAG
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit =&gt; {
                 buf.put_u8(op_alloy_consensus::DEPOSIT_TX_TYPE_ID);
                 COMPACT_EXTENDED_IDENTIFIER_FLAG
             }
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message =&gt; {</span>
<span class="term-fg32">+                buf.put_u8(reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE);</span>
<span class="term-fg32">+                COMPACT_EXTENDED_IDENTIFIER_FLAG</span>
<span class="term-fg32">+            }</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -228,8 +246,10 @@</span>                     let extended_identifier = buf.get_u8();
                     match extended_identifier {
                         EIP4844_TX_TYPE_ID =&gt; Self::Eip4844,
                         EIP7702_TX_TYPE_ID =&gt; Self::Eip7702,
<span class="term-fg31">-                        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                         op_alloy_consensus::DEPOSIT_TX_TYPE_ID =&gt; Self::Deposit,
<span class="term-fg32">+                        #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                        reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE =&gt; Self::L1Message,</span>
                         _ =&gt; panic!(&quot;Unsupported TxType identifier: {extended_identifier}&quot;),
                     }
                 }
<span class="term-fg36">@@ -292,9 +312,16 @@</span>     #[case(U64::from(EIP1559_TX_TYPE_ID), Ok(TxType::Eip1559))]
     #[case(U64::from(EIP4844_TX_TYPE_ID), Ok(TxType::Eip4844))]
     #[case(U64::from(EIP7702_TX_TYPE_ID), Ok(TxType::Eip7702))]
     #[cfg_attr(
<span class="term-fg31">-        feature = &quot;optimism&quot;,</span>
<span class="term-fg32">+        all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)),</span>
         case(U64::from(op_alloy_consensus::DEPOSIT_TX_TYPE_ID), Ok(TxType::Deposit))
     )]
<span class="term-fg32">+    #[cfg_attr(</span>
<span class="term-fg32">+        all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)),</span>
<span class="term-fg32">+        case(</span>
<span class="term-fg32">+            U64::from(reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE),</span>
<span class="term-fg32">+            Ok(TxType::L1Message)</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+    )]</span>
     #[case(U64::MAX, Err(&quot;invalid tx type&quot;))]
     fn test_u64_to_tx_type(#[case] input: U64, #[case] expected: Result&lt;TxType, &amp;&#39;static str&gt;) {
         let tx_type_result = TxType::try_from(input);
<span class="term-fg36">@@ -307,7 +334,8 @@</span>     #[case(TxType::Eip2930, COMPACT_IDENTIFIER_EIP2930, vec![])]
     #[case(TxType::Eip1559, COMPACT_IDENTIFIER_EIP1559, vec![])]
     #[case(TxType::Eip4844, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![EIP4844_TX_TYPE_ID])]
     #[case(TxType::Eip7702, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![EIP7702_TX_TYPE_ID])]
<span class="term-fg31">-    #[cfg_attr(feature = &quot;optimism&quot;, case(TxType::Deposit, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![op_alloy_consensus::DEPOSIT_TX_TYPE_ID]))]</span>
<span class="term-fg32">+    #[cfg_attr(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)), case(TxType::Deposit, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![op_alloy_consensus::DEPOSIT_TX_TYPE_ID]))]</span>
<span class="term-fg32">+    #[cfg_attr(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)), case(TxType::L1Message, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE]))]</span>
     fn test_txtype_to_compact(
         #[case] tx_type: TxType,
         #[case] expected_identifier: usize,
<span class="term-fg36">@@ -326,7 +354,8 @@</span>     #[case(TxType::Eip2930, COMPACT_IDENTIFIER_EIP2930, vec![])]
     #[case(TxType::Eip1559, COMPACT_IDENTIFIER_EIP1559, vec![])]
     #[case(TxType::Eip4844, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![EIP4844_TX_TYPE_ID])]
     #[case(TxType::Eip7702, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![EIP7702_TX_TYPE_ID])]
<span class="term-fg31">-    #[cfg_attr(feature = &quot;optimism&quot;, case(TxType::Deposit, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![op_alloy_consensus::DEPOSIT_TX_TYPE_ID]))]</span>
<span class="term-fg32">+    #[cfg_attr(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)), case(TxType::Deposit, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![op_alloy_consensus::DEPOSIT_TX_TYPE_ID]))]</span>
<span class="term-fg32">+    #[cfg_attr(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)), case(TxType::L1Message, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE]))]</span>
     fn test_txtype_from_compact(
         #[case] expected_type: TxType,
         #[case] identifier: usize,
<span class="term-fg36">@@ -345,7 +374,8 @@</span>     #[case(&amp;[EIP1559_TX_TYPE_ID], Ok(TxType::Eip1559))]
     #[case(&amp;[EIP4844_TX_TYPE_ID], Ok(TxType::Eip4844))]
     #[case(&amp;[EIP7702_TX_TYPE_ID], Ok(TxType::Eip7702))]
     #[case(&amp;[u8::MAX], Err(alloy_rlp::Error::InputTooShort))]
<span class="term-fg31">-    #[cfg_attr(feature = &quot;optimism&quot;, case(&amp;[op_alloy_consensus::DEPOSIT_TX_TYPE_ID], Ok(TxType::Deposit)))]</span>
<span class="term-fg32">+    #[cfg_attr(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)), case(&amp;[op_alloy_consensus::DEPOSIT_TX_TYPE_ID], Ok(TxType::Deposit)))]</span>
<span class="term-fg32">+    #[cfg_attr(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)), case(&amp;[reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE], Ok(TxType::L1Message)))]</span>
     fn decode_tx_type(#[case] input: &amp;[u8], #[case] expected: Result&lt;TxType, alloy_rlp::Error&gt;) {
         let tx_type_result = TxType::decode(&amp;mut &amp;input[..]);
         assert_eq!(tx_type_result, expected)</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-18d4edb1c64fa61baf237a3c"role="button" aria-expanded="false" aria-controls="id-18d4edb1c64fa61baf237a3c">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/stages</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+108</span></div>
                    <div class="text-start"><span class="text-danger">-14</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-18d4edb1c64fa61baf237a3c">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9293d4918476944e88e6bba4" role="button"
                       aria-expanded="false" aria-controls="id-9293d4918476944e88e6bba4">
                        <code>crates/stages/stages/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/stages/stages/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/stages/stages/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+21</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9293d4918476944e88e6bba4"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;Cargo.toml scroll-reth&#47;crates&#47;stages&#47;stages&#47;Cargo.toml</span>
<span class="term-fg1">index f97214f4643329336c9b061504d22960f9d6d869..691d618e4fc6f952f8f3696225da531b7b34e397 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;Cargo.toml</span>
<span class="term-fg36">@@ -39,6 +39,10 @@</span> reth-trie-db = { workspace = true, features = [&quot;metrics&quot;] }
&nbsp;
 reth-testing-utils = { workspace = true, optional = true }
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 alloy-eips.workspace = true
 alloy-primitives.workspace = true
 alloy-consensus.workspace = true
<span class="term-fg36">@@ -74,6 +78,8 @@</span> reth-testing-utils.workspace = true
 reth-trie = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-provider = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-network-peers.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
&nbsp;
 alloy-rlp.workspace = true
 itertools.workspace = true
<span class="term-fg36">@@ -114,6 +120,21 @@</span>     &quot;reth-db-api&#47;test-utils&quot;,
     &quot;reth-trie-db&#47;test-utils&quot;,
     &quot;reth-trie&#47;test-utils&quot;,
     &quot;reth-prune-types&#47;test-utils&quot;,
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-testing-utils?&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm-ethereum&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-exex&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-storage&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-primitives&quot;</span>
 ]
&nbsp;
 [[bench]]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-018d4ad26f7c923f4bc3b8e8" role="button"
                       aria-expanded="false" aria-controls="id-018d4ad26f7c923f4bc3b8e8">
                        <code>crates/stages/stages/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/stages/stages/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/stages/stages/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-018d4ad26f7c923f4bc3b8e8"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;lib.rs</span>
<span class="term-fg1">index ce6a96cf3496aa9ea2af7181fe93c5339fb5f8a0..f21cbc9b2e144683a9ef8d3ef3bbd5ef0b83c47e 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -80,6 +80,8 @@</span> )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
&nbsp;
<span class="term-fg32">+use reth_revm as _;</span>
<span class="term-fg32">+</span>
 #[allow(missing_docs)]
 #[cfg(any(test, feature = &quot;test-utils&quot;))]
 pub mod test_utils;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8a1b7f6d7826a9fb47bd0023" role="button"
                       aria-expanded="false" aria-controls="id-8a1b7f6d7826a9fb47bd0023">
                        <code>crates/stages/stages/src/stages/execution.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/stages/stages/src/stages/execution.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/stages/stages/src/stages/execution.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+68</span></div>
                            <div class="text-start"><span class="text-danger">-13</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8a1b7f6d7826a9fb47bd0023"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;execution.rs scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;execution.rs</span>
<span class="term-fg1">index ce969f2577d8372605a69b3706f163ef3e069b48..64f6d5accba148f2ab723898c71149c0fc10ee57 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;execution.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;execution.rs</span>
<span class="term-fg36">@@ -20,7 +20,6 @@</span>     OriginalValuesKnown, ProviderError, StateCommitmentProvider, StateWriter,
     StaticFileProviderFactory, StatsReader, StorageLocation, TransactionVariant,
 };
 use reth_prune_types::PruneModes;
<span class="term-fg31">-use reth_revm::database::StateProviderDatabase;</span>
 use reth_stages_api::{
     BlockErrorKind, CheckpointBlockRange, EntitiesCheckpoint, ExecInput, ExecOutput,
     ExecutionCheckpoint, ExecutionStageThresholds, Stage, StageCheckpoint, StageError, StageId,
<span class="term-fg36">@@ -294,7 +293,11 @@</span>         let static_file_provider = provider.static_file_provider();
&nbsp;
         self.ensure_consistency(provider, input.checkpoint().block_number, None)?;
&nbsp;
<span class="term-fg31">-        let db = StateProviderDatabase(LatestStateProviderRef::new(provider));</span>
<span class="term-fg32">+        let state = LatestStateProviderRef::new(provider);</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let db = reth_scroll_storage::ScrollStateProviderDatabase::new(state);</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let db = reth_revm::database::StateProviderDatabase(state);</span>
         let mut executor = self.executor_provider.batch_executor(db);
         executor.set_tip(max_block);
         executor.set_prune_modes(prune_modes);
<span class="term-fg36">@@ -853,13 +856,27 @@</span>         let code_hash = keccak256(code);
         db_tx
             .put::&lt;tables::PlainAccountState&gt;(
                 acc1,
<span class="term-fg31">-                Account { nonce: 0, balance: U256::ZERO, bytecode_hash: Some(code_hash) },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance: U256::ZERO,</span>
<span class="term-fg32">+                    bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code),</span>
<span class="term-fg32">+                    ),</span>
<span class="term-fg32">+                },</span>
             )
             .unwrap();
         db_tx
             .put::&lt;tables::PlainAccountState&gt;(
                 acc2,
<span class="term-fg31">-                Account { nonce: 0, balance, bytecode_hash: None },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance,</span>
<span class="term-fg32">+                    bytecode_hash: None,</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                },</span>
             )
             .unwrap();
         db_tx.put::&lt;tables::Bytecodes&gt;(code_hash, Bytecode::new_raw(code.to_vec().into())).unwrap();
<span class="term-fg36">@@ -910,19 +927,30 @@</span>             let provider = factory.provider().unwrap();
&nbsp;
             &#47;&#47; check post state
             let account1 = address!(&quot;1000000000000000000000000000000000000000&quot;);
<span class="term-fg31">-            let account1_info =</span>
<span class="term-fg31">-                Account { balance: U256::ZERO, nonce: 0x00, bytecode_hash: Some(code_hash) };</span>
<span class="term-fg32">+            let account1_info = Account {</span>
<span class="term-fg32">+                balance: U256::ZERO,</span>
<span class="term-fg32">+                nonce: 0x00,</span>
<span class="term-fg32">+                bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                    &amp;code,</span>
<span class="term-fg32">+                )),</span>
<span class="term-fg32">+            };</span>
             let account2 = address!(&quot;2adc25665018aa1fe0e6bc666dac8fc2697ff9ba&quot;);
             let account2_info = Account {
                 balance: U256::from(0x1bc16d674ece94bau128),
                 nonce: 0x00,
                 bytecode_hash: None,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
             };
             let account3 = address!(&quot;a94f5374fce5edbc8e2a8697c15331677e6ebf0b&quot;);
             let account3_info = Account {
                 balance: U256::from(0x3635c9adc5de996b46u128),
                 nonce: 0x01,
                 bytecode_hash: None,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
             };
&nbsp;
             &#47;&#47; assert accounts
<span class="term-fg36">@@ -999,9 +1027,21 @@</span>         let provider = factory.provider_rw().unwrap();
&nbsp;
         let db_tx = provider.tx_ref();
         let acc1 = address!(&quot;1000000000000000000000000000000000000000&quot;);
<span class="term-fg31">-        let acc1_info = Account { nonce: 0, balance: U256::ZERO, bytecode_hash: Some(code_hash) };</span>
<span class="term-fg32">+        let acc1_info = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code)),</span>
<span class="term-fg32">+        };</span>
         let acc2 = address!(&quot;a94f5374fce5edbc8e2a8697c15331677e6ebf0b&quot;);
<span class="term-fg31">-        let acc2_info = Account { nonce: 0, balance, bytecode_hash: None };</span>
<span class="term-fg32">+        let acc2_info = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
&nbsp;
         db_tx.put::&lt;tables::PlainAccountState&gt;(acc1, acc1_info).unwrap();
         db_tx.put::&lt;tables::PlainAccountState&gt;(acc2, acc2_info).unwrap();
<span class="term-fg36">@@ -1120,9 +1160,20 @@</span>         let balance = U256::from(0x0de0b6b3a7640000u64);
         let code_hash = keccak256(code);
&nbsp;
         &#47;&#47; pre state
<span class="term-fg31">-        let caller_info = Account { nonce: 0, balance, bytecode_hash: None };</span>
<span class="term-fg31">-        let destroyed_info =</span>
<span class="term-fg31">-            Account { nonce: 0, balance: U256::ZERO, bytecode_hash: Some(code_hash) };</span>
<span class="term-fg32">+        let caller_info = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let destroyed_info = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code)),</span>
<span class="term-fg32">+        };</span>
&nbsp;
         &#47;&#47; set account
         let provider = test_db.factory.provider_rw().unwrap();
<span class="term-fg36">@@ -1181,7 +1232,9 @@</span>                     beneficiary_address,
                     Account {
                         nonce: 0,
                         balance: U256::from(0x1bc16d674eca30a0u64),
<span class="term-fg31">-                        bytecode_hash: None</span>
<span class="term-fg32">+                        bytecode_hash: None,</span>
<span class="term-fg32">+                        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                        account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
                     }
                 ),
                 (
<span class="term-fg36">@@ -1189,7 +1242,9 @@</span>                     caller_address,
                     Account {
                         nonce: 1,
                         balance: U256::from(0xde0b6b3a761cf60u64),
<span class="term-fg31">-                        bytecode_hash: None</span>
<span class="term-fg32">+                        bytecode_hash: None,</span>
<span class="term-fg32">+                        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                        account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
                     }
                 )
             ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cebf68835ec95270cc3c4bd1" role="button"
                       aria-expanded="false" aria-controls="id-cebf68835ec95270cc3c4bd1">
                        <code>crates/stages/stages/src/stages/hashing_account.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/stages/stages/src/stages/hashing_account.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/stages/stages/src/stages/hashing_account.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cebf68835ec95270cc3c4bd1"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_account.rs scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_account.rs</span>
<span class="term-fg1">index e6b1e548455fa8d42a6ab23d99c893d9ebe6800e..895943b83a9296a5fa1a65b94d183e5fd4839656 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_account.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_account.rs</span>
<span class="term-fg36">@@ -109,6 +109,8 @@</span>                 let prev_acc = Account {
                     nonce: nonce - 1,
                     balance: balance - U256::from(1),
                     bytecode_hash: None,
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
                 };
                 let acc_before_tx = AccountBeforeTx { address: *addr, info: Some(prev_acc) };
                 acc_changeset_cursor.append(t, acc_before_tx)?;
<span class="term-fg36">@@ -403,6 +405,10 @@</span>                         let old_acc = Account {
                             nonce: nonce - 1,
                             balance: balance - U256::from(1),
                             bytecode_hash: None,
<span class="term-fg32">+                            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                            account_extension: Some(</span>
<span class="term-fg32">+                                reth_scroll_primitives::AccountExtension::empty(),</span>
<span class="term-fg32">+                            ),</span>
                         };
                         let hashed_addr = keccak256(address);
                         if let Some((_, acc)) = hashed_acc_cursor.seek_exact(hashed_addr)? {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b3a0fce4d46b1aa2bf8a3431" role="button"
                       aria-expanded="false" aria-controls="id-b3a0fce4d46b1aa2bf8a3431">
                        <code>crates/stages/stages/src/stages/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/stages/stages/src/stages/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/stages/stages/src/stages/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b3a0fce4d46b1aa2bf8a3431"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;mod.rs scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;mod.rs</span>
<span class="term-fg1">index 9d7cc685a7ef7875fef1d39fa5557cebe8f06271..b0bcebd5e9a7bd93faddcba27b9a8f0f5d2d3582 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;mod.rs</span>
<span class="term-fg36">@@ -117,7 +117,15 @@</span>         provider_rw
             .tx_ref()
             .put::&lt;tables::PlainAccountState&gt;(
                 address!(&quot;1000000000000000000000000000000000000000&quot;),
<span class="term-fg31">-                Account { nonce: 0, balance: U256::ZERO, bytecode_hash: Some(code_hash) },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance: U256::ZERO,</span>
<span class="term-fg32">+                    bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code),</span>
<span class="term-fg32">+                    ),</span>
<span class="term-fg32">+                },</span>
             )
             .unwrap();
         provider_rw
<span class="term-fg36">@@ -128,6 +136,8 @@</span>                 Account {
                     nonce: 0,
                     balance: U256::from(0x3635c9adc5dea00000u128),
                     bytecode_hash: None,
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
                 },
             )
             .unwrap();</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-8ace00d79e48c0e8b3f5c6c8"role="button" aria-expanded="false" aria-controls="id-8ace00d79e48c0e8b3f5c6c8">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/storage</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+398</span></div>
                    <div class="text-start"><span class="text-danger">-102</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-8ace00d79e48c0e8b3f5c6c8">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c536435924ecac483e576019" role="button"
                       aria-expanded="false" aria-controls="id-c536435924ecac483e576019">
                        <code>crates/storage/db-api/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/db-api/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/db-api/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c536435924ecac483e576019"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db-api&#47;Cargo.toml scroll-reth&#47;crates&#47;storage&#47;db-api&#47;Cargo.toml</span>
<span class="term-fg1">index 3aa908a600936423ec5ec52c2989344a778efa66..1071e0a4432a229360857c444234430c719c4f19 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db-api&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db-api&#47;Cargo.toml</span>
<span class="term-fg36">@@ -82,3 +82,4 @@</span>     &quot;reth-stages-types&#47;arbitrary&quot;,
     &quot;alloy-consensus&#47;arbitrary&quot;,
 ]
 optimism = [&quot;reth-primitives&#47;optimism&quot;, &quot;reth-codecs&#47;optimism&quot;]
<span class="term-fg32">+scroll = [&quot;reth-primitives&#47;scroll&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-da054a3ce417bc61cb4e0307" role="button"
                       aria-expanded="false" aria-controls="id-da054a3ce417bc61cb4e0307">
                        <code>crates/storage/db-api/src/models/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/db-api/src/models/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/db-api/src/models/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-da054a3ce417bc61cb4e0307"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db-api&#47;src&#47;models&#47;mod.rs scroll-reth&#47;crates&#47;storage&#47;db-api&#47;src&#47;models&#47;mod.rs</span>
<span class="term-fg1">index 5d18711922edbe0a41d3cbffb7e5c1049350b532..83d2913c5bc50b66f922d5c2a5e62c4e1927124c 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db-api&#47;src&#47;models&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db-api&#47;src&#47;models&#47;mod.rs</span>
<span class="term-fg36">@@ -335,7 +335,10 @@</span>         assert_eq!(IndexHistoryCheckpoint::bitflag_encoded_bytes(), 0);
         assert_eq!(PruneCheckpoint::bitflag_encoded_bytes(), 1);
         assert_eq!(PruneMode::bitflag_encoded_bytes(), 1);
         assert_eq!(PruneSegment::bitflag_encoded_bytes(), 1);
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
         assert_eq!(Receipt::bitflag_encoded_bytes(), 1);
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        assert_eq!(Receipt::bitflag_encoded_bytes(), 2);</span>
         assert_eq!(StageCheckpoint::bitflag_encoded_bytes(), 1);
         assert_eq!(StageUnitCheckpoint::bitflag_encoded_bytes(), 1);
         assert_eq!(StoredBlockBodyIndices::bitflag_encoded_bytes(), 1);
<span class="term-fg36">@@ -356,7 +359,10 @@</span>         validate_bitflag_backwards_compat!(IndexHistoryCheckpoint, UnusedBits::Zero);
         validate_bitflag_backwards_compat!(PruneCheckpoint, UnusedBits::NotZero);
         validate_bitflag_backwards_compat!(PruneMode, UnusedBits::Zero);
         validate_bitflag_backwards_compat!(PruneSegment, UnusedBits::Zero);
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
         validate_bitflag_backwards_compat!(Receipt, UnusedBits::Zero);
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        validate_bitflag_backwards_compat!(Receipt, UnusedBits::NotZero);</span>
         validate_bitflag_backwards_compat!(StageCheckpoint, UnusedBits::NotZero);
         validate_bitflag_backwards_compat!(StageUnitCheckpoint, UnusedBits::Zero);
         validate_bitflag_backwards_compat!(StoredBlockBodyIndices, UnusedBits::Zero);</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cce9221ac9d7e4f99146be20" role="button"
                       aria-expanded="false" aria-controls="id-cce9221ac9d7e4f99146be20">
                        <code>crates/storage/db-common/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/db-common/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/db-common/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cce9221ac9d7e4f99146be20"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db-common&#47;Cargo.toml scroll-reth&#47;crates&#47;storage&#47;db-common&#47;Cargo.toml</span>
<span class="term-fg1">index 9e4954357f84e7a05ab071bed9931a25a38e6780..662d1fdb0295b25b2bd830549f52c2517692a8fb 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db-common&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db-common&#47;Cargo.toml</span>
<span class="term-fg36">@@ -27,6 +27,9 @@</span> # eth
 alloy-genesis.workspace = true
 alloy-primitives.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # misc
 eyre.workspace = true
 thiserror.workspace = true
<span class="term-fg36">@@ -46,3 +49,6 @@</span> alloy-consensus.workspace = true
&nbsp;
 [lints]
 workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [&quot;reth-scroll-primitives&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b457b66ea517a65c25cab841" role="button"
                       aria-expanded="false" aria-controls="id-b457b66ea517a65c25cab841">
                        <code>crates/storage/db-common/src/init.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/db-common/src/init.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/db-common/src/init.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b457b66ea517a65c25cab841"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db-common&#47;src&#47;init.rs scroll-reth&#47;crates&#47;storage&#47;db-common&#47;src&#47;init.rs</span>
<span class="term-fg1">index ec31edd068236db27050a09e3b0e1471d877eb2d..d0acfdb32066bb7d1f31f480c49b3351349708a6 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db-common&#47;src&#47;init.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db-common&#47;src&#47;init.rs</span>
<span class="term-fg36">@@ -215,6 +215,12 @@</span>                 Some(Account {
                     nonce: account.nonce.unwrap_or_default(),
                     balance: account.balance,
                     bytecode_hash,
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                            account.code.as_ref().unwrap_or_default(),</span>
<span class="term-fg32">+                        ),</span>
<span class="term-fg32">+                    ),</span>
                 }),
                 storage,
             ),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c5bbfc4a3b99b67a9cfc0f74" role="button"
                       aria-expanded="false" aria-controls="id-c5bbfc4a3b99b67a9cfc0f74">
                        <code>crates/storage/db/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/db/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/db/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c5bbfc4a3b99b67a9cfc0f74"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db&#47;Cargo.toml scroll-reth&#47;crates&#47;storage&#47;db&#47;Cargo.toml</span>
<span class="term-fg1">index 4a4eff471238c901a023692591aefb7a589023ee..c723a3a37645761a6dc8962c06bd1c1475f1dcbb 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db&#47;Cargo.toml</span>
<span class="term-fg36">@@ -63,6 +63,8 @@</span> tempfile.workspace = true
 test-fuzz.workspace = true
 parking_lot.workspace = true
&nbsp;
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+</span>
 pprof = { workspace = true, features = [
     &quot;flamegraph&quot;,
     &quot;frame-pointer&quot;,
<span class="term-fg36">@@ -111,9 +113,15 @@</span>     &quot;alloy-primitives&#47;arbitrary&quot;,
     &quot;reth-prune-types&#47;arbitrary&quot;,
     &quot;reth-stages-types&#47;arbitrary&quot;,
     &quot;alloy-consensus&#47;arbitrary&quot;,
<span class="term-fg32">+    &quot;reth-scroll-primitives&#47;arbitrary&quot;</span>
 ]
 optimism = [&quot;reth-primitives&#47;optimism&quot;, &quot;reth-db-api&#47;optimism&quot;]
 disable-lock = []
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie-common&#47;scroll&quot;</span>
<span class="term-fg32">+]</span>
&nbsp;
 [[bench]]
 name = &quot;hash_keys&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1cb3d8ce05f21d86d7bad4fe" role="button"
                       aria-expanded="false" aria-controls="id-1cb3d8ce05f21d86d7bad4fe">
                        <code>crates/storage/db/src/implementation/mdbx/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/db/src/implementation/mdbx/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/db/src/implementation/mdbx/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1cb3d8ce05f21d86d7bad4fe"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db&#47;src&#47;implementation&#47;mdbx&#47;mod.rs scroll-reth&#47;crates&#47;storage&#47;db&#47;src&#47;implementation&#47;mdbx&#47;mod.rs</span>
<span class="term-fg1">index 006213e4cb916f4667172f5fffe3f2a5579c1ba5..e564a25e859809be06abc5c58f4be15d169668a1 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db&#47;src&#47;implementation&#47;mdbx&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db&#47;src&#47;implementation&#47;mdbx&#47;mod.rs</span>
<span class="term-fg36">@@ -1178,6 +1178,8 @@</span>         let value = Account {
             nonce: 18446744073709551615,
             bytecode_hash: Some(B256::random()),
             balance: U256::MAX,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some((10u64, B256::random()).into()),</span>
         };
         let key = Address::from_str(&quot;0xa2c122be93b0074270ebee7f6b7292c7deb45047&quot;)
             .expect(ERROR_ETH_ADDRESS);</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-77fd1a67b60765763339b5cd" role="button"
                       aria-expanded="false" aria-controls="id-77fd1a67b60765763339b5cd">
                        <code>crates/storage/provider/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/provider/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+16</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-77fd1a67b60765763339b5cd"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;Cargo.toml scroll-reth&#47;crates&#47;storage&#47;provider&#47;Cargo.toml</span>
<span class="term-fg1">index 2875b91149c51eee0d7aa441faf82a2cccca43dc..74924f1fbd9b97b5d53b4e75e90465b674d33cd7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;Cargo.toml</span>
<span class="term-fg36">@@ -42,6 +42,9 @@</span> alloy-rpc-types-engine.workspace = true
 alloy-consensus.workspace = true
 revm.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # optimism
 reth-optimism-primitives = { workspace = true, optional = true }
&nbsp;
<span class="term-fg36">@@ -79,6 +82,8 @@</span> reth-trie = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-testing-utils.workspace = true
 reth-ethereum-engine-primitives.workspace = true
&nbsp;
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+</span>
 parking_lot.workspace = true
 tempfile.workspace = true
 assert_matches.workspace = true
<span class="term-fg36">@@ -113,6 +118,7 @@</span>     &quot;reth-primitives-traits&#47;serde&quot;,
     &quot;reth-execution-types&#47;serde&quot;,
     &quot;reth-trie-db&#47;serde&quot;,
     &quot;reth-trie&#47;serde&quot;,
<span class="term-fg32">+    &quot;reth-scroll-primitives?&#47;serde&quot;</span>
 ]
 test-utils = [
     &quot;reth-db&#47;test-utils&quot;,
<span class="term-fg36">@@ -133,3 +139,13 @@</span>     &quot;reth-prune-types&#47;test-utils&quot;,
     &quot;reth-stages-types&#47;test-utils&quot;,
     &quot;reth-optimism-primitives?&#47;arbitrary&quot;,
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-testing-utils&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-primitives&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-779d3b2c9bb2dbdb64cbe517" role="button"
                       aria-expanded="false" aria-controls="id-779d3b2c9bb2dbdb64cbe517">
                        <code>crates/storage/provider/src/providers/blockchain_provider.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/providers/blockchain_provider.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/provider/src/providers/blockchain_provider.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+23</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-779d3b2c9bb2dbdb64cbe517"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;blockchain_provider.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;blockchain_provider.rs</span>
<span class="term-fg1">index 08f5e4680a2b8ef19a1cdc93d0ea1637e98c315e..cbdb12c24e811ce16bfccf91a4a0f10781021b6d 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;blockchain_provider.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;blockchain_provider.rs</span>
<span class="term-fg36">@@ -4,8 +4,8 @@</span>     providers::{ConsistentProvider, StaticFileProvider},
     AccountReader, BlockHashReader, BlockIdReader, BlockNumReader, BlockReader, BlockReaderIdExt,
     BlockSource, CanonChainTracker, CanonStateNotifications, CanonStateSubscriptions,
     ChainSpecProvider, ChainStateBlockReader, ChangeSetReader, DatabaseProvider,
<span class="term-fg31">-    DatabaseProviderFactory, EvmEnvProvider, FullProvider, HeaderProvider, ProviderError,</span>
<span class="term-fg31">-    ProviderFactory, PruneCheckpointReader, ReceiptProvider, ReceiptProviderIdExt,</span>
<span class="term-fg32">+    DatabaseProviderFactory, EvmEnvProvider, FullProvider, HashedPostStateProvider, HeaderProvider,</span>
<span class="term-fg32">+    ProviderError, ProviderFactory, PruneCheckpointReader, ReceiptProvider, ReceiptProviderIdExt,</span>
     StageCheckpointReader, StateProviderBox, StateProviderFactory, StateReader,
     StaticFileProviderFactory, TransactionVariant, TransactionsProvider, WithdrawalsProvider,
 };
<span class="term-fg36">@@ -34,9 +34,16 @@</span> };
 use reth_primitives_traits::BlockBody as _;
 use reth_prune_types::{PruneCheckpoint, PruneSegment};
 use reth_stages_types::{StageCheckpoint, StageId};
<span class="term-fg31">-use reth_storage_api::{DBProvider, NodePrimitivesProvider, StorageChangeSetReader};</span>
<span class="term-fg32">+use reth_storage_api::{</span>
<span class="term-fg32">+    DBProvider, NodePrimitivesProvider, StateCommitmentProvider, StorageChangeSetReader,</span>
<span class="term-fg32">+};</span>
 use reth_storage_errors::provider::ProviderResult;
<span class="term-fg31">-use revm::primitives::{BlockEnv, CfgEnvWithHandlerCfg};</span>
<span class="term-fg32">+use reth_trie::HashedPostState;</span>
<span class="term-fg32">+use reth_trie_db::StateCommitment;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::BundleState,</span>
<span class="term-fg32">+    primitives::{BlockEnv, CfgEnvWithHandlerCfg},</span>
<span class="term-fg32">+};</span>
 use std::{
     ops::{Add, RangeBounds, RangeInclusive, Sub},
     sync::Arc,
<span class="term-fg36">@@ -166,6 +173,10 @@</span>
     fn database_provider_rw(&amp;self) -&gt; ProviderResult&lt;Self::ProviderRW&gt; {
         self.database.database_provider_rw()
     }
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;N: ProviderNodeTypes&gt; StateCommitmentProvider for BlockchainProvider2&lt;N&gt; {</span>
<span class="term-fg32">+    type StateCommitment = N::StateCommitment;</span>
 }
&nbsp;
 impl&lt;N: ProviderNodeTypes&gt; StaticFileProviderFactory for BlockchainProvider2&lt;N&gt; {
<span class="term-fg36">@@ -649,6 +660,14 @@</span>                     .ok_or_else(|| ProviderError::HeaderNotFound(num.into()))?;
                 self.state_by_block_hash(hash)
             }
         }
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;N: NodeTypesWithDB&gt; HashedPostStateProvider for BlockchainProvider2&lt;N&gt; {</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, bundle_state: &amp;BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+        HashedPostState::from_bundle_state::&lt;&lt;N::StateCommitment as StateCommitment&gt;::KeyHasher&gt;(</span>
<span class="term-fg32">+            bundle_state.state(),</span>
<span class="term-fg32">+        )</span>
     }
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-33d13994e2c0a6adfc094da7" role="button"
                       aria-expanded="false" aria-controls="id-33d13994e2c0a6adfc094da7">
                        <code>crates/storage/provider/src/providers/bundle_state_provider.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/providers/bundle_state_provider.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/provider/src/providers/bundle_state_provider.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+26</span></div>
                            <div class="text-start"><span class="text-danger">-13</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-33d13994e2c0a6adfc094da7"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;bundle_state_provider.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;bundle_state_provider.rs</span>
<span class="term-fg1">index 652f6fb33fd271c274e01859153e0743f2624890..2b8682fc9bc99a472aee95e234e507a356165286 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;bundle_state_provider.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;bundle_state_provider.rs</span>
<span class="term-fg36">@@ -6,7 +6,9 @@</span>     map::{HashMap, HashSet},
     Address, BlockNumber, Bytes, B256,
 };
 use reth_primitives::{Account, Bytecode};
<span class="term-fg31">-use reth_storage_api::{StateProofProvider, StorageRootProvider};</span>
<span class="term-fg32">+use reth_storage_api::{</span>
<span class="term-fg32">+    HashedPostStateProvider, HashedStorageProvider, StateProofProvider, StorageRootProvider,</span>
<span class="term-fg32">+};</span>
 use reth_storage_errors::provider::ProviderResult;
 use reth_trie::{
     updates::TrieUpdates, AccountProof, HashedPostState, HashedStorage, MultiProof,
<span class="term-fg36">@@ -38,12 +40,7 @@</span>     fn get_hashed_storage(&amp;self, address: Address) -&gt; HashedStorage {
         let bundle_state = self.block_execution_data_provider.execution_outcome().state();
         bundle_state
             .account(&amp;address)
<span class="term-fg31">-            .map(|account| {</span>
<span class="term-fg31">-                HashedStorage::from_plain_storage(</span>
<span class="term-fg31">-                    account.status,</span>
<span class="term-fg31">-                    account.storage.iter().map(|(slot, value)| (slot, &amp;value.present_value)),</span>
<span class="term-fg31">-                )</span>
<span class="term-fg31">-            })</span>
<span class="term-fg32">+            .map(|account| self.state_provider.hashed_storage(account))</span>
             .unwrap_or_default()
     }
 }
<span class="term-fg36">@@ -87,7 +84,7 @@</span>     for BundleStateProvider&lt;SP, EDP&gt;
 {
     fn state_root(&amp;self, hashed_state: HashedPostState) -&gt; ProviderResult&lt;B256&gt; {
         let bundle_state = self.block_execution_data_provider.execution_outcome().state();
<span class="term-fg31">-        let mut state = HashedPostState::from_bundle_state(&amp;bundle_state.state);</span>
<span class="term-fg32">+        let mut state = self.hashed_post_state(bundle_state);</span>
         state.extend(hashed_state);
         self.state_provider.state_root(state)
     }
<span class="term-fg36">@@ -101,7 +98,7 @@</span>         &amp;self,
         hashed_state: HashedPostState,
     ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {
         let bundle_state = self.block_execution_data_provider.execution_outcome().state();
<span class="term-fg31">-        let mut state = HashedPostState::from_bundle_state(&amp;bundle_state.state);</span>
<span class="term-fg32">+        let mut state = self.hashed_post_state(bundle_state);</span>
         state.extend(hashed_state);
         self.state_provider.state_root_with_updates(state)
     }
<span class="term-fg36">@@ -111,7 +108,7 @@</span>         &amp;self,
         mut input: TrieInput,
     ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {
         let bundle_state = self.block_execution_data_provider.execution_outcome().state();
<span class="term-fg31">-        input.prepend(HashedPostState::from_bundle_state(&amp;bundle_state.state));</span>
<span class="term-fg32">+        input.prepend(self.hashed_post_state(bundle_state));</span>
         self.state_provider.state_root_from_nodes_with_updates(input)
     }
 }
<span class="term-fg36">@@ -162,7 +159,7 @@</span>         address: Address,
         slots: &amp;[B256],
     ) -&gt; ProviderResult&lt;AccountProof&gt; {
         let bundle_state = self.block_execution_data_provider.execution_outcome().state();
<span class="term-fg31">-        input.prepend(HashedPostState::from_bundle_state(&amp;bundle_state.state));</span>
<span class="term-fg32">+        input.prepend(self.hashed_post_state(bundle_state));</span>
         self.state_provider.proof(input, address, slots)
     }
&nbsp;
<span class="term-fg36">@@ -172,7 +169,7 @@</span>         mut input: reth_trie::TrieInput,
         targets: HashMap&lt;B256, HashSet&lt;B256&gt;&gt;,
     ) -&gt; ProviderResult&lt;MultiProof&gt; {
         let bundle_state = self.block_execution_data_provider.execution_outcome().state();
<span class="term-fg31">-        input.prepend(HashedPostState::from_bundle_state(&amp;bundle_state.state));</span>
<span class="term-fg32">+        input.prepend(self.hashed_post_state(bundle_state));</span>
         self.state_provider.multiproof(input, targets)
     }
&nbsp;
<span class="term-fg36">@@ -182,8 +179,24 @@</span>         mut input: TrieInput,
         target: HashedPostState,
     ) -&gt; ProviderResult&lt;HashMap&lt;B256, Bytes&gt;&gt; {
         let bundle_state = self.block_execution_data_provider.execution_outcome().state();
<span class="term-fg31">-        input.prepend(HashedPostState::from_bundle_state(&amp;bundle_state.state));</span>
<span class="term-fg32">+        input.prepend(self.hashed_post_state(bundle_state));</span>
         self.state_provider.witness(input, target)
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;SP: StateProvider, EDP: ExecutionDataProvider&gt; HashedPostStateProvider</span>
<span class="term-fg32">+    for BundleStateProvider&lt;SP, EDP&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, bundle_state: &amp;revm::db::BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+        self.state_provider.hashed_post_state(bundle_state)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;SP: StateProvider, EDP: ExecutionDataProvider&gt; HashedStorageProvider</span>
<span class="term-fg32">+    for BundleStateProvider&lt;SP, EDP&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn hashed_storage(&amp;self, account: &amp;revm::db::BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+        self.state_provider.hashed_storage(account)</span>
     }
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fe9ae5f9bbfbf717e4b2a134" role="button"
                       aria-expanded="false" aria-controls="id-fe9ae5f9bbfbf717e4b2a134">
                        <code>crates/storage/provider/src/providers/consistent_view.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/providers/consistent_view.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/provider/src/providers/consistent_view.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fe9ae5f9bbfbf717e4b2a134"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;consistent_view.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;consistent_view.rs</span>
<span class="term-fg1">index 4640f4603354070489105ced574f538c971bc2a3..479537f120cca3a0ae83f9303c9764533769a939 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;consistent_view.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;consistent_view.rs</span>
<span class="term-fg36">@@ -2,11 +2,11 @@</span> use crate::{BlockNumReader, DatabaseProviderFactory, HeaderProvider};
 use alloy_primitives::B256;
 use reth_errors::ProviderError;
 use reth_primitives::GotExpected;
<span class="term-fg31">-use reth_storage_api::{BlockReader, DBProvider};</span>
<span class="term-fg32">+use reth_storage_api::{BlockReader, DBProvider, StateCommitmentProvider};</span>
 use reth_storage_errors::provider::ProviderResult;
&nbsp;
 use reth_trie::HashedPostState;
<span class="term-fg31">-use reth_trie_db::DatabaseHashedPostState;</span>
<span class="term-fg32">+use reth_trie_db::{DatabaseHashedPostState, StateCommitment};</span>
&nbsp;
 pub use reth_storage_errors::provider::ConsistentViewError;
&nbsp;
<span class="term-fg36">@@ -33,7 +33,7 @@</span> }
&nbsp;
 impl&lt;Factory&gt; ConsistentDbView&lt;Factory&gt;
 where
<span class="term-fg31">-    Factory: DatabaseProviderFactory&lt;Provider: BlockReader&gt;,</span>
<span class="term-fg32">+    Factory: DatabaseProviderFactory&lt;Provider: BlockReader&gt; + StateCommitmentProvider,</span>
 {
     &#47;&#47;&#47; Creates new consistent database view.
     pub const fn new(factory: Factory, tip: Option&lt;B256&gt;) -&gt; Self {
<span class="term-fg36">@@ -59,7 +59,9 @@</span>             block_number == provider.last_block_number()?
         {
             Ok(HashedPostState::default())
         } else {
<span class="term-fg31">-            Ok(HashedPostState::from_reverts(provider.tx_ref(), block_number + 1)?)</span>
<span class="term-fg32">+            Ok(HashedPostState::from_reverts::&lt;</span>
<span class="term-fg32">+                &lt;Factory::StateCommitment as StateCommitment&gt;::KeyHasher,</span>
<span class="term-fg32">+            &gt;(provider.tx_ref(), block_number + 1)?)</span>
         }
     }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c2d4088492f07abcfec2a7c1" role="button"
                       aria-expanded="false" aria-controls="id-c2d4088492f07abcfec2a7c1">
                        <code>crates/storage/provider/src/providers/database/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/providers/database/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/provider/src/providers/database/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+24</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c2d4088492f07abcfec2a7c1"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;database&#47;mod.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;database&#47;mod.rs</span>
<span class="term-fg1">index 3c22a1a73a23c6fad24f6e906f76c7d14d0959aa..bea6c8adde2870fdf03cea69da801766482ae7b2 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;database&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;database&#47;mod.rs</span>
<span class="term-fg36">@@ -3,9 +3,9 @@</span>     providers::{state::latest::LatestStateProvider, StaticFileProvider},
     to_range,
     traits::{BlockSource, ReceiptProvider},
     BlockHashReader, BlockNumReader, BlockReader, ChainSpecProvider, DatabaseProviderFactory,
<span class="term-fg31">-    EvmEnvProvider, HeaderProvider, HeaderSyncGap, HeaderSyncGapProvider, ProviderError,</span>
<span class="term-fg31">-    PruneCheckpointReader, StageCheckpointReader, StateProviderBox, StaticFileProviderFactory,</span>
<span class="term-fg31">-    TransactionVariant, TransactionsProvider, WithdrawalsProvider,</span>
<span class="term-fg32">+    EvmEnvProvider, HashedPostStateProvider, HeaderProvider, HeaderSyncGap, HeaderSyncGapProvider,</span>
<span class="term-fg32">+    ProviderError, PruneCheckpointReader, StageCheckpointReader, StateProviderBox,</span>
<span class="term-fg32">+    StaticFileProviderFactory, TransactionVariant, TransactionsProvider, WithdrawalsProvider,</span>
 };
 use alloy_consensus::Header;
 use alloy_eips::{
<span class="term-fg36">@@ -26,9 +26,16 @@</span>     TransactionMeta,
 };
 use reth_prune_types::{PruneCheckpoint, PruneModes, PruneSegment};
 use reth_stages_types::{StageCheckpoint, StageId};
<span class="term-fg31">-use reth_storage_api::{NodePrimitivesProvider, TryIntoHistoricalStateProvider};</span>
<span class="term-fg32">+use reth_storage_api::{</span>
<span class="term-fg32">+    NodePrimitivesProvider, StateCommitmentProvider, TryIntoHistoricalStateProvider,</span>
<span class="term-fg32">+};</span>
 use reth_storage_errors::provider::ProviderResult;
<span class="term-fg31">-use revm::primitives::{BlockEnv, CfgEnvWithHandlerCfg};</span>
<span class="term-fg32">+use reth_trie::HashedPostState;</span>
<span class="term-fg32">+use reth_trie_db::StateCommitment;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::BundleState,</span>
<span class="term-fg32">+    primitives::{BlockEnv, CfgEnvWithHandlerCfg},</span>
<span class="term-fg32">+};</span>
 use std::{
     ops::{RangeBounds, RangeInclusive},
     path::Path,
<span class="term-fg36">@@ -218,6 +225,10 @@</span>
     fn database_provider_rw(&amp;self) -&gt; ProviderResult&lt;Self::ProviderRW&gt; {
         self.provider_rw().map(|provider| provider.0)
     }
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;N: NodeTypesWithDB&gt; StateCommitmentProvider for ProviderFactory&lt;N&gt; {</span>
<span class="term-fg32">+    type StateCommitment = N::StateCommitment;</span>
 }
&nbsp;
 impl&lt;N: NodeTypesWithDB&gt; StaticFileProviderFactory for ProviderFactory&lt;N&gt; {
<span class="term-fg36">@@ -640,6 +651,14 @@</span>     }
&nbsp;
     fn get_prune_checkpoints(&amp;self) -&gt; ProviderResult&lt;Vec&lt;(PruneSegment, PruneCheckpoint)&gt;&gt; {
         self.provider()?.get_prune_checkpoints()
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;N: ProviderNodeTypes&gt; HashedPostStateProvider for ProviderFactory&lt;N&gt; {</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, bundle_state: &amp;BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+        HashedPostState::from_bundle_state::&lt;&lt;N::StateCommitment as StateCommitment&gt;::KeyHasher&gt;(</span>
<span class="term-fg32">+            bundle_state.state(),</span>
<span class="term-fg32">+        )</span>
     }
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d06f34d7127fe88c620ec6fe" role="button"
                       aria-expanded="false" aria-controls="id-d06f34d7127fe88c620ec6fe">
                        <code>crates/storage/provider/src/providers/state/historical.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/providers/state/historical.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/provider/src/providers/state/historical.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+88</span></div>
                            <div class="text-start"><span class="text-danger">-11</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d06f34d7127fe88c620ec6fe"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;historical.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;historical.rs</span>
<span class="term-fg1">index ad36a4a5ab3e1e199a172f2446a1f1dd9dd5ddc8..cba511aad03bc1267e2be0d99383f6cdfe309e8b 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;historical.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;historical.rs</span>
<span class="term-fg36">@@ -1,6 +1,6 @@</span>
 use crate::{
     providers::state::macros::delegate_provider_impls, AccountReader, BlockHashReader,
<span class="term-fg31">-    ProviderError, StateProvider, StateRootProvider,</span>
<span class="term-fg32">+    HashedPostStateProvider, ProviderError, StateProvider, StateRootProvider,</span>
 };
 use alloy_eips::merge::EPOCH_SLOTS;
 use alloy_primitives::{
<span class="term-fg36">@@ -16,7 +16,8 @@</span>     transaction::DbTx,
 };
 use reth_primitives::{Account, Bytecode};
 use reth_storage_api::{
<span class="term-fg31">-    BlockNumReader, DBProvider, StateCommitmentProvider, StateProofProvider, StorageRootProvider,</span>
<span class="term-fg32">+    BlockNumReader, DBProvider, HashedStorageProvider, StateCommitmentProvider, StateProofProvider,</span>
<span class="term-fg32">+    StorageRootProvider,</span>
 };
 use reth_storage_errors::provider::ProviderResult;
 use reth_trie::{
<span class="term-fg36">@@ -28,7 +29,7 @@</span>     StorageRoot, TrieInput,
 };
 use reth_trie_db::{
     DatabaseHashedPostState, DatabaseHashedStorage, DatabaseProof, DatabaseStateRoot,
<span class="term-fg31">-    DatabaseStorageProof, DatabaseStorageRoot, DatabaseTrieWitness,</span>
<span class="term-fg32">+    DatabaseStorageProof, DatabaseStorageRoot, DatabaseTrieWitness, StateCommitment,</span>
 };
 use std::fmt::Debug;
&nbsp;
<span class="term-fg36">@@ -136,7 +137,9 @@</span>                 &quot;Attempt to calculate state root for an old block might result in OOM&quot;
             );
         }
&nbsp;
<span class="term-fg31">-        Ok(HashedPostState::from_reverts(self.tx(), self.block_number)?)</span>
<span class="term-fg32">+        Ok(HashedPostState::from_reverts::&lt;</span>
<span class="term-fg32">+            &lt;Provider::StateCommitment as StateCommitment&gt;::KeyHasher,</span>
<span class="term-fg32">+        &gt;(self.tx(), self.block_number)?)</span>
     }
&nbsp;
     &#47;&#47;&#47; Retrieve revert hashed storage for this history provider and target address.
<span class="term-fg36">@@ -153,7 +156,13 @@</span>                 &quot;Attempt to calculate storage root for an old block might result in OOM&quot;
             );
         }
&nbsp;
<span class="term-fg31">-        Ok(HashedStorage::from_reverts(self.tx(), address, self.block_number)?)</span>
<span class="term-fg32">+        Ok(</span>
<span class="term-fg32">+            HashedStorage::from_reverts::&lt;&lt;Provider::StateCommitment as StateCommitment&gt;::KeyHasher&gt;(</span>
<span class="term-fg32">+                self.tx(),</span>
<span class="term-fg32">+                address,</span>
<span class="term-fg32">+                self.block_number,</span>
<span class="term-fg32">+            )?,</span>
<span class="term-fg32">+        )</span>
     }
&nbsp;
     fn history_info&lt;T, K&gt;(
<span class="term-fg36">@@ -394,6 +403,26 @@</span>         TrieWitness::overlay_witness(self.tx(), input, target).map_err(Into::&lt;ProviderError&gt;::into)
     }
 }
&nbsp;
<span class="term-fg32">+impl&lt;Provider: StateCommitmentProvider&gt; HashedPostStateProvider</span>
<span class="term-fg32">+    for HistoricalStateProviderRef&lt;&#39;_, Provider&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, bundle_state: &amp;revm::db::BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+        HashedPostState::from_bundle_state::&lt;</span>
<span class="term-fg32">+            &lt;Provider::StateCommitment as StateCommitment&gt;::KeyHasher,</span>
<span class="term-fg32">+        &gt;(bundle_state.state())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Provider: StateCommitmentProvider + Send + Sync&gt; HashedStorageProvider</span>
<span class="term-fg32">+    for HistoricalStateProviderRef&lt;&#39;_, Provider&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn hashed_storage(&amp;self, account: &amp;revm::db::BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+        HashedStorage::from_bundle_account::&lt;</span>
<span class="term-fg32">+            &lt;Provider::StateCommitment as StateCommitment&gt;::KeyHasher,</span>
<span class="term-fg32">+        &gt;(account)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 impl&lt;Provider: DBProvider + BlockNumReader + BlockHashReader + StateCommitmentProvider&gt;
     StateProvider for HistoricalStateProviderRef&lt;&#39;_, Provider&gt;
 {
<span class="term-fg36">@@ -431,6 +460,12 @@</span>     &#47;&#47;&#47; Get account code by its hash
     fn bytecode_by_hash(&amp;self, code_hash: B256) -&gt; ProviderResult&lt;Option&lt;Bytecode&gt;&gt; {
         self.tx().get::&lt;tables::Bytecodes&gt;(code_hash).map_err(Into::into)
     }
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Provider: StateCommitmentProvider&gt; StateCommitmentProvider</span>
<span class="term-fg32">+    for HistoricalStateProviderRef&lt;&#39;_, Provider&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    type StateCommitment = Provider::StateCommitment;</span>
 }
&nbsp;
 &#47;&#47;&#47; State provider for a given block number.
<span class="term-fg36">@@ -482,6 +517,12 @@</span>         )
     }
 }
&nbsp;
<span class="term-fg32">+impl&lt;Provider: StateCommitmentProvider&gt; StateCommitmentProvider</span>
<span class="term-fg32">+    for HistoricalStateProvider&lt;Provider&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    type StateCommitment = Provider::StateCommitment;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; Delegates all provider impls to [HistoricalStateProviderRef]
 delegate_provider_impls!(HistoricalStateProvider&lt;Provider&gt; where [Provider: DBProvider + BlockNumReader + BlockHashReader + StateCommitmentProvider]);
&nbsp;
<span class="term-fg36">@@ -566,13 +607,49 @@</span>             BlockNumberList::new([4]).unwrap(),
         )
         .unwrap();
&nbsp;
<span class="term-fg31">-        let acc_plain = Account { nonce: 100, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg31">-        let acc_at15 = Account { nonce: 15, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg31">-        let acc_at10 = Account { nonce: 10, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg31">-        let acc_at7 = Account { nonce: 7, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg31">-        let acc_at3 = Account { nonce: 3, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg32">+        let acc_plain = Account {</span>
<span class="term-fg32">+            nonce: 100,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let acc_at15 = Account {</span>
<span class="term-fg32">+            nonce: 15,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let acc_at10 = Account {</span>
<span class="term-fg32">+            nonce: 10,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let acc_at7 = Account {</span>
<span class="term-fg32">+            nonce: 7,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let acc_at3 = Account {</span>
<span class="term-fg32">+            nonce: 3,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
&nbsp;
<span class="term-fg31">-        let higher_acc_plain = Account { nonce: 4, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg32">+        let higher_acc_plain = Account {</span>
<span class="term-fg32">+            nonce: 4,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
&nbsp;
         &#47;&#47; setup
         tx.put::&lt;tables::AccountChangeSets&gt;(1, AccountBeforeTx { address: ADDRESS, info: None })</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4af73d07fc011c819c17502b" role="button"
                       aria-expanded="false" aria-controls="id-4af73d07fc011c819c17502b">
                        <code>crates/storage/provider/src/providers/state/latest.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/providers/state/latest.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/provider/src/providers/state/latest.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+35</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4af73d07fc011c819c17502b"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;latest.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;latest.rs</span>
<span class="term-fg1">index a2ec4972d10510316cbb0743531c752f25a28dac..6d701defa13e6fa32fc5c111c47a5d385a821f01 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;latest.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;latest.rs</span>
<span class="term-fg36">@@ -1,6 +1,6 @@</span>
 use crate::{
     providers::state::macros::delegate_provider_impls, AccountReader, BlockHashReader,
<span class="term-fg31">-    StateProvider, StateRootProvider,</span>
<span class="term-fg32">+    HashedPostStateProvider, StateProvider, StateRootProvider,</span>
 };
 use alloy_primitives::{
     map::{HashMap, HashSet},
<span class="term-fg36">@@ -10,7 +10,8 @@</span> use reth_db::tables;
 use reth_db_api::{cursor::DbDupCursorRO, transaction::DbTx};
 use reth_primitives::{Account, Bytecode};
 use reth_storage_api::{
<span class="term-fg31">-    DBProvider, StateCommitmentProvider, StateProofProvider, StorageRootProvider,</span>
<span class="term-fg32">+    DBProvider, HashedStorageProvider, StateCommitmentProvider, StateProofProvider,</span>
<span class="term-fg32">+    StorageRootProvider,</span>
 };
 use reth_storage_errors::provider::{ProviderError, ProviderResult};
 use reth_trie::{
<span class="term-fg36">@@ -22,7 +23,7 @@</span>     StorageRoot, TrieInput,
 };
 use reth_trie_db::{
     DatabaseProof, DatabaseStateRoot, DatabaseStorageProof, DatabaseStorageRoot,
<span class="term-fg31">-    DatabaseTrieWitness,</span>
<span class="term-fg32">+    DatabaseTrieWitness, StateCommitment,</span>
 };
&nbsp;
 &#47;&#47;&#47; State provider over latest state that takes tx reference.
<span class="term-fg36">@@ -157,6 +158,26 @@</span>         TrieWitness::overlay_witness(self.tx(), input, target).map_err(Into::&lt;ProviderError&gt;::into)
     }
 }
&nbsp;
<span class="term-fg32">+impl&lt;Provider: DBProvider + StateCommitmentProvider&gt; HashedPostStateProvider</span>
<span class="term-fg32">+    for LatestStateProviderRef&lt;&#39;_, Provider&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, bundle_state: &amp;revm::db::BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+        HashedPostState::from_bundle_state::&lt;</span>
<span class="term-fg32">+            &lt;Provider::StateCommitment as StateCommitment&gt;::KeyHasher,</span>
<span class="term-fg32">+        &gt;(bundle_state.state())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Provider: StateCommitmentProvider + Send + Sync&gt; HashedStorageProvider</span>
<span class="term-fg32">+    for LatestStateProviderRef&lt;&#39;_, Provider&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn hashed_storage&lt;&#39;a&gt;(&amp;self, account: &amp;revm::db::BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+        HashedStorage::from_bundle_account::&lt;</span>
<span class="term-fg32">+            &lt;Provider::StateCommitment as StateCommitment&gt;::KeyHasher,</span>
<span class="term-fg32">+        &gt;(account)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 impl&lt;Provider: DBProvider + BlockHashReader + StateCommitmentProvider&gt; StateProvider
     for LatestStateProviderRef&lt;&#39;_, Provider&gt;
 {
<span class="term-fg36">@@ -181,11 +202,17 @@</span>         self.tx().get::&lt;tables::Bytecodes&gt;(code_hash).map_err(Into::into)
     }
 }
&nbsp;
<span class="term-fg32">+impl&lt;Provider: StateCommitmentProvider&gt; StateCommitmentProvider</span>
<span class="term-fg32">+    for LatestStateProviderRef&lt;&#39;_, Provider&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    type StateCommitment = Provider::StateCommitment;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47;&#47; State provider for the latest state.
 #[derive(Debug)]
 pub struct LatestStateProvider&lt;Provider&gt;(Provider);
&nbsp;
<span class="term-fg31">-impl&lt;Provider: DBProvider&gt; LatestStateProvider&lt;Provider&gt; {</span>
<span class="term-fg32">+impl&lt;Provider: DBProvider + StateCommitmentProvider&gt; LatestStateProvider&lt;Provider&gt; {</span>
     &#47;&#47;&#47; Create new state provider
     pub const fn new(db: Provider) -&gt; Self {
         Self(db)
<span class="term-fg36">@@ -196,6 +223,10 @@</span>     #[inline(always)]
     const fn as_ref(&amp;self) -&gt; LatestStateProviderRef&lt;&#39;_, Provider&gt; {
         LatestStateProviderRef::new(&amp;self.0)
     }
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Provider: StateCommitmentProvider&gt; StateCommitmentProvider for LatestStateProvider&lt;Provider&gt; {</span>
<span class="term-fg32">+    type StateCommitment = Provider::StateCommitment;</span>
 }
&nbsp;
 &#47;&#47; Delegates all provider impls to [LatestStateProviderRef]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f0a11b93bf0351b30225fcff" role="button"
                       aria-expanded="false" aria-controls="id-f0a11b93bf0351b30225fcff">
                        <code>crates/storage/provider/src/providers/state/macros.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/providers/state/macros.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/provider/src/providers/state/macros.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f0a11b93bf0351b30225fcff"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;macros.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;macros.rs</span>
<span class="term-fg1">index f2648fb15e6a247ac0612d018b43b8ed209fa2bd..994d760dc9cf621c1f76f6004d9ece074bcaa444 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;macros.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;macros.rs</span>
<span class="term-fg36">@@ -57,6 +57,12 @@</span>                 fn proof(&amp;self, input: reth_trie::TrieInput, address: alloy_primitives::Address, slots: &amp;[alloy_primitives::B256]) -&gt; reth_storage_errors::provider::ProviderResult&lt;reth_trie::AccountProof&gt;;
                 fn multiproof(&amp;self, input: reth_trie::TrieInput, targets: alloy_primitives::map::HashMap&lt;alloy_primitives::B256, alloy_primitives::map::HashSet&lt;alloy_primitives::B256&gt;&gt;) -&gt; reth_storage_errors::provider::ProviderResult&lt;reth_trie::MultiProof&gt;;
                 fn witness(&amp;self, input: reth_trie::TrieInput, target: reth_trie::HashedPostState) -&gt; reth_storage_errors::provider::ProviderResult&lt;alloy_primitives::map::HashMap&lt;alloy_primitives::B256, alloy_primitives::Bytes&gt;&gt;;
             }
<span class="term-fg32">+            HashedPostStateProvider $(where [$($generics)*])? {</span>
<span class="term-fg32">+                fn hashed_post_state(&amp;self, bundle_state: &amp;revm::db::BundleState) -&gt; reth_trie::HashedPostState;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            HashedStorageProvider $(where [$($generics)*])? {</span>
<span class="term-fg32">+                fn hashed_storage(&amp;self, bundle_state: &amp;revm::db::BundleAccount) -&gt; reth_trie::HashedStorage;</span>
<span class="term-fg32">+            }</span>
         );
     }
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9f6cad6e31e61cae49f90d87" role="button"
                       aria-expanded="false" aria-controls="id-9f6cad6e31e61cae49f90d87">
                        <code>crates/storage/provider/src/test_utils/mock.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/test_utils/mock.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/provider/src/test_utils/mock.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+30</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9f6cad6e31e61cae49f90d87"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mock.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mock.rs</span>
<span class="term-fg1">index 12c0330ac0e0877a5774284de9a9c3cf49cd8803..442e6df073bd18e832e7f4f47dcfef9e69a0b4ec 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mock.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mock.rs</span>
<span class="term-fg36">@@ -29,7 +29,8 @@</span> };
 use reth_primitives_traits::SignedTransaction;
 use reth_stages_types::{StageCheckpoint, StageId};
 use reth_storage_api::{
<span class="term-fg31">-    DatabaseProviderFactory, StageCheckpointReader, StateProofProvider, StorageRootProvider,</span>
<span class="term-fg32">+    DatabaseProviderFactory, HashedPostStateProvider, HashedStorageProvider, StageCheckpointReader,</span>
<span class="term-fg32">+    StateCommitmentProvider, StateProofProvider, StorageRootProvider,</span>
 };
 use reth_storage_errors::provider::{ConsistentViewError, ProviderError, ProviderResult};
 use reth_trie::{
<span class="term-fg36">@@ -83,7 +84,13 @@</span> impl ExtendedAccount {
     &#47;&#47;&#47; Create new instance of extended account
     pub fn new(nonce: u64, balance: U256) -&gt; Self {
         Self {
<span class="term-fg31">-            account: Account { nonce, balance, bytecode_hash: None },</span>
<span class="term-fg32">+            account: Account {</span>
<span class="term-fg32">+                nonce,</span>
<span class="term-fg32">+                balance,</span>
<span class="term-fg32">+                bytecode_hash: None,</span>
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+            },</span>
             bytecode: None,
             storage: Default::default(),
         }
<span class="term-fg36">@@ -91,6 +98,11 @@</span>     }
&nbsp;
     &#47;&#47;&#47; Set bytecode and bytecode hash on the extended account
     pub fn with_bytecode(mut self, bytecode: Bytes) -&gt; Self {
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+            self.account.account_extension =</span>
<span class="term-fg32">+                Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;bytecode));</span>
<span class="term-fg32">+        }</span>
         let hash = keccak256(&amp;bytecode);
         self.account.bytecode_hash = Some(hash);
         self.bytecode = Some(Bytecode::new_raw(bytecode));
<span class="term-fg36">@@ -162,6 +174,10 @@</span>     type Primitives = EthPrimitives;
     type ChainSpec = ChainSpec;
     type StateCommitment = MerklePatriciaTrie;
     type Storage = EthStorage;
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl StateCommitmentProvider for MockEthProvider {</span>
<span class="term-fg32">+    type StateCommitment = &lt;MockNode as NodeTypes&gt;::StateCommitment;</span>
 }
&nbsp;
 impl DatabaseProviderFactory for MockEthProvider {
<span class="term-fg36">@@ -677,6 +693,18 @@</span>         _input: TrieInput,
         _target: HashedPostState,
     ) -&gt; ProviderResult&lt;HashMap&lt;B256, Bytes&gt;&gt; {
         Ok(HashMap::default())
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashedPostStateProvider for MockEthProvider {</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, _state: &amp;revm::db::BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+        HashedPostState::default()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashedStorageProvider for MockEthProvider {</span>
<span class="term-fg32">+    fn hashed_storage(&amp;self, _account: &amp;revm::db::BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+        HashedStorage::default()</span>
     }
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1433a8871ad9efdbb48c10ba" role="button"
                       aria-expanded="false" aria-controls="id-1433a8871ad9efdbb48c10ba">
                        <code>crates/storage/provider/src/test_utils/noop.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/test_utils/noop.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/provider/src/test_utils/noop.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+16</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1433a8871ad9efdbb48c10ba"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;noop.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;noop.rs</span>
<span class="term-fg1">index ff6b3fccbe109c29085f7fa735dcd539a138ea92..2aeeb36a94fda11d2785ad6084fa7e2a8067d3da 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;noop.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;noop.rs</span>
<span class="term-fg36">@@ -27,7 +27,10 @@</span>     SealedBlockWithSenders, SealedHeader, TransactionMeta, TransactionSigned,
 };
 use reth_prune_types::{PruneCheckpoint, PruneSegment};
 use reth_stages_types::{StageCheckpoint, StageId};
<span class="term-fg31">-use reth_storage_api::{NodePrimitivesProvider, StateProofProvider, StorageRootProvider};</span>
<span class="term-fg32">+use reth_storage_api::{</span>
<span class="term-fg32">+    HashedPostStateProvider, HashedStorageProvider, NodePrimitivesProvider, StateProofProvider,</span>
<span class="term-fg32">+    StorageRootProvider,</span>
<span class="term-fg32">+};</span>
 use reth_storage_errors::provider::ProviderResult;
 use reth_trie::{
     updates::TrieUpdates, AccountProof, HashedPostState, HashedStorage, MultiProof, TrieInput,
<span class="term-fg36">@@ -408,6 +411,18 @@</span>         _input: TrieInput,
         _target: HashedPostState,
     ) -&gt; ProviderResult&lt;HashMap&lt;B256, Bytes&gt;&gt; {
         Ok(HashMap::default())
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashedPostStateProvider for NoopProvider {</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, _bundle_state: &amp;revm::db::BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+        HashedPostState::default()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashedStorageProvider for NoopProvider {</span>
<span class="term-fg32">+    fn hashed_storage(&amp;self, _account: &amp;revm::db::BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+        HashedStorage::default()</span>
     }
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-92d2e0ae1950a6291d4ebe34" role="button"
                       aria-expanded="false" aria-controls="id-92d2e0ae1950a6291d4ebe34">
                        <code>crates/storage/provider/src/writer/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/writer/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/provider/src/writer/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+75</span></div>
                            <div class="text-start"><span class="text-danger">-55</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-92d2e0ae1950a6291d4ebe34"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;writer&#47;mod.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;writer&#47;mod.rs</span>
<span class="term-fg1">index 02e912050d5e16f60a701176b533bf8469f51a08..ad54e9b2bdf86852bba178ed91dcccc9137af6aa 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;writer&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;writer&#47;mod.rs</span>
<span class="term-fg36">@@ -221,6 +221,8 @@</span> }
&nbsp;
 #[cfg(test)]
 mod tests {
<span class="term-fg32">+    #![allow(clippy::useless_conversion)]</span>
<span class="term-fg32">+</span>
     use super::*;
     use crate::{
         test_utils::create_test_provider_factory, AccountReader, StorageTrieWriter, TrieWriter,
<span class="term-fg36">@@ -234,7 +236,7 @@</span>         transaction::{DbTx, DbTxMut},
     };
     use reth_execution_types::ExecutionOutcome;
     use reth_primitives::{Account, Receipt, Receipts, StorageEntry};
<span class="term-fg31">-    use reth_storage_api::DatabaseProviderFactory;</span>
<span class="term-fg32">+    use reth_storage_api::{DatabaseProviderFactory, HashedPostStateProvider};</span>
     use reth_trie::{
         test_utils::{state_root, storage_root_prehashed},
         HashedPostState, HashedStorage, StateRoot, StorageRoot,
<span class="term-fg36">@@ -320,13 +322,13 @@</span>             RevmAccountInfo { balance: U256::from(3), nonce: 3, ..Default::default() };
&nbsp;
         let mut state = State::builder().with_bundle_update().build();
         state.insert_not_existing(address_a);
<span class="term-fg31">-        state.insert_account(address_b, account_b.clone());</span>
<span class="term-fg32">+        state.insert_account(address_b, account_b.clone().into());</span>
&nbsp;
         &#47;&#47; 0x00.. is created
         state.commit(HashMap::from_iter([(
             address_a,
             RevmAccount {
<span class="term-fg31">-                info: account_a.clone(),</span>
<span class="term-fg32">+                info: account_a.clone().into(),</span>
                 status: AccountStatus::Touched | AccountStatus::Created,
                 storage: HashMap::default(),
             },
<span class="term-fg36">@@ -336,7 +338,7 @@</span>         &#47;&#47; 0xff.. is changed (balance + 1, nonce + 1)
         state.commit(HashMap::from_iter([(
             address_b,
             RevmAccount {
<span class="term-fg31">-                info: account_b_changed.clone(),</span>
<span class="term-fg32">+                info: account_b_changed.clone().into(),</span>
                 status: AccountStatus::Touched,
                 storage: HashMap::default(),
             },
<span class="term-fg36">@@ -346,8 +348,10 @@</span>         state.merge_transitions(BundleRetention::Reverts);
         let mut revm_bundle_state = state.take_bundle();
&nbsp;
         &#47;&#47; Write plain state and reverts separately.
<span class="term-fg31">-        let reverts = revm_bundle_state.take_all_reverts().to_plain_state_reverts();</span>
<span class="term-fg31">-        let plain_state = revm_bundle_state.to_plain_state(OriginalValuesKnown::Yes);</span>
<span class="term-fg32">+        let reverts: revm::db::states::PlainStateReverts =</span>
<span class="term-fg32">+            revm_bundle_state.take_all_reverts().to_plain_state_reverts().into();</span>
<span class="term-fg32">+        let plain_state: revm::db::states::StateChangeset =</span>
<span class="term-fg32">+            revm_bundle_state.to_plain_state(OriginalValuesKnown::Yes).into();</span>
         assert!(plain_state.storage.is_empty());
         assert!(plain_state.contracts.is_empty());
         provider.write_state_changes(plain_state).expect(&quot;Could not write plain state to DB&quot;);
<span class="term-fg36">@@ -388,14 +392,14 @@</span>             &quot;Account B changeset is wrong&quot;
         );
&nbsp;
         let mut state = State::builder().with_bundle_update().build();
<span class="term-fg31">-        state.insert_account(address_b, account_b_changed.clone());</span>
<span class="term-fg32">+        state.insert_account(address_b, account_b_changed.clone().into());</span>
&nbsp;
         &#47;&#47; 0xff.. is destroyed
         state.commit(HashMap::from_iter([(
             address_b,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: account_b_changed,</span>
<span class="term-fg32">+                info: account_b_changed.into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -404,8 +408,10 @@</span>         state.merge_transitions(BundleRetention::Reverts);
         let mut revm_bundle_state = state.take_bundle();
&nbsp;
         &#47;&#47; Write plain state and reverts separately.
<span class="term-fg31">-        let reverts = revm_bundle_state.take_all_reverts().to_plain_state_reverts();</span>
<span class="term-fg31">-        let plain_state = revm_bundle_state.to_plain_state(OriginalValuesKnown::Yes);</span>
<span class="term-fg32">+        let reverts: revm::db::states::PlainStateReverts =</span>
<span class="term-fg32">+            revm_bundle_state.take_all_reverts().to_plain_state_reverts().into();</span>
<span class="term-fg32">+        let plain_state: revm::db::states::StateChangeset =</span>
<span class="term-fg32">+            revm_bundle_state.to_plain_state(OriginalValuesKnown::Yes).into();</span>
         &#47;&#47; Account B selfdestructed so flag for it should be present.
         assert_eq!(
             plain_state.storage,
<span class="term-fg36">@@ -449,7 +455,7 @@</span>         let mut state = State::builder().with_bundle_update().build();
         state.insert_not_existing(address_a);
         state.insert_account_with_storage(
             address_b,
<span class="term-fg31">-            account_b.clone(),</span>
<span class="term-fg32">+            account_b.clone().into(),</span>
             HashMap::from_iter([(U256::from(1), U256::from(1))]),
         );
&nbsp;
<span class="term-fg36">@@ -458,7 +464,7 @@</span>             (
                 address_a,
                 RevmAccount {
                     status: AccountStatus::Touched | AccountStatus::Created,
<span class="term-fg31">-                    info: RevmAccountInfo::default(),</span>
<span class="term-fg32">+                    info: RevmAccountInfo::default().into(),</span>
                     &#47;&#47; 0x00 =&gt; 0 =&gt; 1
                     &#47;&#47; 0x01 =&gt; 0 =&gt; 2
                     storage: HashMap::from_iter([
<span class="term-fg36">@@ -477,7 +483,7 @@</span>             (
                 address_b,
                 RevmAccount {
                     status: AccountStatus::Touched,
<span class="term-fg31">-                    info: account_b,</span>
<span class="term-fg32">+                    info: account_b.into(),</span>
                     &#47;&#47; 0x01 =&gt; 1 =&gt; 2
                     storage: HashMap::from_iter([(
                         U256::from(1),
<span class="term-fg36">@@ -494,7 +500,7 @@</span>
         state.merge_transitions(BundleRetention::Reverts);
&nbsp;
         let outcome =
<span class="term-fg31">-            ExecutionOutcome::new(state.take_bundle(), Receipts::default(), 1, Vec::new());</span>
<span class="term-fg32">+            ExecutionOutcome::new(state.take_bundle().into(), Receipts::default(), 1, Vec::new());</span>
         provider
             .write_state(outcome, OriginalValuesKnown::Yes, StorageLocation::Database)
             .expect(&quot;Could not write bundle state to DB&quot;);
<span class="term-fg36">@@ -581,20 +587,20 @@</span>         );
&nbsp;
         &#47;&#47; Delete account A
         let mut state = State::builder().with_bundle_update().build();
<span class="term-fg31">-        state.insert_account(address_a, RevmAccountInfo::default());</span>
<span class="term-fg32">+        state.insert_account(address_a, RevmAccountInfo::default().into());</span>
&nbsp;
         state.commit(HashMap::from_iter([(
             address_a,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: RevmAccountInfo::default(),</span>
<span class="term-fg32">+                info: RevmAccountInfo::default().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
&nbsp;
         state.merge_transitions(BundleRetention::Reverts);
         let outcome =
<span class="term-fg31">-            ExecutionOutcome::new(state.take_bundle(), Receipts::default(), 2, Vec::new());</span>
<span class="term-fg32">+            ExecutionOutcome::new(state.take_bundle().into(), Receipts::default(), 2, Vec::new());</span>
         provider
             .write_state(outcome, OriginalValuesKnown::Yes, StorageLocation::Database)
             .expect(&quot;Could not write bundle state to DB&quot;);
<span class="term-fg36">@@ -642,7 +648,7 @@</span>         init_state.insert_not_existing(address1);
         init_state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 status: AccountStatus::Touched | AccountStatus::Created,
                 &#47;&#47; 0x00 =&gt; 0 =&gt; 1
                 &#47;&#47; 0x01 =&gt; 0 =&gt; 2
<span class="term-fg36">@@ -660,8 +666,12 @@</span>             },
         )]));
         init_state.merge_transitions(BundleRetention::Reverts);
&nbsp;
<span class="term-fg31">-        let outcome =</span>
<span class="term-fg31">-            ExecutionOutcome::new(init_state.take_bundle(), Receipts::default(), 0, Vec::new());</span>
<span class="term-fg32">+        let outcome = ExecutionOutcome::new(</span>
<span class="term-fg32">+            init_state.take_bundle().into(),</span>
<span class="term-fg32">+            Receipts::default(),</span>
<span class="term-fg32">+            0,</span>
<span class="term-fg32">+            Vec::new(),</span>
<span class="term-fg32">+        );</span>
         provider
             .write_state(outcome, OriginalValuesKnown::Yes, StorageLocation::Database)
             .expect(&quot;Could not write bundle state to DB&quot;);
<span class="term-fg36">@@ -669,7 +679,7 @@</span>
         let mut state = State::builder().with_bundle_update().build();
         state.insert_account_with_storage(
             address1,
<span class="term-fg31">-            account_info.clone(),</span>
<span class="term-fg32">+            account_info.clone().into(),</span>
             HashMap::from_iter([(U256::ZERO, U256::from(1)), (U256::from(1), U256::from(2))]),
         );
&nbsp;
<span class="term-fg36">@@ -678,7 +688,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 &#47;&#47; 0x00 =&gt; 1 =&gt; 2
                 storage: HashMap::from_iter([(
                     U256::ZERO,
<span class="term-fg36">@@ -697,7 +707,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -708,7 +718,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::Created,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -719,7 +729,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 &#47;&#47; 0x00 =&gt; 0 =&gt; 2
                 &#47;&#47; 0x02 =&gt; 0 =&gt; 4
                 &#47;&#47; 0x06 =&gt; 0 =&gt; 6
<span class="term-fg36">@@ -746,7 +756,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -757,7 +767,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::Created,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -765,7 +775,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 &#47;&#47; 0x00 =&gt; 0 =&gt; 2
                 storage: HashMap::from_iter([(
                     U256::ZERO,
<span class="term-fg36">@@ -777,7 +787,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -785,7 +795,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::Created,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -796,7 +806,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched,
<span class="term-fg31">-                info: account_info,</span>
<span class="term-fg32">+                info: account_info.into(),</span>
                 &#47;&#47; 0x00 =&gt; 0 =&gt; 9
                 storage: HashMap::from_iter([(
                     U256::ZERO,
<span class="term-fg36">@@ -806,7 +816,7 @@</span>             },
         )]));
         state.merge_transitions(BundleRetention::Reverts);
&nbsp;
<span class="term-fg31">-        let bundle = state.take_bundle();</span>
<span class="term-fg32">+        let bundle = state.take_bundle().into();</span>
&nbsp;
         let outcome: ExecutionOutcome =
             ExecutionOutcome::new(bundle, Receipts::default(), 1, Vec::new());
<span class="term-fg36">@@ -956,7 +966,7 @@</span>         init_state.insert_not_existing(address1);
         init_state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
<span class="term-fg31">-                info: account1.clone(),</span>
<span class="term-fg32">+                info: account1.clone().into(),</span>
                 status: AccountStatus::Touched | AccountStatus::Created,
                 &#47;&#47; 0x00 =&gt; 0 =&gt; 1
                 &#47;&#47; 0x01 =&gt; 0 =&gt; 2
<span class="term-fg36">@@ -973,8 +983,12 @@</span>                 ]),
             },
         )]));
         init_state.merge_transitions(BundleRetention::Reverts);
<span class="term-fg31">-        let outcome =</span>
<span class="term-fg31">-            ExecutionOutcome::new(init_state.take_bundle(), Receipts::default(), 0, Vec::new());</span>
<span class="term-fg32">+        let outcome = ExecutionOutcome::new(</span>
<span class="term-fg32">+            init_state.take_bundle().into(),</span>
<span class="term-fg32">+            Receipts::default(),</span>
<span class="term-fg32">+            0,</span>
<span class="term-fg32">+            Vec::new(),</span>
<span class="term-fg32">+        );</span>
         provider
             .write_state(outcome, OriginalValuesKnown::Yes, StorageLocation::Database)
             .expect(&quot;Could not write bundle state to DB&quot;);
<span class="term-fg36">@@ -982,7 +996,7 @@</span>
         let mut state = State::builder().with_bundle_update().build();
         state.insert_account_with_storage(
             address1,
<span class="term-fg31">-            account1.clone(),</span>
<span class="term-fg32">+            account1.clone().into(),</span>
             HashMap::from_iter([(U256::ZERO, U256::from(1)), (U256::from(1), U256::from(2))]),
         );
&nbsp;
<span class="term-fg36">@@ -991,7 +1005,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: account1.clone(),</span>
<span class="term-fg32">+                info: account1.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -1000,7 +1014,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::Created,
<span class="term-fg31">-                info: account1.clone(),</span>
<span class="term-fg32">+                info: account1.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -1009,7 +1023,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched,
<span class="term-fg31">-                info: account1,</span>
<span class="term-fg32">+                info: account1.into(),</span>
                 &#47;&#47; 0x01 =&gt; 0 =&gt; 5
                 storage: HashMap::from_iter([(
                     U256::from(1),
<span class="term-fg36">@@ -1021,7 +1035,7 @@</span>
         &#47;&#47; Commit block #1 changes to the database.
         state.merge_transitions(BundleRetention::Reverts);
         let outcome =
<span class="term-fg31">-            ExecutionOutcome::new(state.take_bundle(), Receipts::default(), 1, Vec::new());</span>
<span class="term-fg32">+            ExecutionOutcome::new(state.take_bundle().into(), Receipts::default(), 1, Vec::new());</span>
         provider
             .write_state(outcome, OriginalValuesKnown::Yes, StorageLocation::Database)
             .expect(&quot;Could not write bundle state to DB&quot;);
<span class="term-fg36">@@ -1085,7 +1099,13 @@</span>     fn bundle_state_state_root() {
         type PreState = BTreeMap&lt;Address, (Account, BTreeMap&lt;B256, U256&gt;)&gt;;
         let mut prestate: PreState = (0..10)
             .map(|key| {
<span class="term-fg31">-                let account = Account { nonce: 1, balance: U256::from(key), bytecode_hash: None };</span>
<span class="term-fg32">+                let account = Account {</span>
<span class="term-fg32">+                    nonce: 1,</span>
<span class="term-fg32">+                    balance: U256::from(key),</span>
<span class="term-fg32">+                    bytecode_hash: None,</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                };</span>
                 let storage =
                     (1..11).map(|key| (B256::with_last_byte(key), U256::from(key))).collect();
                 (Address::with_last_byte(key), (account, storage))
<span class="term-fg36">@@ -1115,18 +1135,13 @@</span>
         let mut state = State::builder().with_bundle_update().build();
&nbsp;
         let assert_state_root = |state: &amp;State&lt;EmptyDB&gt;, expected: &amp;PreState, msg| {
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            let bundle_state = &amp;(state.bundle_state.clone(), &amp;()).into();</span>
<span class="term-fg32">+            #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+            let bundle_state = &amp;state.bundle_state;</span>
             assert_eq!(
<span class="term-fg31">-                StateRoot::overlay_root(</span>
<span class="term-fg31">-                    tx,</span>
<span class="term-fg31">-                    ExecutionOutcome::&lt;Receipt&gt;::new(</span>
<span class="term-fg31">-                        state.bundle_state.clone(),</span>
<span class="term-fg31">-                        Receipts::default(),</span>
<span class="term-fg31">-                        0,</span>
<span class="term-fg31">-                        Vec::new()</span>
<span class="term-fg31">-                    )</span>
<span class="term-fg31">-                    .hash_state_slow(),</span>
<span class="term-fg31">-                )</span>
<span class="term-fg31">-                .unwrap(),</span>
<span class="term-fg32">+                StateRoot::overlay_root(tx, provider_factory.hashed_post_state(bundle_state))</span>
<span class="term-fg32">+                    .unwrap(),</span>
                 state_root(expected.clone().into_iter().map(|(address, (account, storage))| (
                     address,
                     (account, storage.into_iter())
<span class="term-fg36">@@ -1146,7 +1161,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: RevmAccountInfo::default(),</span>
<span class="term-fg32">+                info: RevmAccountInfo::default().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -1216,8 +1231,13 @@</span>         state.merge_transitions(BundleRetention::PlainState);
         assert_state_root(&amp;state, &amp;prestate, &quot;changed nonce&quot;);
&nbsp;
         &#47;&#47; recreate account 1
<span class="term-fg31">-        let account1_new =</span>
<span class="term-fg31">-            Account { nonce: 56, balance: U256::from(123), bytecode_hash: Some(B256::random()) };</span>
<span class="term-fg32">+        let account1_new = Account {</span>
<span class="term-fg32">+            nonce: 56,</span>
<span class="term-fg32">+            balance: U256::from(123),</span>
<span class="term-fg32">+            bytecode_hash: Some(B256::random()),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some((10, B256::random()).into()),</span>
<span class="term-fg32">+        };</span>
         prestate.insert(address1, (account1_new, BTreeMap::default()));
         state.commit(HashMap::from_iter([(
             address1,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9cf0b9c334e33a4b3f3a1df5" role="button"
                       aria-expanded="false" aria-controls="id-9cf0b9c334e33a4b3f3a1df5">
                        <code>crates/storage/storage-api/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/storage-api/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/storage-api/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9cf0b9c334e33a4b3f3a1df5"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;storage-api&#47;Cargo.toml scroll-reth&#47;crates&#47;storage&#47;storage-api&#47;Cargo.toml</span>
<span class="term-fg1">index ba2ccf1b15735d0a4e3705d99df37d02256c9318..7ebff976d135727f10ed8677dc79c404cc19c829 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;storage-api&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;storage-api&#47;Cargo.toml</span>
<span class="term-fg36">@@ -25,6 +25,7 @@</span> reth-storage-errors.workspace = true
 reth-trie.workspace = true
 reth-trie-db.workspace = true
 reth-db.workspace = true
<span class="term-fg32">+revm.workspace = true</span>
&nbsp;
 # ethereum
 alloy-eips.workspace = true</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-929ce819d88a765f62a40f6c" role="button"
                       aria-expanded="false" aria-controls="id-929ce819d88a765f62a40f6c">
                        <code>crates/storage/storage-api/src/state.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/storage-api/src/state.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/storage-api/src/state.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-929ce819d88a765f62a40f6c"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;state.rs scroll-reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;state.rs</span>
<span class="term-fg1">index 0cb26d3074344eecb9effcf388e53df5d53160c4..59b47221588eeadc277736a7331718881b49ba9f 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;state.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;state.rs</span>
<span class="term-fg36">@@ -1,6 +1,6 @@</span>
 use super::{
<span class="term-fg31">-    AccountReader, BlockHashReader, BlockIdReader, StateProofProvider, StateRootProvider,</span>
<span class="term-fg31">-    StorageRootProvider,</span>
<span class="term-fg32">+    AccountReader, BlockHashReader, BlockIdReader, HashedStorageProvider, StateProofProvider,</span>
<span class="term-fg32">+    StateRootProvider, StorageRootProvider,</span>
 };
 use alloy_consensus::constants::KECCAK_EMPTY;
 use alloy_eips::{BlockId, BlockNumberOrTag};
<span class="term-fg36">@@ -8,7 +8,9 @@</span> use alloy_primitives::{Address, BlockHash, BlockNumber, StorageKey, StorageValue, B256, U256};
 use auto_impl::auto_impl;
 use reth_primitives::Bytecode;
 use reth_storage_errors::provider::ProviderResult;
<span class="term-fg32">+use reth_trie::HashedPostState;</span>
 use reth_trie_db::StateCommitment;
<span class="term-fg32">+use revm::db::states::BundleState;</span>
&nbsp;
 &#47;&#47;&#47; Type alias of boxed [`StateProvider`].
 pub type StateProviderBox = Box&lt;dyn StateProvider&gt;;
<span class="term-fg36">@@ -21,6 +23,8 @@</span>     + AccountReader
     + StateRootProvider
     + StorageRootProvider
     + StateProofProvider
<span class="term-fg32">+    + HashedPostStateProvider</span>
<span class="term-fg32">+    + HashedStorageProvider</span>
     + Send
     + Sync
 {
<span class="term-fg36">@@ -83,9 +87,16 @@</span>     }
 }
&nbsp;
 &#47;&#47;&#47; Trait implemented for database providers that can provide the [`StateCommitment`] type.
<span class="term-fg31">-pub trait StateCommitmentProvider {</span>
<span class="term-fg32">+pub trait StateCommitmentProvider: Send + Sync {</span>
     &#47;&#47;&#47; The [`StateCommitment`] type that can be used to perform state commitment operations.
     type StateCommitment: StateCommitment;
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Trait that provides the hashed state from various sources.</span>
<span class="term-fg32">+#[auto_impl(&amp;, Arc, Box)]</span>
<span class="term-fg32">+pub trait HashedPostStateProvider: Send + Sync {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the `HashedPostState` of the provided [`BundleState`].</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, bundle_state: &amp;BundleState) -&gt; HashedPostState;</span>
 }
&nbsp;
 &#47;&#47;&#47; Trait implemented for database providers that can be converted into a historical state provider.</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-21b00af92de099eb7fe5fec6" role="button"
                       aria-expanded="false" aria-controls="id-21b00af92de099eb7fe5fec6">
                        <code>crates/storage/storage-api/src/storage.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/storage-api/src/storage.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/storage/storage-api/src/storage.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+9</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-21b00af92de099eb7fe5fec6"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;storage.rs scroll-reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;storage.rs</span>
<span class="term-fg1">index e1443347e4bb86c3fd012e4dc9ca3cc3ffd22cc4..3e3fd92eaefe2d45200035637ad03c9fcf7fd5b0 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;storage.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;storage.rs</span>
<span class="term-fg36">@@ -2,6 +2,8 @@</span> use alloy_primitives::{Address, BlockNumber, B256};
 use reth_db_api::models::BlockNumberAddress;
 use reth_primitives::StorageEntry;
 use reth_storage_errors::provider::ProviderResult;
<span class="term-fg32">+use reth_trie::HashedStorage;</span>
<span class="term-fg32">+use revm::db::BundleAccount;</span>
 use std::{
     collections::{BTreeMap, BTreeSet},
     ops::RangeInclusive,
<span class="term-fg36">@@ -41,3 +43,10 @@</span>         &amp;self,
         block_number: BlockNumber,
     ) -&gt; ProviderResult&lt;Vec&lt;(BlockNumberAddress, StorageEntry)&gt;&gt;;
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Provider of [`HashedStorage`]</span>
<span class="term-fg32">+#[auto_impl::auto_impl(&amp;, Arc, Box)]</span>
<span class="term-fg32">+pub trait HashedStorageProvider: Send + Sync {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Construct [`HashedStorage`] from the provided [`BundleAccount`].</span>
<span class="term-fg32">+    fn hashed_storage(&amp;self, account: &amp;BundleAccount) -&gt; HashedStorage;</span>
<span class="term-fg32">+}</span></div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-90ea188064f48844b98446de"role="button" aria-expanded="false" aria-controls="id-90ea188064f48844b98446de">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/trie</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+205</span></div>
                    <div class="text-start"><span class="text-danger">-59</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-90ea188064f48844b98446de">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a50f4e0ad4172d43d7c77454" role="button"
                       aria-expanded="false" aria-controls="id-a50f4e0ad4172d43d7c77454">
                        <code>crates/trie/common/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/common/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/trie/common/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a50f4e0ad4172d43d7c77454"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;common&#47;Cargo.toml scroll-reth&#47;crates&#47;trie&#47;common&#47;Cargo.toml</span>
<span class="term-fg1">index 8b0d930b0c2cc223d1957d3fef6a4836c4c4374f..bb80a50f0e2fa8dbd73219d2056b804b6444c1ec 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;common&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;common&#47;Cargo.toml</span>
<span class="term-fg36">@@ -21,7 +21,10 @@</span> alloy-genesis.workspace = true
&nbsp;
 reth-primitives-traits.workspace = true
 reth-codecs.workspace = true
<span class="term-fg31">-revm-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# revm-primitives scroll re-export</span>
<span class="term-fg32">+revm-primitives = { package = &quot;reth-scroll-revm&quot;, path = &quot;..&#47;..&#47;scroll&#47;revm&quot; }</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
&nbsp;
 bytes.workspace = true
 derive_more.workspace = true
<span class="term-fg36">@@ -52,6 +55,7 @@</span> bincode.workspace = true
 serde.workspace = true
 serde_json.workspace = true
 serde_with.workspace = true
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
&nbsp;
 [features]
 serde = [
<span class="term-fg36">@@ -63,7 +67,8 @@</span>     &quot;alloy-consensus&#47;serde&quot;,
     &quot;alloy-trie&#47;serde&quot;,
     &quot;revm-primitives&#47;serde&quot;,
     &quot;reth-primitives-traits&#47;serde&quot;,
<span class="term-fg31">-    &quot;reth-codecs&#47;serde&quot;</span>
<span class="term-fg32">+    &quot;reth-codecs&#47;serde&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-primitives?&#47;serde&quot;</span>
 ]
 serde-bincode-compat = [
     &quot;serde&quot;,
<span class="term-fg36">@@ -77,6 +82,7 @@</span>     &quot;dep:hash-db&quot;,
     &quot;arbitrary&quot;,
     &quot;reth-primitives-traits&#47;test-utils&quot;,
     &quot;reth-codecs&#47;test-utils&quot;,
<span class="term-fg32">+	&quot;revm-primitives&#47;test-utils&quot;</span>
 ]
 arbitrary = [
     &quot;alloy-trie&#47;arbitrary&quot;,
<span class="term-fg36">@@ -87,6 +93,12 @@</span>     &quot;alloy-primitives&#47;arbitrary&quot;,
     &quot;nybbles&#47;arbitrary&quot;,
     &quot;revm-primitives&#47;arbitrary&quot;,
     &quot;reth-codecs&#47;arbitrary&quot;,
<span class="term-fg32">+	&quot;reth-scroll-primitives?&#47;arbitrary&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;dep:reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+	&quot;revm-primitives&#47;scroll&quot;</span>
 ]
&nbsp;
 [[bench]]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3d23c7d65330fa2ba166c573" role="button"
                       aria-expanded="false" aria-controls="id-3d23c7d65330fa2ba166c573">
                        <code>crates/trie/common/src/account.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/common/src/account.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/trie/common/src/account.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3d23c7d65330fa2ba166c573"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;common&#47;src&#47;account.rs scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;account.rs</span>
<span class="term-fg1">index 0808837063cfab1bf9de63de1677cd744de9b773..b6666cfb7d463e7d157c0eedff93d8c8cd0626f1 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;common&#47;src&#47;account.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;account.rs</span>
<span class="term-fg36">@@ -135,7 +135,11 @@</span>             Into::&lt;TrieAccount&gt;::into((
                 Account {
                     nonce: 10,
                     balance: U256::from(1000),
<span class="term-fg31">-                    bytecode_hash: Some(keccak256([0x60, 0x61]))</span>
<span class="term-fg32">+                    bytecode_hash: Some(keccak256([0x60, 0x61])),</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(&amp;[0x60, 0x61])</span>
<span class="term-fg32">+                    )</span>
                 },
                 expected_storage_root
             )),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2bd28e14f63df21af4a5398d" role="button"
                       aria-expanded="false" aria-controls="id-2bd28e14f63df21af4a5398d">
                        <code>crates/trie/common/src/proofs.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/common/src/proofs.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/trie/common/src/proofs.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2bd28e14f63df21af4a5398d"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;common&#47;src&#47;proofs.rs scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;proofs.rs</span>
<span class="term-fg1">index 78659116c3e27bc3f2af4c8e6bd8a8d96a2dfec2..d86156d2e77c92c1481f1f46a60d280fe1ad801d 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;common&#47;src&#47;proofs.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;proofs.rs</span>
<span class="term-fg36">@@ -81,6 +81,11 @@</span>                             balance: account.balance,
                             nonce: account.nonce,
                             bytecode_hash: (account.code_hash != KECCAK_EMPTY)
                                 .then_some(account.code_hash),
<span class="term-fg32">+                            &#47;&#47; TODO (scroll): set the extension to the correct value.</span>
<span class="term-fg32">+                            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                            account_extension: Some(</span>
<span class="term-fg32">+                                reth_scroll_primitives::AccountExtension::empty(),</span>
<span class="term-fg32">+                            ),</span>
                         })
                     }
                 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-dba2e912e3315bd3ea17d135" role="button"
                       aria-expanded="false" aria-controls="id-dba2e912e3315bd3ea17d135">
                        <code>crates/trie/db/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/db/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/trie/db/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-dba2e912e3315bd3ea17d135"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;Cargo.toml scroll-reth&#47;crates&#47;trie&#47;db&#47;Cargo.toml</span>
<span class="term-fg1">index 2fbdf1d5756119af2bb774b4c34842b5e9dae8b7..e6ae8f1774e3ee3e1d5b965ab6d1a537d704c41b 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;Cargo.toml</span>
<span class="term-fg36">@@ -54,6 +54,8 @@</span> reth-trie = { workspace = true, features = [&quot;test-utils&quot;] }
&nbsp;
 alloy-consensus.workspace = true
&nbsp;
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+</span>
 # trie
 triehash = &quot;0.8&quot;
&nbsp;
<span class="term-fg36">@@ -74,6 +76,7 @@</span> 	&quot;alloy-primitives&#47;serde&quot;,
 	&quot;reth-trie&#47;serde&quot;,
 	&quot;reth-trie-common&#47;serde&quot;,
 	&quot;reth-provider&#47;serde&quot;,
<span class="term-fg32">+	&quot;reth-scroll-primitives&#47;serde&quot;</span>
 ]
 test-utils = [
 	&quot;triehash&quot;,
<span class="term-fg36">@@ -86,3 +89,10 @@</span> 	&quot;reth-db-api&#47;test-utils&quot;,
 	&quot;reth-provider&#47;test-utils&quot;,
 	&quot;reth-trie&#47;test-utils&quot;,
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-trie-common&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;revm&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e2d5f10f4736acb5e1d734b1" role="button"
                       aria-expanded="false" aria-controls="id-e2d5f10f4736acb5e1d734b1">
                        <code>crates/trie/db/src/prefix_set.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/db/src/prefix_set.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/trie/db/src/prefix_set.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+19</span></div>
                            <div class="text-start"><span class="text-danger">-10</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e2d5f10f4736acb5e1d734b1"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;src&#47;prefix_set.rs scroll-reth&#47;crates&#47;trie&#47;db&#47;src&#47;prefix_set.rs</span>
<span class="term-fg1">index ac8c3b05304cd6f3ab6efb9576dc55deb36fd2cf..95ff6d91f374ae5672385e7dc089b9d14ae3424e 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;src&#47;prefix_set.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;src&#47;prefix_set.rs</span>
<span class="term-fg36">@@ -1,4 +1,4 @@</span>
<span class="term-fg31">-use alloy_primitives::{keccak256, BlockNumber, B256};</span>
<span class="term-fg32">+use alloy_primitives::{BlockNumber, B256};</span>
 use derive_more::Deref;
 use reth_db::tables;
 use reth_db_api::{
<span class="term-fg36">@@ -10,25 +10,34 @@</span> };
 use reth_primitives::StorageEntry;
 use reth_trie::{
     prefix_set::{PrefixSetMut, TriePrefixSets},
<span class="term-fg31">-    Nibbles,</span>
<span class="term-fg32">+    KeyHasher, Nibbles,</span>
 };
 use std::{
     collections::{HashMap, HashSet},
<span class="term-fg32">+    marker::PhantomData,</span>
     ops::RangeInclusive,
 };
&nbsp;
 &#47;&#47;&#47; A wrapper around a database transaction that loads prefix sets within a given block range.
<span class="term-fg31">-#[derive(Deref, Debug)]</span>
<span class="term-fg31">-pub struct PrefixSetLoader&lt;&#39;a, TX&gt;(&amp;&#39;a TX);</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct PrefixSetLoader&lt;&#39;a, TX, KH&gt;(&amp;&#39;a TX, PhantomData&lt;KH&gt;);</span>
&nbsp;
<span class="term-fg31">-impl&lt;&#39;a, TX&gt; PrefixSetLoader&lt;&#39;a, TX&gt; {</span>
<span class="term-fg32">+impl&lt;&#39;a, TX, KH&gt; PrefixSetLoader&lt;&#39;a, TX, KH&gt; {</span>
     &#47;&#47;&#47; Create a new loader.
     pub const fn new(tx: &amp;&#39;a TX) -&gt; Self {
<span class="term-fg31">-        Self(tx)</span>
<span class="term-fg32">+        Self(tx, PhantomData)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;TX, KH&gt; Deref for PrefixSetLoader&lt;&#39;_, TX, KH&gt; {</span>
<span class="term-fg32">+    type Target = TX;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn deref(&amp;self) -&gt; &amp;Self::Target {</span>
<span class="term-fg32">+        self.0</span>
     }
 }
&nbsp;
<span class="term-fg31">-impl&lt;TX: DbTx&gt; PrefixSetLoader&lt;&#39;_, TX&gt; {</span>
<span class="term-fg32">+impl&lt;TX: DbTx, KH: KeyHasher&gt; PrefixSetLoader&lt;&#39;_, TX, KH&gt; {</span>
     &#47;&#47;&#47; Load all account and storage changes for the given block range.
     pub fn load(self, range: RangeInclusive&lt;BlockNumber&gt;) -&gt; Result&lt;TriePrefixSets, DatabaseError&gt; {
         &#47;&#47; Initialize prefix sets.
<span class="term-fg36">@@ -41,7 +50,7 @@</span>         let mut account_changeset_cursor = self.cursor_read::&lt;tables::AccountChangeSets&gt;()?;
         let mut account_hashed_state_cursor = self.cursor_read::&lt;tables::HashedAccounts&gt;()?;
         for account_entry in account_changeset_cursor.walk_range(range.clone())? {
             let (_, AccountBeforeTx { address, .. }) = account_entry?;
<span class="term-fg31">-            let hashed_address = keccak256(address);</span>
<span class="term-fg32">+            let hashed_address = KH::hash_key(address);</span>
             account_prefix_set.insert(Nibbles::unpack(hashed_address));
&nbsp;
             if account_hashed_state_cursor.seek_exact(hashed_address)?.is_none() {
<span class="term-fg36">@@ -55,12 +64,12 @@</span>         let mut storage_cursor = self.cursor_dup_read::&lt;tables::StorageChangeSets&gt;()?;
         let storage_range = BlockNumberAddress::range(range);
         for storage_entry in storage_cursor.walk_range(storage_range)? {
             let (BlockNumberAddress((_, address)), StorageEntry { key, .. }) = storage_entry?;
<span class="term-fg31">-            let hashed_address = keccak256(address);</span>
<span class="term-fg32">+            let hashed_address = KH::hash_key(address);</span>
             account_prefix_set.insert(Nibbles::unpack(hashed_address));
             storage_prefix_sets
                 .entry(hashed_address)
                 .or_default()
<span class="term-fg31">-                .insert(Nibbles::unpack(keccak256(key)));</span>
<span class="term-fg32">+                .insert(Nibbles::unpack(KH::hash_key(key)));</span>
         }
&nbsp;
         Ok(TriePrefixSets {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-240d2f0d5592d60a54b542ad" role="button"
                       aria-expanded="false" aria-controls="id-240d2f0d5592d60a54b542ad">
                        <code>crates/trie/db/src/state.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/db/src/state.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/trie/db/src/state.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+18</span></div>
                            <div class="text-start"><span class="text-danger">-10</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-240d2f0d5592d60a54b542ad"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;src&#47;state.rs scroll-reth&#47;crates&#47;trie&#47;db&#47;src&#47;state.rs</span>
<span class="term-fg1">index 6e2cea5051d0f5f0af01b419e9cdf723c6435e6e..a6356c104dacb7caa6cc6342f9f7dc4a0efa9ebf 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;src&#47;state.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;src&#47;state.rs</span>
<span class="term-fg36">@@ -1,5 +1,5 @@</span>
 use crate::{DatabaseHashedCursorFactory, DatabaseTrieCursorFactory, PrefixSetLoader};
<span class="term-fg31">-use alloy_primitives::{keccak256, Address, BlockNumber, B256, U256};</span>
<span class="term-fg32">+use alloy_primitives::{Address, BlockNumber, B256, U256};</span>
 use reth_db::tables;
 use reth_db_api::{
     cursor::DbCursorRO,
<span class="term-fg36">@@ -10,7 +10,8 @@</span> use reth_execution_errors::StateRootError;
 use reth_storage_errors::db::DatabaseError;
 use reth_trie::{
     hashed_cursor::HashedPostStateCursorFactory, trie_cursor::InMemoryTrieCursorFactory,
<span class="term-fg31">-    updates::TrieUpdates, HashedPostState, HashedStorage, StateRoot, StateRootProgress, TrieInput,</span>
<span class="term-fg32">+    updates::TrieUpdates, HashedPostState, HashedStorage, KeccakKeyHasher, KeyHasher, StateRoot,</span>
<span class="term-fg32">+    StateRootProgress, TrieInput,</span>
 };
 use std::{collections::HashMap, ops::RangeInclusive};
 use tracing::debug;
<span class="term-fg36">@@ -87,7 +88,13 @@</span>     &#47;&#47;&#47; &#47;&#47; Initialize hashed post state
     &#47;&#47;&#47; let mut hashed_state = HashedPostState::default();
     &#47;&#47;&#47; hashed_state.accounts.insert(
     &#47;&#47;&#47;     [0x11; 32].into(),
<span class="term-fg31">-    &#47;&#47;&#47;     Some(Account { nonce: 1, balance: U256::from(10), bytecode_hash: None }),</span>
<span class="term-fg32">+    &#47;&#47;&#47;     Some(Account {</span>
<span class="term-fg32">+    &#47;&#47;&#47;         nonce: 1,</span>
<span class="term-fg32">+    &#47;&#47;&#47;         balance: U256::from(10),</span>
<span class="term-fg32">+    &#47;&#47;&#47;         bytecode_hash: None,</span>
<span class="term-fg32">+    &#47;&#47;&#47;         #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    &#47;&#47;&#47;         account_extension: None,</span>
<span class="term-fg32">+    &#47;&#47;&#47;     }),</span>
     &#47;&#47;&#47; );
     &#47;&#47;&#47;
     &#47;&#47;&#47; &#47;&#47; Calculate the state root
<span class="term-fg36">@@ -122,7 +129,7 @@</span> &#47;&#47;&#47; Extends [`HashedPostState`] with operations specific for working with a database transaction.
 pub trait DatabaseHashedPostState&lt;TX&gt;: Sized {
     &#47;&#47;&#47; Initializes [`HashedPostState`] from reverts. Iterates over state reverts from the specified
     &#47;&#47;&#47; block up to the current tip and aggregates them into hashed state in reverse.
<span class="term-fg31">-    fn from_reverts(tx: &amp;TX, from: BlockNumber) -&gt; Result&lt;Self, DatabaseError&gt;;</span>
<span class="term-fg32">+    fn from_reverts&lt;KH: KeyHasher&gt;(tx: &amp;TX, from: BlockNumber) -&gt; Result&lt;Self, DatabaseError&gt;;</span>
 }
&nbsp;
 impl&lt;&#39;a, TX: DbTx&gt; DatabaseStateRoot&lt;&#39;a, TX&gt;
<span class="term-fg36">@@ -136,7 +143,7 @@</span>     fn incremental_root_calculator(
         tx: &amp;&#39;a TX,
         range: RangeInclusive&lt;BlockNumber&gt;,
     ) -&gt; Result&lt;Self, StateRootError&gt; {
<span class="term-fg31">-        let loaded_prefix_sets = PrefixSetLoader::new(tx).load(range)?;</span>
<span class="term-fg32">+        let loaded_prefix_sets = PrefixSetLoader::&lt;_, KeccakKeyHasher&gt;::new(tx).load(range)?;</span>
         Ok(Self::from_tx(tx).with_prefix_sets(loaded_prefix_sets))
     }
&nbsp;
<span class="term-fg36">@@ -216,7 +223,7 @@</span>     }
 }
&nbsp;
 impl&lt;TX: DbTx&gt; DatabaseHashedPostState&lt;TX&gt; for HashedPostState {
<span class="term-fg31">-    fn from_reverts(tx: &amp;TX, from: BlockNumber) -&gt; Result&lt;Self, DatabaseError&gt; {</span>
<span class="term-fg32">+    fn from_reverts&lt;KH: KeyHasher&gt;(tx: &amp;TX, from: BlockNumber) -&gt; Result&lt;Self, DatabaseError&gt; {</span>
         &#47;&#47; Iterate over account changesets and record value before first occurring account change.
         let mut accounts = HashMap::new();
         let mut account_changesets_cursor = tx.cursor_read::&lt;tables::AccountChangeSets&gt;()?;
<span class="term-fg36">@@ -237,19 +244,19 @@</span>             account_storage.entry(storage.key).or_insert(storage.value);
         }
&nbsp;
         let hashed_accounts =
<span class="term-fg31">-            accounts.into_iter().map(|(address, info)| (keccak256(address), info)).collect();</span>
<span class="term-fg32">+            accounts.into_iter().map(|(address, info)| (KH::hash_key(address), info)).collect();</span>
&nbsp;
         let hashed_storages = storages
             .into_iter()
             .map(|(address, storage)| {
                 (
<span class="term-fg31">-                    keccak256(address),</span>
<span class="term-fg32">+                    KH::hash_key(address),</span>
                     HashedStorage::from_iter(
                         &#47;&#47; The `wiped` flag indicates only whether previous storage entries
                         &#47;&#47; should be looked up in db or not. Forreverts it&#39;s a noop since all
                         &#47;&#47; wiped changes had been written asstorage reverts.
                         false,
<span class="term-fg31">-                        storage.into_iter().map(|(slot, value)| (keccak256(slot), value)),</span>
<span class="term-fg32">+                        storage.into_iter().map(|(slot, value)| (KH::hash_key(slot), value)),</span>
                     ),
                 )
             })
<span class="term-fg36">@@ -265,6 +272,7 @@</span>     use super::*;
     use alloy_primitives::{hex, map::HashMap, Address, U256};
     use reth_db::test_utils::create_test_rw_db;
     use reth_db_api::database::Database;
<span class="term-fg32">+    use reth_trie::KeccakKeyHasher;</span>
     use revm::{db::BundleState, primitives::AccountInfo};
&nbsp;
     #[test]
<span class="term-fg36">@@ -285,7 +293,7 @@</span>             .state_storage(address2, HashMap::from_iter([(slot2, (U256::ZERO, U256::from(20)))]))
             .build();
         assert_eq!(bundle_state.reverts.len(), 1);
&nbsp;
<span class="term-fg31">-        let post_state = HashedPostState::from_bundle_state(&amp;bundle_state.state);</span>
<span class="term-fg32">+        let post_state = HashedPostState::from_bundle_state::&lt;KeccakKeyHasher&gt;(&amp;bundle_state.state);</span>
         assert_eq!(post_state.accounts.len(), 2);
         assert_eq!(post_state.storages.len(), 2);
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8eeb0bbba31e8ff876b26217" role="button"
                       aria-expanded="false" aria-controls="id-8eeb0bbba31e8ff876b26217">
                        <code>crates/trie/db/src/storage.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/db/src/storage.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/trie/db/src/storage.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8eeb0bbba31e8ff876b26217"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;src&#47;storage.rs scroll-reth&#47;crates&#47;trie&#47;db&#47;src&#47;storage.rs</span>
<span class="term-fg1">index 6a3bbe1b9651b56af613192a49ed9d28183ac4f2..c2aa04ee98adeba0349cf0408a3203f933e23c05 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;src&#47;storage.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;src&#47;storage.rs</span>
<span class="term-fg36">@@ -6,7 +6,8 @@</span> use reth_db::{cursor::DbCursorRO, models::BlockNumberAddress, tables, DatabaseError};
 use reth_db_api::transaction::DbTx;
 use reth_execution_errors::StorageRootError;
 use reth_trie::{
<span class="term-fg31">-    hashed_cursor::HashedPostStateCursorFactory, HashedPostState, HashedStorage, StorageRoot,</span>
<span class="term-fg32">+    hashed_cursor::HashedPostStateCursorFactory, HashedPostState, HashedStorage, KeyHasher,</span>
<span class="term-fg32">+    StorageRoot,</span>
 };
&nbsp;
 #[cfg(feature = &quot;metrics&quot;)]
<span class="term-fg36">@@ -32,7 +33,11 @@</span> &#47;&#47;&#47; Extends [`HashedStorage`] with operations specific for working with a database transaction.
 pub trait DatabaseHashedStorage&lt;TX&gt;: Sized {
     &#47;&#47;&#47; Initializes [`HashedStorage`] from reverts. Iterates over storage reverts from the specified
     &#47;&#47;&#47; block up to the current tip and aggregates them into hashed storage in reverse.
<span class="term-fg31">-    fn from_reverts(tx: &amp;TX, address: Address, from: BlockNumber) -&gt; Result&lt;Self, DatabaseError&gt;;</span>
<span class="term-fg32">+    fn from_reverts&lt;KH: KeyHasher&gt;(</span>
<span class="term-fg32">+        tx: &amp;TX,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        from: BlockNumber,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;Self, DatabaseError&gt;;</span>
 }
&nbsp;
 impl&lt;&#39;a, TX: DbTx&gt; DatabaseStorageRoot&lt;&#39;a, TX&gt;
<span class="term-fg36">@@ -79,13 +84,17 @@</span>     }
 }
&nbsp;
 impl&lt;TX: DbTx&gt; DatabaseHashedStorage&lt;TX&gt; for HashedStorage {
<span class="term-fg31">-    fn from_reverts(tx: &amp;TX, address: Address, from: BlockNumber) -&gt; Result&lt;Self, DatabaseError&gt; {</span>
<span class="term-fg32">+    fn from_reverts&lt;KH: KeyHasher&gt;(</span>
<span class="term-fg32">+        tx: &amp;TX,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        from: BlockNumber,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;Self, DatabaseError&gt; {</span>
         let mut storage = Self::new(false);
         let mut storage_changesets_cursor = tx.cursor_read::&lt;tables::StorageChangeSets&gt;()?;
         for entry in storage_changesets_cursor.walk_range(BlockNumberAddress((from, address))..)? {
             let (BlockNumberAddress((_, storage_address)), storage_change) = entry?;
             if storage_address == address {
<span class="term-fg31">-                let hashed_slot = keccak256(storage_change.key);</span>
<span class="term-fg32">+                let hashed_slot = KH::hash_key(storage_change.key);</span>
                 if let hash_map::Entry::Vacant(entry) = storage.storage.entry(hashed_slot) {
                     entry.insert(storage_change.value);
                 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fa7c835e04eecb3a39d093e7" role="button"
                       aria-expanded="false" aria-controls="id-fa7c835e04eecb3a39d093e7">
                        <code>crates/trie/db/tests/proof.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/db/tests/proof.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/trie/db/tests/proof.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fa7c835e04eecb3a39d093e7"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;tests&#47;proof.rs scroll-reth&#47;crates&#47;trie&#47;db&#47;tests&#47;proof.rs</span>
<span class="term-fg1">index eedeee276db895e8afefb16bcf0ad269cfeb27e0..c2e86d77025b2dc1ce3f92d9a82045305316ef26 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;tests&#47;proof.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;tests&#47;proof.rs</span>
<span class="term-fg36">@@ -198,7 +198,10 @@</span>         address: target,
         info:  Some(Account {
             balance: U256::ZERO,
             nonce: 0,
<span class="term-fg31">-            bytecode_hash: Some(B256::from_str(&quot;0x2034f79e0e33b0ae6bef948532021baceb116adf2616478703bec6b17329f1cc&quot;).unwrap())</span>
<span class="term-fg32">+            bytecode_hash: Some(B256::from_str(&quot;0x2034f79e0e33b0ae6bef948532021baceb116adf2616478703bec6b17329f1cc&quot;).unwrap()),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty())</span>
<span class="term-fg32">+</span>
         }),
         storage_root: B256::from_str(&quot;0x556a482068355939c95a3412bdb21213a301483edb1b64402fb66ac9f3583599&quot;).unwrap(),
         proof: convert_to_proof([</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-69a30d684347bf5fb997d094" role="button"
                       aria-expanded="false" aria-controls="id-69a30d684347bf5fb997d094">
                        <code>crates/trie/db/tests/trie.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/db/tests/trie.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/trie/db/tests/trie.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+50</span></div>
                            <div class="text-start"><span class="text-danger">-7</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-69a30d684347bf5fb997d094"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;tests&#47;trie.rs scroll-reth&#47;crates&#47;trie&#47;db&#47;tests&#47;trie.rs</span>
<span class="term-fg1">index 4c614d83be6c8d67170f8bf9046aef41ab70c5ca..a0652107ca6a1137a4630da8f491aa3d0ac8b9b1 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;tests&#47;trie.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;tests&#47;trie.rs</span>
<span class="term-fg36">@@ -137,14 +137,26 @@</span>     let state: State = BTreeMap::from([
         (
             Address::random(),
             (
<span class="term-fg31">-                Account { nonce: 0, balance: U256::from(0), bytecode_hash: None },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance: U256::from(0),</span>
<span class="term-fg32">+                    bytecode_hash: None,</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                },</span>
                 BTreeMap::from([(B256::with_last_byte(0x4), U256::from(12))]),
             ),
         ),
         (
             Address::random(),
             (
<span class="term-fg31">-                Account { nonce: 0, balance: U256::from(0), bytecode_hash: None },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance: U256::from(0),</span>
<span class="term-fg32">+                    bytecode_hash: None,</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                },</span>
                 BTreeMap::default(),
             ),
         ),
<span class="term-fg36">@@ -155,6 +167,10 @@</span>                 Account {
                     nonce: 155,
                     balance: U256::from(414241124u32),
                     bytecode_hash: Some(keccak256(&quot;test&quot;)),
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(b&quot;test&quot;),</span>
<span class="term-fg32">+                    ),</span>
                 },
                 BTreeMap::from([
                     (B256::ZERO, U256::from(3)),
<span class="term-fg36">@@ -178,6 +194,8 @@</span>     let account = Account {
         nonce: 155,
         balance: U256::from(414241124u32),
         bytecode_hash: Some(keccak256(code)),
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code)),</span>
     };
     insert_account(tx.tx_ref(), address, account, &amp;Default::default());
     tx.commit().unwrap();
<span class="term-fg36">@@ -202,6 +220,8 @@</span>     let account = Account {
         nonce: 155,
         balance: U256::from(414241124u32),
         bytecode_hash: Some(keccak256(code)),
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code)),</span>
     };
&nbsp;
     insert_account(tx.tx_ref(), address, account, &amp;storage);
<span class="term-fg36">@@ -348,7 +368,13 @@</span>
     &#47;&#47; Insert first account
     let key1 =
         B256::from_str(&quot;b000000000000000000000000000000000000000000000000000000000000000&quot;).unwrap();
<span class="term-fg31">-    let account1 = Account { nonce: 0, balance: U256::from(3).mul(ether), bytecode_hash: None };</span>
<span class="term-fg32">+    let account1 = Account {</span>
<span class="term-fg32">+        nonce: 0,</span>
<span class="term-fg32">+        balance: U256::from(3).mul(ether),</span>
<span class="term-fg32">+        bytecode_hash: None,</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+    };</span>
     hashed_account_cursor.upsert(key1, account1).unwrap();
     hash_builder.add_leaf(Nibbles::unpack(key1), &amp;encode_account(account1, None));
&nbsp;
<span class="term-fg36">@@ -368,8 +394,13 @@</span>     assert_eq!(key3[0], 0xB0);
     assert_eq!(key3[1], 0x41);
     let code_hash =
         B256::from_str(&quot;5be74cad16203c4905c068b012a2e9fb6d19d036c410f16fd177f337541440dd&quot;).unwrap();
<span class="term-fg31">-    let account3 =</span>
<span class="term-fg31">-        Account { nonce: 0, balance: U256::from(2).mul(ether), bytecode_hash: Some(code_hash) };</span>
<span class="term-fg32">+    let account3 = Account {</span>
<span class="term-fg32">+        nonce: 0,</span>
<span class="term-fg32">+        balance: U256::from(2).mul(ether),</span>
<span class="term-fg32">+        bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some((10, B256::random()).into()),</span>
<span class="term-fg32">+    };</span>
     hashed_account_cursor.upsert(key3, account3).unwrap();
     for (hashed_slot, value) in storage {
         if hashed_storage_cursor
<span class="term-fg36">@@ -451,7 +482,13 @@</span>     &#47;&#47; Some address whose hash starts with 0xB1
     let address4b = Address::from_str(&quot;4f61f2d5ebd991b85aa1677db97307caf5215c91&quot;).unwrap();
     let key4b = keccak256(address4b);
     assert_eq!(key4b.0[0], key4a.0[0]);
<span class="term-fg31">-    let account4b = Account { nonce: 0, balance: U256::from(5).mul(ether), bytecode_hash: None };</span>
<span class="term-fg32">+    let account4b = Account {</span>
<span class="term-fg32">+        nonce: 0,</span>
<span class="term-fg32">+        balance: U256::from(5).mul(ether),</span>
<span class="term-fg32">+        bytecode_hash: None,</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+    };</span>
     hashed_account_cursor.upsert(key4b, account4b).unwrap();
&nbsp;
     let mut prefix_set = PrefixSetMut::default();
<span class="term-fg36">@@ -716,7 +753,13 @@</span>
 fn extension_node_trie&lt;N: ProviderNodeTypes&gt;(
     tx: &amp;DatabaseProviderRW&lt;Arc&lt;TempDatabase&lt;DatabaseEnv&gt;&gt;, N&gt;,
 ) -&gt; B256 {
<span class="term-fg31">-    let a = Account { nonce: 0, balance: U256::from(1u64), bytecode_hash: Some(B256::random()) };</span>
<span class="term-fg32">+    let a = Account {</span>
<span class="term-fg32">+        nonce: 0,</span>
<span class="term-fg32">+        balance: U256::from(1u64),</span>
<span class="term-fg32">+        bytecode_hash: Some(B256::random()),</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some((10, B256::random()).into()),</span>
<span class="term-fg32">+    };</span>
     let val = encode_account(a, None);
&nbsp;
     let mut hashed_accounts = tx.tx_ref().cursor_write::&lt;tables::HashedAccounts&gt;().unwrap();</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1c887793fe8f0d9a4258c826" role="button"
                       aria-expanded="false" aria-controls="id-1c887793fe8f0d9a4258c826">
                        <code>crates/trie/parallel/src/proof.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/parallel/src/proof.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/trie/parallel/src/proof.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+7</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1c887793fe8f0d9a4258c826"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;parallel&#47;src&#47;proof.rs scroll-reth&#47;crates&#47;trie&#47;parallel&#47;src&#47;proof.rs</span>
<span class="term-fg1">index f285079f25263d2fd7c377b74e91a9f6809bc995..fbe7fa55baedba2c7e8b61c0082ae00f3876b0b5 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;parallel&#47;src&#47;proof.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;parallel&#47;src&#47;proof.rs</span>
<span class="term-fg36">@@ -9,6 +9,7 @@</span> use reth_db::DatabaseError;
 use reth_execution_errors::StorageRootError;
 use reth_provider::{
     providers::ConsistentDbView, BlockReader, DBProvider, DatabaseProviderFactory, ProviderError,
<span class="term-fg32">+    StateCommitmentProvider,</span>
 };
 use reth_trie::{
     hashed_cursor::{HashedCursorFactory, HashedPostStateCursorFactory},
<span class="term-fg36">@@ -53,7 +54,12 @@</span> }
&nbsp;
 impl&lt;Factory&gt; ParallelProof&lt;Factory&gt;
 where
<span class="term-fg31">-    Factory: DatabaseProviderFactory&lt;Provider: BlockReader&gt; + Clone + Send + Sync + &#39;static,</span>
<span class="term-fg32">+    Factory: DatabaseProviderFactory&lt;Provider: BlockReader&gt;</span>
<span class="term-fg32">+        + StateCommitmentProvider</span>
<span class="term-fg32">+        + Clone</span>
<span class="term-fg32">+        + Send</span>
<span class="term-fg32">+        + Sync</span>
<span class="term-fg32">+        + &#39;static,</span>
 {
     &#47;&#47;&#47; Generate a state multiproof according to specified targets.
     pub fn multiproof(</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8c1cd5f09246abc2673fc08e" role="button"
                       aria-expanded="false" aria-controls="id-8c1cd5f09246abc2673fc08e">
                        <code>crates/trie/parallel/src/root.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/parallel/src/root.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/trie/parallel/src/root.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+7</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8c1cd5f09246abc2673fc08e"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;parallel&#47;src&#47;root.rs scroll-reth&#47;crates&#47;trie&#47;parallel&#47;src&#47;root.rs</span>
<span class="term-fg1">index 8d2b18f5e1113f358ef7493dcf57fdbb37a9b90f..e66d1f78213222690318783714c1eeade585a3e7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;parallel&#47;src&#47;root.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;parallel&#47;src&#47;root.rs</span>
<span class="term-fg36">@@ -8,6 +8,7 @@</span> use reth_db::DatabaseError;
 use reth_execution_errors::StorageRootError;
 use reth_provider::{
     providers::ConsistentDbView, BlockReader, DBProvider, DatabaseProviderFactory, ProviderError,
<span class="term-fg32">+    StateCommitmentProvider,</span>
 };
 use reth_trie::{
     hashed_cursor::{HashedCursorFactory, HashedPostStateCursorFactory},
<span class="term-fg36">@@ -58,7 +59,12 @@</span> }
&nbsp;
 impl&lt;Factory&gt; ParallelStateRoot&lt;Factory&gt;
 where
<span class="term-fg31">-    Factory: DatabaseProviderFactory&lt;Provider: BlockReader&gt; + Clone + Send + Sync + &#39;static,</span>
<span class="term-fg32">+    Factory: DatabaseProviderFactory&lt;Provider: BlockReader&gt;</span>
<span class="term-fg32">+        + StateCommitmentProvider</span>
<span class="term-fg32">+        + Clone</span>
<span class="term-fg32">+        + Send</span>
<span class="term-fg32">+        + Sync</span>
<span class="term-fg32">+        + &#39;static,</span>
 {
     &#47;&#47;&#47; Calculate incremental state root in parallel.
     pub fn incremental_root(self) -&gt; Result&lt;B256, ParallelStateRootError&gt; {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-33b016552e913d9a35927e89" role="button"
                       aria-expanded="false" aria-controls="id-33b016552e913d9a35927e89">
                        <code>crates/trie/trie/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/trie/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/trie/trie/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-33b016552e913d9a35927e89"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;trie&#47;Cargo.toml scroll-reth&#47;crates&#47;trie&#47;trie&#47;Cargo.toml</span>
<span class="term-fg1">index c1c3ae4dd8763651c09445a386cf1edc260d9679..f815076129fe1cebdf0eacc7fba3838f6be224c7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;trie&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;trie&#47;Cargo.toml</span>
<span class="term-fg36">@@ -19,6 +19,8 @@</span> reth-stages-types.workspace = true
 reth-storage-errors.workspace = true
 reth-trie-common.workspace = true
&nbsp;
<span class="term-fg32">+# revm re-export scroll</span>
<span class="term-fg32">+reth-primitives-traits.workspace = true</span>
 revm.workspace = true
&nbsp;
 # alloy
<span class="term-fg36">@@ -63,14 +65,21 @@</span> 	&quot;alloy-primitives&#47;serde&quot;,
 	&quot;alloy-consensus&#47;serde&quot;,
 	&quot;alloy-trie&#47;serde&quot;,
 	&quot;revm&#47;serde&quot;,
<span class="term-fg31">-	&quot;reth-trie-common&#47;serde&quot;</span>
<span class="term-fg32">+	&quot;reth-trie-common&#47;serde&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;serde&quot;</span>
 ]
 test-utils = [
 	&quot;triehash&quot;,
 	&quot;revm&#47;test-utils&quot;,
 	&quot;reth-primitives&#47;test-utils&quot;,
 	&quot;reth-trie-common&#47;test-utils&quot;,
<span class="term-fg31">-	&quot;reth-stages-types&#47;test-utils&quot;</span>
<span class="term-fg32">+	&quot;reth-stages-types&#47;test-utils&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;test-utils&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-trie-common&#47;scroll&quot;</span>
 ]
&nbsp;
 [[bench]]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f208607ea7e494063cd808cb" role="button"
                       aria-expanded="false" aria-controls="id-f208607ea7e494063cd808cb">
                        <code>crates/trie/trie/benches/hash_post_state.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/trie/benches/hash_post_state.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/trie/trie/benches/hash_post_state.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f208607ea7e494063cd808cb"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;trie&#47;benches&#47;hash_post_state.rs scroll-reth&#47;crates&#47;trie&#47;trie&#47;benches&#47;hash_post_state.rs</span>
<span class="term-fg1">index 6e913ef78a3cbd419820a866dc84221a175fea1b..7111a785f4699617e5624a0c566a76eadad6ef7e 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;trie&#47;benches&#47;hash_post_state.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;trie&#47;benches&#47;hash_post_state.rs</span>
<span class="term-fg36">@@ -2,7 +2,7 @@</span> #![allow(missing_docs, unreachable_pub)]
 use alloy_primitives::{keccak256, map::HashMap, Address, B256, U256};
 use criterion::{criterion_group, criterion_main, BenchmarkId, Criterion};
 use proptest::{prelude::*, strategy::ValueTree, test_runner::TestRunner};
<span class="term-fg31">-use reth_trie::{HashedPostState, HashedStorage};</span>
<span class="term-fg32">+use reth_trie::{HashedPostState, HashedStorage, KeccakKeyHasher};</span>
 use revm::db::{states::BundleBuilder, BundleAccount};
&nbsp;
 pub fn hash_post_state(c: &amp;mut Criterion) {
<span class="term-fg36">@@ -19,7 +19,7 @@</span>         });
&nbsp;
         &#47;&#47; parallel
         group.bench_function(BenchmarkId::new(&quot;parallel hashing&quot;, size), |b| {
<span class="term-fg31">-            b.iter(|| HashedPostState::from_bundle_state(&amp;state))</span>
<span class="term-fg32">+            b.iter(|| HashedPostState::from_bundle_state::&lt;KeccakKeyHasher&gt;(&amp;state))</span>
         });
     }
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f2fdb42f6537134e3a13c90c" role="button"
                       aria-expanded="false" aria-controls="id-f2fdb42f6537134e3a13c90c">
                        <code>crates/trie/trie/src/state.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/trie/src/state.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/trie/trie/src/state.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+38</span></div>
                            <div class="text-start"><span class="text-danger">-16</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f2fdb42f6537134e3a13c90c"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;trie&#47;src&#47;state.rs scroll-reth&#47;crates&#47;trie&#47;trie&#47;src&#47;state.rs</span>
<span class="term-fg1">index fdfb86a53ddb26479bd59579b80d88afe3ebf7a6..bcac327bd42c828599648d426de37ffae5daf7a7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;trie&#47;src&#47;state.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;trie&#47;src&#47;state.rs</span>
<span class="term-fg36">@@ -3,13 +3,13 @@</span>     prefix_set::{PrefixSetMut, TriePrefixSetsMut},
     Nibbles,
 };
 use alloy_primitives::{
<span class="term-fg31">-    keccak256,</span>
     map::{hash_map, HashMap, HashSet},
     Address, B256, U256,
 };
 use itertools::Itertools;
 use rayon::prelude::{IntoParallelIterator, ParallelIterator};
 use reth_primitives::Account;
<span class="term-fg32">+use reth_trie_common::KeyHasher;</span>
 use revm::db::{states::CacheAccount, AccountStatus, BundleAccount};
 use std::borrow::Cow;
&nbsp;
<span class="term-fg36">@@ -26,15 +26,15 @@</span> impl HashedPostState {
     &#47;&#47;&#47; Initialize [`HashedPostState`] from bundle state.
     &#47;&#47;&#47; Hashes all changed accounts and storage entries that are currently stored in the bundle
     &#47;&#47;&#47; state.
<span class="term-fg31">-    pub fn from_bundle_state&lt;&#39;a&gt;(</span>
<span class="term-fg32">+    pub fn from_bundle_state&lt;&#39;a, KH: KeyHasher&gt;(</span>
         state: impl IntoParallelIterator&lt;Item = (&amp;&#39;a Address, &amp;&#39;a BundleAccount)&gt;,
     ) -&gt; Self {
         let hashed = state
             .into_par_iter()
             .map(|(address, account)| {
<span class="term-fg31">-                let hashed_address = keccak256(address);</span>
<span class="term-fg32">+                let hashed_address = KH::hash_key(address);</span>
                 let hashed_account = account.info.clone().map(Into::into);
<span class="term-fg31">-                let hashed_storage = HashedStorage::from_plain_storage(</span>
<span class="term-fg32">+                let hashed_storage = HashedStorage::from_plain_storage::&lt;KH&gt;(</span>
                     account.status,
                     account.storage.iter().map(|(slot, value)| (slot, &amp;value.present_value)),
                 );
<span class="term-fg36">@@ -53,15 +53,16 @@</span>     }
&nbsp;
     &#47;&#47;&#47; Initialize [`HashedPostState`] from cached state.
     &#47;&#47;&#47; Hashes all changed accounts and storage entries that are currently stored in cache.
<span class="term-fg31">-    pub fn from_cache_state&lt;&#39;a&gt;(</span>
<span class="term-fg32">+    pub fn from_cache_state&lt;&#39;a, KH: KeyHasher&gt;(</span>
         state: impl IntoParallelIterator&lt;Item = (&amp;&#39;a Address, &amp;&#39;a CacheAccount)&gt;,
     ) -&gt; Self {
         let hashed = state
             .into_par_iter()
             .map(|(address, account)| {
<span class="term-fg31">-                let hashed_address = keccak256(address);</span>
<span class="term-fg31">-                let hashed_account = account.account.as_ref().map(|a| a.info.clone().into());</span>
<span class="term-fg31">-                let hashed_storage = HashedStorage::from_plain_storage(</span>
<span class="term-fg32">+                let hashed_address = KH::hash_key(address);</span>
<span class="term-fg32">+                let hashed_account =</span>
<span class="term-fg32">+                    account.account.as_ref().map(|a| Account::from_account_info(a.info.clone()));</span>
<span class="term-fg32">+                let hashed_storage = HashedStorage::from_plain_storage::&lt;KH&gt;(</span>
                     account.status,
                     account.account.as_ref().map(|a| a.storage.iter()).into_iter().flatten(),
                 );
<span class="term-fg36">@@ -223,14 +224,25 @@</span>     pub fn from_iter(wiped: bool, iter: impl IntoIterator&lt;Item = (B256, U256)&gt;) -&gt; Self {
         Self { wiped, storage: HashMap::from_iter(iter) }
     }
&nbsp;
<span class="term-fg32">+    &#47;&#47;&#47; Create a new hashed storage from the provided [`BundleAccount`]</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; This function will use the present value of the storage slots in the account to create the</span>
<span class="term-fg32">+    &#47;&#47;&#47; hashed storage.</span>
<span class="term-fg32">+    pub fn from_bundle_account&lt;KH: KeyHasher&gt;(account: &amp;BundleAccount) -&gt; Self {</span>
<span class="term-fg32">+        Self::from_plain_storage::&lt;KH&gt;(</span>
<span class="term-fg32">+            account.status,</span>
<span class="term-fg32">+            account.storage.iter().map(|(slot, value)| (slot, &amp;value.present_value)),</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
     &#47;&#47;&#47; Create new hashed storage from account status and plain storage.
<span class="term-fg31">-    pub fn from_plain_storage&lt;&#39;a&gt;(</span>
<span class="term-fg32">+    pub fn from_plain_storage&lt;&#39;a, KH: KeyHasher&gt;(</span>
         status: AccountStatus,
         storage: impl IntoIterator&lt;Item = (&amp;&#39;a U256, &amp;&#39;a U256)&gt;,
     ) -&gt; Self {
         Self::from_iter(
             status.was_destroyed(),
<span class="term-fg31">-            storage.into_iter().map(|(key, value)| (keccak256(B256::from(*key)), *value)),</span>
<span class="term-fg32">+            storage.into_iter().map(|(key, value)| (KH::hash_key(B256::from(*key)), *value)),</span>
         )
     }
&nbsp;
<span class="term-fg36">@@ -353,13 +365,15 @@</span>
 #[cfg(test)]
 mod tests {
     use super::*;
<span class="term-fg31">-    use alloy_primitives::Bytes;</span>
<span class="term-fg32">+    use alloy_primitives::{keccak256, Address, Bytes};</span>
<span class="term-fg32">+    use reth_trie_common::KeccakKeyHasher;</span>
     use revm::{
         db::{
<span class="term-fg31">-            states::{plain_account::PlainStorage, StorageSlot},</span>
<span class="term-fg31">-            PlainAccount, StorageWithOriginalValues,</span>
<span class="term-fg32">+            states::{plain_account::PlainStorage, CacheAccount, StorageSlot},</span>
<span class="term-fg32">+            BundleAccount, StorageWithOriginalValues,</span>
         },
         primitives::{AccountInfo, Bytecode},
<span class="term-fg32">+        PlainAccount,</span>
     };
&nbsp;
     #[test]
<span class="term-fg36">@@ -447,6 +461,10 @@</span>             balance: U256::from(123),
             nonce: 42,
             code_hash: B256::random(),
             code: Some(Bytecode::LegacyRaw(Bytes::from(vec![1, 2]))),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: 2,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: B256::random(),</span>
         };
&nbsp;
         let mut storage = StorageWithOriginalValues::default();
<span class="term-fg36">@@ -467,7 +485,7 @@</span>         &#47;&#47; Create a vector of tuples representing the bundle state.
         let state = vec![(&amp;address, &amp;account)];
&nbsp;
         &#47;&#47; Convert the bundle state into a hashed post state.
<span class="term-fg31">-        let hashed_state = HashedPostState::from_bundle_state(state);</span>
<span class="term-fg32">+        let hashed_state = HashedPostState::from_bundle_state::&lt;KeccakKeyHasher&gt;(state);</span>
&nbsp;
         &#47;&#47; Validate the hashed post state.
         assert_eq!(hashed_state.accounts.len(), 1);
<span class="term-fg36">@@ -486,7 +504,7 @@</span>         &#47;&#47; Prepare a random Ethereum address.
         let address = Address::random();
&nbsp;
         &#47;&#47; Create mock account info.
<span class="term-fg31">-        let account_info = AccountInfo {</span>
<span class="term-fg32">+        let account_info = revm::shared::AccountInfo {</span>
             balance: U256::from(500),
             nonce: 5,
             code_hash: B256::random(),
<span class="term-fg36">@@ -506,7 +524,7 @@</span>         &#47;&#47; Create a vector of tuples representing the cache state.
         let state = vec![(&amp;address, &amp;account)];
&nbsp;
         &#47;&#47; Convert the cache state into a hashed post state.
<span class="term-fg31">-        let hashed_state = HashedPostState::from_cache_state(state);</span>
<span class="term-fg32">+        let hashed_state = HashedPostState::from_cache_state::&lt;KeccakKeyHasher&gt;(state);</span>
&nbsp;
         &#47;&#47; Validate the hashed post state.
         assert_eq!(hashed_state.accounts.len(), 1);
<span class="term-fg36">@@ -530,6 +548,10 @@</span>             balance: U256::from(1000),
             nonce: 1,
             code_hash: B256::random(),
             code: None,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: 10,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: B256::random(),</span>
         };
&nbsp;
         &#47;&#47; Create hashed accounts with addresses.</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2e9295e30eaa42e8dd033f93" role="button"
                       aria-expanded="false" aria-controls="id-2e9295e30eaa42e8dd033f93">
                        <code>crates/trie/trie/src/trie_cursor/subnode.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/trie/src/trie_cursor/subnode.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/trie/trie/src/trie_cursor/subnode.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2e9295e30eaa42e8dd033f93"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;trie&#47;src&#47;trie_cursor&#47;subnode.rs scroll-reth&#47;crates&#47;trie&#47;trie&#47;src&#47;trie_cursor&#47;subnode.rs</span>
<span class="term-fg1">index c928028eb15766f459abe59f4198dff2dffea54b..457c1ba4685bb285f00d593a390ec411661c8373 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;trie&#47;src&#47;trie_cursor&#47;subnode.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;trie&#47;src&#47;trie_cursor&#47;subnode.rs</span>
<span class="term-fg36">@@ -76,7 +76,7 @@</span>     #[inline]
     pub fn state_flag(&amp;self) -&gt; bool {
         self.node
             .as_ref()
<span class="term-fg31">-            .map_or(true, |node| self.nibble &lt; 0 || node.state_mask.is_bit_set(self.nibble as u8))</span>
<span class="term-fg32">+            .is_none_or(|node| self.nibble &lt; 0 || node.state_mask.is_bit_set(self.nibble as u8))</span>
     }
&nbsp;
     &#47;&#47;&#47; Returns `true` if the tree flag is set for the current nibble.
<span class="term-fg36">@@ -84,7 +84,7 @@</span>     #[inline]
     pub fn tree_flag(&amp;self) -&gt; bool {
         self.node
             .as_ref()
<span class="term-fg31">-            .map_or(true, |node| self.nibble &lt; 0 || node.tree_mask.is_bit_set(self.nibble as u8))</span>
<span class="term-fg32">+            .is_none_or(|node| self.nibble &lt; 0 || node.tree_mask.is_bit_set(self.nibble as u8))</span>
     }
&nbsp;
     &#47;&#47;&#47; Returns `true` if the current nibble has a root hash.</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-e1d3e69939cdd04529f3bafa"role="button" aria-expanded="false" aria-controls="id-e1d3e69939cdd04529f3bafa">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>Other changes</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+821</span></div>
                    <div class="text-start"><span class="text-danger">-179</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-e1d3e69939cdd04529f3bafa">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5fa87d6beb084396c6ed963e" role="button"
                       aria-expanded="false" aria-controls="id-5fa87d6beb084396c6ed963e">
                        <code>Cargo.lock</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/Cargo.lock" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/Cargo.lock" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+140</span></div>
                            <div class="text-start"><span class="text-danger">-29</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5fa87d6beb084396c6ed963e"><span class="term-fg1">diff --git reth&#47;Cargo.lock scroll-reth&#47;Cargo.lock</span>
<span class="term-fg1">index 04f3b854e9e42599678e2248b581bfd56a0409f3..b69aef5ab40067e10d2efd3f95cf106dfc20e6c0 100644</span>
<span class="term-fg1">--- reth&#47;Cargo.lock</span>
<span class="term-fg1">+++ scroll-reth&#47;Cargo.lock</span>
<span class="term-fg36">@@ -1346,6 +1346,19 @@</span>  &quot;zeroize&quot;,
 ]
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;bn254&quot;</span>
<span class="term-fg32">+version = &quot;0.1.0&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;bn254#81e1dcc92ee9a2798b13b84b24de182e9c42256e&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;ff&quot;,</span>
<span class="term-fg32">+ &quot;getrandom 0.2.15&quot;,</span>
<span class="term-fg32">+ &quot;rand 0.8.5&quot;,</span>
<span class="term-fg32">+ &quot;rand_core 0.6.4&quot;,</span>
<span class="term-fg32">+ &quot;sp1-intrinsics&quot;,</span>
<span class="term-fg32">+ &quot;subtle&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;boa_ast&quot;
 version = &quot;0.19.1&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -2620,8 +2633,9 @@</span>  &quot;reth-evm-ethereum&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-stages&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_json&quot;,
  &quot;thiserror 1.0.69&quot;,
<span class="term-fg36">@@ -2830,6 +2844,7 @@</span>  &quot;reth-evm&quot;,
  &quot;reth-evm-ethereum&quot;,
  &quot;reth-node-ethereum&quot;,
  &quot;reth-primitives&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -3148,6 +3163,7 @@</span> version = &quot;0.13.0&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;ded41244b729663b1e574f1b4fb731469f69f79c17667b5d776b16cda0479449&quot;
 dependencies = [
<span class="term-fg32">+ &quot;bitvec&quot;,</span>
  &quot;rand_core 0.6.4&quot;,
  &quot;subtle&quot;,
 ]
<span class="term-fg36">@@ -4601,7 +4617,7 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;4979f22fdb869068da03c9f7528f8297c6fd2606bc3a4affe42e6a823fdb8da4&quot;
 dependencies = [
  &quot;cfg-if&quot;,
<span class="term-fg31">- &quot;windows-targets 0.52.6&quot;,</span>
<span class="term-fg32">+ &quot;windows-targets 0.48.5&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -5742,6 +5758,15 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;280dc24453071f1b63954171985a0b0d30058d287960968b9b2aca264c8d4ee6&quot;
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;poseidon-bn254&quot;</span>
<span class="term-fg32">+version = &quot;0.1.0&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254?rev=526a64a#526a64a81419bcab6bd8280a8a3f9808189e0373&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;bn254&quot;,</span>
<span class="term-fg32">+ &quot;itertools 0.13.0&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;powerfmt&quot;
 version = &quot;0.2.0&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -6445,9 +6470,9 @@</span>  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-tasks&quot;,
  &quot;reth-transaction-pool&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;tokio&quot;,
  &quot;tracing&quot;,
 ]
<span class="term-fg36">@@ -6572,6 +6597,8 @@</span>  &quot;reth-node-types&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-stages-api&quot;,
  &quot;reth-storage-errors&quot;,
  &quot;reth-testing-utils&quot;,
<span class="term-fg36">@@ -6615,10 +6642,10 @@</span>  &quot;reth-execution-types&quot;,
  &quot;reth-metrics&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-storage-api&quot;,
  &quot;reth-testing-utils&quot;,
  &quot;reth-trie&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;tokio&quot;,
  &quot;tokio-stream&quot;,
  &quot;tracing&quot;,
<span class="term-fg36">@@ -6882,6 +6909,7 @@</span>  &quot;reth-nippy-jar&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-prune-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
  &quot;reth-stages-types&quot;,
  &quot;reth-storage-errors&quot;,
  &quot;reth-tracing&quot;,
<span class="term-fg36">@@ -6944,6 +6972,7 @@</span>  &quot;reth-node-types&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-provider&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
  &quot;reth-stages-types&quot;,
  &quot;reth-trie&quot;,
  &quot;reth-trie-db&quot;,
<span class="term-fg36">@@ -7284,6 +7313,7 @@</span>  &quot;reth-prune&quot;,
  &quot;reth-prune-types&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc-types-compat&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
  &quot;reth-stages&quot;,
  &quot;reth-stages-api&quot;,
  &quot;reth-static-file&quot;,
<span class="term-fg36">@@ -7322,6 +7352,8 @@</span>  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc-types-compat&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-trie&quot;,
  &quot;revm-primitives&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -7490,9 +7522,8 @@</span>  &quot;reth-payload-primitives&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-transaction-pool&quot;,
<span class="term-fg31">- &quot;reth-trie&quot;,</span>
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;tracing&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -7529,8 +7560,9 @@</span>  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-prune-types&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-storage-errors&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;revm-primitives&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -7551,6 +7583,8 @@</span>  &quot;reth-evm&quot;,
  &quot;reth-execution-types&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
  &quot;reth-testing-utils&quot;,
  &quot;revm-primitives&quot;,
  &quot;secp256k1&quot;,
<span class="term-fg36">@@ -7585,9 +7619,9 @@</span>  &quot;rand 0.8.5&quot;,
  &quot;reth-execution-errors&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-trie&quot;,
  &quot;reth-trie-common&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_with&quot;,
 ]
<span class="term-fg36">@@ -7623,6 +7657,7 @@</span>  &quot;reth-primitives-traits&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-prune-types&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-stages-api&quot;,
  &quot;reth-tasks&quot;,
  &quot;reth-testing-utils&quot;,
<span class="term-fg36">@@ -7714,6 +7749,9 @@</span>  &quot;reth-primitives-traits&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc-api&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-tracing&quot;,
  &quot;reth-trie&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -8133,11 +8171,11 @@</span>  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc&quot;,
  &quot;reth-rpc-eth-api&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-tasks&quot;,
  &quot;reth-tracing&quot;,
  &quot;reth-transaction-pool&quot;,
  &quot;reth-trie-db&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde_json&quot;,
  &quot;tokio&quot;,
 ]
<span class="term-fg36">@@ -8310,7 +8348,8 @@</span>  &quot;reth-optimism-primitives&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-prune-types&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;revm-primitives&quot;,
  &quot;tracing&quot;,
 ]
<span class="term-fg36">@@ -8370,11 +8409,11 @@</span>  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc-server-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-tasks&quot;,
  &quot;reth-tracing&quot;,
  &quot;reth-transaction-pool&quot;,
  &quot;reth-trie-db&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_json&quot;,
  &quot;tokio&quot;,
<span class="term-fg36">@@ -8409,9 +8448,8 @@</span>  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc-types-compat&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-transaction-pool&quot;,
<span class="term-fg31">- &quot;reth-trie&quot;,</span>
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;sha2 0.10.8&quot;,
  &quot;thiserror 1.0.69&quot;,
  &quot;tracing&quot;,
<span class="term-fg36">@@ -8472,9 +8510,9 @@</span>  &quot;reth-rpc-api&quot;,
  &quot;reth-rpc-eth-api&quot;,
  &quot;reth-rpc-eth-types&quot;,
  &quot;reth-rpc-server-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-tasks&quot;,
  &quot;reth-transaction-pool&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde_json&quot;,
  &quot;thiserror 1.0.69&quot;,
  &quot;tokio&quot;,
<span class="term-fg36">@@ -8508,7 +8546,7 @@</span>  &quot;reth-metrics&quot;,
  &quot;reth-payload-builder-primitives&quot;,
  &quot;reth-payload-primitives&quot;,
  &quot;reth-primitives&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;tokio&quot;,
  &quot;tokio-stream&quot;,
  &quot;tracing&quot;,
<span class="term-fg36">@@ -8598,10 +8636,11 @@</span>  &quot;reth-chainspec&quot;,
  &quot;reth-codecs&quot;,
  &quot;reth-ethereum-forks&quot;,
  &quot;reth-primitives-traits&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-static-file-types&quot;,
  &quot;reth-testing-utils&quot;,
  &quot;reth-trie-common&quot;,
<span class="term-fg31">- &quot;revm-primitives&quot;,</span>
  &quot;rstest&quot;,
  &quot;secp256k1&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -8631,7 +8670,8 @@</span>  &quot;proptest&quot;,
  &quot;proptest-arbitrary-interop&quot;,
  &quot;rand 0.8.5&quot;,
  &quot;reth-codecs&quot;,
<span class="term-fg31">- &quot;revm-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;roaring&quot;,
  &quot;serde&quot;,
  &quot;serde_json&quot;,
<span class="term-fg36">@@ -8676,13 +8716,14 @@</span>  &quot;reth-optimism-primitives&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-prune-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-stages-types&quot;,
  &quot;reth-storage-api&quot;,
  &quot;reth-storage-errors&quot;,
  &quot;reth-testing-utils&quot;,
  &quot;reth-trie&quot;,
  &quot;reth-trie-db&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;strum&quot;,
  &quot;tempfile&quot;,
  &quot;tokio&quot;,
<span class="term-fg36">@@ -8753,10 +8794,11 @@</span>  &quot;reth-execution-errors&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-prune-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-storage-api&quot;,
  &quot;reth-storage-errors&quot;,
  &quot;reth-trie&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -8815,11 +8857,11 @@</span>  &quot;reth-rpc-eth-api&quot;,
  &quot;reth-rpc-eth-types&quot;,
  &quot;reth-rpc-server-types&quot;,
  &quot;reth-rpc-types-compat&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-tasks&quot;,
  &quot;reth-testing-utils&quot;,
  &quot;reth-transaction-pool&quot;,
<span class="term-fg31">- &quot;reth-trie&quot;,</span>
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;revm-inspectors&quot;,
  &quot;revm-primitives&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -8996,10 +9038,11 @@</span>  &quot;reth-revm&quot;,
  &quot;reth-rpc-eth-types&quot;,
  &quot;reth-rpc-server-types&quot;,
  &quot;reth-rpc-types-compat&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-tasks&quot;,
  &quot;reth-transaction-pool&quot;,
<span class="term-fg31">- &quot;reth-trie&quot;,</span>
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;revm-inspectors&quot;,
  &quot;revm-primitives&quot;,
  &quot;tokio&quot;,
<span class="term-fg36">@@ -9033,11 +9076,11 @@</span>  &quot;reth-primitives-traits&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc-server-types&quot;,
  &quot;reth-rpc-types-compat&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-storage-api&quot;,
  &quot;reth-tasks&quot;,
  &quot;reth-transaction-pool&quot;,
  &quot;reth-trie&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;revm-inspectors&quot;,
  &quot;revm-primitives&quot;,
  &quot;schnellru&quot;,
<span class="term-fg36">@@ -9100,6 +9143,60 @@</span>  &quot;serde_json&quot;,
 ]
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;reth-scroll-execution&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;reth-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-primitives&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;alloy-consensus&quot;,</span>
<span class="term-fg32">+ &quot;alloy-eips&quot;,</span>
<span class="term-fg32">+ &quot;alloy-primitives&quot;,</span>
<span class="term-fg32">+ &quot;alloy-rlp&quot;,</span>
<span class="term-fg32">+ &quot;alloy-serde&quot;,</span>
<span class="term-fg32">+ &quot;arbitrary&quot;,</span>
<span class="term-fg32">+ &quot;bincode&quot;,</span>
<span class="term-fg32">+ &quot;bytes&quot;,</span>
<span class="term-fg32">+ &quot;modular-bitfield&quot;,</span>
<span class="term-fg32">+ &quot;poseidon-bn254&quot;,</span>
<span class="term-fg32">+ &quot;proptest&quot;,</span>
<span class="term-fg32">+ &quot;proptest-arbitrary-interop&quot;,</span>
<span class="term-fg32">+ &quot;rand 0.8.5&quot;,</span>
<span class="term-fg32">+ &quot;reth-codecs&quot;,</span>
<span class="term-fg32">+ &quot;reth-codecs-derive&quot;,</span>
<span class="term-fg32">+ &quot;serde&quot;,</span>
<span class="term-fg32">+ &quot;test-fuzz&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-revm&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;revm&quot;,</span>
<span class="term-fg32">+ &quot;serde&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-storage&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;alloy-primitives&quot;,</span>
<span class="term-fg32">+ &quot;eyre&quot;,</span>
<span class="term-fg32">+ &quot;reth-codecs&quot;,</span>
<span class="term-fg32">+ &quot;reth-primitives-traits&quot;,</span>
<span class="term-fg32">+ &quot;reth-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-storage-errors&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;reth-stages&quot;
 version = &quot;1.1.2&quot;
 dependencies = [
<span class="term-fg36">@@ -9138,6 +9235,8 @@</span>  &quot;reth-provider&quot;,
  &quot;reth-prune&quot;,
  &quot;reth-prune-types&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-stages-api&quot;,
  &quot;reth-static-file&quot;,
  &quot;reth-storage-errors&quot;,
<span class="term-fg36">@@ -9247,6 +9346,7 @@</span>  &quot;reth-execution-types&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-prune-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-stages-types&quot;,
  &quot;reth-storage-errors&quot;,
  &quot;reth-trie&quot;,
<span class="term-fg36">@@ -9350,10 +9450,10 @@</span>  &quot;reth-payload-util&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-provider&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-storage-api&quot;,
  &quot;reth-tasks&quot;,
  &quot;reth-tracing&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;rustc-hash 2.0.0&quot;,
  &quot;schnellru&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -9384,10 +9484,11 @@</span>  &quot;rayon&quot;,
  &quot;reth-execution-errors&quot;,
  &quot;reth-metrics&quot;,
  &quot;reth-primitives&quot;,
<span class="term-fg32">+ &quot;reth-primitives-traits&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-stages-types&quot;,
  &quot;reth-storage-errors&quot;,
  &quot;reth-trie-common&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde_json&quot;,
  &quot;tracing&quot;,
  &quot;triehash&quot;,
<span class="term-fg36">@@ -9415,7 +9516,8 @@</span>  &quot;proptest&quot;,
  &quot;proptest-arbitrary-interop&quot;,
  &quot;reth-codecs&quot;,
  &quot;reth-primitives-traits&quot;,
<span class="term-fg31">- &quot;revm-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_json&quot;,
  &quot;serde_with&quot;,
<span class="term-fg36">@@ -9439,10 +9541,11 @@</span>  &quot;reth-execution-errors&quot;,
  &quot;reth-metrics&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-storage-errors&quot;,
  &quot;reth-trie&quot;,
  &quot;reth-trie-common&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_json&quot;,
  &quot;similar-asserts&quot;,
<span class="term-fg36">@@ -10456,6 +10559,14 @@</span>  &quot;sha1&quot;,
 ]
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;sp1-intrinsics&quot;</span>
<span class="term-fg32">+version = &quot;0.0.0&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;sp1-intrinsics.git?branch=master#7e038e60db0b2e847f6d8f49e148ccac8c6fc394&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;cfg-if&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;spin&quot;
 version = &quot;0.9.8&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -11243,7 +11354,7 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;3637e734239e12ab152cd269302500bd063f37624ee210cd04b4936ed671f3b1&quot;
 dependencies = [
  &quot;cc&quot;,
<span class="term-fg31">- &quot;windows-targets 0.52.6&quot;,</span>
<span class="term-fg32">+ &quot;windows-targets 0.48.5&quot;,</span>
 ]
&nbsp;
 [[package]]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f15fe904f297914e0773be6e" role="button"
                       aria-expanded="false" aria-controls="id-f15fe904f297914e0773be6e">
                        <code>Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f15fe904f297914e0773be6e"><span class="term-fg1">diff --git reth&#47;Cargo.toml scroll-reth&#47;Cargo.toml</span>
<span class="term-fg1">index 113d0661f3ffc1d4204e856727083a163a32df89..72809cc2610bb7a9d2a6cd7627214edf2e8d5021 100644</span>
<span class="term-fg1">--- reth&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;Cargo.toml</span>
<span class="term-fg36">@@ -100,6 +100,10 @@</span>     &quot;crates&#47;rpc&#47;rpc-server-types&#47;&quot;,
     &quot;crates&#47;rpc&#47;rpc-testing-util&#47;&quot;,
     &quot;crates&#47;rpc&#47;rpc-types-compat&#47;&quot;,
     &quot;crates&#47;rpc&#47;rpc&#47;&quot;,
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;execution&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;primitives&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;revm&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;storage&quot;,</span>
     &quot;crates&#47;stages&#47;api&#47;&quot;,
     &quot;crates&#47;stages&#47;stages&#47;&quot;,
     &quot;crates&#47;stages&#47;types&#47;&quot;,
<span class="term-fg36">@@ -403,6 +407,10 @@</span> reth-rpc-eth-types = { path = &quot;crates&#47;rpc&#47;rpc-eth-types&quot;, default-features = false }
 reth-rpc-layer = { path = &quot;crates&#47;rpc&#47;rpc-layer&quot; }
 reth-rpc-server-types = { path = &quot;crates&#47;rpc&#47;rpc-server-types&quot; }
 reth-rpc-types-compat = { path = &quot;crates&#47;rpc&#47;rpc-types-compat&quot; }
<span class="term-fg32">+reth-scroll-execution = { path = &quot;crates&#47;scroll&#47;execution&quot; }</span>
<span class="term-fg32">+reth-scroll-primitives = { path = &quot;crates&#47;scroll&#47;primitives&quot; }</span>
<span class="term-fg32">+reth-scroll-revm = { path = &quot;crates&#47;scroll&#47;revm&quot; }</span>
<span class="term-fg32">+reth-scroll-storage = { path = &quot;crates&#47;scroll&#47;storage&quot; }</span>
 reth-stages = { path = &quot;crates&#47;stages&#47;stages&quot; }
 reth-stages-api = { path = &quot;crates&#47;stages&#47;api&quot; }
 reth-stages-types = { path = &quot;crates&#47;stages&#47;types&quot; }
<span class="term-fg36">@@ -422,7 +430,7 @@</span> reth-trie-parallel = { path = &quot;crates&#47;trie&#47;parallel&quot; }
 reth-trie-sparse = { path = &quot;crates&#47;trie&#47;sparse&quot; }
&nbsp;
 # revm
<span class="term-fg31">-revm = { version = &quot;18.0.0&quot;, features = [&quot;std&quot;], default-features = false }</span>
<span class="term-fg32">+revm = { package = &quot;reth-scroll-revm&quot;, path = &quot;crates&#47;scroll&#47;revm&quot;, default-features = false }</span>
 revm-inspectors = &quot;0.11.0&quot;
 revm-primitives = { version = &quot;14.0.0&quot;, features = [
     &quot;std&quot;,
<span class="term-fg36">@@ -470,6 +478,10 @@</span>     &quot;reqwest-rustls-tls&quot;,
 ], default-features = false }
 alloy-transport-ipc = { version = &quot;0.6.4&quot;, default-features = false }
 alloy-transport-ws = { version = &quot;0.6.4&quot;, default-features = false }
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+# TODO (scroll): point to crates.io&#47;tag once the crate is published&#47;a tag is created.</span>
<span class="term-fg32">+poseidon-bn254 = { git = &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254&quot;, rev = &quot;526a64a&quot;, features = [&quot;bn254&quot;] }</span>
&nbsp;
 # op
 op-alloy-rpc-types = &quot;0.6.7&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-53375f4a5711927c5f53151a" role="button"
                       aria-expanded="false" aria-controls="id-53375f4a5711927c5f53151a">
                        <code>bin/reth/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/bin/reth/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/bin/reth/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-53375f4a5711927c5f53151a"><span class="term-fg1">diff --git reth&#47;bin&#47;reth&#47;Cargo.toml scroll-reth&#47;bin&#47;reth&#47;Cargo.toml</span>
<span class="term-fg1">index a152bea2681efabf538b14dd39a0f5f1e809b640..437d11b5ad0298e343b38dab4c51964d3afc6578 100644</span>
<span class="term-fg1">--- reth&#47;bin&#47;reth&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;bin&#47;reth&#47;Cargo.toml</span>
<span class="term-fg36">@@ -120,6 +120,7 @@</span> 	&quot;reth-cli-util&#47;jemalloc&quot;,
 	&quot;reth-cli-util&#47;jemalloc-prof&quot;
 ]
 tracy-allocator = [&quot;reth-cli-util&#47;tracy-allocator&quot;]
<span class="term-fg32">+scroll = []</span>
&nbsp;
 min-error-logs = [&quot;tracing&#47;release_max_level_error&quot;]
 min-warn-logs = [&quot;tracing&#47;release_max_level_warn&quot;]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cc298aa8e04304597fd10840" role="button"
                       aria-expanded="false" aria-controls="id-cc298aa8e04304597fd10840">
                        <code>bin/reth/src/commands/debug_cmd/build_block.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/bin/reth/src/commands/debug_cmd/build_block.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/bin/reth/src/commands/debug_cmd/build_block.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cc298aa8e04304597fd10840"><span class="term-fg1">diff --git reth&#47;bin&#47;reth&#47;src&#47;commands&#47;debug_cmd&#47;build_block.rs scroll-reth&#47;bin&#47;reth&#47;src&#47;commands&#47;debug_cmd&#47;build_block.rs</span>
<span class="term-fg1">index dc00e07d8830d168cb02c3c7c34681d0ca8ac5a5..8c17f8ab7a5e94db2eaac69f560689a619636208 100644</span>
<span class="term-fg1">--- reth&#47;bin&#47;reth&#47;src&#47;commands&#47;debug_cmd&#47;build_block.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;bin&#47;reth&#47;src&#47;commands&#47;debug_cmd&#47;build_block.rs</span>
<span class="term-fg36">@@ -261,7 +261,8 @@</span>                 let senders = block.senders().expect(&quot;sender recovery failed&quot;);
                 let block_with_senders =
                     SealedBlockWithSenders::&lt;BlockTy&lt;N&gt;&gt;::new(block.clone(), senders).unwrap();
&nbsp;
<span class="term-fg31">-                let db = StateProviderDatabase::new(blockchain_db.latest()?);</span>
<span class="term-fg32">+                let state_provider = blockchain_db.latest()?;</span>
<span class="term-fg32">+                let db = StateProviderDatabase::new(&amp;state_provider);</span>
                 let executor =
                     EthExecutorProvider::ethereum(provider_factory.chain_spec()).executor(db);
&nbsp;
<span class="term-fg36">@@ -271,7 +272,7 @@</span>                 let execution_outcome =
                     ExecutionOutcome::from((block_execution_output, block.number));
                 debug!(target: &quot;reth::cli&quot;, ?execution_outcome, &quot;Executed block&quot;);
&nbsp;
<span class="term-fg31">-                let hashed_post_state = execution_outcome.hash_state_slow();</span>
<span class="term-fg32">+                let hashed_post_state = state_provider.hashed_post_state(execution_outcome.state());</span>
                 let (state_root, trie_updates) = StateRoot::overlay_root_with_updates(
                     provider_factory.provider()?.tx_ref(),
                     hashed_post_state.clone(),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c3d5956090772d2cc5d27e47" role="button"
                       aria-expanded="false" aria-controls="id-c3d5956090772d2cc5d27e47">
                        <code>bin/reth/src/commands/debug_cmd/in_memory_merkle.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/bin/reth/src/commands/debug_cmd/in_memory_merkle.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/bin/reth/src/commands/debug_cmd/in_memory_merkle.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c3d5956090772d2cc5d27e47"><span class="term-fg1">diff --git reth&#47;bin&#47;reth&#47;src&#47;commands&#47;debug_cmd&#47;in_memory_merkle.rs scroll-reth&#47;bin&#47;reth&#47;src&#47;commands&#47;debug_cmd&#47;in_memory_merkle.rs</span>
<span class="term-fg1">index 870dc1ddf2335d2112f58a35d7fa9885556b50a4..feaf960dc93a9b81f5db041bce24140f347e87e3 100644</span>
<span class="term-fg1">--- reth&#47;bin&#47;reth&#47;src&#47;commands&#47;debug_cmd&#47;in_memory_merkle.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;bin&#47;reth&#47;src&#47;commands&#47;debug_cmd&#47;in_memory_merkle.rs</span>
<span class="term-fg36">@@ -24,8 +24,9 @@</span> use reth_node_ethereum::EthExecutorProvider;
 use reth_primitives::BlockExt;
 use reth_provider::{
     providers::ProviderNodeTypes, AccountExtReader, ChainSpecProvider, DatabaseProviderFactory,
<span class="term-fg31">-    HashingWriter, HeaderProvider, LatestStateProviderRef, OriginalValuesKnown, ProviderFactory,</span>
<span class="term-fg31">-    StageCheckpointReader, StateWriter, StorageLocation, StorageReader,</span>
<span class="term-fg32">+    HashedPostStateProvider, HashingWriter, HeaderProvider, LatestStateProviderRef,</span>
<span class="term-fg32">+    OriginalValuesKnown, ProviderFactory, StageCheckpointReader, StateWriter, StorageLocation,</span>
<span class="term-fg32">+    StorageReader,</span>
 };
 use reth_revm::database::StateProviderDatabase;
 use reth_stages::StageId;
<span class="term-fg36">@@ -142,7 +143,8 @@</span>                 |err, _| warn!(target: &quot;reth::cli&quot;, &quot;Error requesting body: {err}. Retrying...&quot;),
             )
             .await?;
&nbsp;
<span class="term-fg31">-        let db = StateProviderDatabase::new(LatestStateProviderRef::new(&amp;provider));</span>
<span class="term-fg32">+        let state_provider = LatestStateProviderRef::new(&amp;provider);</span>
<span class="term-fg32">+        let db = StateProviderDatabase::new(&amp;state_provider);</span>
&nbsp;
         let executor = EthExecutorProvider::ethereum(provider_factory.chain_spec()).executor(db);
&nbsp;
<span class="term-fg36">@@ -164,7 +166,7 @@</span>
         &#47;&#47; Unpacked `BundleState::state_root_slow` function
         let (in_memory_state_root, in_memory_updates) = StateRoot::overlay_root_with_updates(
             provider.tx_ref(),
<span class="term-fg31">-            execution_outcome.hash_state_slow(),</span>
<span class="term-fg32">+            state_provider.hashed_post_state(execution_outcome.state()),</span>
         )?;
&nbsp;
         if in_memory_state_root == block.state_root {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f8578e8ff64cf6fa77ef4220" role="button"
                       aria-expanded="false" aria-controls="id-f8578e8ff64cf6fa77ef4220">
                        <code>bin/reth/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/bin/reth/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/bin/reth/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f8578e8ff64cf6fa77ef4220"><span class="term-fg1">diff --git reth&#47;bin&#47;reth&#47;src&#47;lib.rs scroll-reth&#47;bin&#47;reth&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 53c592063eca67b13f1aed5f89672ecb1a4d08ef..dba3ff77c8fa2cd32156c59aef7cd29c58126410 100644</span>
<span class="term-fg1">--- reth&#47;bin&#47;reth&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;bin&#47;reth&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -26,6 +26,9 @@</span>     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 pub mod cli;
 pub mod commands;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5f68080028048f0dba59b6dc" role="button"
                       aria-expanded="false" aria-controls="id-5f68080028048f0dba59b6dc">
                        <code>bin/reth/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/bin/reth/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/bin/reth/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5f68080028048f0dba59b6dc"><span class="term-fg1">diff --git reth&#47;bin&#47;reth&#47;src&#47;main.rs scroll-reth&#47;bin&#47;reth&#47;src&#47;main.rs</span>
<span class="term-fg1">index e146912c06f995da5e3f934c62f0fdfceeb388c3..19053b8a20733f0d0215cb36e0e177718b0bc3b2 100644</span>
<span class="term-fg1">--- reth&#47;bin&#47;reth&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;bin&#47;reth&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,4 +1,7 @@</span>
 #![allow(missing_docs)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 #[global_allocator]
 static ALLOC: reth_cli_util::allocator::Allocator = reth_cli_util::allocator::new_allocator();</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0a572befc501d85f87b67736" role="button"
                       aria-expanded="false" aria-controls="id-0a572befc501d85f87b67736">
                        <code>crates/blockchain-tree/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/blockchain-tree/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/blockchain-tree/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+21</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0a572befc501d85f87b67736"><span class="term-fg1">diff --git reth&#47;crates&#47;blockchain-tree&#47;Cargo.toml scroll-reth&#47;crates&#47;blockchain-tree&#47;Cargo.toml</span>
<span class="term-fg1">index 3fa6de2b402c26393d8d7f9ab9c4e4584f1eaf74..1fa7854aee59089b2223ade99f408633d7268dca 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;blockchain-tree&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;blockchain-tree&#47;Cargo.toml</span>
<span class="term-fg36">@@ -34,6 +34,9 @@</span> # ethereum
 alloy-primitives.workspace = true
 alloy-eips.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # common
 parking_lot.workspace = true
 tracing.workspace = true
<span class="term-fg36">@@ -62,6 +65,7 @@</span> parking_lot.workspace = true
 assert_matches.workspace = true
 alloy-genesis.workspace = true
 alloy-consensus.workspace = true
<span class="term-fg32">+revm.workspace = true</span>
&nbsp;
 [features]
 test-utils = [
<span class="term-fg36">@@ -76,12 +80,27 @@</span> 	&quot;reth-db&#47;test-utils&quot;,
 	&quot;reth-db-api&#47;test-utils&quot;,
 	&quot;reth-provider&#47;test-utils&quot;,
 	&quot;reth-trie-db&#47;test-utils&quot;,
<span class="term-fg31">-	&quot;reth-trie&#47;test-utils&quot;</span>
<span class="term-fg32">+	&quot;reth-trie&#47;test-utils&quot;,</span>
<span class="term-fg32">+	&quot;revm&#47;test-utils&quot;</span>
 ]
 optimism = [
 	&quot;reth-primitives&#47;optimism&quot;,
 	&quot;reth-provider&#47;optimism&quot;,
 	&quot;reth-execution-types&#47;optimism&quot;,
 	&quot;reth-db&#47;optimism&quot;,
<span class="term-fg31">-	&quot;reth-db-api&#47;optimism&quot;</span>
<span class="term-fg32">+	&quot;reth-db-api&#47;optimism&quot;,</span>
<span class="term-fg32">+	&quot;revm&#47;optimism&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-trie-db&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-testing-utils&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-storage&#47;scroll&quot;</span>
 ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5e0baa6ea90a952837fb8be6" role="button"
                       aria-expanded="false" aria-controls="id-5e0baa6ea90a952837fb8be6">
                        <code>crates/blockchain-tree/src/blockchain_tree.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/blockchain-tree/src/blockchain_tree.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/blockchain-tree/src/blockchain_tree.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5e0baa6ea90a952837fb8be6"><span class="term-fg1">diff --git reth&#47;crates&#47;blockchain-tree&#47;src&#47;blockchain_tree.rs scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;blockchain_tree.rs</span>
<span class="term-fg1">index bbf1cb099617ad86be56b421cc133b9f288117eb..3c0d332c81dc968c1816b92757484a78067dfcf3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;blockchain-tree&#47;src&#47;blockchain_tree.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;blockchain_tree.rs</span>
<span class="term-fg36">@@ -24,8 +24,8 @@</span> };
 use reth_provider::{
     BlockExecutionWriter, BlockNumReader, BlockWriter, CanonStateNotification,
     CanonStateNotificationSender, CanonStateNotifications, ChainSpecProvider, ChainSplit,
<span class="term-fg31">-    ChainSplitTarget, DBProvider, DisplayBlocksChain, HeaderProvider, ProviderError,</span>
<span class="term-fg31">-    StaticFileProviderFactory, StorageLocation,</span>
<span class="term-fg32">+    ChainSplitTarget, DBProvider, DisplayBlocksChain, HashedPostStateProvider, HeaderProvider,</span>
<span class="term-fg32">+    ProviderError, StaticFileProviderFactory, StorageLocation,</span>
 };
 use reth_stages_api::{MetricEvent, MetricEventsSender};
 use reth_storage_errors::provider::{ProviderResult, RootMismatch};
<span class="term-fg36">@@ -1215,7 +1215,7 @@</span>         chain: Chain,
         recorder: &amp;mut MakeCanonicalDurationsRecorder,
     ) -&gt; Result&lt;(), CanonicalError&gt; {
         let (blocks, state, chain_trie_updates) = chain.into_inner();
<span class="term-fg31">-        let hashed_state = state.hash_state_slow();</span>
<span class="term-fg32">+        let hashed_state = self.externals.provider_factory.hashed_post_state(state.state());</span>
         let prefix_sets = hashed_state.construct_prefix_sets().freeze();
         let hashed_state_sorted = hashed_state.into_sorted();
&nbsp;
<span class="term-fg36">@@ -1400,9 +1400,9 @@</span>             MockNodeTypesWithDB,
         },
         ProviderFactory, StorageLocation,
     };
<span class="term-fg31">-    use reth_revm::primitives::AccountInfo;</span>
     use reth_stages_api::StageCheckpoint;
     use reth_trie::{root::state_root_unhashed, StateRoot};
<span class="term-fg32">+    use revm::AccountInfo;</span>
     use std::collections::HashMap;
&nbsp;
     fn setup_externals(
<span class="term-fg36">@@ -1880,7 +1880,12 @@</span>             CanonicalOutcome::Committed { head: block5.header.clone() }
         );
&nbsp;
         let provider = tree.externals.provider_factory.provider().unwrap();
<span class="term-fg31">-        let prefix_sets = exec5.hash_state_slow().construct_prefix_sets().freeze();</span>
<span class="term-fg32">+        let prefix_sets = tree</span>
<span class="term-fg32">+            .externals</span>
<span class="term-fg32">+            .provider_factory</span>
<span class="term-fg32">+            .hashed_post_state(exec5.state())</span>
<span class="term-fg32">+            .construct_prefix_sets()</span>
<span class="term-fg32">+            .freeze();</span>
         let state_root =
             StateRoot::from_tx(provider.tx_ref()).with_prefix_sets(prefix_sets).root().unwrap();
         assert_eq!(state_root, block5.state_root);</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e97c6ec9be3f4cd3763a7aed" role="button"
                       aria-expanded="false" aria-controls="id-e97c6ec9be3f4cd3763a7aed">
                        <code>crates/blockchain-tree/src/chain.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/blockchain-tree/src/chain.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/blockchain-tree/src/chain.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+9</span></div>
                            <div class="text-start"><span class="text-danger">-8</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e97c6ec9be3f4cd3763a7aed"><span class="term-fg1">diff --git reth&#47;crates&#47;blockchain-tree&#47;src&#47;chain.rs scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;chain.rs</span>
<span class="term-fg1">index 6ac39c316702c4bdf3ab57b6fdd387907fa32298..b82ee04103445bbc99beef811491ea9d7d143606 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;blockchain-tree&#47;src&#47;chain.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;chain.rs</span>
<span class="term-fg36">@@ -18,11 +18,10 @@</span> use reth_execution_types::{Chain, ExecutionOutcome};
 use reth_primitives::{GotExpected, SealedBlockWithSenders, SealedHeader};
 use reth_provider::{
     providers::{BundleStateProvider, ConsistentDbView, ProviderNodeTypes},
<span class="term-fg31">-    DBProvider, FullExecutionDataProvider, ProviderError, StateRootProvider,</span>
<span class="term-fg31">-    TryIntoHistoricalStateProvider,</span>
<span class="term-fg32">+    DBProvider, FullExecutionDataProvider, HashedPostStateProvider, ProviderError,</span>
<span class="term-fg32">+    StateRootProvider, TryIntoHistoricalStateProvider,</span>
 };
<span class="term-fg31">-use reth_revm::database::StateProviderDatabase;</span>
<span class="term-fg31">-use reth_trie::{updates::TrieUpdates, HashedPostState, TrieInput};</span>
<span class="term-fg32">+use reth_trie::{updates::TrieUpdates, TrieInput};</span>
 use reth_trie_parallel::root::ParallelStateRoot;
 use std::{
     collections::BTreeMap,
<span class="term-fg36">@@ -204,7 +203,10 @@</span>             .try_into_history_at_block(canonical_fork.number)?;
&nbsp;
         let provider = BundleStateProvider::new(state_provider, bundle_state_data_provider);
&nbsp;
<span class="term-fg31">-        let db = StateProviderDatabase::new(&amp;provider);</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let db = reth_revm::database::StateProviderDatabase::new(&amp;provider);</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let db = reth_scroll_storage::ScrollStateProviderDatabase::new(&amp;provider);</span>
         let executor = externals.executor_factory.executor(db);
         let block_hash = block.hash();
         let block = block.unseal();
<span class="term-fg36">@@ -228,14 +230,13 @@</span>                     provider.block_execution_data_provider.execution_outcome().clone();
                 execution_outcome.extend(initial_execution_outcome.clone());
                 ParallelStateRoot::new(
                     consistent_view,
<span class="term-fg31">-                    TrieInput::from_state(execution_outcome.hash_state_slow()),</span>
<span class="term-fg32">+                    TrieInput::from_state(provider.hashed_post_state(execution_outcome.state())),</span>
                 )
                 .incremental_root_with_updates()
                 .map(|(root, updates)| (root, Some(updates)))
                 .map_err(ProviderError::from)?
             } else {
<span class="term-fg31">-                let hashed_state =</span>
<span class="term-fg31">-                    HashedPostState::from_bundle_state(&amp;initial_execution_outcome.state().state);</span>
<span class="term-fg32">+                let hashed_state = provider.hashed_post_state(initial_execution_outcome.state());</span>
                 let state_root = provider.state_root(hashed_state)?;
                 (state_root, None)
             };</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6feb7b876209bd25cf615756" role="button"
                       aria-expanded="false" aria-controls="id-6feb7b876209bd25cf615756">
                        <code>crates/blockchain-tree/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/blockchain-tree/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/blockchain-tree/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6feb7b876209bd25cf615756"><span class="term-fg1">diff --git reth&#47;crates&#47;blockchain-tree&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 3f501bead071a6eef729a92e86ebe136e3403707..29e747a40a8786143af85ce9c75b55bee2f202fb 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;blockchain-tree&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -18,6 +18,8 @@</span> )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
&nbsp;
<span class="term-fg32">+use reth_revm as _;</span>
<span class="term-fg32">+</span>
 &#47;&#47;&#47; Re-export of the blockchain tree API.
 pub use reth_blockchain_tree_api::*;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e060ff535dd3ffc5ddaede44" role="button"
                       aria-expanded="false" aria-controls="id-e060ff535dd3ffc5ddaede44">
                        <code>crates/chain-state/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/chain-state/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/chain-state/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e060ff535dd3ffc5ddaede44"><span class="term-fg1">diff --git reth&#47;crates&#47;chain-state&#47;Cargo.toml scroll-reth&#47;crates&#47;chain-state&#47;Cargo.toml</span>
<span class="term-fg1">index d2ef5870947b06f37d41da89e9ad6c1e74eed77e..2b06bd93707b4b37c0aa6f231001e855057f945a 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;chain-state&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;chain-state&#47;Cargo.toml</span>
<span class="term-fg36">@@ -26,6 +26,7 @@</span> # ethereum
 alloy-eips.workspace = true
 alloy-primitives.workspace = true
 alloy-consensus.workspace = true
<span class="term-fg32">+revm.workspace = true</span>
&nbsp;
 # async
 tokio = { workspace = true, default-features = false, features = [&quot;sync&quot;, &quot;macros&quot;] }
<span class="term-fg36">@@ -44,7 +45,6 @@</span> # optional deps for test-utils
 alloy-signer = { workspace = true, optional = true }
 alloy-signer-local = { workspace = true, optional = true }
 rand = { workspace = true, optional = true }
<span class="term-fg31">-revm = { workspace = true, optional = true }</span>
&nbsp;
 [dev-dependencies]
 reth-testing-utils.workspace = true
<span class="term-fg36">@@ -52,17 +52,15 @@</span> alloy-signer.workspace = true
 alloy-signer-local.workspace = true
 alloy-consensus.workspace = true
 rand.workspace = true
<span class="term-fg31">-revm.workspace = true</span>
&nbsp;
 [features]
 test-utils = [
     &quot;alloy-signer&quot;,
     &quot;alloy-signer-local&quot;,
     &quot;rand&quot;,
<span class="term-fg31">-    &quot;revm&quot;,</span>
     &quot;reth-chainspec&#47;test-utils&quot;,
     &quot;reth-primitives&#47;test-utils&quot;,
     &quot;reth-primitives-traits&#47;test-utils&quot;,
     &quot;reth-trie&#47;test-utils&quot;,
<span class="term-fg31">-    &quot;revm?&#47;test-utils&quot;,</span>
<span class="term-fg32">+    &quot;revm&#47;test-utils&quot;,</span>
 ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-19db4526b869a3a8ac27a3b6" role="button"
                       aria-expanded="false" aria-controls="id-19db4526b869a3a8ac27a3b6">
                        <code>crates/chain-state/src/in_memory.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/chain-state/src/in_memory.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/chain-state/src/in_memory.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+15</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-19db4526b869a3a8ac27a3b6"><span class="term-fg1">diff --git reth&#47;crates&#47;chain-state&#47;src&#47;in_memory.rs scroll-reth&#47;crates&#47;chain-state&#47;src&#47;in_memory.rs</span>
<span class="term-fg1">index f43aae562e00bc769b026445dce06f0277e8589d..f698a5b7b2f96c78525de7da7d27d502710f2a03 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;chain-state&#47;src&#47;in_memory.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;chain-state&#47;src&#47;in_memory.rs</span>
<span class="term-fg36">@@ -949,12 +949,13 @@</span>     use rand::Rng;
     use reth_errors::ProviderResult;
     use reth_primitives::{Account, Bytecode, EthPrimitives, Receipt};
     use reth_storage_api::{
<span class="term-fg31">-        AccountReader, BlockHashReader, StateProofProvider, StateProvider, StateRootProvider,</span>
<span class="term-fg31">-        StorageRootProvider,</span>
<span class="term-fg32">+        AccountReader, BlockHashReader, HashedPostStateProvider, HashedStorageProvider,</span>
<span class="term-fg32">+        StateProofProvider, StateProvider, StateRootProvider, StorageRootProvider,</span>
     };
     use reth_trie::{
         AccountProof, HashedStorage, MultiProof, StorageMultiProof, StorageProof, TrieInput,
     };
<span class="term-fg32">+    use revm::db::BundleAccount;</span>
&nbsp;
     fn create_mock_state(
         test_block_builder: &amp;mut TestBlockBuilder&lt;EthPrimitives&gt;,
<span class="term-fg36">@@ -1044,6 +1045,18 @@</span>             &amp;self,
             _input: TrieInput,
         ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {
             Ok((B256::random(), TrieUpdates::default()))
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    impl HashedPostStateProvider for MockStateProvider {</span>
<span class="term-fg32">+        fn hashed_post_state(&amp;self, _bundle_state: &amp;revm::db::BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+            HashedPostState::default()</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    impl HashedStorageProvider for MockStateProvider {</span>
<span class="term-fg32">+        fn hashed_storage(&amp;self, _account: &amp;BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+            HashedStorage::default()</span>
         }
     }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-97b0cf7e8ed58b913a798e02" role="button"
                       aria-expanded="false" aria-controls="id-97b0cf7e8ed58b913a798e02">
                        <code>crates/chain-state/src/memory_overlay.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/chain-state/src/memory_overlay.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/chain-state/src/memory_overlay.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+15</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-97b0cf7e8ed58b913a798e02"><span class="term-fg1">diff --git reth&#47;crates&#47;chain-state&#47;src&#47;memory_overlay.rs scroll-reth&#47;crates&#47;chain-state&#47;src&#47;memory_overlay.rs</span>
<span class="term-fg1">index c84bd8c93f06505f3c6b6e03f733a028e63cc6b4..a901190143da06fe40239ee5351fc7577acc02a9 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;chain-state&#47;src&#47;memory_overlay.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;chain-state&#47;src&#47;memory_overlay.rs</span>
<span class="term-fg36">@@ -8,13 +8,14 @@</span> };
 use reth_errors::ProviderResult;
 use reth_primitives::{Account, Bytecode, NodePrimitives};
 use reth_storage_api::{
<span class="term-fg31">-    AccountReader, BlockHashReader, StateProofProvider, StateProvider, StateRootProvider,</span>
<span class="term-fg31">-    StorageRootProvider,</span>
<span class="term-fg32">+    AccountReader, BlockHashReader, HashedPostStateProvider, HashedStorageProvider,</span>
<span class="term-fg32">+    StateProofProvider, StateProvider, StateRootProvider, StorageRootProvider,</span>
 };
 use reth_trie::{
     updates::TrieUpdates, AccountProof, HashedPostState, HashedStorage, MultiProof,
     StorageMultiProof, TrieInput,
 };
<span class="term-fg32">+use revm::db::{BundleAccount, BundleState};</span>
 use std::sync::OnceLock;
&nbsp;
 &#47;&#47;&#47; A state provider that stores references to in-memory blocks along with their state as well as a
<span class="term-fg36">@@ -215,6 +216,18 @@</span>             ) -&gt; ProviderResult&lt;HashMap&lt;B256, Bytes&gt;&gt; {
                 let MemoryOverlayTrieState { nodes, state } = self.trie_state().clone();
                 input.prepend_cached(nodes, state);
                 self.historical.witness(input, target)
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        impl $($tokens)* HashedPostStateProvider for $type {</span>
<span class="term-fg32">+            fn hashed_post_state(&amp;self, bundle_state: &amp;BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+                self.historical.hashed_post_state(bundle_state)</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        impl $($tokens)* HashedStorageProvider for $type {</span>
<span class="term-fg32">+            fn hashed_storage(&amp;self, account: &amp;BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+                self.historical.hashed_storage(account)</span>
             }
         }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7cb44cbf3b20ebe68c1b74d6" role="button"
                       aria-expanded="false" aria-controls="id-7cb44cbf3b20ebe68c1b74d6">
                        <code>crates/e2e-test-utils/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/e2e-test-utils/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/e2e-test-utils/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7cb44cbf3b20ebe68c1b74d6"><span class="term-fg1">diff --git reth&#47;crates&#47;e2e-test-utils&#47;Cargo.toml scroll-reth&#47;crates&#47;e2e-test-utils&#47;Cargo.toml</span>
<span class="term-fg1">index bedacbecd7594080dae2d3f7a4f7fcc06d435b8f..9a11a3b11095feb205315ab6f025f8286c22aeb8 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;e2e-test-utils&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;e2e-test-utils&#47;Cargo.toml</span>
<span class="term-fg36">@@ -60,3 +60,6 @@</span> alloy-network.workspace = true
 alloy-consensus = { workspace = true, features = [&quot;kzg&quot;] }
 tracing.workspace = true
 derive_more.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e09501397342f4f97d4e4e4c" role="button"
                       aria-expanded="false" aria-controls="id-e09501397342f4f97d4e4e4c">
                        <code>crates/e2e-test-utils/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/e2e-test-utils/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/e2e-test-utils/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e09501397342f4f97d4e4e4c"><span class="term-fg1">diff --git reth&#47;crates&#47;e2e-test-utils&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;e2e-test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 15065377fabf858b0b7c4b28a9146ef87ea9cb04..de833273ad98f876da8ecd43e321ab1d8bd5fe5f 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;e2e-test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;e2e-test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -1,5 +1,9 @@</span>
 &#47;&#47;! Utilities for end-to-end tests.
&nbsp;
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 use node::NodeTestContext;
 use reth_chainspec::EthChainSpec;
 use reth_db::{test_utils::TempDatabase, DatabaseEnv};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a0e3a1a835c3619e2b7bd1d9" role="button"
                       aria-expanded="false" aria-controls="id-a0e3a1a835c3619e2b7bd1d9">
                        <code>crates/engine/invalid-block-hooks/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/invalid-block-hooks/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/engine/invalid-block-hooks/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+16</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a0e3a1a835c3619e2b7bd1d9"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;Cargo.toml scroll-reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;Cargo.toml</span>
<span class="term-fg1">index a7b0153d0d4b7d2968afc5b34e642bf2afdb65a2..2b215954e3e4d37a888fb1af282e84cc60af32b6 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;Cargo.toml</span>
<span class="term-fg36">@@ -29,6 +29,11 @@</span> alloy-rlp.workspace = true
 alloy-rpc-types-debug.workspace = true
 alloy-consensus.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+reth-scroll-revm = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # async
 futures.workspace = true
&nbsp;
<span class="term-fg36">@@ -38,3 +43,14 @@</span> jsonrpsee.workspace = true
 pretty_assertions = &quot;1.4&quot;
 serde.workspace = true
 serde_json.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-storage&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-revm&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-abf563fb414b460edf843170" role="button"
                       aria-expanded="false" aria-controls="id-abf563fb414b460edf843170">
                        <code>crates/engine/invalid-block-hooks/src/witness.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/invalid-block-hooks/src/witness.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/engine/invalid-block-hooks/src/witness.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+23</span></div>
                            <div class="text-start"><span class="text-danger">-14</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-abf563fb414b460edf843170"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;src&#47;witness.rs scroll-reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;src&#47;witness.rs</span>
<span class="term-fg1">index 98ee8dd2d1370efdf8b7499034f6d454882f575b..df60103c32f2aa8476719a233ba01e706297e2ee 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;src&#47;witness.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;src&#47;witness.rs</span>
<span class="term-fg36">@@ -12,12 +12,13 @@</span> use reth_primitives::{Receipt, SealedBlockWithSenders, SealedHeader};
 use reth_primitives_traits::SignedTransaction;
 use reth_provider::{BlockExecutionOutput, ChainSpecProvider, StateProviderFactory};
 use reth_revm::{
<span class="term-fg31">-    database::StateProviderDatabase, db::states::bundle_state::BundleRetention,</span>
<span class="term-fg31">-    primitives::EnvWithHandlerCfg, DatabaseCommit, StateBuilder,</span>
<span class="term-fg32">+    db::states::bundle_state::BundleRetention, primitives::EnvWithHandlerCfg, DatabaseCommit,</span>
<span class="term-fg32">+    StateBuilder,</span>
 };
 use reth_rpc_api::DebugApiClient;
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use reth_tracing::tracing::warn;
<span class="term-fg31">-use reth_trie::{updates::TrieUpdates, HashedPostState, HashedStorage};</span>
<span class="term-fg32">+use reth_trie::{updates::TrieUpdates, HashedStorage};</span>
 use serde::Serialize;
 use std::{collections::HashMap, fmt::Debug, fs::File, io::Write, path::PathBuf};
&nbsp;
<span class="term-fg36">@@ -66,12 +67,12 @@</span>     ) -&gt; eyre::Result&lt;()&gt; {
         &#47;&#47; TODO(alexey): unify with `DebugApi::debug_execution_witness`
&nbsp;
         &#47;&#47; Setup database.
<span class="term-fg31">-        let mut db = StateBuilder::new()</span>
<span class="term-fg31">-            .with_database(StateProviderDatabase::new(</span>
<span class="term-fg31">-                self.provider.state_by_block_hash(parent_header.hash())?,</span>
<span class="term-fg31">-            ))</span>
<span class="term-fg31">-            .with_bundle_update()</span>
<span class="term-fg31">-            .build();</span>
<span class="term-fg32">+        let provider = self.provider.state_by_block_hash(parent_header.hash())?;</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let state = reth_revm::database::StateProviderDatabase::new(provider);</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let state = reth_scroll_storage::ScrollStateProviderDatabase::new(provider);</span>
<span class="term-fg32">+        let mut db = StateBuilder::new().with_database(state).with_bundle_update().build();</span>
&nbsp;
         &#47;&#47; Setup environment for the execution.
         let (cfg, block_env) = self.evm_config.cfg_and_block_env(block.header(), U256::MAX);
<span class="term-fg36">@@ -117,7 +118,7 @@</span>         &#47;&#47; Merge all state transitions
         db.merge_transitions(BundleRetention::Reverts);
&nbsp;
         &#47;&#47; Take the bundle state
<span class="term-fg31">-        let mut bundle_state = db.take_bundle();</span>
<span class="term-fg32">+        let mut bundle_state = db.finalize();</span>
&nbsp;
         &#47;&#47; Initialize a map of preimages.
         let mut state_preimages = HashMap::default();
<span class="term-fg36">@@ -126,12 +127,20 @@</span>         &#47;&#47; Grab all account proofs for the data accessed during block execution.
         &#47;&#47;
         &#47;&#47; Note: We grab *all* accounts in the cache here, as the `BundleState` prunes
         &#47;&#47; referenced accounts + storage slots.
<span class="term-fg31">-        let mut hashed_state = HashedPostState::from_bundle_state(&amp;bundle_state.state);</span>
<span class="term-fg32">+        let mut hashed_state = db.database.hashed_post_state(&amp;bundle_state);</span>
         for (address, account) in db.cache.accounts {
             let hashed_address = keccak256(address);
<span class="term-fg31">-            hashed_state</span>
<span class="term-fg31">-                .accounts</span>
<span class="term-fg31">-                .insert(hashed_address, account.account.as_ref().map(|a| a.info.clone().into()));</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            let hashed_account = account.account.as_ref().map(|a| {</span>
<span class="term-fg32">+                Into::&lt;reth_scroll_revm::AccountInfo&gt;::into((</span>
<span class="term-fg32">+                    a.info.clone(),</span>
<span class="term-fg32">+                    &amp;db.database.post_execution_context,</span>
<span class="term-fg32">+                ))</span>
<span class="term-fg32">+                .into()</span>
<span class="term-fg32">+            });</span>
<span class="term-fg32">+            #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+            let hashed_account = account.account.as_ref().map(|a| a.info.clone().into());</span>
<span class="term-fg32">+            hashed_state.accounts.insert(hashed_address, hashed_account);</span>
&nbsp;
             let storage = hashed_state
                 .storages</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b51c1ffa6e742e6a16bab63d" role="button"
                       aria-expanded="false" aria-controls="id-b51c1ffa6e742e6a16bab63d">
                        <code>crates/engine/primitives/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/primitives/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/engine/primitives/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+7</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b51c1ffa6e742e6a16bab63d"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;primitives&#47;Cargo.toml scroll-reth&#47;crates&#47;engine&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">index 2da1be9c928e9558ec046103d340722b89f267cb..97d2959b32949b97e5abe5bde438922eeca95199 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg36">@@ -32,3 +32,10 @@</span>
 # misc
 serde.workspace = true
 thiserror.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0c7f3dafb9179df9f6c34020" role="button"
                       aria-expanded="false" aria-controls="id-0c7f3dafb9179df9f6c34020">
                        <code>crates/engine/tree/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/tree/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/engine/tree/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0c7f3dafb9179df9f6c34020"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;tree&#47;Cargo.toml scroll-reth&#47;crates&#47;engine&#47;tree&#47;Cargo.toml</span>
<span class="term-fg1">index 680b6933ebe6df14a14fc71c010b442d6c49b5c3..4ecc4181643e46454e4dc287347fc7f25561548d 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;tree&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;tree&#47;Cargo.toml</span>
<span class="term-fg36">@@ -29,6 +29,7 @@</span> reth-primitives.workspace = true
 reth-provider.workspace = true
 reth-prune.workspace = true
 reth-revm.workspace = true
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
 reth-stages-api.workspace = true
 reth-tasks.workspace = true
 reth-trie-db.workspace = true
<span class="term-fg36">@@ -116,3 +117,4 @@</span>     &quot;reth-trie&#47;test-utils&quot;,
     &quot;reth-prune-types?&#47;test-utils&quot;,
     &quot;reth-trie-db&#47;test-utils&quot;,
 ]
<span class="term-fg32">+scroll = [&quot;reth-scroll-primitives&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4dce17ab08c18cb9c18eeabb" role="button"
                       aria-expanded="false" aria-controls="id-4dce17ab08c18cb9c18eeabb">
                        <code>crates/engine/tree/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/tree/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/engine/tree/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4dce17ab08c18cb9c18eeabb"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;tree&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;engine&#47;tree&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 100b71604f536a94b42032fc56718d486364ab94..7687bd11360f885f132e99882bafc57d02ae0240 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;tree&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;tree&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -90,7 +90,7 @@</span>     html_favicon_url = &quot;https:&#47;&#47;avatars0.githubusercontent.com&#47;u&#47;97369466?s=256&quot;,
     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg31">-#![cfg_attr(not(test), warn(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg_attr(not(any(test, feature = &quot;scroll&quot;)), warn(unused_crate_dependencies))]</span>
&nbsp;
 &#47;&#47;&#47; Re-export of the blockchain tree API.
 pub use reth_blockchain_tree_api::*;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-64a38827cfbeb9b9ce6e8009" role="button"
                       aria-expanded="false" aria-controls="id-64a38827cfbeb9b9ce6e8009">
                        <code>crates/engine/tree/src/tree/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/tree/src/tree/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/engine/tree/src/tree/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-64a38827cfbeb9b9ce6e8009"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;tree&#47;src&#47;tree&#47;mod.rs scroll-reth&#47;crates&#47;engine&#47;tree&#47;src&#47;tree&#47;mod.rs</span>
<span class="term-fg1">index 5dc8039afe65d35154aabb26668506ed39459b77..d6466612156f3509c0ae8434c1177d7be91bc391 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;tree&#47;src&#47;tree&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;tree&#47;src&#47;tree&#47;mod.rs</span>
<span class="term-fg36">@@ -41,8 +41,8 @@</span>     SealedHeader,
 };
 use reth_provider::{
     providers::ConsistentDbView, BlockReader, DatabaseProviderFactory, ExecutionOutcome,
<span class="term-fg31">-    ProviderError, StateProviderBox, StateProviderFactory, StateReader, StateRootProvider,</span>
<span class="term-fg31">-    TransactionVariant,</span>
<span class="term-fg32">+    HashedPostStateProvider, ProviderError, StateCommitmentProvider, StateProviderBox,</span>
<span class="term-fg32">+    StateProviderFactory, StateReader, StateRootProvider, TransactionVariant,</span>
 };
 use reth_revm::database::StateProviderDatabase;
 use reth_stages_api::ControlFlow;
<span class="term-fg36">@@ -545,6 +545,8 @@</span>     P: DatabaseProviderFactory
         + BlockReader&lt;Block = reth_primitives::Block&gt;
         + StateProviderFactory
         + StateReader&lt;Receipt = reth_primitives::Receipt&gt;
<span class="term-fg32">+        + StateCommitmentProvider</span>
<span class="term-fg32">+        + HashedPostStateProvider</span>
         + Clone
         + &#39;static,
     &lt;P as DatabaseProviderFactory&gt;::Provider: BlockReader,
<span class="term-fg36">@@ -1561,7 +1563,7 @@</span>         let execution_output = self
             .provider
             .get_state(block.number())?
             .ok_or_else(|| ProviderError::StateForNumberNotFound(block.number()))?;
<span class="term-fg31">-        let hashed_state = execution_output.hash_state_slow();</span>
<span class="term-fg32">+        let hashed_state = self.provider.hashed_post_state(execution_output.state());</span>
&nbsp;
         Ok(Some(ExecutedBlock {
             block: Arc::new(block),
<span class="term-fg36">@@ -2235,7 +2237,7 @@</span>             );
             return Err(err.into())
         }
&nbsp;
<span class="term-fg31">-        let hashed_state = HashedPostState::from_bundle_state(&amp;output.state.state);</span>
<span class="term-fg32">+        let hashed_state = self.provider.hashed_post_state(&amp;output.state);</span>
&nbsp;
         trace!(target: &quot;engine::tree&quot;, block=?sealed_block.num_hash(), &quot;Calculating block state root&quot;);
         let root_time = Instant::now();</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-737661998094c5570d1bf439" role="button"
                       aria-expanded="false" aria-controls="id-737661998094c5570d1bf439">
                        <code>crates/engine/tree/src/tree/root.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/tree/src/tree/root.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/engine/tree/src/tree/root.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-737661998094c5570d1bf439"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;tree&#47;src&#47;tree&#47;root.rs scroll-reth&#47;crates&#47;engine&#47;tree&#47;src&#47;tree&#47;root.rs</span>
<span class="term-fg1">index 602e87a63dbeed2c1cc4c773186de59c221e1c97..05691a40ae53a9441516eb42456dc4b11959bd87 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;tree&#47;src&#47;tree&#47;root.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;tree&#47;src&#47;tree&#47;root.rs</span>
<span class="term-fg36">@@ -3,6 +3,7 @@</span>
 use alloy_primitives::map::{HashMap, HashSet};
 use reth_provider::{
     providers::ConsistentDbView, BlockReader, DBProvider, DatabaseProviderFactory,
<span class="term-fg32">+    StateCommitmentProvider,</span>
 };
 use reth_trie::{
     proof::Proof, updates::TrieUpdates, HashedPostState, HashedStorage, MultiProof, Nibbles,
<span class="term-fg36">@@ -176,7 +177,12 @@</span>
 #[allow(dead_code)]
 impl&lt;Factory&gt; StateRootTask&lt;Factory&gt;
 where
<span class="term-fg31">-    Factory: DatabaseProviderFactory&lt;Provider: BlockReader&gt; + Clone + Send + Sync + &#39;static,</span>
<span class="term-fg32">+    Factory: DatabaseProviderFactory&lt;Provider: BlockReader&gt;</span>
<span class="term-fg32">+        + StateCommitmentProvider</span>
<span class="term-fg32">+        + Clone</span>
<span class="term-fg32">+        + Send</span>
<span class="term-fg32">+        + Sync</span>
<span class="term-fg32">+        + &#39;static,</span>
 {
     &#47;&#47;&#47; Creates a new state root task with the unified message channel
     pub(crate) fn new(
<span class="term-fg36">@@ -558,6 +564,10 @@</span>                 None
             } else {
                 Some(revm_account.info.code_hash)
             },
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: revm_account.info.code.as_ref().map(|code| {</span>
<span class="term-fg32">+                reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code.original_byte_slice())</span>
<span class="term-fg32">+            }),</span>
         }
     }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-df25ebbba785e56960d4b31d" role="button"
                       aria-expanded="false" aria-controls="id-df25ebbba785e56960d4b31d">
                        <code>crates/engine/util/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/util/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/engine/util/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-df25ebbba785e56960d4b31d"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;util&#47;Cargo.toml scroll-reth&#47;crates&#47;engine&#47;util&#47;Cargo.toml</span>
<span class="term-fg1">index 6eb22340ec100c5587d8bb43aeae8d01baa8463b..310838a43cec6ae0dfb3e59014f2007befbab20a 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;util&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;util&#47;Cargo.toml</span>
<span class="term-fg36">@@ -31,6 +31,10 @@</span> alloy-primitives.workspace = true
 alloy-rpc-types-engine.workspace = true
 alloy-consensus.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # async
 tokio = { workspace = true, default-features = false }
 tokio-util.workspace = true
<span class="term-fg36">@@ -54,3 +58,4 @@</span>     &quot;reth-primitives&#47;optimism&quot;,
     &quot;reth-provider&#47;optimism&quot;,
     &quot;revm-primitives&#47;optimism&quot;,
 ]
<span class="term-fg32">+scroll = [&quot;reth-scroll-storage&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b7cbb4894c9bfe0b2925cbeb" role="button"
                       aria-expanded="false" aria-controls="id-b7cbb4894c9bfe0b2925cbeb">
                        <code>crates/engine/util/src/reorg.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/util/src/reorg.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/engine/util/src/reorg.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-10</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b7cbb4894c9bfe0b2925cbeb"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;util&#47;src&#47;reorg.rs scroll-reth&#47;crates&#47;engine&#47;util&#47;src&#47;reorg.rs</span>
<span class="term-fg1">index 20e2b21446ae3fcbf96ccd371a3ef51df18ff788..367a3cb7c84db4450c1db371c6b32b9fa933d7b2 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;util&#47;src&#47;reorg.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;util&#47;src&#47;reorg.rs</span>
<span class="term-fg36">@@ -21,12 +21,11 @@</span> use reth_payload_validator::ExecutionPayloadValidator;
 use reth_primitives::{proofs, Block, BlockBody, BlockExt, Receipt, Receipts};
 use reth_provider::{BlockReader, ExecutionOutcome, ProviderError, StateProviderFactory};
 use reth_revm::{
<span class="term-fg31">-    database::StateProviderDatabase,</span>
     db::{states::bundle_state::BundleRetention, State},
     DatabaseCommit,
 };
 use reth_rpc_types_compat::engine::payload::block_to_payload;
<span class="term-fg31">-use reth_trie::HashedPostState;</span>
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use revm_primitives::{calc_excess_blob_gas, EVMError, EnvWithHandlerCfg};
 use std::{
     collections::VecDeque,
<span class="term-fg36">@@ -290,10 +289,11 @@</span>     debug!(target: &quot;engine::stream::reorg&quot;, number = reorg_target.number, hash = %previous_hash, &quot;Selected reorg target&quot;);
&nbsp;
     &#47;&#47; Configure state
     let state_provider = provider.state_by_block_hash(reorg_target.parent_hash)?;
<span class="term-fg31">-    let mut state = State::builder()</span>
<span class="term-fg31">-        .with_database_ref(StateProviderDatabase::new(&amp;state_provider))</span>
<span class="term-fg31">-        .with_bundle_update()</span>
<span class="term-fg31">-        .build();</span>
<span class="term-fg32">+    #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+    let mut db = reth_revm::database::StateProviderDatabase::new(&amp;state_provider);</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    let mut db = reth_scroll_storage::ScrollStateProviderDatabase::new(&amp;state_provider);</span>
<span class="term-fg32">+    let mut state = State::builder().with_database(&amp;mut db).with_bundle_update().build();</span>
&nbsp;
     &#47;&#47; Configure environments
     let (cfg, block_env) = evm_config.cfg_and_block_env(&amp;reorg_target.header, U256::MAX);
<span class="term-fg36">@@ -373,13 +373,13 @@</span>     &#47;&#47; merge all transitions into bundle state, this would apply the withdrawal balance changes
     &#47;&#47; and 4788 contract call
     state.merge_transitions(BundleRetention::PlainState);
&nbsp;
<span class="term-fg31">-    let outcome: ExecutionOutcome = ExecutionOutcome::new(</span>
<span class="term-fg31">-        state.take_bundle(),</span>
<span class="term-fg31">-        Receipts::from(vec![receipts]),</span>
<span class="term-fg32">+    let outcome = ExecutionOutcome::new(</span>
<span class="term-fg32">+        state.finalize(),</span>
<span class="term-fg32">+        Receipts::&lt;Receipt&gt;::from(vec![receipts]),</span>
         reorg_target.number,
         Default::default(),
     );
<span class="term-fg31">-    let hashed_state = HashedPostState::from_bundle_state(&amp;outcome.state().state);</span>
<span class="term-fg32">+    let hashed_state = state_provider.hashed_post_state(outcome.state());</span>
&nbsp;
     let (blob_gas_used, excess_blob_gas) =
         if chain_spec.is_cancun_active_at_timestamp(reorg_target.timestamp) {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7d7cee83cdf5ea9ef1e663ab" role="button"
                       aria-expanded="false" aria-controls="id-7d7cee83cdf5ea9ef1e663ab">
                        <code>crates/evm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/evm/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/evm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7d7cee83cdf5ea9ef1e663ab"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;Cargo.toml scroll-reth&#47;crates&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">index 9d6a616af983b45cbe24f43c186c145f8d3d73d7..155e54fa90d7c8f6d67592c065e10a5d6da93cde 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -24,8 +24,11 @@</span> reth-prune-types.workspace = true
 reth-revm.workspace = true
 reth-storage-errors.workspace = true
&nbsp;
<span class="term-fg32">+revm-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
 revm.workspace = true
<span class="term-fg31">-revm-primitives.workspace = true</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
&nbsp;
 # alloy
 alloy-primitives.workspace = true
<span class="term-fg36">@@ -66,5 +69,14 @@</span>     &quot;reth-primitives&#47;test-utils&quot;,
     &quot;reth-primitives-traits&#47;test-utils&quot;,
     &quot;reth-revm&#47;test-utils&quot;,
     &quot;revm&#47;test-utils&quot;,
<span class="term-fg31">-    &quot;reth-prune-types&#47;test-utils&quot;</span>
<span class="term-fg32">+    &quot;reth-prune-types&#47;test-utils&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-execution&#47;test-utils&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-execution&#47;scroll&quot;</span>
 ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ec111fc2db1d6b570b550890" role="button"
                       aria-expanded="false" aria-controls="id-ec111fc2db1d6b570b550890">
                        <code>crates/evm/execution-types/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/evm/execution-types/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/evm/execution-types/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ec111fc2db1d6b570b550890"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;execution-types&#47;Cargo.toml scroll-reth&#47;crates&#47;evm&#47;execution-types&#47;Cargo.toml</span>
<span class="term-fg1">index c7fbad673db1530d7d5c1a5db7bb7b3394fbc34c..9b5841f0d682fe0e7ec36ccf94ab6800820aed3c 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;execution-types&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;execution-types&#47;Cargo.toml</span>
<span class="term-fg36">@@ -65,3 +65,7 @@</span> 	&quot;serde?&#47;std&quot;,
 	&quot;reth-primitives-traits&#47;std&quot;,
     &quot;alloy-consensus&#47;std&quot;,
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-017a6b9a2f02fd360b4ba5bf" role="button"
                       aria-expanded="false" aria-controls="id-017a6b9a2f02fd360b4ba5bf">
                        <code>crates/evm/execution-types/src/chain.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/evm/execution-types/src/chain.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/evm/execution-types/src/chain.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-017a6b9a2f02fd360b4ba5bf"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;chain.rs scroll-reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;chain.rs</span>
<span class="term-fg1">index 1767a7f43f6547e7b357854085189b82d4984151..143f8c31284776e308a6c6b71bf39a5a675db7a8 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;chain.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;chain.rs</span>
<span class="term-fg36">@@ -824,6 +824,8 @@</span>             tx_type: TxType::Legacy,
             cumulative_gas_used: 46913,
             logs: vec![],
             success: true,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            l1_fee: alloy_primitives::U256::ZERO,</span>
         };
&nbsp;
         &#47;&#47; Create another random receipt object, receipt2
<span class="term-fg36">@@ -832,6 +834,8 @@</span>             tx_type: TxType::Legacy,
             cumulative_gas_used: 1325345,
             logs: vec![],
             success: true,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            l1_fee: alloy_primitives::U256::ZERO,</span>
         };
&nbsp;
         &#47;&#47; Create a Receipts object with a vector of receipt vectors</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-81cabcae1717fa9a08c9ef9e" role="button"
                       aria-expanded="false" aria-controls="id-81cabcae1717fa9a08c9ef9e">
                        <code>crates/evm/execution-types/src/execution_outcome.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/evm/execution-types/src/execution_outcome.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/evm/execution-types/src/execution_outcome.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+41</span></div>
                            <div class="text-start"><span class="text-danger">-7</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-81cabcae1717fa9a08c9ef9e"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;execution_outcome.rs scroll-reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;execution_outcome.rs</span>
<span class="term-fg1">index 412269ace9cd47214526a8ad5cdebb11d045318e..6c8240d2d5cfc89d5ba6f6fc4f69bdc075f8466f 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;execution_outcome.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;execution_outcome.rs</span>
<span class="term-fg36">@@ -4,7 +4,7 @@</span> use alloy_eips::eip7685::Requests;
 use alloy_primitives::{Address, BlockNumber, Bloom, Log, B256, U256};
 use reth_primitives::{logs_bloom, Account, Bytecode, Receipts, StorageEntry};
 use reth_primitives_traits::{receipt::ReceiptExt, Receipt};
<span class="term-fg31">-use reth_trie::HashedPostState;</span>
<span class="term-fg32">+use reth_trie::{HashedPostState, KeyHasher};</span>
 use revm::{
     db::{states::BundleState, BundleAccount},
     primitives::AccountInfo,
<span class="term-fg36">@@ -166,8 +166,8 @@</span>     }
&nbsp;
     &#47;&#47;&#47; Returns [`HashedPostState`] for this execution outcome.
     &#47;&#47;&#47; See [`HashedPostState::from_bundle_state`] for more info.
<span class="term-fg31">-    pub fn hash_state_slow(&amp;self) -&gt; HashedPostState {</span>
<span class="term-fg31">-        HashedPostState::from_bundle_state(&amp;self.bundle.state)</span>
<span class="term-fg32">+    pub fn hash_state_slow&lt;KH: KeyHasher&gt;(&amp;self) -&gt; HashedPostState {</span>
<span class="term-fg32">+        HashedPostState::from_bundle_state::&lt;KH&gt;(&amp;self.bundle.state)</span>
     }
&nbsp;
     &#47;&#47;&#47; Transform block number to the index of block.
<span class="term-fg36">@@ -398,6 +398,8 @@</span>                 tx_type: TxType::Legacy,
                 cumulative_gas_used: 46913,
                 logs: vec![],
                 success: true,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             })]],
         };
&nbsp;
<span class="term-fg36">@@ -460,6 +462,8 @@</span>                 tx_type: TxType::Legacy,
                 cumulative_gas_used: 46913,
                 logs: vec![],
                 success: true,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             })]],
         };
&nbsp;
<span class="term-fg36">@@ -495,6 +499,8 @@</span>                 tx_type: TxType::Legacy,
                 cumulative_gas_used: 46913,
                 logs: vec![Log::&lt;LogData&gt;::default()],
                 success: true,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             })]],
         };
&nbsp;
<span class="term-fg36">@@ -527,6 +533,8 @@</span>                 tx_type: TxType::Legacy,
                 cumulative_gas_used: 46913,
                 logs: vec![Log::&lt;LogData&gt;::default()],
                 success: true,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             })]],
         };
&nbsp;
<span class="term-fg36">@@ -553,6 +561,8 @@</span>                 tx_type: TxType::Legacy,
                 cumulative_gas_used: 46913,
                 logs: vec![Log::&lt;LogData&gt;::default()],
                 success: true,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             })]
         );
     }
<span class="term-fg36">@@ -567,6 +577,8 @@</span>                 tx_type: TxType::Legacy,
                 cumulative_gas_used: 46913,
                 logs: vec![Log::&lt;LogData&gt;::default()],
                 success: true,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             })]],
         };
&nbsp;
<span class="term-fg36">@@ -615,6 +627,8 @@</span>             tx_type: TxType::Legacy,
             cumulative_gas_used: 46913,
             logs: vec![],
             success: true,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            l1_fee: U256::ZERO,</span>
         };
&nbsp;
         &#47;&#47; Create a Receipts object with a vector of receipt vectors
<span class="term-fg36">@@ -664,6 +678,8 @@</span>             tx_type: TxType::Legacy,
             cumulative_gas_used: 46913,
             logs: vec![],
             success: true,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            l1_fee: U256::ZERO,</span>
         };
&nbsp;
         &#47;&#47; Create a Receipts object containing the receipt.
<span class="term-fg36">@@ -708,6 +724,8 @@</span>             tx_type: TxType::Legacy,
             cumulative_gas_used: 46913,
             logs: vec![],
             success: true,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            l1_fee: U256::ZERO,</span>
         };
&nbsp;
         &#47;&#47; Create a Receipts object with a vector of receipt vectors
<span class="term-fg36">@@ -774,10 +792,26 @@</span>         let address2 = Address::random();
         let address3 = Address::random();
&nbsp;
         &#47;&#47; Set up account info with some changes
<span class="term-fg31">-        let account_info1 =</span>
<span class="term-fg31">-            AccountInfo { nonce: 1, balance: U256::from(100), code_hash: B256::ZERO, code: None };</span>
<span class="term-fg31">-        let account_info2 =</span>
<span class="term-fg31">-            AccountInfo { nonce: 2, balance: U256::from(200), code_hash: B256::ZERO, code: None };</span>
<span class="term-fg32">+        let account_info1 = AccountInfo {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(100),</span>
<span class="term-fg32">+            code_hash: B256::ZERO,</span>
<span class="term-fg32">+            code: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: 0,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: B256::ZERO,</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let account_info2 = AccountInfo {</span>
<span class="term-fg32">+            nonce: 2,</span>
<span class="term-fg32">+            balance: U256::from(200),</span>
<span class="term-fg32">+            code_hash: B256::ZERO,</span>
<span class="term-fg32">+            code: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: 0,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: B256::ZERO,</span>
<span class="term-fg32">+        };</span>
&nbsp;
         &#47;&#47; Set up the bundle state with these accounts
         let mut bundle_state = BundleState::default();</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-77093fb17d4ceab7cb8476e7" role="button"
                       aria-expanded="false" aria-controls="id-77093fb17d4ceab7cb8476e7">
                        <code>crates/evm/src/either.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/evm/src/either.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/evm/src/either.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-77093fb17d4ceab7cb8476e7"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;src&#47;either.rs scroll-reth&#47;crates&#47;evm&#47;src&#47;either.rs</span>
<span class="term-fg1">index 85bc7e7f9a79fa2790c39445a2c1a3c821edf705..167a89dc42d4f317b53822de8cd487c15658f273 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;src&#47;either.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;src&#47;either.rs</span>
<span class="term-fg36">@@ -12,27 +12,33 @@</span> use reth_execution_errors::BlockExecutionError;
 use reth_execution_types::{BlockExecutionInput, BlockExecutionOutput, ExecutionOutcome};
 use reth_primitives::{BlockWithSenders, Receipt};
 use reth_prune_types::PruneModes;
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use reth_storage_errors::provider::ProviderError;
<span class="term-fg32">+use revm::{db::BundleState, State};</span>
 use revm_primitives::db::Database;
&nbsp;
 &#47;&#47; re-export Either
 pub use futures_util::future::Either;
<span class="term-fg31">-use revm::State;</span>
&nbsp;
 impl&lt;A, B&gt; BlockExecutorProvider for Either&lt;A, B&gt;
 where
     A: BlockExecutorProvider,
     B: BlockExecutorProvider,
 {
<span class="term-fg31">-    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        Either&lt;A::Executor&lt;DB&gt;, B::Executor&lt;DB&gt;&gt;;</span>
<span class="term-fg32">+    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Either&lt;A::Executor&lt;DB&gt;, B::Executor&lt;DB&gt;&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
<span class="term-fg31">-    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        Either&lt;A::BatchExecutor&lt;DB&gt;, B::BatchExecutor&lt;DB&gt;&gt;;</span>
<span class="term-fg32">+    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Either&lt;A::BatchExecutor&lt;DB&gt;, B::BatchExecutor&lt;DB&gt;&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Executor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         match self {
             Self::Left(a) =&gt; Either::Left(a.executor(db)),
<span class="term-fg36">@@ -43,6 +49,7 @@</span>
     fn batch_executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         match self {
             Self::Left(a) =&gt; Either::Left(a.batch_executor(db)),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5db983e2d2cc4bce1b31489d" role="button"
                       aria-expanded="false" aria-controls="id-5db983e2d2cc4bce1b31489d">
                        <code>crates/evm/src/execute.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/evm/src/execute.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/evm/src/execute.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+51</span></div>
                            <div class="text-start"><span class="text-danger">-16</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5db983e2d2cc4bce1b31489d"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;src&#47;execute.rs scroll-reth&#47;crates&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">index 42c756f4d93f9dae6f6ee62fce8a18cc9982d28e..1e157b83bf1c2c500053eecf0d094fc539005b41 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg36">@@ -16,6 +16,7 @@</span> use reth_consensus::ConsensusError;
 use reth_primitives::{BlockWithSenders, Receipt};
 use reth_prune_types::PruneModes;
 use reth_revm::batch::BlockBatchRecord;
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use revm::{
     db::{states::bundle_state::BundleRetention, BundleState},
     State,
<span class="term-fg36">@@ -146,7 +147,9 @@</span>         DB,
         Input&lt;&#39;a&gt; = BlockExecutionInput&lt;&#39;a, BlockWithSenders&gt;,
         Output = BlockExecutionOutput&lt;Receipt&gt;,
         Error = BlockExecutionError,
<span class="term-fg31">-    &gt;;</span>
<span class="term-fg32">+    &gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     &#47;&#47;&#47; An executor that can execute a batch of blocks given a database.
     type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;: for&lt;&#39;a&gt; BatchExecutor&lt;
<span class="term-fg36">@@ -154,14 +157,17 @@</span>         DB,
         Input&lt;&#39;a&gt; = BlockExecutionInput&lt;&#39;a, BlockWithSenders&gt;,
         Output = ExecutionOutcome,
         Error = BlockExecutionError,
<span class="term-fg31">-    &gt;;</span>
<span class="term-fg32">+    &gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     &#47;&#47;&#47; Creates a new executor for single block execution.
     &#47;&#47;&#47;
     &#47;&#47;&#47; This is used to execute a single block and get the changed state.
     fn executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Executor&lt;DB&gt;
     where
<span class="term-fg31">-        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;;</span>
<span class="term-fg32">+        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     &#47;&#47;&#47; Creates a new batch executor with the given database and pruning modes.
     &#47;&#47;&#47;
<span class="term-fg36">@@ -169,7 +175,8 @@</span>     &#47;&#47;&#47; Batch executor is used to execute multiple blocks in sequence and keep track of the state
     &#47;&#47;&#47; during historical sync which involves executing multiple blocks in sequence.
     fn batch_executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
     where
<span class="term-fg31">-        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;;</span>
<span class="term-fg32">+        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
 }
&nbsp;
 &#47;&#47;&#47; Helper type for the output of executing a block.
<span class="term-fg36">@@ -185,6 +192,7 @@</span> &#47;&#47;&#47; Defines the strategy for executing a single block.
 pub trait BlockExecutionStrategy&lt;DB&gt;
 where
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; The error type returned by this strategy&#39;s methods.
     type Error: From&lt;ProviderError&gt; + core::error::Error;
<span class="term-fg36">@@ -226,7 +234,7 @@</span>
     &#47;&#47;&#47; Returns the final bundle state.
     fn finish(&amp;mut self) -&gt; BundleState {
         self.state_mut().merge_transitions(BundleRetention::Reverts);
<span class="term-fg31">-        self.state_mut().take_bundle()</span>
<span class="term-fg32">+        self.state_mut().finalize()</span>
     }
&nbsp;
     &#47;&#47;&#47; Validate a block with regard to execution results.
<span class="term-fg36">@@ -246,12 +254,15 @@</span>     &#47;&#47;&#47; Associated strategy type.
     type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;: BlockExecutionStrategy&lt;
         DB,
         Error = BlockExecutionError,
<span class="term-fg31">-    &gt;;</span>
<span class="term-fg32">+    &gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     &#47;&#47;&#47; Creates a strategy using the give database.
     fn create_strategy&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Strategy&lt;DB&gt;
     where
<span class="term-fg31">-        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;;</span>
<span class="term-fg32">+        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
 }
&nbsp;
 impl&lt;F&gt; Clone for BasicBlockExecutorProvider&lt;F&gt;
<span class="term-fg36">@@ -280,15 +291,20 @@</span> impl&lt;F&gt; BlockExecutorProvider for BasicBlockExecutorProvider&lt;F&gt;
 where
     F: BlockExecutionStrategyFactory,
 {
<span class="term-fg31">-    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        BasicBlockExecutor&lt;F::Strategy&lt;DB&gt;, DB&gt;;</span>
<span class="term-fg32">+    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = BasicBlockExecutor&lt;F::Strategy&lt;DB&gt;, DB&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
<span class="term-fg31">-    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        BasicBatchExecutor&lt;F::Strategy&lt;DB&gt;, DB&gt;;</span>
<span class="term-fg32">+    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = BasicBatchExecutor&lt;F::Strategy&lt;DB&gt;, DB&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Executor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         let strategy = self.strategy_factory.create_strategy(db);
         BasicBlockExecutor::new(strategy)
<span class="term-fg36">@@ -297,6 +313,7 @@</span>
     fn batch_executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         let strategy = self.strategy_factory.create_strategy(db);
         let batch_record = BlockBatchRecord::default();
<span class="term-fg36">@@ -311,6 +328,7 @@</span> pub struct BasicBlockExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Block execution strategy.
     pub(crate) strategy: S,
<span class="term-fg36">@@ -321,6 +339,7 @@</span> impl&lt;S, DB&gt; BasicBlockExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Creates a new `BasicBlockExecutor` with the given strategy.
     pub const fn new(strategy: S) -&gt; Self {
<span class="term-fg36">@@ -332,6 +351,7 @@</span> impl&lt;S, DB&gt; Executor&lt;DB&gt; for BasicBlockExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     type Input&lt;&#39;a&gt; = BlockExecutionInput&lt;&#39;a, BlockWithSenders&gt;;
     type Output = BlockExecutionOutput&lt;Receipt&gt;;
<span class="term-fg36">@@ -408,6 +428,7 @@</span> pub struct BasicBatchExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Batch execution strategy.
     pub(crate) strategy: S,
<span class="term-fg36">@@ -420,6 +441,7 @@</span> impl&lt;S, DB&gt; BasicBatchExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Creates a new `BasicBatchExecutor` with the given strategy.
     pub const fn new(strategy: S, batch_record: BlockBatchRecord) -&gt; Self {
<span class="term-fg36">@@ -431,6 +453,7 @@</span> impl&lt;S, DB&gt; BatchExecutor&lt;DB&gt; for BasicBatchExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB, Error = BlockExecutionError&gt;,
     DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     type Input&lt;&#39;a&gt; = BlockExecutionInput&lt;&#39;a, BlockWithSenders&gt;;
     type Output = ExecutionOutcome;
<span class="term-fg36">@@ -466,7 +489,7 @@</span>     }
&nbsp;
     fn finalize(mut self) -&gt; Self::Output {
         ExecutionOutcome::new(
<span class="term-fg31">-            self.strategy.state_mut().take_bundle(),</span>
<span class="term-fg32">+            self.strategy.state_mut().finalize(),</span>
             self.batch_record.take_receipts(),
             self.batch_record.first_block().unwrap_or_default(),
             self.batch_record.take_requests(),
<span class="term-fg36">@@ -499,12 +522,19 @@</span>     #[derive(Clone, Default)]
     struct TestExecutorProvider;
&nbsp;
     impl BlockExecutorProvider for TestExecutorProvider {
<span class="term-fg31">-        type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = TestExecutor&lt;DB&gt;;</span>
<span class="term-fg31">-        type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = TestExecutor&lt;DB&gt;;</span>
<span class="term-fg32">+        type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+            = TestExecutor&lt;DB&gt;</span>
<span class="term-fg32">+        where</span>
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
<span class="term-fg32">+        type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+            = TestExecutor&lt;DB&gt;</span>
<span class="term-fg32">+        where</span>
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
         fn executor&lt;DB&gt;(&amp;self, _db: DB) -&gt; Self::Executor&lt;DB&gt;
         where
             DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
         {
             TestExecutor(PhantomData)
         }
<span class="term-fg36">@@ -512,6 +542,7 @@</span>
         fn batch_executor&lt;DB&gt;(&amp;self, _db: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
         where
             DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
         {
             TestExecutor(PhantomData)
         }
<span class="term-fg36">@@ -596,12 +627,15 @@</span>         finish_result: BundleState,
     }
&nbsp;
     impl BlockExecutionStrategyFactory for TestExecutorStrategyFactory {
<span class="term-fg31">-        type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-            TestExecutorStrategy&lt;DB, TestEvmConfig&gt;;</span>
<span class="term-fg32">+        type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+            = TestExecutorStrategy&lt;DB, TestEvmConfig&gt;</span>
<span class="term-fg32">+        where</span>
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
         fn create_strategy&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Strategy&lt;DB&gt;
         where
             DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
         {
             let state = State::builder()
                 .with_database(db)
<span class="term-fg36">@@ -625,6 +659,7 @@</span>
     impl&lt;DB&gt; BlockExecutionStrategy&lt;DB&gt; for TestExecutorStrategy&lt;DB, TestEvmConfig&gt;
     where
         DB: Database,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         type Error = BlockExecutionError;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b74560f9ab8d4abb23971211" role="button"
                       aria-expanded="false" aria-controls="id-b74560f9ab8d4abb23971211">
                        <code>crates/evm/src/noop.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/evm/src/noop.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/evm/src/noop.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b74560f9ab8d4abb23971211"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;src&#47;noop.rs scroll-reth&#47;crates&#47;evm&#47;src&#47;noop.rs</span>
<span class="term-fg1">index 4fdc6d367a2771a7c2b7f8adab1cc1dc1ad6fb8c..c0ad60b7fc2b9bcd9e52338d7486086147b8c754 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;src&#47;noop.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;src&#47;noop.rs</span>
<span class="term-fg36">@@ -6,8 +6,9 @@</span> use reth_execution_errors::BlockExecutionError;
 use reth_execution_types::{BlockExecutionInput, BlockExecutionOutput, ExecutionOutcome};
 use reth_primitives::{BlockWithSenders, Receipt};
 use reth_prune_types::PruneModes;
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use reth_storage_errors::provider::ProviderError;
<span class="term-fg31">-use revm::State;</span>
<span class="term-fg32">+use revm::{db::BundleState, State};</span>
 use revm_primitives::db::Database;
&nbsp;
 use crate::{
<span class="term-fg36">@@ -23,13 +24,20 @@</span> #[non_exhaustive]
 pub struct NoopBlockExecutorProvider;
&nbsp;
 impl BlockExecutorProvider for NoopBlockExecutorProvider {
<span class="term-fg31">-    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = Self;</span>
<span class="term-fg32">+    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
<span class="term-fg31">-    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = Self;</span>
<span class="term-fg32">+    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn executor&lt;DB&gt;(&amp;self, _: DB) -&gt; Self::Executor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         Self
     }
<span class="term-fg36">@@ -37,6 +45,7 @@</span>
     fn batch_executor&lt;DB&gt;(&amp;self, _: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         Self
     }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ff0077b24546aa8ebcce8ae8" role="button"
                       aria-expanded="false" aria-controls="id-ff0077b24546aa8ebcce8ae8">
                        <code>crates/evm/src/test_utils.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/evm/src/test_utils.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/evm/src/test_utils.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ff0077b24546aa8ebcce8ae8"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;src&#47;test_utils.rs scroll-reth&#47;crates&#47;evm&#47;src&#47;test_utils.rs</span>
<span class="term-fg1">index a4dc906494ce1f13499495c4e8b4b74a95fae11f..b3f338fa856e7f074f68837fe0308fce961d6353 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;src&#47;test_utils.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;src&#47;test_utils.rs</span>
<span class="term-fg36">@@ -14,8 +14,9 @@</span> use reth_execution_errors::BlockExecutionError;
 use reth_execution_types::ExecutionOutcome;
 use reth_primitives::{BlockWithSenders, Receipt, Receipts};
 use reth_prune_types::PruneModes;
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use reth_storage_errors::provider::ProviderError;
<span class="term-fg31">-use revm::State;</span>
<span class="term-fg32">+use revm::{db::BundleState, State};</span>
 use revm_primitives::db::Database;
 use std::{fmt::Display, sync::Arc};
&nbsp;
<span class="term-fg36">@@ -33,13 +34,20 @@</span>     }
 }
&nbsp;
 impl BlockExecutorProvider for MockExecutorProvider {
<span class="term-fg31">-    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = Self;</span>
<span class="term-fg32">+    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
<span class="term-fg31">-    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = Self;</span>
<span class="term-fg32">+    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn executor&lt;DB&gt;(&amp;self, _: DB) -&gt; Self::Executor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         self.clone()
     }
<span class="term-fg36">@@ -47,6 +55,7 @@</span>
     fn batch_executor&lt;DB&gt;(&amp;self, _: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         self.clone()
     }
<span class="term-fg36">@@ -120,6 +129,7 @@</span> impl&lt;S, DB&gt; BasicBlockExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Provides safe read access to the state
     pub fn with_state&lt;F, R&gt;(&amp;self, f: F) -&gt; R
<span class="term-fg36">@@ -142,6 +152,7 @@</span> impl&lt;S, DB&gt; BasicBatchExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Provides safe read access to the state
     pub fn with_state&lt;F, R&gt;(&amp;self, f: F) -&gt; R</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9c46335e41f67421ca58411e" role="button"
                       aria-expanded="false" aria-controls="id-9c46335e41f67421ca58411e">
                        <code>crates/exex/exex/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/exex/exex/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/exex/exex/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+17</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9c46335e41f67421ca58411e"><span class="term-fg1">diff --git reth&#47;crates&#47;exex&#47;exex&#47;Cargo.toml scroll-reth&#47;crates&#47;exex&#47;exex&#47;Cargo.toml</span>
<span class="term-fg1">index b70fb921599efb66fb1858760c88678598d5cc1e..705f216c12aacbc2ef5b81468a22f1c0fd880a70 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;exex&#47;exex&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;exex&#47;exex&#47;Cargo.toml</span>
<span class="term-fg36">@@ -34,6 +34,9 @@</span> reth-stages-api.workspace = true
 reth-tasks.workspace = true
 reth-tracing.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # alloy
 alloy-consensus.workspace = true
 alloy-primitives.workspace = true
<span class="term-fg36">@@ -82,3 +85,17 @@</span> 	&quot;rand&#47;serde&quot;,
 	&quot;secp256k1&#47;serde&quot;,
 	&quot;reth-primitives-traits&#47;serde&quot;,
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-node-core&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-evm-ethereum&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-testing-utils&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-node-api&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-blockchain-tree&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-db-common&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-storage&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-69d2cdabcff3c467f64b74bb" role="button"
                       aria-expanded="false" aria-controls="id-69d2cdabcff3c467f64b74bb">
                        <code>crates/exex/exex/src/backfill/job.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/exex/exex/src/backfill/job.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/exex/exex/src/backfill/job.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-69d2cdabcff3c467f64b74bb"><span class="term-fg1">diff --git reth&#47;crates&#47;exex&#47;exex&#47;src&#47;backfill&#47;job.rs scroll-reth&#47;crates&#47;exex&#47;exex&#47;src&#47;backfill&#47;job.rs</span>
<span class="term-fg1">index 7e670620472c3f1842089904e36acfad56e7e100..554336e2dfb21206a220c0aaa03c175c0995ee2a 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;exex&#47;exex&#47;src&#47;backfill&#47;job.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;exex&#47;exex&#47;src&#47;backfill&#47;job.rs</span>
<span class="term-fg36">@@ -78,9 +78,15 @@</span>             range = ?self.range,
             &quot;Executing block range&quot;
         );
&nbsp;
<span class="term-fg31">-        let mut executor = self.executor.batch_executor(StateProviderDatabase::new(</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let db = StateProviderDatabase::new(</span>
             self.provider.history_by_block_number(self.range.start().saturating_sub(1))?,
<span class="term-fg31">-        ));</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let db = reth_scroll_storage::ScrollStateProviderDatabase::new(</span>
<span class="term-fg32">+            self.provider.history_by_block_number(self.range.start().saturating_sub(1))?,</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+        let mut executor = self.executor.batch_executor(db);</span>
         executor.set_prune_modes(self.prune_modes.clone());
&nbsp;
         let mut fetch_block_duration = Duration::default();</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-92f0e20f981e5f10717dbfcf" role="button"
                       aria-expanded="false" aria-controls="id-92f0e20f981e5f10717dbfcf">
                        <code>crates/exex/test-utils/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/exex/test-utils/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/exex/test-utils/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-92f0e20f981e5f10717dbfcf"><span class="term-fg1">diff --git reth&#47;crates&#47;exex&#47;test-utils&#47;Cargo.toml scroll-reth&#47;crates&#47;exex&#47;test-utils&#47;Cargo.toml</span>
<span class="term-fg1">index 6e5af981b31742fb8f31d2bed052e5441cb33dff..56701b7ebb272da1ddf94b7e7f0bf6ebd14bee46 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;exex&#47;test-utils&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;exex&#47;test-utils&#47;Cargo.toml</span>
<span class="term-fg36">@@ -45,3 +45,6 @@</span> eyre.workspace = true
 rand.workspace = true
 tempfile.workspace = true
 thiserror.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ffd113c9d8b4ad01d937e280" role="button"
                       aria-expanded="false" aria-controls="id-ffd113c9d8b4ad01d937e280">
                        <code>crates/exex/test-utils/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/exex/test-utils/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/exex/test-utils/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ffd113c9d8b4ad01d937e280"><span class="term-fg1">diff --git reth&#47;crates&#47;exex&#47;test-utils&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;exex&#47;test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg1">index ca0ea46551c5fa60cb6b87da62a5cad43dd84af9..ddd363712e04f03915fd978cb2edce5976294e68 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;exex&#47;test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;exex&#47;test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -7,6 +7,9 @@</span>     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use std::{
     fmt::Debug,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1ef2827e6757e183022dd1ef" role="button"
                       aria-expanded="false" aria-controls="id-1ef2827e6757e183022dd1ef">
                        <code>crates/net/eth-wire/src/capability.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/net/eth-wire/src/capability.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/net/eth-wire/src/capability.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1ef2827e6757e183022dd1ef"><span class="term-fg1">diff --git reth&#47;crates&#47;net&#47;eth-wire&#47;src&#47;capability.rs scroll-reth&#47;crates&#47;net&#47;eth-wire&#47;src&#47;capability.rs</span>
<span class="term-fg1">index 625971e0e7bd9b3c6a847beded0a5551852cc277..8d969eac889b47fde2173ad5227fcd00b82ae8a5 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;net&#47;eth-wire&#47;src&#47;capability.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;net&#47;eth-wire&#47;src&#47;capability.rs</span>
<span class="term-fg36">@@ -319,7 +319,7 @@</span>             &#47;&#47; If multiple versions are shared of the same (equal name) capability, the numerically
             &#47;&#47; highest wins, others are ignored
             if shared_capabilities
                 .get(&amp;peer_capability.name)
<span class="term-fg31">-                .map_or(true, |v| peer_capability.version &gt; v.version)</span>
<span class="term-fg32">+                .is_none_or(|v| peer_capability.version &gt; v.version)</span>
             {
                 shared_capabilities.insert(
                     peer_capability.name.clone(),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0de0cf6d39dd7719b92f4eaa" role="button"
                       aria-expanded="false" aria-controls="id-0de0cf6d39dd7719b92f4eaa">
                        <code>crates/node/api/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/node/api/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/node/api/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0de0cf6d39dd7719b92f4eaa"><span class="term-fg1">diff --git reth&#47;crates&#47;node&#47;api&#47;Cargo.toml scroll-reth&#47;crates&#47;node&#47;api&#47;Cargo.toml</span>
<span class="term-fg1">index ab4595d336243020ea928237736898f23e54e0c6..8279a83252295f608eec61c568cf80afe9a102c6 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;node&#47;api&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;node&#47;api&#47;Cargo.toml</span>
<span class="term-fg36">@@ -29,3 +29,11 @@</span> alloy-rpc-types-engine.workspace = true
 alloy-consensus.workspace = true
&nbsp;
 eyre.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-node-core&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-engine-primitives&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5149925eb467651d723c7203" role="button"
                       aria-expanded="false" aria-controls="id-5149925eb467651d723c7203">
                        <code>crates/node/core/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/node/core/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/node/core/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5149925eb467651d723c7203"><span class="term-fg1">diff --git reth&#47;crates&#47;node&#47;core&#47;Cargo.toml scroll-reth&#47;crates&#47;node&#47;core&#47;Cargo.toml</span>
<span class="term-fg1">index c667a56293c15c7de6b1a5a1394856a8f433b22e..b24430982025d1954b30a1b65f1370a1dca9e53b 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;node&#47;core&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;node&#47;core&#47;Cargo.toml</span>
<span class="term-fg36">@@ -80,6 +80,11 @@</span> optimism = [&quot;reth-primitives&#47;optimism&quot;, &quot;reth-db&#47;optimism&quot;]
 # Features for vergen to generate correct env vars
 jemalloc = [&quot;reth-cli-util&#47;jemalloc&quot;]
 asm-keccak = [&quot;reth-primitives&#47;asm-keccak&quot;, &quot;alloy-primitives&#47;asm-keccak&quot;]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-rpc-eth-types&#47;scroll&quot;,</span>
<span class="term-fg32">+]</span>
&nbsp;
 [build-dependencies]
 vergen = { version = &quot;8.0.0&quot;, features = [&quot;build&quot;, &quot;cargo&quot;, &quot;git&quot;, &quot;gitcl&quot;] }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7b46d8f255d34f6f478e0261" role="button"
                       aria-expanded="false" aria-controls="id-7b46d8f255d34f6f478e0261">
                        <code>crates/payload/basic/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/payload/basic/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/payload/basic/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7b46d8f255d34f6f478e0261"><span class="term-fg1">diff --git reth&#47;crates&#47;payload&#47;basic&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;payload&#47;basic&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 0ab411d3e600a08b3b71bacfaa5d5c2b6760dd58..c5a39d3a989d0ed6314916468e50431d84510e18 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;payload&#47;basic&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;payload&#47;basic&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -204,7 +204,12 @@</span>                 &#47;&#47; we want pre cache existing accounts and their storage
                 &#47;&#47; this only includes changed accounts and storage but is better than nothing
                 let storage =
                     acc.storage.iter().map(|(key, slot)| (*key, slot.present_value)).collect();
<span class="term-fg31">-                cached.insert_account(addr, info, storage);</span>
<span class="term-fg32">+                cached.insert_account(</span>
<span class="term-fg32">+                    addr,</span>
<span class="term-fg32">+                    #[allow(clippy::useless_conversion)]</span>
<span class="term-fg32">+                    info.into(),</span>
<span class="term-fg32">+                    storage,</span>
<span class="term-fg32">+                );</span>
             }
         }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f69217721cf1f045f8db1f62" role="button"
                       aria-expanded="false" aria-controls="id-f69217721cf1f045f8db1f62">
                        <code>crates/revm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/revm/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/revm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+9</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f69217721cf1f045f8db1f62"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;Cargo.toml scroll-reth&#47;crates&#47;revm&#47;Cargo.toml</span>
<span class="term-fg1">index 95def23a44324287d5c1aee035cfc003d31e036a..7f636474986cdbc44fff1be595b1b314d82ebd10 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -21,6 +21,9 @@</span> reth-storage-api.workspace = true
 reth-trie = { workspace = true, optional = true }
 reth-primitives-traits.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # alloy
 alloy-eips.workspace = true
 alloy-primitives.workspace = true
<span class="term-fg36">@@ -60,4 +63,10 @@</span>     &quot;alloy-primitives&#47;serde&quot;,
     &quot;alloy-consensus&#47;serde&quot;,
     &quot;reth-primitives-traits&#47;serde&quot;,
     &quot;reth-trie?&#47;serde&quot;,
<span class="term-fg32">+    &quot;reth-scroll-primitives?&#47;serde&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;</span>
 ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-50869bb4943d2b0b04b29dec" role="button"
                       aria-expanded="false" aria-controls="id-50869bb4943d2b0b04b29dec">
                        <code>crates/revm/src/batch.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/revm/src/batch.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/revm/src/batch.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-50869bb4943d2b0b04b29dec"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;src&#47;batch.rs scroll-reth&#47;crates&#47;revm&#47;src&#47;batch.rs</span>
<span class="term-fg1">index 15ba049250f5e736d759a8b3906494dbcb5f11da..f55c3aeee259c2a6b4b92d2d3b2038c4cc3bcd65 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;src&#47;batch.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;src&#47;batch.rs</span>
<span class="term-fg36">@@ -102,7 +102,7 @@</span>     }
&nbsp;
     &#47;&#47;&#47; Returns the [`BundleRetention`] for the given block based on the configured prune modes.
     pub fn bundle_retention(&amp;self, block_number: BlockNumber) -&gt; BundleRetention {
<span class="term-fg31">-        if self.tip.map_or(true, |tip| {</span>
<span class="term-fg32">+        if self.tip.is_none_or(|tip| {</span>
             !self
                 .prune_modes
                 .account_history</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3ab30e62a0f6b8918b7d7e69" role="button"
                       aria-expanded="false" aria-controls="id-3ab30e62a0f6b8918b7d7e69">
                        <code>crates/revm/src/cached.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/revm/src/cached.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/revm/src/cached.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3ab30e62a0f6b8918b7d7e69"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;src&#47;cached.rs scroll-reth&#47;crates&#47;revm&#47;src&#47;cached.rs</span>
<span class="term-fg1">index 5d5262adc5b3bde3a510d1fb75e8b40ea1608df5..81e44675f75fb00aac0bcd72dbc3c28d00049629 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;src&#47;cached.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;src&#47;cached.rs</span>
<span class="term-fg36">@@ -4,9 +4,12 @@</span>     map::{Entry, HashMap},
     Address, B256, U256,
 };
 use core::cell::RefCell;
<span class="term-fg31">-use revm::primitives::{</span>
<span class="term-fg31">-    db::{Database, DatabaseRef},</span>
<span class="term-fg31">-    AccountInfo, Bytecode,</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    primitives::{</span>
<span class="term-fg32">+        db::{Database, DatabaseRef},</span>
<span class="term-fg32">+        Bytecode,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    shared::AccountInfo,</span>
 };
&nbsp;
 &#47;&#47;&#47; A container type that caches reads from an underlying [`DatabaseRef`].</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0f27f9dd753545647c33bb6d" role="button"
                       aria-expanded="false" aria-controls="id-0f27f9dd753545647c33bb6d">
                        <code>crates/revm/src/database.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/revm/src/database.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/revm/src/database.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0f27f9dd753545647c33bb6d"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;src&#47;database.rs scroll-reth&#47;crates&#47;revm&#47;src&#47;database.rs</span>
<span class="term-fg1">index 682aca6cf3795201b9bcb6d6b5ae87e28a060062..9fd059194cfac1ad67e1c971c07aa46cc4ad92ea 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;src&#47;database.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;src&#47;database.rs</span>
<span class="term-fg36">@@ -3,11 +3,7 @@</span> use alloy_primitives::{Address, B256, U256};
 use core::ops::{Deref, DerefMut};
 use reth_primitives::Account;
 use reth_storage_errors::provider::{ProviderError, ProviderResult};
<span class="term-fg31">-use revm::{</span>
<span class="term-fg31">-    db::DatabaseRef,</span>
<span class="term-fg31">-    primitives::{AccountInfo, Bytecode},</span>
<span class="term-fg31">-    Database,</span>
<span class="term-fg31">-};</span>
<span class="term-fg32">+use revm::{db::DatabaseRef, primitives::Bytecode, shared::AccountInfo, Database};</span>
&nbsp;
 &#47;&#47;&#47; A helper trait responsible for providing state necessary for EVM execution.
 &#47;&#47;&#47;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a92066ca27a3e08706234564" role="button"
                       aria-expanded="false" aria-controls="id-a92066ca27a3e08706234564">
                        <code>crates/revm/src/either.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/revm/src/either.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/revm/src/either.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a92066ca27a3e08706234564"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;src&#47;either.rs scroll-reth&#47;crates&#47;revm&#47;src&#47;either.rs</span>
<span class="term-fg1">index e93ba3a8d010e5372f10bf7267657b3934ebda57..c2521bc4801a6c748aa83f5350f3d71d637ed2b2 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;src&#47;either.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;src&#47;either.rs</span>
<span class="term-fg36">@@ -1,8 +1,5 @@</span>
 use alloy_primitives::{Address, B256, U256};
<span class="term-fg31">-use revm::{</span>
<span class="term-fg31">-    primitives::{AccountInfo, Bytecode},</span>
<span class="term-fg31">-    Database,</span>
<span class="term-fg31">-};</span>
<span class="term-fg32">+use revm::{primitives::Bytecode, shared::AccountInfo, Database};</span>
&nbsp;
 &#47;&#47;&#47; An enum type that can hold either of two different [`Database`] implementations.
 &#47;&#47;&#47;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9d2196a7285e8770888f4c24" role="button"
                       aria-expanded="false" aria-controls="id-9d2196a7285e8770888f4c24">
                        <code>crates/revm/src/test_utils.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/revm/src/test_utils.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/revm/src/test_utils.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+16</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9d2196a7285e8770888f4c24"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;src&#47;test_utils.rs scroll-reth&#47;crates&#47;revm&#47;src&#47;test_utils.rs</span>
<span class="term-fg1">index 443d1d5ebcf22144462af10f3256e4d0f9cd203a..698b08b3db9d2603c389039cbcc924f8c3c007de 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;src&#47;test_utils.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;src&#47;test_utils.rs</span>
<span class="term-fg36">@@ -6,13 +6,13 @@</span>     Address, BlockNumber, Bytes, StorageKey, B256, U256,
 };
 use reth_primitives::{Account, Bytecode};
 use reth_storage_api::{
<span class="term-fg31">-    AccountReader, BlockHashReader, StateProofProvider, StateProvider, StateRootProvider,</span>
<span class="term-fg31">-    StorageRootProvider,</span>
<span class="term-fg32">+    AccountReader, BlockHashReader, HashedPostStateProvider, HashedStorageProvider,</span>
<span class="term-fg32">+    StateProofProvider, StateProvider, StateRootProvider, StorageRootProvider,</span>
 };
 use reth_storage_errors::provider::ProviderResult;
 use reth_trie::{
<span class="term-fg31">-    updates::TrieUpdates, AccountProof, HashedPostState, HashedStorage, MultiProof,</span>
<span class="term-fg31">-    StorageMultiProof, StorageProof, TrieInput,</span>
<span class="term-fg32">+    updates::TrieUpdates, AccountProof, HashedPostState, HashedStorage, KeccakKeyHasher,</span>
<span class="term-fg32">+    MultiProof, StorageMultiProof, StorageProof, TrieInput,</span>
 };
&nbsp;
 &#47;&#47;&#47; Mock state for testing
<span class="term-fg36">@@ -147,6 +147,18 @@</span>         _input: TrieInput,
         _target: HashedPostState,
     ) -&gt; ProviderResult&lt;HashMap&lt;B256, Bytes&gt;&gt; {
         unimplemented!(&quot;witness generation is not supported&quot;)
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashedPostStateProvider for StateProviderTest {</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, bundle_state: &amp;revm::db::BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+        HashedPostState::from_bundle_state::&lt;KeccakKeyHasher&gt;(bundle_state.state())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashedStorageProvider for StateProviderTest {</span>
<span class="term-fg32">+    fn hashed_storage(&amp;self, account: &amp;revm::db::BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+        HashedStorage::from_bundle_account::&lt;KeccakKeyHasher&gt;(account)</span>
     }
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fb292bf34f0ef42e9584b52d" role="button"
                       aria-expanded="false" aria-controls="id-fb292bf34f0ef42e9584b52d">
                        <code>crates/revm/src/witness.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/revm/src/witness.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/revm/src/witness.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+22</span></div>
                            <div class="text-start"><span class="text-danger">-6</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fb292bf34f0ef42e9584b52d"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;src&#47;witness.rs scroll-reth&#47;crates&#47;revm&#47;src&#47;witness.rs</span>
<span class="term-fg1">index c40c87d324b30db1163739977714088c2b06d3c9..ab1ec0f7978531a4fd1c282885244b8d1e51b1fe 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;src&#47;witness.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;src&#47;witness.rs</span>
<span class="term-fg36">@@ -22,7 +22,11 @@</span> }
&nbsp;
 impl ExecutionWitnessRecord {
     &#47;&#47;&#47; Records the state after execution.
<span class="term-fg31">-    pub fn record_executed_state&lt;DB&gt;(&amp;mut self, statedb: &amp;State&lt;DB&gt;) {</span>
<span class="term-fg32">+    pub fn record_executed_state&lt;DB&gt;(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        statedb: &amp;State&lt;DB&gt;,</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)] context: &amp;reth_scroll_primitives::ScrollPostExecutionContext,</span>
<span class="term-fg32">+    ) {</span>
         self.codes = statedb
             .cache
             .contracts
<span class="term-fg36">@@ -43,9 +47,14 @@</span>             .collect();
&nbsp;
         for (address, account) in &amp;statedb.cache.accounts {
             let hashed_address = keccak256(address);
<span class="term-fg31">-            self.hashed_state</span>
<span class="term-fg31">-                .accounts</span>
<span class="term-fg31">-                .insert(hashed_address, account.account.as_ref().map(|a| a.info.clone().into()));</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            let hashed_account = account</span>
<span class="term-fg32">+                .account</span>
<span class="term-fg32">+                .as_ref()</span>
<span class="term-fg32">+                .map(|a| Into::&lt;revm::AccountInfo&gt;::into((a.info.clone(), context)).into());</span>
<span class="term-fg32">+            #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+            let hashed_account = account.account.as_ref().map(|a| a.info.clone().into());</span>
<span class="term-fg32">+            self.hashed_state.accounts.insert(hashed_address, hashed_account);</span>
&nbsp;
             let storage = self
                 .hashed_state
<span class="term-fg36">@@ -68,9 +77,16 @@</span>         }
     }
&nbsp;
     &#47;&#47;&#47; Creates the record from the state after execution.
<span class="term-fg31">-    pub fn from_executed_state&lt;DB&gt;(state: &amp;State&lt;DB&gt;) -&gt; Self {</span>
<span class="term-fg32">+    pub fn from_executed_state&lt;DB&gt;(</span>
<span class="term-fg32">+        state: &amp;State&lt;DB&gt;,</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)] context: &amp;reth_scroll_primitives::ScrollPostExecutionContext,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
         let mut record = Self::default();
<span class="term-fg31">-        record.record_executed_state(state);</span>
<span class="term-fg32">+        record.record_executed_state(</span>
<span class="term-fg32">+            state,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            context,</span>
<span class="term-fg32">+        );</span>
         record
     }
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8504149c61801f08577cf8e2" role="button"
                       aria-expanded="false" aria-controls="id-8504149c61801f08577cf8e2">
                        <code>crates/rpc/rpc-eth-api/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/rpc/rpc-eth-api/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/rpc/rpc-eth-api/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8504149c61801f08577cf8e2"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;Cargo.toml scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;Cargo.toml</span>
<span class="term-fg1">index e4b1b28074f05052996756178d6028f66091ac33..46a6d5136e95f448b948d2721d5935a426095fbc 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;Cargo.toml</span>
<span class="term-fg36">@@ -29,7 +29,6 @@</span> reth-execution-types.workspace = true
 reth-rpc-eth-types.workspace = true
 reth-rpc-server-types.workspace = true
 reth-network-api.workspace = true
<span class="term-fg31">-reth-trie.workspace = true</span>
 reth-node-api.workspace = true
&nbsp;
 # ethereum
<span class="term-fg36">@@ -42,6 +41,10 @@</span> alloy-primitives.workspace = true
 alloy-rpc-types-eth.workspace = true
 alloy-rpc-types-mev.workspace = true
 alloy-consensus.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
&nbsp;
 # rpc
 jsonrpsee = { workspace = true, features = [&quot;server&quot;, &quot;macros&quot;] }
<span class="term-fg36">@@ -61,3 +64,12 @@</span>
 [features]
 js-tracer = [&quot;revm-inspectors&#47;js-tracer&quot;, &quot;reth-rpc-eth-types&#47;js-tracer&quot;]
 client = [&quot;jsonrpsee&#47;client&quot;, &quot;jsonrpsee&#47;async-client&quot;]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-rpc-eth-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-storage&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d1c07dcb9619a8cc298d86d7" role="button"
                       aria-expanded="false" aria-controls="id-d1c07dcb9619a8cc298d86d7">
                        <code>crates/rpc/rpc-eth-api/src/helpers/call.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/rpc/rpc-eth-api/src/helpers/call.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/rpc/rpc-eth-api/src/helpers/call.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d1c07dcb9619a8cc298d86d7"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;call.rs scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;call.rs</span>
<span class="term-fg1">index f9441f0630abe3ae63eb78569ca5e36a97135e50..d9b4b2c894c4a289fd608936015ab23f94792c90 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;call.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;call.rs</span>
<span class="term-fg36">@@ -110,6 +110,10 @@</span>             cfg.disable_eip3607 = true;
&nbsp;
             let this = self.clone();
             self.spawn_with_state_at_block(block, move |state| {
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                let mut db =</span>
<span class="term-fg32">+                    CacheDB::new(reth_scroll_storage::ScrollStateProviderDatabase::new(state));</span>
<span class="term-fg32">+                #[cfg(not(feature = &quot;scroll&quot;))]</span>
                 let mut db = CacheDB::new(StateProviderDatabase::new(state));
                 let mut blocks: Vec&lt;SimulatedBlock&lt;RpcBlock&lt;Self::NetworkTypes&gt;&gt;&gt; =
                     Vec::with_capacity(block_state_calls.len());</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2577ded198f9dd2346c483ce" role="button"
                       aria-expanded="false" aria-controls="id-2577ded198f9dd2346c483ce">
                        <code>crates/rpc/rpc-eth-api/src/helpers/pending_block.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/rpc/rpc-eth-api/src/helpers/pending_block.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/rpc/rpc-eth-api/src/helpers/pending_block.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-10</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2577ded198f9dd2346c483ce"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;pending_block.rs scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;pending_block.rs</span>
<span class="term-fg1">index e1cd8f5c3c2928b4fdbb17e421f0b69c59bc415a..7c2dede800ad2736545a99627f7b3cced186f006 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;pending_block.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;pending_block.rs</span>
<span class="term-fg36">@@ -24,18 +24,15 @@</span> use reth_provider::{
     BlockReader, BlockReaderIdExt, ChainSpecProvider, EvmEnvProvider, ProviderError,
     ProviderReceipt, ReceiptProvider, StateProviderFactory,
 };
<span class="term-fg31">-use reth_revm::{</span>
<span class="term-fg31">-    database::StateProviderDatabase,</span>
<span class="term-fg31">-    primitives::{</span>
<span class="term-fg31">-        BlockEnv, CfgEnv, CfgEnvWithHandlerCfg, EVMError, Env, ExecutionResult, InvalidTransaction,</span>
<span class="term-fg31">-        ResultAndState, SpecId,</span>
<span class="term-fg31">-    },</span>
<span class="term-fg32">+use reth_revm::primitives::{</span>
<span class="term-fg32">+    BlockEnv, CfgEnv, CfgEnvWithHandlerCfg, EVMError, Env, ExecutionResult, InvalidTransaction,</span>
<span class="term-fg32">+    ResultAndState, SpecId,</span>
 };
 use reth_rpc_eth_types::{EthApiError, PendingBlock, PendingBlockEnv, PendingBlockEnvOrigin};
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use reth_transaction_pool::{
     error::InvalidPoolTransactionError, BestTransactionsAttributes, TransactionPool,
 };
<span class="term-fg31">-use reth_trie::HashedPostState;</span>
 use revm::{db::states::bundle_state::BundleRetention, DatabaseCommit, State};
 use std::time::{Duration, Instant};
 use tokio::sync::Mutex;
<span class="term-fg36">@@ -239,7 +236,10 @@</span>         let state_provider = self
             .provider()
             .history_by_block_hash(parent_hash)
             .map_err(Self::Error::from_eth_err)?;
<span class="term-fg31">-        let state = StateProviderDatabase::new(state_provider);</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let state = reth_revm::database::StateProviderDatabase::new(state_provider);</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let state = reth_scroll_storage::ScrollStateProviderDatabase::new(state_provider);</span>
         let mut db = State::builder().with_database(state).with_bundle_update().build();
&nbsp;
         let mut cumulative_gas_used = 0;
<span class="term-fg36">@@ -419,12 +419,12 @@</span>         &#47;&#47; merge all transitions into bundle state.
         db.merge_transitions(BundleRetention::PlainState);
&nbsp;
         let execution_outcome = ExecutionOutcome::new(
<span class="term-fg31">-            db.take_bundle(),</span>
<span class="term-fg32">+            db.finalize(),</span>
             vec![receipts.clone()].into(),
             block_number,
             Vec::new(),
         );
<span class="term-fg31">-        let hashed_state = HashedPostState::from_bundle_state(&amp;execution_outcome.state().state);</span>
<span class="term-fg32">+        let hashed_state = db.database.hashed_post_state(execution_outcome.state());</span>
&nbsp;
         let receipts_root = self.receipts_root(&amp;block_env, &amp;execution_outcome, block_number);
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c614e19ea603a089d8352fb1" role="button"
                       aria-expanded="false" aria-controls="id-c614e19ea603a089d8352fb1">
                        <code>crates/rpc/rpc-eth-types/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/rpc/rpc-eth-types/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/rpc/rpc-eth-types/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c614e19ea603a089d8352fb1"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;Cargo.toml scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;Cargo.toml</span>
<span class="term-fg1">index 11bf6c6231d216160b54f0558d41e42c4810311c..056be5398cc8259a937b915a0f905b431f14603b 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;Cargo.toml</span>
<span class="term-fg36">@@ -34,9 +34,11 @@</span> alloy-primitives.workspace = true
 alloy-consensus.workspace = true
 alloy-sol-types.workspace = true
 alloy-rpc-types-eth.workspace = true
<span class="term-fg31">-revm.workspace = true</span>
 revm-inspectors.workspace = true
 revm-primitives = { workspace = true, features = [&quot;dev&quot;] }
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+revm.workspace = true</span>
&nbsp;
 # rpc
 jsonrpsee-core.workspace = true
<span class="term-fg36">@@ -65,3 +67,11 @@</span>
&nbsp;
 [features]
 js-tracer = [&quot;revm-inspectors&#47;js-tracer&quot;]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-934613a9c96aa4ccf826eafa" role="button"
                       aria-expanded="false" aria-controls="id-934613a9c96aa4ccf826eafa">
                        <code>crates/rpc/rpc-eth-types/src/cache/db.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/rpc/rpc-eth-types/src/cache/db.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/rpc/rpc-eth-types/src/cache/db.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+16</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-934613a9c96aa4ccf826eafa"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;src&#47;cache&#47;db.rs scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;src&#47;cache&#47;db.rs</span>
<span class="term-fg1">index 1fbe16a2ed9ca6e3453cc6cd8ef9b33a796ef9f3..a3d987596e612e6a2b5cf070673e91da6359c3e0 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;src&#47;cache&#47;db.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;src&#47;cache&#47;db.rs</span>
<span class="term-fg36">@@ -8,7 +8,7 @@</span>     Address, B256, U256,
 };
 use reth_errors::ProviderResult;
 use reth_revm::{database::StateProviderDatabase, db::CacheDB, DatabaseRef};
<span class="term-fg31">-use reth_storage_api::StateProvider;</span>
<span class="term-fg32">+use reth_storage_api::{HashedPostStateProvider, HashedStorageProvider, StateProvider};</span>
 use reth_trie::HashedStorage;
 use revm::Database;
&nbsp;
<span class="term-fg36">@@ -136,6 +136,21 @@</span>         start: alloy_primitives::BlockNumber,
         end: alloy_primitives::BlockNumber,
     ) -&gt; reth_errors::ProviderResult&lt;Vec&lt;B256&gt;&gt; {
         self.0.canonical_hashes_range(start, end)
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashedPostStateProvider for StateProviderTraitObjWrapper&lt;&#39;_&gt; {</span>
<span class="term-fg32">+    fn hashed_post_state(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        bundle_state: &amp;revm::db::BundleState,</span>
<span class="term-fg32">+    ) -&gt; reth_trie::HashedPostState {</span>
<span class="term-fg32">+        self.0.hashed_post_state(bundle_state)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashedStorageProvider for StateProviderTraitObjWrapper&lt;&#39;_&gt; {</span>
<span class="term-fg32">+    fn hashed_storage(&amp;self, account: &amp;revm::db::BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+        self.0.hashed_storage(account)</span>
     }
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a1a9385f140938dcff128e9f" role="button"
                       aria-expanded="false" aria-controls="id-a1a9385f140938dcff128e9f">
                        <code>crates/rpc/rpc/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/rpc/rpc/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/rpc/rpc/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a1a9385f140938dcff128e9f"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc&#47;Cargo.toml scroll-reth&#47;crates&#47;rpc&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg1">index 834b1a963bfe52c577cdedf873ddd71e8528501e..92ee311194e511e7aea691bed80b8d27b2448a23 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg36">@@ -34,7 +34,6 @@</span> reth-evm.workspace = true
 reth-rpc-eth-types.workspace = true
 reth-rpc-server-types.workspace = true
 reth-network-types.workspace = true
<span class="term-fg31">-reth-trie.workspace = true</span>
 reth-consensus.workspace = true
 reth-payload-validator.workspace = true
&nbsp;
<span class="term-fg36">@@ -64,6 +63,9 @@</span>     &quot;optional_eip3607&quot;,
     &quot;optional_no_base_fee&quot;,
 ] }
 revm-primitives = { workspace = true, features = [&quot;serde&quot;] }
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
&nbsp;
 # rpc
 jsonrpsee.workspace = true
<span class="term-fg36">@@ -103,3 +105,14 @@</span> jsonrpsee = { workspace = true, features = [&quot;client&quot;] }
&nbsp;
 [features]
 js-tracer = [&quot;revm-inspectors&#47;js-tracer&quot;, &quot;reth-rpc-eth-types&#47;js-tracer&quot;]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-rpc-eth-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-testing-utils&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm-ethereum&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-rpc-eth-api&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-storage&#47;scroll&quot;,</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-62b4869c9a664d3a11cd1fe1" role="button"
                       aria-expanded="false" aria-controls="id-62b4869c9a664d3a11cd1fe1">
                        <code>crates/rpc/rpc/src/debug.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/rpc/rpc/src/debug.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/rpc/rpc/src/debug.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-62b4869c9a664d3a11cd1fe1"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;debug.rs scroll-reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;debug.rs</span>
<span class="term-fg1">index 9fc1be93a2f2650f8c2db35823bee4eac6c0b03e..2e71419a19223121ae23a3d1487c32bcaeb1f15e 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;debug.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;debug.rs</span>
<span class="term-fg36">@@ -609,7 +609,10 @@</span>             .ok_or(EthApiError::HeaderNotFound(block_id.into()))?;
&nbsp;
         self.eth_api()
             .spawn_with_state_at_block(block.parent_hash.into(), move |state_provider| {
<span class="term-fg32">+                #[cfg(not(feature = &quot;scroll&quot;))]</span>
                 let db = StateProviderDatabase::new(&amp;state_provider);
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                let db = reth_scroll_storage::ScrollStateProviderDatabase::new(&amp;state_provider);</span>
                 let block_executor = this.inner.block_executor.executor(db);
&nbsp;
                 let mut witness_record = ExecutionWitnessRecord::default();
<span class="term-fg36">@@ -618,7 +621,11 @@</span>                 let _ = block_executor
                     .execute_with_state_closure(
                         (&amp;(*block).clone().unseal(), block.difficulty).into(),
                         |statedb: &amp;State&lt;_&gt;| {
<span class="term-fg31">-                            witness_record.record_executed_state(statedb);</span>
<span class="term-fg32">+                            witness_record.record_executed_state(</span>
<span class="term-fg32">+                                statedb,</span>
<span class="term-fg32">+                                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                                &amp;statedb.database.post_execution_context,</span>
<span class="term-fg32">+                            );</span>
                         },
                     )
                     .map_err(|err| EthApiError::Internal(err.into()))?;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a78132d41b7f01818a856b82" role="button"
                       aria-expanded="false" aria-controls="id-a78132d41b7f01818a856b82">
                        <code>crates/rpc/rpc/src/validation.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/rpc/rpc/src/validation.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/rpc/rpc/src/validation.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a78132d41b7f01818a856b82"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;validation.rs scroll-reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;validation.rs</span>
<span class="term-fg1">index a5e29bb739f97398ac3360106a70fb5cb8747c06..6754f1c1a4e93f097c06cd76eeba5a4f3e43385a 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;validation.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;validation.rs</span>
<span class="term-fg36">@@ -24,7 +24,6 @@</span> use reth_revm::{cached::CachedReads, database::StateProviderDatabase};
 use reth_rpc_api::BlockSubmissionValidationApiServer;
 use reth_rpc_server_types::result::internal_rpc_err;
 use reth_tasks::TaskSpawner;
<span class="term-fg31">-use reth_trie::HashedPostState;</span>
 use revm_primitives::{Address, B256, U256};
 use serde::{Deserialize, Serialize};
 use std::{collections::HashSet, sync::Arc};
<span class="term-fg36">@@ -180,7 +179,7 @@</span>
         self.ensure_payment(&amp;block, &amp;output, &amp;message)?;
&nbsp;
         let state_root =
<span class="term-fg31">-            state_provider.state_root(HashedPostState::from_bundle_state(&amp;output.state.state))?;</span>
<span class="term-fg32">+            state_provider.state_root(state_provider.hashed_post_state(&amp;output.state))?;</span>
&nbsp;
         if state_root != block.state_root {
             return Err(ConsensusError::BodyStateRootDiff(</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b060110d06599de217d7a196" role="button"
                       aria-expanded="false" aria-controls="id-b060110d06599de217d7a196">
                        <code>crates/tracing/src/formatter.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/tracing/src/formatter.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/tracing/src/formatter.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b060110d06599de217d7a196"><span class="term-fg1">diff --git reth&#47;crates&#47;tracing&#47;src&#47;formatter.rs scroll-reth&#47;crates&#47;tracing&#47;src&#47;formatter.rs</span>
<span class="term-fg1">index 1322377f1c9faf5d01cad726db3ce9a6357d2543..202a92136d26212e2632a93a6cef71943fe809df 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;tracing&#47;src&#47;formatter.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;tracing&#47;src&#47;formatter.rs</span>
<span class="term-fg36">@@ -54,7 +54,7 @@</span>             .map(|val| val != &quot;0&quot;)
             .unwrap_or_else(|_|
                 &#47;&#47; If `RUST_LOG_TARGET` is not set, show target in logs only if the max enabled
                 &#47;&#47; level is higher than INFO (DEBUG, TRACE)
<span class="term-fg31">-                filter.max_level_hint().map_or(true, |max_level| max_level &gt; tracing::Level::INFO));</span>
<span class="term-fg32">+                filter.max_level_hint().is_none_or(|max_level| max_level &gt; tracing::Level::INFO));</span>
&nbsp;
         match self {
             Self::Json =&gt; {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0cbf447b184ad0a00ae2d83f" role="button"
                       aria-expanded="false" aria-controls="id-0cbf447b184ad0a00ae2d83f">
                        <code>crates/transaction-pool/src/maintain.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/transaction-pool/src/maintain.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/transaction-pool/src/maintain.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0cbf447b184ad0a00ae2d83f"><span class="term-fg1">diff --git reth&#47;crates&#47;transaction-pool&#47;src&#47;maintain.rs scroll-reth&#47;crates&#47;transaction-pool&#47;src&#47;maintain.rs</span>
<span class="term-fg1">index 02f218d4b098b389b12e7d6cbd135c2c0bc07181..6763deb02e6031d6cfdb20857a8d3c9afee2b0fe 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;transaction-pool&#47;src&#47;maintain.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;transaction-pool&#47;src&#47;maintain.rs</span>
<span class="term-fg36">@@ -461,7 +461,7 @@</span>     fn update(&amp;mut self, finalized_block: Option&lt;BlockNumber&gt;) -&gt; Option&lt;BlockNumber&gt; {
         let finalized = finalized_block?;
         self.last_finalized_block
             .replace(finalized)
<span class="term-fg31">-            .map_or(true, |last| last &lt; finalized)</span>
<span class="term-fg32">+            .is_none_or(|last| last &lt; finalized)</span>
             .then_some(finalized)
     }
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7a28f794bcbf23142f2cc8ca" role="button"
                       aria-expanded="false" aria-controls="id-7a28f794bcbf23142f2cc8ca">
                        <code>crates/transaction-pool/src/pool/best.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/transaction-pool/src/pool/best.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/crates/transaction-pool/src/pool/best.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7a28f794bcbf23142f2cc8ca"><span class="term-fg1">diff --git reth&#47;crates&#47;transaction-pool&#47;src&#47;pool&#47;best.rs scroll-reth&#47;crates&#47;transaction-pool&#47;src&#47;pool&#47;best.rs</span>
<span class="term-fg1">index a4c91aae726845676711d2e4a9c60b962485c7bd..ed94bc676236252de0750325c4c54af68defcd18 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;transaction-pool&#47;src&#47;pool&#47;best.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;transaction-pool&#47;src&#47;pool&#47;best.rs</span>
<span class="term-fg36">@@ -57,7 +57,7 @@</span>             &#47;&#47; the transaction
             if best.transaction.max_fee_per_gas() &gt;= self.base_fee as u128 &amp;&amp;
                 best.transaction
                     .max_fee_per_blob_gas()
<span class="term-fg31">-                    .map_or(true, |fee| fee &gt;= self.base_fee_per_blob_gas as u128)</span>
<span class="term-fg32">+                    .is_none_or(|fee| fee &gt;= self.base_fee_per_blob_gas as u128)</span>
             {
                 return Some(best);
             }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3dac111fa11b09a162c2536f" role="button"
                       aria-expanded="false" aria-controls="id-3dac111fa11b09a162c2536f">
                        <code>deny.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/deny.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/deny.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3dac111fa11b09a162c2536f"><span class="term-fg1">diff --git reth&#47;deny.toml scroll-reth&#47;deny.toml</span>
<span class="term-fg1">index 8d0807f9de5c63618c5ca26f05ae75a198d95715..6dc51dba0a93737b29ee37c6d76549120dd504d3 100644</span>
<span class="term-fg1">--- reth&#47;deny.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;deny.toml</span>
<span class="term-fg36">@@ -67,6 +67,11 @@</span>     { allow = [&quot;MPL-2.0&quot;], name = &quot;option-ext&quot; },
     { allow = [&quot;MPL-2.0&quot;], name = &quot;webpki-roots&quot; },
 ]
&nbsp;
<span class="term-fg32">+# Skip the poseidon-bn254 and bn254 crates for license verification. We should at some point publish a license for them.</span>
<span class="term-fg32">+[licenses.private]</span>
<span class="term-fg32">+ignore = true</span>
<span class="term-fg32">+ignore-sources = [&quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254&quot;, &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;bn254&quot;]</span>
<span class="term-fg32">+</span>
 [[licenses.clarify]]
 name = &quot;ring&quot;
 expression = &quot;LicenseRef-ring&quot;
<span class="term-fg36">@@ -93,4 +98,7 @@</span>     &quot;https:&#47;&#47;github.com&#47;alloy-rs&#47;alloy&quot;,
     &quot;https:&#47;&#47;github.com&#47;foundry-rs&#47;block-explorers&quot;,
     &quot;https:&#47;&#47;github.com&#47;bluealloy&#47;revm&quot;,
     &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;revm-inspectors&quot;,
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;bn254&quot;,</span>
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;sp1-intrinsics&quot;,</span>
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254&quot;</span>
 ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ab012d74d36d9dc819bd5b29" role="button"
                       aria-expanded="false" aria-controls="id-ab012d74d36d9dc819bd5b29">
                        <code>examples/beacon-api-sidecar-fetcher/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/beacon-api-sidecar-fetcher/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/beacon-api-sidecar-fetcher/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ab012d74d36d9dc819bd5b29"><span class="term-fg1">diff --git reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;Cargo.toml scroll-reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;Cargo.toml</span>
<span class="term-fg1">index d9590f87e07a3d38ead9152d257034000f9e4e47..d30ce6b0824442bcb0359a9d9c63aa20aad54a85 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;Cargo.toml</span>
<span class="term-fg36">@@ -20,3 +20,6 @@</span> reqwest.workspace = true
 serde_json.workspace = true
 serde.workspace = true
 thiserror.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a7f9372aaf21d989e014c25a" role="button"
                       aria-expanded="false" aria-controls="id-a7f9372aaf21d989e014c25a">
                        <code>examples/beacon-api-sidecar-fetcher/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/beacon-api-sidecar-fetcher/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/beacon-api-sidecar-fetcher/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a7f9372aaf21d989e014c25a"><span class="term-fg1">diff --git reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;src&#47;main.rs scroll-reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;src&#47;main.rs</span>
<span class="term-fg1">index a0b9b6e01ec8cf05e6b519649d2c40ad74aedfb0..473d986604d4561f7d7fa0651fcc82aec520284f 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -12,6 +12,9 @@</span> &#47;&#47;!
 &#47;&#47;! See beacon Node API: &lt;https:&#47;&#47;ethereum.github.io&#47;beacon-APIs&#47;&gt;
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use std::{
     collections::VecDeque,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a72a466b4c58a230f7f07838" role="button"
                       aria-expanded="false" aria-controls="id-a72a466b4c58a230f7f07838">
                        <code>examples/beacon-api-sse/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/beacon-api-sse/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/beacon-api-sse/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a72a466b4c58a230f7f07838"><span class="term-fg1">diff --git reth&#47;examples&#47;beacon-api-sse&#47;Cargo.toml scroll-reth&#47;examples&#47;beacon-api-sse&#47;Cargo.toml</span>
<span class="term-fg1">index ca49897c9ee067662d047d867e75e69cc6729683..6b759aa355501bee900b923c10edfc81f3b5a498 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;beacon-api-sse&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;beacon-api-sse&#47;Cargo.toml</span>
<span class="term-fg36">@@ -16,3 +16,6 @@</span> futures-util.workspace = true
 mev-share-sse = { version = &quot;0.4.0&quot;, default-features = false }
 tokio = { workspace = true, features = [&quot;time&quot;] }
 tracing.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6945b4e985182effa03d55d4" role="button"
                       aria-expanded="false" aria-controls="id-6945b4e985182effa03d55d4">
                        <code>examples/beacon-api-sse/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/beacon-api-sse/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/beacon-api-sse/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6945b4e985182effa03d55d4"><span class="term-fg1">diff --git reth&#47;examples&#47;beacon-api-sse&#47;src&#47;main.rs scroll-reth&#47;examples&#47;beacon-api-sse&#47;src&#47;main.rs</span>
<span class="term-fg1">index 243511d4960ee06f84d00cb62001886668eb9209..00af7b39f8189bd627380c7e013aa6804dc39149 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;beacon-api-sse&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;beacon-api-sse&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -16,6 +16,9 @@</span> &#47;&#47;!
 &#47;&#47;! See lighthouse beacon Node API: &lt;https:&#47;&#47;lighthouse-book.sigmaprime.io&#47;api-bn.html#beacon-node-api&gt;
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_rpc_types_beacon::events::PayloadAttributesEvent;
 use clap::Parser;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2edb4464749311050d07f90f" role="button"
                       aria-expanded="false" aria-controls="id-2edb4464749311050d07f90f">
                        <code>examples/custom-beacon-withdrawals/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-beacon-withdrawals/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/custom-beacon-withdrawals/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2edb4464749311050d07f90f"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-beacon-withdrawals&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-beacon-withdrawals&#47;Cargo.toml</span>
<span class="term-fg1">index c396ca11df8bd03b44535914a3dbe1643b4e67d3..b4a2e62e7b0e0629d16f75b0099914e3541fccc4 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-beacon-withdrawals&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-beacon-withdrawals&#47;Cargo.toml</span>
<span class="term-fg36">@@ -13,6 +13,9 @@</span> reth-chainspec.workspace = true
 reth-evm.workspace = true
 reth-primitives.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+</span>
 alloy-sol-macro = &quot;0.8.9&quot;
 alloy-sol-types.workspace = true
 alloy-eips.workspace = true
<span class="term-fg36">@@ -23,4 +26,5 @@</span>
 [features]
 optimism = [
   &quot;reth-primitives&#47;optimism&quot;
<span class="term-fg31">-]</span>
<span class="term-fg31">\ No newline at end of file</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = []</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a4126cb076778aa6dc622685" role="button"
                       aria-expanded="false" aria-controls="id-a4126cb076778aa6dc622685">
                        <code>examples/custom-beacon-withdrawals/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-beacon-withdrawals/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/custom-beacon-withdrawals/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a4126cb076778aa6dc622685"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-beacon-withdrawals&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-beacon-withdrawals&#47;src&#47;main.rs</span>
<span class="term-fg1">index ccba73afbc1de796eede788736dde26cda16cdd3..ad0ae4bb2634efb87aefafa9f9d2d74174151fdc 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-beacon-withdrawals&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-beacon-withdrawals&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -2,6 +2,9 @@</span> &#47;&#47;! Example for how to modify a block post-execution step. It credits beacon withdrawals with a
 &#47;&#47;! custom mechanism instead of minting native tokens
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_eips::{eip4895::Withdrawal, eip7685::Requests};
 use alloy_sol_macro::sol;
<span class="term-fg36">@@ -16,6 +19,7 @@</span>     providers::ProviderError,
     revm::{
         interpreter::Host,
         primitives::{address, Address, Bytes, Env, EnvWithHandlerCfg, TransactTo, TxEnv, U256},
<span class="term-fg32">+        shared::BundleState,</span>
         Database, DatabaseCommit, Evm, State,
     },
 };
<span class="term-fg36">@@ -27,6 +31,7 @@</span> };
 use reth_evm_ethereum::EthEvmConfig;
 use reth_node_ethereum::{node::EthereumAddOns, BasicBlockExecutorProvider, EthereumNode};
 use reth_primitives::{BlockWithSenders, Receipt};
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use std::{fmt::Display, sync::Arc};
&nbsp;
 pub const SYSTEM_ADDRESS: Address = address!(&quot;fffffffffffffffffffffffffffffffffffffffe&quot;);
<span class="term-fg36">@@ -88,11 +93,15 @@</span>     evm_config: EthEvmConfig,
 }
&nbsp;
 impl BlockExecutionStrategyFactory for CustomExecutorStrategyFactory {
<span class="term-fg31">-    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = CustomExecutorStrategy&lt;DB&gt;;</span>
<span class="term-fg32">+    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = CustomExecutorStrategy&lt;DB&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn create_strategy&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Strategy&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         let state =
             State::builder().with_database(db).with_bundle_update().without_state_clear().build();
<span class="term-fg36">@@ -138,6 +147,7 @@</span>
 impl&lt;DB&gt; BlockExecutionStrategy&lt;DB&gt; for CustomExecutorStrategy&lt;DB&gt;
 where
     DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     type Error = BlockExecutionError;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-782a8774cc9ac3cec0aa4e10" role="button"
                       aria-expanded="false" aria-controls="id-782a8774cc9ac3cec0aa4e10">
                        <code>examples/custom-dev-node/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-dev-node/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/custom-dev-node/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-782a8774cc9ac3cec0aa4e10"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-dev-node&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-dev-node&#47;Cargo.toml</span>
<span class="term-fg1">index 8ed277686f4e53ac30d54cd8ffe6d943b67854ad..f101b22adbc3bbb863a15db612d368f89e555d8f 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-dev-node&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-dev-node&#47;Cargo.toml</span>
<span class="term-fg36">@@ -19,3 +19,6 @@</span> serde_json.workspace = true
&nbsp;
 alloy-genesis.workspace = true
 alloy-primitives.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-012d4a439275b782c8b33000" role="button"
                       aria-expanded="false" aria-controls="id-012d4a439275b782c8b33000">
                        <code>examples/custom-dev-node/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-dev-node/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/custom-dev-node/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-012d4a439275b782c8b33000"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-dev-node&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-dev-node&#47;src&#47;main.rs</span>
<span class="term-fg1">index 42bb83782aa3e9a226efa45b0b451e805c1f7a4a..ffe6e002b94cc102eac8c5267d3b7f360076e66a 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-dev-node&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-dev-node&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -2,6 +2,9 @@</span> &#47;&#47;! This example shows how to run a custom dev node programmatically and submit a transaction
 &#47;&#47;! through rpc.
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use std::sync::Arc;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e40aacdf9e711a92fc3f37af" role="button"
                       aria-expanded="false" aria-controls="id-e40aacdf9e711a92fc3f37af">
                        <code>examples/custom-engine-types/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-engine-types/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/custom-engine-types/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e40aacdf9e711a92fc3f37af"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-engine-types&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-engine-types&#47;Cargo.toml</span>
<span class="term-fg1">index d6642a8edfe5e9dbef84c58672b4e326b7a4f707..68a72f676c1dd4606920c16c3402bb4f71b7b34e 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-engine-types&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-engine-types&#47;Cargo.toml</span>
<span class="term-fg36">@@ -25,3 +25,6 @@</span> eyre.workspace = true
 tokio.workspace = true
 thiserror.workspace = true
 serde.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-71326f98b111f4d56f7a5695" role="button"
                       aria-expanded="false" aria-controls="id-71326f98b111f4d56f7a5695">
                        <code>examples/custom-engine-types/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-engine-types/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/custom-engine-types/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-71326f98b111f4d56f7a5695"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-engine-types&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-engine-types&#47;src&#47;main.rs</span>
<span class="term-fg1">index f9ac5c2386590321c0593946f227ffd31d05a8e1..c769e5bd53854beb642fe07647c2f560e4d762a6 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-engine-types&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-engine-types&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,21 +1,24 @@</span>
<span class="term-fg31">-&#47;&#47;! This example shows how to implement a custom [EngineTypes].</span>
<span class="term-fg32">+&#47;&#47;! This example shows how to implement a custom `EngineTypes`.</span>
 &#47;&#47;!
<span class="term-fg31">-&#47;&#47;! The [EngineTypes] trait can be implemented to configure the engine to work with custom types,</span>
<span class="term-fg32">+&#47;&#47;! The `EngineTypes` trait can be implemented to configure the engine to work with custom types,</span>
 &#47;&#47;! as long as those types implement certain traits.
 &#47;&#47;!
 &#47;&#47;! Custom payload attributes can be supported by implementing two main traits:
 &#47;&#47;!
<span class="term-fg31">-&#47;&#47;! [PayloadAttributes] can be implemented for payload attributes types that are used as</span>
<span class="term-fg32">+&#47;&#47;! `PayloadAttributes` can be implemented for payload attributes types that are used as</span>
 &#47;&#47;! arguments to the `engine_forkchoiceUpdated` method. This type should be used to define and
 &#47;&#47;! _spawn_ payload jobs.
 &#47;&#47;!
<span class="term-fg31">-&#47;&#47;! [PayloadBuilderAttributes] can be implemented for payload attributes types that _describe_</span>
<span class="term-fg32">+&#47;&#47;! `PayloadBuilderAttributes` can be implemented for payload attributes types that _describe_</span>
 &#47;&#47;! running payload jobs.
 &#47;&#47;!
<span class="term-fg31">-&#47;&#47;! Once traits are implemented and custom types are defined, the [EngineTypes] trait can be</span>
<span class="term-fg32">+&#47;&#47;! Once traits are implemented and custom types are defined, the `EngineTypes` trait can be</span>
 &#47;&#47;! implemented:
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_eips::eip4895::Withdrawals;
 use alloy_genesis::Genesis;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7eb9d26dda34f7d9bdb9d026" role="button"
                       aria-expanded="false" aria-controls="id-7eb9d26dda34f7d9bdb9d026">
                        <code>examples/custom-evm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-evm/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/custom-evm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7eb9d26dda34f7d9bdb9d026"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-evm&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-evm&#47;Cargo.toml</span>
<span class="term-fg1">index e763a932eabfbc7d39d2d22560ab915491444406..a807fe3aa9b7474ac3316e4f427ca1530745132c 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-evm&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-evm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -20,3 +20,6 @@</span> alloy-consensus.workspace = true
&nbsp;
 eyre.workspace = true
 tokio.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e8c6b5bbd27c734582437611" role="button"
                       aria-expanded="false" aria-controls="id-e8c6b5bbd27c734582437611">
                        <code>examples/custom-evm/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-evm/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/custom-evm/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e8c6b5bbd27c734582437611"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-evm&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-evm&#47;src&#47;main.rs</span>
<span class="term-fg1">index b9a4fc26a95b4bce9d246c3123085f3f02c6c9ee..4958cb44ce2989f4436552cbb3544f580251bb79 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-evm&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-evm&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,6 +1,9 @@</span>
 &#47;&#47;! This example shows how to implement a node with a custom EVM
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_consensus::Header;
 use alloy_genesis::Genesis;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-49a46d831227268e30c6efb6" role="button"
                       aria-expanded="false" aria-controls="id-49a46d831227268e30c6efb6">
                        <code>examples/custom-inspector/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-inspector/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/custom-inspector/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-49a46d831227268e30c6efb6"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-inspector&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-inspector&#47;Cargo.toml</span>
<span class="term-fg1">index ee6f887e64c0db02e2e2be7000c1c5f27bc128c2..3566eb3557111c6e89491573d824bdc613f693e8 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-inspector&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-inspector&#47;Cargo.toml</span>
<span class="term-fg36">@@ -12,4 +12,8 @@</span> alloy-rpc-types-eth.workspace = true
 clap = { workspace = true, features = [&quot;derive&quot;] }
 futures-util.workspace = true
 alloy-primitives.workspace = true
<span class="term-fg32">+</span>
 alloy-eips.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-10ad95216c5a959c481bd8d4" role="button"
                       aria-expanded="false" aria-controls="id-10ad95216c5a959c481bd8d4">
                        <code>examples/custom-inspector/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-inspector/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/custom-inspector/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-10ad95216c5a959c481bd8d4"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-inspector&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-inspector&#47;src&#47;main.rs</span>
<span class="term-fg1">index 67863d00e1e92124ba22aa229ef874a706bda8fc..dccc30eaecd3bdf9efb67eb67f945dd189622c73 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-inspector&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-inspector&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -9,6 +9,9 @@</span> &#47;&#47;!
 &#47;&#47;! If no recipients are specified, all transactions will be inspected.
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_eips::BlockNumberOrTag;
 use alloy_primitives::Address;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-788fc1bee0371ed4e01d79e1" role="button"
                       aria-expanded="false" aria-controls="id-788fc1bee0371ed4e01d79e1">
                        <code>examples/custom-node-components/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-node-components/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/custom-node-components/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-788fc1bee0371ed4e01d79e1"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-node-components&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-node-components&#47;Cargo.toml</span>
<span class="term-fg1">index 507088970de863d51821329b0e56d5e51c1a8d98..43940db3e3c4e4f8ad9f1fb9ef27a4267917c462 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-node-components&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-node-components&#47;Cargo.toml</span>
<span class="term-fg36">@@ -13,3 +13,6 @@</span> reth-transaction-pool.workspace = true
 reth-tracing.workspace = true
&nbsp;
 eyre.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-232d337effe5f3ca81d759ed" role="button"
                       aria-expanded="false" aria-controls="id-232d337effe5f3ca81d759ed">
                        <code>examples/custom-node-components/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-node-components/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/custom-node-components/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-232d337effe5f3ca81d759ed"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-node-components&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-node-components&#47;src&#47;main.rs</span>
<span class="term-fg1">index 7924aabd86926d6e699362255f9f04c5412e632b..80cba50a843855218222c9c66bbf48f4724138d6 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-node-components&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-node-components&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,6 +1,9 @@</span>
 &#47;&#47;! This example shows how to configure custom components for a reth node.
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use reth::{
     api::NodeTypes,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5b3ba5ae4269551aaf91deb3" role="button"
                       aria-expanded="false" aria-controls="id-5b3ba5ae4269551aaf91deb3">
                        <code>examples/custom-payload-builder/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-payload-builder/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/custom-payload-builder/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5b3ba5ae4269551aaf91deb3"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-payload-builder&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-payload-builder&#47;Cargo.toml</span>
<span class="term-fg1">index b77a3f2945ca54fd8052fc2b9e06b7c5e88fa575..b60c87803c9423a28acaded02c72e9d094270191 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-payload-builder&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-payload-builder&#47;Cargo.toml</span>
<span class="term-fg36">@@ -21,3 +21,6 @@</span>
 tracing.workspace = true
 futures-util.workspace = true
 eyre.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1764fa60ca9aa07ae718b659" role="button"
                       aria-expanded="false" aria-controls="id-1764fa60ca9aa07ae718b659">
                        <code>examples/custom-payload-builder/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-payload-builder/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/custom-payload-builder/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1764fa60ca9aa07ae718b659"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-payload-builder&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-payload-builder&#47;src&#47;main.rs</span>
<span class="term-fg1">index 6047da0dd1ba480e8630d340d425c131acb7c1e4..81ecf29270e732632f67923b6562a24bfae8f68b 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-payload-builder&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-payload-builder&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -10,6 +10,9 @@</span> &#47;&#47;!
 &#47;&#47;! This launch the regular reth node overriding the engine api payload builder with our custom.
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use generator::EmptyBlockPayloadJobGenerator;
 use reth::{</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ca4b8ca2fb9f210ceb582a5f" role="button"
                       aria-expanded="false" aria-controls="id-ca4b8ca2fb9f210ceb582a5f">
                        <code>examples/custom-rlpx-subprotocol/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-rlpx-subprotocol/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/custom-rlpx-subprotocol/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ca4b8ca2fb9f210ceb582a5f"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-rlpx-subprotocol&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-rlpx-subprotocol&#47;Cargo.toml</span>
<span class="term-fg1">index 18c136671c06718e581b7cbcd978f69e38fb967f..5fd30de7fafacef5bad46146333f8da529d52dc1 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-rlpx-subprotocol&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-rlpx-subprotocol&#47;Cargo.toml</span>
<span class="term-fg36">@@ -19,3 +19,6 @@</span> eyre.workspace = true
 rand.workspace = true
 tracing.workspace = true
 alloy-primitives.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8237f00ef319b95e40873279" role="button"
                       aria-expanded="false" aria-controls="id-8237f00ef319b95e40873279">
                        <code>examples/custom-rlpx-subprotocol/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-rlpx-subprotocol/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/custom-rlpx-subprotocol/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8237f00ef319b95e40873279"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-rlpx-subprotocol&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-rlpx-subprotocol&#47;src&#47;main.rs</span>
<span class="term-fg1">index 702d0e8cf5effe913b768b8832eb1959c0b50ce0..84a4f42645c597af71cb6abdd011a9b835dab8f8 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-rlpx-subprotocol&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-rlpx-subprotocol&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -8,6 +8,10 @@</span> &#47;&#47;! ```
 &#47;&#47;!
 &#47;&#47;! This launch a regular reth node with a custom rlpx subprotocol.
&nbsp;
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 mod subprotocol;
&nbsp;
 use std::net::{Ipv4Addr, SocketAddr, SocketAddrV4};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-beddd68328a8369bf4fe52a7" role="button"
                       aria-expanded="false" aria-controls="id-beddd68328a8369bf4fe52a7">
                        <code>examples/db-access/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/db-access/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/db-access/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-beddd68328a8369bf4fe52a7"><span class="term-fg1">diff --git reth&#47;examples&#47;db-access&#47;Cargo.toml scroll-reth&#47;examples&#47;db-access&#47;Cargo.toml</span>
<span class="term-fg1">index 3310d1cbd67646daa3771a2727a0bd68df1d441c..1d468700dba2dddc09c0014c7343412f3ef2b4bf 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;db-access&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;db-access&#47;Cargo.toml</span>
<span class="term-fg36">@@ -19,3 +19,6 @@</span> alloy-primitives.workspace = true
&nbsp;

 eyre.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-98d7164f5621e279512a90a7" role="button"
                       aria-expanded="false" aria-controls="id-98d7164f5621e279512a90a7">
                        <code>examples/db-access/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/db-access/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/db-access/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-98d7164f5621e279512a90a7"><span class="term-fg1">diff --git reth&#47;examples&#47;db-access&#47;src&#47;main.rs scroll-reth&#47;examples&#47;db-access&#47;src&#47;main.rs</span>
<span class="term-fg1">index 9f95fb51d91a472934b91cc02b7d512f1dd63615..7bc89b2a8f46b61a9dcecd2524b450a68f5c3fb3 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;db-access&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;db-access&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,3 +1,7 @@</span>
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 use alloy_primitives::{Address, B256};
 use alloy_rpc_types_eth::{Filter, FilteredParams};
 use reth_chainspec::ChainSpecBuilder;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a16313d00f170ae5f11d2a82" role="button"
                       aria-expanded="false" aria-controls="id-a16313d00f170ae5f11d2a82">
                        <code>examples/node-custom-rpc/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/node-custom-rpc/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/node-custom-rpc/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a16313d00f170ae5f11d2a82"><span class="term-fg1">diff --git reth&#47;examples&#47;node-custom-rpc&#47;Cargo.toml scroll-reth&#47;examples&#47;node-custom-rpc&#47;Cargo.toml</span>
<span class="term-fg1">index e82254757ec1d34e2532256bf2a64a90955aa255..13aa5872fccf272e7f1049050cb4adfb09e4e7ac 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;node-custom-rpc&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;node-custom-rpc&#47;Cargo.toml</span>
<span class="term-fg36">@@ -15,3 +15,6 @@</span> jsonrpsee = { workspace = true, features = [&quot;server&quot;, &quot;macros&quot;] }
&nbsp;
 [dev-dependencies]
 tokio.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9a63ec5d2311d323cd7b5096" role="button"
                       aria-expanded="false" aria-controls="id-9a63ec5d2311d323cd7b5096">
                        <code>examples/node-custom-rpc/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/node-custom-rpc/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/node-custom-rpc/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9a63ec5d2311d323cd7b5096"><span class="term-fg1">diff --git reth&#47;examples&#47;node-custom-rpc&#47;src&#47;main.rs scroll-reth&#47;examples&#47;node-custom-rpc&#47;src&#47;main.rs</span>
<span class="term-fg1">index 92e0bfea26e9b94af0c8ed2f48191377034024ee..889924b5e8d96b8277984cbdb9cc71ae6e5e499e 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;node-custom-rpc&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;node-custom-rpc&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -12,6 +12,10 @@</span> &#47;&#47;! ```sh
 &#47;&#47;! cast rpc txpoolExt_transactionCount
 &#47;&#47;! ```
&nbsp;
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 use clap::Parser;
 use jsonrpsee::{core::RpcResult, proc_macros::rpc};
 use reth::{chainspec::EthereumChainSpecParser, cli::Cli};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5db8ecbb538ceb8ee52db75a" role="button"
                       aria-expanded="false" aria-controls="id-5db8ecbb538ceb8ee52db75a">
                        <code>examples/node-event-hooks/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/node-event-hooks/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/node-event-hooks/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5db8ecbb538ceb8ee52db75a"><span class="term-fg1">diff --git reth&#47;examples&#47;node-event-hooks&#47;Cargo.toml scroll-reth&#47;examples&#47;node-event-hooks&#47;Cargo.toml</span>
<span class="term-fg1">index 450f6f006b287fc58fb01e1ddd98df239161c8e0..2e01b99a8893b79b598c35fac9ab7c533369a75c 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;node-event-hooks&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;node-event-hooks&#47;Cargo.toml</span>
<span class="term-fg36">@@ -8,3 +8,6 @@</span>
 [dependencies]
 reth.workspace = true
 reth-node-ethereum.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c226b7358d5e4ffd74806830" role="button"
                       aria-expanded="false" aria-controls="id-c226b7358d5e4ffd74806830">
                        <code>examples/node-event-hooks/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/node-event-hooks/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/node-event-hooks/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c226b7358d5e4ffd74806830"><span class="term-fg1">diff --git reth&#47;examples&#47;node-event-hooks&#47;src&#47;main.rs scroll-reth&#47;examples&#47;node-event-hooks&#47;src&#47;main.rs</span>
<span class="term-fg1">index e8a751840e0dab68d2c04d7e4599c973562a6229..a3dc823ccc0730d02f298f98bcd768e0cc706744 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;node-event-hooks&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;node-event-hooks&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -11,6 +11,10 @@</span> &#47;&#47;! This launch the regular reth node and also print:
 &#47;&#47;! &gt; &quot;All components initialized&quot;  once all components have been initialized
 &#47;&#47;! &gt; &quot;Node started&quot;  once the node has been started.
&nbsp;
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 use reth::cli::Cli;
 use reth_node_ethereum::EthereumNode;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fafe5c64fab71285004f979f" role="button"
                       aria-expanded="false" aria-controls="id-fafe5c64fab71285004f979f">
                        <code>examples/rpc-db/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/rpc-db/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/rpc-db/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fafe5c64fab71285004f979f"><span class="term-fg1">diff --git reth&#47;examples&#47;rpc-db&#47;Cargo.toml scroll-reth&#47;examples&#47;rpc-db&#47;Cargo.toml</span>
<span class="term-fg1">index 262b3df8babc91f322e4482d81401e97c5f21ebd..cce1b763d7fa762901f263733d8edcb045ffbcba 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;rpc-db&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;rpc-db&#47;Cargo.toml</span>
<span class="term-fg36">@@ -15,3 +15,6 @@</span> reth-node-ethereum.workspace = true
 reth-provider = { workspace = true, features = [&quot;test-utils&quot;] }
 tokio = { workspace = true, features = [&quot;full&quot;] }
 eyre.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8c8582a90f70077bf5ee95fb" role="button"
                       aria-expanded="false" aria-controls="id-8c8582a90f70077bf5ee95fb">
                        <code>examples/rpc-db/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/rpc-db/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/rpc-db/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8c8582a90f70077bf5ee95fb"><span class="term-fg1">diff --git reth&#47;examples&#47;rpc-db&#47;src&#47;main.rs scroll-reth&#47;examples&#47;rpc-db&#47;src&#47;main.rs</span>
<span class="term-fg1">index 92ae86f00bb9b3464cfabb373660997b535f241b..99d152a7d0e157e1608792c3cf347bc123a5416b 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;rpc-db&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;rpc-db&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -12,6 +12,10 @@</span> &#47;&#47;! ```sh
 &#47;&#47;! cast rpc myrpcExt_customMethod
 &#47;&#47;! ```
&nbsp;
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 use std::{path::Path, sync::Arc};
&nbsp;
 use reth::{</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-455fa16aba2ab5a2a1268c2e" role="button"
                       aria-expanded="false" aria-controls="id-455fa16aba2ab5a2a1268c2e">
                        <code>examples/stateful-precompile/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/stateful-precompile/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/stateful-precompile/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-455fa16aba2ab5a2a1268c2e"><span class="term-fg1">diff --git reth&#47;examples&#47;stateful-precompile&#47;Cargo.toml scroll-reth&#47;examples&#47;stateful-precompile&#47;Cargo.toml</span>
<span class="term-fg1">index 478886d061f812d73f036c2f1c2b332097e5752b..7488cc497beed70400a84d8df6f6830395eebdec 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;stateful-precompile&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;stateful-precompile&#47;Cargo.toml</span>
<span class="term-fg36">@@ -21,3 +21,6 @@</span> eyre.workspace = true
 parking_lot.workspace = true
 schnellru.workspace = true
 tokio.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-46b8cfc3167d9d025a501346" role="button"
                       aria-expanded="false" aria-controls="id-46b8cfc3167d9d025a501346">
                        <code>examples/stateful-precompile/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/stateful-precompile/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/stateful-precompile/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-46b8cfc3167d9d025a501346"><span class="term-fg1">diff --git reth&#47;examples&#47;stateful-precompile&#47;src&#47;main.rs scroll-reth&#47;examples&#47;stateful-precompile&#47;src&#47;main.rs</span>
<span class="term-fg1">index f683af4e430a39189328f7cd498860ab6fe2873e..718779cab8290d3ac351dd87a11c7955d25340ca 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;stateful-precompile&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;stateful-precompile&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,6 +1,9 @@</span>
 &#47;&#47;! This example shows how to implement a node with a custom EVM that uses a stateful precompile
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_consensus::Header;
 use alloy_genesis::Genesis;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c77a94acda8e97193045e484" role="button"
                       aria-expanded="false" aria-controls="id-c77a94acda8e97193045e484">
                        <code>examples/txpool-tracing/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/txpool-tracing/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/txpool-tracing/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c77a94acda8e97193045e484"><span class="term-fg1">diff --git reth&#47;examples&#47;txpool-tracing&#47;Cargo.toml scroll-reth&#47;examples&#47;txpool-tracing&#47;Cargo.toml</span>
<span class="term-fg1">index 38d0ad9409b6b5921f70922dbf7190b7123f3d53..67e45929a4d4fd2b2270674a344cc01581c50108 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;txpool-tracing&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;txpool-tracing&#47;Cargo.toml</span>
<span class="term-fg36">@@ -12,3 +12,6 @@</span> alloy-rpc-types-trace.workspace = true
 clap = { workspace = true, features = [&quot;derive&quot;] }
 futures-util.workspace = true
 alloy-primitives.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d746251b1852da40b7f2b260" role="button"
                       aria-expanded="false" aria-controls="id-d746251b1852da40b7f2b260">
                        <code>examples/txpool-tracing/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/txpool-tracing/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/examples/txpool-tracing/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d746251b1852da40b7f2b260"><span class="term-fg1">diff --git reth&#47;examples&#47;txpool-tracing&#47;src&#47;main.rs scroll-reth&#47;examples&#47;txpool-tracing&#47;src&#47;main.rs</span>
<span class="term-fg1">index 94f800987a967537325be98e7889b87f12214885..415fd46fad79accc51b2a898421692a372bfd46f 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;txpool-tracing&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;txpool-tracing&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -9,6 +9,9 @@</span> &#47;&#47;!
 &#47;&#47;! If no recipients are specified, all transactions will be traced.
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_primitives::Address;
 use alloy_rpc_types_trace::{parity::TraceType, tracerequest::TraceCallRequest};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f054cbf17f0a963870d79d93" role="button"
                       aria-expanded="false" aria-controls="id-f054cbf17f0a963870d79d93">
                        <code>testing/ef-tests/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/testing/ef-tests/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/testing/ef-tests/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f054cbf17f0a963870d79d93"><span class="term-fg1">diff --git reth&#47;testing&#47;ef-tests&#47;Cargo.toml scroll-reth&#47;testing&#47;ef-tests&#47;Cargo.toml</span>
<span class="term-fg1">index 2fc0c7512441691ca58f9bd67b6d2cc4e7f00bbd..72d1fb90893f42fe2d214d5c12cac2cd9113b1c8 100644</span>
<span class="term-fg1">--- reth&#47;testing&#47;ef-tests&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;testing&#47;ef-tests&#47;Cargo.toml</span>
<span class="term-fg36">@@ -18,6 +18,14 @@</span>     &quot;reth-primitives&#47;asm-keccak&quot;,
     &quot;alloy-primitives&#47;asm-keccak&quot;,
     &quot;revm&#47;asm-keccak&quot;,
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-stages&#47;scroll&quot;</span>
<span class="term-fg32">+]</span>
&nbsp;
 [dependencies]
 reth-chainspec.workspace = true
<span class="term-fg36">@@ -34,6 +42,8 @@</span> reth-evm-ethereum.workspace = true
 reth-revm = { workspace = true, features = [&quot;std&quot;] }
&nbsp;
 revm = { workspace = true, features = [&quot;secp256k1&quot;, &quot;blst&quot;, &quot;c-kzg&quot;] }
<span class="term-fg32">+</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
&nbsp;
 alloy-rlp.workspace = true
 alloy-primitives.workspace = true</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e15b809ad5a51ee8d4595c37" role="button"
                       aria-expanded="false" aria-controls="id-e15b809ad5a51ee8d4595c37">
                        <code>testing/ef-tests/src/models.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/testing/ef-tests/src/models.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/testing/ef-tests/src/models.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e15b809ad5a51ee8d4595c37"><span class="term-fg1">diff --git reth&#47;testing&#47;ef-tests&#47;src&#47;models.rs scroll-reth&#47;testing&#47;ef-tests&#47;src&#47;models.rs</span>
<span class="term-fg1">index 292b32e8ce0f4393ac21fd7b8bb6cd29f077e7ae..3e3a25e45a1676951193cbfc47e75297a4d2ed66 100644</span>
<span class="term-fg1">--- reth&#47;testing&#47;ef-tests&#47;src&#47;models.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;testing&#47;ef-tests&#47;src&#47;models.rs</span>
<span class="term-fg36">@@ -162,6 +162,10 @@</span>             let reth_account = RethAccount {
                 balance: account.balance,
                 nonce: account.nonce.to::&lt;u64&gt;(),
                 bytecode_hash: code_hash,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                    &amp;account.code,</span>
<span class="term-fg32">+                )),</span>
             };
             tx.put::&lt;tables::PlainAccountState&gt;(address, reth_account)?;
             tx.put::&lt;tables::HashedAccounts&gt;(hashed_address, reth_account)?;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d388d92d885808611fc378ca" role="button"
                       aria-expanded="false" aria-controls="id-d388d92d885808611fc378ca">
                        <code>testing/testing-utils/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/testing/testing-utils/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/testing/testing-utils/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d388d92d885808611fc378ca"><span class="term-fg1">diff --git reth&#47;testing&#47;testing-utils&#47;Cargo.toml scroll-reth&#47;testing&#47;testing-utils&#47;Cargo.toml</span>
<span class="term-fg1">index a6197d7e0cf71510335d81676c278bf5ad085cba..654c526be8959ce3acf45764973d4f8e1ea564c4 100644</span>
<span class="term-fg1">--- reth&#47;testing&#47;testing-utils&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;testing&#47;testing-utils&#47;Cargo.toml</span>
<span class="term-fg36">@@ -25,3 +25,6 @@</span>
 [dev-dependencies]
 alloy-eips.workspace = true
 reth-primitives-traits .workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [&quot;reth-primitives&#47;scroll&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-76ebae784b07be3ef233795d" role="button"
                       aria-expanded="false" aria-controls="id-76ebae784b07be3ef233795d">
                        <code>testing/testing-utils/src/generators.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/testing/testing-utils/src/generators.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/testing/testing-utils/src/generators.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-76ebae784b07be3ef233795d"><span class="term-fg1">diff --git reth&#47;testing&#47;testing-utils&#47;src&#47;generators.rs scroll-reth&#47;testing&#47;testing-utils&#47;src&#47;generators.rs</span>
<span class="term-fg1">index 9963b447e96d66bf9c361d56db6b43966e135f9e..ae45f0b6fc08e36c0ceab3c7a41fc623fe1b1bb6 100644</span>
<span class="term-fg1">--- reth&#47;testing&#47;testing-utils&#47;src&#47;generators.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;testing&#47;testing-utils&#47;src&#47;generators.rs</span>
<span class="term-fg36">@@ -386,7 +386,16 @@</span>     let nonce: u64 = rng.gen();
     let balance = U256::from(rng.gen::&lt;u32&gt;());
     let addr = rng.gen();
&nbsp;
<span class="term-fg31">-    (addr, Account { nonce, balance, bytecode_hash: None })</span>
<span class="term-fg32">+    (</span>
<span class="term-fg32">+        addr,</span>
<span class="term-fg32">+        Account {</span>
<span class="term-fg32">+            nonce,</span>
<span class="term-fg32">+            balance,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+    )</span>
 }
&nbsp;
 &#47;&#47;&#47; Generate random Externally Owned Accounts</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
        </div>
    </div>
</div>

                
                    <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-e823f272b5417cc1a203aee0"role="button" aria-expanded="false" aria-controls="id-e823f272b5417cc1a203aee0">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h4>Ignored changes</h4></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                
                    <div class="text-end"><span class="text-add-ignored">+110</span></div>
                    <div class="text-start"><span class="text-delete-ignored">-38</span></div>
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-e823f272b5417cc1a203aee0">
        <div></div>
        <div>
            
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-db8f9d43be22760dc27facd2" role="button"
                       aria-expanded="false" aria-controls="id-db8f9d43be22760dc27facd2">
                        <code>.github/workflows/bench.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/bench.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/.github/workflows/bench.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+1</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-db8f9d43be22760dc27facd2"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;bench.yml scroll-reth&#47;.github&#47;workflows&#47;bench.yml</span>
<span class="term-fg1">index 8ddc97441c2a843ca168ac54ddc180fda913838d..b647a81a2267eb91e49317db91a1cce2a1aa4465 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;bench.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;bench.yml</span>
<span class="term-fg36">@@ -18,8 +18,7 @@</span>
 name: bench
 jobs:
   iai:
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     # Only run benchmarks in merge groups and on main
     if: github.event_name != &#39;pull_request&#39;
     steps:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-eadc6596406f4d23d77a20be" role="button"
                       aria-expanded="false" aria-controls="id-eadc6596406f4d23d77a20be">
                        <code>.github/workflows/book.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/book.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/.github/workflows/book.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+2</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-eadc6596406f4d23d77a20be"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;book.yml scroll-reth&#47;.github&#47;workflows&#47;book.yml</span>
<span class="term-fg1">index 56d5c427466e0ef9eefe65daab422e86026b205d..d7f9fe34826e2b0010a0b15b496af508f58ab94c 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;book.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;book.yml</span>
<span class="term-fg36">@@ -4,9 +4,9 @@</span> name: book
&nbsp;
 on:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
   pull_request:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
   merge_group:
&nbsp;
 jobs:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-fb7c39bd9a52fd4ff5838e20" role="button"
                       aria-expanded="false" aria-controls="id-fb7c39bd9a52fd4ff5838e20">
                        <code>.github/workflows/compact.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/compact.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/.github/workflows/compact.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+4</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fb7c39bd9a52fd4ff5838e20"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;compact.yml scroll-reth&#47;.github&#47;workflows&#47;compact.yml</span>
<span class="term-fg1">index 484b27c820d003caff9b8abdf50e9ce2f9fe3155..44939e4b447c1d33a4d61671b3bce9244bee7417 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;compact.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;compact.yml</span>
<span class="term-fg36">@@ -10,7 +10,7 @@</span>
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [scroll]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -18,8 +18,7 @@</span>
 name: compact-codec
 jobs:
   compact-codec:
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     strategy:
       matrix:
         bin:
<span class="term-fg36">@@ -33,8 +32,8 @@</span>           cache-on-failure: true
       - name: Checkout base
         uses: actions&#47;checkout@v4
         with:
<span class="term-fg31">-          ref: ${{ github.base_ref || &#39;main&#39; }}</span>
<span class="term-fg31">-      # On `main` branch, generates test vectors and serializes them to disk using `Compact`.</span>
<span class="term-fg32">+          ref: ${{ github.base_ref || &#39;scroll&#39; }}</span>
<span class="term-fg32">+      # On `scroll` branch, generates test vectors and serializes them to disk using `Compact`.</span>
       - name: Generate compact vectors
         run: |
           ${{ matrix.bin }} -- test-vectors compact --write</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-f039698b6661d2368be6244b" role="button"
                       aria-expanded="false" aria-controls="id-f039698b6661d2368be6244b">
                        <code>.github/workflows/deny.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/deny.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/.github/workflows/deny.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+2</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f039698b6661d2368be6244b"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;deny.yml scroll-reth&#47;.github&#47;workflows&#47;deny.yml</span>
<span class="term-fg1">index f85484ca2ec21833a6942fdea82eaf6d15d4ebc4..6908a3d5a56117cac1a581d25953fa4670ba45cd 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;deny.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;deny.yml</span>
<span class="term-fg36">@@ -4,10 +4,10 @@</span> name: deny
&nbsp;
 on:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
     paths: [Cargo.lock]
   pull_request:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
     paths: [Cargo.lock]
   merge_group:
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-eaf2a28a1ca277ff4f931eb7" role="button"
                       aria-expanded="false" aria-controls="id-eaf2a28a1ca277ff4f931eb7">
                        <code>.github/workflows/hive.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/hive.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/.github/workflows/hive.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+4</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-8</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-eaf2a28a1ca277ff4f931eb7"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;hive.yml scroll-reth&#47;.github&#47;workflows&#47;hive.yml</span>
<span class="term-fg1">index b8d3f378fca40be3a094856b6205b3139350ee4b..0d8ba91a00c53e7a5b01cb286343dca992ccee56 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;hive.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;hive.yml</span>
<span class="term-fg36">@@ -19,8 +19,7 @@</span> jobs:
   prepare-reth:
     if: github.repository == &#39;paradigmxyz&#47;reth&#39;
     timeout-minutes: 45
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     steps:
       - uses: actions&#47;checkout@v4
       - run: mkdir artifacts
<span class="term-fg36">@@ -53,8 +52,7 @@</span>
   prepare-hive:
     if: github.repository == &#39;paradigmxyz&#47;reth&#39;
     timeout-minutes: 45
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     steps:
       - uses: actions&#47;checkout@v4
       - name: Checkout hive tests
<span class="term-fg36">@@ -181,8 +179,7 @@</span>     needs:
       - prepare-reth
       - prepare-hive
     name: run ${{ matrix.scenario.sim }}${{ matrix.scenario.limit &amp;&amp; format(&#39; - {0}&#39;, matrix.scenario.limit) }}
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     permissions:
       issues: write
     steps:
<span class="term-fg36">@@ -249,8 +246,7 @@</span>           cat hivetests&#47;workspace&#47;logs&#47;reth&#47;client-*.log
   notify-on-error:
     needs: test
     if: failure()
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     steps:
       - name: Slack Webhook Action
         uses: rtCamp&#47;action-slack-notify@v2</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-3fe8ad3408717bf4fa019599" role="button"
                       aria-expanded="false" aria-controls="id-3fe8ad3408717bf4fa019599">
                        <code>.github/workflows/integration.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/integration.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/.github/workflows/integration.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+4</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3fe8ad3408717bf4fa019599"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;integration.yml scroll-reth&#47;.github&#47;workflows&#47;integration.yml</span>
<span class="term-fg1">index 82bd5705a32001b5e309a55df19974211618ee6e..7ba3395cce84576d6b304c4945f751e1bdc24080 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;integration.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;integration.yml</span>
<span class="term-fg36">@@ -6,7 +6,7 @@</span> on:
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -19,8 +19,7 @@</span>
 jobs:
   test:
     name: test &#47; ${{ matrix.network }}
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_BACKTRACE: 1
     strategy:
<span class="term-fg36">@@ -28,6 +27,8 @@</span>       matrix:
         network: [&quot;ethereum&quot;, &quot;optimism&quot;]
     timeout-minutes: 60
     steps:
<span class="term-fg32">+      - name: Free up disk space</span>
<span class="term-fg32">+        run: rm -rf &#47;opt&#47;hostedtoolcache</span>
       - uses: actions&#47;checkout@v4
       - uses: dtolnay&#47;rust-toolchain@stable
       - name: Install Geth</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-487e71d00661b1a3da78b216" role="button"
                       aria-expanded="false" aria-controls="id-487e71d00661b1a3da78b216">
                        <code>.github/workflows/lint.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/lint.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/.github/workflows/lint.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+8</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-487e71d00661b1a3da78b216"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;lint.yml scroll-reth&#47;.github&#47;workflows&#47;lint.yml</span>
<span class="term-fg1">index 7e6b8747fff5971fdd71848d8051a2aa4c7b4bb2..384761ee5bf6bb878672bb97c7688fe458ba8d8e 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;lint.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;lint.yml</span>
<span class="term-fg36">@@ -4,7 +4,7 @@</span> on:
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -152,7 +152,13 @@</span>       - uses: Swatinem&#47;rust-cache@v2
         with:
           cache-on-failure: true
       - uses: taiki-e&#47;install-action@cargo-udeps
<span class="term-fg31">-      - run: cargo udeps --workspace --lib --examples --tests --benches --all-features --locked</span>
<span class="term-fg32">+        # due to the scroll feature flag, we need to exclude some crates that were annotated with</span>
<span class="term-fg32">+        # #![cfg(not(feature = &quot;scroll))].</span>
<span class="term-fg32">+      - run: |</span>
<span class="term-fg32">+          cargo udeps --workspace --lib --examples --tests --benches --all-features --locked \</span>
<span class="term-fg32">+            --exclude &quot;reth-optimism-*&quot; --exclude op-reth --exclude &quot;example-*&quot; --exclude reth \</span>
<span class="term-fg32">+            --exclude reth-e2e-test-utils --exclude reth-ethereum-payload-builder --exclude reth-exex-test-utils \</span>
<span class="term-fg32">+            --exclude reth-node-ethereum</span>
&nbsp;
   book:
     name: book</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-d84d1fd6f1b07afb74bf08b2" role="button"
                       aria-expanded="false" aria-controls="id-d84d1fd6f1b07afb74bf08b2">
                        <code>.github/workflows/pages.yaml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/.github/workflows/pages.yaml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+32</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d84d1fd6f1b07afb74bf08b2"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;pages.yaml scroll-reth&#47;.github&#47;workflows&#47;pages.yaml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..5717d4c95543c09d59a7d51803826ead2641a5c5</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;pages.yaml</span>
<span class="term-fg36">@@ -0,0 +1,33 @@</span>
<span class="term-fg32">+name: Build and publish forkdiff github-pages</span>
<span class="term-fg32">+permissions:</span>
<span class="term-fg32">+  contents: write</span>
<span class="term-fg32">+on:</span>
<span class="term-fg32">+  push:</span>
<span class="term-fg32">+    branches:</span>
<span class="term-fg32">+      - scroll</span>
<span class="term-fg32">+jobs:</span>
<span class="term-fg32">+  deploy:</span>
<span class="term-fg32">+    concurrency: ci-${{ github.ref }}</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+      - name: Checkout</span>
<span class="term-fg32">+        uses: actions&#47;checkout@v4</span>
<span class="term-fg32">+        with:</span>
<span class="term-fg32">+          fetch-depth: 1000  # make sure to fetch the old commit we diff against</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+      - name: Build forkdiff</span>
<span class="term-fg32">+        uses: &quot;docker:&#47;&#47;protolambda&#47;forkdiff:0.1.0&quot;</span>
<span class="term-fg32">+        with:</span>
<span class="term-fg32">+          args: -repo=&#47;github&#47;workspace -fork=&#47;github&#47;workspace&#47;fork.yaml -out=&#47;github&#47;workspace&#47;index.html</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+      - name: Build pages</span>
<span class="term-fg32">+        run: |</span>
<span class="term-fg32">+          mkdir -p tmp&#47;pages</span>
<span class="term-fg32">+          mv index.html tmp&#47;pages&#47;index.html</span>
<span class="term-fg32">+          touch tmp&#47;pages&#47;.nojekyll</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+      - name: Deploy</span>
<span class="term-fg32">+        uses: JamesIves&#47;github-pages-deploy-action@v4</span>
<span class="term-fg32">+        with:</span>
<span class="term-fg32">+          folder: tmp&#47;pages</span>
<span class="term-fg32">+          clean: true</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-4ef64b235fd5eca99adbb28b" role="button"
                       aria-expanded="false" aria-controls="id-4ef64b235fd5eca99adbb28b">
                        <code>.github/workflows/stage.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/stage.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/.github/workflows/stage.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+2</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4ef64b235fd5eca99adbb28b"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;stage.yml scroll-reth&#47;.github&#47;workflows&#47;stage.yml</span>
<span class="term-fg1">index 60ffa8f73d728311d53e26e0005d5a2723437cce..b3988a0a0ef35b1d219eb76e2bea0226957ba46c 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;stage.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;stage.yml</span>
<span class="term-fg36">@@ -6,7 +6,7 @@</span> on:
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [ main ]</span>
<span class="term-fg32">+    branches: [ main, scroll ]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -22,8 +22,7 @@</span>   stage:
     name: stage-run-test
     # Only run stage commands test in merge groups
     if: github.event_name == &#39;merge_group&#39;
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_LOG: info,sync=error
       RUST_BACKTRACE: 1</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-1e4ed1183a8d1455b2eda6a1" role="button"
                       aria-expanded="false" aria-controls="id-1e4ed1183a8d1455b2eda6a1">
                        <code>.github/workflows/stale.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/stale.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/.github/workflows/stale.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+0</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1e4ed1183a8d1455b2eda6a1"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;stale.yml scroll-reth&#47;.github&#47;workflows&#47;stale.yml</span>
<span class="term-fg1">index 38cca2fb1a9b895f2c548d9db60678c3d6bea241..0d51a0e4eae60c0a8e5a7383eb134b85966b638a 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;stale.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;stale.yml</span>
<span class="term-fg36">@@ -4,8 +4,6 @@</span> name: stale issues
&nbsp;
 on:
   workflow_dispatch: {}
<span class="term-fg31">-  schedule:</span>
<span class="term-fg31">-    - cron: &quot;30 1 * * *&quot;</span>
&nbsp;
 jobs:
   close-issues:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-0047821a1fb652745d88a954" role="button"
                       aria-expanded="false" aria-controls="id-0047821a1fb652745d88a954">
                        <code>.github/workflows/sync.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/sync.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/.github/workflows/sync.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+1</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0047821a1fb652745d88a954"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;sync.yml scroll-reth&#47;.github&#47;workflows&#47;sync.yml</span>
<span class="term-fg1">index 531d04b2e48918fc3b39e39b94402efc1c052346..1f7d592a0405a673803a2fc1ebe0176cef775bf2 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;sync.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;sync.yml</span>
<span class="term-fg36">@@ -15,8 +15,7 @@</span>
 jobs:
   sync:
     name: sync (${{ matrix.chain.bin }})
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_LOG: info,sync=error
       RUST_BACKTRACE: 1</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-152eb4946559cac5adf35a28" role="button"
                       aria-expanded="false" aria-controls="id-152eb4946559cac5adf35a28">
                        <code>.github/workflows/unit.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/unit.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/.github/workflows/unit.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+8</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-7</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-152eb4946559cac5adf35a28"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;unit.yml scroll-reth&#47;.github&#47;workflows&#47;unit.yml</span>
<span class="term-fg1">index 4c927df8be004f5f5f673a083a36f3733194b093..50f5fa6e38e8a7819fccadc2faa0fd2e804041ec 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;unit.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;unit.yml</span>
<span class="term-fg36">@@ -6,7 +6,7 @@</span> on:
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -19,8 +19,7 @@</span>
 jobs:
   test:
     name: test &#47; ${{ matrix.type }} (${{ matrix.partition }}&#47;${{ matrix.total_partitions }})
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_BACKTRACE: 1
     strategy:
<span class="term-fg36">@@ -48,6 +47,8 @@</span>             partition: 1
             total_partitions: 1
     timeout-minutes: 30
     steps:
<span class="term-fg32">+      - name: Free up disk space</span>
<span class="term-fg32">+        run: rm -rf &#47;opt&#47;hostedtoolcache</span>
       - uses: actions&#47;checkout@v4
       - uses: dtolnay&#47;rust-toolchain@stable
       - uses: Swatinem&#47;rust-cache@v2
<span class="term-fg36">@@ -68,13 +69,14 @@</span>             -E &quot;!kind(test)&quot;
&nbsp;
   state:
     name: Ethereum state tests
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_LOG: info,sync=error
       RUST_BACKTRACE: 1
     timeout-minutes: 30
     steps:
<span class="term-fg32">+      - name: Free up disk space</span>
<span class="term-fg32">+        run: rm -rf &#47;opt&#47;hostedtoolcache</span>
       - uses: actions&#47;checkout@v4
       - name: Checkout ethereum&#47;tests
         uses: actions&#47;checkout@v4
<span class="term-fg36">@@ -93,8 +95,7 @@</span>       - run: cargo nextest run --release -p ef-tests --features &quot;asm-keccak ef-tests&quot;
&nbsp;
   doc:
     name: doc tests (${{ matrix.network }})
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_BACKTRACE: 1
     timeout-minutes: 30</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-656c8800c8ec26cf2f95b778" role="button"
                       aria-expanded="false" aria-controls="id-656c8800c8ec26cf2f95b778">
                        <code>fork.yaml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9cf7d1436a864c6c369fdcbd8d26d9c0ffd2806f/fork.yaml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+42</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-656c8800c8ec26cf2f95b778"><span class="term-fg1">diff --git reth&#47;fork.yaml scroll-reth&#47;fork.yaml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..a63fb177f7a026d5d10e192f7fc229695206e6f8</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;fork.yaml</span>
<span class="term-fg36">@@ -0,0 +1,42 @@</span>
<span class="term-fg32">+title: &quot;scroll-reth - reth fork diff overview&quot;</span>
<span class="term-fg32">+footer: |</span>
<span class="term-fg32">+  Fork-diff overview of [`scroll-reth`](https:&#47;&#47;github.com&#47;scroll-tech&#47;reth), a fork of [`reth`](https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth).</span>
<span class="term-fg32">+base:</span>
<span class="term-fg32">+  name: reth</span>
<span class="term-fg32">+  url: https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth</span>
<span class="term-fg32">+  hash: 3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15</span>
<span class="term-fg32">+fork:</span>
<span class="term-fg32">+  name: scroll-reth</span>
<span class="term-fg32">+  url: https:&#47;&#47;github.com&#47;scroll-tech&#47;reth</span>
<span class="term-fg32">+  ref: refs&#47;heads&#47;scroll</span>
<span class="term-fg32">+def:</span>
<span class="term-fg32">+  title: &quot;scroll-reth&quot;</span>
<span class="term-fg32">+  description: |</span>
<span class="term-fg32">+    This is an overview of the changes in [`scroll-reth`](https:&#47;&#47;github.com&#47;scroll-tech&#47;reth),</span>
<span class="term-fg32">+    a fork of [`reth`](https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth).</span>
<span class="term-fg32">+  sub:</span>
<span class="term-fg32">+    - title: &quot;crates&#47;scroll&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;scroll&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;ethereum&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;ethereum&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;optimism&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;optimism&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;primitives&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;primitives*&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;stages&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;stages&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;storage&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;storage&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;trie&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;trie&#47;**&#47;*&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+ignore:</span>
<span class="term-fg32">+  - &quot;fork.yaml&quot;</span>
<span class="term-fg32">+  - &quot;.github&#47;**&quot;</span></div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

                
            </div>
        </main>
    </div>

    <footer class="col-xl-10 col-xxl-8 mx-auto px-3 pt-5 my-5 text-muted border-top">
        <p>Fork-diff overview of <a href="https://github.com/scroll-tech/reth"><code>scroll-reth</code></a>, a fork of <a href="https://github.com/paradigmxyz/reth"><code>reth</code></a>.</p>

    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD" crossorigin="anonymous"></script>
    <script type="text/javascript">
        const storedTheme = localStorage.getItem('theme')

        // Get the preferred theme from the user's OS
        const getPreferredTheme = () => {
            if (storedTheme) {
                return storedTheme
            }

            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
        }

        // Set the bootstrap theme
        const setTheme = function (theme) {
            document.documentElement.setAttribute('data-bs-theme', theme)
            if (theme === 'dark') {
                document.getElementById('dark-mode-toggle').setAttribute('checked', true)
                document.getElementById('dark-mode-icon').classList.replace('bi-brightness-high-fill', 'bi-brightness-low')
            } else {
                document.getElementById('dark-mode-toggle').setAttribute('checked', false)
                document.getElementById('dark-mode-icon').classList.replace('bi-brightness-low', 'bi-brightness-high-fill')
            }
        }

        // Returns true if the current theme is dark
        const isDark = () => {
            return document.documentElement.getAttribute('data-bs-theme') === 'dark'
        }

        // Toggles dark mode
        const toggleDarkMode = () => {
            const newTheme = isDark() ? 'light' : 'dark'
            setTheme(newTheme)
            localStorage.setItem('theme', newTheme)
        }

        // Set the preferred theme on page load
        window.onload = () => {
            // Set preferred theme
            setTheme(getPreferredTheme());
            // Initialize tooltips
            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
            const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
        }

        // Toggle dark mode when the toggle button is clicked
        addEventListener("click", (event) => {
            if (event.target.id === 'dark-mode-toggle') {
                toggleDarkMode();
                // De-focus the toggle
                document.activeElement.blur()
            }
        });
    </script>
</body>
</html>
