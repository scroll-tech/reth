<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">

    <title>scroll-reth - reth fork diff overview</title>

    <link rel="icon" type="image/x-icon" href="">

    <style>
        .line-stat {
            width: 14rem;
            float: right;
        }
        .line-stat div {
            width: 50%;
        }
        .text-add-ignored {
            color: #93ad93;
            font-style: italic;
        }
        .text-delete-ignored {
            color: #c47777;
            font-style: italic;
        }
        .toplevelstat {
            margin-left: 0 !important;
            width: 15rem;
        }
    </style>

    
<style>
    .term-container {
        background: #171717;
        border-radius: 5px;
        color: white;
        word-break: break-word;
        overflow-wrap: break-word;
        font-family: "SFMono-Regular", Monaco, Menlo, Consolas, "Liberation Mono", Courier, monospace;
        font-size: 12px;
        line-height: 20px;
        padding: 14px 18px;
        white-space: pre-wrap;
    }

    .term-container img { max-width: 100%; }

    .term a { color: inherit; text-decoration: underline; text-decoration-style: dashed; }
    .term a:hover { color: #2882F9 }

    @keyframes blink-animation {
        to {
            visibility: hidden;
        }
    }

    .term-fg1 { } /* don't bold beccause it looks weird */
    .term-fg2 { color: #838887; } /* faint (decreased intensity) - same as gray really */
    .term-fg3 { font-style: italic; } /* italic */
    .term-fg4 { text-decoration: underline; } /* underline */
    .term-fg5 { animation: blink-animation 1s steps(3, start) infinite; } /* blink */
    .term-fg9 { text-decoration: line-through; } /* crossed-out */

    .term-fg30 { color: #666666; } /* black (but we can't use black, so a diff color) */
    .term-fg31 { color: #ff7070; } /* red */
    .term-fg32 { color: #b0f986; } /* green */
    .term-fg33 { color: #c6c502; } /* yellow */
    .term-fg34 { color: #8db7e0; } /* blue */
    .term-fg35 { color: #f271fb; } /* magenta */
    .term-fg36 { color: #6bf7ff; } /* cyan */

    /* high intense colors */
    .term-fgi1 { color: #5ef765; }
    .term-fgi90 { color: #838887; } /* grey */
    .term-fgi91 { color: #ff3333; } /* red */
    .term-fgi92 { color: #00FF00; } /* green */
    .term-fgi93 { color: #fffc67; } /* yellow */
    .term-fgi94 { color: #6871ff; } /* blue */
    .term-fgi95 { color: #ff76ff; } /* magenta */
    .term-fgi96 { color: #60fcff; } /* cyan */

    /* background colors */
    .term-bg40 { background: #676767; } /* grey */
    .term-bg41 { background: #ff4343; } /* red */
    .term-bg42 { background: #99ff5f; } /* green */

    /* custom foreground/background combos for readability */
    .term-fg31.term-bg40 { color: #F8A39F; }

    /* xterm colors */
    .term-fgx16 { color: #000000; }
    .term-fgx17 { color: #00005f; }
    .term-fgx18 { color: #000087; }
    .term-fgx19 { color: #0000af; }
    .term-fgx20 { color: #0000d7; }
    .term-fgx21 { color: #0000ff; }
    .term-fgx22 { color: #005f00; }
    .term-fgx23 { color: #005f5f; }
    .term-fgx24 { color: #005f87; }
    .term-fgx25 { color: #005faf; }
    .term-fgx26 { color: #005fd7; }
    .term-fgx27 { color: #005fff; }
    .term-fgx28 { color: #008700; }
    .term-fgx29 { color: #00875f; }
    .term-fgx30 { color: #008787; }
    .term-fgx31 { color: #0087af; }
    .term-fgx32 { color: #0087d7; }
    .term-fgx33 { color: #0087ff; }
    .term-fgx34 { color: #00af00; }
    .term-fgx35 { color: #00af5f; }
    .term-fgx36 { color: #00af87; }
    .term-fgx37 { color: #00afaf; }
    .term-fgx38 { color: #00afd7; }
    .term-fgx39 { color: #00afff; }
    .term-fgx40 { color: #00d700; }
    .term-fgx41 { color: #00d75f; }
    .term-fgx42 { color: #00d787; }
    .term-fgx43 { color: #00d7af; }
    .term-fgx44 { color: #00d7d7; }
    .term-fgx45 { color: #00d7ff; }
    .term-fgx46 { color: #00ff00; }
    .term-fgx47 { color: #00ff5f; }
    .term-fgx48 { color: #00ff87; }
    .term-fgx49 { color: #00ffaf; }
    .term-fgx50 { color: #00ffd7; }
    .term-fgx51 { color: #00ffff; }
    .term-fgx52 { color: #5f0000; }
    .term-fgx53 { color: #5f005f; }
    .term-fgx54 { color: #5f0087; }
    .term-fgx55 { color: #5f00af; }
    .term-fgx56 { color: #5f00d7; }
    .term-fgx57 { color: #5f00ff; }
    .term-fgx58 { color: #5f5f00; }
    .term-fgx59 { color: #5f5f5f; }
    .term-fgx60 { color: #5f5f87; }
    .term-fgx61 { color: #5f5faf; }
    .term-fgx62 { color: #5f5fd7; }
    .term-fgx63 { color: #5f5fff; }
    .term-fgx64 { color: #5f8700; }
    .term-fgx65 { color: #5f875f; }
    .term-fgx66 { color: #5f8787; }
    .term-fgx67 { color: #5f87af; }
    .term-fgx68 { color: #5f87d7; }
    .term-fgx69 { color: #5f87ff; }
    .term-fgx70 { color: #5faf00; }
    .term-fgx71 { color: #5faf5f; }
    .term-fgx72 { color: #5faf87; }
    .term-fgx73 { color: #5fafaf; }
    .term-fgx74 { color: #5fafd7; }
    .term-fgx75 { color: #5fafff; }
    .term-fgx76 { color: #5fd700; }
    .term-fgx77 { color: #5fd75f; }
    .term-fgx78 { color: #5fd787; }
    .term-fgx79 { color: #5fd7af; }
    .term-fgx80 { color: #5fd7d7; }
    .term-fgx81 { color: #5fd7ff; }
    .term-fgx82 { color: #5fff00; }
    .term-fgx83 { color: #5fff5f; }
    .term-fgx84 { color: #5fff87; }
    .term-fgx85 { color: #5fffaf; }
    .term-fgx86 { color: #5fffd7; }
    .term-fgx87 { color: #5fffff; }
    .term-fgx88 { color: #870000; }
    .term-fgx89 { color: #87005f; }
    .term-fgx90 { color: #870087; }
    .term-fgx91 { color: #8700af; }
    .term-fgx92 { color: #8700d7; }
    .term-fgx93 { color: #8700ff; }
    .term-fgx94 { color: #875f00; }
    .term-fgx95 { color: #875f5f; }
    .term-fgx96 { color: #875f87; }
    .term-fgx97 { color: #875faf; }
    .term-fgx98 { color: #875fd7; }
    .term-fgx99 { color: #875fff; }
    .term-fgx100 { color: #878700; }
    .term-fgx101 { color: #87875f; }
    .term-fgx102 { color: #878787; }
    .term-fgx103 { color: #8787af; }
    .term-fgx104 { color: #8787d7; }
    .term-fgx105 { color: #8787ff; }
    .term-fgx106 { color: #87af00; }
    .term-fgx107 { color: #87af5f; }
    .term-fgx108 { color: #87af87; }
    .term-fgx109 { color: #87afaf; }
    .term-fgx110 { color: #87afd7; }
    .term-fgx111 { color: #87afff; }
    .term-fgx112 { color: #87d700; }
    .term-fgx113 { color: #87d75f; }
    .term-fgx114 { color: #87d787; }
    .term-fgx115 { color: #87d7af; }
    .term-fgx116 { color: #87d7d7; }
    .term-fgx117 { color: #87d7ff; }
    .term-fgx118 { color: #87ff00; }
    .term-fgx119 { color: #87ff5f; }
    .term-fgx120 { color: #87ff87; }
    .term-fgx121 { color: #87ffaf; }
    .term-fgx122 { color: #87ffd7; }
    .term-fgx123 { color: #87ffff; }
    .term-fgx124 { color: #af0000; }
    .term-fgx125 { color: #af005f; }
    .term-fgx126 { color: #af0087; }
    .term-fgx127 { color: #af00af; }
    .term-fgx128 { color: #af00d7; }
    .term-fgx129 { color: #af00ff; }
    .term-fgx130 { color: #af5f00; }
    .term-fgx131 { color: #af5f5f; }
    .term-fgx132 { color: #af5f87; }
    .term-fgx133 { color: #af5faf; }
    .term-fgx134 { color: #af5fd7; }
    .term-fgx135 { color: #af5fff; }
    .term-fgx136 { color: #af8700; }
    .term-fgx137 { color: #af875f; }
    .term-fgx138 { color: #af8787; }
    .term-fgx139 { color: #af87af; }
    .term-fgx140 { color: #af87d7; }
    .term-fgx141 { color: #af87ff; }
    .term-fgx142 { color: #afaf00; }
    .term-fgx143 { color: #afaf5f; }
    .term-fgx144 { color: #afaf87; }
    .term-fgx145 { color: #afafaf; }
    .term-fgx146 { color: #afafd7; }
    .term-fgx147 { color: #afafff; }
    .term-fgx148 { color: #afd700; }
    .term-fgx149 { color: #afd75f; }
    .term-fgx150 { color: #afd787; }
    .term-fgx151 { color: #afd7af; }
    .term-fgx152 { color: #afd7d7; }
    .term-fgx153 { color: #afd7ff; }
    .term-fgx154 { color: #afff00; }
    .term-fgx155 { color: #afff5f; }
    .term-fgx156 { color: #afff87; }
    .term-fgx157 { color: #afffaf; }
    .term-fgx158 { color: #afffd7; }
    .term-fgx159 { color: #afffff; }
    .term-fgx160 { color: #d70000; }
    .term-fgx161 { color: #d7005f; }
    .term-fgx162 { color: #d70087; }
    .term-fgx163 { color: #d700af; }
    .term-fgx164 { color: #d700d7; }
    .term-fgx165 { color: #d700ff; }
    .term-fgx166 { color: #d75f00; }
    .term-fgx167 { color: #d75f5f; }
    .term-fgx168 { color: #d75f87; }
    .term-fgx169 { color: #d75faf; }
    .term-fgx170 { color: #d75fd7; }
    .term-fgx171 { color: #d75fff; }
    .term-fgx172 { color: #d78700; }
    .term-fgx173 { color: #d7875f; }
    .term-fgx174 { color: #d78787; }
    .term-fgx175 { color: #d787af; }
    .term-fgx176 { color: #d787d7; }
    .term-fgx177 { color: #d787ff; }
    .term-fgx178 { color: #d7af00; }
    .term-fgx179 { color: #d7af5f; }
    .term-fgx180 { color: #d7af87; }
    .term-fgx181 { color: #d7afaf; }
    .term-fgx182 { color: #d7afd7; }
    .term-fgx183 { color: #d7afff; }
    .term-fgx184 { color: #d7d700; }
    .term-fgx185 { color: #d7d75f; }
    .term-fgx186 { color: #d7d787; }
    .term-fgx187 { color: #d7d7af; }
    .term-fgx188 { color: #d7d7d7; }
    .term-fgx189 { color: #d7d7ff; }
    .term-fgx190 { color: #d7ff00; }
    .term-fgx191 { color: #d7ff5f; }
    .term-fgx192 { color: #d7ff87; }
    .term-fgx193 { color: #d7ffaf; }
    .term-fgx194 { color: #d7ffd7; }
    .term-fgx195 { color: #d7ffff; }
    .term-fgx196 { color: #ff0000; }
    .term-fgx197 { color: #ff005f; }
    .term-fgx198 { color: #ff0087; }
    .term-fgx199 { color: #ff00af; }
    .term-fgx200 { color: #ff00d7; }
    .term-fgx201 { color: #ff00ff; }
    .term-fgx202 { color: #ff5f00; }
    .term-fgx203 { color: #ff5f5f; }
    .term-fgx204 { color: #ff5f87; }
    .term-fgx205 { color: #ff5faf; }
    .term-fgx206 { color: #ff5fd7; }
    .term-fgx207 { color: #ff5fff; }
    .term-fgx208 { color: #ff8700; }
    .term-fgx209 { color: #ff875f; }
    .term-fgx210 { color: #ff8787; }
    .term-fgx211 { color: #ff87af; }
    .term-fgx212 { color: #ff87d7; }
    .term-fgx213 { color: #ff87ff; }
    .term-fgx214 { color: #ffaf00; }
    .term-fgx215 { color: #ffaf5f; }
    .term-fgx216 { color: #ffaf87; }
    .term-fgx217 { color: #ffafaf; }
    .term-fgx218 { color: #ffafd7; }
    .term-fgx219 { color: #ffafff; }
    .term-fgx220 { color: #ffd700; }
    .term-fgx221 { color: #ffd75f; }
    .term-fgx222 { color: #ffd787; }
    .term-fgx223 { color: #ffd7af; }
    .term-fgx224 { color: #ffd7d7; }
    .term-fgx225 { color: #ffd7ff; }
    .term-fgx226 { color: #ffff00; }
    .term-fgx227 { color: #ffff5f; }
    .term-fgx228 { color: #ffff87; }
    .term-fgx229 { color: #ffffaf; }
    .term-fgx230 { color: #ffffd7; }
    .term-fgx231 { color: #ffffff; }
    .term-fgx232 { color: #080808; }
    .term-fgx233 { color: #121212; }
    .term-fgx234 { color: #1c1c1c; }
    .term-fgx235 { color: #262626; }
    .term-fgx236 { color: #303030; }
    .term-fgx237 { color: #3a3a3a; }
    .term-fgx238 { color: #444444; }
    .term-fgx239 { color: #4e4e4e; }
    .term-fgx240 { color: #585858; }
    .term-fgx241 { color: #626262; }
    .term-fgx242 { color: #6c6c6c; }
    .term-fgx243 { color: #767676; }
    .term-fgx244 { color: #808080; }
    .term-fgx245 { color: #8a8a8a; }
    .term-fgx246 { color: #949494; }
    .term-fgx247 { color: #9e9e9e; }
    .term-fgx248 { color: #a8a8a8; }
    .term-fgx249 { color: #b2b2b2; }
    .term-fgx250 { color: #bcbcbc; }
    .term-fgx251 { color: #c6c6c6; }
    .term-fgx252 { color: #d0d0d0; }
    .term-fgx253 { color: #dadada; }
    .term-fgx254 { color: #e4e4e4; }
    .term-fgx255 { color: #eeeeee; }
</style>

</head>
<body>
    <div class="col-xl-10 col-xxl-8 mx-auto px-3 py-1 py-md-3">
        <main class="container-fluid">
            <div class="row">
                <div>
                    <div class="float-end">
                        <div class="form-check form-switch">
                            <i class="bi bi-brightness-low" id="dark-mode-icon"></i>
                            <input class="form-check-input" type="checkbox" role="switch" id="dark-mode-toggle" data-bs-toggle="tooltip"
                                   data-bs-placement="bottom" data-bs-title="Toggle Dark Mode"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"role="button" aria-expanded="true" aria-controls="id-c0766c507fdb980d70e9ac5a">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h1>scroll-reth</h1></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                    <span class="text-end">diff:</span>
                
                
                    <span class="text-end">ignored:</span>
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 toplevelstat">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+12422</span></div>
                    <div class="text-start"><span class="text-danger">-1145</span></div>
                
                
                    <div class="text-end"><span class="text-add-ignored">+138</span></div>
                    <div class="text-start"><span class="text-delete-ignored">-47</span></div>
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse show border-1 ps-3 my-3" id="id-c0766c507fdb980d70e9ac5a">
        <div><p>This is an overview of the changes in <a href="https://github.com/scroll-tech/reth"><code>scroll-reth</code></a>,
a fork of <a href="https://github.com/paradigmxyz/reth"><code>reth</code></a>.</p>
</div>
        <div>
            
            
        </div>
        <div>
            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-5941480ba974a9f1633c02af"role="button" aria-expanded="false" aria-controls="id-5941480ba974a9f1633c02af">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/scroll</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+8765</span></div>
                    <div class="text-start"><span class="text-danger">-0</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-5941480ba974a9f1633c02af">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c10a89ada9b29c6b53b06f8d" role="button"
                       aria-expanded="false" aria-controls="id-c10a89ada9b29c6b53b06f8d">
                        <code>crates/scroll/bin/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/bin/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+40</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c10a89ada9b29c6b53b06f8d"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;bin&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;bin&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..1876280bf0cac01866f0c5ce30cfb44c35cd44b6</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;bin&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,41 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;scroll-reth&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-cli-util.workspace = true</span>
<span class="term-fg32">+reth-node-builder.workspace = true</span>
<span class="term-fg32">+reth-provider.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-cli.workspace = true</span>
<span class="term-fg32">+reth-scroll-node.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# misc</span>
<span class="term-fg32">+clap = { workspace = true, features = [&quot;derive&quot;, &quot;env&quot;] }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-node-builder&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-cli&#47;scroll&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+optimism = [</span>
<span class="term-fg32">+	&quot;reth-provider&#47;optimism&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-cli&#47;optimism&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-node&#47;optimism&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[bin]]</span>
<span class="term-fg32">+name = &quot;scroll-reth&quot;</span>
<span class="term-fg32">+path = &quot;src&#47;main.rs&quot;</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-31fb94a68daa3c9f04ffee43" role="button"
                       aria-expanded="false" aria-controls="id-31fb94a68daa3c9f04ffee43">
                        <code>crates/scroll/bin/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/bin/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+46</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-31fb94a68daa3c9f04ffee43"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;bin&#47;src&#47;main.rs scroll-reth&#47;crates&#47;scroll&#47;bin&#47;src&#47;main.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..627e8a540a594e905a6960b276246b9960a4f1d8</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;bin&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -0,0 +1,46 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll binary</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use clap::Parser;</span>
<span class="term-fg32">+use reth_node_builder::{engine_tree_config::TreeConfig, EngineNodeLauncher, Node};</span>
<span class="term-fg32">+use reth_provider::providers::BlockchainProvider2;</span>
<span class="term-fg32">+use reth_scroll_cli::{Cli, ScrollChainSpecParser, ScrollRollupArgs};</span>
<span class="term-fg32">+use reth_scroll_node::{ScrollAddOns, ScrollNode};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[global_allocator]</span>
<span class="term-fg32">+static ALLOC: reth_cli_util::allocator::Allocator = reth_cli_util::allocator::new_allocator();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+fn main() {</span>
<span class="term-fg32">+    reth_cli_util::sigsegv_handler::install();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47; Enable backtraces unless a RUST_BACKTRACE value has already been explicitly provided.</span>
<span class="term-fg32">+    if std::env::var_os(&quot;RUST_BACKTRACE&quot;).is_none() {</span>
<span class="term-fg32">+        std::env::set_var(&quot;RUST_BACKTRACE&quot;, &quot;1&quot;);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    if let Err(err) = Cli::&lt;ScrollChainSpecParser, ScrollRollupArgs&gt;::parse().run(</span>
<span class="term-fg32">+        |builder, rollup_args| async move {</span>
<span class="term-fg32">+            let engine_tree_config = TreeConfig::default()</span>
<span class="term-fg32">+                .with_persistence_threshold(rollup_args.persistence_threshold)</span>
<span class="term-fg32">+                .with_memory_block_buffer_target(rollup_args.memory_block_buffer_target);</span>
<span class="term-fg32">+            let handle = builder</span>
<span class="term-fg32">+                .with_types_and_provider::&lt;ScrollNode, BlockchainProvider2&lt;_&gt;&gt;()</span>
<span class="term-fg32">+                .with_components(ScrollNode.components_builder())</span>
<span class="term-fg32">+                .with_add_ons(ScrollAddOns::default())</span>
<span class="term-fg32">+                .launch_with_fn(|builder| {</span>
<span class="term-fg32">+                    let launcher = EngineNodeLauncher::new(</span>
<span class="term-fg32">+                        builder.task_executor().clone(),</span>
<span class="term-fg32">+                        builder.config().datadir(),</span>
<span class="term-fg32">+                        engine_tree_config,</span>
<span class="term-fg32">+                    );</span>
<span class="term-fg32">+                    builder.launch_with(launcher)</span>
<span class="term-fg32">+                })</span>
<span class="term-fg32">+                .await?;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            handle.node_exit_future.await</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+    ) {</span>
<span class="term-fg32">+        eprintln!(&quot;Error: {err:?}&quot;);</span>
<span class="term-fg32">+        std::process::exit(1);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-21464ea5790955bb0fa902d9" role="button"
                       aria-expanded="false" aria-controls="id-21464ea5790955bb0fa902d9">
                        <code>crates/scroll/chainspec/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/chainspec/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+60</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-21464ea5790955bb0fa902d9"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;chainspec&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..967cc98f1517d4b3de4381d519a74bd4678f1682</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,60 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-chainspec&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+description = &quot;EVM chain spec implementation for scroll.&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-chainspec.workspace = true</span>
<span class="term-fg32">+reth-ethereum-forks.workspace = true</span>
<span class="term-fg32">+reth-primitives-traits.workspace = true</span>
<span class="term-fg32">+reth-network-peers.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-forks.workspace = true</span>
<span class="term-fg32">+reth-scroll-state-commitment.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# ethereum</span>
<span class="term-fg32">+alloy-chains.workspace = true</span>
<span class="term-fg32">+alloy-genesis.workspace = true</span>
<span class="term-fg32">+alloy-primitives.workspace = true</span>
<span class="term-fg32">+alloy-consensus.workspace = true</span>
<span class="term-fg32">+alloy-eips.workspace = true</span>
<span class="term-fg32">+alloy-serde.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# io</span>
<span class="term-fg32">+serde_json.workspace = true</span>
<span class="term-fg32">+serde = { workspace = true, features = [&quot;derive&quot;] }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# misc</span>
<span class="term-fg32">+derive_more.workspace = true</span>
<span class="term-fg32">+once_cell.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dev-dependencies]</span>
<span class="term-fg32">+alloy-genesis.workspace = true</span>
<span class="term-fg32">+reth-chainspec = { workspace = true, features = [&quot;test-utils&quot;] }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+default = [&quot;std&quot;]</span>
<span class="term-fg32">+std = [</span>
<span class="term-fg32">+    &quot;alloy-chains&#47;std&quot;,</span>
<span class="term-fg32">+    &quot;alloy-genesis&#47;std&quot;,</span>
<span class="term-fg32">+    &quot;alloy-primitives&#47;std&quot;,</span>
<span class="term-fg32">+    &quot;alloy-eips&#47;std&quot;,</span>
<span class="term-fg32">+    &quot;alloy-serde&#47;std&quot;,</span>
<span class="term-fg32">+    &quot;reth-chainspec&#47;std&quot;,</span>
<span class="term-fg32">+    &quot;reth-ethereum-forks&#47;std&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives-traits&#47;std&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-forks&#47;std&quot;,</span>
<span class="term-fg32">+    &quot;alloy-consensus&#47;std&quot;,</span>
<span class="term-fg32">+    &quot;once_cell&#47;std&quot;,</span>
<span class="term-fg32">+    &quot;serde&#47;std&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f245c45bae4145dfbaf4bfe5" role="button"
                       aria-expanded="false" aria-controls="id-f245c45bae4145dfbaf4bfe5">
                        <code>crates/scroll/chainspec/res/genesis/dev.json</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/chainspec/res/genesis/dev.json" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f245c45bae4145dfbaf4bfe5"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;chainspec&#47;res&#47;genesis&#47;dev.json scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;res&#47;genesis&#47;dev.json</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..be72d7e96db2883e9a0ad9062182d88ae9d4135a</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;res&#47;genesis&#47;dev.json</span>
<span class="term-fg36">@@ -0,0 +1 @@</span>
<span class="term-fg32">+{&quot;nonce&quot;:&quot;0x0&quot;,&quot;timestamp&quot;:&quot;0x6490fdd2&quot;,&quot;extraData&quot;:&quot;0x&quot;,&quot;gasLimit&quot;:&quot;0x1c9c380&quot;,&quot;difficulty&quot;:&quot;0x0&quot;,&quot;mixHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;coinbase&quot;:&quot;0x0000000000000000000000000000000000000000&quot;,&quot;stateRoot&quot;:&quot;0x5eb6e371a698b8d68f665192350ffcecbbbf322916f4b51bd79bb6887da3f494&quot;,&quot;alloc&quot;:{&quot;0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0x70997970C51812dc3A010C7d01b50e0d17dc79C8&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0x90F79bf6EB2c4f870365E785982E1f101E93b906&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0x976EA74026E726554dB657fA54763abd0C3a0aa9&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0x14dC79964da2C08b23698B3D3cc7Ca32193d9955&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0xa0Ee7A142d267C1f36714E4a8F75612F20a79720&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0xBcd4042DE499D14e55001CcbB24a551F3b954096&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0x71bE63f3384f5fb98995898A86B02Fb2426c5788&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0xFABB0ac9d68B0B445fB7357272Ff202C5651694a&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0x1CBd3b2770909D4e10f157cABC84C7264073C9Ec&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0xdF3e18d64BC6A983f673Ab319CCaE4f1a57C7097&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0xcd3B766CCDd6AE721141F452C550Ca635964ce71&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0x2546BcD3c84621e976D8185a91A922aE77ECEc30&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0xbDA5747bFD65F08deb54cb465eB87D40e51B197E&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0xdD2FD4581271e230360230F9337D5c0430Bf44C0&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;},&quot;0x8626f6940E2eb28930eFb4CeF49B2d1F2C9C1199&quot;:{&quot;balance&quot;:&quot;0xD3C21BCECCEDA1000000&quot;}},&quot;number&quot;:&quot;0x0&quot;,&quot;gasUsed&quot;:&quot;0x0&quot;,&quot;parentHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-81bc3553b8ecbf287d9b82e8" role="button"
                       aria-expanded="false" aria-controls="id-81bc3553b8ecbf287d9b82e8">
                        <code>crates/scroll/chainspec/res/genesis/scroll.json</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/chainspec/res/genesis/scroll.json" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-81bc3553b8ecbf287d9b82e8"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;chainspec&#47;res&#47;genesis&#47;scroll.json scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;res&#47;genesis&#47;scroll.json</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..ef6360ac9d90367c5029a8f6858c062a88866cef</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;res&#47;genesis&#47;scroll.json</span>
<span class="term-fg36">@@ -0,0 +1 @@</span>
<span class="term-fg32">+{&quot;config&quot;:{&quot;chainId&quot;:534352,&quot;homesteadBlock&quot;:0,&quot;eip150Block&quot;:0,&quot;eip150Hash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;eip155Block&quot;:0,&quot;eip158Block&quot;:0,&quot;byzantiumBlock&quot;:0,&quot;constantinopleBlock&quot;:0,&quot;petersburgBlock&quot;:0,&quot;istanbulBlock&quot;:0,&quot;berlinBlock&quot;:0,&quot;londonBlock&quot;:0,&quot;archimedesBlock&quot;:0,&quot;shanghaiTime&quot;:0,&quot;bernoulliBlock&quot;:5220340,&quot;curieBlock&quot;:7096836,&quot;darwinTime&quot;:1724227200,&quot;darwinV2Time&quot;:1725264000,&quot;clique&quot;:{&quot;period&quot;:3,&quot;epoch&quot;:30000,&quot;relaxed_period&quot;:true},&quot;scroll&quot;:{&quot;useZktrie&quot;:true,&quot;maxTxPerBlock&quot;:100,&quot;maxTxPayloadBytesPerBlock&quot;:122880,&quot;feeVaultAddress&quot;:&quot;0x5300000000000000000000000000000000000005&quot;,&quot;l1Config&quot;:{&quot;l1ChainId&quot;:&quot;1&quot;,&quot;l1MessageQueueAddress&quot;:&quot;0x0d7E906BD9cAFa154b048cFa766Cc1E54E39AF9B&quot;,&quot;scrollChainAddress&quot;:&quot;0xa13BAF47339d63B743e7Da8741db5456DAc1E556&quot;,&quot;numL1MessagesPerBlock&quot;:&quot;10&quot;}}},&quot;nonce&quot;:&quot;0x0&quot;,&quot;timestamp&quot;:&quot;0x6524e860&quot;,&quot;extraData&quot;:&quot;0x4c61206573746f6e7465636f206573746173206d616c6665726d6974612e0000d2ACF5d16a983DB0d909d9D761B8337Fabd6cBd10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;gasLimit&quot;:&quot;10000000&quot;,&quot;difficulty&quot;:&quot;0x1&quot;,&quot;mixHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;coinbase&quot;:&quot;0x0000000000000000000000000000000000000000&quot;,&quot;alloc&quot;:{&quot;0xF9062b8a30e0d7722960e305049FA50b86ba6253&quot;:{&quot;balance&quot;:&quot;2000000000000000000&quot;},&quot;0x781e90f1c8Fc4611c9b7497C3B47F99Ef6969CbC&quot;:{&quot;balance&quot;:&quot;226156424291633194186662080095093570025917938800079226637565593765455331328&quot;},&quot;0x5300000000000000000000000000000000000000&quot;:{&quot;balance&quot;:&quot;0x0&quot;,&quot;code&quot;:&quot;0x608060405234801561001057600080fd5b50600436106100935760003560e01c806383cc76601161006657806383cc7660146100fc5780638da5cb5b1461010f578063c4d66de814610122578063d4b9f4fa14610135578063f2fde38b1461013e57600080fd5b806326aad7b7146100985780633cb747bf146100b4578063600a2e77146100df578063715018a6146100f2575b600080fd5b6100a160015481565b6040519081526020015b60405180910390f35b6053546100c7906001600160a01b031681565b6040516001600160a01b0390911681526020016100ab565b6100a16100ed36600461054a565b610151565b6100fa6101f6565b005b6100a161010a36600461054a565b61022c565b6052546100c7906001600160a01b031681565b6100fa610130366004610563565b610243565b6100a160005481565b6100fa61014c366004610563565b6102db565b6053546000906001600160a01b031633146101a45760405162461bcd60e51b815260206004820152600e60248201526d37b7363c9036b2b9b9b2b733b2b960911b60448201526064015b60405180910390fd5b6000806101b084610367565b60408051838152602081018890529294509092507ffaa617c2d8ce12c62637dbce76efcc18dae60574aa95709bdcedce7e76071693910160405180910390a19392505050565b6052546001600160a01b031633146102205760405162461bcd60e51b815260040161019b90610593565b61022a6000610486565b565b602a816028811061023c57600080fd5b0154905081565b6052546001600160a01b0316331461026d5760405162461bcd60e51b815260040161019b90610593565b600154156102b15760405162461bcd60e51b815260206004820152601160248201527063616e6e6f7420696e697469616c697a6560781b604482015260640161019b565b6102b96104d8565b605380546001600160a01b0319166001600160a01b0392909216919091179055565b6052546001600160a01b031633146103055760405162461bcd60e51b815260040161019b90610593565b6001600160a01b03811661035b5760405162461bcd60e51b815260206004820152601d60248201527f6e6577206f776e657220697320746865207a65726f2061646472657373000000604482015260640161019b565b61036481610486565b50565b60035460009081906103bb5760405162461bcd60e51b815260206004820152601a60248201527f63616c6c206265666f726520696e697469616c697a6174696f6e000000000000604482015260640161019b565b6001548360005b8215610456576103d36002846105e0565b60000361041f5781602a82602881106103ee576103ee6105ca565b01556104188260028360288110610407576104076105ca565b015460009182526020526040902090565b915061044a565b610447602a8260288110610435576104356105ca565b01548360009182526020526040902090565b91505b600192831c92016103c2565b81602a826028811061046a5761046a6105ca565b0155506000819055600180548082019091559590945092505050565b605280546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b60005b60286104e8826001610618565b10156103645761051960028260288110610504576105046105ca565b015460028360288110610407576104076105ca565b6002610526836001610618565b60288110610536576105366105ca565b01558061054281610631565b9150506104db565b60006020828403121561055c57600080fd5b5035919050565b60006020828403121561057557600080fd5b81356001600160a01b038116811461058c57600080fd5b9392505050565b60208082526017908201527f63616c6c6572206973206e6f7420746865206f776e6572000000000000000000604082015260600190565b634e487b7160e01b600052603260045260246000fd5b6000826105fd57634e487b7160e01b600052601260045260246000fd5b500690565b634e487b7160e01b600052601160045260246000fd5b8082018082111561062b5761062b610602565b92915050565b60006001820161064357610643610602565b506001019056fea26469706673582212208fb1cb9933bb17dd0a7c17de7c890919b08d2fd7eb2bede7b41caa32709b30b564736f6c63430008100033&quot;,&quot;storage&quot;:{&quot;0x0000000000000000000000000000000000000000000000000000000000000052&quot;:&quot;0xF9062b8a30e0d7722960e305049FA50b86ba6253&quot;}},&quot;0x5300000000000000000000000000000000000002&quot;:{&quot;balance&quot;:&quot;0x0&quot;,&quot;code&quot;:&quot;0x608060405234801561001057600080fd5b50600436106100cf5760003560e01c8063715018a61161008c578063bede39b511610066578063bede39b51461018d578063de26c4a1146101a0578063f2fde38b146101b3578063f45e65d8146101c657600080fd5b8063715018a6146101475780638da5cb5b1461014f57806393e59dc11461017a57600080fd5b80630c18c162146100d45780633577afc5146100f05780633d0f963e1461010557806349948e0e14610118578063519b4bd31461012b5780637046559714610134575b600080fd5b6100dd60025481565b6040519081526020015b60405180910390f35b6101036100fe366004610671565b6101cf565b005b61010361011336600461068a565b610291565b6100dd6101263660046106d0565b61031c565b6100dd60015481565b610103610142366004610671565b610361565b610103610416565b600054610162906001600160a01b031681565b6040516001600160a01b0390911681526020016100e7565b600454610162906001600160a01b031681565b61010361019b366004610671565b61044c565b6100dd6101ae3660046106d0565b610533565b6101036101c136600461068a565b610595565b6100dd60035481565b6000546001600160a01b031633146102025760405162461bcd60e51b81526004016101f990610781565b60405180910390fd5b621c9c388111156102555760405162461bcd60e51b815260206004820152601760248201527f657863656564206d6178696d756d206f7665726865616400000000000000000060448201526064016101f9565b60028190556040518181527f32740b35c0ea213650f60d44366b4fb211c9033b50714e4a1d34e65d5beb9bb4906020015b60405180910390a150565b6000546001600160a01b031633146102bb5760405162461bcd60e51b81526004016101f990610781565b600480546001600160a01b038381166001600160a01b031983168117909355604080519190921680825260208201939093527f22d1c35fe072d2e42c3c8f9bd4a0d34aa84a0101d020a62517b33fdb3174e5f7910160405180910390a15050565b60008061032883610533565b905060006001548261033a91906107b8565b9050633b9aca006003548261034f91906107b8565b61035991906107e5565b949350505050565b6000546001600160a01b0316331461038b5760405162461bcd60e51b81526004016101f990610781565b61039b633b9aca006103e86107b8565b8111156103e15760405162461bcd60e51b8152602060048201526014602482015273657863656564206d6178696d756d207363616c6560601b60448201526064016101f9565b60038190556040518181527f3336cd9708eaf2769a0f0dc0679f30e80f15dcd88d1921b5a16858e8b85c591a90602001610286565b6000546001600160a01b031633146104405760405162461bcd60e51b81526004016101f990610781565b61044a6000610621565b565b6004805460405163efc7840160e01b815233928101929092526001600160a01b03169063efc7840190602401602060405180830381865afa158015610495573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906104b99190610807565b6104fe5760405162461bcd60e51b81526020600482015260166024820152752737ba103bb434ba32b634b9ba32b21039b2b73232b960511b60448201526064016101f9565b60018190556040518181527f351fb23757bb5ea0546c85b7996ddd7155f96b939ebaa5ff7bc49c75f27f2c4490602001610286565b80516000908190815b818110156105865784818151811061055657610556610829565b01602001516001600160f81b0319166000036105775760048301925061057e565b6010830192505b60010161053c565b50506002540160400192915050565b6000546001600160a01b031633146105bf5760405162461bcd60e51b81526004016101f990610781565b6001600160a01b0381166106155760405162461bcd60e51b815260206004820152601d60248201527f6e6577206f776e657220697320746865207a65726f206164647265737300000060448201526064016101f9565b61061e81610621565b50565b600080546001600160a01b038381166001600160a01b0319831681178455604051919092169283917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e09190a35050565b60006020828403121561068357600080fd5b5035919050565b60006020828403121561069c57600080fd5b81356001600160a01b03811681146106b357600080fd5b9392505050565b634e487b7160e01b600052604160045260246000fd5b6000602082840312156106e257600080fd5b813567ffffffffffffffff808211156106fa57600080fd5b818401915084601f83011261070e57600080fd5b813581811115610720576107206106ba565b604051601f8201601f19908116603f01168101908382118183101715610748576107486106ba565b8160405282815287602084870101111561076157600080fd5b826020860160208301376000928101602001929092525095945050505050565b60208082526017908201527f63616c6c6572206973206e6f7420746865206f776e6572000000000000000000604082015260600190565b60008160001904831182151516156107e057634e487b7160e01b600052601160045260246000fd5b500290565b60008261080257634e487b7160e01b600052601260045260246000fd5b500490565b60006020828403121561081957600080fd5b815180151581146106b357600080fd5b634e487b7160e01b600052603260045260246000fdfea26469706673582212205ea335809638809cf032c794fd966e2439020737b1dcc2218435cb438286efcf64736f6c63430008100033&quot;,&quot;storage&quot;:{&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;:&quot;0xF9062b8a30e0d7722960e305049FA50b86ba6253&quot;}},&quot;0x5300000000000000000000000000000000000003&quot;:{&quot;balance&quot;:&quot;0x0&quot;,&quot;code&quot;:&quot;0x608060405234801561001057600080fd5b50600436106100575760003560e01c8063715018a61461005c57806379586dd7146100665780638da5cb5b14610079578063efc78401146100a9578063f2fde38b146100e5575b600080fd5b6100646100f8565b005b610064610074366004610356565b610137565b60005461008c906001600160a01b031681565b6040516001600160a01b0390911681526020015b60405180910390f35b6100d56100b736600461042d565b6001600160a01b031660009081526001602052604090205460ff1690565b60405190151581526020016100a0565b6100646100f336600461042d565b610238565b6000546001600160a01b0316331461012b5760405162461bcd60e51b81526004016101229061044f565b60405180910390fd5b61013560006102c4565b565b6000546001600160a01b031633146101615760405162461bcd60e51b81526004016101229061044f565b60005b825181101561023357816001600085848151811061018457610184610486565b60200260200101516001600160a01b03166001600160a01b0316815260200190815260200160002060006101000a81548160ff0219169083151502179055508281815181106101d5576101d5610486565b60200260200101516001600160a01b03167f8daaf060c3306c38e068a75c054bf96ecd85a3db1252712c4d93632744c42e0d83604051610219911515815260200190565b60405180910390a28061022b8161049c565b915050610164565b505050565b6000546001600160a01b031633146102625760405162461bcd60e51b81526004016101229061044f565b6001600160a01b0381166102b85760405162461bcd60e51b815260206004820152601d60248201527f6e6577206f776e657220697320746865207a65726f20616464726573730000006044820152606401610122565b6102c1816102c4565b50565b600080546001600160a01b038381166001600160a01b0319831681178455604051919092169283917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e09190a35050565b634e487b7160e01b600052604160045260246000fd5b80356001600160a01b038116811461034157600080fd5b919050565b8035801515811461034157600080fd5b6000806040838503121561036957600080fd5b823567ffffffffffffffff8082111561038157600080fd5b818501915085601f83011261039557600080fd5b81356020828211156103a9576103a9610314565b8160051b604051601f19603f830116810181811086821117156103ce576103ce610314565b6040529283528183019350848101820192898411156103ec57600080fd5b948201945b83861015610411576104028661032a565b855294820194938201936103f1565b96506104209050878201610346565b9450505050509250929050565b60006020828403121561043f57600080fd5b6104488261032a565b9392505050565b60208082526017908201527f63616c6c6572206973206e6f7420746865206f776e6572000000000000000000604082015260600190565b634e487b7160e01b600052603260045260246000fd5b6000600182016104bc57634e487b7160e01b600052601160045260246000fd5b506001019056fea26469706673582212203414b076e92b618bd7c3437159d7bceb2acc3a5c82f51f383465512d9c52e97064736f6c63430008100033&quot;,&quot;storage&quot;:{&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;:&quot;0xF9062b8a30e0d7722960e305049FA50b86ba6253&quot;}},&quot;0x5300000000000000000000000000000000000004&quot;:{&quot;balance&quot;:&quot;0x0&quot;,&quot;code&quot;:&quot;0x6080604052600436106101025760003560e01c806370a0823111610095578063a457c2d711610064578063a457c2d7146102b4578063a9059cbb146102d4578063d0e30db0146102f4578063d505accf146102fc578063dd62ed3e1461031c57600080fd5b806370a08231146102215780637ecebe001461025757806384b0196e1461027757806395d89b411461029f57600080fd5b80632e1a7d4d116100d15780632e1a7d4d146101b0578063313ce567146101d05780633644e515146101ec578063395093511461020157600080fd5b806306fdde0314610116578063095ea7b31461014157806318160ddd1461017157806323b872dd1461019057600080fd5b366101115761010f61033c565b005b600080fd5b34801561012257600080fd5b5061012b61038d565b60405161013891906112fa565b60405180910390f35b34801561014d57600080fd5b5061016161015c366004611330565b61041f565b6040519015158152602001610138565b34801561017d57600080fd5b506002545b604051908152602001610138565b34801561019c57600080fd5b506101616101ab36600461135a565b610439565b3480156101bc57600080fd5b5061010f6101cb366004611396565b61045d565b3480156101dc57600080fd5b5060405160128152602001610138565b3480156101f857600080fd5b5061018261054e565b34801561020d57600080fd5b5061016161021c366004611330565b61055d565b34801561022d57600080fd5b5061018261023c3660046113af565b6001600160a01b031660009081526020819052604090205490565b34801561026357600080fd5b506101826102723660046113af565b61057f565b34801561028357600080fd5b5061028c61059d565b60405161013897969594939291906113ca565b3480156102ab57600080fd5b5061012b610626565b3480156102c057600080fd5b506101616102cf366004611330565b610635565b3480156102e057600080fd5b506101616102ef366004611330565b6106b0565b61010f61033c565b34801561030857600080fd5b5061010f610317366004611460565b6106be565b34801561032857600080fd5b506101826103373660046114d3565b610822565b336103478134610881565b806001600160a01b03167fe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c3460405161038291815260200190565b60405180910390a250565b60606003805461039c90611506565b80601f01602080910402602001604051908101604052809291908181526020018280546103c890611506565b80156104155780601f106103ea57610100808354040283529160200191610415565b820191906000526020600020905b8154815290600101906020018083116103f857829003601f168201915b5050505050905090565b60003361042d818585610940565b60019150505b92915050565b600033610447858285610a65565b610452858585610adf565b506001949350505050565b336104688183610c83565b6000816001600160a01b03168360405160006040518083038185875af1925050503d80600081146104b5576040519150601f19603f3d011682016040523d82523d6000602084013e6104ba565b606091505b50509050806105065760405162461bcd60e51b81526020600482015260136024820152721dda5d1a191c985dc81155120819985a5b1959606a1b60448201526064015b60405180910390fd5b816001600160a01b03167f7fcf532c15f0a6db0bd6d0e038bea71d30d808c7d98cb3bf7268a95bf5081b658460405161054191815260200190565b60405180910390a2505050565b6000610558610db2565b905090565b60003361042d8185856105708383610822565b61057a919061153a565b610940565b6001600160a01b038116600090815260076020526040812054610433565b6000606080828080836105d17f577261707065642045746865720000000000000000000000000000000000000d6005610edd565b6105fc7f31000000000000000000000000000000000000000000000000000000000000016006610edd565b60408051600080825260208201909252600f60f81b9b939a50919850469750309650945092509050565b60606004805461039c90611506565b600033816106438286610822565b9050838110156106a35760405162461bcd60e51b815260206004820152602560248201527f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f77604482015264207a65726f60d81b60648201526084016104fd565b6104528286868403610940565b60003361042d818585610adf565b8342111561070e5760405162461bcd60e51b815260206004820152601d60248201527f45524332305065726d69743a206578706972656420646561646c696e6500000060448201526064016104fd565b60007f6e71edae12b1b97f4d1f60370fef10105fa2faae0126114a169c64845d6126c988888861073d8c610f81565b6040805160208101969096526001600160a01b0394851690860152929091166060840152608083015260a082015260c0810186905260e001604051602081830303815290604052805190602001209050600061079882610fa9565b905060006107a882878787610fd6565b9050896001600160a01b0316816001600160a01b03161461080b5760405162461bcd60e51b815260206004820152601e60248201527f45524332305065726d69743a20696e76616c6964207369676e6174757265000060448201526064016104fd565b6108168a8a8a610940565b50505050505050505050565b6001600160a01b03918216600090815260016020908152604080832093909416825291909152205490565b60006020835110156108695761086283610ffe565b9050610433565b8161087484826115bf565b5060ff9050610433565b90565b6001600160a01b0382166108d75760405162461bcd60e51b815260206004820152601f60248201527f45524332303a206d696e7420746f20746865207a65726f20616464726573730060448201526064016104fd565b80600260008282546108e9919061153a565b90915550506001600160a01b038216600081815260208181526040808320805486019055518481527fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef910160405180910390a35050565b6001600160a01b0383166109a25760405162461bcd60e51b8152602060048201526024808201527f45524332303a20617070726f76652066726f6d20746865207a65726f206164646044820152637265737360e01b60648201526084016104fd565b6001600160a01b038216610a035760405162461bcd60e51b815260206004820152602260248201527f45524332303a20617070726f766520746f20746865207a65726f206164647265604482015261737360f01b60648201526084016104fd565b6001600160a01b0383811660008181526001602090815260408083209487168084529482529182902085905590518481527f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92591015b60405180910390a3505050565b6000610a718484610822565b90506000198114610ad95781811015610acc5760405162461bcd60e51b815260206004820152601d60248201527f45524332303a20696e73756666696369656e7420616c6c6f77616e636500000060448201526064016104fd565b610ad98484848403610940565b50505050565b6001600160a01b038316610b435760405162461bcd60e51b815260206004820152602560248201527f45524332303a207472616e736665722066726f6d20746865207a65726f206164604482015264647265737360d81b60648201526084016104fd565b6001600160a01b038216610ba55760405162461bcd60e51b815260206004820152602360248201527f45524332303a207472616e7366657220746f20746865207a65726f206164647260448201526265737360e81b60648201526084016104fd565b6001600160a01b03831660009081526020819052604090205481811015610c1d5760405162461bcd60e51b815260206004820152602660248201527f45524332303a207472616e7366657220616d6f756e7420657863656564732062604482015265616c616e636560d01b60648201526084016104fd565b6001600160a01b03848116600081815260208181526040808320878703905593871680835291849020805487019055925185815290927fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef910160405180910390a3610ad9565b6001600160a01b038216610ce35760405162461bcd60e51b815260206004820152602160248201527f45524332303a206275726e2066726f6d20746865207a65726f206164647265736044820152607360f81b60648201526084016104fd565b6001600160a01b03821660009081526020819052604090205481811015610d575760405162461bcd60e51b815260206004820152602260248201527f45524332303a206275726e20616d6f756e7420657863656564732062616c616e604482015261636560f01b60648201526084016104fd565b6001600160a01b0383166000818152602081815260408083208686039055600280548790039055518581529192917fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9101610a58565b505050565b6000306001600160a01b037f000000000000000000000000530000000000000000000000000000000000000416148015610e0b57507f000000000000000000000000000000000000000000000000000000000008275046145b15610e3557507fe5b117a3cd7ae7ed3508e6e6c5a0794536b2a8dee12533c4d7524eae9c85438f90565b610558604080517f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f60208201527f00cd3d46df44f2cbb950cf84eb2e92aa2ddd23195b1a009173ea59a063357ed3918101919091527fc89efdaa54c0f20c7adf612882df0950f5a951637e0307cdcb4c672f298b8bc660608201524660808201523060a082015260009060c00160405160208183030381529060405280519060200120905090565b606060ff8314610ef0576108628361103c565b818054610efc90611506565b80601f0160208091040260200160405190810160405280929190818152602001828054610f2890611506565b8015610f755780601f10610f4a57610100808354040283529160200191610f75565b820191906000526020600020905b815481529060010190602001808311610f5857829003601f168201915b50505050509050610433565b6001600160a01b03811660009081526007602052604090208054600181018255905b50919050565b6000610433610fb6610db2565b8360405161190160f01b8152600281019290925260228201526042902090565b6000806000610fe78787878761107b565b91509150610ff48161113f565b5095945050505050565b600080829050601f81511115611029578260405163305a27a960e01b81526004016104fd91906112fa565b80516110348261167f565b179392505050565b606060006110498361128c565b604080516020808252818301909252919250600091906020820181803683375050509182525060208101929092525090565b6000807f7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a08311156110b25750600090506003611136565b6040805160008082526020820180845289905260ff881692820192909252606081018690526080810185905260019060a0016020604051602081039080840390855afa158015611106573d6000803e3d6000fd5b5050604051601f1901519150506001600160a01b03811661112f57600060019250925050611136565b9150600090505b94509492505050565b6000816004811115611153576111536116a3565b0361115b5750565b600181600481111561116f5761116f6116a3565b036111bc5760405162461bcd60e51b815260206004820152601860248201527f45434453413a20696e76616c6964207369676e6174757265000000000000000060448201526064016104fd565b60028160048111156111d0576111d06116a3565b0361121d5760405162461bcd60e51b815260206004820152601f60248201527f45434453413a20696e76616c6964207369676e6174757265206c656e6774680060448201526064016104fd565b6003816004811115611231576112316116a3565b036112895760405162461bcd60e51b815260206004820152602260248201527f45434453413a20696e76616c6964207369676e6174757265202773272076616c604482015261756560f01b60648201526084016104fd565b50565b600060ff8216601f81111561043357604051632cd44ac360e21b815260040160405180910390fd5b6000815180845260005b818110156112da576020818501810151868301820152016112be565b506000602082860101526020601f19601f83011685010191505092915050565b60208152600061130d60208301846112b4565b9392505050565b80356001600160a01b038116811461132b57600080fd5b919050565b6000806040838503121561134357600080fd5b61134c83611314565b946020939093013593505050565b60008060006060848603121561136f57600080fd5b61137884611314565b925061138660208501611314565b9150604084013590509250925092565b6000602082840312156113a857600080fd5b5035919050565b6000602082840312156113c157600080fd5b61130d82611314565b60ff60f81b881681526000602060e0818401526113ea60e084018a6112b4565b83810360408501526113fc818a6112b4565b606085018990526001600160a01b038816608086015260a0850187905284810360c0860152855180825283870192509083019060005b8181101561144e57835183529284019291840191600101611432565b50909c9b505050505050505050505050565b600080600080600080600060e0888a03121561147b57600080fd5b61148488611314565b965061149260208901611314565b95506040880135945060608801359350608088013560ff811681146114b657600080fd5b9699959850939692959460a0840135945060c09093013592915050565b600080604083850312156114e657600080fd5b6114ef83611314565b91506114fd60208401611314565b90509250929050565b600181811c9082168061151a57607f821691505b602082108103610fa357634e487b7160e01b600052602260045260246000fd5b8082018082111561043357634e487b7160e01b600052601160045260246000fd5b634e487b7160e01b600052604160045260246000fd5b601f821115610dad57600081815260208120601f850160051c810160208610156115985750805b601f850160051c820191505b818110156115b7578281556001016115a4565b505050505050565b815167ffffffffffffffff8111156115d9576115d961155b565b6115ed816115e78454611506565b84611571565b602080601f831160018114611622576000841561160a5750858301515b600019600386901b1c1916600185901b1785556115b7565b600085815260208120601f198616915b8281101561165157888601518255948401946001909101908401611632565b508582101561166f5787850151600019600388901b60f8161c191681555b5050505050600190811b01905550565b80516020808301519190811015610fa35760001960209190910360031b1b16919050565b634e487b7160e01b600052602160045260246000fdfea26469706673582212207f39e33e122e8e2b0381aa6abea46046f56b05ced66c556a06bb1b80be7f55cf64736f6c63430008100033&quot;,&quot;storage&quot;:{&quot;0x0000000000000000000000000000000000000000000000000000000000000003&quot;:&quot;0x577261707065642045746865720000000000000000000000000000000000001a&quot;,&quot;0x0000000000000000000000000000000000000000000000000000000000000004&quot;:&quot;0x5745544800000000000000000000000000000000000000000000000000000008&quot;}},&quot;0x5300000000000000000000000000000000000005&quot;:{&quot;balance&quot;:&quot;0x0&quot;,&quot;code&quot;:&quot;0x6080604052600436106100ab5760003560e01c806384411d651161006457806384411d65146101845780638da5cb5b1461019a5780639e7adc79146101ba578063f2fde38b146101da578063feec756c146101fa578063ff4f35461461021a57600080fd5b80632e1a7d4d146100b75780633cb747bf146100d95780633ccfd60b14610116578063457e1a491461012b57806366d003ac1461014f578063715018a61461016f57600080fd5b366100b257005b600080fd5b3480156100c357600080fd5b506100d76100d2366004610682565b61023a565b005b3480156100e557600080fd5b506002546100f9906001600160a01b031681565b6040516001600160a01b0390911681526020015b60405180910390f35b34801561012257600080fd5b506100d76103ff565b34801561013757600080fd5b5061014160015481565b60405190815260200161010d565b34801561015b57600080fd5b506003546100f9906001600160a01b031681565b34801561017b57600080fd5b506100d761040c565b34801561019057600080fd5b5061014160045481565b3480156101a657600080fd5b506000546100f9906001600160a01b031681565b3480156101c657600080fd5b506100d76101d536600461069b565b610442565b3480156101e657600080fd5b506100d76101f536600461069b565b6104be565b34801561020657600080fd5b506100d761021536600461069b565b610547565b34801561022657600080fd5b506100d7610235366004610682565b6105c3565b6001548110156102ca5760405162461bcd60e51b815260206004820152604a60248201527f4665655661756c743a207769746864726177616c20616d6f756e74206d75737460448201527f2062652067726561746572207468616e206d696e696d756d20776974686472616064820152691dd85b08185b5bdd5b9d60b21b608482015260a4015b60405180910390fd5b478082111561032e5760405162461bcd60e51b815260206004820152602a60248201527f4665655661756c743a20696e73756666696369656e742062616c616e636520746044820152696f20776974686472617760b01b60648201526084016102c1565b6004805483019055600354604080518481526001600160a01b0390921660208301523382820152517fc8a211cc64b6ed1b50595a9fcb1932b6d1e5a6e8ef15b60e5b1f988ea9086bba9181900360600190a1600254600354604080516020810182526000808252915163b2267a7b60e01b81526001600160a01b039485169463b2267a7b9488946103c99491909216928592906004016106cb565b6000604051808303818588803b1580156103e257600080fd5b505af11580156103f6573d6000803e3d6000fd5b50505050505050565b476104098161023a565b50565b6000546001600160a01b031633146104365760405162461bcd60e51b81526004016102c190610737565b6104406000610632565b565b6000546001600160a01b0316331461046c5760405162461bcd60e51b81526004016102c190610737565b600280546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f1c928c417a10a21c3cddad148c5dba5d710e4b1442d6d8a36de345935ad8461290600090a35050565b6000546001600160a01b031633146104e85760405162461bcd60e51b81526004016102c190610737565b6001600160a01b03811661053e5760405162461bcd60e51b815260206004820152601d60248201527f6e6577206f776e657220697320746865207a65726f206164647265737300000060448201526064016102c1565b61040981610632565b6000546001600160a01b031633146105715760405162461bcd60e51b81526004016102c190610737565b600380546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f7e1e96961a397c8aa26162fe259cc837afc95e33aad4945ddc61c18dabb7a6ad90600090a35050565b6000546001600160a01b031633146105ed5760405162461bcd60e51b81526004016102c190610737565b600180549082905560408051828152602081018490527f0d3c80219fe57713b9f9c83d1e51426792d0c14d8e330e65b102571816140965910160405180910390a15050565b600080546001600160a01b038381166001600160a01b0319831681178455604051919092169283917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e09190a35050565b60006020828403121561069457600080fd5b5035919050565b6000602082840312156106ad57600080fd5b81356001600160a01b03811681146106c457600080fd5b9392505050565b60018060a01b038516815260006020858184015260806040840152845180608085015260005b8181101561070d5786810183015185820160a0015282016106f1565b50600060a0828601015260a0601f19601f8301168501019250505082606083015295945050505050565b60208082526017908201527f63616c6c6572206973206e6f7420746865206f776e657200000000000000000060408201526060019056fea2646970667358221220063c6c384f745ebcacfdd13320e5b9a50687aae43ff14566761f56273111b97e64736f6c63430008100033&quot;,&quot;storage&quot;:{&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;:&quot;0xF9062b8a30e0d7722960e305049FA50b86ba6253&quot;,&quot;0x0000000000000000000000000000000000000000000000000000000000000001&quot;:&quot;0x8ac7230489e80000&quot;,&quot;0x0000000000000000000000000000000000000000000000000000000000000002&quot;:&quot;0x781e90f1c8Fc4611c9b7497C3B47F99Ef6969CbC&quot;,&quot;0x0000000000000000000000000000000000000000000000000000000000000003&quot;:&quot;0x8FA3b4570B4C96f8036C13b64971BA65867eEB48&quot;}}},&quot;number&quot;:&quot;0x0&quot;,&quot;gasUsed&quot;:&quot;0x0&quot;,&quot;parentHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;baseFeePerGas&quot;:null}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8b489d8d0835cff40af8887e" role="button"
                       aria-expanded="false" aria-controls="id-8b489d8d0835cff40af8887e">
                        <code>crates/scroll/chainspec/res/genesis/sepolia_scroll.json</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/chainspec/res/genesis/sepolia_scroll.json" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8b489d8d0835cff40af8887e"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;chainspec&#47;res&#47;genesis&#47;sepolia_scroll.json scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;res&#47;genesis&#47;sepolia_scroll.json</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..64987e5c8c5eed66d6f1927b5f8f0b6d31b18de9</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;res&#47;genesis&#47;sepolia_scroll.json</span>
<span class="term-fg36">@@ -0,0 +1 @@</span>
<span class="term-fg32">+{&quot;config&quot;:{&quot;chainId&quot;:534351,&quot;homesteadBlock&quot;:0,&quot;eip150Block&quot;:0,&quot;eip150Hash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;eip155Block&quot;:0,&quot;eip158Block&quot;:0,&quot;byzantiumBlock&quot;:0,&quot;constantinopleBlock&quot;:0,&quot;petersburgBlock&quot;:0,&quot;istanbulBlock&quot;:0,&quot;berlinBlock&quot;:0,&quot;londonBlock&quot;:0,&quot;archimedesBlock&quot;:0,&quot;shanghaiBlock&quot;:0,&quot;bernoulliBlock&quot;:3747132,&quot;curieBlock&quot;:4740239,&quot;clique&quot;:{&quot;period&quot;:3,&quot;epoch&quot;:30000,&quot;relaxed_period&quot;:true},&quot;scroll&quot;:{&quot;useZktrie&quot;:true,&quot;maxTxPerBlock&quot;:100,&quot;maxTxPayloadBytesPerBlock&quot;:122880,&quot;feeVaultAddress&quot;:&quot;0x5300000000000000000000000000000000000005&quot;,&quot;enableEIP2718&quot;:false,&quot;enableEIP1559&quot;:false,&quot;l1Config&quot;:{&quot;l1ChainId&quot;:&quot;11155111&quot;,&quot;l1MessageQueueAddress&quot;:&quot;0xF0B2293F5D834eAe920c6974D50957A1732de763&quot;,&quot;scrollChainAddress&quot;:&quot;0x2D567EcE699Eabe5afCd141eDB7A4f2D0D6ce8a0&quot;,&quot;numL1MessagesPerBlock&quot;:&quot;10&quot;}}},&quot;nonce&quot;:&quot;0x0&quot;,&quot;timestamp&quot;:&quot;0x64cfd015&quot;,&quot;extraData&quot;:&quot;0x000000000000000000000000000000000000000000000000000000000000000048C3F81f3D998b6652900e1C3183736C238Fe4290000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;gasLimit&quot;:&quot;8000000&quot;,&quot;difficulty&quot;:&quot;0x1&quot;,&quot;mixHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;coinbase&quot;:&quot;0x0000000000000000000000000000000000000000&quot;,&quot;alloc&quot;:{&quot;0x18960EEc21b1878C581937a14c5c3C43008F6b6B&quot;:{&quot;balance&quot;:&quot;10000000000000000000&quot;},&quot;0xBa50f5340FB9F3Bd074bD638c9BE13eCB36E603d&quot;:{&quot;balance&quot;:&quot;226156424291633194186662080095093570025917938800079226629565593765455331328&quot;},&quot;0x5300000000000000000000000000000000000000&quot;:{&quot;balance&quot;:&quot;0x0&quot;,&quot;code&quot;:&quot;0x608060405234801561001057600080fd5b50600436106100935760003560e01c806383cc76601161006657806383cc7660146100fc5780638da5cb5b1461010f578063c4d66de814610122578063d4b9f4fa14610135578063f2fde38b1461013e57600080fd5b806326aad7b7146100985780633cb747bf146100b4578063600a2e77146100df578063715018a6146100f2575b600080fd5b6100a160015481565b6040519081526020015b60405180910390f35b6053546100c7906001600160a01b031681565b6040516001600160a01b0390911681526020016100ab565b6100a16100ed36600461054a565b610151565b6100fa6101f6565b005b6100a161010a36600461054a565b61022c565b6052546100c7906001600160a01b031681565b6100fa610130366004610563565b610243565b6100a160005481565b6100fa61014c366004610563565b6102db565b6053546000906001600160a01b031633146101a45760405162461bcd60e51b815260206004820152600e60248201526d37b7363c9036b2b9b9b2b733b2b960911b60448201526064015b60405180910390fd5b6000806101b084610367565b60408051838152602081018890529294509092507ffaa617c2d8ce12c62637dbce76efcc18dae60574aa95709bdcedce7e76071693910160405180910390a19392505050565b6052546001600160a01b031633146102205760405162461bcd60e51b815260040161019b90610593565b61022a6000610486565b565b602a816028811061023c57600080fd5b0154905081565b6052546001600160a01b0316331461026d5760405162461bcd60e51b815260040161019b90610593565b600154156102b15760405162461bcd60e51b815260206004820152601160248201527063616e6e6f7420696e697469616c697a6560781b604482015260640161019b565b6102b96104d8565b605380546001600160a01b0319166001600160a01b0392909216919091179055565b6052546001600160a01b031633146103055760405162461bcd60e51b815260040161019b90610593565b6001600160a01b03811661035b5760405162461bcd60e51b815260206004820152601d60248201527f6e6577206f776e657220697320746865207a65726f2061646472657373000000604482015260640161019b565b61036481610486565b50565b60035460009081906103bb5760405162461bcd60e51b815260206004820152601a60248201527f63616c6c206265666f726520696e697469616c697a6174696f6e000000000000604482015260640161019b565b6001548360005b8215610456576103d36002846105e0565b60000361041f5781602a82602881106103ee576103ee6105ca565b01556104188260028360288110610407576104076105ca565b015460009182526020526040902090565b915061044a565b610447602a8260288110610435576104356105ca565b01548360009182526020526040902090565b91505b600192831c92016103c2565b81602a826028811061046a5761046a6105ca565b0155506000819055600180548082019091559590945092505050565b605280546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b60005b60286104e8826001610618565b10156103645761051960028260288110610504576105046105ca565b015460028360288110610407576104076105ca565b6002610526836001610618565b60288110610536576105366105ca565b01558061054281610631565b9150506104db565b60006020828403121561055c57600080fd5b5035919050565b60006020828403121561057557600080fd5b81356001600160a01b038116811461058c57600080fd5b9392505050565b60208082526017908201527f63616c6c6572206973206e6f7420746865206f776e6572000000000000000000604082015260600190565b634e487b7160e01b600052603260045260246000fd5b6000826105fd57634e487b7160e01b600052601260045260246000fd5b500690565b634e487b7160e01b600052601160045260246000fd5b8082018082111561062b5761062b610602565b92915050565b60006001820161064357610643610602565b506001019056fea26469706673582212208fb1cb9933bb17dd0a7c17de7c890919b08d2fd7eb2bede7b41caa32709b30b564736f6c63430008100033&quot;,&quot;storage&quot;:{&quot;0x0000000000000000000000000000000000000000000000000000000000000052&quot;:&quot;0x18960EEc21b1878C581937a14c5c3C43008F6b6B&quot;}},&quot;0x5300000000000000000000000000000000000002&quot;:{&quot;balance&quot;:&quot;0x0&quot;,&quot;code&quot;:&quot;0x608060405234801561001057600080fd5b50600436106100cf5760003560e01c8063715018a61161008c578063bede39b511610066578063bede39b51461018d578063de26c4a1146101a0578063f2fde38b146101b3578063f45e65d8146101c657600080fd5b8063715018a6146101475780638da5cb5b1461014f57806393e59dc11461017a57600080fd5b80630c18c162146100d45780633577afc5146100f05780633d0f963e1461010557806349948e0e14610118578063519b4bd31461012b5780637046559714610134575b600080fd5b6100dd60025481565b6040519081526020015b60405180910390f35b6101036100fe366004610671565b6101cf565b005b61010361011336600461068a565b610291565b6100dd6101263660046106d0565b61031c565b6100dd60015481565b610103610142366004610671565b610361565b610103610416565b600054610162906001600160a01b031681565b6040516001600160a01b0390911681526020016100e7565b600454610162906001600160a01b031681565b61010361019b366004610671565b61044c565b6100dd6101ae3660046106d0565b610533565b6101036101c136600461068a565b610595565b6100dd60035481565b6000546001600160a01b031633146102025760405162461bcd60e51b81526004016101f990610781565b60405180910390fd5b621c9c388111156102555760405162461bcd60e51b815260206004820152601760248201527f657863656564206d6178696d756d206f7665726865616400000000000000000060448201526064016101f9565b60028190556040518181527f32740b35c0ea213650f60d44366b4fb211c9033b50714e4a1d34e65d5beb9bb4906020015b60405180910390a150565b6000546001600160a01b031633146102bb5760405162461bcd60e51b81526004016101f990610781565b600480546001600160a01b038381166001600160a01b031983168117909355604080519190921680825260208201939093527f22d1c35fe072d2e42c3c8f9bd4a0d34aa84a0101d020a62517b33fdb3174e5f7910160405180910390a15050565b60008061032883610533565b905060006001548261033a91906107b8565b9050633b9aca006003548261034f91906107b8565b61035991906107e5565b949350505050565b6000546001600160a01b0316331461038b5760405162461bcd60e51b81526004016101f990610781565b61039b633b9aca006103e86107b8565b8111156103e15760405162461bcd60e51b8152602060048201526014602482015273657863656564206d6178696d756d207363616c6560601b60448201526064016101f9565b60038190556040518181527f3336cd9708eaf2769a0f0dc0679f30e80f15dcd88d1921b5a16858e8b85c591a90602001610286565b6000546001600160a01b031633146104405760405162461bcd60e51b81526004016101f990610781565b61044a6000610621565b565b6004805460405163efc7840160e01b815233928101929092526001600160a01b03169063efc7840190602401602060405180830381865afa158015610495573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906104b99190610807565b6104fe5760405162461bcd60e51b81526020600482015260166024820152752737ba103bb434ba32b634b9ba32b21039b2b73232b960511b60448201526064016101f9565b60018190556040518181527f351fb23757bb5ea0546c85b7996ddd7155f96b939ebaa5ff7bc49c75f27f2c4490602001610286565b80516000908190815b818110156105865784818151811061055657610556610829565b01602001516001600160f81b0319166000036105775760048301925061057e565b6010830192505b60010161053c565b50506002540160400192915050565b6000546001600160a01b031633146105bf5760405162461bcd60e51b81526004016101f990610781565b6001600160a01b0381166106155760405162461bcd60e51b815260206004820152601d60248201527f6e6577206f776e657220697320746865207a65726f206164647265737300000060448201526064016101f9565b61061e81610621565b50565b600080546001600160a01b038381166001600160a01b0319831681178455604051919092169283917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e09190a35050565b60006020828403121561068357600080fd5b5035919050565b60006020828403121561069c57600080fd5b81356001600160a01b03811681146106b357600080fd5b9392505050565b634e487b7160e01b600052604160045260246000fd5b6000602082840312156106e257600080fd5b813567ffffffffffffffff808211156106fa57600080fd5b818401915084601f83011261070e57600080fd5b813581811115610720576107206106ba565b604051601f8201601f19908116603f01168101908382118183101715610748576107486106ba565b8160405282815287602084870101111561076157600080fd5b826020860160208301376000928101602001929092525095945050505050565b60208082526017908201527f63616c6c6572206973206e6f7420746865206f776e6572000000000000000000604082015260600190565b60008160001904831182151516156107e057634e487b7160e01b600052601160045260246000fd5b500290565b60008261080257634e487b7160e01b600052601260045260246000fd5b500490565b60006020828403121561081957600080fd5b815180151581146106b357600080fd5b634e487b7160e01b600052603260045260246000fdfea26469706673582212205ea335809638809cf032c794fd966e2439020737b1dcc2218435cb438286efcf64736f6c63430008100033&quot;,&quot;storage&quot;:{&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;:&quot;0x18960EEc21b1878C581937a14c5c3C43008F6b6B&quot;}},&quot;0x5300000000000000000000000000000000000003&quot;:{&quot;balance&quot;:&quot;0x0&quot;,&quot;code&quot;:&quot;0x608060405234801561001057600080fd5b50600436106100575760003560e01c8063715018a61461005c57806379586dd7146100665780638da5cb5b14610079578063efc78401146100a9578063f2fde38b146100e5575b600080fd5b6100646100f8565b005b610064610074366004610356565b610137565b60005461008c906001600160a01b031681565b6040516001600160a01b0390911681526020015b60405180910390f35b6100d56100b736600461042d565b6001600160a01b031660009081526001602052604090205460ff1690565b60405190151581526020016100a0565b6100646100f336600461042d565b610238565b6000546001600160a01b0316331461012b5760405162461bcd60e51b81526004016101229061044f565b60405180910390fd5b61013560006102c4565b565b6000546001600160a01b031633146101615760405162461bcd60e51b81526004016101229061044f565b60005b825181101561023357816001600085848151811061018457610184610486565b60200260200101516001600160a01b03166001600160a01b0316815260200190815260200160002060006101000a81548160ff0219169083151502179055508281815181106101d5576101d5610486565b60200260200101516001600160a01b03167f8daaf060c3306c38e068a75c054bf96ecd85a3db1252712c4d93632744c42e0d83604051610219911515815260200190565b60405180910390a28061022b8161049c565b915050610164565b505050565b6000546001600160a01b031633146102625760405162461bcd60e51b81526004016101229061044f565b6001600160a01b0381166102b85760405162461bcd60e51b815260206004820152601d60248201527f6e6577206f776e657220697320746865207a65726f20616464726573730000006044820152606401610122565b6102c1816102c4565b50565b600080546001600160a01b038381166001600160a01b0319831681178455604051919092169283917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e09190a35050565b634e487b7160e01b600052604160045260246000fd5b80356001600160a01b038116811461034157600080fd5b919050565b8035801515811461034157600080fd5b6000806040838503121561036957600080fd5b823567ffffffffffffffff8082111561038157600080fd5b818501915085601f83011261039557600080fd5b81356020828211156103a9576103a9610314565b8160051b604051601f19603f830116810181811086821117156103ce576103ce610314565b6040529283528183019350848101820192898411156103ec57600080fd5b948201945b83861015610411576104028661032a565b855294820194938201936103f1565b96506104209050878201610346565b9450505050509250929050565b60006020828403121561043f57600080fd5b6104488261032a565b9392505050565b60208082526017908201527f63616c6c6572206973206e6f7420746865206f776e6572000000000000000000604082015260600190565b634e487b7160e01b600052603260045260246000fd5b6000600182016104bc57634e487b7160e01b600052601160045260246000fd5b506001019056fea26469706673582212203414b076e92b618bd7c3437159d7bceb2acc3a5c82f51f383465512d9c52e97064736f6c63430008100033&quot;,&quot;storage&quot;:{&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;:&quot;0x18960EEc21b1878C581937a14c5c3C43008F6b6B&quot;}},&quot;0x5300000000000000000000000000000000000004&quot;:{&quot;balance&quot;:&quot;0x0&quot;,&quot;code&quot;:&quot;0x6080604052600436106101025760003560e01c806370a0823111610095578063a457c2d711610064578063a457c2d7146102b4578063a9059cbb146102d4578063d0e30db0146102f4578063d505accf146102fc578063dd62ed3e1461031c57600080fd5b806370a08231146102215780637ecebe001461025757806384b0196e1461027757806395d89b411461029f57600080fd5b80632e1a7d4d116100d15780632e1a7d4d146101b0578063313ce567146101d05780633644e515146101ec578063395093511461020157600080fd5b806306fdde0314610116578063095ea7b31461014157806318160ddd1461017157806323b872dd1461019057600080fd5b366101115761010f61033c565b005b600080fd5b34801561012257600080fd5b5061012b61037d565b60405161013891906112cf565b60405180910390f35b34801561014d57600080fd5b5061016161015c366004611305565b61040f565b6040519015158152602001610138565b34801561017d57600080fd5b506002545b604051908152602001610138565b34801561019c57600080fd5b506101616101ab36600461132f565b610429565b3480156101bc57600080fd5b5061010f6101cb36600461136b565b61044d565b3480156101dc57600080fd5b5060405160128152602001610138565b3480156101f857600080fd5b50610182610523565b34801561020d57600080fd5b5061016161021c366004611305565b610532565b34801561022d57600080fd5b5061018261023c366004611384565b6001600160a01b031660009081526020819052604090205490565b34801561026357600080fd5b50610182610272366004611384565b610554565b34801561028357600080fd5b5061028c610572565b604051610138979695949392919061139f565b3480156102ab57600080fd5b5061012b6105fb565b3480156102c057600080fd5b506101616102cf366004611305565b61060a565b3480156102e057600080fd5b506101616102ef366004611305565b610685565b61010f61033c565b34801561030857600080fd5b5061010f610317366004611435565b610693565b34801561032857600080fd5b506101826103373660046114a8565b6107f7565b6103463334610856565b60405134815233907fe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c9060200160405180910390a2565b60606003805461038c906114db565b80601f01602080910402602001604051908101604052809291908181526020018280546103b8906114db565b80156104055780601f106103da57610100808354040283529160200191610405565b820191906000526020600020905b8154815290600101906020018083116103e857829003601f168201915b5050505050905090565b60003361041d818585610915565b60019150505b92915050565b600033610437858285610a3a565b610442858585610ab4565b506001949350505050565b6104573382610c58565b604051600090339083908381818185875af1925050503d8060008114610499576040519150601f19603f3d011682016040523d82523d6000602084013e61049e565b606091505b50509050806104ea5760405162461bcd60e51b81526020600482015260136024820152721dda5d1a191c985dc81155120819985a5b1959606a1b60448201526064015b60405180910390fd5b60405182815233907f7fcf532c15f0a6db0bd6d0e038bea71d30d808c7d98cb3bf7268a95bf5081b659060200160405180910390a25050565b600061052d610d87565b905090565b60003361041d81858561054583836107f7565b61054f919061150f565b610915565b6001600160a01b038116600090815260076020526040812054610423565b6000606080828080836105a67f577261707065642045746865720000000000000000000000000000000000000d6005610eb2565b6105d17f31000000000000000000000000000000000000000000000000000000000000016006610eb2565b60408051600080825260208201909252600f60f81b9b939a50919850469750309650945092509050565b60606004805461038c906114db565b6000338161061882866107f7565b9050838110156106785760405162461bcd60e51b815260206004820152602560248201527f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f77604482015264207a65726f60d81b60648201526084016104e1565b6104428286868403610915565b60003361041d818585610ab4565b834211156106e35760405162461bcd60e51b815260206004820152601d60248201527f45524332305065726d69743a206578706972656420646561646c696e6500000060448201526064016104e1565b60007f6e71edae12b1b97f4d1f60370fef10105fa2faae0126114a169c64845d6126c98888886107128c610f56565b6040805160208101969096526001600160a01b0394851690860152929091166060840152608083015260a082015260c0810186905260e001604051602081830303815290604052805190602001209050600061076d82610f7e565b9050600061077d82878787610fab565b9050896001600160a01b0316816001600160a01b0316146107e05760405162461bcd60e51b815260206004820152601e60248201527f45524332305065726d69743a20696e76616c6964207369676e6174757265000060448201526064016104e1565b6107eb8a8a8a610915565b50505050505050505050565b6001600160a01b03918216600090815260016020908152604080832093909416825291909152205490565b600060208351101561083e5761083783610fd3565b9050610423565b816108498482611594565b5060ff9050610423565b90565b6001600160a01b0382166108ac5760405162461bcd60e51b815260206004820152601f60248201527f45524332303a206d696e7420746f20746865207a65726f20616464726573730060448201526064016104e1565b80600260008282546108be919061150f565b90915550506001600160a01b038216600081815260208181526040808320805486019055518481527fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef910160405180910390a35050565b6001600160a01b0383166109775760405162461bcd60e51b8152602060048201526024808201527f45524332303a20617070726f76652066726f6d20746865207a65726f206164646044820152637265737360e01b60648201526084016104e1565b6001600160a01b0382166109d85760405162461bcd60e51b815260206004820152602260248201527f45524332303a20617070726f766520746f20746865207a65726f206164647265604482015261737360f01b60648201526084016104e1565b6001600160a01b0383811660008181526001602090815260408083209487168084529482529182902085905590518481527f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92591015b60405180910390a3505050565b6000610a4684846107f7565b90506000198114610aae5781811015610aa15760405162461bcd60e51b815260206004820152601d60248201527f45524332303a20696e73756666696369656e7420616c6c6f77616e636500000060448201526064016104e1565b610aae8484848403610915565b50505050565b6001600160a01b038316610b185760405162461bcd60e51b815260206004820152602560248201527f45524332303a207472616e736665722066726f6d20746865207a65726f206164604482015264647265737360d81b60648201526084016104e1565b6001600160a01b038216610b7a5760405162461bcd60e51b815260206004820152602360248201527f45524332303a207472616e7366657220746f20746865207a65726f206164647260448201526265737360e81b60648201526084016104e1565b6001600160a01b03831660009081526020819052604090205481811015610bf25760405162461bcd60e51b815260206004820152602660248201527f45524332303a207472616e7366657220616d6f756e7420657863656564732062604482015265616c616e636560d01b60648201526084016104e1565b6001600160a01b03848116600081815260208181526040808320878703905593871680835291849020805487019055925185815290927fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef910160405180910390a3610aae565b6001600160a01b038216610cb85760405162461bcd60e51b815260206004820152602160248201527f45524332303a206275726e2066726f6d20746865207a65726f206164647265736044820152607360f81b60648201526084016104e1565b6001600160a01b03821660009081526020819052604090205481811015610d2c5760405162461bcd60e51b815260206004820152602260248201527f45524332303a206275726e20616d6f756e7420657863656564732062616c616e604482015261636560f01b60648201526084016104e1565b6001600160a01b0383166000818152602081815260408083208686039055600280548790039055518581529192917fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9101610a2d565b505050565b6000306001600160a01b037f0000000000000000000000005fbdb2315678afecb367f032d93f642f64180aa316148015610de057507f000000000000000000000000000000000000000000000000000000000008274f46145b15610e0a57507f624453decb4e78ca99c7630ff9f52222ea6f559f0a6c1bb60b935ef006fa159e90565b61052d604080517f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f60208201527f00cd3d46df44f2cbb950cf84eb2e92aa2ddd23195b1a009173ea59a063357ed3918101919091527fc89efdaa54c0f20c7adf612882df0950f5a951637e0307cdcb4c672f298b8bc660608201524660808201523060a082015260009060c00160405160208183030381529060405280519060200120905090565b606060ff8314610ec55761083783611011565b818054610ed1906114db565b80601f0160208091040260200160405190810160405280929190818152602001828054610efd906114db565b8015610f4a5780601f10610f1f57610100808354040283529160200191610f4a565b820191906000526020600020905b815481529060010190602001808311610f2d57829003601f168201915b50505050509050610423565b6001600160a01b03811660009081526007602052604090208054600181018255905b50919050565b6000610423610f8b610d87565b8360405161190160f01b8152600281019290925260228201526042902090565b6000806000610fbc87878787611050565b91509150610fc981611114565b5095945050505050565b600080829050601f81511115610ffe578260405163305a27a960e01b81526004016104e191906112cf565b805161100982611654565b179392505050565b6060600061101e83611261565b604080516020808252818301909252919250600091906020820181803683375050509182525060208101929092525090565b6000807f7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a0831115611087575060009050600361110b565b6040805160008082526020820180845289905260ff881692820192909252606081018690526080810185905260019060a0016020604051602081039080840390855afa1580156110db573d6000803e3d6000fd5b5050604051601f1901519150506001600160a01b0381166111045760006001925092505061110b565b9150600090505b94509492505050565b600081600481111561112857611128611678565b036111305750565b600181600481111561114457611144611678565b036111915760405162461bcd60e51b815260206004820152601860248201527f45434453413a20696e76616c6964207369676e6174757265000000000000000060448201526064016104e1565b60028160048111156111a5576111a5611678565b036111f25760405162461bcd60e51b815260206004820152601f60248201527f45434453413a20696e76616c6964207369676e6174757265206c656e6774680060448201526064016104e1565b600381600481111561120657611206611678565b0361125e5760405162461bcd60e51b815260206004820152602260248201527f45434453413a20696e76616c6964207369676e6174757265202773272076616c604482015261756560f01b60648201526084016104e1565b50565b600060ff8216601f81111561042357604051632cd44ac360e21b815260040160405180910390fd5b6000815180845260005b818110156112af57602081850181015186830182015201611293565b506000602082860101526020601f19601f83011685010191505092915050565b6020815260006112e26020830184611289565b9392505050565b80356001600160a01b038116811461130057600080fd5b919050565b6000806040838503121561131857600080fd5b611321836112e9565b946020939093013593505050565b60008060006060848603121561134457600080fd5b61134d846112e9565b925061135b602085016112e9565b9150604084013590509250925092565b60006020828403121561137d57600080fd5b5035919050565b60006020828403121561139657600080fd5b6112e2826112e9565b60ff60f81b881681526000602060e0818401526113bf60e084018a611289565b83810360408501526113d1818a611289565b606085018990526001600160a01b038816608086015260a0850187905284810360c0860152855180825283870192509083019060005b8181101561142357835183529284019291840191600101611407565b50909c9b505050505050505050505050565b600080600080600080600060e0888a03121561145057600080fd5b611459886112e9565b9650611467602089016112e9565b95506040880135945060608801359350608088013560ff8116811461148b57600080fd5b9699959850939692959460a0840135945060c09093013592915050565b600080604083850312156114bb57600080fd5b6114c4836112e9565b91506114d2602084016112e9565b90509250929050565b600181811c908216806114ef57607f821691505b602082108103610f7857634e487b7160e01b600052602260045260246000fd5b8082018082111561042357634e487b7160e01b600052601160045260246000fd5b634e487b7160e01b600052604160045260246000fd5b601f821115610d8257600081815260208120601f850160051c8101602086101561156d5750805b601f850160051c820191505b8181101561158c57828155600101611579565b505050505050565b815167ffffffffffffffff8111156115ae576115ae611530565b6115c2816115bc84546114db565b84611546565b602080601f8311600181146115f757600084156115df5750858301515b600019600386901b1c1916600185901b17855561158c565b600085815260208120601f198616915b8281101561162657888601518255948401946001909101908401611607565b50858210156116445787850151600019600388901b60f8161c191681555b5050505050600190811b01905550565b80516020808301519190811015610f785760001960209190910360031b1b16919050565b634e487b7160e01b600052602160045260246000fdfea264697066735822122075458b204a41338df799effa8b73c6c1a17e612bc3b3311c0cec123c4da7709964736f6c63430008100033&quot;,&quot;storage&quot;:{&quot;0x0000000000000000000000000000000000000000000000000000000000000003&quot;:&quot;0x577261707065642045746865720000000000000000000000000000000000001a&quot;,&quot;0x0000000000000000000000000000000000000000000000000000000000000004&quot;:&quot;0x5745544800000000000000000000000000000000000000000000000000000008&quot;}},&quot;0x5300000000000000000000000000000000000005&quot;:{&quot;balance&quot;:&quot;0x0&quot;,&quot;code&quot;:&quot;0x6080604052600436106100a05760003560e01c806384411d651161006457806384411d65146101595780638da5cb5b1461016f5780639e7adc791461018f578063f2fde38b146101af578063feec756c146101cf578063ff4f3546146101ef57600080fd5b80633cb747bf146100ac5780633ccfd60b146100e9578063457e1a491461010057806366d003ac14610124578063715018a61461014457600080fd5b366100a757005b600080fd5b3480156100b857600080fd5b506002546100cc906001600160a01b031681565b6040516001600160a01b0390911681526020015b60405180910390f35b3480156100f557600080fd5b506100fe61020f565b005b34801561010c57600080fd5b5061011660015481565b6040519081526020016100e0565b34801561013057600080fd5b506003546100cc906001600160a01b031681565b34801561015057600080fd5b506100fe610371565b34801561016557600080fd5b5061011660045481565b34801561017b57600080fd5b506000546100cc906001600160a01b031681565b34801561019b57600080fd5b506100fe6101aa3660046105ea565b6103a7565b3480156101bb57600080fd5b506100fe6101ca3660046105ea565b610423565b3480156101db57600080fd5b506100fe6101ea3660046105ea565b6104af565b3480156101fb57600080fd5b506100fe61020a36600461061a565b61052b565b60015447908110156102a15760405162461bcd60e51b815260206004820152604a60248201527f4665655661756c743a207769746864726177616c20616d6f756e74206d75737460448201527f2062652067726561746572207468616e206d696e696d756d20776974686472616064820152691dd85b08185b5bdd5b9d60b21b608482015260a4015b60405180910390fd5b6004805482019055600354604080518381526001600160a01b0390921660208301523382820152517fc8a211cc64b6ed1b50595a9fcb1932b6d1e5a6e8ef15b60e5b1f988ea9086bba9181900360600190a1600254600354604080516020810182526000808252915163b2267a7b60e01b81526001600160a01b039485169463b2267a7b94879461033c949190921692859290600401610633565b6000604051808303818588803b15801561035557600080fd5b505af1158015610369573d6000803e3d6000fd5b505050505050565b6000546001600160a01b0316331461039b5760405162461bcd60e51b81526004016102989061069f565b6103a5600061059a565b565b6000546001600160a01b031633146103d15760405162461bcd60e51b81526004016102989061069f565b600280546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f1c928c417a10a21c3cddad148c5dba5d710e4b1442d6d8a36de345935ad8461290600090a35050565b6000546001600160a01b0316331461044d5760405162461bcd60e51b81526004016102989061069f565b6001600160a01b0381166104a35760405162461bcd60e51b815260206004820152601d60248201527f6e6577206f776e657220697320746865207a65726f20616464726573730000006044820152606401610298565b6104ac8161059a565b50565b6000546001600160a01b031633146104d95760405162461bcd60e51b81526004016102989061069f565b600380546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f7e1e96961a397c8aa26162fe259cc837afc95e33aad4945ddc61c18dabb7a6ad90600090a35050565b6000546001600160a01b031633146105555760405162461bcd60e51b81526004016102989061069f565b600180549082905560408051828152602081018490527f0d3c80219fe57713b9f9c83d1e51426792d0c14d8e330e65b102571816140965910160405180910390a15050565b600080546001600160a01b038381166001600160a01b0319831681178455604051919092169283917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e09190a35050565b6000602082840312156105fc57600080fd5b81356001600160a01b038116811461061357600080fd5b9392505050565b60006020828403121561062c57600080fd5b5035919050565b60018060a01b038516815260006020858184015260806040840152845180608085015260005b818110156106755786810183015185820160a001528201610659565b50600060a0828601015260a0601f19601f8301168501019250505082606083015295945050505050565b60208082526017908201527f63616c6c6572206973206e6f7420746865206f776e657200000000000000000060408201526060019056fea26469706673582212200c5bec0af207d4c7845829d5330f295a5f16702ab8bde670ae90be68974af0a764736f6c63430008100033&quot;,&quot;storage&quot;:{&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;:&quot;0x18960EEc21b1878C581937a14c5c3C43008F6b6B&quot;,&quot;0x0000000000000000000000000000000000000000000000000000000000000001&quot;:&quot;0x8ac7230489e80000&quot;,&quot;0x0000000000000000000000000000000000000000000000000000000000000002&quot;:&quot;0xBa50f5340FB9F3Bd074bD638c9BE13eCB36E603d&quot;,&quot;0x0000000000000000000000000000000000000000000000000000000000000003&quot;:&quot;0x2351C7aD0c8cFEB25c81301EAC922ab1f1980bbe&quot;}}},&quot;number&quot;:&quot;0x0&quot;,&quot;gasUsed&quot;:&quot;0x0&quot;,&quot;parentHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;baseFeePerGas&quot;:null}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-11dabbd0f53cb1cbf03443e6" role="button"
                       aria-expanded="false" aria-controls="id-11dabbd0f53cb1cbf03443e6">
                        <code>crates/scroll/chainspec/src/constants.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/chainspec/src/constants.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+66</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-11dabbd0f53cb1cbf03443e6"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;constants.rs scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;constants.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..c4d004e2af9c24ed9fad59adfa7dafdaa804d06d</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;constants.rs</span>
<span class="term-fg36">@@ -0,0 +1,66 @@</span>
<span class="term-fg32">+use crate::genesis::L1Config;</span>
<span class="term-fg32">+use alloy_primitives::{address, Address};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The transaction fee recipient on the L2.</span>
<span class="term-fg32">+pub const SCROLL_FEE_VAULT_ADDRESS: Address = address!(&quot;5300000000000000000000000000000000000005&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The L1 message queue address for Scroll mainnet.</span>
<span class="term-fg32">+&#47;&#47;&#47; &lt;https:&#47;&#47;etherscan.io&#47;address&#47;0x0d7E906BD9cAFa154b048cFa766Cc1E54E39AF9B&gt;.</span>
<span class="term-fg32">+pub const SCROLL_MAINNET_L1_MESSAGE_QUEUE_ADDRESS: Address =</span>
<span class="term-fg32">+    address!(&quot;0d7E906BD9cAFa154b048cFa766Cc1E54E39AF9B&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The L1 proxy address for Scroll mainnet.</span>
<span class="term-fg32">+&#47;&#47;&#47; &lt;https:&#47;&#47;etherscan.io&#47;address&#47;0xa13BAF47339d63B743e7Da8741db5456DAc1E556&gt;.</span>
<span class="term-fg32">+pub const SCROLL_MAINNET_L1_PROXY_ADDRESS: Address =</span>
<span class="term-fg32">+    address!(&quot;a13BAF47339d63B743e7Da8741db5456DAc1E556&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The maximum allowed l1 messages per block for Scroll mainnet.</span>
<span class="term-fg32">+pub const SCROLL_MAINNET_MAX_L1_MESSAGES: u64 = 10;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The L1 configuration for Scroll mainnet.</span>
<span class="term-fg32">+pub const SCROLL_MAINNET_L1_CONFIG: L1Config = L1Config {</span>
<span class="term-fg32">+    l1_chain_id: alloy_chains::NamedChain::Mainnet as u64,</span>
<span class="term-fg32">+    l1_message_queue_address: SCROLL_MAINNET_L1_MESSAGE_QUEUE_ADDRESS,</span>
<span class="term-fg32">+    scroll_chain_address: SCROLL_MAINNET_L1_PROXY_ADDRESS,</span>
<span class="term-fg32">+    num_l1_messages_per_block: SCROLL_MAINNET_MAX_L1_MESSAGES,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The L1 message queue address for Scroll sepolia.</span>
<span class="term-fg32">+&#47;&#47;&#47; &lt;https:&#47;&#47;sepolia.etherscan.io&#47;address&#47;0xF0B2293F5D834eAe920c6974D50957A1732de763&gt;.</span>
<span class="term-fg32">+pub const SCROLL_SEPOLIA_L1_MESSAGE_QUEUE_ADDRESS: Address =</span>
<span class="term-fg32">+    address!(&quot;F0B2293F5D834eAe920c6974D50957A1732de763&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The L1 proxy address for Scroll sepolia.</span>
<span class="term-fg32">+&#47;&#47;&#47; &lt;https:&#47;&#47;sepolia.etherscan.io&#47;address&#47;0x2D567EcE699Eabe5afCd141eDB7A4f2D0D6ce8a0&gt;</span>
<span class="term-fg32">+pub const SCROLL_SEPOLIA_L1_PROXY_ADDRESS: Address =</span>
<span class="term-fg32">+    address!(&quot;2D567EcE699Eabe5afCd141eDB7A4f2D0D6ce8a0&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The maximum allowed l1 messages per block for Scroll sepolia.</span>
<span class="term-fg32">+pub const SCROLL_SEPOLIA_MAX_L1_MESSAGES: u64 = 10;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The L1 configuration for Scroll sepolia.</span>
<span class="term-fg32">+pub const SCROLL_SEPOLIA_L1_CONFIG: L1Config = L1Config {</span>
<span class="term-fg32">+    l1_chain_id: alloy_chains::NamedChain::Sepolia as u64,</span>
<span class="term-fg32">+    l1_message_queue_address: SCROLL_SEPOLIA_L1_MESSAGE_QUEUE_ADDRESS,</span>
<span class="term-fg32">+    scroll_chain_address: SCROLL_SEPOLIA_L1_PROXY_ADDRESS,</span>
<span class="term-fg32">+    num_l1_messages_per_block: SCROLL_SEPOLIA_MAX_L1_MESSAGES,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The L1 message queue address for Scroll dev.</span>
<span class="term-fg32">+pub const SCROLL_DEV_L1_MESSAGE_QUEUE_ADDRESS: Address =</span>
<span class="term-fg32">+    address!(&quot;0000000000000000000000000000000000000000&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The L1 proxy address for Scroll dev.</span>
<span class="term-fg32">+pub const SCROLL_DEV_L1_PROXY_ADDRESS: Address =</span>
<span class="term-fg32">+    address!(&quot;0000000000000000000000000000000000000000&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The maximum allowed l1 messages per block for Scroll dev.</span>
<span class="term-fg32">+pub const SCROLL_DEV_MAX_L1_MESSAGES: u64 = 10;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The L1 configuration for Scroll dev.</span>
<span class="term-fg32">+pub const SCROLL_DEV_L1_CONFIG: L1Config = L1Config {</span>
<span class="term-fg32">+    l1_chain_id: alloy_chains::NamedChain::Goerli as u64,</span>
<span class="term-fg32">+    l1_message_queue_address: SCROLL_DEV_L1_MESSAGE_QUEUE_ADDRESS,</span>
<span class="term-fg32">+    scroll_chain_address: SCROLL_DEV_L1_PROXY_ADDRESS,</span>
<span class="term-fg32">+    num_l1_messages_per_block: SCROLL_DEV_MAX_L1_MESSAGES,</span>
<span class="term-fg32">+};</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-dd962492ce98f95754a0826a" role="button"
                       aria-expanded="false" aria-controls="id-dd962492ce98f95754a0826a">
                        <code>crates/scroll/chainspec/src/dev.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/chainspec/src/dev.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+32</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-dd962492ce98f95754a0826a"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;dev.rs scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;dev.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..bba6bfdb0aac38d07ee974f572b1a520b462d760</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;dev.rs</span>
<span class="term-fg36">@@ -0,0 +1,32 @@</span>
<span class="term-fg32">+&#47;&#47;! Chain specification in dev mode for custom chain.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use alloc::sync::Arc;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use alloy_chains::Chain;</span>
<span class="term-fg32">+use alloy_consensus::constants::DEV_GENESIS_HASH;</span>
<span class="term-fg32">+use alloy_primitives::U256;</span>
<span class="term-fg32">+use reth_chainspec::{once_cell_set, BaseFeeParams, BaseFeeParamsKind, ChainSpec};</span>
<span class="term-fg32">+use reth_scroll_forks::DEV_HARDFORKS;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use crate::{LazyLock, ScrollChainConfig, ScrollChainSpec};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Scroll dev testnet specification</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; Includes 20 prefunded accounts with `10_000` ETH each derived from mnemonic &quot;test test test test</span>
<span class="term-fg32">+&#47;&#47;&#47; test test test test test test test junk&quot;.</span>
<span class="term-fg32">+pub static SCROLL_DEV: LazyLock&lt;Arc&lt;ScrollChainSpec&gt;&gt; = LazyLock::new(|| {</span>
<span class="term-fg32">+    ScrollChainSpec {</span>
<span class="term-fg32">+        inner: ChainSpec {</span>
<span class="term-fg32">+            chain: Chain::dev(),</span>
<span class="term-fg32">+            genesis: serde_json::from_str(include_str!(&quot;..&#47;res&#47;genesis&#47;dev.json&quot;))</span>
<span class="term-fg32">+                .expect(&quot;Can&#39;t deserialize Dev testnet genesis json&quot;),</span>
<span class="term-fg32">+            genesis_hash: once_cell_set(DEV_GENESIS_HASH),</span>
<span class="term-fg32">+            paris_block_and_final_difficulty: Some((0, U256::from(0))),</span>
<span class="term-fg32">+            hardforks: DEV_HARDFORKS.clone(),</span>
<span class="term-fg32">+            base_fee_params: BaseFeeParamsKind::Constant(BaseFeeParams::ethereum()),</span>
<span class="term-fg32">+            ..Default::default()</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+        config: ScrollChainConfig::dev(),</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+    .into()</span>
<span class="term-fg32">+});</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f9f78aa851ae0d3e80a01207" role="button"
                       aria-expanded="false" aria-controls="id-f9f78aa851ae0d3e80a01207">
                        <code>crates/scroll/chainspec/src/genesis.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/chainspec/src/genesis.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+225</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f9f78aa851ae0d3e80a01207"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;genesis.rs scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;genesis.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..9bd1a0c654a01f43fe2278a498d5e20d96ea160b</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;genesis.rs</span>
<span class="term-fg36">@@ -0,0 +1,225 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll types for genesis data.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use crate::{</span>
<span class="term-fg32">+    constants::{SCROLL_FEE_VAULT_ADDRESS, SCROLL_MAINNET_L1_CONFIG, SCROLL_SEPOLIA_L1_CONFIG},</span>
<span class="term-fg32">+    SCROLL_DEV_L1_CONFIG,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use alloy_primitives::Address;</span>
<span class="term-fg32">+use alloy_serde::OtherFields;</span>
<span class="term-fg32">+use serde::de::Error;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Container type for all Scroll-specific fields in a genesis file.</span>
<span class="term-fg32">+&#47;&#47;&#47; This struct represents the configuration details and metadata</span>
<span class="term-fg32">+&#47;&#47;&#47; that are specific to the Scroll blockchain, used during the chain&#39;s initialization.</span>
<span class="term-fg32">+#[derive(Default, Debug, Clone, Copy, Eq, PartialEq, serde::Serialize, serde::Deserialize)]</span>
<span class="term-fg32">+#[serde(rename_all = &quot;camelCase&quot;)]</span>
<span class="term-fg32">+pub struct ScrollChainInfo {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Information about hard forks specific to the Scroll chain.</span>
<span class="term-fg32">+    &#47;&#47;&#47; This optional field contains metadata about various hard fork</span>
<span class="term-fg32">+    &#47;&#47;&#47; configurations that are specific to the Scroll blockchain.</span>
<span class="term-fg32">+    pub hard_fork_info: Option&lt;ScrollHardforkInfo&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Scroll chain-specific configuration details.</span>
<span class="term-fg32">+    &#47;&#47;&#47; Encapsulates special parameters and settings</span>
<span class="term-fg32">+    &#47;&#47;&#47; required for Scroll chain functionality, such as fee-related</span>
<span class="term-fg32">+    &#47;&#47;&#47; addresses and Layer 1 configuration.</span>
<span class="term-fg32">+    pub scroll_chain_config: ScrollChainConfig,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollChainInfo {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Extracts the Scroll specific fields from a genesis file. These fields are expected to be</span>
<span class="term-fg32">+    &#47;&#47;&#47; contained in the `genesis.config` under `extra_fields` property.</span>
<span class="term-fg32">+    pub fn extract_from(others: &amp;OtherFields) -&gt; Option&lt;Self&gt; {</span>
<span class="term-fg32">+        Self::try_from(others).ok()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl TryFrom&lt;&amp;OtherFields&gt; for ScrollChainInfo {</span>
<span class="term-fg32">+    type Error = serde_json::Error;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn try_from(others: &amp;OtherFields) -&gt; Result&lt;Self, Self::Error&gt; {</span>
<span class="term-fg32">+        let hard_fork_info = ScrollHardforkInfo::try_from(others).ok();</span>
<span class="term-fg32">+        let scroll_chain_config = ScrollChainConfig::try_from(others)?;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(Self { hard_fork_info, scroll_chain_config })</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; [`ScrollHardforkInfo`] specifies the block numbers and timestamps at which the Scroll hardforks</span>
<span class="term-fg32">+&#47;&#47;&#47; were activated.</span>
<span class="term-fg32">+#[derive(Default, Debug, Clone, Copy, Eq, PartialEq, serde::Serialize, serde::Deserialize)]</span>
<span class="term-fg32">+#[serde(rename_all = &quot;camelCase&quot;)]</span>
<span class="term-fg32">+pub struct ScrollHardforkInfo {</span>
<span class="term-fg32">+    &#47;&#47;&#47; archimedes block number</span>
<span class="term-fg32">+    pub archimedes_block: Option&lt;u64&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; bernoulli block number</span>
<span class="term-fg32">+    pub bernoulli_block: Option&lt;u64&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; curie block number</span>
<span class="term-fg32">+    pub curie_block: Option&lt;u64&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; darwin hardfork timestamp</span>
<span class="term-fg32">+    pub darwin_time: Option&lt;u64&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; darwinV2 hardfork timestamp</span>
<span class="term-fg32">+    pub darwin_v2_time: Option&lt;u64&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollHardforkInfo {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Extract the Scroll-specific genesis info from a genesis file.</span>
<span class="term-fg32">+    pub fn extract_from(others: &amp;OtherFields) -&gt; Option&lt;Self&gt; {</span>
<span class="term-fg32">+        Self::try_from(others).ok()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl TryFrom&lt;&amp;OtherFields&gt; for ScrollHardforkInfo {</span>
<span class="term-fg32">+    type Error = serde_json::Error;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn try_from(others: &amp;OtherFields) -&gt; Result&lt;Self, Self::Error&gt; {</span>
<span class="term-fg32">+        others.deserialize_as()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The Scroll l1 config</span>
<span class="term-fg32">+#[derive(Default, Debug, Clone, Copy, Eq, PartialEq, serde::Serialize, serde::Deserialize)]</span>
<span class="term-fg32">+#[serde(rename_all = &quot;camelCase&quot;)]</span>
<span class="term-fg32">+pub struct L1Config {</span>
<span class="term-fg32">+    &#47;&#47;&#47; l1 chain id</span>
<span class="term-fg32">+    pub l1_chain_id: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The L1 contract address of the contract that handles the message queue targeting the Scroll</span>
<span class="term-fg32">+    &#47;&#47;&#47; rollup.</span>
<span class="term-fg32">+    pub l1_message_queue_address: Address,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The L1 contract address of the proxy contract which is responsible for Scroll rollup</span>
<span class="term-fg32">+    &#47;&#47;&#47; settlement.</span>
<span class="term-fg32">+    pub scroll_chain_address: Address,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The maximum number of L1 messages to be consumed per L2 rollup block.</span>
<span class="term-fg32">+    pub num_l1_messages_per_block: u64,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The configuration for the Scroll sequencer chain.</span>
<span class="term-fg32">+&#47;&#47;&#47; This struct holds the configuration details specific to the Scroll chain,</span>
<span class="term-fg32">+&#47;&#47;&#47; including fee-related addresses and L1 chain-specific settings.</span>
<span class="term-fg32">+#[derive(Default, Debug, Clone, Copy, Eq, PartialEq, serde::Serialize, serde::Deserialize)]</span>
<span class="term-fg32">+#[serde(rename_all = &quot;camelCase&quot;)]</span>
<span class="term-fg32">+pub struct ScrollChainConfig {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The address of the L2 transaction fee vault.</span>
<span class="term-fg32">+    &#47;&#47;&#47; This is an optional field that, when set, specifies where L2 transaction fees</span>
<span class="term-fg32">+    &#47;&#47;&#47; will be sent or stored.</span>
<span class="term-fg32">+    pub fee_vault_address: Option&lt;Address&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The L1 configuration.</span>
<span class="term-fg32">+    &#47;&#47;&#47; This field encapsulates specific settings and parameters required for L1</span>
<span class="term-fg32">+    pub l1_config: L1Config,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollChainConfig {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Extracts the scroll special info by looking for the `scroll` key. It is intended to be</span>
<span class="term-fg32">+    &#47;&#47;&#47; parsed from a genesis file.</span>
<span class="term-fg32">+    pub fn extract_from(others: &amp;OtherFields) -&gt; Option&lt;Self&gt; {</span>
<span class="term-fg32">+        Self::try_from(others).ok()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the [`ScrollChainConfig`] for Scroll Mainnet.</span>
<span class="term-fg32">+    pub const fn mainnet() -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            fee_vault_address: Some(SCROLL_FEE_VAULT_ADDRESS),</span>
<span class="term-fg32">+            l1_config: SCROLL_MAINNET_L1_CONFIG,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the [`ScrollChainConfig`] for Scroll Sepolia.</span>
<span class="term-fg32">+    pub const fn sepolia() -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            fee_vault_address: Some(SCROLL_FEE_VAULT_ADDRESS),</span>
<span class="term-fg32">+            l1_config: SCROLL_SEPOLIA_L1_CONFIG,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the [`ScrollChainConfig`] for Scroll dev.</span>
<span class="term-fg32">+    pub const fn dev() -&gt; Self {</span>
<span class="term-fg32">+        Self { fee_vault_address: Some(SCROLL_FEE_VAULT_ADDRESS), l1_config: SCROLL_DEV_L1_CONFIG }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl TryFrom&lt;&amp;OtherFields&gt; for ScrollChainConfig {</span>
<span class="term-fg32">+    type Error = serde_json::Error;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn try_from(others: &amp;OtherFields) -&gt; Result&lt;Self, Self::Error&gt; {</span>
<span class="term-fg32">+        if let Some(Ok(scroll_chain_config)) = others.get_deserialized::&lt;Self&gt;(&quot;scroll&quot;) {</span>
<span class="term-fg32">+            Ok(scroll_chain_config)</span>
<span class="term-fg32">+        } else {</span>
<span class="term-fg32">+            Err(serde_json::Error::missing_field(&quot;scroll&quot;))</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(test)]</span>
<span class="term-fg32">+mod tests {</span>
<span class="term-fg32">+    use super::*;</span>
<span class="term-fg32">+    use alloy_primitives::address;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_extract_scroll_genesis_info() {</span>
<span class="term-fg32">+        let genesis_info = r#&quot;</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+          &quot;archimedesBlock&quot;: 0,</span>
<span class="term-fg32">+          &quot;bernoulliBlock&quot;: 10,</span>
<span class="term-fg32">+          &quot;curieBlock&quot;: 12,</span>
<span class="term-fg32">+          &quot;darwinTime&quot;: 0</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        &quot;#;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let others: OtherFields = serde_json::from_str(genesis_info).unwrap();</span>
<span class="term-fg32">+        let genesis_info = ScrollHardforkInfo::extract_from(&amp;others).unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        assert_eq!(</span>
<span class="term-fg32">+            genesis_info,</span>
<span class="term-fg32">+            ScrollHardforkInfo {</span>
<span class="term-fg32">+                archimedes_block: Some(0),</span>
<span class="term-fg32">+                bernoulli_block: Some(10),</span>
<span class="term-fg32">+                curie_block: Some(12),</span>
<span class="term-fg32">+                darwin_time: Some(0),</span>
<span class="term-fg32">+                darwin_v2_time: None,</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_extract_scroll_chain_info() {</span>
<span class="term-fg32">+        let chain_info_str = r#&quot;</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+          &quot;archimedesBlock&quot;: 0,</span>
<span class="term-fg32">+          &quot;bernoulliBlock&quot;: 10,</span>
<span class="term-fg32">+          &quot;curieBlock&quot;: 12,</span>
<span class="term-fg32">+          &quot;darwinTime&quot;: 0,</span>
<span class="term-fg32">+          &quot;scroll&quot;: {</span>
<span class="term-fg32">+            &quot;feeVaultAddress&quot;: &quot;0x5300000000000000000000000000000000000005&quot;,</span>
<span class="term-fg32">+            &quot;l1Config&quot;: {</span>
<span class="term-fg32">+                &quot;l1ChainId&quot;: 1,</span>
<span class="term-fg32">+                &quot;l1MessageQueueAddress&quot;: &quot;0x0d7E906BD9cAFa154b048cFa766Cc1E54E39AF9B&quot;,</span>
<span class="term-fg32">+                &quot;scrollChainAddress&quot;: &quot;0xa13BAF47339d63B743e7Da8741db5456DAc1E556&quot;,</span>
<span class="term-fg32">+                &quot;numL1MessagesPerBlock&quot;: 10</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+          }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        &quot;#;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let others: OtherFields = serde_json::from_str(chain_info_str).unwrap();</span>
<span class="term-fg32">+        let chain_info = ScrollChainInfo::extract_from(&amp;others).unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let expected = ScrollChainInfo {</span>
<span class="term-fg32">+            hard_fork_info: Some(ScrollHardforkInfo {</span>
<span class="term-fg32">+                archimedes_block: Some(0),</span>
<span class="term-fg32">+                bernoulli_block: Some(10),</span>
<span class="term-fg32">+                curie_block: Some(12),</span>
<span class="term-fg32">+                darwin_time: Some(0),</span>
<span class="term-fg32">+                darwin_v2_time: None,</span>
<span class="term-fg32">+            }),</span>
<span class="term-fg32">+            scroll_chain_config: ScrollChainConfig {</span>
<span class="term-fg32">+                fee_vault_address: Some(address!(&quot;5300000000000000000000000000000000000005&quot;)),</span>
<span class="term-fg32">+                l1_config: L1Config {</span>
<span class="term-fg32">+                    l1_chain_id: 1,</span>
<span class="term-fg32">+                    l1_message_queue_address: address!(&quot;0d7E906BD9cAFa154b048cFa766Cc1E54E39AF9B&quot;),</span>
<span class="term-fg32">+                    scroll_chain_address: address!(&quot;a13BAF47339d63B743e7Da8741db5456DAc1E556&quot;),</span>
<span class="term-fg32">+                    num_l1_messages_per_block: 10,</span>
<span class="term-fg32">+                },</span>
<span class="term-fg32">+            },</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        assert_eq!(chain_info, expected);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-698108b2b74f5564d5276775" role="button"
                       aria-expanded="false" aria-controls="id-698108b2b74f5564d5276775">
                        <code>crates/scroll/chainspec/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/chainspec/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+596</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-698108b2b74f5564d5276775"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..764727482929b219e3cc48521b49981e2244657e</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,596 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll-Reth chain specs.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![doc(</span>
<span class="term-fg32">+    html_logo_url = &quot;https:&#47;&#47;raw.githubusercontent.com&#47;paradigmxyz&#47;reth&#47;main&#47;assets&#47;reth-docs.png&quot;,</span>
<span class="term-fg32">+    html_favicon_url = &quot;https:&#47;&#47;avatars0.githubusercontent.com&#47;u&#47;97369466?s=256&quot;,</span>
<span class="term-fg32">+    issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;</span>
<span class="term-fg32">+)]</span>
<span class="term-fg32">+#![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]</span>
<span class="term-fg32">+#![cfg_attr(not(feature = &quot;std&quot;), no_std)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use alloc::{boxed::Box, vec::Vec};</span>
<span class="term-fg32">+use alloy_chains::Chain;</span>
<span class="term-fg32">+use alloy_consensus::Header;</span>
<span class="term-fg32">+use alloy_genesis::Genesis;</span>
<span class="term-fg32">+use alloy_primitives::{B256, U256};</span>
<span class="term-fg32">+use derive_more::{Constructor, Deref, Display, From, Into};</span>
<span class="term-fg32">+use reth_chainspec::{</span>
<span class="term-fg32">+    BaseFeeParams, ChainSpec, ChainSpecBuilder, DepositContract, EthChainSpec, EthereumHardforks,</span>
<span class="term-fg32">+    ForkFilter, ForkId, Hardforks, Head,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_ethereum_forks::{ChainHardforks, EthereumHardfork, ForkCondition, Hardfork};</span>
<span class="term-fg32">+use reth_network_peers::NodeRecord;</span>
<span class="term-fg32">+use reth_scroll_forks::ScrollHardforks;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(not(feature = &quot;std&quot;))]</span>
<span class="term-fg32">+use once_cell::sync::Lazy as LazyLock;</span>
<span class="term-fg32">+#[cfg(feature = &quot;std&quot;)]</span>
<span class="term-fg32">+use std::sync::LazyLock;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+extern crate alloc;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod constants;</span>
<span class="term-fg32">+pub use constants::{</span>
<span class="term-fg32">+    SCROLL_DEV_L1_CONFIG, SCROLL_DEV_L1_MESSAGE_QUEUE_ADDRESS, SCROLL_DEV_L1_PROXY_ADDRESS,</span>
<span class="term-fg32">+    SCROLL_DEV_MAX_L1_MESSAGES, SCROLL_FEE_VAULT_ADDRESS, SCROLL_MAINNET_L1_CONFIG,</span>
<span class="term-fg32">+    SCROLL_MAINNET_L1_MESSAGE_QUEUE_ADDRESS, SCROLL_MAINNET_L1_PROXY_ADDRESS,</span>
<span class="term-fg32">+    SCROLL_MAINNET_MAX_L1_MESSAGES, SCROLL_SEPOLIA_L1_CONFIG,</span>
<span class="term-fg32">+    SCROLL_SEPOLIA_L1_MESSAGE_QUEUE_ADDRESS, SCROLL_SEPOLIA_L1_PROXY_ADDRESS,</span>
<span class="term-fg32">+    SCROLL_SEPOLIA_MAX_L1_MESSAGES,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod dev;</span>
<span class="term-fg32">+pub use dev::SCROLL_DEV;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod genesis;</span>
<span class="term-fg32">+pub use genesis::{ScrollChainConfig, ScrollChainInfo};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; convenience re-export of the chain spec provider.</span>
<span class="term-fg32">+pub use reth_chainspec::ChainSpecProvider;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod scroll;</span>
<span class="term-fg32">+pub use scroll::SCROLL_MAINNET;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod scroll_sepolia;</span>
<span class="term-fg32">+pub use scroll_sepolia::SCROLL_SEPOLIA;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Chain spec builder for a Scroll chain.</span>
<span class="term-fg32">+#[derive(Debug, Default, From)]</span>
<span class="term-fg32">+pub struct ScrollChainSpecBuilder {</span>
<span class="term-fg32">+    &#47;&#47;&#47; [`ChainSpecBuilder`]</span>
<span class="term-fg32">+    inner: ChainSpecBuilder,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollChainSpecBuilder {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Construct a new builder from the scroll mainnet chain spec.</span>
<span class="term-fg32">+    pub fn scroll_mainnet() -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            inner: ChainSpecBuilder::default()</span>
<span class="term-fg32">+                .chain(SCROLL_MAINNET.chain)</span>
<span class="term-fg32">+                .genesis(SCROLL_MAINNET.genesis.clone())</span>
<span class="term-fg32">+                .with_forks(SCROLL_MAINNET.hardforks.clone()),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Construct a new builder from the scroll sepolia chain spec.</span>
<span class="term-fg32">+    pub fn scroll_sepolia() -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            inner: ChainSpecBuilder::default()</span>
<span class="term-fg32">+                .chain(SCROLL_SEPOLIA.chain)</span>
<span class="term-fg32">+                .genesis(SCROLL_SEPOLIA.genesis.clone())</span>
<span class="term-fg32">+                .with_forks(SCROLL_SEPOLIA.hardforks.clone()),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollChainSpecBuilder {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set the chain ID</span>
<span class="term-fg32">+    pub fn chain(mut self, chain: Chain) -&gt; Self {</span>
<span class="term-fg32">+        self.inner = self.inner.chain(chain);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set the genesis block.</span>
<span class="term-fg32">+    pub fn genesis(mut self, genesis: Genesis) -&gt; Self {</span>
<span class="term-fg32">+        self.inner = self.inner.genesis(genesis);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Add the given fork with the given activation condition to the spec.</span>
<span class="term-fg32">+    pub fn with_fork&lt;H: Hardfork&gt;(mut self, fork: H, condition: ForkCondition) -&gt; Self {</span>
<span class="term-fg32">+        self.inner = self.inner.with_fork(fork, condition);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Add the given forks with the given activation condition to the spec.</span>
<span class="term-fg32">+    pub fn with_forks(mut self, forks: ChainHardforks) -&gt; Self {</span>
<span class="term-fg32">+        self.inner = self.inner.with_forks(forks);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Remove the given fork from the spec.</span>
<span class="term-fg32">+    pub fn without_fork(mut self, fork: reth_scroll_forks::ScrollHardfork) -&gt; Self {</span>
<span class="term-fg32">+        self.inner = self.inner.without_fork(fork);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Enable Archimedes at genesis</span>
<span class="term-fg32">+    pub fn archimedes_activated(mut self) -&gt; Self {</span>
<span class="term-fg32">+        self.inner = self.inner.london_activated();</span>
<span class="term-fg32">+        self.inner = self</span>
<span class="term-fg32">+            .inner</span>
<span class="term-fg32">+            .with_fork(reth_scroll_forks::ScrollHardfork::Archimedes, ForkCondition::Block(0));</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Enable Bernoulli at genesis</span>
<span class="term-fg32">+    pub fn bernoulli_activated(mut self) -&gt; Self {</span>
<span class="term-fg32">+        self = self.archimedes_activated();</span>
<span class="term-fg32">+        self.inner = self.inner.with_fork(EthereumHardfork::Shanghai, ForkCondition::Timestamp(0));</span>
<span class="term-fg32">+        self.inner = self</span>
<span class="term-fg32">+            .inner</span>
<span class="term-fg32">+            .with_fork(reth_scroll_forks::ScrollHardfork::Bernoulli, ForkCondition::Block(0));</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Enable Curie at genesis</span>
<span class="term-fg32">+    pub fn curie_activated(mut self) -&gt; Self {</span>
<span class="term-fg32">+        self = self.bernoulli_activated();</span>
<span class="term-fg32">+        self.inner =</span>
<span class="term-fg32">+            self.inner.with_fork(reth_scroll_forks::ScrollHardfork::Curie, ForkCondition::Block(0));</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Enable Darwin at genesis</span>
<span class="term-fg32">+    pub fn darwin_activated(mut self) -&gt; Self {</span>
<span class="term-fg32">+        self = self.curie_activated();</span>
<span class="term-fg32">+        self.inner = self</span>
<span class="term-fg32">+            .inner</span>
<span class="term-fg32">+            .with_fork(reth_scroll_forks::ScrollHardfork::Darwin, ForkCondition::Timestamp(0));</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Enable `DarwinV2` at genesis</span>
<span class="term-fg32">+    pub fn darwin_v2_activated(mut self) -&gt; Self {</span>
<span class="term-fg32">+        self = self.darwin_activated();</span>
<span class="term-fg32">+        self.inner = self</span>
<span class="term-fg32">+            .inner</span>
<span class="term-fg32">+            .with_fork(reth_scroll_forks::ScrollHardfork::DarwinV2, ForkCondition::Timestamp(0));</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Build the resulting [`ScrollChainSpec`].</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; # Panics</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; This function panics if the chain ID and genesis is not set ([`Self::chain`] and</span>
<span class="term-fg32">+    &#47;&#47;&#47; [`Self::genesis`])</span>
<span class="term-fg32">+    pub fn build(self, config: ScrollChainConfig) -&gt; ScrollChainSpec {</span>
<span class="term-fg32">+        ScrollChainSpec { inner: self.inner.build(), config }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Scroll chain spec type.</span>
<span class="term-fg32">+#[derive(Debug, Clone, Deref, Into, Constructor, PartialEq, Eq)]</span>
<span class="term-fg32">+pub struct ScrollChainSpec {</span>
<span class="term-fg32">+    &#47;&#47;&#47; [`ChainSpec`].</span>
<span class="term-fg32">+    #[deref]</span>
<span class="term-fg32">+    pub inner: ChainSpec,</span>
<span class="term-fg32">+    &#47;&#47;&#47; [`ScrollChainConfig`]</span>
<span class="term-fg32">+    pub config: ScrollChainConfig,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl EthChainSpec for ScrollChainSpec {</span>
<span class="term-fg32">+    fn chain(&amp;self) -&gt; alloy_chains::Chain {</span>
<span class="term-fg32">+        self.inner.chain()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn base_fee_params_at_block(&amp;self, block_number: u64) -&gt; BaseFeeParams {</span>
<span class="term-fg32">+        &#47;&#47; TODO(scroll): need to implement Scroll L2 formula related to https:&#47;&#47;github.com&#47;scroll-tech&#47;reth&#47;issues&#47;60</span>
<span class="term-fg32">+        self.inner.base_fee_params_at_block(block_number)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn base_fee_params_at_timestamp(&amp;self, timestamp: u64) -&gt; BaseFeeParams {</span>
<span class="term-fg32">+        &#47;&#47; TODO(scroll): need to implement Scroll L2 formula related to https:&#47;&#47;github.com&#47;scroll-tech&#47;reth&#47;issues&#47;60</span>
<span class="term-fg32">+        self.inner.base_fee_params_at_timestamp(timestamp)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn deposit_contract(&amp;self) -&gt; Option&lt;&amp;DepositContract&gt; {</span>
<span class="term-fg32">+        self.inner.deposit_contract()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn genesis_hash(&amp;self) -&gt; B256 {</span>
<span class="term-fg32">+        *self.genesis_hash.get_or_init(|| self.genesis_header().hash_slow())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn prune_delete_limit(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.inner.prune_delete_limit()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn display_hardforks(&amp;self) -&gt; Box&lt;dyn Display&gt; {</span>
<span class="term-fg32">+        Box::new(ChainSpec::display_hardforks(self))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn genesis_header(&amp;self) -&gt; &amp;Header {</span>
<span class="term-fg32">+        self.inner.genesis_header.get_or_init(|| self.make_genesis_header())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn genesis(&amp;self) -&gt; &amp;Genesis {</span>
<span class="term-fg32">+        self.inner.genesis()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn max_gas_limit(&amp;self) -&gt; u64 {</span>
<span class="term-fg32">+        self.inner.max_gas_limit()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn bootnodes(&amp;self) -&gt; Option&lt;Vec&lt;NodeRecord&gt;&gt; {</span>
<span class="term-fg32">+        self.inner.bootnodes()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollChainSpec {</span>
<span class="term-fg32">+    fn make_genesis_header(&amp;self) -&gt; Header {</span>
<span class="term-fg32">+        Header {</span>
<span class="term-fg32">+            gas_limit: self.genesis.gas_limit,</span>
<span class="term-fg32">+            difficulty: self.genesis.difficulty,</span>
<span class="term-fg32">+            nonce: self.genesis.nonce.into(),</span>
<span class="term-fg32">+            extra_data: self.genesis.extra_data.clone(),</span>
<span class="term-fg32">+            state_root: reth_scroll_state_commitment::state_root_ref_unhashed(&amp;self.genesis.alloc),</span>
<span class="term-fg32">+            timestamp: self.genesis.timestamp,</span>
<span class="term-fg32">+            mix_hash: self.genesis.mix_hash,</span>
<span class="term-fg32">+            beneficiary: self.genesis.coinbase,</span>
<span class="term-fg32">+            base_fee_per_gas: None,</span>
<span class="term-fg32">+            withdrawals_root: None,</span>
<span class="term-fg32">+            parent_beacon_block_root: None,</span>
<span class="term-fg32">+            blob_gas_used: None,</span>
<span class="term-fg32">+            excess_blob_gas: None,</span>
<span class="term-fg32">+            requests_hash: None,</span>
<span class="term-fg32">+            ..Default::default()</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Hardforks for ScrollChainSpec {</span>
<span class="term-fg32">+    fn fork&lt;H: reth_chainspec::Hardfork&gt;(&amp;self, fork: H) -&gt; reth_chainspec::ForkCondition {</span>
<span class="term-fg32">+        self.inner.fork(fork)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn forks_iter(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+    ) -&gt; impl Iterator&lt;Item = (&amp;dyn reth_chainspec::Hardfork, reth_chainspec::ForkCondition)&gt; {</span>
<span class="term-fg32">+        self.inner.forks_iter()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn fork_id(&amp;self, head: &amp;Head) -&gt; ForkId {</span>
<span class="term-fg32">+        self.inner.fork_id(head)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn latest_fork_id(&amp;self) -&gt; ForkId {</span>
<span class="term-fg32">+        self.inner.latest_fork_id()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn fork_filter(&amp;self, head: Head) -&gt; ForkFilter {</span>
<span class="term-fg32">+        self.inner.fork_filter(head)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl EthereumHardforks for ScrollChainSpec {</span>
<span class="term-fg32">+    fn get_final_paris_total_difficulty(&amp;self) -&gt; Option&lt;U256&gt; {</span>
<span class="term-fg32">+        self.inner.get_final_paris_total_difficulty()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn final_paris_total_difficulty(&amp;self, block_number: u64) -&gt; Option&lt;U256&gt; {</span>
<span class="term-fg32">+        self.inner.final_paris_total_difficulty(block_number)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollHardforks for ScrollChainSpec {}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;Genesis&gt; for ScrollChainSpec {</span>
<span class="term-fg32">+    fn from(genesis: Genesis) -&gt; Self {</span>
<span class="term-fg32">+        use reth_scroll_forks::ScrollHardfork;</span>
<span class="term-fg32">+        let scroll_chain_info = ScrollConfigInfo::extract_from(&amp;genesis);</span>
<span class="term-fg32">+        let hard_fork_info =</span>
<span class="term-fg32">+            scroll_chain_info.scroll_chain_info.hard_fork_info.expect(&quot;load scroll hard fork info&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; Block-based hardforks</span>
<span class="term-fg32">+        let hardfork_opts = [</span>
<span class="term-fg32">+            (EthereumHardfork::Homestead.boxed(), genesis.config.homestead_block),</span>
<span class="term-fg32">+            (EthereumHardfork::Tangerine.boxed(), genesis.config.eip150_block),</span>
<span class="term-fg32">+            (EthereumHardfork::SpuriousDragon.boxed(), genesis.config.eip155_block),</span>
<span class="term-fg32">+            (EthereumHardfork::Byzantium.boxed(), genesis.config.byzantium_block),</span>
<span class="term-fg32">+            (EthereumHardfork::Constantinople.boxed(), genesis.config.constantinople_block),</span>
<span class="term-fg32">+            (EthereumHardfork::Petersburg.boxed(), genesis.config.petersburg_block),</span>
<span class="term-fg32">+            (EthereumHardfork::Istanbul.boxed(), genesis.config.istanbul_block),</span>
<span class="term-fg32">+            (EthereumHardfork::Berlin.boxed(), genesis.config.berlin_block),</span>
<span class="term-fg32">+            (EthereumHardfork::London.boxed(), genesis.config.london_block),</span>
<span class="term-fg32">+            (ScrollHardfork::Archimedes.boxed(), hard_fork_info.archimedes_block),</span>
<span class="term-fg32">+            (ScrollHardfork::Bernoulli.boxed(), hard_fork_info.bernoulli_block),</span>
<span class="term-fg32">+            (ScrollHardfork::Curie.boxed(), hard_fork_info.curie_block),</span>
<span class="term-fg32">+        ];</span>
<span class="term-fg32">+        let mut block_hardforks = hardfork_opts</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .filter_map(|(hardfork, opt)| opt.map(|block| (hardfork, ForkCondition::Block(block))))</span>
<span class="term-fg32">+            .collect::&lt;Vec&lt;_&gt;&gt;();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; Time-based hardforks</span>
<span class="term-fg32">+        let time_hardfork_opts = [</span>
<span class="term-fg32">+            (EthereumHardfork::Shanghai.boxed(), genesis.config.shanghai_time),</span>
<span class="term-fg32">+            (ScrollHardfork::Darwin.boxed(), hard_fork_info.darwin_time),</span>
<span class="term-fg32">+            (ScrollHardfork::DarwinV2.boxed(), hard_fork_info.darwin_v2_time),</span>
<span class="term-fg32">+        ];</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut time_hardforks = time_hardfork_opts</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .filter_map(|(hardfork, opt)| {</span>
<span class="term-fg32">+                opt.map(|time| (hardfork, ForkCondition::Timestamp(time)))</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect::&lt;Vec&lt;_&gt;&gt;();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        block_hardforks.append(&amp;mut time_hardforks);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; Ordered Hardforks</span>
<span class="term-fg32">+        let mainnet_hardforks = ScrollHardfork::scroll_mainnet();</span>
<span class="term-fg32">+        let mainnet_order = mainnet_hardforks.forks_iter();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut ordered_hardforks = Vec::with_capacity(block_hardforks.len());</span>
<span class="term-fg32">+        for (hardfork, _) in mainnet_order {</span>
<span class="term-fg32">+            if let Some(pos) = block_hardforks.iter().position(|(e, _)| **e == *hardfork) {</span>
<span class="term-fg32">+                ordered_hardforks.push(block_hardforks.remove(pos));</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; append the remaining unknown hardforks to ensure we don&#39;t filter any out</span>
<span class="term-fg32">+        ordered_hardforks.append(&amp;mut block_hardforks);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            inner: ChainSpec {</span>
<span class="term-fg32">+                chain: genesis.config.chain_id.into(),</span>
<span class="term-fg32">+                genesis,</span>
<span class="term-fg32">+                hardforks: ChainHardforks::new(ordered_hardforks),</span>
<span class="term-fg32">+                ..Default::default()</span>
<span class="term-fg32">+            },</span>
<span class="term-fg32">+            config: scroll_chain_info.scroll_chain_info.scroll_chain_config,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[derive(Default, Debug)]</span>
<span class="term-fg32">+struct ScrollConfigInfo {</span>
<span class="term-fg32">+    scroll_chain_info: ScrollChainInfo,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollConfigInfo {</span>
<span class="term-fg32">+    fn extract_from(genesis: &amp;Genesis) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            scroll_chain_info: ScrollChainInfo::extract_from(&amp;genesis.config.extra_fields)</span>
<span class="term-fg32">+                .expect(&quot;extract scroll extra fields failed&quot;),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(test)]</span>
<span class="term-fg32">+mod tests {</span>
<span class="term-fg32">+    use crate::*;</span>
<span class="term-fg32">+    use alloy_genesis::{ChainConfig, Genesis};</span>
<span class="term-fg32">+    use alloy_primitives::b256;</span>
<span class="term-fg32">+    use reth_chainspec::test_fork_ids;</span>
<span class="term-fg32">+    use reth_ethereum_forks::{EthereumHardfork, ForkHash};</span>
<span class="term-fg32">+    use reth_scroll_forks::ScrollHardfork;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn scroll_mainnet_genesis_hash() {</span>
<span class="term-fg32">+        let scroll_mainnet =</span>
<span class="term-fg32">+            ScrollChainSpecBuilder::scroll_mainnet().build(ScrollChainConfig::mainnet());</span>
<span class="term-fg32">+        assert_eq!(</span>
<span class="term-fg32">+            b256!(&quot;bbc05efd412b7cd47a2ed0e5ddfcf87af251e414ea4c801d78b6784513180a80&quot;),</span>
<span class="term-fg32">+            scroll_mainnet.genesis_hash()</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn scroll_sepolia_genesis_hash() {</span>
<span class="term-fg32">+        let scroll_sepolia =</span>
<span class="term-fg32">+            ScrollChainSpecBuilder::scroll_sepolia().build(ScrollChainConfig::sepolia());</span>
<span class="term-fg32">+        assert_eq!(</span>
<span class="term-fg32">+            b256!(&quot;aa62d1a8b2bffa9e5d2368b63aae0d98d54928bd713125e3fd9e5c896c68592c&quot;),</span>
<span class="term-fg32">+            scroll_sepolia.genesis_hash()</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn scroll_mainnet_forkids() {</span>
<span class="term-fg32">+        test_fork_ids(</span>
<span class="term-fg32">+            &amp;SCROLL_MAINNET,</span>
<span class="term-fg32">+            &amp;[</span>
<span class="term-fg32">+                (</span>
<span class="term-fg32">+                    Head { number: 0, ..Default::default() },</span>
<span class="term-fg32">+                    ForkId { hash: ForkHash([0xea, 0x6b, 0x56, 0xca]), next: 5220340 },</span>
<span class="term-fg32">+                ),</span>
<span class="term-fg32">+                (</span>
<span class="term-fg32">+                    Head { number: 5220340, ..Default::default() },</span>
<span class="term-fg32">+                    ForkId { hash: ForkHash([0xee, 0x46, 0xae, 0x2a]), next: 7096836 },</span>
<span class="term-fg32">+                ),</span>
<span class="term-fg32">+                (</span>
<span class="term-fg32">+                    Head { number: 7096836, ..Default::default() },</span>
<span class="term-fg32">+                    ForkId { hash: ForkHash([0x18, 0xd3, 0xc8, 0xd9]), next: 1724227200 },</span>
<span class="term-fg32">+                ),</span>
<span class="term-fg32">+                (</span>
<span class="term-fg32">+                    Head { number: 7096836, timestamp: 1724227200, ..Default::default() },</span>
<span class="term-fg32">+                    ForkId { hash: ForkHash([0xcc, 0xeb, 0x09, 0xb0]), next: 1725264000 },</span>
<span class="term-fg32">+                ),</span>
<span class="term-fg32">+                (</span>
<span class="term-fg32">+                    Head { number: 7096836, timestamp: 1725264000, ..Default::default() },</span>
<span class="term-fg32">+                    ForkId { hash: ForkHash([0x21, 0xa2, 0x07, 0x54]), next: 0 },</span>
<span class="term-fg32">+                ),</span>
<span class="term-fg32">+            ],</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn scroll_sepolia_forkids() {</span>
<span class="term-fg32">+        test_fork_ids(</span>
<span class="term-fg32">+            &amp;SCROLL_SEPOLIA,</span>
<span class="term-fg32">+            &amp;[</span>
<span class="term-fg32">+                (</span>
<span class="term-fg32">+                    Head { number: 0, ..Default::default() },</span>
<span class="term-fg32">+                    ForkId { hash: ForkHash([0x25, 0xfa, 0xe4, 0x54]), next: 3747132 },</span>
<span class="term-fg32">+                ),</span>
<span class="term-fg32">+                (</span>
<span class="term-fg32">+                    Head { number: 3747132, ..Default::default() },</span>
<span class="term-fg32">+                    ForkId { hash: ForkHash([0xda, 0x76, 0xc2, 0x2d]), next: 4740239 },</span>
<span class="term-fg32">+                ),</span>
<span class="term-fg32">+                (</span>
<span class="term-fg32">+                    Head { number: 4740239, ..Default::default() },</span>
<span class="term-fg32">+                    ForkId { hash: ForkHash([0x9f, 0xb4, 0x75, 0xf1]), next: 1723622400 },</span>
<span class="term-fg32">+                ),</span>
<span class="term-fg32">+                (</span>
<span class="term-fg32">+                    Head { number: 4740239, timestamp: 1723622400, ..Default::default() },</span>
<span class="term-fg32">+                    ForkId { hash: ForkHash([0xe9, 0x26, 0xd4, 0x9b]), next: 1724832000 },</span>
<span class="term-fg32">+                ),</span>
<span class="term-fg32">+                (</span>
<span class="term-fg32">+                    Head { number: 4740239, timestamp: 1724832000, ..Default::default() },</span>
<span class="term-fg32">+                    ForkId { hash: ForkHash([0x69, 0xf3, 0x7e, 0xde]), next: 0 },</span>
<span class="term-fg32">+                ),</span>
<span class="term-fg32">+            ],</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn is_bernoulli_active() {</span>
<span class="term-fg32">+        let scroll_mainnet =</span>
<span class="term-fg32">+            ScrollChainSpecBuilder::scroll_mainnet().build(ScrollChainConfig::mainnet());</span>
<span class="term-fg32">+        assert!(!scroll_mainnet.is_bernoulli_active_at_block(1))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn parse_scroll_hardforks() {</span>
<span class="term-fg32">+        let geth_genesis = r#&quot;</span>
<span class="term-fg32">+    {</span>
<span class="term-fg32">+      &quot;config&quot;: {</span>
<span class="term-fg32">+        &quot;bernoulliBlock&quot;: 10,</span>
<span class="term-fg32">+        &quot;curieBlock&quot;: 20,</span>
<span class="term-fg32">+        &quot;darwinTime&quot;: 30,</span>
<span class="term-fg32">+        &quot;darwinV2Time&quot;: 31,</span>
<span class="term-fg32">+        &quot;scroll&quot;: {</span>
<span class="term-fg32">+            &quot;feeVaultAddress&quot;: &quot;0x5300000000000000000000000000000000000005&quot;,</span>
<span class="term-fg32">+            &quot;l1Config&quot;: {</span>
<span class="term-fg32">+                &quot;l1ChainId&quot;: 1,</span>
<span class="term-fg32">+                &quot;l1MessageQueueAddress&quot;: &quot;0x0d7E906BD9cAFa154b048cFa766Cc1E54E39AF9B&quot;,</span>
<span class="term-fg32">+                &quot;scrollChainAddress&quot;: &quot;0xa13BAF47339d63B743e7Da8741db5456DAc1E556&quot;,</span>
<span class="term-fg32">+                &quot;numL1MessagesPerBlock&quot;: 10</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+    &quot;#;</span>
<span class="term-fg32">+        let genesis: Genesis = serde_json::from_str(geth_genesis).unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let actual_bernoulli_block = genesis.config.extra_fields.get(&quot;bernoulliBlock&quot;);</span>
<span class="term-fg32">+        assert_eq!(actual_bernoulli_block, Some(serde_json::Value::from(10)).as_ref());</span>
<span class="term-fg32">+        let actual_curie_block = genesis.config.extra_fields.get(&quot;curieBlock&quot;);</span>
<span class="term-fg32">+        assert_eq!(actual_curie_block, Some(serde_json::Value::from(20)).as_ref());</span>
<span class="term-fg32">+        let actual_darwin_timestamp = genesis.config.extra_fields.get(&quot;darwinTime&quot;);</span>
<span class="term-fg32">+        assert_eq!(actual_darwin_timestamp, Some(serde_json::Value::from(30)).as_ref());</span>
<span class="term-fg32">+        let actual_darwin_v2_timestamp = genesis.config.extra_fields.get(&quot;darwinV2Time&quot;);</span>
<span class="term-fg32">+        assert_eq!(actual_darwin_v2_timestamp, Some(serde_json::Value::from(31)).as_ref());</span>
<span class="term-fg32">+        let scroll_object = genesis.config.extra_fields.get(&quot;scroll&quot;).unwrap();</span>
<span class="term-fg32">+        assert_eq!(</span>
<span class="term-fg32">+            scroll_object,</span>
<span class="term-fg32">+            &amp;serde_json::json!({</span>
<span class="term-fg32">+                &quot;feeVaultAddress&quot;: &quot;0x5300000000000000000000000000000000000005&quot;,</span>
<span class="term-fg32">+                &quot;l1Config&quot;: {</span>
<span class="term-fg32">+                    &quot;l1ChainId&quot;: 1,</span>
<span class="term-fg32">+                    &quot;l1MessageQueueAddress&quot;: &quot;0x0d7E906BD9cAFa154b048cFa766Cc1E54E39AF9B&quot;,</span>
<span class="term-fg32">+                    &quot;scrollChainAddress&quot;: &quot;0xa13BAF47339d63B743e7Da8741db5456DAc1E556&quot;,</span>
<span class="term-fg32">+                    &quot;numL1MessagesPerBlock&quot;: 10</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let chain_spec: ScrollChainSpec = genesis.into();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        assert!(!chain_spec.is_fork_active_at_block(ScrollHardfork::Bernoulli, 0));</span>
<span class="term-fg32">+        assert!(!chain_spec.is_fork_active_at_block(ScrollHardfork::Curie, 0));</span>
<span class="term-fg32">+        assert!(!chain_spec.is_fork_active_at_timestamp(ScrollHardfork::Darwin, 0));</span>
<span class="term-fg32">+        assert!(!chain_spec.is_fork_active_at_timestamp(ScrollHardfork::DarwinV2, 0));</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        assert!(chain_spec.is_fork_active_at_block(ScrollHardfork::Bernoulli, 10));</span>
<span class="term-fg32">+        assert!(chain_spec.is_fork_active_at_block(ScrollHardfork::Curie, 20));</span>
<span class="term-fg32">+        assert!(chain_spec.is_fork_active_at_timestamp(ScrollHardfork::Darwin, 30));</span>
<span class="term-fg32">+        assert!(chain_spec.is_fork_active_at_timestamp(ScrollHardfork::DarwinV2, 31));</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_fork_order_scroll_mainnet() {</span>
<span class="term-fg32">+        let genesis = Genesis {</span>
<span class="term-fg32">+            config: ChainConfig {</span>
<span class="term-fg32">+                chain_id: 0,</span>
<span class="term-fg32">+                homestead_block: Some(0),</span>
<span class="term-fg32">+                dao_fork_block: Some(0),</span>
<span class="term-fg32">+                dao_fork_support: false,</span>
<span class="term-fg32">+                eip150_block: Some(0),</span>
<span class="term-fg32">+                eip155_block: Some(0),</span>
<span class="term-fg32">+                eip158_block: Some(0),</span>
<span class="term-fg32">+                byzantium_block: Some(0),</span>
<span class="term-fg32">+                constantinople_block: Some(0),</span>
<span class="term-fg32">+                petersburg_block: Some(0),</span>
<span class="term-fg32">+                istanbul_block: Some(0),</span>
<span class="term-fg32">+                berlin_block: Some(0),</span>
<span class="term-fg32">+                london_block: Some(0),</span>
<span class="term-fg32">+                shanghai_time: Some(0),</span>
<span class="term-fg32">+                extra_fields: [</span>
<span class="term-fg32">+                    (String::from(&quot;archimedesBlock&quot;), 0.into()),</span>
<span class="term-fg32">+                    (String::from(&quot;bernoulliBlock&quot;), 0.into()),</span>
<span class="term-fg32">+                    (String::from(&quot;curieBlock&quot;), 0.into()),</span>
<span class="term-fg32">+                    (String::from(&quot;darwinTime&quot;), 0.into()),</span>
<span class="term-fg32">+                    (String::from(&quot;darwinV2Time&quot;), 0.into()),</span>
<span class="term-fg32">+                    (</span>
<span class="term-fg32">+                        String::from(&quot;scroll&quot;),</span>
<span class="term-fg32">+                        serde_json::json!({</span>
<span class="term-fg32">+                            &quot;feeVaultAddress&quot;: &quot;0x5300000000000000000000000000000000000005&quot;,</span>
<span class="term-fg32">+                            &quot;l1Config&quot;: {</span>
<span class="term-fg32">+                                &quot;l1ChainId&quot;: 1,</span>
<span class="term-fg32">+                                &quot;l1MessageQueueAddress&quot;: &quot;0x0d7E906BD9cAFa154b048cFa766Cc1E54E39AF9B&quot;,</span>
<span class="term-fg32">+                                &quot;scrollChainAddress&quot;: &quot;0xa13BAF47339d63B743e7Da8741db5456DAc1E556&quot;,</span>
<span class="term-fg32">+                                &quot;numL1MessagesPerBlock&quot;: 10</span>
<span class="term-fg32">+                            }</span>
<span class="term-fg32">+                        }),</span>
<span class="term-fg32">+                    ),</span>
<span class="term-fg32">+                ]</span>
<span class="term-fg32">+                .into_iter()</span>
<span class="term-fg32">+                .collect(),</span>
<span class="term-fg32">+                ..Default::default()</span>
<span class="term-fg32">+            },</span>
<span class="term-fg32">+            ..Default::default()</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let chain_spec: ScrollChainSpec = genesis.into();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let hardforks: Vec&lt;_&gt; = chain_spec.hardforks.forks_iter().map(|(h, _)| h).collect();</span>
<span class="term-fg32">+        let expected_hardforks = vec![</span>
<span class="term-fg32">+            EthereumHardfork::Homestead.boxed(),</span>
<span class="term-fg32">+            EthereumHardfork::Tangerine.boxed(),</span>
<span class="term-fg32">+            EthereumHardfork::SpuriousDragon.boxed(),</span>
<span class="term-fg32">+            EthereumHardfork::Byzantium.boxed(),</span>
<span class="term-fg32">+            EthereumHardfork::Constantinople.boxed(),</span>
<span class="term-fg32">+            EthereumHardfork::Petersburg.boxed(),</span>
<span class="term-fg32">+            EthereumHardfork::Istanbul.boxed(),</span>
<span class="term-fg32">+            EthereumHardfork::Berlin.boxed(),</span>
<span class="term-fg32">+            EthereumHardfork::London.boxed(),</span>
<span class="term-fg32">+            ScrollHardfork::Archimedes.boxed(),</span>
<span class="term-fg32">+            EthereumHardfork::Shanghai.boxed(),</span>
<span class="term-fg32">+            ScrollHardfork::Bernoulli.boxed(),</span>
<span class="term-fg32">+            ScrollHardfork::Curie.boxed(),</span>
<span class="term-fg32">+            ScrollHardfork::Darwin.boxed(),</span>
<span class="term-fg32">+            ScrollHardfork::DarwinV2.boxed(),</span>
<span class="term-fg32">+        ];</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        assert!(expected_hardforks</span>
<span class="term-fg32">+            .iter()</span>
<span class="term-fg32">+            .zip(hardforks.iter())</span>
<span class="term-fg32">+            .all(|(expected, actual)| &amp;**expected == *actual));</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        assert_eq!(expected_hardforks.len(), hardforks.len());</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-df440c66be23792d3ed1f6a7" role="button"
                       aria-expanded="false" aria-controls="id-df440c66be23792d3ed1f6a7">
                        <code>crates/scroll/chainspec/src/scroll.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/chainspec/src/scroll.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+29</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-df440c66be23792d3ed1f6a7"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;scroll.rs scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;scroll.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..602ca353a326ab8c548da4e6c2a70a91de341fad</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;scroll.rs</span>
<span class="term-fg36">@@ -0,0 +1,29 @@</span>
<span class="term-fg32">+&#47;&#47;! Chain specification for the Scroll Mainnet network.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use alloc::sync::Arc;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use alloy_chains::{Chain, NamedChain};</span>
<span class="term-fg32">+use alloy_primitives::b256;</span>
<span class="term-fg32">+use reth_chainspec::{once_cell_set, ChainSpec};</span>
<span class="term-fg32">+use reth_scroll_forks::ScrollHardfork;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use crate::{LazyLock, ScrollChainConfig, ScrollChainSpec};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The Scroll Mainnet spec</span>
<span class="term-fg32">+pub static SCROLL_MAINNET: LazyLock&lt;Arc&lt;ScrollChainSpec&gt;&gt; = LazyLock::new(|| {</span>
<span class="term-fg32">+    ScrollChainSpec {</span>
<span class="term-fg32">+        inner: ChainSpec {</span>
<span class="term-fg32">+            &#47;&#47; TODO(scroll): migrate to Chain::scroll() (introduced in https:&#47;&#47;github.com&#47;alloy-rs&#47;chains&#47;pull&#47;112) when alloy-chains is bumped to version 0.1.48</span>
<span class="term-fg32">+            chain: Chain::from_named(NamedChain::Scroll),</span>
<span class="term-fg32">+            genesis: serde_json::from_str(include_str!(&quot;..&#47;res&#47;genesis&#47;scroll.json&quot;))</span>
<span class="term-fg32">+                .expect(&quot;Can&#39;t deserialize Scroll Mainnet genesis json&quot;),</span>
<span class="term-fg32">+            genesis_hash: once_cell_set(b256!(</span>
<span class="term-fg32">+                &quot;bbc05efd412b7cd47a2ed0e5ddfcf87af251e414ea4c801d78b6784513180a80&quot;</span>
<span class="term-fg32">+            )),</span>
<span class="term-fg32">+            hardforks: ScrollHardfork::scroll_mainnet(),</span>
<span class="term-fg32">+            ..Default::default()</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+        config: ScrollChainConfig::mainnet(),</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+    .into()</span>
<span class="term-fg32">+});</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-72dd72053d9050c69e170c2a" role="button"
                       aria-expanded="false" aria-controls="id-72dd72053d9050c69e170c2a">
                        <code>crates/scroll/chainspec/src/scroll_sepolia.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/chainspec/src/scroll_sepolia.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+29</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-72dd72053d9050c69e170c2a"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;scroll_sepolia.rs scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;scroll_sepolia.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..4f745d5dd1dbb0c32bff1f292fa5c4f331f296e2</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;chainspec&#47;src&#47;scroll_sepolia.rs</span>
<span class="term-fg36">@@ -0,0 +1,29 @@</span>
<span class="term-fg32">+&#47;&#47;! Chain specification for the Scroll Sepolia testnet network.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use alloc::sync::Arc;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use alloy_chains::{Chain, NamedChain};</span>
<span class="term-fg32">+use alloy_primitives::b256;</span>
<span class="term-fg32">+use reth_chainspec::{once_cell_set, ChainSpec};</span>
<span class="term-fg32">+use reth_scroll_forks::ScrollHardfork;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use crate::{LazyLock, ScrollChainConfig, ScrollChainSpec};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The Scroll Sepolia spec</span>
<span class="term-fg32">+pub static SCROLL_SEPOLIA: LazyLock&lt;Arc&lt;ScrollChainSpec&gt;&gt; = LazyLock::new(|| {</span>
<span class="term-fg32">+    ScrollChainSpec {</span>
<span class="term-fg32">+        inner: ChainSpec {</span>
<span class="term-fg32">+            &#47;&#47; Let&#39;s add TODO(scroll): migrate to Chain::scroll_sepolia() (introduced in https:&#47;&#47;github.com&#47;alloy-rs&#47;chains&#47;pull&#47;112) when alloy-chains is bumped to version 0.1.48</span>
<span class="term-fg32">+            chain: Chain::from_named(NamedChain::ScrollSepolia),</span>
<span class="term-fg32">+            genesis: serde_json::from_str(include_str!(&quot;..&#47;res&#47;genesis&#47;sepolia_scroll.json&quot;))</span>
<span class="term-fg32">+                .expect(&quot;Can&#39;t deserialize Scroll Sepolia genesis json&quot;),</span>
<span class="term-fg32">+            genesis_hash: once_cell_set(b256!(</span>
<span class="term-fg32">+                &quot;aa62d1a8b2bffa9e5d2368b63aae0d98d54928bd713125e3fd9e5c896c68592c&quot;</span>
<span class="term-fg32">+            )),</span>
<span class="term-fg32">+            hardforks: ScrollHardfork::scroll_sepolia(),</span>
<span class="term-fg32">+            ..Default::default()</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+        config: ScrollChainConfig::sepolia(),</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+    .into()</span>
<span class="term-fg32">+});</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a1014b2f0b81199d9d875e8a" role="button"
                       aria-expanded="false" aria-controls="id-a1014b2f0b81199d9d875e8a">
                        <code>crates/scroll/cli/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/cli/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+47</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a1014b2f0b81199d9d875e8a"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;cli&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;cli&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..181942841023aef408e002437b3637ebc991e304</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;cli&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,48 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-cli&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-db.workspace = true</span>
<span class="term-fg32">+reth-cli.workspace = true</span>
<span class="term-fg32">+reth-cli-commands.workspace = true</span>
<span class="term-fg32">+reth-cli-runner.workspace = true</span>
<span class="term-fg32">+reth-node-builder.workspace = true</span>
<span class="term-fg32">+reth-node-core.workspace = true</span>
<span class="term-fg32">+reth-node-metrics.workspace = true</span>
<span class="term-fg32">+reth-tracing.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-chainspec.workspace = true</span>
<span class="term-fg32">+reth-scroll-evm.workspace = true</span>
<span class="term-fg32">+reth-scroll-node.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# misc</span>
<span class="term-fg32">+eyre.workspace = true</span>
<span class="term-fg32">+clap.workspace = true</span>
<span class="term-fg32">+tracing.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+optimism = [</span>
<span class="term-fg32">+	&quot;reth-db&#47;optimism&quot;,</span>
<span class="term-fg32">+	&quot;reth-node-core&#47;optimism&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-evm&#47;optimism&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-node&#47;optimism&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-node-builder&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-node-core&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-node&#47;scroll&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-31a2dee2768ec8ce4c5dc190" role="button"
                       aria-expanded="false" aria-controls="id-31a2dee2768ec8ce4c5dc190">
                        <code>crates/scroll/cli/src/args.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/cli/src/args.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+15</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-31a2dee2768ec8ce4c5dc190"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;cli&#47;src&#47;args.rs scroll-reth&#47;crates&#47;scroll&#47;cli&#47;src&#47;args.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..cc0a7e1323abb6b72a232a0570ffc5ccfea5ede1</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;cli&#47;src&#47;args.rs</span>
<span class="term-fg36">@@ -0,0 +1,15 @@</span>
<span class="term-fg32">+use reth_node_builder::engine_tree_config::{</span>
<span class="term-fg32">+    DEFAULT_MEMORY_BLOCK_BUFFER_TARGET, DEFAULT_PERSISTENCE_THRESHOLD,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Rollup arguments for the Scroll node.</span>
<span class="term-fg32">+#[derive(Debug, clap::Args)]</span>
<span class="term-fg32">+pub struct ScrollRollupArgs {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Configure persistence threshold for engine.</span>
<span class="term-fg32">+    #[arg(long = &quot;engine.persistence-threshold&quot;, default_value_t = DEFAULT_PERSISTENCE_THRESHOLD)]</span>
<span class="term-fg32">+    pub persistence_threshold: u64,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Configure the target number of blocks to keep in memory.</span>
<span class="term-fg32">+    #[arg(long = &quot;engine.memory-block-buffer-target&quot;, default_value_t = DEFAULT_MEMORY_BLOCK_BUFFER_TARGET)]</span>
<span class="term-fg32">+    pub memory_block_buffer_target: u64,</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f0fb3f9dcd057f35d76bc869" role="button"
                       aria-expanded="false" aria-controls="id-f0fb3f9dcd057f35d76bc869">
                        <code>crates/scroll/cli/src/commands.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/cli/src/commands.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+48</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f0fb3f9dcd057f35d76bc869"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;cli&#47;src&#47;commands.rs scroll-reth&#47;crates&#47;scroll&#47;cli&#47;src&#47;commands.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..a80a2aa8bc782020eed92c1c4eb1991c6f55c8b8</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;cli&#47;src&#47;commands.rs</span>
<span class="term-fg36">@@ -0,0 +1,48 @@</span>
<span class="term-fg32">+use crate::ScrollChainSpecParser;</span>
<span class="term-fg32">+use clap::Subcommand;</span>
<span class="term-fg32">+use reth_cli::chainspec::ChainSpecParser;</span>
<span class="term-fg32">+use reth_cli_commands::{</span>
<span class="term-fg32">+    config_cmd, db, dump_genesis, import, init_cmd, init_state, node, node::NoArgs, p2p, prune,</span>
<span class="term-fg32">+    recover, stage,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use std::fmt;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Commands to be executed</span>
<span class="term-fg32">+#[derive(Debug, Subcommand)]</span>
<span class="term-fg32">+pub enum Commands&lt;</span>
<span class="term-fg32">+    Spec: ChainSpecParser = ScrollChainSpecParser,</span>
<span class="term-fg32">+    Ext: clap::Args + fmt::Debug = NoArgs,</span>
<span class="term-fg32">+&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Start the node</span>
<span class="term-fg32">+    #[command(name = &quot;node&quot;)]</span>
<span class="term-fg32">+    Node(Box&lt;node::NodeCommand&lt;Spec, Ext&gt;&gt;),</span>
<span class="term-fg32">+    &#47;&#47;&#47; Initialize the database from a genesis file.</span>
<span class="term-fg32">+    #[command(name = &quot;init&quot;)]</span>
<span class="term-fg32">+    Init(init_cmd::InitCommand&lt;Spec&gt;),</span>
<span class="term-fg32">+    &#47;&#47;&#47; Initialize the database from a state dump file.</span>
<span class="term-fg32">+    #[command(name = &quot;init-state&quot;)]</span>
<span class="term-fg32">+    InitState(init_state::InitStateCommand&lt;Spec&gt;),</span>
<span class="term-fg32">+    &#47;&#47;&#47; This syncs RLP encoded blocks from a file.</span>
<span class="term-fg32">+    #[command(name = &quot;import&quot;)]</span>
<span class="term-fg32">+    Import(import::ImportCommand&lt;Spec&gt;),</span>
<span class="term-fg32">+    &#47;&#47;&#47; Dumps genesis block JSON configuration to stdout.</span>
<span class="term-fg32">+    DumpGenesis(dump_genesis::DumpGenesisCommand&lt;Spec&gt;),</span>
<span class="term-fg32">+    &#47;&#47;&#47; Database debugging utilities</span>
<span class="term-fg32">+    #[command(name = &quot;db&quot;)]</span>
<span class="term-fg32">+    Db(db::Command&lt;Spec&gt;),</span>
<span class="term-fg32">+    &#47;&#47;&#47; Manipulate individual stages.</span>
<span class="term-fg32">+    #[command(name = &quot;stage&quot;)]</span>
<span class="term-fg32">+    Stage(Box&lt;stage::Command&lt;Spec&gt;&gt;),</span>
<span class="term-fg32">+    &#47;&#47;&#47; P2P Debugging utilities</span>
<span class="term-fg32">+    #[command(name = &quot;p2p&quot;)]</span>
<span class="term-fg32">+    P2P(p2p::Command&lt;Spec&gt;),</span>
<span class="term-fg32">+    &#47;&#47;&#47; Write config to stdout</span>
<span class="term-fg32">+    #[command(name = &quot;config&quot;)]</span>
<span class="term-fg32">+    Config(config_cmd::Command),</span>
<span class="term-fg32">+    &#47;&#47;&#47; Scripts for node recovery</span>
<span class="term-fg32">+    #[command(name = &quot;recover&quot;)]</span>
<span class="term-fg32">+    Recover(recover::Command&lt;Spec&gt;),</span>
<span class="term-fg32">+    &#47;&#47;&#47; Prune according to the configuration without any limits</span>
<span class="term-fg32">+    #[command(name = &quot;prune&quot;)]</span>
<span class="term-fg32">+    Prune(prune::PruneCommand&lt;Spec&gt;),</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7afe8dabfe3785a3c410b02c" role="button"
                       aria-expanded="false" aria-controls="id-7afe8dabfe3785a3c410b02c">
                        <code>crates/scroll/cli/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/cli/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+155</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7afe8dabfe3785a3c410b02c"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;cli&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;cli&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..9803d02d09fdd3ee0fe10785ef7dd89ff01a7a74</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;cli&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,155 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll CLI implementation.</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod args;</span>
<span class="term-fg32">+pub use args::ScrollRollupArgs;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod commands;</span>
<span class="term-fg32">+pub use commands::Commands;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod spec;</span>
<span class="term-fg32">+pub use spec::ScrollChainSpecParser;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use clap::{value_parser, Parser};</span>
<span class="term-fg32">+use reth_cli::chainspec::ChainSpecParser;</span>
<span class="term-fg32">+use reth_cli_commands::node::NoArgs;</span>
<span class="term-fg32">+use reth_cli_runner::CliRunner;</span>
<span class="term-fg32">+use reth_db::DatabaseEnv;</span>
<span class="term-fg32">+use reth_node_builder::{NodeBuilder, WithLaunchContext};</span>
<span class="term-fg32">+use reth_node_core::{</span>
<span class="term-fg32">+    args::LogArgs,</span>
<span class="term-fg32">+    version::{LONG_VERSION, SHORT_VERSION},</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_node_metrics::recorder::install_prometheus_recorder;</span>
<span class="term-fg32">+use reth_scroll_chainspec::ScrollChainSpec;</span>
<span class="term-fg32">+use reth_scroll_evm::ScrollExecutorProvider;</span>
<span class="term-fg32">+use reth_scroll_node::ScrollNode;</span>
<span class="term-fg32">+use reth_tracing::FileWorkerGuard;</span>
<span class="term-fg32">+use std::{ffi::OsString, fmt, future::Future, sync::Arc};</span>
<span class="term-fg32">+use tracing::info;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The main scroll cli interface.</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; This is the entrypoint to the executable.</span>
<span class="term-fg32">+#[derive(Debug, Parser)]</span>
<span class="term-fg32">+#[command(author, version = SHORT_VERSION, long_version = LONG_VERSION, about = &quot;Scroll Reth&quot;, long_about = None</span>
<span class="term-fg32">+)]</span>
<span class="term-fg32">+pub struct Cli&lt;Spec: ChainSpecParser = ScrollChainSpecParser, Ext: clap::Args + fmt::Debug = NoArgs&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    &#47;&#47;&#47; The command to run</span>
<span class="term-fg32">+    #[command(subcommand)]</span>
<span class="term-fg32">+    command: Commands&lt;Spec, Ext&gt;,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; The chain this node is running.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Possible values are either a built-in chain or the path to a chain specification file.</span>
<span class="term-fg32">+    #[arg(</span>
<span class="term-fg32">+        long,</span>
<span class="term-fg32">+        value_name = &quot;CHAIN_OR_PATH&quot;,</span>
<span class="term-fg32">+        long_help = Spec::help_message(),</span>
<span class="term-fg32">+        default_value = Spec::SUPPORTED_CHAINS[0],</span>
<span class="term-fg32">+        value_parser = Spec::parser(),</span>
<span class="term-fg32">+        global = true,</span>
<span class="term-fg32">+    )]</span>
<span class="term-fg32">+    chain: Arc&lt;Spec::ChainSpec&gt;,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Add a new instance of a node.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Configures the ports of the node to avoid conflicts with the defaults.</span>
<span class="term-fg32">+    &#47;&#47;&#47; This is useful for running multiple nodes on the same machine.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Max number of instances is 200. It is chosen in a way so that it&#39;s not possible to have</span>
<span class="term-fg32">+    &#47;&#47;&#47; port numbers that conflict with each other.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Changes to the following port numbers:</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `DISCOVERY_PORT`: default + `instance` - 1</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `AUTH_PORT`: default + `instance` * 100 - 100</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `HTTP_RPC_PORT`: default - `instance` + 1</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `WS_RPC_PORT`: default + `instance` * 2 - 2</span>
<span class="term-fg32">+    #[arg(long, value_name = &quot;INSTANCE&quot;, global = true, default_value_t = 1, value_parser = value_parser!(u16).range(..=200)</span>
<span class="term-fg32">+    )]</span>
<span class="term-fg32">+    instance: u16,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[command(flatten)]</span>
<span class="term-fg32">+    logs: LogArgs,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Cli {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Parsers only the default CLI arguments</span>
<span class="term-fg32">+    pub fn parse_args() -&gt; Self {</span>
<span class="term-fg32">+        Self::parse()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Parsers only the default CLI arguments from the given iterator</span>
<span class="term-fg32">+    pub fn try_parse_args_from&lt;I, T&gt;(itr: I) -&gt; Result&lt;Self, clap::error::Error&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        I: IntoIterator&lt;Item = T&gt;,</span>
<span class="term-fg32">+        T: Into&lt;OsString&gt; + Clone,</span>
<span class="term-fg32">+    {</span>
<span class="term-fg32">+        Self::try_parse_from(itr)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;C, Ext&gt; Cli&lt;C, Ext&gt;</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    C: ChainSpecParser&lt;ChainSpec = ScrollChainSpec&gt;,</span>
<span class="term-fg32">+    Ext: clap::Args + fmt::Debug,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    &#47;&#47;&#47; Execute the configured cli command.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; This accepts a closure that is used to launch the node via the</span>
<span class="term-fg32">+    &#47;&#47;&#47; [`NodeCommand`](reth_cli_commands::node::NodeCommand).</span>
<span class="term-fg32">+    pub fn run&lt;L, Fut&gt;(mut self, launcher: L) -&gt; eyre::Result&lt;()&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        L: FnOnce(WithLaunchContext&lt;NodeBuilder&lt;Arc&lt;DatabaseEnv&gt;, C::ChainSpec&gt;&gt;, Ext) -&gt; Fut,</span>
<span class="term-fg32">+        Fut: Future&lt;Output = eyre::Result&lt;()&gt;&gt;,</span>
<span class="term-fg32">+    {</span>
<span class="term-fg32">+        &#47;&#47; add network name to logs dir</span>
<span class="term-fg32">+        self.logs.log_file_directory =</span>
<span class="term-fg32">+            self.logs.log_file_directory.join(self.chain.chain().to_string());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let _guard = self.init_tracing()?;</span>
<span class="term-fg32">+        info!(target: &quot;reth::cli&quot;, &quot;Initialized tracing, debug log directory: {}&quot;, self.logs.log_file_directory);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; Install the prometheus recorder to be sure to record all metrics</span>
<span class="term-fg32">+        let _ = install_prometheus_recorder();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let runner = CliRunner::default();</span>
<span class="term-fg32">+        match self.command {</span>
<span class="term-fg32">+            Commands::Node(command) =&gt; {</span>
<span class="term-fg32">+                runner.run_command_until_exit(|ctx| command.execute(ctx, launcher))</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            Commands::Init(command) =&gt; {</span>
<span class="term-fg32">+                runner.run_blocking_until_ctrl_c(command.execute::&lt;ScrollNode&gt;())</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            Commands::InitState(command) =&gt; {</span>
<span class="term-fg32">+                runner.run_blocking_until_ctrl_c(command.execute::&lt;ScrollNode&gt;())</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            Commands::Import(command) =&gt; runner.run_blocking_until_ctrl_c(</span>
<span class="term-fg32">+                command.execute::&lt;ScrollNode, _, _&gt;(ScrollExecutorProvider::scroll),</span>
<span class="term-fg32">+            ),</span>
<span class="term-fg32">+            Commands::DumpGenesis(command) =&gt; runner.run_blocking_until_ctrl_c(command.execute()),</span>
<span class="term-fg32">+            Commands::Db(command) =&gt; {</span>
<span class="term-fg32">+                runner.run_blocking_until_ctrl_c(command.execute::&lt;ScrollNode&gt;())</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            Commands::Stage(command) =&gt; runner.run_command_until_exit(|ctx| {</span>
<span class="term-fg32">+                command.execute::&lt;ScrollNode, _, _&gt;(ctx, ScrollExecutorProvider::scroll)</span>
<span class="term-fg32">+            }),</span>
<span class="term-fg32">+            Commands::P2P(command) =&gt; runner.run_until_ctrl_c(command.execute()),</span>
<span class="term-fg32">+            Commands::Config(command) =&gt; runner.run_until_ctrl_c(command.execute()),</span>
<span class="term-fg32">+            Commands::Recover(command) =&gt; {</span>
<span class="term-fg32">+                runner.run_command_until_exit(|ctx| command.execute::&lt;ScrollNode&gt;(ctx))</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            Commands::Prune(command) =&gt; runner.run_until_ctrl_c(command.execute::&lt;ScrollNode&gt;()),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Initializes tracing with the configured options.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; If file logging is enabled, this function returns a guard that must be kept alive to ensure</span>
<span class="term-fg32">+    &#47;&#47;&#47; that all logs are flushed to disk.</span>
<span class="term-fg32">+    pub fn init_tracing(&amp;self) -&gt; eyre::Result&lt;Option&lt;FileWorkerGuard&gt;&gt; {</span>
<span class="term-fg32">+        let guard = self.logs.init_tracing()?;</span>
<span class="term-fg32">+        Ok(guard)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-11ef7ca0e664d1df7c0a7863" role="button"
                       aria-expanded="false" aria-controls="id-11ef7ca0e664d1df7c0a7863">
                        <code>crates/scroll/cli/src/spec.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/cli/src/spec.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+21</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-11ef7ca0e664d1df7c0a7863"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;cli&#47;src&#47;spec.rs scroll-reth&#47;crates&#47;scroll&#47;cli&#47;src&#47;spec.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..361029d9d1fc6101bd9f15b0d01b824a3aff04ec</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;cli&#47;src&#47;spec.rs</span>
<span class="term-fg36">@@ -0,0 +1,21 @@</span>
<span class="term-fg32">+use reth_cli::chainspec::{parse_genesis, ChainSpecParser};</span>
<span class="term-fg32">+use reth_scroll_chainspec::{ScrollChainSpec, SCROLL_DEV, SCROLL_MAINNET, SCROLL_SEPOLIA};</span>
<span class="term-fg32">+use std::sync::Arc;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The parser for the Scroll chain specification.</span>
<span class="term-fg32">+#[derive(Debug, Clone)]</span>
<span class="term-fg32">+pub struct ScrollChainSpecParser;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ChainSpecParser for ScrollChainSpecParser {</span>
<span class="term-fg32">+    type ChainSpec = ScrollChainSpec;</span>
<span class="term-fg32">+    const SUPPORTED_CHAINS: &amp;&#39;static [&amp;&#39;static str] = &amp;[&quot;dev&quot;, &quot;scroll-mainnet&quot;, &quot;scroll-sepolia&quot;];</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn parse(s: &amp;str) -&gt; eyre::Result&lt;Arc&lt;Self::ChainSpec&gt;&gt; {</span>
<span class="term-fg32">+        Ok(match s {</span>
<span class="term-fg32">+            &quot;dev&quot; =&gt; SCROLL_DEV.clone(),</span>
<span class="term-fg32">+            &quot;scroll-mainnet&quot; =&gt; SCROLL_MAINNET.clone(),</span>
<span class="term-fg32">+            &quot;scroll-sepolia&quot; =&gt; SCROLL_SEPOLIA.clone(),</span>
<span class="term-fg32">+            _ =&gt; Arc::new(parse_genesis(s)?.into()),</span>
<span class="term-fg32">+        })</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ddd8e577a2f6d13f43207fb0" role="button"
                       aria-expanded="false" aria-controls="id-ddd8e577a2f6d13f43207fb0">
                        <code>crates/scroll/consensus/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/consensus/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+22</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ddd8e577a2f6d13f43207fb0"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;consensus&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;consensus&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..beec5c27120ddd162cd303f68f127d8b0946d452</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;consensus&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,22 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-consensus&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# revm</span>
<span class="term-fg32">+revm.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dev-dependencies]</span>
<span class="term-fg32">+eyre.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [&quot;revm&#47;scroll&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c5ef7c8c6ee260d6fe7fd60e" role="button"
                       aria-expanded="false" aria-controls="id-c5ef7c8c6ee260d6fe7fd60e">
                        <code>crates/scroll/consensus/src/curie.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/consensus/src/curie.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+203</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c5ef7c8c6ee260d6fe7fd60e"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;consensus&#47;src&#47;curie.rs scroll-reth&#47;crates&#47;scroll&#47;consensus&#47;src&#47;curie.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..6824b11027e0788de81c3b0010d7ccf9cb8ad420</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;consensus&#47;src&#47;curie.rs</span>
<span class="term-fg36">@@ -0,0 +1,203 @@</span>
<span class="term-fg32">+&#47;&#47;! Curie fork transition for Scroll.</span>
<span class="term-fg32">+&#47;&#47;!</span>
<span class="term-fg32">+&#47;&#47;! On block 7096836, Scroll performed a transition to the Curie fork state, which brought  various</span>
<span class="term-fg32">+&#47;&#47;! changes to the protocol:</span>
<span class="term-fg32">+&#47;&#47;!    1. Fee reduction cost thanks to the use of compressed blobs on the L1.</span>
<span class="term-fg32">+&#47;&#47;!    2. Modified [EIP-1559](https:&#47;&#47;github.com&#47;ethereum&#47;EIPs&#47;blob&#47;master&#47;EIPS&#47;eip-1559.md) pricing</span>
<span class="term-fg32">+&#47;&#47;!       model along with support for EIP-1559 and EIP-2930 transactions.</span>
<span class="term-fg32">+&#47;&#47;!    3. Support for `MLOAD`, `TLOAD` and `MCOPY` ([EIP-1153](https:&#47;&#47;eips.ethereum.org&#47;EIPS&#47;eip-1153)</span>
<span class="term-fg32">+&#47;&#47;!       and [EIP-5656](https:&#47;&#47;eips.ethereum.org&#47;EIPS&#47;eip-5656)).</span>
<span class="term-fg32">+&#47;&#47;!    4. Dynamic block time.</span>
<span class="term-fg32">+&#47;&#47;!</span>
<span class="term-fg32">+&#47;&#47;! Compressed blobs allowed for more transactions to be stored in each blob, reducing the DA cost</span>
<span class="term-fg32">+&#47;&#47;! per transactions. Accordingly, the L1 gas oracle contract&#39;s bytecode was updated in order to</span>
<span class="term-fg32">+&#47;&#47;! reflect the update in the DA costs:</span>
<span class="term-fg32">+&#47;&#47;!    - original formula: `(l1GasUsed(txRlp) + overhead) * l1BaseFee * scalar`.</span>
<span class="term-fg32">+&#47;&#47;!    - updated formula: `l1BaseFee * commitScalar + len(txRlp) * l1BlobBaseFee * blobScalar`.</span>
<span class="term-fg32">+&#47;&#47;!</span>
<span class="term-fg32">+&#47;&#47;! More details on the Curie update: &lt;https:&#47;&#47;scroll.io&#47;blog&#47;compressing-the-gas-scrolls-curie-upgrade&gt;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::states::StorageSlot,</span>
<span class="term-fg32">+    primitives::{address, bytes, Address, Bytecode, Bytes, U256},</span>
<span class="term-fg32">+    shared::AccountInfo,</span>
<span class="term-fg32">+    Database, State,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; L1 gas price oracle address.</span>
<span class="term-fg32">+&#47;&#47;&#47; &lt;https:&#47;&#47;scrollscan.com&#47;address&#47;0x5300000000000000000000000000000000000002&gt;</span>
<span class="term-fg32">+pub const L1_GAS_PRICE_ORACLE_ADDRESS: Address =</span>
<span class="term-fg32">+    address!(&quot;5300000000000000000000000000000000000002&quot;);</span>
<span class="term-fg32">+&#47;&#47;&#47; Bytecode of L1 gas price oracle at Curie transition.</span>
<span class="term-fg32">+pub const CURIE_L1_GAS_PRICE_ORACLE_BYTECODE: Bytes = bytes!(&quot;608060405234801561000f575f80fd5b5060043610610132575f3560e01c8063715018a6116100b4578063a911d77f11610079578063a911d77f1461024c578063bede39b514610254578063de26c4a114610267578063e88a60ad1461027a578063f2fde38b1461028d578063f45e65d8146102a0575f80fd5b8063715018a6146101eb57806384189161146101f35780638da5cb5b146101fc57806393e59dc114610226578063944b247f14610239575f80fd5b80633d0f963e116100fa5780633d0f963e146101a057806349948e0e146101b3578063519b4bd3146101c65780636a5e67e5146101cf57806370465597146101d8575f80fd5b80630c18c1621461013657806313dad5be1461015257806323e524ac1461016f5780633577afc51461017857806339455d3a1461018d575b5f80fd5b61013f60025481565b6040519081526020015b60405180910390f35b60085461015f9060ff1681565b6040519015158152602001610149565b61013f60065481565b61018b6101863660046109b3565b6102a9565b005b61018b61019b3660046109ca565b61033b565b61018b6101ae3660046109ea565b610438565b61013f6101c1366004610a2b565b6104bb565b61013f60015481565b61013f60075481565b61018b6101e63660046109b3565b6104e0565b61018b61056e565b61013f60055481565b5f5461020e906001600160a01b031681565b6040516001600160a01b039091168152602001610149565b60045461020e906001600160a01b031681565b61018b6102473660046109b3565b6105a2565b61018b61062e565b61018b6102623660046109b3565b61068a565b61013f610275366004610a2b565b610747565b61018b6102883660046109b3565b610764565b61018b61029b3660046109ea565b6107f0565b61013f60035481565b5f546001600160a01b031633146102db5760405162461bcd60e51b81526004016102d290610ad6565b60405180910390fd5b621c9c388111156102ff57604051635742c80560e11b815260040160405180910390fd5b60028190556040518181527f32740b35c0ea213650f60d44366b4fb211c9033b50714e4a1d34e65d5beb9bb4906020015b60405180910390a150565b6004805460405163efc7840160e01b815233928101929092526001600160a01b03169063efc7840190602401602060405180830381865afa158015610382573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906103a69190610b0d565b6103c3576040516326b3506d60e11b815260040160405180910390fd5b600182905560058190556040518281527f351fb23757bb5ea0546c85b7996ddd7155f96b939ebaa5ff7bc49c75f27f2c449060200160405180910390a16040518181527f9a14bfb5d18c4c3cf14cae19c23d7cf1bcede357ea40ca1f75cd49542c71c214906020015b60405180910390a15050565b5f546001600160a01b031633146104615760405162461bcd60e51b81526004016102d290610ad6565b600480546001600160a01b038381166001600160a01b031983168117909355604080519190921680825260208201939093527f22d1c35fe072d2e42c3c8f9bd4a0d34aa84a0101d020a62517b33fdb3174e5f7910161042c565b6008545f9060ff16156104d7576104d18261087b565b92915050565b6104d1826108c1565b5f546001600160a01b031633146105095760405162461bcd60e51b81526004016102d290610ad6565b610519633b9aca006103e8610b40565b81111561053957604051631e44fdeb60e11b815260040160405180910390fd5b60038190556040518181527f3336cd9708eaf2769a0f0dc0679f30e80f15dcd88d1921b5a16858e8b85c591a90602001610330565b5f546001600160a01b031633146105975760405162461bcd60e51b81526004016102d290610ad6565b6105a05f610904565b565b5f546001600160a01b031633146105cb5760405162461bcd60e51b81526004016102d290610ad6565b6105d9633b9aca0080610b40565b8111156105f95760405163874f603160e01b815260040160405180910390fd5b60068190556040518181527f2ab3f5a4ebbcbf3c24f62f5454f52f10e1a8c9dcc5acac8f19199ce881a6a10890602001610330565b5f546001600160a01b031633146106575760405162461bcd60e51b81526004016102d290610ad6565b60085460ff161561067b576040516379f9c57560e01b815260040160405180910390fd5b6008805460ff19166001179055565b6004805460405163efc7840160e01b815233928101929092526001600160a01b03169063efc7840190602401602060405180830381865afa1580156106d1573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906106f59190610b0d565b610712576040516326b3506d60e11b815260040160405180910390fd5b60018190556040518181527f351fb23757bb5ea0546c85b7996ddd7155f96b939ebaa5ff7bc49c75f27f2c4490602001610330565b6008545f9060ff161561075b57505f919050565b6104d182610953565b5f546001600160a01b0316331461078d5760405162461bcd60e51b81526004016102d290610ad6565b61079b633b9aca0080610b40565b8111156107bb5760405163f37ec21560e01b815260040160405180910390fd5b60078190556040518181527f6b332a036d8c3ead57dcb06c87243bd7a2aed015ddf2d0528c2501dae56331aa90602001610330565b5f546001600160a01b031633146108195760405162461bcd60e51b81526004016102d290610ad6565b6001600160a01b03811661086f5760405162461bcd60e51b815260206004820152601d60248201527f6e6577206f776e657220697320746865207a65726f206164647265737300000060448201526064016102d2565b61087881610904565b50565b5f633b9aca0060055483516007546108939190610b40565b61089d9190610b40565b6001546006546108ad9190610b40565b6108b79190610b57565b6104d19190610b6a565b5f806108cc83610953565b90505f600154826108dd9190610b40565b9050633b9aca00600354826108f29190610b40565b6108fc9190610b6a565b949350505050565b5f80546001600160a01b038381166001600160a01b0319831681178455604051919092169283917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e09190a35050565b80515f908190815b818110156109a45784818151811061097557610975610b89565b01602001516001600160f81b0319165f036109955760048301925061099c565b6010830192505b60010161095b565b50506002540160400192915050565b5f602082840312156109c3575f80fd5b5035919050565b5f80604083850312156109db575f80fd5b50508035926020909101359150565b5f602082840312156109fa575f80fd5b81356001600160a01b0381168114610a10575f80fd5b9392505050565b634e487b7160e01b5f52604160045260245ffd5b5f60208284031215610a3b575f80fd5b813567ffffffffffffffff80821115610a52575f80fd5b818401915084601f830112610a65575f80fd5b813581811115610a7757610a77610a17565b604051601f8201601f19908116603f01168101908382118183101715610a9f57610a9f610a17565b81604052828152876020848701011115610ab7575f80fd5b826020860160208301375f928101602001929092525095945050505050565b60208082526017908201527f63616c6c6572206973206e6f7420746865206f776e6572000000000000000000604082015260600190565b5f60208284031215610b1d575f80fd5b81518015158114610a10575f80fd5b634e487b7160e01b5f52601160045260245ffd5b80820281158282048414176104d1576104d1610b2c565b808201808211156104d1576104d1610b2c565b5f82610b8457634e487b7160e01b5f52601260045260245ffd5b500490565b634e487b7160e01b5f52603260045260245ffdfea26469706673582212200c2ac583f18be4f94ab169ae6f2ea3a708a7c0d4424746b120b177adb39e626064736f6c63430008180033&quot;);</span>
<span class="term-fg32">+&#47;&#47;&#47; Storage update of L1 gas price oracle at Curie transition.</span>
<span class="term-fg32">+pub const CURIE_L1_GAS_PRICE_ORACLE_STORAGE: [(U256, U256); 4] = [</span>
<span class="term-fg32">+    (L1_BLOB_BASE_FEE_SLOT, INITIAL_L1_BLOB_BASE_FEE),</span>
<span class="term-fg32">+    (COMMIT_SCALAR_SLOT, INITIAL_COMMIT_SCALAR),</span>
<span class="term-fg32">+    (BLOB_SCALAR_SLOT, INITIAL_BLOB_SCALAR),</span>
<span class="term-fg32">+    (IS_CURIE_SLOT, IS_CURIE),</span>
<span class="term-fg32">+];</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; L1 gas price oracle base fee slot.</span>
<span class="term-fg32">+pub const L1_BASE_FEE_SLOT: U256 = U256::from_limbs([1, 0, 0, 0]);</span>
<span class="term-fg32">+&#47;&#47;&#47; L1 gas price oracle over head slot.</span>
<span class="term-fg32">+pub const OVER_HEAD_SLOT: U256 = U256::from_limbs([2, 0, 0, 0]);</span>
<span class="term-fg32">+&#47;&#47;&#47; L1 gas price oracle scalar slot.</span>
<span class="term-fg32">+pub const SCALAR_SLOT: U256 = U256::from_limbs([3, 0, 0, 0]);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; L1 gas price oracle blob base fee slot. Added in the Curie fork.</span>
<span class="term-fg32">+pub const L1_BLOB_BASE_FEE_SLOT: U256 = U256::from_limbs([5, 0, 0, 0]);</span>
<span class="term-fg32">+&#47;&#47;&#47; L1 gas price oracle commit scalar slot. Added in the Curie fork.</span>
<span class="term-fg32">+pub const COMMIT_SCALAR_SLOT: U256 = U256::from_limbs([6, 0, 0, 0]);</span>
<span class="term-fg32">+&#47;&#47;&#47; L1 gas price oracle blob scalar slot. Added in the Curie fork.</span>
<span class="term-fg32">+pub const BLOB_SCALAR_SLOT: U256 = U256::from_limbs([7, 0, 0, 0]);</span>
<span class="term-fg32">+&#47;&#47;&#47; L1 gas price oracle &quot;is Curie&quot; slot. Added in the Curie fork.</span>
<span class="term-fg32">+pub const IS_CURIE_SLOT: U256 = U256::from_limbs([8, 0, 0, 0]);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The initial blob base fee used by the oracle contract.</span>
<span class="term-fg32">+const INITIAL_L1_BLOB_BASE_FEE: U256 = U256::from_limbs([1, 0, 0, 0]);</span>
<span class="term-fg32">+&#47;&#47;&#47; The initial commit scalar used by the oracle contract.</span>
<span class="term-fg32">+const INITIAL_COMMIT_SCALAR: U256 = U256::from_limbs([230759955285, 0, 0, 0]);</span>
<span class="term-fg32">+&#47;&#47;&#47; The initial blob scalar used by the oracle contract.</span>
<span class="term-fg32">+const INITIAL_BLOB_SCALAR: U256 = U256::from_limbs([417565260, 0, 0, 0]);</span>
<span class="term-fg32">+&#47;&#47;&#47; Curie slot is set to 1 (true) after the Curie block fork.</span>
<span class="term-fg32">+const IS_CURIE: U256 = U256::from_limbs([1, 0, 0, 0]);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Applies the Scroll Curie hard fork to the state:</span>
<span class="term-fg32">+&#47;&#47;&#47;    - Updates the L1 oracle contract bytecode to reflect the DA cost reduction.</span>
<span class="term-fg32">+&#47;&#47;&#47;    - Sets the initial blob base fee, commit and blob scalar and sets the `isCurie` slot to 1</span>
<span class="term-fg32">+&#47;&#47;&#47;      (true).</span>
<span class="term-fg32">+pub fn apply_curie_hard_fork&lt;DB: Database&gt;(state: &amp;mut State&lt;DB&gt;) -&gt; Result&lt;(), DB::Error&gt; {</span>
<span class="term-fg32">+    let oracle = state.load_cache_account(L1_GAS_PRICE_ORACLE_ADDRESS)?;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47; compute the code hash</span>
<span class="term-fg32">+    let bytecode = Bytecode::new_raw(CURIE_L1_GAS_PRICE_ORACLE_BYTECODE);</span>
<span class="term-fg32">+    let bytecode_len = bytecode.len();</span>
<span class="term-fg32">+    let code_hash = bytecode.hash_slow();</span>
<span class="term-fg32">+    let poseidon_code_hash = bytecode.poseidon_hash_slow();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47; get the old oracle account info</span>
<span class="term-fg32">+    let old_oracle_info = oracle.account_info().unwrap_or_default();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47; init new oracle account information</span>
<span class="term-fg32">+    let new_oracle_info = AccountInfo {</span>
<span class="term-fg32">+        code_size: bytecode_len,</span>
<span class="term-fg32">+        code_hash,</span>
<span class="term-fg32">+        poseidon_code_hash,</span>
<span class="term-fg32">+        code: Some(bytecode),</span>
<span class="term-fg32">+        ..old_oracle_info</span>
<span class="term-fg32">+    };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47; init new storage</span>
<span class="term-fg32">+    let new_storage = CURIE_L1_GAS_PRICE_ORACLE_STORAGE</span>
<span class="term-fg32">+        .into_iter()</span>
<span class="term-fg32">+        .map(|(slot, present_value)| {</span>
<span class="term-fg32">+            (</span>
<span class="term-fg32">+                slot,</span>
<span class="term-fg32">+                StorageSlot {</span>
<span class="term-fg32">+                    present_value,</span>
<span class="term-fg32">+                    previous_or_original_value: oracle.storage_slot(slot).unwrap_or_default(),</span>
<span class="term-fg32">+                },</span>
<span class="term-fg32">+            )</span>
<span class="term-fg32">+        })</span>
<span class="term-fg32">+        .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47; create transition for oracle new account info and storage</span>
<span class="term-fg32">+    let transition = oracle.change(new_oracle_info, new_storage);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47; add transition</span>
<span class="term-fg32">+    if let Some(s) = state.transition_state.as_mut() {</span>
<span class="term-fg32">+        s.add_transitions(vec![(L1_GAS_PRICE_ORACLE_ADDRESS, transition)])</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    Ok(())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(test)]</span>
<span class="term-fg32">+mod tests {</span>
<span class="term-fg32">+    use crate::{</span>
<span class="term-fg32">+        apply_curie_hard_fork,</span>
<span class="term-fg32">+        curie::{</span>
<span class="term-fg32">+            CURIE_L1_GAS_PRICE_ORACLE_BYTECODE, CURIE_L1_GAS_PRICE_ORACLE_STORAGE,</span>
<span class="term-fg32">+            L1_GAS_PRICE_ORACLE_ADDRESS,</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+    };</span>
<span class="term-fg32">+    use revm::{</span>
<span class="term-fg32">+        db::states::{bundle_state::BundleRetention, plain_account::PlainStorage, StorageSlot},</span>
<span class="term-fg32">+        keccak256,</span>
<span class="term-fg32">+        primitives::{bytes, poseidon, U256},</span>
<span class="term-fg32">+        shared::AccountInfo,</span>
<span class="term-fg32">+        Bytecode, Database, EmptyDB, State,</span>
<span class="term-fg32">+    };</span>
<span class="term-fg32">+    use std::str::FromStr;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_apply_curie_fork() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        &#47;&#47; init state</span>
<span class="term-fg32">+        let db = EmptyDB::new();</span>
<span class="term-fg32">+        let mut state =</span>
<span class="term-fg32">+            State::builder().with_database(db).with_bundle_update().without_state_clear().build();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; oracle pre fork state</span>
<span class="term-fg32">+        let bytecode_pre_fork = Bytecode::new_raw( bytes!(&quot;608060405234801561001057600080fd5b50600436106100cf5760003560e01c8063715018a61161008c578063bede39b511610066578063bede39b51461018d578063de26c4a1146101a0578063f2fde38b146101b3578063f45e65d8146101c657600080fd5b8063715018a6146101475780638da5cb5b1461014f57806393e59dc11461017a57600080fd5b80630c18c162146100d45780633577afc5146100f05780633d0f963e1461010557806349948e0e14610118578063519b4bd31461012b5780637046559714610134575b600080fd5b6100dd60025481565b6040519081526020015b60405180910390f35b6101036100fe366004610671565b6101cf565b005b61010361011336600461068a565b610291565b6100dd6101263660046106d0565b61031c565b6100dd60015481565b610103610142366004610671565b610361565b610103610416565b600054610162906001600160a01b031681565b6040516001600160a01b0390911681526020016100e7565b600454610162906001600160a01b031681565b61010361019b366004610671565b61044c565b6100dd6101ae3660046106d0565b610533565b6101036101c136600461068a565b610595565b6100dd60035481565b6000546001600160a01b031633146102025760405162461bcd60e51b81526004016101f990610781565b60405180910390fd5b621c9c388111156102555760405162461bcd60e51b815260206004820152601760248201527f657863656564206d6178696d756d206f7665726865616400000000000000000060448201526064016101f9565b60028190556040518181527f32740b35c0ea213650f60d44366b4fb211c9033b50714e4a1d34e65d5beb9bb4906020015b60405180910390a150565b6000546001600160a01b031633146102bb5760405162461bcd60e51b81526004016101f990610781565b600480546001600160a01b038381166001600160a01b031983168117909355604080519190921680825260208201939093527f22d1c35fe072d2e42c3c8f9bd4a0d34aa84a0101d020a62517b33fdb3174e5f7910160405180910390a15050565b60008061032883610533565b905060006001548261033a91906107b8565b9050633b9aca006003548261034f91906107b8565b61035991906107e5565b949350505050565b6000546001600160a01b0316331461038b5760405162461bcd60e51b81526004016101f990610781565b61039b633b9aca006103e86107b8565b8111156103e15760405162461bcd60e51b8152602060048201526014602482015273657863656564206d6178696d756d207363616c6560601b60448201526064016101f9565b60038190556040518181527f3336cd9708eaf2769a0f0dc0679f30e80f15dcd88d1921b5a16858e8b85c591a90602001610286565b6000546001600160a01b031633146104405760405162461bcd60e51b81526004016101f990610781565b61044a6000610621565b565b6004805460405163efc7840160e01b815233928101929092526001600160a01b03169063efc7840190602401602060405180830381865afa158015610495573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906104b99190610807565b6104fe5760405162461bcd60e51b81526020600482015260166024820152752737ba103bb434ba32b634b9ba32b21039b2b73232b960511b60448201526064016101f9565b60018190556040518181527f351fb23757bb5ea0546c85b7996ddd7155f96b939ebaa5ff7bc49c75f27f2c4490602001610286565b80516000908190815b818110156105865784818151811061055657610556610829565b01602001516001600160f81b0319166000036105775760048301925061057e565b6010830192505b60010161053c565b50506002540160400192915050565b6000546001600160a01b031633146105bf5760405162461bcd60e51b81526004016101f990610781565b6001600160a01b0381166106155760405162461bcd60e51b815260206004820152601d60248201527f6e6577206f776e657220697320746865207a65726f206164647265737300000060448201526064016101f9565b61061e81610621565b50565b600080546001600160a01b038381166001600160a01b0319831681178455604051919092169283917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e09190a35050565b60006020828403121561068357600080fd5b5035919050565b60006020828403121561069c57600080fd5b81356001600160a01b03811681146106b357600080fd5b9392505050565b634e487b7160e01b600052604160045260246000fd5b6000602082840312156106e257600080fd5b813567ffffffffffffffff808211156106fa57600080fd5b818401915084601f83011261070e57600080fd5b813581811115610720576107206106ba565b604051601f8201601f19908116603f01168101908382118183101715610748576107486106ba565b8160405282815287602084870101111561076157600080fd5b826020860160208301376000928101602001929092525095945050505050565b60208082526017908201527f63616c6c6572206973206e6f7420746865206f776e6572000000000000000000604082015260600190565b60008160001904831182151516156107e057634e487b7160e01b600052601160045260246000fd5b500290565b60008261080257634e487b7160e01b600052601260045260246000fd5b500490565b60006020828403121561081957600080fd5b815180151581146106b357600080fd5b634e487b7160e01b600052603260045260246000fdfea26469706673582212205ea335809638809cf032c794fd966e2439020737b1dcc2218435cb438286efcf64736f6c63430008100033&quot;));</span>
<span class="term-fg32">+        let oracle_pre_fork = AccountInfo {</span>
<span class="term-fg32">+            code_size: bytecode_pre_fork.len(),</span>
<span class="term-fg32">+            code_hash: bytecode_pre_fork.hash_slow(),</span>
<span class="term-fg32">+            poseidon_code_hash: bytecode_pre_fork.poseidon_hash_slow(),</span>
<span class="term-fg32">+            code: Some(bytecode_pre_fork),</span>
<span class="term-fg32">+            ..Default::default()</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let oracle_storage_pre_fork = PlainStorage::from_iter([</span>
<span class="term-fg32">+            (U256::ZERO, U256::from_str(&quot;0x13d24a7ff6f5ec5ff0e9c40fc3b8c9c01c65437b&quot;)?),</span>
<span class="term-fg32">+            (U256::from(1), U256::from(0x15f50e5e)),</span>
<span class="term-fg32">+            (U256::from(2), U256::from(0x38)),</span>
<span class="term-fg32">+            (U256::from(3), U256::from(0x3e95ba80)),</span>
<span class="term-fg32">+            (U256::from(4), U256::from_str(&quot;0x5300000000000000000000000000000000000003&quot;)?),</span>
<span class="term-fg32">+        ]);</span>
<span class="term-fg32">+        state.insert_account_with_storage(</span>
<span class="term-fg32">+            L1_GAS_PRICE_ORACLE_ADDRESS,</span>
<span class="term-fg32">+            oracle_pre_fork.clone(),</span>
<span class="term-fg32">+            oracle_storage_pre_fork.clone(),</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; apply curie fork</span>
<span class="term-fg32">+        apply_curie_hard_fork(&amp;mut state)?;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; merge transitions</span>
<span class="term-fg32">+        state.merge_transitions(BundleRetention::Reverts);</span>
<span class="term-fg32">+        let bundle = state.take_bundle();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check oracle account info</span>
<span class="term-fg32">+        let oracle = bundle.state.get(&amp;L1_GAS_PRICE_ORACLE_ADDRESS).unwrap().clone();</span>
<span class="term-fg32">+        let code_hash = keccak256(&amp;CURIE_L1_GAS_PRICE_ORACLE_BYTECODE);</span>
<span class="term-fg32">+        let bytecode = Bytecode::new_raw(CURIE_L1_GAS_PRICE_ORACLE_BYTECODE);</span>
<span class="term-fg32">+        let expected_oracle_info = AccountInfo {</span>
<span class="term-fg32">+            code_size: CURIE_L1_GAS_PRICE_ORACLE_BYTECODE.len(),</span>
<span class="term-fg32">+            code_hash,</span>
<span class="term-fg32">+            poseidon_code_hash: poseidon(&amp;CURIE_L1_GAS_PRICE_ORACLE_BYTECODE),</span>
<span class="term-fg32">+            code: Some(bytecode.clone()),</span>
<span class="term-fg32">+            ..Default::default()</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        assert_eq!(oracle.original_info.unwrap(), oracle_pre_fork);</span>
<span class="term-fg32">+        assert_eq!(oracle.info.unwrap(), expected_oracle_info);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check oracle storage changeset</span>
<span class="term-fg32">+        let mut storage = oracle.storage.into_iter().collect::&lt;Vec&lt;(U256, StorageSlot)&gt;&gt;();</span>
<span class="term-fg32">+        storage.sort_by(|(a, _), (b, _)| a.cmp(b));</span>
<span class="term-fg32">+        for (got, expected) in storage.into_iter().zip(CURIE_L1_GAS_PRICE_ORACLE_STORAGE) {</span>
<span class="term-fg32">+            assert_eq!(got.0, expected.0);</span>
<span class="term-fg32">+            assert_eq!(got.1, StorageSlot { present_value: expected.1, ..Default::default() });</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check oracle original storage</span>
<span class="term-fg32">+        for (slot, value) in oracle_storage_pre_fork {</span>
<span class="term-fg32">+            assert_eq!(state.storage(L1_GAS_PRICE_ORACLE_ADDRESS, slot)?, value)</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check deployed contract</span>
<span class="term-fg32">+        assert_eq!(bundle.contracts.get(&amp;code_hash).unwrap().clone(), bytecode);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ae3494e9cfcd0a71f9e3f0c5" role="button"
                       aria-expanded="false" aria-controls="id-ae3494e9cfcd0a71f9e3f0c5">
                        <code>crates/scroll/consensus/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/consensus/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ae3494e9cfcd0a71f9e3f0c5"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;consensus&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;consensus&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..6d4e4562a5bdad13492ce646abb0db466428e409</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;consensus&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,11 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll consensus implementation.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod curie;</span>
<span class="term-fg32">+pub use curie::{</span>
<span class="term-fg32">+    apply_curie_hard_fork, BLOB_SCALAR_SLOT, COMMIT_SCALAR_SLOT,</span>
<span class="term-fg32">+    CURIE_L1_GAS_PRICE_ORACLE_BYTECODE, CURIE_L1_GAS_PRICE_ORACLE_STORAGE, IS_CURIE_SLOT,</span>
<span class="term-fg32">+    L1_BASE_FEE_SLOT, L1_BLOB_BASE_FEE_SLOT, L1_GAS_PRICE_ORACLE_ADDRESS, OVER_HEAD_SLOT,</span>
<span class="term-fg32">+    SCALAR_SLOT,</span>
<span class="term-fg32">+};</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6f9c11024808164be9508acc" role="button"
                       aria-expanded="false" aria-controls="id-6f9c11024808164be9508acc">
                        <code>crates/scroll/evm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/evm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+64</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6f9c11024808164be9508acc"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;evm&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..28653851c6d641b4fac8f933d2fc0fbbe66e9d4c</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;evm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,64 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-evm&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-chainspec.workspace = true</span>
<span class="term-fg32">+reth-consensus.workspace = true</span>
<span class="term-fg32">+reth-ethereum-consensus.workspace = true</span>
<span class="term-fg32">+reth-evm.workspace = true</span>
<span class="term-fg32">+reth-primitives.workspace = true</span>
<span class="term-fg32">+reth-primitives-traits.workspace = true</span>
<span class="term-fg32">+reth-revm.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# revm</span>
<span class="term-fg32">+revm = { workspace = true, features = [&quot;optional_no_base_fee&quot;] }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-chainspec.workspace = true</span>
<span class="term-fg32">+reth-scroll-forks.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# alloy</span>
<span class="term-fg32">+alloy-consensus.workspace = true</span>
<span class="term-fg32">+alloy-eips.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-consensus.workspace = true</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# misc</span>
<span class="term-fg32">+auto_impl.workspace = true</span>
<span class="term-fg32">+derive_more.workspace = true</span>
<span class="term-fg32">+thiserror.workspace = true</span>
<span class="term-fg32">+tracing.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dev-dependencies]</span>
<span class="term-fg32">+eyre.workspace = true</span>
<span class="term-fg32">+reth-scroll-execution = { workspace = true, features = [&quot;test-utils&quot;] }</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+optimism = [</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;optimism&quot;,</span>
<span class="term-fg32">+	&quot;revm&#47;optimism&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-chainspec&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-consensus&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-execution&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;revm&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-bcad44b175494105572dbe70" role="button"
                       aria-expanded="false" aria-controls="id-bcad44b175494105572dbe70">
                        <code>crates/scroll/evm/src/config.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/evm/src/config.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+331</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-bcad44b175494105572dbe70"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;evm&#47;src&#47;config.rs scroll-reth&#47;crates&#47;scroll&#47;evm&#47;src&#47;config.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..e1813fe0d021bc6bcbcfd87da80388ce1f069580</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;evm&#47;src&#47;config.rs</span>
<span class="term-fg36">@@ -0,0 +1,331 @@</span>
<span class="term-fg32">+use reth_chainspec::{ChainSpecProvider, Head};</span>
<span class="term-fg32">+use reth_evm::{ConfigureEvm, ConfigureEvmEnv, NextBlockEnvAttributes};</span>
<span class="term-fg32">+use reth_primitives::{transaction::FillTxEnv, TransactionSigned};</span>
<span class="term-fg32">+use reth_revm::{inspector_handle_register, Database, Evm, GetInspector, TxEnv};</span>
<span class="term-fg32">+use reth_scroll_chainspec::ScrollChainSpec;</span>
<span class="term-fg32">+use reth_scroll_forks::ScrollHardfork;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    precompile::{Address, Bytes},</span>
<span class="term-fg32">+    primitives::{</span>
<span class="term-fg32">+        AnalysisKind, BlockEnv, CfgEnv, CfgEnvWithHandlerCfg, Env, HandlerCfg, SpecId, U256,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    EvmBuilder,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use std::{convert::Infallible, sync::Arc};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Scroll EVM configuration.</span>
<span class="term-fg32">+#[derive(Clone, Debug)]</span>
<span class="term-fg32">+pub struct ScrollEvmConfig {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The chain spec for Scroll.</span>
<span class="term-fg32">+    chain_spec: Arc&lt;ScrollChainSpec&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollEvmConfig {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns a new instance of [`ScrollEvmConfig`].</span>
<span class="term-fg32">+    pub const fn new(chain_spec: Arc&lt;ScrollChainSpec&gt;) -&gt; Self {</span>
<span class="term-fg32">+        Self { chain_spec }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the spec id at the given head.</span>
<span class="term-fg32">+    pub fn spec_id_at_head(&amp;self, head: &amp;Head) -&gt; SpecId {</span>
<span class="term-fg32">+        let chain_spec = &amp;self.chain_spec;</span>
<span class="term-fg32">+        if chain_spec.fork(ScrollHardfork::Curie).active_at_head(head) {</span>
<span class="term-fg32">+            SpecId::CURIE</span>
<span class="term-fg32">+        } else if chain_spec.fork(ScrollHardfork::Bernoulli).active_at_head(head) {</span>
<span class="term-fg32">+            SpecId::BERNOULLI</span>
<span class="term-fg32">+        } else {</span>
<span class="term-fg32">+            SpecId::PRE_BERNOULLI</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ConfigureEvm for ScrollEvmConfig {</span>
<span class="term-fg32">+    type DefaultExternalContext&lt;&#39;a&gt; = ();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn evm&lt;DB: Database&gt;(&amp;self, db: DB) -&gt; Evm&lt;&#39;_, Self::DefaultExternalContext&lt;&#39;_&gt;, DB&gt; {</span>
<span class="term-fg32">+        EvmBuilder::default().with_db(db).scroll().build()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn evm_with_inspector&lt;DB, I&gt;(&amp;self, db: DB, inspector: I) -&gt; Evm&lt;&#39;_, I, DB&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        DB: Database,</span>
<span class="term-fg32">+        I: GetInspector&lt;DB&gt;,</span>
<span class="term-fg32">+    {</span>
<span class="term-fg32">+        EvmBuilder::default()</span>
<span class="term-fg32">+            .with_db(db)</span>
<span class="term-fg32">+            .with_external_context(inspector)</span>
<span class="term-fg32">+            .scroll()</span>
<span class="term-fg32">+            .append_handler_register(inspector_handle_register)</span>
<span class="term-fg32">+            .build()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn default_external_context&lt;&#39;a&gt;(&amp;self) -&gt; Self::DefaultExternalContext&lt;&#39;a&gt; {}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ConfigureEvmEnv for ScrollEvmConfig {</span>
<span class="term-fg32">+    type Header = alloy_consensus::Header;</span>
<span class="term-fg32">+    type Error = Infallible;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn fill_tx_env(&amp;self, tx_env: &amp;mut TxEnv, transaction: &amp;TransactionSigned, sender: Address) {</span>
<span class="term-fg32">+        transaction.fill_tx_env(tx_env, sender);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn fill_tx_env_system_contract_call(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        _env: &amp;mut Env,</span>
<span class="term-fg32">+        _caller: Address,</span>
<span class="term-fg32">+        _contract: Address,</span>
<span class="term-fg32">+        _data: Bytes,</span>
<span class="term-fg32">+    ) {</span>
<span class="term-fg32">+        &#47;* noop *&#47;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn fill_cfg_env(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        cfg_env: &amp;mut CfgEnvWithHandlerCfg,</span>
<span class="term-fg32">+        header: &amp;Self::Header,</span>
<span class="term-fg32">+        total_difficulty: U256,</span>
<span class="term-fg32">+    ) {</span>
<span class="term-fg32">+        let spec_id = self.spec_id_at_head(&amp;Head {</span>
<span class="term-fg32">+            number: header.number,</span>
<span class="term-fg32">+            timestamp: header.timestamp,</span>
<span class="term-fg32">+            difficulty: header.difficulty,</span>
<span class="term-fg32">+            total_difficulty,</span>
<span class="term-fg32">+            ..Default::default()</span>
<span class="term-fg32">+        });</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        cfg_env.handler_cfg.spec_id = spec_id;</span>
<span class="term-fg32">+        cfg_env.handler_cfg.is_scroll = true;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        cfg_env.chain_id = self.chain_spec.chain().id();</span>
<span class="term-fg32">+        cfg_env.perf_analyse_created_bytecodes = AnalysisKind::Analyse;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn fill_block_env(&amp;self, block_env: &amp;mut BlockEnv, header: &amp;Self::Header, after_merge: bool) {</span>
<span class="term-fg32">+        block_env.number = U256::from(header.number);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        if let Some(vault_address) = self.chain_spec.config.fee_vault_address {</span>
<span class="term-fg32">+            block_env.coinbase = vault_address;</span>
<span class="term-fg32">+        } else {</span>
<span class="term-fg32">+            block_env.coinbase = header.beneficiary;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        block_env.timestamp = U256::from(header.timestamp);</span>
<span class="term-fg32">+        if after_merge {</span>
<span class="term-fg32">+            block_env.prevrandao = Some(header.mix_hash);</span>
<span class="term-fg32">+            block_env.difficulty = U256::ZERO;</span>
<span class="term-fg32">+        } else {</span>
<span class="term-fg32">+            block_env.difficulty = header.difficulty;</span>
<span class="term-fg32">+            block_env.prevrandao = None;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        block_env.basefee = U256::from(header.base_fee_per_gas.unwrap_or_default());</span>
<span class="term-fg32">+        block_env.gas_limit = U256::from(header.gas_limit);</span>
<span class="term-fg32">+        block_env.blob_excess_gas_and_price = None;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn next_cfg_and_block_env(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        parent: &amp;Self::Header,</span>
<span class="term-fg32">+        attributes: NextBlockEnvAttributes,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;(CfgEnvWithHandlerCfg, BlockEnv), Self::Error&gt; {</span>
<span class="term-fg32">+        &#47;&#47; configure evm env based on parent block</span>
<span class="term-fg32">+        let cfg = CfgEnv::default().with_chain_id(self.chain_spec.chain().id());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; fetch spec id from next head number and timestamp</span>
<span class="term-fg32">+        let spec_id = self.spec_id_at_head(&amp;Head {</span>
<span class="term-fg32">+            number: parent.number + 1,</span>
<span class="term-fg32">+            timestamp: attributes.timestamp,</span>
<span class="term-fg32">+            ..Default::default()</span>
<span class="term-fg32">+        });</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let coinbase = if let Some(vault_address) = self.chain_spec.config.fee_vault_address {</span>
<span class="term-fg32">+            vault_address</span>
<span class="term-fg32">+        } else {</span>
<span class="term-fg32">+            attributes.suggested_fee_recipient</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let block_env = BlockEnv {</span>
<span class="term-fg32">+            number: U256::from(parent.number + 1),</span>
<span class="term-fg32">+            coinbase,</span>
<span class="term-fg32">+            timestamp: U256::from(attributes.timestamp),</span>
<span class="term-fg32">+            difficulty: U256::ZERO,</span>
<span class="term-fg32">+            prevrandao: Some(attributes.prev_randao),</span>
<span class="term-fg32">+            gas_limit: U256::from(parent.gas_limit),</span>
<span class="term-fg32">+            &#47;&#47; calculate basefee based on parent block&#39;s gas usage</span>
<span class="term-fg32">+            &#47;&#47; TODO(scroll): update with correct block fee calculation for block building.</span>
<span class="term-fg32">+            basefee: U256::from(parent.base_fee_per_gas.unwrap_or_default()),</span>
<span class="term-fg32">+            blob_excess_gas_and_price: None,</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let cfg_with_handler_cfg = CfgEnvWithHandlerCfg {</span>
<span class="term-fg32">+            cfg_env: cfg,</span>
<span class="term-fg32">+            handler_cfg: HandlerCfg { spec_id, is_scroll: true },</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok((cfg_with_handler_cfg, block_env))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ChainSpecProvider for ScrollEvmConfig {</span>
<span class="term-fg32">+    type ChainSpec = ScrollChainSpec;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn chain_spec(&amp;self) -&gt; Arc&lt;Self::ChainSpec&gt; {</span>
<span class="term-fg32">+        self.chain_spec.clone()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(test)]</span>
<span class="term-fg32">+mod tests {</span>
<span class="term-fg32">+    use super::*;</span>
<span class="term-fg32">+    use alloy_consensus::Header;</span>
<span class="term-fg32">+    use reth_chainspec::NamedChain::Scroll;</span>
<span class="term-fg32">+    use reth_scroll_chainspec::{ScrollChainConfig, ScrollChainSpecBuilder};</span>
<span class="term-fg32">+    use revm::primitives::{SpecId, B256};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_spec_at_head() {</span>
<span class="term-fg32">+        let config = ScrollEvmConfig::new(</span>
<span class="term-fg32">+            ScrollChainSpecBuilder::scroll_mainnet().build(ScrollChainConfig::mainnet()).into(),</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; prepare all fork heads</span>
<span class="term-fg32">+        let curie_head = &amp;Head { number: 7096836, ..Default::default() };</span>
<span class="term-fg32">+        let bernouilli_head = &amp;Head { number: 5220340, ..Default::default() };</span>
<span class="term-fg32">+        let pre_bernouilli_head = &amp;Head { number: 0, ..Default::default() };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check correct spec id</span>
<span class="term-fg32">+        assert_eq!(config.spec_id_at_head(curie_head), SpecId::CURIE);</span>
<span class="term-fg32">+        assert_eq!(config.spec_id_at_head(bernouilli_head), SpecId::BERNOULLI);</span>
<span class="term-fg32">+        assert_eq!(config.spec_id_at_head(pre_bernouilli_head), SpecId::PRE_BERNOULLI);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_fill_cfg_env() {</span>
<span class="term-fg32">+        let config = ScrollEvmConfig::new(</span>
<span class="term-fg32">+            ScrollChainSpecBuilder::scroll_mainnet().build(ScrollChainConfig::mainnet()).into(),</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; curie</span>
<span class="term-fg32">+        let mut cfg_env = CfgEnvWithHandlerCfg::new(Default::default(), Default::default());</span>
<span class="term-fg32">+        let curie_header = Header { number: 7096836, ..Default::default() };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; fill cfg env</span>
<span class="term-fg32">+        config.fill_cfg_env(&amp;mut cfg_env, &amp;curie_header, U256::ZERO);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check correct cfg env</span>
<span class="term-fg32">+        assert_eq!(cfg_env.chain_id, Scroll as u64);</span>
<span class="term-fg32">+        assert_eq!(cfg_env.perf_analyse_created_bytecodes, AnalysisKind::Analyse);</span>
<span class="term-fg32">+        assert_eq!(cfg_env.handler_cfg.spec_id, SpecId::CURIE);</span>
<span class="term-fg32">+        assert!(cfg_env.handler_cfg.is_scroll);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; bernoulli</span>
<span class="term-fg32">+        let mut cfg_env = CfgEnvWithHandlerCfg::new(Default::default(), Default::default());</span>
<span class="term-fg32">+        let bernouilli_header = Header { number: 5220340, ..Default::default() };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; fill cfg env</span>
<span class="term-fg32">+        config.fill_cfg_env(&amp;mut cfg_env, &amp;bernouilli_header, U256::ZERO);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check correct cfg env</span>
<span class="term-fg32">+        assert_eq!(cfg_env.chain_id, Scroll as u64);</span>
<span class="term-fg32">+        assert_eq!(cfg_env.perf_analyse_created_bytecodes, AnalysisKind::Analyse);</span>
<span class="term-fg32">+        assert_eq!(cfg_env.handler_cfg.spec_id, SpecId::BERNOULLI);</span>
<span class="term-fg32">+        assert!(cfg_env.handler_cfg.is_scroll);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; pre-bernoulli</span>
<span class="term-fg32">+        let mut cfg_env = CfgEnvWithHandlerCfg::new(Default::default(), Default::default());</span>
<span class="term-fg32">+        let pre_bernouilli_header = Header { number: 0, ..Default::default() };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; fill cfg env</span>
<span class="term-fg32">+        config.fill_cfg_env(&amp;mut cfg_env, &amp;pre_bernouilli_header, U256::ZERO);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check correct cfg env</span>
<span class="term-fg32">+        assert_eq!(cfg_env.chain_id, Scroll as u64);</span>
<span class="term-fg32">+        assert_eq!(cfg_env.perf_analyse_created_bytecodes, AnalysisKind::Analyse);</span>
<span class="term-fg32">+        assert_eq!(cfg_env.handler_cfg.spec_id, SpecId::PRE_BERNOULLI);</span>
<span class="term-fg32">+        assert!(cfg_env.handler_cfg.is_scroll);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_fill_block_env() {</span>
<span class="term-fg32">+        let config = ScrollEvmConfig::new(</span>
<span class="term-fg32">+            ScrollChainSpecBuilder::scroll_mainnet().build(ScrollChainConfig::mainnet()).into(),</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+        let mut block_env = BlockEnv::default();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; curie header</span>
<span class="term-fg32">+        let header = Header {</span>
<span class="term-fg32">+            number: 7096836,</span>
<span class="term-fg32">+            beneficiary: Address::random(),</span>
<span class="term-fg32">+            timestamp: 1719994277,</span>
<span class="term-fg32">+            mix_hash: B256::random(),</span>
<span class="term-fg32">+            base_fee_per_gas: Some(155157341),</span>
<span class="term-fg32">+            gas_limit: 10000000,</span>
<span class="term-fg32">+            ..Default::default()</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; fill block env</span>
<span class="term-fg32">+        config.fill_block_env(&amp;mut block_env, &amp;header, true);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; verify block env correctly updated</span>
<span class="term-fg32">+        let expected = BlockEnv {</span>
<span class="term-fg32">+            number: U256::from(header.number),</span>
<span class="term-fg32">+            coinbase: config.chain_spec.config.fee_vault_address.unwrap(),</span>
<span class="term-fg32">+            timestamp: U256::from(header.timestamp),</span>
<span class="term-fg32">+            prevrandao: Some(header.mix_hash),</span>
<span class="term-fg32">+            difficulty: U256::ZERO,</span>
<span class="term-fg32">+            basefee: U256::from(header.base_fee_per_gas.unwrap_or_default()),</span>
<span class="term-fg32">+            gas_limit: U256::from(header.gas_limit),</span>
<span class="term-fg32">+            blob_excess_gas_and_price: None,</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        assert_eq!(block_env, expected)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_next_cfg_and_block_env() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        let config = ScrollEvmConfig::new(</span>
<span class="term-fg32">+            ScrollChainSpecBuilder::scroll_mainnet().build(ScrollChainConfig::mainnet()).into(),</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; pre curie header</span>
<span class="term-fg32">+        let header = Header {</span>
<span class="term-fg32">+            number: 7096835,</span>
<span class="term-fg32">+            beneficiary: Address::random(),</span>
<span class="term-fg32">+            timestamp: 1719994274,</span>
<span class="term-fg32">+            mix_hash: B256::random(),</span>
<span class="term-fg32">+            base_fee_per_gas: None,</span>
<span class="term-fg32">+            gas_limit: 10000000,</span>
<span class="term-fg32">+            ..Default::default()</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; curie block attributes</span>
<span class="term-fg32">+        let attributes = NextBlockEnvAttributes {</span>
<span class="term-fg32">+            timestamp: 1719994277,</span>
<span class="term-fg32">+            suggested_fee_recipient: Address::random(),</span>
<span class="term-fg32">+            prev_randao: B256::random(),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; get next cfg env and block env</span>
<span class="term-fg32">+        let (cfg_env, block_env) = config.next_cfg_and_block_env(&amp;header, attributes)?;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; verify cfg env</span>
<span class="term-fg32">+        assert_eq!(cfg_env.chain_id, Scroll as u64);</span>
<span class="term-fg32">+        assert_eq!(cfg_env.handler_cfg.spec_id, SpecId::CURIE);</span>
<span class="term-fg32">+        assert!(cfg_env.handler_cfg.is_scroll);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; verify block env</span>
<span class="term-fg32">+        let expected = BlockEnv {</span>
<span class="term-fg32">+            number: U256::from(header.number + 1),</span>
<span class="term-fg32">+            coinbase: config.chain_spec.config.fee_vault_address.unwrap(),</span>
<span class="term-fg32">+            timestamp: U256::from(attributes.timestamp),</span>
<span class="term-fg32">+            prevrandao: Some(attributes.prev_randao),</span>
<span class="term-fg32">+            difficulty: U256::ZERO,</span>
<span class="term-fg32">+            &#47;&#47; TODO(scroll): this shouldn&#39;t be 0 at curie fork</span>
<span class="term-fg32">+            basefee: U256::ZERO,</span>
<span class="term-fg32">+            gas_limit: U256::from(header.gas_limit),</span>
<span class="term-fg32">+            blob_excess_gas_and_price: None,</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        assert_eq!(block_env, expected);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b75883438d2883ffa5a28f26" role="button"
                       aria-expanded="false" aria-controls="id-b75883438d2883ffa5a28f26">
                        <code>crates/scroll/evm/src/error.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/evm/src/error.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+29</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b75883438d2883ffa5a28f26"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;evm&#47;src&#47;error.rs scroll-reth&#47;crates&#47;scroll&#47;evm&#47;src&#47;error.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..3e2f469a4a6e6f9fad8b3d4b2d04800be47ab990</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;evm&#47;src&#47;error.rs</span>
<span class="term-fg36">@@ -0,0 +1,29 @@</span>
<span class="term-fg32">+use derive_more::{Display, From};</span>
<span class="term-fg32">+use reth_evm::execute::BlockExecutionError;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Execution error for Scroll.</span>
<span class="term-fg32">+#[derive(thiserror::Error, Display, From, Debug)]</span>
<span class="term-fg32">+pub enum ScrollBlockExecutionError {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Error occurred at fork transition.</span>
<span class="term-fg32">+    #[display(&quot;failed to apply fork: {_0}&quot;)]</span>
<span class="term-fg32">+    Fork(ForkError),</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;ScrollBlockExecutionError&gt; for BlockExecutionError {</span>
<span class="term-fg32">+    fn from(value: ScrollBlockExecutionError) -&gt; Self {</span>
<span class="term-fg32">+        Self::other(value)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Scroll fork error.</span>
<span class="term-fg32">+#[derive(Debug, Display)]</span>
<span class="term-fg32">+pub enum ForkError {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Error occurred at Curie fork.</span>
<span class="term-fg32">+    Curie(String),</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;ForkError&gt; for BlockExecutionError {</span>
<span class="term-fg32">+    fn from(value: ForkError) -&gt; Self {</span>
<span class="term-fg32">+        ScrollBlockExecutionError::Fork(value).into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-bba35fc8bf8d07969ba06311" role="button"
                       aria-expanded="false" aria-controls="id-bba35fc8bf8d07969ba06311">
                        <code>crates/scroll/evm/src/execute.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/evm/src/execute.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+625</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-bba35fc8bf8d07969ba06311"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;evm&#47;src&#47;execute.rs scroll-reth&#47;crates&#47;scroll&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..fc7e84be9a05836564458596a04e37cb55f36fb8</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg36">@@ -0,0 +1,625 @@</span>
<span class="term-fg32">+&#47;&#47;! Implementation of the [`BlockExecutionStrategy`] for Scroll.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use crate::{ForkError, ScrollEvmConfig};</span>
<span class="term-fg32">+use alloy_consensus::{Header, Transaction};</span>
<span class="term-fg32">+use alloy_eips::eip7685::Requests;</span>
<span class="term-fg32">+use reth_chainspec::EthereumHardforks;</span>
<span class="term-fg32">+use reth_consensus::ConsensusError;</span>
<span class="term-fg32">+use reth_evm::{</span>
<span class="term-fg32">+    execute::{</span>
<span class="term-fg32">+        BasicBlockExecutorProvider, BlockExecutionError, BlockExecutionStrategy,</span>
<span class="term-fg32">+        BlockExecutionStrategyFactory, BlockValidationError, ExecuteOutput, ProviderError,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    ConfigureEvm, ConfigureEvmEnv,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_primitives::{</span>
<span class="term-fg32">+    gas_spent_by_transactions, BlockWithSenders, GotExpected, InvalidTransactionError, Receipt,</span>
<span class="term-fg32">+    TxType,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_revm::primitives::{CfgEnvWithHandlerCfg, U256};</span>
<span class="term-fg32">+use reth_scroll_chainspec::{ChainSpecProvider, ScrollChainSpec};</span>
<span class="term-fg32">+use reth_scroll_consensus::{apply_curie_hard_fork, L1_GAS_PRICE_ORACLE_ADDRESS};</span>
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
<span class="term-fg32">+use reth_scroll_forks::{ScrollHardfork, ScrollHardforks};</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::BundleState,</span>
<span class="term-fg32">+    primitives::{BlockEnv, EnvWithHandlerCfg, ExecutionResult, ResultAndState},</span>
<span class="term-fg32">+    Database, DatabaseCommit, State,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use std::{</span>
<span class="term-fg32">+    fmt::{Debug, Display},</span>
<span class="term-fg32">+    sync::Arc,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The Scroll block execution strategy.</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct ScrollExecutionStrategy&lt;DB, EvmConfig&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Evm configuration.</span>
<span class="term-fg32">+    evm_config: EvmConfig,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Current state for the execution.</span>
<span class="term-fg32">+    state: State&lt;DB&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB, EvmConfig&gt; ScrollExecutionStrategy&lt;DB, EvmConfig&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns an instance of [`ScrollExecutionStrategy`].</span>
<span class="term-fg32">+    pub const fn new(evm_config: EvmConfig, state: State&lt;DB&gt;) -&gt; Self {</span>
<span class="term-fg32">+        Self { evm_config, state }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB, EvmConfig&gt; ScrollExecutionStrategy&lt;DB, EvmConfig&gt;</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    EvmConfig: ConfigureEvmEnv&lt;Header = Header&gt;,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    &#47;&#47;&#47; Configures a new evm configuration and block environment for the given block.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; # Caution</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; This does not initialize the tx environment.</span>
<span class="term-fg32">+    fn evm_env_for_block(&amp;self, header: &amp;Header, total_difficulty: U256) -&gt; EnvWithHandlerCfg {</span>
<span class="term-fg32">+        let mut cfg = CfgEnvWithHandlerCfg::new(Default::default(), Default::default());</span>
<span class="term-fg32">+        let mut block_env = BlockEnv::default();</span>
<span class="term-fg32">+        self.evm_config.fill_cfg_and_block_env(&amp;mut cfg, &amp;mut block_env, header, total_difficulty);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        EnvWithHandlerCfg::new_with_cfg_env(cfg, block_env, Default::default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB, EvmConfig&gt; BlockExecutionStrategy&lt;DB&gt; for ScrollExecutionStrategy&lt;DB, EvmConfig&gt;</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,</span>
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
<span class="term-fg32">+    EvmConfig: ConfigureEvm&lt;Header = Header&gt; + ChainSpecProvider&lt;ChainSpec = ScrollChainSpec&gt;,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    type Error = BlockExecutionError;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn apply_pre_execution_changes(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        block: &amp;BlockWithSenders,</span>
<span class="term-fg32">+        _total_difficulty: U256,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;(), Self::Error&gt; {</span>
<span class="term-fg32">+        &#47;&#47; set state clear flag if the block is after the Spurious Dragon hardfork.</span>
<span class="term-fg32">+        let state_clear_flag =</span>
<span class="term-fg32">+            (*self.evm_config.chain_spec()).is_spurious_dragon_active_at_block(block.header.number);</span>
<span class="term-fg32">+        self.state.set_state_clear_flag(state_clear_flag);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; load the l1 gas oracle contract in cache</span>
<span class="term-fg32">+        let _ =</span>
<span class="term-fg32">+            self.state.load_cache_account(L1_GAS_PRICE_ORACLE_ADDRESS).map_err(|err| err.into())?;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        if self</span>
<span class="term-fg32">+            .evm_config</span>
<span class="term-fg32">+            .chain_spec()</span>
<span class="term-fg32">+            .fork(ScrollHardfork::Curie)</span>
<span class="term-fg32">+            .transitions_at_block(block.number)</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+            if let Err(err) = apply_curie_hard_fork(&amp;mut self.state) {</span>
<span class="term-fg32">+                tracing::debug!(%err, &quot;failed to apply curie hardfork&quot;);</span>
<span class="term-fg32">+                return Err(ForkError::Curie(err.to_string()).into());</span>
<span class="term-fg32">+            };</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn execute_transactions(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        block: &amp;BlockWithSenders,</span>
<span class="term-fg32">+        total_difficulty: U256,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;ExecuteOutput, Self::Error&gt; {</span>
<span class="term-fg32">+        let env = self.evm_env_for_block(&amp;block.header, total_difficulty);</span>
<span class="term-fg32">+        let mut evm = self.evm_config.evm_with_env(&amp;mut self.state, env);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut cumulative_gas_used = 0;</span>
<span class="term-fg32">+        let mut receipts = Vec::with_capacity(block.body.transactions.len());</span>
<span class="term-fg32">+        let chain_spec = self.evm_config.chain_spec();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        for (sender, transaction) in block.transactions_with_sender() {</span>
<span class="term-fg32">+            &#47;&#47; The sum of the transaction’s gas limit and the gas utilized in this block prior,</span>
<span class="term-fg32">+            &#47;&#47; must be no greater than the block’s gasLimit.</span>
<span class="term-fg32">+            let block_available_gas = block.header.gas_limit - cumulative_gas_used;</span>
<span class="term-fg32">+            if transaction.gas_limit() &gt; block_available_gas {</span>
<span class="term-fg32">+                return Err(BlockValidationError::TransactionGasLimitMoreThanAvailableBlockGas {</span>
<span class="term-fg32">+                    transaction_gas_limit: transaction.gas_limit(),</span>
<span class="term-fg32">+                    block_available_gas,</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                .into())</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; verify the transaction type is accepted by the current fork.</span>
<span class="term-fg32">+            match transaction.tx_type() {</span>
<span class="term-fg32">+                TxType::Eip2930 if !chain_spec.is_curie_active_at_block(block.number) =&gt; {</span>
<span class="term-fg32">+                    return Err(ConsensusError::InvalidTransaction(</span>
<span class="term-fg32">+                        InvalidTransactionError::Eip2930Disabled,</span>
<span class="term-fg32">+                    )</span>
<span class="term-fg32">+                    .into())</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                TxType::Eip1559 if !chain_spec.is_curie_active_at_block(block.number) =&gt; {</span>
<span class="term-fg32">+                    return Err(ConsensusError::InvalidTransaction(</span>
<span class="term-fg32">+                        InvalidTransactionError::Eip1559Disabled,</span>
<span class="term-fg32">+                    )</span>
<span class="term-fg32">+                    .into())</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                TxType::Eip4844 =&gt; {</span>
<span class="term-fg32">+                    return Err(ConsensusError::InvalidTransaction(</span>
<span class="term-fg32">+                        InvalidTransactionError::Eip4844Disabled,</span>
<span class="term-fg32">+                    )</span>
<span class="term-fg32">+                    .into())</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                TxType::Eip7702 =&gt; {</span>
<span class="term-fg32">+                    return Err(ConsensusError::InvalidTransaction(</span>
<span class="term-fg32">+                        InvalidTransactionError::Eip7702Disabled,</span>
<span class="term-fg32">+                    )</span>
<span class="term-fg32">+                    .into())</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                _ =&gt; (),</span>
<span class="term-fg32">+            };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            self.evm_config.fill_tx_env(evm.tx_mut(), transaction, *sender);</span>
<span class="term-fg32">+            if transaction.is_l1_message() {</span>
<span class="term-fg32">+                evm.context.evm.env.cfg.disable_base_fee = true; &#47;&#47; disable base fee for l1 msg</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; execute the transaction and commit the result to the database</span>
<span class="term-fg32">+            let ResultAndState { result, state } =</span>
<span class="term-fg32">+                evm.transact().map_err(|err| BlockValidationError::EVM {</span>
<span class="term-fg32">+                    hash: transaction.recalculate_hash(),</span>
<span class="term-fg32">+                    error: Box::new(err.map_db_err(|e| e.into())),</span>
<span class="term-fg32">+                })?;</span>
<span class="term-fg32">+            evm.db_mut().commit(state);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            let l1_fee = if transaction.is_l1_message() {</span>
<span class="term-fg32">+                &#47;&#47; l1 messages do not get any gas refunded</span>
<span class="term-fg32">+                if let ExecutionResult::Success { gas_refunded, .. } = result {</span>
<span class="term-fg32">+                    cumulative_gas_used += gas_refunded</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                U256::ZERO</span>
<span class="term-fg32">+            } else {</span>
<span class="term-fg32">+                &#47;&#47; compute l1 fee for all non-l1 transaction</span>
<span class="term-fg32">+                let l1_block_info =</span>
<span class="term-fg32">+                    evm.context.evm.inner.l1_block_info.as_ref().expect(&quot;l1_block_info loaded&quot;);</span>
<span class="term-fg32">+                let transaction_rlp_bytes =</span>
<span class="term-fg32">+                    evm.context.evm.env.tx.scroll.rlp_bytes.as_ref().expect(&quot;rlp_bytes loaded&quot;);</span>
<span class="term-fg32">+                l1_block_info.calculate_tx_l1_cost(transaction_rlp_bytes, evm.handler.cfg.spec_id)</span>
<span class="term-fg32">+            };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            cumulative_gas_used += result.gas_used();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            receipts.push(Receipt {</span>
<span class="term-fg32">+                tx_type: transaction.tx_type(),</span>
<span class="term-fg32">+                success: result.is_success(),</span>
<span class="term-fg32">+                cumulative_gas_used,</span>
<span class="term-fg32">+                logs: result.into_logs(),</span>
<span class="term-fg32">+                l1_fee,</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(ExecuteOutput { receipts, gas_used: cumulative_gas_used })</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn apply_post_execution_changes(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        _block: &amp;BlockWithSenders,</span>
<span class="term-fg32">+        _total_difficulty: U256,</span>
<span class="term-fg32">+        _receipts: &amp;[Receipt],</span>
<span class="term-fg32">+    ) -&gt; Result&lt;Requests, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(Default::default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn state_ref(&amp;self) -&gt; &amp;State&lt;DB&gt; {</span>
<span class="term-fg32">+        &amp;self.state</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn state_mut(&amp;mut self) -&gt; &amp;mut State&lt;DB&gt; {</span>
<span class="term-fg32">+        &amp;mut self.state</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn validate_block_post_execution(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        block: &amp;BlockWithSenders,</span>
<span class="term-fg32">+        receipts: &amp;[Receipt],</span>
<span class="term-fg32">+        _requests: &amp;Requests,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;(), ConsensusError&gt; {</span>
<span class="term-fg32">+        &#47;&#47; verify the block gas used</span>
<span class="term-fg32">+        let cumulative_gas_used = receipts.last().map(|r| r.cumulative_gas_used).unwrap_or(0);</span>
<span class="term-fg32">+        if block.gas_used != cumulative_gas_used {</span>
<span class="term-fg32">+            return Err(ConsensusError::BlockGasUsed {</span>
<span class="term-fg32">+                gas: GotExpected { got: cumulative_gas_used, expected: block.gas_used },</span>
<span class="term-fg32">+                gas_spent_by_tx: gas_spent_by_transactions(receipts),</span>
<span class="term-fg32">+            });</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; verify the receipts logs bloom and root</span>
<span class="term-fg32">+        if self.evm_config.chain_spec().is_byzantium_active_at_block(block.header.number) {</span>
<span class="term-fg32">+            if let Err(error) = reth_ethereum_consensus::verify_receipts(</span>
<span class="term-fg32">+                block.header.receipts_root,</span>
<span class="term-fg32">+                block.header.logs_bloom,</span>
<span class="term-fg32">+                receipts,</span>
<span class="term-fg32">+            ) {</span>
<span class="term-fg32">+                tracing::debug!(</span>
<span class="term-fg32">+                    %error,</span>
<span class="term-fg32">+                    ?receipts,</span>
<span class="term-fg32">+                    header_receipt_root = ?block.header.receipts_root,</span>
<span class="term-fg32">+                    header_bloom = ?block.header.logs_bloom,</span>
<span class="term-fg32">+                    &quot;failed to verify receipts&quot;</span>
<span class="term-fg32">+                );</span>
<span class="term-fg32">+                return Err(error);</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The factory for a [`ScrollExecutionStrategy`].</span>
<span class="term-fg32">+#[derive(Clone, Debug)]</span>
<span class="term-fg32">+pub struct ScrollExecutionStrategyFactory&lt;EvmConfig = ScrollEvmConfig&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The Evm configuration for the [`ScrollExecutionStrategy`].</span>
<span class="term-fg32">+    evm_config: EvmConfig,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollExecutionStrategyFactory {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns a new instance of the [`ScrollExecutionStrategyFactory`].</span>
<span class="term-fg32">+    pub const fn new(chain_spec: Arc&lt;ScrollChainSpec&gt;) -&gt; Self {</span>
<span class="term-fg32">+        let evm_config = ScrollEvmConfig::new(chain_spec);</span>
<span class="term-fg32">+        Self { evm_config }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the EVM configuration for the strategy factory.</span>
<span class="term-fg32">+    pub fn evm_config(&amp;self) -&gt; ScrollEvmConfig {</span>
<span class="term-fg32">+        self.evm_config.clone()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;EvmConfig&gt; BlockExecutionStrategyFactory for ScrollExecutionStrategyFactory&lt;EvmConfig&gt;</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    EvmConfig: ConfigureEvm&lt;Header = Header&gt; + ChainSpecProvider&lt;ChainSpec = ScrollChainSpec&gt;,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    &#47;&#47;&#47; Associated strategy type.</span>
<span class="term-fg32">+    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = ScrollExecutionStrategy&lt;DB, EvmConfig&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates a strategy using the give database.</span>
<span class="term-fg32">+    fn create_strategy&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Strategy&lt;DB&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
<span class="term-fg32">+    {</span>
<span class="term-fg32">+        let state =</span>
<span class="term-fg32">+            State::builder().with_database(db).without_state_clear().with_bundle_update().build();</span>
<span class="term-fg32">+        ScrollExecutionStrategy::new(self.evm_config.clone(), state)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Helper type with backwards compatible methods to obtain Scroll executor</span>
<span class="term-fg32">+&#47;&#47;&#47; providers.</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct ScrollExecutorProvider;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollExecutorProvider {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates a new default scroll executor provider.</span>
<span class="term-fg32">+    pub const fn scroll(</span>
<span class="term-fg32">+        chain_spec: Arc&lt;ScrollChainSpec&gt;,</span>
<span class="term-fg32">+    ) -&gt; BasicBlockExecutorProvider&lt;ScrollExecutionStrategyFactory&gt; {</span>
<span class="term-fg32">+        BasicBlockExecutorProvider::new(ScrollExecutionStrategyFactory::new(chain_spec))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(test)]</span>
<span class="term-fg32">+mod tests {</span>
<span class="term-fg32">+    use super::*;</span>
<span class="term-fg32">+    use crate::{ScrollEvmConfig, ScrollExecutionStrategy, ScrollExecutionStrategyFactory};</span>
<span class="term-fg32">+    use reth_chainspec::MIN_TRANSACTION_GAS;</span>
<span class="term-fg32">+    use reth_evm::execute::ExecuteOutput;</span>
<span class="term-fg32">+    use reth_primitives::{Block, BlockBody, BlockWithSenders, Receipt, TransactionSigned, TxType};</span>
<span class="term-fg32">+    use reth_primitives_traits::transaction::signed::SignedTransaction;</span>
<span class="term-fg32">+    use reth_scroll_chainspec::{ScrollChainConfig, ScrollChainSpecBuilder};</span>
<span class="term-fg32">+    use reth_scroll_consensus::{</span>
<span class="term-fg32">+        BLOB_SCALAR_SLOT, COMMIT_SCALAR_SLOT, CURIE_L1_GAS_PRICE_ORACLE_BYTECODE,</span>
<span class="term-fg32">+        CURIE_L1_GAS_PRICE_ORACLE_STORAGE, IS_CURIE_SLOT, L1_BASE_FEE_SLOT, L1_BLOB_BASE_FEE_SLOT,</span>
<span class="term-fg32">+        L1_GAS_PRICE_ORACLE_ADDRESS, OVER_HEAD_SLOT, SCALAR_SLOT,</span>
<span class="term-fg32">+    };</span>
<span class="term-fg32">+    use revm::{</span>
<span class="term-fg32">+        db::states::{bundle_state::BundleRetention, StorageSlot},</span>
<span class="term-fg32">+        primitives::{Address, B256, U256},</span>
<span class="term-fg32">+        shared::AccountInfo,</span>
<span class="term-fg32">+        Bytecode, EmptyDBTyped, TxKind,</span>
<span class="term-fg32">+    };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    const BLOCK_GAS_LIMIT: u64 = 10_000_000;</span>
<span class="term-fg32">+    const SCROLL_CHAIN_ID: u64 = 534352;</span>
<span class="term-fg32">+    const NOT_CURIE_BLOCK_NUMBER: u64 = 7096835;</span>
<span class="term-fg32">+    const CURIE_BLOCK_NUMBER: u64 = 7096837;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn strategy() -&gt; ScrollExecutionStrategy&lt;EmptyDBTyped&lt;ProviderError&gt;, ScrollEvmConfig&gt; {</span>
<span class="term-fg32">+        let chain_spec =</span>
<span class="term-fg32">+            Arc::new(ScrollChainSpecBuilder::scroll_mainnet().build(ScrollChainConfig::mainnet()));</span>
<span class="term-fg32">+        let factory = ScrollExecutionStrategyFactory::new(chain_spec);</span>
<span class="term-fg32">+        let db = EmptyDBTyped::&lt;ProviderError&gt;::new();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        factory.create_strategy(db)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn block(number: u64, transactions: Vec&lt;TransactionSigned&gt;) -&gt; BlockWithSenders {</span>
<span class="term-fg32">+        let senders = transactions.iter().map(|t| t.recover_signer().unwrap()).collect();</span>
<span class="term-fg32">+        BlockWithSenders {</span>
<span class="term-fg32">+            block: Block {</span>
<span class="term-fg32">+                header: Header { number, gas_limit: BLOCK_GAS_LIMIT, ..Default::default() },</span>
<span class="term-fg32">+                body: BlockBody { transactions, ..Default::default() },</span>
<span class="term-fg32">+            },</span>
<span class="term-fg32">+            senders,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn transaction(typ: TxType, gas_limit: u64) -&gt; TransactionSigned {</span>
<span class="term-fg32">+        let mut transaction = match typ {</span>
<span class="term-fg32">+            TxType::Legacy =&gt; reth_primitives::Transaction::Legacy(alloy_consensus::TxLegacy {</span>
<span class="term-fg32">+                to: TxKind::Call(Address::ZERO),</span>
<span class="term-fg32">+                ..Default::default()</span>
<span class="term-fg32">+            }),</span>
<span class="term-fg32">+            TxType::Eip2930 =&gt; reth_primitives::Transaction::Eip2930(alloy_consensus::TxEip2930 {</span>
<span class="term-fg32">+                to: TxKind::Call(Address::ZERO),</span>
<span class="term-fg32">+                ..Default::default()</span>
<span class="term-fg32">+            }),</span>
<span class="term-fg32">+            TxType::Eip1559 =&gt; reth_primitives::Transaction::Eip1559(alloy_consensus::TxEip1559 {</span>
<span class="term-fg32">+                to: TxKind::Call(Address::ZERO),</span>
<span class="term-fg32">+                ..Default::default()</span>
<span class="term-fg32">+            }),</span>
<span class="term-fg32">+            TxType::Eip4844 =&gt; reth_primitives::Transaction::Eip4844(alloy_consensus::TxEip4844 {</span>
<span class="term-fg32">+                to: Address::ZERO,</span>
<span class="term-fg32">+                ..Default::default()</span>
<span class="term-fg32">+            }),</span>
<span class="term-fg32">+            TxType::Eip7702 =&gt; reth_primitives::Transaction::Eip7702(alloy_consensus::TxEip7702 {</span>
<span class="term-fg32">+                to: Address::ZERO,</span>
<span class="term-fg32">+                ..Default::default()</span>
<span class="term-fg32">+            }),</span>
<span class="term-fg32">+            TxType::L1Message =&gt; {</span>
<span class="term-fg32">+                reth_primitives::Transaction::L1Message(reth_scroll_primitives::TxL1Message {</span>
<span class="term-fg32">+                    sender: Address::random(),</span>
<span class="term-fg32">+                    to: Address::ZERO,</span>
<span class="term-fg32">+                    ..Default::default()</span>
<span class="term-fg32">+                })</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        transaction.set_chain_id(SCROLL_CHAIN_ID);</span>
<span class="term-fg32">+        transaction.set_gas_limit(gas_limit);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let pk = B256::random();</span>
<span class="term-fg32">+        let signature = reth_primitives::sign_message(pk, transaction.signature_hash()).unwrap();</span>
<span class="term-fg32">+        TransactionSigned::new_unhashed(transaction, signature)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn execute_transactions(</span>
<span class="term-fg32">+        tx_type: TxType,</span>
<span class="term-fg32">+        block_number: u64,</span>
<span class="term-fg32">+        expected_l1_fee: U256,</span>
<span class="term-fg32">+        expected_error: Option&lt;&amp;str&gt;,</span>
<span class="term-fg32">+    ) -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        &#47;&#47; init strategy</span>
<span class="term-fg32">+        let mut strategy = strategy();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; prepare transaction</span>
<span class="term-fg32">+        let transaction = transaction(tx_type, MIN_TRANSACTION_GAS);</span>
<span class="term-fg32">+        let block = block(block_number, vec![transaction]);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; determine l1 gas oracle storage</span>
<span class="term-fg32">+        let l1_gas_oracle_storage =</span>
<span class="term-fg32">+            if strategy.evm_config.chain_spec().is_curie_active_at_block(block_number) {</span>
<span class="term-fg32">+                vec![</span>
<span class="term-fg32">+                    (L1_BASE_FEE_SLOT, U256::from(1000)),</span>
<span class="term-fg32">+                    (OVER_HEAD_SLOT, U256::from(1000)),</span>
<span class="term-fg32">+                    (SCALAR_SLOT, U256::from(1000)),</span>
<span class="term-fg32">+                    (L1_BLOB_BASE_FEE_SLOT, U256::from(10000)),</span>
<span class="term-fg32">+                    (COMMIT_SCALAR_SLOT, U256::from(1000)),</span>
<span class="term-fg32">+                    (BLOB_SCALAR_SLOT, U256::from(10000)),</span>
<span class="term-fg32">+                    (IS_CURIE_SLOT, U256::from(1)),</span>
<span class="term-fg32">+                ]</span>
<span class="term-fg32">+            } else {</span>
<span class="term-fg32">+                vec![</span>
<span class="term-fg32">+                    (L1_BASE_FEE_SLOT, U256::from(1000)),</span>
<span class="term-fg32">+                    (OVER_HEAD_SLOT, U256::from(1000)),</span>
<span class="term-fg32">+                    (SCALAR_SLOT, U256::from(1000)),</span>
<span class="term-fg32">+                ]</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; load accounts in state</span>
<span class="term-fg32">+        strategy.state.insert_account_with_storage(</span>
<span class="term-fg32">+            L1_GAS_PRICE_ORACLE_ADDRESS,</span>
<span class="term-fg32">+            Default::default(),</span>
<span class="term-fg32">+            l1_gas_oracle_storage,</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+        for add in &amp;block.senders {</span>
<span class="term-fg32">+            strategy</span>
<span class="term-fg32">+                .state</span>
<span class="term-fg32">+                .insert_account(*add, AccountInfo { balance: U256::MAX, ..Default::default() });</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; execute and verify output</span>
<span class="term-fg32">+        let res = strategy.execute_transactions(&amp;block, U256::ZERO);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check for error or execution outcome</span>
<span class="term-fg32">+        if let Some(error) = expected_error {</span>
<span class="term-fg32">+            assert_eq!(res.unwrap_err().to_string(), error);</span>
<span class="term-fg32">+        } else {</span>
<span class="term-fg32">+            let ExecuteOutput { receipts, .. } = res?;</span>
<span class="term-fg32">+            let expected = vec![Receipt {</span>
<span class="term-fg32">+                tx_type,</span>
<span class="term-fg32">+                cumulative_gas_used: MIN_TRANSACTION_GAS,</span>
<span class="term-fg32">+                success: true,</span>
<span class="term-fg32">+                l1_fee: expected_l1_fee,</span>
<span class="term-fg32">+                ..Default::default()</span>
<span class="term-fg32">+            }];</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            assert_eq!(receipts, expected);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_apply_pre_execution_changes_curie_block() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        &#47;&#47; init strategy</span>
<span class="term-fg32">+        let mut strategy = strategy();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; init curie transition block</span>
<span class="term-fg32">+        let curie_block = block(7096836, vec![]);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; apply pre execution change</span>
<span class="term-fg32">+        strategy.apply_pre_execution_changes(&amp;curie_block, U256::ZERO)?;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; take bundle</span>
<span class="term-fg32">+        let mut state = strategy.state;</span>
<span class="term-fg32">+        state.merge_transitions(BundleRetention::Reverts);</span>
<span class="term-fg32">+        let bundle = state.take_bundle();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; assert oracle contract contains updated bytecode</span>
<span class="term-fg32">+        let oracle = bundle.state.get(&amp;L1_GAS_PRICE_ORACLE_ADDRESS).unwrap().clone();</span>
<span class="term-fg32">+        let bytecode = Bytecode::new_raw(CURIE_L1_GAS_PRICE_ORACLE_BYTECODE);</span>
<span class="term-fg32">+        assert_eq!(oracle.info.unwrap().code.unwrap(), bytecode);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check oracle contract contains storage changeset</span>
<span class="term-fg32">+        let mut storage = oracle.storage.into_iter().collect::&lt;Vec&lt;(U256, StorageSlot)&gt;&gt;();</span>
<span class="term-fg32">+        storage.sort_by(|(a, _), (b, _)| a.cmp(b));</span>
<span class="term-fg32">+        for (got, expected) in storage.into_iter().zip(CURIE_L1_GAS_PRICE_ORACLE_STORAGE) {</span>
<span class="term-fg32">+            assert_eq!(got.0, expected.0);</span>
<span class="term-fg32">+            assert_eq!(got.1, StorageSlot { present_value: expected.1, ..Default::default() });</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_apply_pre_execution_changes_not_curie_block() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        &#47;&#47; init strategy</span>
<span class="term-fg32">+        let mut strategy = strategy();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; init block</span>
<span class="term-fg32">+        let not_curie_block = block(7096837, vec![]);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; apply pre execution change</span>
<span class="term-fg32">+        strategy.apply_pre_execution_changes(&amp;not_curie_block, U256::ZERO)?;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; take bundle</span>
<span class="term-fg32">+        let mut state = strategy.state;</span>
<span class="term-fg32">+        state.merge_transitions(BundleRetention::Reverts);</span>
<span class="term-fg32">+        let bundle = state.take_bundle();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; assert oracle contract is empty</span>
<span class="term-fg32">+        let oracle = bundle.state.get(&amp;L1_GAS_PRICE_ORACLE_ADDRESS);</span>
<span class="term-fg32">+        assert!(oracle.is_none());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_execute_transactions_exceeds_block_gas_limit() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        &#47;&#47; init strategy</span>
<span class="term-fg32">+        let mut strategy = strategy();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; prepare transaction exceeding block gas limit</span>
<span class="term-fg32">+        let transaction = transaction(TxType::Legacy, BLOCK_GAS_LIMIT + 1);</span>
<span class="term-fg32">+        let block = block(7096837, vec![transaction]);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; execute and verify error</span>
<span class="term-fg32">+        let res = strategy.execute_transactions(&amp;block, U256::ZERO);</span>
<span class="term-fg32">+        assert_eq!(</span>
<span class="term-fg32">+            res.unwrap_err().to_string(),</span>
<span class="term-fg32">+            &quot;transaction gas limit 10000001 is more than blocks available gas 10000000&quot;</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_execute_transactions_eip4844() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        &#47;&#47; Execute eip4844 transaction</span>
<span class="term-fg32">+        execute_transactions(</span>
<span class="term-fg32">+            TxType::Eip4844,</span>
<span class="term-fg32">+            CURIE_BLOCK_NUMBER,</span>
<span class="term-fg32">+            U256::ZERO,</span>
<span class="term-fg32">+            Some(&quot;EIP-4844 transactions are disabled&quot;),</span>
<span class="term-fg32">+        )?;</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_execute_transactions_eip7702() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        &#47;&#47; Execute eip7702 transaction</span>
<span class="term-fg32">+        execute_transactions(</span>
<span class="term-fg32">+            TxType::Eip7702,</span>
<span class="term-fg32">+            CURIE_BLOCK_NUMBER,</span>
<span class="term-fg32">+            U256::ZERO,</span>
<span class="term-fg32">+            Some(&quot;EIP-7702 transactions are disabled&quot;),</span>
<span class="term-fg32">+        )?;</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_execute_transactions_l1_message() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        &#47;&#47; Execute l1 message on curie block</span>
<span class="term-fg32">+        let expected_l1_fee = U256::ZERO;</span>
<span class="term-fg32">+        execute_transactions(TxType::L1Message, CURIE_BLOCK_NUMBER, expected_l1_fee, None)?;</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_execute_transactions_legacy_curie_fork() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        &#47;&#47; Execute legacy transaction on curie block</span>
<span class="term-fg32">+        let expected_l1_fee = U256::from(10);</span>
<span class="term-fg32">+        execute_transactions(TxType::Legacy, CURIE_BLOCK_NUMBER, expected_l1_fee, None)?;</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_execute_transactions_legacy_not_curie_fork() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        &#47;&#47; Execute legacy before curie block</span>
<span class="term-fg32">+        let expected_l1_fee = U256::from(2);</span>
<span class="term-fg32">+        execute_transactions(TxType::Legacy, NOT_CURIE_BLOCK_NUMBER, expected_l1_fee, None)?;</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_execute_transactions_eip2930_curie_fork() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        &#47;&#47; Execute eip2930 transaction on curie block</span>
<span class="term-fg32">+        let expected_l1_fee = U256::from(10);</span>
<span class="term-fg32">+        execute_transactions(TxType::Eip2930, CURIE_BLOCK_NUMBER, expected_l1_fee, None)?;</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_execute_transactions_eip2930_not_curie_fork() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        &#47;&#47; Execute eip2930 transaction before curie block</span>
<span class="term-fg32">+        execute_transactions(</span>
<span class="term-fg32">+            TxType::Eip2930,</span>
<span class="term-fg32">+            NOT_CURIE_BLOCK_NUMBER,</span>
<span class="term-fg32">+            U256::ZERO,</span>
<span class="term-fg32">+            Some(&quot;EIP-2930 transactions are disabled&quot;),</span>
<span class="term-fg32">+        )?;</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_execute_transactions_eip1559_curie_fork() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        &#47;&#47; Execute eip1559 transaction on curie block</span>
<span class="term-fg32">+        let expected_l1_fee = U256::from(10);</span>
<span class="term-fg32">+        execute_transactions(TxType::Eip1559, CURIE_BLOCK_NUMBER, expected_l1_fee, None)?;</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_execute_transactions_eip_not_curie_fork() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        &#47;&#47; Execute eip1559 transaction before curie block</span>
<span class="term-fg32">+        execute_transactions(</span>
<span class="term-fg32">+            TxType::Eip1559,</span>
<span class="term-fg32">+            NOT_CURIE_BLOCK_NUMBER,</span>
<span class="term-fg32">+            U256::ZERO,</span>
<span class="term-fg32">+            Some(&quot;EIP-1559 transactions are disabled&quot;),</span>
<span class="term-fg32">+        )?;</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-70f28ef7280a0cd8236fd425" role="button"
                       aria-expanded="false" aria-controls="id-70f28ef7280a0cd8236fd425">
                        <code>crates/scroll/evm/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/evm/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-70f28ef7280a0cd8236fd425"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;evm&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;evm&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..020de5994bfd346ff776df6c3ac6eb293f2f82ab</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;evm&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,13 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll evm execution implementation.</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use config::ScrollEvmConfig;</span>
<span class="term-fg32">+mod config;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use error::{ForkError, ScrollBlockExecutionError};</span>
<span class="term-fg32">+mod error;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use execute::{</span>
<span class="term-fg32">+    ScrollExecutionStrategy, ScrollExecutionStrategyFactory, ScrollExecutorProvider,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+mod execute;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-06175bf086571118eb06229d" role="button"
                       aria-expanded="false" aria-controls="id-06175bf086571118eb06229d">
                        <code>crates/scroll/execution/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/execution/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+26</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-06175bf086571118eb06229d"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;execution&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;execution&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..ad6a369a9c05bc0f9340418eafa6f424f5490734</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;execution&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,26 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-execution&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-revm.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-scroll-storage&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-revm&#47;scroll&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+test-utils = [&quot;reth-revm&#47;test-utils&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-65b1635c71d463ece62ed034" role="button"
                       aria-expanded="false" aria-controls="id-65b1635c71d463ece62ed034">
                        <code>crates/scroll/execution/src/finalize.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/execution/src/finalize.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+95</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-65b1635c71d463ece62ed034"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;finalize.rs scroll-reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;finalize.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..4c558caaaac7c8b7822158320cd6a1af635b97c8</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;finalize.rs</span>
<span class="term-fg36">@@ -0,0 +1,95 @@</span>
<span class="term-fg32">+#![allow(clippy::useless_conversion)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use reth_revm::{cached::CachedReadsDbMut, database::EvmStateProvider, revm::State};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;test-utils&quot;)]</span>
<span class="term-fg32">+use reth_revm::EmptyDBTyped;</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+use reth_revm::{database::StateProviderDatabase, revm::CacheDB, DatabaseRef};</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+use reth_scroll_storage::ScrollStateProviderDatabase;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Finalize the execution of the type and return the output</span>
<span class="term-fg32">+pub trait FinalizeExecution {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The output of the finalization.</span>
<span class="term-fg32">+    type Output;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Finalize the state and return the output.</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; FinalizeExecution for State&lt;ScrollStateProviderDatabase&lt;DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::states::ScrollBundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        let bundle = self.take_bundle();</span>
<span class="term-fg32">+        (bundle, &amp;self.database.post_execution_context).into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; FinalizeExecution for State&lt;&amp;mut ScrollStateProviderDatabase&lt;DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::states::ScrollBundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        let bundle = self.take_bundle();</span>
<span class="term-fg32">+        (bundle, &amp;self.database.post_execution_context).into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl&lt;DB: DatabaseRef&gt; FinalizeExecution for State&lt;CachedReadsDbMut&lt;&#39;_, DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::db::BundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        self.take_bundle().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;test-utils&quot;)))]</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; FinalizeExecution</span>
<span class="term-fg32">+    for State&lt;CachedReadsDbMut&lt;&#39;_, ScrollStateProviderDatabase&lt;DB&gt;&gt;&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    type Output = reth_revm::db::BundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        (self.take_bundle(), &amp;self.database.db.post_execution_context).into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; FinalizeExecution for State&lt;StateProviderDatabase&lt;DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::db::BundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        self.take_bundle().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; FinalizeExecution for State&lt;&amp;mut StateProviderDatabase&lt;DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::db::BundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        self.take_bundle().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl&lt;DB: DatabaseRef&gt; FinalizeExecution for State&lt;CacheDB&lt;DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::db::BundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        self.take_bundle().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;test-utils&quot;)]</span>
<span class="term-fg32">+impl&lt;E&gt; FinalizeExecution for State&lt;EmptyDBTyped&lt;E&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::db::BundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        self.take_bundle().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e183d3e2b7cddf31963f6817" role="button"
                       aria-expanded="false" aria-controls="id-e183d3e2b7cddf31963f6817">
                        <code>crates/scroll/execution/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/execution/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e183d3e2b7cddf31963f6817"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..5328229afe0fa0f06bf39170553fca8e97d05cf8</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,6 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll execution related implementations.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![warn(unused_crate_dependencies)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use finalize::FinalizeExecution;</span>
<span class="term-fg32">+mod finalize;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8757bc3165becc760aef3327" role="button"
                       aria-expanded="false" aria-controls="id-8757bc3165becc760aef3327">
                        <code>crates/scroll/hardforks/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/hardforks/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+39</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8757bc3165becc760aef3327"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;hardforks&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;hardforks&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..ff6013d11ba2fe4f887f955182d3a620cf10a15b</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;hardforks&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,39 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-forks&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+description = &quot;Scroll hardforks used in reth&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-ethereum-forks.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# ethereum</span>
<span class="term-fg32">+alloy-chains.workspace = true</span>
<span class="term-fg32">+alloy-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# io</span>
<span class="term-fg32">+serde = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# misc</span>
<span class="term-fg32">+once_cell.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+default = [&quot;std&quot;]</span>
<span class="term-fg32">+std = [</span>
<span class="term-fg32">+    &quot;alloy-primitives&#47;std&quot;,</span>
<span class="term-fg32">+    &quot;once_cell&#47;std&quot;,</span>
<span class="term-fg32">+    &quot;serde?&#47;std&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+serde = [</span>
<span class="term-fg32">+    &quot;dep:serde&quot;,</span>
<span class="term-fg32">+    &quot;alloy-chains&#47;serde&quot;,</span>
<span class="term-fg32">+    &quot;alloy-primitives&#47;serde&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fe4a28f1d851b06b69025b52" role="button"
                       aria-expanded="false" aria-controls="id-fe4a28f1d851b06b69025b52">
                        <code>crates/scroll/hardforks/docs/hardforks.md</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/hardforks/docs/hardforks.md" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+342</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fe4a28f1d851b06b69025b52"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;hardforks&#47;docs&#47;hardforks.md scroll-reth&#47;crates&#47;scroll&#47;hardforks&#47;docs&#47;hardforks.md</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..fb7d068fedbdeaca76ad435a112f1c60ec7dded2</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;hardforks&#47;docs&#47;hardforks.md</span>
<span class="term-fg36">@@ -0,0 +1,343 @@</span>
<span class="term-fg32">+---</span>
<span class="term-fg32">+section: technology</span>
<span class="term-fg32">+date: Last Modified</span>
<span class="term-fg32">+title: &quot;Scroll Upgrades&quot;</span>
<span class="term-fg32">+lang: &quot;en&quot;</span>
<span class="term-fg32">+permalink: &quot;technology&#47;overview&#47;scroll-upgrades&quot;</span>
<span class="term-fg32">+---</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+As the team continues to progress on Scroll&#39;s roadmap, we will be upgrading the Scroll network to include new features and improvements.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The following contracts are used to initiate upgrades and execute upgrades after the two-week timelock period:</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+| Contract         | Network                                                      | Address |</span>
<span class="term-fg32">+| ------------------------ | ------- | - |</span>
<span class="term-fg32">+| L1 Scroll Multisig | Ethereum| [`0xEfc9D1096fb65c832207E5e7F13C2D1102244dbe`](https:&#47;&#47;etherscan.io&#47;address&#47;0xEfc9D1096fb65c832207E5e7F13C2D1102244dbe)|</span>
<span class="term-fg32">+| L1 Timelock |  Ethereum| [`0x1A658B88fD0a3c82fa1a0609fCDbD32e7dd4aB9C`](https:&#47;&#47;etherscan.io&#47;address&#47;0x1A658B88fD0a3c82fa1a0609fCDbD32e7dd4aB9C)|</span>
<span class="term-fg32">+| L2 Scroll Multisig | Scroll| [`0xEfc9D1096fb65c832207E5e7F13C2D1102244dbe`](https:&#47;&#47;scrollscan.com&#47;address&#47;0xEfc9D1096fb65c832207E5e7F13C2D1102244dbe)|</span>
<span class="term-fg32">+| L2 Timelock | Scroll | [`0xf6069DB81239E5194bb53f83aF564d282357bc99`](https:&#47;&#47;scrollscan.com&#47;address&#47;0xf6069DB81239E5194bb53f83aF564d282357bc99)|</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+You can join our [Telegram channel for technical updates](https:&#47;&#47;t.me&#47;scroll_tech_updates), which includes future upgrade announcements and on-chain operation events.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+## DarwinV2 Upgrade</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Overview</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+During internal testing, we identified that blocks may not always be compressible under certain conditions, which leads to unprovable chunks and batches.</span>
<span class="term-fg32">+To fix this issue, a minor upgrade has been conducted so that uncompressed blobs will be enabled when this special case is detected.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Timeline</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+As this is a security related patch, we bypassed the 7-day timelock mechanism.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- **Scroll Sepolia**: August 28th, 2024</span>
<span class="term-fg32">+- **Scroll Mainnet**: September 2nd, 2024</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Compatibility</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Sequencer and Follower Nodes (l2geth)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The new node version is `v5.7.0`. See the [release notes](https:&#47;&#47;github.com&#47;scroll-tech&#47;go-ethereum&#47;releases&#47;tag&#47;scroll-v5.7.0) for more information.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+This upgrade does not change Scroll&#39;s state transition function, so it is backward compatible. However, the format of the batch data committed to Ethereum changes. As a result, nodes that enabled rollup verification (`--rollup.verify`) must upgrade to be able to follow the chain.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Dapps and Indexers</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+A change has been implemented to Scroll Mainnet to enhance sequencer throughput, which adjusted the maximum reorg depth to 17 blocks. Previously, the system performed thorough capacity checks within the signer thread to determine whether transactions exceed the circuit limit. While this ensures that all transactions within a block are compliant, it also requires additional CPU resources.</span>
<span class="term-fg32">+We introduced a new circuit capacity checking scheme on Mainnet. The sequencer thread now will continue to perform capacity checks, but in a more approximate manner. In parallel, 16 worker threads will accurately verify the capacity of previous blocks. As a result, a reorg could occur with a maximum depth of 17 blocks, although the likelihood of this is low.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+For indexers, the `BatchHeader` version has been upgraded to 4. This is backward compatible (the only exception is for developers decoding the blob payload, which has changed slightly).</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+## Darwin Upgrade</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Overview</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+This upgrade will reduce gas fees by 34% by using a single aggregated proof for multiple batches, eliminating the need to finalize each batch individually.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- Darwin uses a new [V3 batch codec](https:&#47;&#47;github.com&#47;scroll-tech&#47;da-codec&#47;tree&#47;main&#47;encoding&#47;codecv3).</span>
<span class="term-fg32">+- In addition to the previous notions of `chunk` and `batch`, we have introduced a new concept called `bundle`.</span>
<span class="term-fg32">+    - `Chunk`: A unit of zkEVM proving, consisting of a list of L2 blocks.</span>
<span class="term-fg32">+    - `Batch`: A collection of chunks encoded into one EIP-4844 blob, serving as the unit of Data Availability.</span>
<span class="term-fg32">+    - `Bundle`: A series of batches that functions as the unit of finalization.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    The main difference compared to Curie is that Scroll will now finalize multiple batches using a single aggregated bundle proof.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- The on-chain bundle proof verifier uses a new public input layout.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Timeline</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- **Scroll Sepolia**</span>
<span class="term-fg32">+	- Network Upgrade: August 14th, 2024</span>
<span class="term-fg32">+- **Scroll Mainnet**</span>
<span class="term-fg32">+	- Upgrade Initiation: August 5th, 2024</span>
<span class="term-fg32">+	- Timelock Completion &amp; Upgrade: August 21st, 2024</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Technical Details</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Contract Changes</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+*Note: Since the previous Curie upgrade, we have migrated the Scroll contracts to a new repo at [scroll-contracts](https:&#47;&#47;github.com&#47;scroll-tech&#47;scroll-contracts).*</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The code changes for this upgrade are implemented in [this PR](https:&#47;&#47;github.com&#47;scroll-tech&#47;scroll-contracts&#47;pull&#47;4). The key changes are as follows:</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- We have introduced a new `BatchHeaderV3Codec`.</span>
<span class="term-fg32">+- We have changed how messages are processed in the `L1MessageQueue` contract. Prior to Darwin, we would process messages when a batch is finalized. After Darwin, most of this processing is moved to the commit step.</span>
<span class="term-fg32">+- We have introduced a new public input format for bundle proofs. This is implemented in a new contract `IZkEvmVerifierV2`, which is in turn added to `MultipleVersionRollupVerifier`.</span>
<span class="term-fg32">+- In the `ScrollChain` contract `version=3` batches will now be committed through a new function called `commitBatchWithBlobProof`. Bundles will be finalized using a new function called `finalizeBundleWithProof`.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+See the contract [release notes](https:&#47;&#47;github.com&#47;scroll-tech&#47;scroll-contracts&#47;releases&#47;tag&#47;v1.0.0) for more information.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Node Changes</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The new node version is `v5.6.0`. See the [release notes](https:&#47;&#47;github.com&#47;scroll-tech&#47;go-ethereum&#47;releases&#47;tag&#47;scroll-v5.6.0) for more information.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The main changes are:</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- Implementation of timestamp-based hard forks.</span>
<span class="term-fg32">+- Processing V3 batch codec in rollup-verifier.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### zkEVM circuit changes</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The new version of zkevm circuits is `v0.12.0`. See [here](https:&#47;&#47;github.com&#47;scroll-tech&#47;zkevm-circuits&#47;releases&#47;tag&#47;v0.12.0) for the release log.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+We have introduced a `RecursionCircuit` that will bundle multiple sequential batches by recursively aggregating the SNARKs from the `BatchCircuit` (previously `AggregationCircuit`). The previously 5 layer proving system is now 7 layers as we introduce:</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- 6th Layer (layer5): `RecursionCircuit` that recursively aggregates `BatchCircuit` SNARKs.</span>
<span class="term-fg32">+- 7th Layer (layer6): `CompressionCircuit` that compresses the `RecursionCircuit` SNARK and produce an EVM-verifiable validity proof.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The public input to the `BatchCircuit` is now context-aware of the “previous” `batch`, which allows us to implement the recursion scheme we adopted (described [here](https:&#47;&#47;scrollzkp.notion.site&#47;Upgrade-4-Darwin-Documentation-05a3ecb59e9d4f288254701f8c888173) in-depth).</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Audits</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- TrailofBits: coming soon!</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Compatibility</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Sequencer and Follower Nodes (l2geth)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+This upgrade does not alter the state transition function and is therefore backward-compatible. However, we strongly recommend node operators to upgrade to [v5.6.0](https:&#47;&#47;github.com&#47;scroll-tech&#47;go-ethereum&#47;releases&#47;tag&#47;scroll-v5.6.0).</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Dapps and Indexers</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+There are some major changes to how we commit and finalize batches after Darwin.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- Batches will be encoded using the new [V3 batch codec](https:&#47;&#47;github.com&#47;scroll-tech&#47;da-codec&#47;tree&#47;main&#47;encoding&#47;codecv3). This version adds two new fields:</span>
<span class="term-fg32">+    1. `lastBlockTimestamp` (the timestamp of the last block in this batch).</span>
<span class="term-fg32">+    2. `blobDataProof` (the KZG challenge point evaluation proof).</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    This version removes `skippedL1MessageBitmap`. There will be no changes to how the blob data is encoded and compressed.</span>
<span class="term-fg32">+- Batches will be committed using the `commitBatchWithBlobProof` function (instead of the previous `commitBatch`).</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    New function signature:</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    ```solidity</span>
<span class="term-fg32">+    function commitBatchWithBlobProof(uint8 _version, bytes calldata _parentBatchHeader, bytes[] memory _chunks, bytes calldata _skippedL1MessageBitmap, bytes calldata _blobDataProof)</span>
<span class="term-fg32">+    ```</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- Batches will be finalized using the `finalizeBundleWithProof` function (instead of the previous `finalizeBatchWithProof4844`).</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    New function signature:</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    ```solidity</span>
<span class="term-fg32">+    function finalizeBundleWithProof(bytes calldata _batchHeader, bytes32 _postStateRoot, bytes32 _withdrawRoot, bytes calldata _aggrProof)</span>
<span class="term-fg32">+    ```</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- The semantics of the `FinalizeBatch` event will change: It will now mean that all batches between the last finalized batch and the event’s `_batchIndex` have been finalized. The event’s stateRoot and withdrawRoot values belong to the last finalized batch in the bundle. Finalized roots for intermediate batches are no longer available.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    The semantics of the `CommitBatch` and `RevertBatch` events will not change.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+Recommendations:</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- Indexers that decode committed batch data should be adjusted to use the new codec and the new function signature.</span>
<span class="term-fg32">+- Indexers that track batch finalization status should be adjusted to consider the new event semantics.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+## Curie Upgrade</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Overview</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+This significant upgrade will reduce gas fees on the Scroll chain by 1.5x. Highlights include:</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- Compresses the data stored in blobs using the [zstd](https:&#47;&#47;github.com&#47;scroll-tech&#47;da-codec&#47;tree&#47;main&#47;libzstd) algorithm. This compression reduces the data size, allowing each blob to store more transactions, thereby reducing data availability cost per transaction.</span>
<span class="term-fg32">+- Adopts a modified version of the EIP-1559 pricing model which is compatible with the EIP-1559 transaction interface, bringing beneftis such as more accurate transaction pricing and a more predictable and stable fee structure.</span>
<span class="term-fg32">+- Support for new EVM opcodes `TLOAD`, `TSTORE`, and `MCOPY`. Users can safely use the latest Solidity compiler version `0.8.26` to build the contracts.</span>
<span class="term-fg32">+- Introduces a dynamic block time. During periods of traffic congestion, a block will be packed when the number of transactions reaches the circuit limit instead of waiting for the 3-second interval.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Timeline</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- **Scroll Sepolia**</span>
<span class="term-fg32">+	- Network Upgrade: June 17th, 2024</span>
<span class="term-fg32">+- **Scroll Mainnet**</span>
<span class="term-fg32">+	- Upgrade Initiation: June 20th, 2024</span>
<span class="term-fg32">+	- Timelock Completion &amp; Upgrade: July 3rd, 2024</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Technical Details</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Contract Changes</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The code changes for this upgrade are documented in the following PRs:</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- [Accept compressed batches](https:&#47;&#47;github.com&#47;scroll-tech&#47;scroll&#47;pull&#47;1317)</span>
<span class="term-fg32">+- [Update `L1GasPriceOracle`](https:&#47;&#47;github.com&#47;scroll-tech&#47;scroll&#47;pull&#47;1343)</span>
<span class="term-fg32">+- [Change `MAX_COMMIT_SCALAR` and `MAX_BLOB_SCALAR` to 1e18](https:&#47;&#47;github.com&#47;scroll-tech&#47;scroll&#47;pull&#47;1354)</span>
<span class="term-fg32">+- [Remove batch index check when updating a verifier](https:&#47;&#47;github.com&#47;scroll-tech&#47;scroll&#47;pull&#47;1372)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The main changes are as follows:</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- The rollup contract (`ScrollChain`) will now accept batches with both versions 1 and 2. [Version 1](https:&#47;&#47;github.com&#47;scroll-tech&#47;da-codec&#47;tree&#47;main&#47;encoding&#47;codecv1) is used for uncompressed blobs (pre-Curie), while [version 2](https:&#47;&#47;github.com&#47;scroll-tech&#47;da-codec&#47;tree&#47;main&#47;encoding&#47;codecv2) is used for compressed blobs (post-Curie).</span>
<span class="term-fg32">+- The `L1GasPriceOracle` contract will be updated to change the data fee formula to account for blob DA, providing a more accurate estimation of DA costs:</span>
<span class="term-fg32">+    - Original formula: `(l1GasUsed(txRlp) + overhead) * l1BaseFee * scalar`</span>
<span class="term-fg32">+    - New formula: `l1BaseFee * commitScalar + len(txRlp) * l1BlobBaseFee * blobScalar`</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Node Changes</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The new node version is `v5.5.0`. See the [release notes](https:&#47;&#47;github.com&#47;scroll-tech&#47;go-ethereum&#47;releases&#47;tag&#47;scroll-v5.5.0) for the list of changes.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### zkEVM circuit changes</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The new version of zkevm circuits is `v0.11.4`. See [here](https:&#47;&#47;github.com&#47;scroll-tech&#47;zkevm-circuits&#47;releases&#47;tag&#47;v0.11.4) for the release log.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Audits</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- TrailofBits: coming soon!</span>
<span class="term-fg32">+- [Zellic](https:&#47;&#47;github.com&#47;Zellic&#47;publications&#47;blob&#47;master&#47;Scroll%20zkEVM%20-%20Zellic%20Audit%20Report.pdf)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Compatibility</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Sequencer and Follower Nodes (l2geth)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+This upgrade is a hard fork, introducing the `TLOAD`, `TSTORE`, and `MCOPY` opcodes. Operators running an `l2geth` node are required to upgrade before the hard fork block. For more information, see the [node release note](https:&#47;&#47;github.com&#47;scroll-tech&#47;go-ethereum&#47;releases&#47;tag&#47;scroll-v5.4.2).</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Dapps and Indexers</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+For dApps, this upgrade is backward compatible. Developers should adjust the gas fee settings to incorporate the EIP-1559 pricing model. Note that dApps can no longer rely on the fixed 3-second block time in the application logic.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+For indexers, the [data format](https:&#47;&#47;docs.scroll.io&#47;en&#47;technology&#47;chain&#47;rollup&#47;#codec) remains the same. The will be however changes to the data content:</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- The `version` field in `BatchHeader` will be changed to 2 since Curie block.</span>
<span class="term-fg32">+- The data stored in blob will be compressed and can be decompressed by [zstd v1.5.6](https:&#47;&#47;github.com&#47;facebook&#47;zstd&#47;releases&#47;tag&#47;v1.5.6).</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+## Bernoulli Upgrade</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Overview</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+This upgrade features a significant reduction in transaction costs by introducing support for EIP-4844 data blobs and supporting the SHA2-256 precompile.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Timeline</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- **Scroll Sepolia**</span>
<span class="term-fg32">+	- Network Upgrade: April 15th, 2024</span>
<span class="term-fg32">+- **Scroll Mainnet**</span>
<span class="term-fg32">+	- Upgrade Initiation: April 15th, 2024</span>
<span class="term-fg32">+	- Timelock Completion &amp; Upgrade: April 29th, 2024</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Technical Details</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Contract changes</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The contract changes for this upgrade are in [this PR](https:&#47;&#47;github.com&#47;scroll-tech&#47;scroll&#47;pull&#47;1179), along with the audit fixes [here](https:&#47;&#47;github.com&#47;scroll-tech&#47;scroll&#47;pulls?q=is%3Apr+created%3A2024-04-10..2024-04-11+fix+in%3Atitle+label%3Abug). The main changes are as follows:</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- `ScrollChain` now accepts batches with either calldata or blob encoding in `commitBatch`.</span>
<span class="term-fg32">+- `ScrollChain` now supports finalizing blob-encoded batches through `finalizeBatchWithProof4844`.</span>
<span class="term-fg32">+- `MultipleVersionRollupVerifier` can now manage different on-chain verifiers for each batch encoding version.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Node changes</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The new node version is `v5.3.0`. See [here](https:&#47;&#47;github.com&#47;scroll-tech&#47;go-ethereum&#47;releases&#47;tag&#47;scroll-v5.3.0) for the release log.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### zkEVM circuit changes</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The new version of zkevm circuits is `v0.10.3`. See [here](https:&#47;&#47;github.com&#47;scroll-tech&#47;zkevm-circuits&#47;releases&#47;tag&#47;v0.10.3) for the release log.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Audits</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- [OpenZeppelin](https:&#47;&#47;blog.openzeppelin.com&#47;scroll-eip-4844-support-audit)</span>
<span class="term-fg32">+- [TrailofBits](https:&#47;&#47;github.com&#47;trailofbits&#47;publications&#47;blob&#47;master&#47;reviews&#47;2024-04-scroll-4844-blob-securityreview.pdf)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Compatibility</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Sequencer and follower nodes (l2geth)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+This upgrade is a hard fork as it introduces the new blob data type and the SHA2-256 precompiled contract. Operators running an `l2geth` node are required to upgrade before the hard fork block. See the [node releases](https:&#47;&#47;github.com&#47;scroll-tech&#47;go-ethereum&#47;releases) for more information.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Indexers and Bridges</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+This upgrade changes the format that Scroll uses to publish data to Ethereum. Projects that rely on this data should carefully review [the new data format](&#47;en&#47;technology&#47;chain&#47;rollup&#47;#codec), and check whether their decoders need to be adjusted. A summary of the new format:</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- The format of [`BlockContext`](https:&#47;&#47;github.com&#47;scroll-tech&#47;scroll&#47;blob&#47;5362e28f744093495c1c09a6b68fc96a3264278b&#47;common&#47;types&#47;encoding&#47;codecv1&#47;codecv1.go#L125) will not change.</span>
<span class="term-fg32">+- `Chunks` will [no longer include](https:&#47;&#47;github.com&#47;scroll-tech&#47;scroll&#47;blob&#47;5362e28f744093495c1c09a6b68fc96a3264278b&#47;common&#47;types&#47;encoding&#47;codecv1&#47;codecv1.go#L162) the L2 transaction data. This will instead be [stored in a blob](https:&#47;&#47;github.com&#47;scroll-tech&#47;scroll&#47;blob&#47;5362e28f744093495c1c09a6b68fc96a3264278b&#47;common&#47;types&#47;encoding&#47;codecv1&#47;codecv1.go#L284) attached to the `commitBatch` transaction.</span>
<span class="term-fg32">+- `BatchHeader` now contains one new field, [`BlobVersionedHash`](https:&#47;&#47;github.com&#47;scroll-tech&#47;scroll&#47;blob&#47;5362e28f744093495c1c09a6b68fc96a3264278b&#47;common&#47;types&#47;encoding&#47;codecv1&#47;codecv1.go#L405).</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Provers</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+This upgrade involves a breaking change in [zkevm-circuits](https:&#47;&#47;github.com&#47;scroll-tech&#47;zkevm-circuits). Operators running a prover node are required to upgrade.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+## Bridge Upgrade</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Overview</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+To reduce bridging costs, we implemented several gas optimizations on our bridge and rollup contract suite. The optimization techniques used include the following:</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- We will now use constants to store some companion contract addresses, instead of using storage variables. This is possible since these values should (almost) never change. With this change we can save on a few storage load operations.</span>
<span class="term-fg32">+- We updated the intrinsic gas estimation in `L1MessageQueue` to use a simple upper bound instead of an exact calculation. The two results will be similar for most bridge transactions but the new implementation is significantly cheaper.</span>
<span class="term-fg32">+- We merged two contracts `L1MessageQueue` and `L2GasPriceOracle` to save on call costs from one contract to the other.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Timeline</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- **Scroll Sepolia:**</span>
<span class="term-fg32">+	- Network Upgrade: January 19, 2024</span>
<span class="term-fg32">+- **Scroll Mainnet:**</span>
<span class="term-fg32">+	- Upgrade Initiation: February 7, 2024</span>
<span class="term-fg32">+	- Timelock Completion &amp; Upgrade: February 21, 2024</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### Technical Details</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Code Changes</span>
<span class="term-fg32">+- [Bridge Cost Optimization](https:&#47;&#47;github.com&#47;scroll-tech&#47;scroll&#47;pull&#47;1011)</span>
<span class="term-fg32">+- [Audit Fixes](https:&#47;&#47;github.com&#47;scroll-tech&#47;scroll&#47;pulls?q=OZ+is%3Apr+created%3A2024-01-27..2024-02-10)</span>
<span class="term-fg32">+- [Previously deployed version](https:&#47;&#47;github.com&#47;scroll-tech&#47;scroll&#47;tree&#47;ff380141a8cbcc214dc65f17ffa44faf4be646b6) (commit `ff380141a8cbcc214dc65f17ffa44faf4be646b6`)</span>
<span class="term-fg32">+- [Version deployed](https:&#47;&#47;github.com&#47;scroll-tech&#47;scroll&#47;tree&#47;6030927680a92d0285c2c13e6bb27ed27d1f32d1) (commit `6030927680a92d0285c2c13e6bb27ed27d1f32d1`)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Audits</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- [OpenZeppelin](https:&#47;&#47;blog.openzeppelin.com&#47;scroll-bridge-gas-optimizations-audit)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### List of Changes</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+**Changes to L1 contracts:**</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- In `ScrollChain`, change `messageQueue` and `verifier` to `immutable`.</span>
<span class="term-fg32">+- In `L1ScrollMessenger`, change `counterpart`, `rollup`, and `messageQueue` to `immutable`.</span>
<span class="term-fg32">+- In all token gateways, change `counterpart`, `router`, and `messenger` to `immutable`.</span>
<span class="term-fg32">+- Merge `L1MessageQueue` and `L2GasPriceOracle` into a single contract `L1MessageQueueWithGasPriceOracle` (deployed on the same address as the previous `L1MessageQueue`). In this contract, we also change `messenger` and `scrollChain` to `immutable`, and simplify `calculateIntrinsicGasFee`.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+**Changes to L2 contracts:**</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- In `L2ScrollMessenger`, change `counterpart` to `immutable`.</span>
<span class="term-fg32">+- In all token gateways, change `counterpart`, `router`, and `messenger` to `immutable`.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+**Contracts affected:**</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- **L1:** `L1MessageQueue`, `L2GasPriceOracle`, `ScrollChain`, `L1WETHGateway`, `L1StandardERC20Gateway`, `L1GatewayRouter`, `L1ScrollMessenger`, `L1CustomERC20Gateway`, `L1ERC721Gateway`, `L1ERC1155Gateway`.</span>
<span class="term-fg32">+- **L2:** `L2ScrollMessenger`, `L2WETHGateway`, `L2StandardERC20Gateway`, `L2GatewayRouter`, `L2CustomERC20Gateway`, `L2ERC721Gateway`, `L2ERC1155Gateway`.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Compatibility</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+##### Sequencer and follower nodes (l2geth)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+Operators running an `l2geth` node do not need to upgrade. The changes in this upgrade will not affect `l2geth`.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+##### Dapps and indexers</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+Dapps and indexers (and similar off-chain infrastructure) that query contracts or rely on contract interfaces would, in most cases, not need to be changed. The majority of the contract changes are internal and&#47;or backward compatible.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+If your application depends on [`L2GasPriceOracle`](https:&#47;&#47;etherscan.io&#47;address&#47;0x987e300fDfb06093859358522a79098848C33852) to monitor how Scroll keeps track of the L2 gas price on L1, from the upgrade block number you will need to start monitoring [`L1MessageQueueWithGasPriceOracle`](https:&#47;&#47;etherscan.io&#47;address&#47;0x0d7E906BD9cAFa154b048cFa766Cc1E54E39AF9B).</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The original gas price oracle contract will be deprecated: it will no longer be updated or used by the Scroll bridge.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- Ethereum:</span>
<span class="term-fg32">+	- `L2GasPriceOracle`: [`0x987e300fDfb06093859358522a79098848C33852`](https:&#47;&#47;etherscan.io&#47;address&#47;0x987e300fDfb06093859358522a79098848C33852)</span>
<span class="term-fg32">+	- `L1MessageQueueWithGasPriceOracle`: [`0x0d7E906BD9cAFa154b048cFa766Cc1E54E39AF9B`](https:&#47;&#47;etherscan.io&#47;address&#47;0x0d7E906BD9cAFa154b048cFa766Cc1E54E39AF9B)</span>
<span class="term-fg32">+- Sepolia:</span>
<span class="term-fg32">+	- `L2GasPriceOracle`: [`0x247969F4fad93a33d4826046bc3eAE0D36BdE548`](https:&#47;&#47;sepolia.etherscan.io&#47;address&#47;0x247969F4fad93a33d4826046bc3eAE0D36BdE548)</span>
<span class="term-fg32">+	- `L1MessageQueueWithGasPriceOracle`: [`0xF0B2293F5D834eAe920c6974D50957A1732de763`](https:&#47;&#47;sepolia.etherscan.io&#47;address&#47;0xF0B2293F5D834eAe920c6974D50957A1732de763)</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9d11090079f9fe290a5fcdab" role="button"
                       aria-expanded="false" aria-controls="id-9d11090079f9fe290a5fcdab">
                        <code>crates/scroll/hardforks/src/dev.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/hardforks/src/dev.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+27</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9d11090079f9fe290a5fcdab"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;hardforks&#47;src&#47;dev.rs scroll-reth&#47;crates&#47;scroll&#47;hardforks&#47;src&#47;dev.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..10240e5893f8ddd66320b76629dc7ac4b3a397db</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;hardforks&#47;src&#47;dev.rs</span>
<span class="term-fg36">@@ -0,0 +1,27 @@</span>
<span class="term-fg32">+use reth_ethereum_forks::{ChainHardforks, EthereumHardfork, ForkCondition};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(not(feature = &quot;std&quot;))]</span>
<span class="term-fg32">+use once_cell::sync::Lazy as LazyLock;</span>
<span class="term-fg32">+#[cfg(feature = &quot;std&quot;)]</span>
<span class="term-fg32">+use std::sync::LazyLock;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Dev hardforks</span>
<span class="term-fg32">+pub static DEV_HARDFORKS: LazyLock&lt;ChainHardforks&gt; = LazyLock::new(|| {</span>
<span class="term-fg32">+    ChainHardforks::new(vec![</span>
<span class="term-fg32">+        (EthereumHardfork::Homestead.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+        (EthereumHardfork::Tangerine.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+        (EthereumHardfork::SpuriousDragon.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+        (EthereumHardfork::Byzantium.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+        (EthereumHardfork::Constantinople.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+        (EthereumHardfork::Petersburg.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+        (EthereumHardfork::Istanbul.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+        (EthereumHardfork::Berlin.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+        (EthereumHardfork::London.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+        (crate::ScrollHardfork::Archimedes.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+        (EthereumHardfork::Shanghai.boxed(), ForkCondition::Timestamp(0)),</span>
<span class="term-fg32">+        (crate::ScrollHardfork::Bernoulli.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+        (crate::ScrollHardfork::Curie.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+        (crate::ScrollHardfork::Darwin.boxed(), ForkCondition::Timestamp(0)),</span>
<span class="term-fg32">+        (crate::ScrollHardfork::DarwinV2.boxed(), ForkCondition::Timestamp(0)),</span>
<span class="term-fg32">+    ])</span>
<span class="term-fg32">+});</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3145f7927e59b82c0b5f0e54" role="button"
                       aria-expanded="false" aria-controls="id-3145f7927e59b82c0b5f0e54">
                        <code>crates/scroll/hardforks/src/hardfork.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/hardforks/src/hardfork.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+264</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3145f7927e59b82c0b5f0e54"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;hardforks&#47;src&#47;hardfork.rs scroll-reth&#47;crates&#47;scroll&#47;hardforks&#47;src&#47;hardfork.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..75b9d34c092bb4506631bea460042797cee061a1</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;hardforks&#47;src&#47;hardfork.rs</span>
<span class="term-fg36">@@ -0,0 +1,264 @@</span>
<span class="term-fg32">+&#47;&#47;! Hard forks of scroll protocol.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use alloc::{boxed::Box, format, string::String, vec};</span>
<span class="term-fg32">+use core::{</span>
<span class="term-fg32">+    any::Any,</span>
<span class="term-fg32">+    fmt::{self, Display, Formatter},</span>
<span class="term-fg32">+    str::FromStr,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use alloy_chains::{Chain, NamedChain};</span>
<span class="term-fg32">+use reth_ethereum_forks::{hardfork, ChainHardforks, EthereumHardfork, ForkCondition, Hardfork};</span>
<span class="term-fg32">+#[cfg(feature = &quot;serde&quot;)]</span>
<span class="term-fg32">+use serde::{Deserialize, Serialize};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+hardfork!(</span>
<span class="term-fg32">+    &#47;&#47;&#47; The name of the Scroll hardfork</span>
<span class="term-fg32">+    ScrollHardfork {</span>
<span class="term-fg32">+        &#47;&#47;&#47; Archimedes: scroll test hardfork.</span>
<span class="term-fg32">+        Archimedes,</span>
<span class="term-fg32">+        &#47;&#47;&#47; Bernoulli: &lt;https:&#47;&#47;scroll.io&#47;blog&#47;blobs-are-here-scrolls-bernoulli-upgrade&gt;.</span>
<span class="term-fg32">+        Bernoulli,</span>
<span class="term-fg32">+        &#47;&#47;&#47; Curie: &lt;https:&#47;&#47;scroll.io&#47;blog&#47;compressing-the-gas-scrolls-curie-upgrade&gt;.</span>
<span class="term-fg32">+        Curie,</span>
<span class="term-fg32">+        &#47;&#47;&#47; Darwin: &lt;https:&#47;&#47;scroll.io&#47;blog&#47;proof-recursion-scrolls-darwin-upgrade&gt;.</span>
<span class="term-fg32">+        Darwin,</span>
<span class="term-fg32">+        &#47;&#47;&#47; DarwinV2 &lt;https:&#47;&#47;x.com&#47;Scroll_ZKP&#47;status&#47;1830565514755584269&gt;.</span>
<span class="term-fg32">+        DarwinV2,</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollHardfork {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Retrieves the activation block for the specified hardfork on the given chain.</span>
<span class="term-fg32">+    pub fn activation_block&lt;H: Hardfork&gt;(self, fork: H, chain: Chain) -&gt; Option&lt;u64&gt; {</span>
<span class="term-fg32">+        &#47;&#47; TODO(scroll): migrate to Chain::scroll() (introduced in https:&#47;&#47;github.com&#47;alloy-rs&#47;chains&#47;pull&#47;112) when alloy-chains is bumped to version 0.1.48</span>
<span class="term-fg32">+        if chain == Chain::from_named(NamedChain::Scroll) {</span>
<span class="term-fg32">+            return Self::scroll_sepolia_activation_block(fork);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        &#47;&#47; TODO(scroll): migrate to Chain::scroll_sepolia() (introduced in https:&#47;&#47;github.com&#47;alloy-rs&#47;chains&#47;pull&#47;112) when alloy-chains is bumped to version 0.1.48</span>
<span class="term-fg32">+        if chain == Chain::from_named(NamedChain::ScrollSepolia) {</span>
<span class="term-fg32">+            return Self::scroll_mainnet_activation_block(fork);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        None</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Retrieves the activation timestamp for the specified hardfork on the given chain.</span>
<span class="term-fg32">+    pub fn activation_timestamp&lt;H: Hardfork&gt;(self, fork: H, chain: Chain) -&gt; Option&lt;u64&gt; {</span>
<span class="term-fg32">+        &#47;&#47; TODO(scroll): migrate to Chain::scroll_sepolia() (introduced in https:&#47;&#47;github.com&#47;alloy-rs&#47;chains&#47;pull&#47;112) when alloy-chains is bumped to version 0.1.48</span>
<span class="term-fg32">+        if chain == Chain::from_named(NamedChain::ScrollSepolia) {</span>
<span class="term-fg32">+            return Self::scroll_sepolia_activation_timestamp(fork);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        &#47;&#47; TODO(scroll): migrate to Chain::scroll() (introduced in https:&#47;&#47;github.com&#47;alloy-rs&#47;chains&#47;pull&#47;112) when alloy-chains is bumped to version 0.1.48</span>
<span class="term-fg32">+        if chain == Chain::from_named(NamedChain::Scroll) {</span>
<span class="term-fg32">+            return Self::scroll_mainnet_activation_timestamp(fork);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        None</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Retrieves the activation block for the specified hardfork on the Scroll Sepolia testnet.</span>
<span class="term-fg32">+    pub fn scroll_sepolia_activation_block&lt;H: Hardfork&gt;(fork: H) -&gt; Option&lt;u64&gt; {</span>
<span class="term-fg32">+        match_hardfork(</span>
<span class="term-fg32">+            fork,</span>
<span class="term-fg32">+            |fork| match fork {</span>
<span class="term-fg32">+                EthereumHardfork::Homestead |</span>
<span class="term-fg32">+                EthereumHardfork::Tangerine |</span>
<span class="term-fg32">+                EthereumHardfork::SpuriousDragon |</span>
<span class="term-fg32">+                EthereumHardfork::Byzantium |</span>
<span class="term-fg32">+                EthereumHardfork::Constantinople |</span>
<span class="term-fg32">+                EthereumHardfork::Petersburg |</span>
<span class="term-fg32">+                EthereumHardfork::Istanbul |</span>
<span class="term-fg32">+                EthereumHardfork::Berlin |</span>
<span class="term-fg32">+                EthereumHardfork::London |</span>
<span class="term-fg32">+                EthereumHardfork::Shanghai =&gt; Some(0),</span>
<span class="term-fg32">+                _ =&gt; None,</span>
<span class="term-fg32">+            },</span>
<span class="term-fg32">+            |fork| match fork {</span>
<span class="term-fg32">+                Self::Archimedes =&gt; Some(0),</span>
<span class="term-fg32">+                Self::Bernoulli =&gt; Some(3747132),</span>
<span class="term-fg32">+                Self::Curie =&gt; Some(4740239),</span>
<span class="term-fg32">+                Self::Darwin =&gt; Some(6075509),</span>
<span class="term-fg32">+                Self::DarwinV2 =&gt; Some(6375501),</span>
<span class="term-fg32">+            },</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Retrieves the activation block for the specified hardfork on the Scroll mainnet.</span>
<span class="term-fg32">+    pub fn scroll_mainnet_activation_block&lt;H: Hardfork&gt;(fork: H) -&gt; Option&lt;u64&gt; {</span>
<span class="term-fg32">+        match_hardfork(</span>
<span class="term-fg32">+            fork,</span>
<span class="term-fg32">+            |fork| match fork {</span>
<span class="term-fg32">+                EthereumHardfork::Homestead |</span>
<span class="term-fg32">+                EthereumHardfork::Tangerine |</span>
<span class="term-fg32">+                EthereumHardfork::SpuriousDragon |</span>
<span class="term-fg32">+                EthereumHardfork::Byzantium |</span>
<span class="term-fg32">+                EthereumHardfork::Constantinople |</span>
<span class="term-fg32">+                EthereumHardfork::Petersburg |</span>
<span class="term-fg32">+                EthereumHardfork::Istanbul |</span>
<span class="term-fg32">+                EthereumHardfork::Berlin |</span>
<span class="term-fg32">+                EthereumHardfork::London |</span>
<span class="term-fg32">+                EthereumHardfork::Shanghai =&gt; Some(0),</span>
<span class="term-fg32">+                _ =&gt; None,</span>
<span class="term-fg32">+            },</span>
<span class="term-fg32">+            |fork| match fork {</span>
<span class="term-fg32">+                Self::Archimedes =&gt; Some(0),</span>
<span class="term-fg32">+                Self::Bernoulli =&gt; Some(5220340),</span>
<span class="term-fg32">+                Self::Curie =&gt; Some(7096836),</span>
<span class="term-fg32">+                Self::Darwin =&gt; Some(8568134),</span>
<span class="term-fg32">+                Self::DarwinV2 =&gt; Some(8923772),</span>
<span class="term-fg32">+            },</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Retrieves the activation timestamp for the specified hardfork on the Scroll Sepolia testnet.</span>
<span class="term-fg32">+    pub fn scroll_sepolia_activation_timestamp&lt;H: Hardfork&gt;(fork: H) -&gt; Option&lt;u64&gt; {</span>
<span class="term-fg32">+        match_hardfork(</span>
<span class="term-fg32">+            fork,</span>
<span class="term-fg32">+            |fork| match fork {</span>
<span class="term-fg32">+                EthereumHardfork::Homestead |</span>
<span class="term-fg32">+                EthereumHardfork::Tangerine |</span>
<span class="term-fg32">+                EthereumHardfork::SpuriousDragon |</span>
<span class="term-fg32">+                EthereumHardfork::Byzantium |</span>
<span class="term-fg32">+                EthereumHardfork::Constantinople |</span>
<span class="term-fg32">+                EthereumHardfork::Petersburg |</span>
<span class="term-fg32">+                EthereumHardfork::Istanbul |</span>
<span class="term-fg32">+                EthereumHardfork::Berlin |</span>
<span class="term-fg32">+                EthereumHardfork::London |</span>
<span class="term-fg32">+                EthereumHardfork::Shanghai =&gt; Some(0),</span>
<span class="term-fg32">+                _ =&gt; None,</span>
<span class="term-fg32">+            },</span>
<span class="term-fg32">+            |fork| match fork {</span>
<span class="term-fg32">+                Self::Archimedes =&gt; Some(0),</span>
<span class="term-fg32">+                Self::Bernoulli =&gt; Some(1713175866),</span>
<span class="term-fg32">+                Self::Curie =&gt; Some(1718616171),</span>
<span class="term-fg32">+                Self::Darwin =&gt; Some(1723622400),</span>
<span class="term-fg32">+                Self::DarwinV2 =&gt; Some(1724832000),</span>
<span class="term-fg32">+            },</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Retrieves the activation timestamp for the specified hardfork on the Scroll mainnet.</span>
<span class="term-fg32">+    pub fn scroll_mainnet_activation_timestamp&lt;H: Hardfork&gt;(fork: H) -&gt; Option&lt;u64&gt; {</span>
<span class="term-fg32">+        match_hardfork(</span>
<span class="term-fg32">+            fork,</span>
<span class="term-fg32">+            |fork| match fork {</span>
<span class="term-fg32">+                EthereumHardfork::Homestead |</span>
<span class="term-fg32">+                EthereumHardfork::Tangerine |</span>
<span class="term-fg32">+                EthereumHardfork::SpuriousDragon |</span>
<span class="term-fg32">+                EthereumHardfork::Byzantium |</span>
<span class="term-fg32">+                EthereumHardfork::Constantinople |</span>
<span class="term-fg32">+                EthereumHardfork::Petersburg |</span>
<span class="term-fg32">+                EthereumHardfork::Istanbul |</span>
<span class="term-fg32">+                EthereumHardfork::Berlin |</span>
<span class="term-fg32">+                EthereumHardfork::London |</span>
<span class="term-fg32">+                EthereumHardfork::Shanghai =&gt; Some(0),</span>
<span class="term-fg32">+                _ =&gt; None,</span>
<span class="term-fg32">+            },</span>
<span class="term-fg32">+            |fork| match fork {</span>
<span class="term-fg32">+                Self::Archimedes =&gt; Some(0),</span>
<span class="term-fg32">+                Self::Bernoulli =&gt; Some(1714358352),</span>
<span class="term-fg32">+                Self::Curie =&gt; Some(1719994277),</span>
<span class="term-fg32">+                Self::Darwin =&gt; Some(1724227200),</span>
<span class="term-fg32">+                Self::DarwinV2 =&gt; Some(1725264000),</span>
<span class="term-fg32">+            },</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Scroll mainnet list of hardforks.</span>
<span class="term-fg32">+    pub fn scroll_mainnet() -&gt; ChainHardforks {</span>
<span class="term-fg32">+        ChainHardforks::new(vec![</span>
<span class="term-fg32">+            (EthereumHardfork::Homestead.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::Dao.boxed(), ForkCondition::Never),</span>
<span class="term-fg32">+            (EthereumHardfork::Tangerine.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::SpuriousDragon.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::Byzantium.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::Constantinople.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::Petersburg.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::Istanbul.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::MuirGlacier.boxed(), ForkCondition::Never),</span>
<span class="term-fg32">+            (EthereumHardfork::Berlin.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::London.boxed(), ForkCondition::Never),</span>
<span class="term-fg32">+            (EthereumHardfork::ArrowGlacier.boxed(), ForkCondition::Never),</span>
<span class="term-fg32">+            (Self::Archimedes.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::Shanghai.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (Self::Bernoulli.boxed(), ForkCondition::Block(5220340)),</span>
<span class="term-fg32">+            (Self::Curie.boxed(), ForkCondition::Block(7096836)),</span>
<span class="term-fg32">+            (Self::Darwin.boxed(), ForkCondition::Timestamp(1724227200)),</span>
<span class="term-fg32">+            (Self::DarwinV2.boxed(), ForkCondition::Timestamp(1725264000)),</span>
<span class="term-fg32">+        ])</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Scroll sepolia list of hardforks.</span>
<span class="term-fg32">+    pub fn scroll_sepolia() -&gt; ChainHardforks {</span>
<span class="term-fg32">+        ChainHardforks::new(vec![</span>
<span class="term-fg32">+            (EthereumHardfork::Homestead.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::Tangerine.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::SpuriousDragon.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::Byzantium.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::Constantinople.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::Petersburg.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::Istanbul.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::Berlin.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::London.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (Self::Archimedes.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (EthereumHardfork::Shanghai.boxed(), ForkCondition::Block(0)),</span>
<span class="term-fg32">+            (Self::Bernoulli.boxed(), ForkCondition::Block(3747132)),</span>
<span class="term-fg32">+            (Self::Curie.boxed(), ForkCondition::Block(4740239)),</span>
<span class="term-fg32">+            (Self::Darwin.boxed(), ForkCondition::Timestamp(1723622400)),</span>
<span class="term-fg32">+            (Self::DarwinV2.boxed(), ForkCondition::Timestamp(1724832000)),</span>
<span class="term-fg32">+        ])</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match helper method since it&#39;s not possible to match on `dyn Hardfork`</span>
<span class="term-fg32">+fn match_hardfork&lt;H, HF, SHF&gt;(fork: H, hardfork_fn: HF, scroll_hardfork_fn: SHF) -&gt; Option&lt;u64&gt;</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    H: Hardfork,</span>
<span class="term-fg32">+    HF: Fn(&amp;EthereumHardfork) -&gt; Option&lt;u64&gt;,</span>
<span class="term-fg32">+    SHF: Fn(&amp;ScrollHardfork) -&gt; Option&lt;u64&gt;,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    let fork: &amp;dyn Any = &amp;fork;</span>
<span class="term-fg32">+    if let Some(fork) = fork.downcast_ref::&lt;EthereumHardfork&gt;() {</span>
<span class="term-fg32">+        return hardfork_fn(fork);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+    fork.downcast_ref::&lt;ScrollHardfork&gt;().and_then(scroll_hardfork_fn)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(test)]</span>
<span class="term-fg32">+mod tests {</span>
<span class="term-fg32">+    use super::*;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_match_hardfork() {</span>
<span class="term-fg32">+        assert_eq!(</span>
<span class="term-fg32">+            ScrollHardfork::scroll_mainnet_activation_block(ScrollHardfork::Bernoulli),</span>
<span class="term-fg32">+            Some(5220340)</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+        assert_eq!(</span>
<span class="term-fg32">+            ScrollHardfork::scroll_mainnet_activation_block(ScrollHardfork::Curie),</span>
<span class="term-fg32">+            Some(7096836)</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn check_scroll_hardfork_from_str() {</span>
<span class="term-fg32">+        let hardfork_str = [&quot;BernOulLi&quot;, &quot;CUrie&quot;, &quot;DaRwIn&quot;, &quot;DaRwInV2&quot;];</span>
<span class="term-fg32">+        let expected_hardforks = [</span>
<span class="term-fg32">+            ScrollHardfork::Bernoulli,</span>
<span class="term-fg32">+            ScrollHardfork::Curie,</span>
<span class="term-fg32">+            ScrollHardfork::Darwin,</span>
<span class="term-fg32">+            ScrollHardfork::DarwinV2,</span>
<span class="term-fg32">+        ];</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let hardforks: Vec&lt;ScrollHardfork&gt; =</span>
<span class="term-fg32">+            hardfork_str.iter().map(|h| ScrollHardfork::from_str(h).unwrap()).collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        assert_eq!(hardforks, expected_hardforks);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn check_nonexistent_hardfork_from_str() {</span>
<span class="term-fg32">+        assert!(ScrollHardfork::from_str(&quot;not a hardfork&quot;).is_err());</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5b86abf0f1c7246f113bd153" role="button"
                       aria-expanded="false" aria-controls="id-5b86abf0f1c7246f113bd153">
                        <code>crates/scroll/hardforks/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/hardforks/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+38</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5b86abf0f1c7246f113bd153"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;hardforks&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;hardforks&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..76784a4c53490187dfaf523918a61968d3315b0b</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;hardforks&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,38 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll-Reth hard forks.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![doc = include_str!(&quot;..&#47;docs&#47;hardforks.md&quot;)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+extern crate alloc;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub mod hardfork;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod dev;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use dev::DEV_HARDFORKS;</span>
<span class="term-fg32">+pub use hardfork::ScrollHardfork;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use reth_ethereum_forks::EthereumHardforks;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Extends [`EthereumHardforks`] with scroll helper methods.</span>
<span class="term-fg32">+pub trait ScrollHardforks: EthereumHardforks {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Convenience method to check if [`Bernoulli`](ScrollHardfork::Bernoulli) is active at a given</span>
<span class="term-fg32">+    &#47;&#47;&#47; block number.</span>
<span class="term-fg32">+    fn is_bernoulli_active_at_block(&amp;self, block_number: u64) -&gt; bool {</span>
<span class="term-fg32">+        self.fork(ScrollHardfork::Bernoulli).active_at_block(block_number)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns `true` if [`Curie`](ScrollHardfork::Curie) is active at given block block number.</span>
<span class="term-fg32">+    fn is_curie_active_at_block(&amp;self, block_number: u64) -&gt; bool {</span>
<span class="term-fg32">+        self.fork(ScrollHardfork::Curie).active_at_block(block_number)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns `true` if [`Darwin`](ScrollHardfork::Darwin) is active at given block timestamp.</span>
<span class="term-fg32">+    fn is_darwin_active_at_timestamp(&amp;self, timestamp: u64) -&gt; bool {</span>
<span class="term-fg32">+        self.fork(ScrollHardfork::Darwin).active_at_timestamp(timestamp)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns `true` if [`DarwinV2`](ScrollHardfork::DarwinV2) is active at given block timestamp.</span>
<span class="term-fg32">+    fn is_darwin_v2_active_at_timestamp(&amp;self, timestamp: u64) -&gt; bool {</span>
<span class="term-fg32">+        self.fork(ScrollHardfork::DarwinV2).active_at_timestamp(timestamp)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1fa91bc3c25d69fc2b5a1bb5" role="button"
                       aria-expanded="false" aria-controls="id-1fa91bc3c25d69fc2b5a1bb5">
                        <code>crates/scroll/node/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/node/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+60</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1fa91bc3c25d69fc2b5a1bb5"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;node&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;node&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..ccf320c076dbed52cd9729d442a5f89e23435887</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;node&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,61 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-node&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-db.workspace = true</span>
<span class="term-fg32">+reth-consensus.workspace = true</span>
<span class="term-fg32">+reth-ethereum-engine-primitives.workspace = true</span>
<span class="term-fg32">+reth-ethereum-forks.workspace = true</span>
<span class="term-fg32">+reth-evm.workspace = true</span>
<span class="term-fg32">+reth-network.workspace = true</span>
<span class="term-fg32">+reth-node-types.workspace = true</span>
<span class="term-fg32">+reth-node-builder.workspace = true</span>
<span class="term-fg32">+reth-payload-builder = { workspace = true, features = [&quot;test-utils&quot;] }</span>
<span class="term-fg32">+reth-primitives.workspace = true</span>
<span class="term-fg32">+reth-provider.workspace = true</span>
<span class="term-fg32">+reth-rpc.workspace = true</span>
<span class="term-fg32">+reth-tracing.workspace = true</span>
<span class="term-fg32">+reth-transaction-pool.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# alloy</span>
<span class="term-fg32">+alloy-rpc-types-engine.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-chainspec.workspace = true</span>
<span class="term-fg32">+reth-scroll-evm.workspace = true</span>
<span class="term-fg32">+reth-scroll-state-commitment.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# alloy</span>
<span class="term-fg32">+alloy-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# misc</span>
<span class="term-fg32">+eyre.workspace = true</span>
<span class="term-fg32">+tokio.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+optimism = [</span>
<span class="term-fg32">+	&quot;reth-db&#47;optimism&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;optimism&quot;,</span>
<span class="term-fg32">+	&quot;reth-provider&#47;optimism&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-evm&#47;optimism&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-node-builder&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-state-commitment&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-30c154fa2475e6806fefd9bd" role="button"
                       aria-expanded="false" aria-controls="id-30c154fa2475e6806fefd9bd">
                        <code>crates/scroll/node/src/addons.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/node/src/addons.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+16</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-30c154fa2475e6806fefd9bd"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;node&#47;src&#47;addons.rs scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;addons.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..3629a1e260f55cc45afb98a59da3e70a636f2a72</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;addons.rs</span>
<span class="term-fg36">@@ -0,0 +1,16 @@</span>
<span class="term-fg32">+use crate::engine::ScrollEngineValidatorBuilder;</span>
<span class="term-fg32">+use reth_network::NetworkHandle;</span>
<span class="term-fg32">+use reth_node_builder::{rpc::RpcAddOns, FullNodeComponents, FullNodeTypes};</span>
<span class="term-fg32">+use reth_rpc::EthApi;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Add-ons for the Scroll follower node.</span>
<span class="term-fg32">+pub type ScrollAddOns&lt;N&gt; = RpcAddOns&lt;</span>
<span class="term-fg32">+    N,</span>
<span class="term-fg32">+    EthApi&lt;</span>
<span class="term-fg32">+        &lt;N as FullNodeTypes&gt;::Provider,</span>
<span class="term-fg32">+        &lt;N as FullNodeComponents&gt;::Pool,</span>
<span class="term-fg32">+        NetworkHandle,</span>
<span class="term-fg32">+        &lt;N as FullNodeComponents&gt;::Evm,</span>
<span class="term-fg32">+    &gt;,</span>
<span class="term-fg32">+    ScrollEngineValidatorBuilder,</span>
<span class="term-fg32">+&gt;;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8e923b5930c76d3521596ffc" role="button"
                       aria-expanded="false" aria-controls="id-8e923b5930c76d3521596ffc">
                        <code>crates/scroll/node/src/consensus.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/node/src/consensus.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8e923b5930c76d3521596ffc"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;node&#47;src&#47;consensus.rs scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;consensus.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..0c0bac76fe1d9a49a146a8a5ce23059e060a9946</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;consensus.rs</span>
<span class="term-fg36">@@ -0,0 +1,14 @@</span>
<span class="term-fg32">+use reth_consensus::noop::NoopConsensus;</span>
<span class="term-fg32">+use reth_node_builder::{components::ConsensusBuilder, BuilderContext, FullNodeTypes};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The consensus builder for Scroll.</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct ScrollConsensusBuilder;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Node: FullNodeTypes&gt; ConsensusBuilder&lt;Node&gt; for ScrollConsensusBuilder {</span>
<span class="term-fg32">+    type Consensus = NoopConsensus;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    async fn build_consensus(self, _ctx: &amp;BuilderContext&lt;Node&gt;) -&gt; eyre::Result&lt;Self::Consensus&gt; {</span>
<span class="term-fg32">+        Ok(NoopConsensus::default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6f12db9e218103c23d3b3d45" role="button"
                       aria-expanded="false" aria-controls="id-6f12db9e218103c23d3b3d45">
                        <code>crates/scroll/node/src/engine.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/node/src/engine.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+62</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6f12db9e218103c23d3b3d45"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;node&#47;src&#47;engine.rs scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;engine.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..a5737db04c4f5c75932a2860bebb745cc4e15e5e</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;engine.rs</span>
<span class="term-fg36">@@ -0,0 +1,62 @@</span>
<span class="term-fg32">+use alloy_rpc_types_engine::{ExecutionPayload, ExecutionPayloadSidecar, PayloadError};</span>
<span class="term-fg32">+use reth_ethereum_engine_primitives::EthPayloadAttributes;</span>
<span class="term-fg32">+use reth_node_builder::{</span>
<span class="term-fg32">+    rpc::EngineValidatorBuilder, AddOnsContext, EngineApiMessageVersion,</span>
<span class="term-fg32">+    EngineObjectValidationError, EngineTypes, EngineValidator, FullNodeComponents,</span>
<span class="term-fg32">+    PayloadOrAttributes,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_node_types::NodeTypesWithEngine;</span>
<span class="term-fg32">+use reth_primitives::{Block, SealedBlock};</span>
<span class="term-fg32">+use reth_scroll_chainspec::ScrollChainSpec;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Builder for [`ScrollEngineValidator`].</span>
<span class="term-fg32">+#[derive(Debug, Default, Clone)]</span>
<span class="term-fg32">+pub struct ScrollEngineValidatorBuilder;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Node, Types&gt; EngineValidatorBuilder&lt;Node&gt; for ScrollEngineValidatorBuilder</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    Types: NodeTypesWithEngine&lt;ChainSpec = ScrollChainSpec&gt;,</span>
<span class="term-fg32">+    Node: FullNodeComponents&lt;Types = Types&gt;,</span>
<span class="term-fg32">+    NoopEngineValidator: EngineValidator&lt;Types::Engine&gt;,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    type Validator = NoopEngineValidator;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    async fn build(self, _ctx: &amp;AddOnsContext&lt;&#39;_, Node&gt;) -&gt; eyre::Result&lt;Self::Validator&gt; {</span>
<span class="term-fg32">+        Ok(NoopEngineValidator)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Noop engine validator used as default for Scroll.</span>
<span class="term-fg32">+#[derive(Debug, Clone)]</span>
<span class="term-fg32">+pub struct NoopEngineValidator;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Types&gt; EngineValidator&lt;Types&gt; for NoopEngineValidator</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    Types: EngineTypes&lt;PayloadAttributes = EthPayloadAttributes&gt;,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    type Block = Block;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn validate_version_specific_fields(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        _version: EngineApiMessageVersion,</span>
<span class="term-fg32">+        _payload_or_attrs: PayloadOrAttributes&lt;&#39;_, EthPayloadAttributes&gt;,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;(), EngineObjectValidationError&gt; {</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn ensure_well_formed_attributes(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        _version: EngineApiMessageVersion,</span>
<span class="term-fg32">+        _attributes: &amp;EthPayloadAttributes,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;(), EngineObjectValidationError&gt; {</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn ensure_well_formed_payload(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        _payload: ExecutionPayload,</span>
<span class="term-fg32">+        _sidecar: ExecutionPayloadSidecar,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;SealedBlock, PayloadError&gt; {</span>
<span class="term-fg32">+        Ok(SealedBlock::default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e4440fdd5074dd9436e44956" role="button"
                       aria-expanded="false" aria-controls="id-e4440fdd5074dd9436e44956">
                        <code>crates/scroll/node/src/execution.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/node/src/execution.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+31</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e4440fdd5074dd9436e44956"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;node&#47;src&#47;execution.rs scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;execution.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..eaf4af051028ed98827b87f431022cd61d8abe45</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;execution.rs</span>
<span class="term-fg36">@@ -0,0 +1,31 @@</span>
<span class="term-fg32">+use reth_evm::execute::BasicBlockExecutorProvider;</span>
<span class="term-fg32">+use reth_node_builder::{components::ExecutorBuilder, BuilderContext, FullNodeTypes};</span>
<span class="term-fg32">+use reth_node_types::NodeTypesWithEngine;</span>
<span class="term-fg32">+use reth_scroll_chainspec::ScrollChainSpec;</span>
<span class="term-fg32">+use reth_scroll_evm::{ScrollEvmConfig, ScrollExecutionStrategyFactory};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Executor builder for Scroll.</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct ScrollExecutorBuilder;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Node&gt; ExecutorBuilder&lt;Node&gt; for ScrollExecutorBuilder</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    Node: FullNodeTypes,</span>
<span class="term-fg32">+    Node::Types: NodeTypesWithEngine&lt;ChainSpec = ScrollChainSpec&gt;,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    type EVM = ScrollEvmConfig;</span>
<span class="term-fg32">+    type Executor = BasicBlockExecutorProvider&lt;ScrollExecutionStrategyFactory&gt;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    async fn build_evm(</span>
<span class="term-fg32">+        self,</span>
<span class="term-fg32">+        ctx: &amp;BuilderContext&lt;Node&gt;,</span>
<span class="term-fg32">+    ) -&gt; eyre::Result&lt;(Self::EVM, Self::Executor)&gt; {</span>
<span class="term-fg32">+        let chain_spec = ctx.chain_spec();</span>
<span class="term-fg32">+        let strategy_factory = ScrollExecutionStrategyFactory::new(chain_spec);</span>
<span class="term-fg32">+        let evm_config = strategy_factory.evm_config();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let executor = BasicBlockExecutorProvider::new(strategy_factory);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok((evm_config, executor))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4fb585fdbfa16571ebfe5aa0" role="button"
                       aria-expanded="false" aria-controls="id-4fb585fdbfa16571ebfe5aa0">
                        <code>crates/scroll/node/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/node/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+79</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4fb585fdbfa16571ebfe5aa0"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;node&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..bbc191aaffc9b6c6671bc65ac67dc43923290bed</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,79 @@</span>
<span class="term-fg32">+&#47;&#47;! Node specific implementations for Scroll.</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use reth_ethereum_engine_primitives::EthEngineTypes;</span>
<span class="term-fg32">+use reth_node_builder::{</span>
<span class="term-fg32">+    components::ComponentsBuilder, FullNodeTypes, Node, NodeAdapter, NodeComponentsBuilder,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_node_types::{NodeTypesWithDB, NodeTypesWithEngine};</span>
<span class="term-fg32">+use reth_primitives::EthPrimitives;</span>
<span class="term-fg32">+use reth_scroll_chainspec::ScrollChainSpec;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod addons;</span>
<span class="term-fg32">+pub use addons::ScrollAddOns;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod consensus;</span>
<span class="term-fg32">+pub use consensus::ScrollConsensusBuilder;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod engine;</span>
<span class="term-fg32">+pub use engine::ScrollEngineValidatorBuilder;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod execution;</span>
<span class="term-fg32">+pub use execution::ScrollExecutorBuilder;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod network;</span>
<span class="term-fg32">+pub use network::ScrollNetworkBuilder;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod payload;</span>
<span class="term-fg32">+pub use payload::ScrollPayloadBuilder;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod pool;</span>
<span class="term-fg32">+pub use pool::ScrollPoolBuilder;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod storage;</span>
<span class="term-fg32">+pub use storage::ScrollStorage;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod types;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The Scroll node implementation.</span>
<span class="term-fg32">+#[derive(Clone, Debug)]</span>
<span class="term-fg32">+pub struct ScrollNode;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;N&gt; Node&lt;N&gt; for ScrollNode</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    N: FullNodeTypes,</span>
<span class="term-fg32">+    N::Types: NodeTypesWithDB</span>
<span class="term-fg32">+        + NodeTypesWithEngine&lt;</span>
<span class="term-fg32">+            ChainSpec = ScrollChainSpec,</span>
<span class="term-fg32">+            Primitives = EthPrimitives,</span>
<span class="term-fg32">+            Engine = EthEngineTypes,</span>
<span class="term-fg32">+            Storage = ScrollStorage,</span>
<span class="term-fg32">+        &gt;,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    type ComponentsBuilder = ComponentsBuilder&lt;</span>
<span class="term-fg32">+        N,</span>
<span class="term-fg32">+        ScrollPoolBuilder,</span>
<span class="term-fg32">+        ScrollPayloadBuilder,</span>
<span class="term-fg32">+        ScrollNetworkBuilder,</span>
<span class="term-fg32">+        ScrollExecutorBuilder,</span>
<span class="term-fg32">+        ScrollConsensusBuilder,</span>
<span class="term-fg32">+    &gt;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    type AddOns = ScrollAddOns&lt;</span>
<span class="term-fg32">+        NodeAdapter&lt;N, &lt;Self::ComponentsBuilder as NodeComponentsBuilder&lt;N&gt;&gt;::Components&gt;,</span>
<span class="term-fg32">+    &gt;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn components_builder(&amp;self) -&gt; Self::ComponentsBuilder {</span>
<span class="term-fg32">+        ComponentsBuilder::default()</span>
<span class="term-fg32">+            .node_types::&lt;N&gt;()</span>
<span class="term-fg32">+            .pool(ScrollPoolBuilder)</span>
<span class="term-fg32">+            .payload(ScrollPayloadBuilder)</span>
<span class="term-fg32">+            .network(ScrollNetworkBuilder)</span>
<span class="term-fg32">+            .executor(ScrollExecutorBuilder)</span>
<span class="term-fg32">+            .consensus(ScrollConsensusBuilder)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn add_ons(&amp;self) -&gt; Self::AddOns {</span>
<span class="term-fg32">+        ScrollAddOns::default()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-29dea67b9831235f4d31b456" role="button"
                       aria-expanded="false" aria-controls="id-29dea67b9831235f4d31b456">
                        <code>crates/scroll/node/src/network.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/node/src/network.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+29</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-29dea67b9831235f4d31b456"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;node&#47;src&#47;network.rs scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;network.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..2e7304a8b24c6d3796ea18e464f78d62af91d333</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;network.rs</span>
<span class="term-fg36">@@ -0,0 +1,29 @@</span>
<span class="term-fg32">+use reth_network::PeersInfo;</span>
<span class="term-fg32">+use reth_node_builder::{components::NetworkBuilder, BuilderContext, FullNodeTypes};</span>
<span class="term-fg32">+use reth_node_types::NodeTypes;</span>
<span class="term-fg32">+use reth_primitives::EthPrimitives;</span>
<span class="term-fg32">+use reth_scroll_chainspec::ScrollChainSpec;</span>
<span class="term-fg32">+use reth_tracing::tracing::info;</span>
<span class="term-fg32">+use reth_transaction_pool::TransactionPool;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The network builder for Scroll.</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct ScrollNetworkBuilder;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Node, Pool&gt; NetworkBuilder&lt;Node, Pool&gt; for ScrollNetworkBuilder</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    Node: FullNodeTypes,</span>
<span class="term-fg32">+    Node::Types: NodeTypes&lt;ChainSpec = ScrollChainSpec, Primitives = EthPrimitives&gt;,</span>
<span class="term-fg32">+    Pool: TransactionPool + Unpin + &#39;static,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    async fn build_network(</span>
<span class="term-fg32">+        self,</span>
<span class="term-fg32">+        ctx: &amp;BuilderContext&lt;Node&gt;,</span>
<span class="term-fg32">+        pool: Pool,</span>
<span class="term-fg32">+    ) -&gt; eyre::Result&lt;reth_network::NetworkHandle&gt; {</span>
<span class="term-fg32">+        let network = ctx.network_builder().await?;</span>
<span class="term-fg32">+        let handle = ctx.start_network(network, pool);</span>
<span class="term-fg32">+        info!(target: &quot;reth::cli&quot;, enode=%handle.local_node_record(), &quot;P2P networking initialized&quot;);</span>
<span class="term-fg32">+        Ok(handle)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ccaacdd3c7c7d362013401e2" role="button"
                       aria-expanded="false" aria-controls="id-ccaacdd3c7c7d362013401e2">
                        <code>crates/scroll/node/src/payload.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/node/src/payload.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+47</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ccaacdd3c7c7d362013401e2"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;node&#47;src&#47;payload.rs scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;payload.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..9f79d0bdbd67f7e001a76699c8e3e04047f8c42c</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;payload.rs</span>
<span class="term-fg36">@@ -0,0 +1,47 @@</span>
<span class="term-fg32">+use reth_ethereum_engine_primitives::{</span>
<span class="term-fg32">+    EthBuiltPayload, EthPayloadAttributes, EthPayloadBuilderAttributes,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_node_builder::{</span>
<span class="term-fg32">+    components::PayloadServiceBuilder, BuilderContext, FullNodeTypes, PayloadTypes,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_node_types::NodeTypesWithEngine;</span>
<span class="term-fg32">+use reth_payload_builder::{</span>
<span class="term-fg32">+    test_utils::TestPayloadJobGenerator, PayloadBuilderHandle, PayloadBuilderService,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_primitives::EthPrimitives;</span>
<span class="term-fg32">+use reth_provider::CanonStateSubscriptions;</span>
<span class="term-fg32">+use reth_transaction_pool::TransactionPool;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Payload builder for Scroll.</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct ScrollPayloadBuilder;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Node, Pool&gt; PayloadServiceBuilder&lt;Node, Pool&gt; for ScrollPayloadBuilder</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    Node: FullNodeTypes,</span>
<span class="term-fg32">+    Node::Types: NodeTypesWithEngine&lt;Primitives = EthPrimitives&gt;,</span>
<span class="term-fg32">+    &lt;Node::Types as NodeTypesWithEngine&gt;::Engine: PayloadTypes&lt;</span>
<span class="term-fg32">+        BuiltPayload = EthBuiltPayload,</span>
<span class="term-fg32">+        PayloadAttributes = EthPayloadAttributes,</span>
<span class="term-fg32">+        PayloadBuilderAttributes = EthPayloadBuilderAttributes,</span>
<span class="term-fg32">+    &gt;,</span>
<span class="term-fg32">+    Pool: TransactionPool,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    async fn spawn_payload_service(</span>
<span class="term-fg32">+        self,</span>
<span class="term-fg32">+        ctx: &amp;BuilderContext&lt;Node&gt;,</span>
<span class="term-fg32">+        _pool: Pool,</span>
<span class="term-fg32">+    ) -&gt; eyre::Result&lt;</span>
<span class="term-fg32">+        PayloadBuilderHandle&lt;&lt;&lt;Node as FullNodeTypes&gt;::Types as NodeTypesWithEngine&gt;::Engine&gt;,</span>
<span class="term-fg32">+    &gt; {</span>
<span class="term-fg32">+        let test_payload_generator = TestPayloadJobGenerator::default();</span>
<span class="term-fg32">+        let (payload_service, payload_builder) = PayloadBuilderService::new(</span>
<span class="term-fg32">+            test_payload_generator,</span>
<span class="term-fg32">+            ctx.provider().canonical_state_stream(),</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        ctx.task_executor().spawn_critical(&quot;payload builder service&quot;, Box::pin(payload_service));</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        eyre::Ok(payload_builder)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-78c6f8274863515be8c685b4" role="button"
                       aria-expanded="false" aria-controls="id-78c6f8274863515be8c685b4">
                        <code>crates/scroll/node/src/pool.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/node/src/pool.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+17</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-78c6f8274863515be8c685b4"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;node&#47;src&#47;pool.rs scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;pool.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..1b2ee54e6409d39a2a8ffcc80397a3dfabe28ea9</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;pool.rs</span>
<span class="term-fg36">@@ -0,0 +1,17 @@</span>
<span class="term-fg32">+use reth_node_builder::{components::PoolBuilder, BuilderContext, FullNodeTypes};</span>
<span class="term-fg32">+use reth_transaction_pool::noop::NoopTransactionPool;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Pool builder for Scroll.</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct ScrollPoolBuilder;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Node&gt; PoolBuilder&lt;Node&gt; for ScrollPoolBuilder</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    Node: FullNodeTypes,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    type Pool = NoopTransactionPool;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    async fn build_pool(self, _ctx: &amp;BuilderContext&lt;Node&gt;) -&gt; eyre::Result&lt;Self::Pool&gt; {</span>
<span class="term-fg32">+        Ok(NoopTransactionPool::default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-55e0105bc41079e4db22c898" role="button"
                       aria-expanded="false" aria-controls="id-55e0105bc41079e4db22c898">
                        <code>crates/scroll/node/src/storage.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/node/src/storage.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+70</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-55e0105bc41079e4db22c898"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;node&#47;src&#47;storage.rs scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;storage.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..e3b6ded0a99681609b02cacf952dfedebc7df724</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;storage.rs</span>
<span class="term-fg36">@@ -0,0 +1,70 @@</span>
<span class="term-fg32">+use reth_db::transaction::{DbTx, DbTxMut};</span>
<span class="term-fg32">+use reth_ethereum_forks::EthereumHardforks;</span>
<span class="term-fg32">+use reth_node_types::NodeTypes;</span>
<span class="term-fg32">+use reth_primitives::{BlockBody, EthPrimitives};</span>
<span class="term-fg32">+use reth_provider::{</span>
<span class="term-fg32">+    providers::ChainStorage, BlockBodyReader, BlockBodyWriter, ChainSpecProvider, DBProvider,</span>
<span class="term-fg32">+    EthStorage, ProviderResult, ReadBodyInput,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Storage implementation for Scroll.</span>
<span class="term-fg32">+#[derive(Debug, Default, Clone)]</span>
<span class="term-fg32">+pub struct ScrollStorage(EthStorage);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Provider&gt; BlockBodyWriter&lt;Provider, BlockBody&gt; for ScrollStorage</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    Provider: DBProvider&lt;Tx: DbTxMut&gt;,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn write_block_bodies(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        provider: &amp;Provider,</span>
<span class="term-fg32">+        bodies: Vec&lt;(u64, Option&lt;BlockBody&gt;)&gt;,</span>
<span class="term-fg32">+    ) -&gt; ProviderResult&lt;()&gt; {</span>
<span class="term-fg32">+        self.0.write_block_bodies(provider, bodies)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn remove_block_bodies_above(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        provider: &amp;Provider,</span>
<span class="term-fg32">+        block: alloy_primitives::BlockNumber,</span>
<span class="term-fg32">+    ) -&gt; ProviderResult&lt;()&gt; {</span>
<span class="term-fg32">+        self.0.remove_block_bodies_above(provider, block)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Provider&gt; BlockBodyReader&lt;Provider&gt; for ScrollStorage</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    Provider: DBProvider + ChainSpecProvider&lt;ChainSpec: EthereumHardforks&gt;,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    type Block = reth_primitives::Block;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn read_block_bodies(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        provider: &amp;Provider,</span>
<span class="term-fg32">+        inputs: Vec&lt;ReadBodyInput&lt;&#39;_, Self::Block&gt;&gt;,</span>
<span class="term-fg32">+    ) -&gt; ProviderResult&lt;Vec&lt;BlockBody&gt;&gt; {</span>
<span class="term-fg32">+        self.0.read_block_bodies(provider, inputs)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ChainStorage&lt;EthPrimitives&gt; for ScrollStorage {</span>
<span class="term-fg32">+    fn reader&lt;TX, Types&gt;(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+    ) -&gt; impl reth_provider::ChainStorageReader&lt;reth_provider::DatabaseProvider&lt;TX, Types&gt;, EthPrimitives&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        TX: DbTx + &#39;static,</span>
<span class="term-fg32">+        Types: reth_provider::providers::NodeTypesForProvider&lt;Primitives = EthPrimitives&gt;,</span>
<span class="term-fg32">+    {</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn writer&lt;TX, Types&gt;(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+    ) -&gt; impl reth_provider::ChainStorageWriter&lt;reth_provider::DatabaseProvider&lt;TX, Types&gt;, EthPrimitives&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        TX: DbTxMut + DbTx + &#39;static,</span>
<span class="term-fg32">+        Types: NodeTypes&lt;Primitives = EthPrimitives&gt;,</span>
<span class="term-fg32">+    {</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4a841597ec07fe44638bfaf0" role="button"
                       aria-expanded="false" aria-controls="id-4a841597ec07fe44638bfaf0">
                        <code>crates/scroll/node/src/types.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/node/src/types.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+18</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4a841597ec07fe44638bfaf0"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;node&#47;src&#47;types.rs scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;types.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..da9a3b601c4d983deac4f93acc91ec054fbf69da</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;node&#47;src&#47;types.rs</span>
<span class="term-fg36">@@ -0,0 +1,18 @@</span>
<span class="term-fg32">+use crate::{storage::ScrollStorage, ScrollNode};</span>
<span class="term-fg32">+use reth_ethereum_engine_primitives::EthEngineTypes;</span>
<span class="term-fg32">+use reth_node_types::{NodeTypes, NodeTypesWithEngine};</span>
<span class="term-fg32">+use reth_primitives::EthPrimitives;</span>
<span class="term-fg32">+use reth_scroll_chainspec::ScrollChainSpec;</span>
<span class="term-fg32">+use reth_scroll_state_commitment::BinaryMerklePatriciaTrie;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl NodeTypesWithEngine for ScrollNode {</span>
<span class="term-fg32">+    type Engine = EthEngineTypes;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl NodeTypes for ScrollNode {</span>
<span class="term-fg32">+    &#47;&#47; TODO(scroll): update to scroll primitives when we introduce the revm SDK pattern.</span>
<span class="term-fg32">+    type Primitives = EthPrimitives;</span>
<span class="term-fg32">+    type ChainSpec = ScrollChainSpec;</span>
<span class="term-fg32">+    type StateCommitment = BinaryMerklePatriciaTrie;</span>
<span class="term-fg32">+    type Storage = ScrollStorage;</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9a267369d14b8db293aba5e3" role="button"
                       aria-expanded="false" aria-controls="id-9a267369d14b8db293aba5e3">
                        <code>crates/scroll/primitives/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/primitives/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+86</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9a267369d14b8db293aba5e3"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..4a02302764159b982efb4e5d4d0a2646602d5143</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,86 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-primitives&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# alloy</span>
<span class="term-fg32">+alloy-consensus.workspace = true</span>
<span class="term-fg32">+alloy-eips.workspace = true</span>
<span class="term-fg32">+alloy-primitives.workspace = true</span>
<span class="term-fg32">+alloy-rlp.workspace = true</span>
<span class="term-fg32">+alloy-serde.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-codecs = { workspace = true, optional = true }</span>
<span class="term-fg32">+reth-codecs-derive = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+poseidon-bn254 = { workspace = true, features = [&quot;bn254&quot;] }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# required by reth-codecs</span>
<span class="term-fg32">+bytes.workspace = true</span>
<span class="term-fg32">+modular-bitfield = { workspace = true, optional = true }</span>
<span class="term-fg32">+serde.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# misc</span>
<span class="term-fg32">+arbitrary = { workspace = true, features = [&quot;derive&quot;], optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dev-dependencies]</span>
<span class="term-fg32">+alloy-primitives = { workspace = true, features = [&quot;arbitrary&quot;] }</span>
<span class="term-fg32">+arbitrary = { workspace = true, features = [&quot;derive&quot;] }</span>
<span class="term-fg32">+bincode.workspace = true</span>
<span class="term-fg32">+rand.workspace = true</span>
<span class="term-fg32">+reth-codecs = { workspace = true, features = [&quot;test-utils&quot;] }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+proptest-arbitrary-interop.workspace = true</span>
<span class="term-fg32">+proptest.workspace = true</span>
<span class="term-fg32">+test-fuzz.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+default = [</span>
<span class="term-fg32">+	&quot;reth-codec&quot;,</span>
<span class="term-fg32">+	&quot;std&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+std = [</span>
<span class="term-fg32">+	&quot;serde&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;alloy-primitives&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;reth-codecs&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;alloy-consensus&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;alloy-eips&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;alloy-rlp&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;alloy-serde&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;bytes&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;proptest&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;rand&#47;std&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+arbitrary = [</span>
<span class="term-fg32">+	&quot;dep:arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;alloy-primitives&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;alloy-consensus&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;alloy-eips&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;alloy-serde&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;reth-codecs&#47;arbitrary&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+reth-codec = [</span>
<span class="term-fg32">+	&quot;dep:reth-codecs&quot;,</span>
<span class="term-fg32">+	&quot;dep:reth-codecs-derive&quot;,</span>
<span class="term-fg32">+	&quot;modular-bitfield&quot;,</span>
<span class="term-fg32">+	&quot;std&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+serde = [</span>
<span class="term-fg32">+	&quot;alloy-primitives&#47;serde&quot;,</span>
<span class="term-fg32">+	&quot;alloy-consensus&#47;serde&quot;,</span>
<span class="term-fg32">+	&quot;alloy-eips&#47;serde&quot;,</span>
<span class="term-fg32">+	&quot;bytes&#47;serde&quot;,</span>
<span class="term-fg32">+	&quot;rand&#47;serde&quot;,</span>
<span class="term-fg32">+	&quot;reth-codecs&#47;serde&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-58dd496afbd7f2f781eaed9a" role="button"
                       aria-expanded="false" aria-controls="id-58dd496afbd7f2f781eaed9a">
                        <code>crates/scroll/primitives/src/account_extension.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/primitives/src/account_extension.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+45</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-58dd496afbd7f2f781eaed9a"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;account_extension.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;account_extension.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..39709b55dd0399bd011dcd08d242548f79e7c4f2</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;account_extension.rs</span>
<span class="term-fg36">@@ -0,0 +1,45 @@</span>
<span class="term-fg32">+use crate::poseidon::{hash_code, POSEIDON_EMPTY};</span>
<span class="term-fg32">+use alloy_primitives::B256;</span>
<span class="term-fg32">+use serde::{Deserialize, Serialize};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The extension for a Scroll account&#39;s representation in storage.</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; The extension is used in order to maintain backwards compatibility if more fields need to be</span>
<span class="term-fg32">+&#47;&#47;&#47; added to the account (see [reth codecs](reth_codecs::test_utils) for details).</span>
<span class="term-fg32">+#[derive(Clone, Copy, Debug, Default, PartialEq, Eq, Serialize, Deserialize)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;reth-codec&quot;, derive(reth_codecs::Compact))]</span>
<span class="term-fg32">+#[cfg_attr(any(test, feature = &quot;arbitrary&quot;), derive(arbitrary::Arbitrary))]</span>
<span class="term-fg32">+pub struct AccountExtension {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Size in bytes of the account&#39;s bytecode.</span>
<span class="term-fg32">+    pub code_size: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Poseidon hash of the account&#39;s bytecode. `None` means there is no</span>
<span class="term-fg32">+    &#47;&#47;&#47; bytecode for the account.</span>
<span class="term-fg32">+    pub poseidon_code_hash: Option&lt;B256&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl AccountExtension {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates an empty [`AccountExtension`].</span>
<span class="term-fg32">+    pub const fn empty() -&gt; Self {</span>
<span class="term-fg32">+        Self { code_size: 0, poseidon_code_hash: None }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates an [`AccountExtension`] from the provided bytecode.</span>
<span class="term-fg32">+    pub fn from_bytecode&lt;T: AsRef&lt;[u8]&gt;&gt;(code: &amp;T) -&gt; Self {</span>
<span class="term-fg32">+        let code = code.as_ref();</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            code_size: code.len() as u64,</span>
<span class="term-fg32">+            poseidon_code_hash: (!code.is_empty()).then_some(hash_code(code)),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(u64, B256)&gt; for AccountExtension {</span>
<span class="term-fg32">+    fn from(value: (u64, B256)) -&gt; Self {</span>
<span class="term-fg32">+        &#47;&#47; TODO (scroll): Looks like we can create an [`AccountExtension`] with non-zero</span>
<span class="term-fg32">+        &#47;&#47; code size with poseidon_code_hash = None</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            code_size: value.0,</span>
<span class="term-fg32">+            poseidon_code_hash: (value.1 != POSEIDON_EMPTY).then_some(value.1),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-45475736efd32bcbeff6e6f4" role="button"
                       aria-expanded="false" aria-controls="id-45475736efd32bcbeff6e6f4">
                        <code>crates/scroll/primitives/src/execution_context.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/primitives/src/execution_context.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-45475736efd32bcbeff6e6f4"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;execution_context.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;execution_context.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..0175e70cb1a2f4c55557cad40996b3a89ee2b8a6</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;execution_context.rs</span>
<span class="term-fg36">@@ -0,0 +1,12 @@</span>
<span class="term-fg32">+use alloy_primitives::{map::HashMap, B256};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A Keccak code hash.</span>
<span class="term-fg32">+type KeccakHash = B256;</span>
<span class="term-fg32">+&#47;&#47;&#47; A Poseidon code hash.</span>
<span class="term-fg32">+type PoseidonHash = B256;</span>
<span class="term-fg32">+&#47;&#47;&#47; Size of a contract&#39;s code in bytes.</span>
<span class="term-fg32">+type CodeSize = u64;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Scroll post execution context maps a Keccak code hash of a contract&#39;s bytecode to its code size</span>
<span class="term-fg32">+&#47;&#47;&#47; and Poseidon code hash.</span>
<span class="term-fg32">+pub type ScrollPostExecutionContext = HashMap&lt;KeccakHash, (CodeSize, PoseidonHash)&gt;;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-718f0fa231c02a749900ffb9" role="button"
                       aria-expanded="false" aria-controls="id-718f0fa231c02a749900ffb9">
                        <code>crates/scroll/primitives/src/l1_transaction.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/primitives/src/l1_transaction.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+308</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-718f0fa231c02a749900ffb9"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;l1_transaction.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;l1_transaction.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..3f71d1e807544be1c5532f26b140e3a09ddf6db7</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;l1_transaction.rs</span>
<span class="term-fg36">@@ -0,0 +1,308 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll L1 message transaction</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use alloy_consensus::Transaction;</span>
<span class="term-fg32">+use alloy_primitives::{</span>
<span class="term-fg32">+    private::alloy_rlp::{Encodable, Header},</span>
<span class="term-fg32">+    Address, Bytes, ChainId, PrimitiveSignature as Signature, TxKind, B256, U256,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use alloy_rlp::Decodable;</span>
<span class="term-fg32">+use bytes::BufMut;</span>
<span class="term-fg32">+use serde::{Deserialize, Serialize};</span>
<span class="term-fg32">+#[cfg(any(test, feature = &quot;reth-codec&quot;))]</span>
<span class="term-fg32">+use {reth_codecs::Compact, reth_codecs_derive::add_arbitrary_tests};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; L1 message transaction type id, 0x7e in hex.</span>
<span class="term-fg32">+pub const L1_MESSAGE_TRANSACTION_TYPE: u8 = 126;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A message transaction sent from the settlement layer to the L2 for execution.</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; The signature of the L1 message is already verified on the L1 and as such doesn&#39;t contain</span>
<span class="term-fg32">+&#47;&#47;&#47; a signature field. Gas for the transaction execution on Scroll is already paid for on the L1.</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; # Bincode compatibility</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; `bincode` crate doesn&#39;t work with optionally serializable serde fields and some of the execution</span>
<span class="term-fg32">+&#47;&#47;&#47; types require optional serialization for RPC compatibility. Since `TxL1Message` doesn&#39;t</span>
<span class="term-fg32">+&#47;&#47;&#47; contain optionally serializable fields, no `bincode` compatible bridge implementation is</span>
<span class="term-fg32">+&#47;&#47;&#47; required.</span>
<span class="term-fg32">+#[derive(Clone, Debug, Default, PartialEq, Eq, Hash)]</span>
<span class="term-fg32">+#[cfg_attr(any(test, feature = &quot;serde&quot;), derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+#[cfg_attr(any(test, feature = &quot;serde&quot;), serde(rename_all = &quot;camelCase&quot;))]</span>
<span class="term-fg32">+#[cfg_attr(any(test, feature = &quot;arbitrary&quot;), derive(arbitrary::Arbitrary))]</span>
<span class="term-fg32">+#[cfg_attr(any(test, feature = &quot;reth-codec&quot;), derive(Compact))]</span>
<span class="term-fg32">+#[cfg_attr(any(test, feature = &quot;reth-codec&quot;), add_arbitrary_tests(compact, rlp))]</span>
<span class="term-fg32">+pub struct TxL1Message {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The queue index of the message in the L1 contract queue.</span>
<span class="term-fg32">+    #[cfg_attr(feature = &quot;serde&quot;, serde(with = &quot;alloy_serde::quantity&quot;))]</span>
<span class="term-fg32">+    pub queue_index: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The gas limit for the transaction. Gas is paid for when message is sent from the L1.</span>
<span class="term-fg32">+    #[cfg_attr(feature = &quot;serde&quot;, serde(with = &quot;alloy_serde::quantity&quot;, rename = &quot;gas&quot;))]</span>
<span class="term-fg32">+    pub gas_limit: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The destination for the transaction. `Address` is used in place of `TxKind` since contract</span>
<span class="term-fg32">+    &#47;&#47;&#47; creations aren&#39;t allowed via L1 message transactions.</span>
<span class="term-fg32">+    pub to: Address,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The value sent.</span>
<span class="term-fg32">+    pub value: U256,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The L1 sender of the transaction.</span>
<span class="term-fg32">+    pub sender: Address,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The input of the transaction.</span>
<span class="term-fg32">+    pub input: Bytes,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl TxL1Message {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns an empty signature for the [`TxL1Message`], which don&#39;t include a signature.</span>
<span class="term-fg32">+    pub fn signature() -&gt; Signature {</span>
<span class="term-fg32">+        Signature::new(U256::ZERO, U256::ZERO, false)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the destination of the transaction as a [`TxKind`].</span>
<span class="term-fg32">+    pub const fn to(&amp;self) -&gt; TxKind {</span>
<span class="term-fg32">+        TxKind::Call(self.to)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Decodes the inner [`TxL1Message`] fields from RLP bytes.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; NOTE: This assumes a RLP header has already been decoded, and _just_ decodes the following</span>
<span class="term-fg32">+    &#47;&#47;&#47; RLP fields in the following order:</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `queue_index`</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `gas_limit`</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `to`</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `value`</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `input`</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `sender`</span>
<span class="term-fg32">+    pub fn rlp_decode_fields(buf: &amp;mut &amp;[u8]) -&gt; alloy_rlp::Result&lt;Self&gt; {</span>
<span class="term-fg32">+        Ok(Self {</span>
<span class="term-fg32">+            queue_index: Decodable::decode(buf)?,</span>
<span class="term-fg32">+            gas_limit: Decodable::decode(buf)?,</span>
<span class="term-fg32">+            to: Decodable::decode(buf)?,</span>
<span class="term-fg32">+            value: Decodable::decode(buf)?,</span>
<span class="term-fg32">+            input: Decodable::decode(buf)?,</span>
<span class="term-fg32">+            sender: Decodable::decode(buf)?,</span>
<span class="term-fg32">+        })</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Decodes the transaction from RLP bytes.</span>
<span class="term-fg32">+    pub fn rlp_decode(buf: &amp;mut &amp;[u8]) -&gt; alloy_rlp::Result&lt;Self&gt; {</span>
<span class="term-fg32">+        let header = Header::decode(buf)?;</span>
<span class="term-fg32">+        if !header.list {</span>
<span class="term-fg32">+            return Err(alloy_rlp::Error::UnexpectedString);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        let remaining = buf.len();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let this = Self::rlp_decode_fields(buf)?;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        if buf.len() + header.payload_length != remaining {</span>
<span class="term-fg32">+            return Err(alloy_rlp::Error::ListLengthMismatch {</span>
<span class="term-fg32">+                expected: header.payload_length,</span>
<span class="term-fg32">+                got: remaining - buf.len(),</span>
<span class="term-fg32">+            });</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(this)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Outputs the length of the transaction&#39;s fields, without a RLP header.</span>
<span class="term-fg32">+    fn rlp_encoded_fields_length(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.queue_index.length() +</span>
<span class="term-fg32">+            self.gas_limit.length() +</span>
<span class="term-fg32">+            self.to.length() +</span>
<span class="term-fg32">+            self.value.length() +</span>
<span class="term-fg32">+            self.input.0.length() +</span>
<span class="term-fg32">+            self.sender.length()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Encode the fields of the transaction without a RLP header.</span>
<span class="term-fg32">+    &#47;&#47;&#47; &lt;https:&#47;&#47;github.com&#47;scroll-tech&#47;go-ethereum&#47;blob&#47;9fff27e4f34fb5097100ed76ee725ce056267f4b&#47;core&#47;types&#47;l1_message_tx.go#L12-L19&gt;</span>
<span class="term-fg32">+    fn rlp_encode_fields(&amp;self, out: &amp;mut dyn BufMut) {</span>
<span class="term-fg32">+        self.queue_index.encode(out);</span>
<span class="term-fg32">+        self.gas_limit.encode(out);</span>
<span class="term-fg32">+        self.to.encode(out);</span>
<span class="term-fg32">+        self.value.encode(out);</span>
<span class="term-fg32">+        self.input.encode(out);</span>
<span class="term-fg32">+        self.sender.encode(out);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create a RLP header for the transaction.</span>
<span class="term-fg32">+    fn rlp_header(&amp;self) -&gt; Header {</span>
<span class="term-fg32">+        Header { list: true, payload_length: self.rlp_encoded_fields_length() }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; RLP encodes the transaction.</span>
<span class="term-fg32">+    pub fn rlp_encode(&amp;self, out: &amp;mut dyn BufMut) {</span>
<span class="term-fg32">+        self.rlp_header().encode(out);</span>
<span class="term-fg32">+        self.rlp_encode_fields(out);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Get the length of the transaction when RLP encoded.</span>
<span class="term-fg32">+    pub fn rlp_encoded_length(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.rlp_header().length_with_payload()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Get the length of the transaction when EIP-2718 encoded. This is the</span>
<span class="term-fg32">+    &#47;&#47;&#47; 1 byte type flag + the length of the RLP encoded transaction.</span>
<span class="term-fg32">+    pub fn eip2718_encoded_length(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.rlp_encoded_length() + 1</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; EIP-2718 encode the transaction.</span>
<span class="term-fg32">+    pub fn eip2718_encode(&amp;self, out: &amp;mut dyn BufMut) {</span>
<span class="term-fg32">+        out.put_u8(L1_MESSAGE_TRANSACTION_TYPE);</span>
<span class="term-fg32">+        self.rlp_encode(out)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Calculates the in-memory size of the [`TxL1Message`] transaction.</span>
<span class="term-fg32">+    #[inline]</span>
<span class="term-fg32">+    pub fn size(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        size_of::&lt;u64&gt;() + &#47;&#47; queue_index</span>
<span class="term-fg32">+            size_of::&lt;u64&gt;() + &#47;&#47; gas_limit</span>
<span class="term-fg32">+            size_of::&lt;Address&gt;() + &#47;&#47; to</span>
<span class="term-fg32">+            size_of::&lt;U256&gt;() + &#47;&#47; value</span>
<span class="term-fg32">+            self.input.len() + &#47;&#47; input</span>
<span class="term-fg32">+            size_of::&lt;Address&gt;() &#47;&#47; sender</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Encodable for TxL1Message {</span>
<span class="term-fg32">+    fn encode(&amp;self, out: &amp;mut dyn BufMut) {</span>
<span class="term-fg32">+        self.rlp_encode(out)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn length(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.rlp_encoded_length()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Decodable for TxL1Message {</span>
<span class="term-fg32">+    fn decode(buf: &amp;mut &amp;[u8]) -&gt; alloy_rlp::Result&lt;Self&gt; {</span>
<span class="term-fg32">+        Self::rlp_decode(buf)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Transaction for TxL1Message {</span>
<span class="term-fg32">+    fn chain_id(&amp;self) -&gt; Option&lt;ChainId&gt; {</span>
<span class="term-fg32">+        None</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn nonce(&amp;self) -&gt; u64 {</span>
<span class="term-fg32">+        0u64</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn gas_limit(&amp;self) -&gt; u64 {</span>
<span class="term-fg32">+        self.gas_limit</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn gas_price(&amp;self) -&gt; Option&lt;u128&gt; {</span>
<span class="term-fg32">+        None</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn max_fee_per_gas(&amp;self) -&gt; u128 {</span>
<span class="term-fg32">+        0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn max_priority_fee_per_gas(&amp;self) -&gt; Option&lt;u128&gt; {</span>
<span class="term-fg32">+        None</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn max_fee_per_blob_gas(&amp;self) -&gt; Option&lt;u128&gt; {</span>
<span class="term-fg32">+        None</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn priority_fee_or_price(&amp;self) -&gt; u128 {</span>
<span class="term-fg32">+        0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn effective_gas_price(&amp;self, _base_fee: Option&lt;u64&gt;) -&gt; u128 {</span>
<span class="term-fg32">+        0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn is_dynamic_fee(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        false</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn kind(&amp;self) -&gt; TxKind {</span>
<span class="term-fg32">+        self.to()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn value(&amp;self) -&gt; U256 {</span>
<span class="term-fg32">+        self.value</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn input(&amp;self) -&gt; &amp;Bytes {</span>
<span class="term-fg32">+        &amp;self.input</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn ty(&amp;self) -&gt; u8 {</span>
<span class="term-fg32">+        L1_MESSAGE_TRANSACTION_TYPE</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn access_list(&amp;self) -&gt; Option&lt;&amp;alloy_eips::eip2930::AccessList&gt; {</span>
<span class="term-fg32">+        None</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn blob_versioned_hashes(&amp;self) -&gt; Option&lt;&amp;[B256]&gt; {</span>
<span class="term-fg32">+        None</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn authorization_list(&amp;self) -&gt; Option&lt;&amp;[alloy_eips::eip7702::SignedAuthorization]&gt; {</span>
<span class="term-fg32">+        None</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Scroll specific transaction fields</span>
<span class="term-fg32">+#[derive(Clone, Copy, Debug, Default, PartialEq, Eq, Serialize, Deserialize)]</span>
<span class="term-fg32">+#[serde(rename_all = &quot;camelCase&quot;)]</span>
<span class="term-fg32">+pub struct ScrollL1MessageTransactionFields {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The index of the transaction in the message queue.</span>
<span class="term-fg32">+    #[serde(with = &quot;alloy_serde::quantity&quot;)]</span>
<span class="term-fg32">+    pub queue_index: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The sender of the transaction on the L1.</span>
<span class="term-fg32">+    pub sender: Address,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(test)]</span>
<span class="term-fg32">+mod tests {</span>
<span class="term-fg32">+    use super::TxL1Message;</span>
<span class="term-fg32">+    use alloy_primitives::{address, bytes, hex, Bytes, U256};</span>
<span class="term-fg32">+    use arbitrary::Arbitrary;</span>
<span class="term-fg32">+    use bytes::BytesMut;</span>
<span class="term-fg32">+    use rand::Rng;</span>
<span class="term-fg32">+    use reth_codecs::{test_utils::UnusedBits, validate_bitflag_backwards_compat};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_bincode_roundtrip() {</span>
<span class="term-fg32">+        let mut bytes = [0u8; 1024];</span>
<span class="term-fg32">+        rand::thread_rng().fill(bytes.as_mut_slice());</span>
<span class="term-fg32">+        let tx = TxL1Message::arbitrary(&amp;mut arbitrary::Unstructured::new(&amp;bytes)).unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let encoded = bincode::serialize(&amp;tx).unwrap();</span>
<span class="term-fg32">+        let decoded: TxL1Message = bincode::deserialize(&amp;encoded).unwrap();</span>
<span class="term-fg32">+        assert_eq!(decoded, tx);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_eip2718_encode() {</span>
<span class="term-fg32">+        let tx =</span>
<span class="term-fg32">+            TxL1Message {</span>
<span class="term-fg32">+                queue_index: 947883,</span>
<span class="term-fg32">+                gas_limit: 2000000,</span>
<span class="term-fg32">+                to: address!(&quot;781e90f1c8fc4611c9b7497c3b47f99ef6969cbc&quot;),</span>
<span class="term-fg32">+                value: U256::ZERO,</span>
<span class="term-fg32">+                sender: address!(&quot;7885bcbd5cecef1336b5300fb5186a12ddd8c478&quot;),</span>
<span class="term-fg32">+                input: bytes!(&quot;8ef1332e000000000000000000000000c186fa914353c44b2e33ebe05f21846f1048beda0000000000000000000000003bad7ad0728f9917d1bf08af5782dcbd516cdd96000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e76ab00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000044493a4f84f464e58d4bfa93bcc57abfb14dbe1b8ff46cd132b5709aab227f269727943d2f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;),</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            ;</span>
<span class="term-fg32">+        let bytes = Bytes::from_static(&amp;hex!(&quot;7ef9015a830e76ab831e848094781e90f1c8fc4611c9b7497c3b47f99ef6969cbc80b901248ef1332e000000000000000000000000c186fa914353c44b2e33ebe05f21846f1048beda0000000000000000000000003bad7ad0728f9917d1bf08af5782dcbd516cdd96000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e76ab00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000044493a4f84f464e58d4bfa93bcc57abfb14dbe1b8ff46cd132b5709aab227f269727943d2f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000947885bcbd5cecef1336b5300fb5186a12ddd8c478&quot;));</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut encoded = BytesMut::default();</span>
<span class="term-fg32">+        tx.eip2718_encode(&amp;mut encoded);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        assert_eq!(encoded, bytes.as_ref())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_compaction_backwards_compatibility() {</span>
<span class="term-fg32">+        assert_eq!(TxL1Message::bitflag_encoded_bytes(), 2);</span>
<span class="term-fg32">+        validate_bitflag_backwards_compat!(TxL1Message, UnusedBits::NotZero);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0519330f0cd3aaf95358002b" role="button"
                       aria-expanded="false" aria-controls="id-0519330f0cd3aaf95358002b">
                        <code>crates/scroll/primitives/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/primitives/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+17</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0519330f0cd3aaf95358002b"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..ac4d81a405259925bceb4249cf58cf0a2556f8a0</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,17 @@</span>
<span class="term-fg32">+&#47;&#47;! Primitive types for the Scroll extension of `Reth`.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![warn(unused_crate_dependencies)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use execution_context::ScrollPostExecutionContext;</span>
<span class="term-fg32">+mod execution_context;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use account_extension::AccountExtension;</span>
<span class="term-fg32">+mod account_extension;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use l1_transaction::{</span>
<span class="term-fg32">+    ScrollL1MessageTransactionFields, TxL1Message, L1_MESSAGE_TRANSACTION_TYPE,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+pub mod l1_transaction;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Poseidon hashing primitives.</span>
<span class="term-fg32">+pub mod poseidon;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6ccff63573d6941c2fbd1fa2" role="button"
                       aria-expanded="false" aria-controls="id-6ccff63573d6941c2fbd1fa2">
                        <code>crates/scroll/primitives/src/poseidon.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/primitives/src/poseidon.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+87</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6ccff63573d6941c2fbd1fa2"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;poseidon.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;poseidon.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..7c8a2df68c97dd502151cf3e4b6bf7b5e1f0ef6f</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;poseidon.rs</span>
<span class="term-fg36">@@ -0,0 +1,87 @@</span>
<span class="term-fg32">+use alloy_primitives::{b256, B256};</span>
<span class="term-fg32">+pub use poseidon_bn254::{hash_with_domain, Fr, PrimeField};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The Poseidon hash of the empty string `&quot;&quot;`.</span>
<span class="term-fg32">+pub const POSEIDON_EMPTY: B256 =</span>
<span class="term-fg32">+    b256!(&quot;2098f5fb9e239eab3ceac3f27b81e481dc3124d55ffed523a839ee8446b64864&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The root hash of an empty binary Merle Patricia trie.</span>
<span class="term-fg32">+pub const EMPTY_ROOT_HASH: B256 = B256::ZERO;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Type that is used to represent a field element in binary representation.</span>
<span class="term-fg32">+pub type FieldElementBytes = &lt;Fr as PrimeField&gt;::Repr;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The number of bytes in the binary representation of a field element.</span>
<span class="term-fg32">+pub const FIELD_ELEMENT_REPR_BYTES: usize = core::mem::size_of::&lt;FieldElementBytes&gt;();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Half the number of bytes in the binary representation of a field element.</span>
<span class="term-fg32">+const HALF_FIELD_ELEMENT_REPR_BYTES: usize = FIELD_ELEMENT_REPR_BYTES &#47; 2;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The domain multiplier per field element.</span>
<span class="term-fg32">+pub const DOMAIN_MULTIPLIER_PER_FIELD_ELEMENT: u64 = 256;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The domain for hashing two field elements.</span>
<span class="term-fg32">+pub const DOMAIN_TWO_FIELD_ELEMENTS: Fr =</span>
<span class="term-fg32">+    Fr::from_raw([DOMAIN_MULTIPLIER_PER_FIELD_ELEMENT * 2, 0, 0, 0]);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Hash two field elements using poseidon.</span>
<span class="term-fg32">+pub fn hash(element_1: Fr, element_2: Fr) -&gt; Fr {</span>
<span class="term-fg32">+    hash_with_domain(&amp;[element_1, element_2], DOMAIN_TWO_FIELD_ELEMENTS)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Poseidon code hash</span>
<span class="term-fg32">+pub fn hash_code&lt;T: AsRef&lt;[u8]&gt;&gt;(code: T) -&gt; B256 {</span>
<span class="term-fg32">+    poseidon_bn254::hash_code(code.as_ref()).into()</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Split and transform input be bytes into two field elements and hash using poseidon.</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; # Panics</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; This function will panic if more than 32 bytes are provided as input.</span>
<span class="term-fg32">+pub fn split_and_hash_be_bytes&lt;T: AsRef&lt;[u8]&gt;&gt;(bytes: T) -&gt; Fr {</span>
<span class="term-fg32">+    debug_assert!(</span>
<span class="term-fg32">+        bytes.as_ref().len() &lt;= FIELD_ELEMENT_REPR_BYTES,</span>
<span class="term-fg32">+        &quot;bytes length should be less than or equal to field element bytes&quot;</span>
<span class="term-fg32">+    );</span>
<span class="term-fg32">+    let (bytes_lo, bytes_hi) = split_and_parse_field_elements(bytes.as_ref());</span>
<span class="term-fg32">+    hash(bytes_lo, bytes_hi)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Parse input bytes into two field elements which represent the lower bytes and the upper bytes.</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; # Panics</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; This function will panic if more than 32 bytes are provided as input.</span>
<span class="term-fg32">+fn split_and_parse_field_elements(bytes: &amp;[u8]) -&gt; (Fr, Fr) {</span>
<span class="term-fg32">+    debug_assert!(</span>
<span class="term-fg32">+        bytes.len() &lt;= FIELD_ELEMENT_REPR_BYTES,</span>
<span class="term-fg32">+        &quot;bytes length should be less than or equal to field element bytes&quot;</span>
<span class="term-fg32">+    );</span>
<span class="term-fg32">+    let mut bytes_lo = FieldElementBytes::default();</span>
<span class="term-fg32">+    let mut bytes_hi = FieldElementBytes::default();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    if bytes.len() &gt; (HALF_FIELD_ELEMENT_REPR_BYTES) {</span>
<span class="term-fg32">+        bytes_lo[HALF_FIELD_ELEMENT_REPR_BYTES..]</span>
<span class="term-fg32">+            .copy_from_slice(&amp;bytes[..HALF_FIELD_ELEMENT_REPR_BYTES]);</span>
<span class="term-fg32">+        bytes_hi[HALF_FIELD_ELEMENT_REPR_BYTES..bytes.len()]</span>
<span class="term-fg32">+            .copy_from_slice(&amp;bytes[HALF_FIELD_ELEMENT_REPR_BYTES..]);</span>
<span class="term-fg32">+    } else {</span>
<span class="term-fg32">+        bytes_lo[HALF_FIELD_ELEMENT_REPR_BYTES..(HALF_FIELD_ELEMENT_REPR_BYTES + bytes.len())]</span>
<span class="term-fg32">+            .copy_from_slice(bytes)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    let bytes_lo = field_element_from_be_bytes(bytes_lo);</span>
<span class="term-fg32">+    let bytes_hi = field_element_from_be_bytes(bytes_hi);</span>
<span class="term-fg32">+    (bytes_lo, bytes_hi)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Parses a field element from big endian bytes.</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; # Panics</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; This function will panic if the bytes are not a valid field element.</span>
<span class="term-fg32">+pub fn field_element_from_be_bytes(mut bytes: FieldElementBytes) -&gt; Fr {</span>
<span class="term-fg32">+    bytes.reverse();</span>
<span class="term-fg32">+    Fr::from_repr_vartime(bytes).expect(&quot;valid field element&quot;)</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-595fca69ca2af33aa092f8ef" role="button"
                       aria-expanded="false" aria-controls="id-595fca69ca2af33aa092f8ef">
                        <code>crates/scroll/revm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/revm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+50</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-595fca69ca2af33aa092f8ef"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;revm&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..ee401c34f4fece147bb7ee1cf641e031519864b1</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,50 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-revm&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# revm</span>
<span class="term-fg32">+revm = { version = &quot;18.0.0&quot;, features = [&quot;std&quot;], default-features = false }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# misc</span>
<span class="term-fg32">+serde = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+default = [&quot;std&quot;]</span>
<span class="term-fg32">+dev = [&quot;revm&#47;dev&quot;]</span>
<span class="term-fg32">+arbitrary = [</span>
<span class="term-fg32">+	&quot;revm&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives?&#47;arbitrary&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+asm-keccak = [&quot;revm&#47;asm-keccak&quot;]</span>
<span class="term-fg32">+c-kzg = [&quot;revm&#47;c-kzg&quot;]</span>
<span class="term-fg32">+optimism = [&quot;revm&#47;optimism&quot;]</span>
<span class="term-fg32">+serde = [</span>
<span class="term-fg32">+	&quot;revm&#47;serde&quot;,</span>
<span class="term-fg32">+	&quot;dep:serde&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives?&#47;serde&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [&quot;revm&#47;scroll-poseidon-codehash&quot;, &quot;dep:reth-scroll-primitives&quot;]</span>
<span class="term-fg32">+test-utils = [&quot;revm&#47;test-utils&quot;]</span>
<span class="term-fg32">+std = [</span>
<span class="term-fg32">+	&quot;revm&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;serde?&#47;std&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+blst = [&quot;revm&#47;blst&quot;]</span>
<span class="term-fg32">+optional_block_gas_limit =  [&quot;revm&#47;optional_block_gas_limit&quot;]</span>
<span class="term-fg32">+optional_eip3607 = [&quot;revm&#47;optional_eip3607&quot;]</span>
<span class="term-fg32">+optional_no_base_fee = [&quot;revm&#47;optional_no_base_fee&quot;]</span>
<span class="term-fg32">+secp256k1 = [&quot;revm&#47;secp256k1&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-23f3bc213d42da01a5a54222" role="button"
                       aria-expanded="false" aria-controls="id-23f3bc213d42da01a5a54222">
                        <code>crates/scroll/revm/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/revm/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+81</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-23f3bc213d42da01a5a54222"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..5c4be289a9088650f36d3faacfdbe9ccc886ce48</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,81 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll `revm` types redefinitions. Account types are redefined with two additional fields</span>
<span class="term-fg32">+&#47;&#47;! `code_size` and `poseidon_code_hash`, which are used during computation of the state root.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![warn(unused_crate_dependencies)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;serde&quot;)]</span>
<span class="term-fg32">+use serde as _;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+pub mod states;</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;scroll&quot;, feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+mod test_utils;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+pub use crate::states::ScrollAccountInfo as AccountInfo;</span>
<span class="term-fg32">+#[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+pub use revm::primitives::AccountInfo;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
<span class="term-fg32">+pub use revm::{primitives::OptimismFields, L1BlockInfo, L1_BLOCK_CONTRACT};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use revm::{</span>
<span class="term-fg32">+    db::*,</span>
<span class="term-fg32">+    inspector_handle_register,</span>
<span class="term-fg32">+    primitives::{</span>
<span class="term-fg32">+        keccak256, AuthorizationList, Bytecode, BytecodeDecodeError, JumpTable,</span>
<span class="term-fg32">+        LegacyAnalyzedBytecode, TxEnv, TxKind,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    ContextPrecompile, ContextPrecompiles, Evm, EvmBuilder, EvmContext, GetInspector, Inspector,</span>
<span class="term-fg32">+    JournaledState,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Shared module, available for all feature flags.</span>
<span class="term-fg32">+pub mod shared {</span>
<span class="term-fg32">+    pub use revm::{db::states::BundleState, primitives::AccountInfo};</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod handler {</span>
<span class="term-fg32">+    pub use revm::handler::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod interpreter {</span>
<span class="term-fg32">+    pub use revm::interpreter::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod inspectors {</span>
<span class="term-fg32">+    pub use revm::inspectors::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod precompile {</span>
<span class="term-fg32">+    pub use revm::precompile::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm-primitives` module structure</span>
<span class="term-fg32">+pub mod primitives {</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    pub use crate::states::ScrollAccountInfo as AccountInfo;</span>
<span class="term-fg32">+    pub use revm::primitives::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod db {</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    pub use crate::states::{</span>
<span class="term-fg32">+        ScrollBundleAccount as BundleAccount, ScrollBundleState as BundleState,</span>
<span class="term-fg32">+    };</span>
<span class="term-fg32">+    pub use revm::db::*;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+    pub mod states {</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        pub use crate::states::{</span>
<span class="term-fg32">+            ScrollBundleBuilder as BundleBuilder, ScrollBundleState as BundleState,</span>
<span class="term-fg32">+            ScrollPlainStateReverts as PlainStateReverts, ScrollStateChangeset as StateChangeset,</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        pub use revm::db::states::*;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c1a92551357835f36afe5a00" role="button"
                       aria-expanded="false" aria-controls="id-c1a92551357835f36afe5a00">
                        <code>crates/scroll/revm/src/states/account_info.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/revm/src/states/account_info.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+169</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c1a92551357835f36afe5a00"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;account_info.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;account_info.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..8df6dab900edf37d2dc20702d48827e7d69a07f4</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;account_info.rs</span>
<span class="term-fg36">@@ -0,0 +1,169 @@</span>
<span class="term-fg32">+use reth_scroll_primitives::{</span>
<span class="term-fg32">+    poseidon::{hash_code, POSEIDON_EMPTY},</span>
<span class="term-fg32">+    ScrollPostExecutionContext,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use revm::primitives::{AccountInfo, Bytecode, B256, KECCAK_EMPTY, U256};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The Scroll account information. Code copy of [`AccountInfo`]. Provides additional `code_size`</span>
<span class="term-fg32">+&#47;&#47;&#47; and `poseidon_code_hash` fields needed in the state root computation.</span>
<span class="term-fg32">+#[derive(Clone, Debug, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollAccountInfo {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account balance.</span>
<span class="term-fg32">+    pub balance: U256,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account nonce.</span>
<span class="term-fg32">+    pub nonce: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account code keccak hash.</span>
<span class="term-fg32">+    pub code_hash: B256,</span>
<span class="term-fg32">+    &#47;&#47;&#47; code: if None, `code_by_hash` will be used to fetch it if code needs to be loaded from</span>
<span class="term-fg32">+    &#47;&#47;&#47; inside `revm`.</span>
<span class="term-fg32">+    pub code: Option&lt;Bytecode&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account code size.</span>
<span class="term-fg32">+    pub code_size: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account code Poseidon hash. [`POSEIDON_EMPTY`] if code is None or empty.</span>
<span class="term-fg32">+    pub poseidon_code_hash: B256,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(AccountInfo, &amp;ScrollPostExecutionContext)&gt; for ScrollAccountInfo {</span>
<span class="term-fg32">+    fn from((info, _context): (AccountInfo, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        &#47;&#47; TODO(scroll): uncomment once use of the revm sdk pattern is adopted. Tracked in</span>
<span class="term-fg32">+        &#47;&#47; https:&#47;&#47;github.com&#47;scroll-tech&#47;reth&#47;issues&#47;97</span>
<span class="term-fg32">+        &#47;&#47; let context = context.get(&amp;info.code_hash).copied();</span>
<span class="term-fg32">+        &#47;&#47; let (code_size, poseidon_code_hash) = context</span>
<span class="term-fg32">+        &#47;&#47;     .or_else(|| {</span>
<span class="term-fg32">+        &#47;&#47;         info.code</span>
<span class="term-fg32">+        &#47;&#47;             .as_ref()</span>
<span class="term-fg32">+        &#47;&#47;             .map(|code| (code.len() as u64, hash_code(code.original_byte_slice())))</span>
<span class="term-fg32">+        &#47;&#47;     })</span>
<span class="term-fg32">+        &#47;&#47;     .unwrap_or((0, POSEIDON_EMPTY));</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: info.balance,</span>
<span class="term-fg32">+            nonce: info.nonce,</span>
<span class="term-fg32">+            code_hash: info.code_hash,</span>
<span class="term-fg32">+            code: info.code,</span>
<span class="term-fg32">+            code_size: info.code_size as u64,</span>
<span class="term-fg32">+            poseidon_code_hash: info.poseidon_code_hash,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Default for ScrollAccountInfo {</span>
<span class="term-fg32">+    fn default() -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            code_hash: KECCAK_EMPTY,</span>
<span class="term-fg32">+            code: Some(Bytecode::default()),</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            code_size: 0,</span>
<span class="term-fg32">+            poseidon_code_hash: POSEIDON_EMPTY,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl PartialEq for ScrollAccountInfo {</span>
<span class="term-fg32">+    fn eq(&amp;self, other: &amp;Self) -&gt; bool {</span>
<span class="term-fg32">+        self.balance == other.balance &amp;&amp;</span>
<span class="term-fg32">+            self.nonce == other.nonce &amp;&amp;</span>
<span class="term-fg32">+            self.code_hash == other.code_hash</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollAccountInfo {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates a new [`ScrollAccountInfo`] with the given fields.</span>
<span class="term-fg32">+    pub fn new(</span>
<span class="term-fg32">+        balance: U256,</span>
<span class="term-fg32">+        nonce: u64,</span>
<span class="term-fg32">+        code_hash: B256,</span>
<span class="term-fg32">+        code: Bytecode,</span>
<span class="term-fg32">+        poseidon_code_hash: B256,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        let code_size = code.len() as u64;</span>
<span class="term-fg32">+        Self { balance, nonce, code: Some(code), code_hash, code_size, poseidon_code_hash }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns a copy of this account with the [`Bytecode`] removed. This is</span>
<span class="term-fg32">+    &#47;&#47;&#47; useful when creating journals or snapshots of the state, where it is</span>
<span class="term-fg32">+    &#47;&#47;&#47; desirable to store the code blobs elsewhere.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; ## Note</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; This is distinct from [`ScrollAccountInfo::without_code`] in that it returns</span>
<span class="term-fg32">+    &#47;&#47;&#47; a new `ScrollAccountInfo` instance with the code removed.</span>
<span class="term-fg32">+    &#47;&#47;&#47; [`ScrollAccountInfo::without_code`] will modify and return the same instance.</span>
<span class="term-fg32">+    pub const fn copy_without_code(&amp;self) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: self.balance,</span>
<span class="term-fg32">+            nonce: self.nonce,</span>
<span class="term-fg32">+            code_hash: self.code_hash,</span>
<span class="term-fg32">+            code: None,</span>
<span class="term-fg32">+            code_size: self.code_size,</span>
<span class="term-fg32">+            poseidon_code_hash: self.poseidon_code_hash,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns account info without the code.</span>
<span class="term-fg32">+    pub fn without_code(mut self) -&gt; Self {</span>
<span class="term-fg32">+        self.take_bytecode();</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns if an account is empty.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; An account is empty if the following conditions are met.</span>
<span class="term-fg32">+    &#47;&#47;&#47; - code hash is zero or set to the Keccak256 hash of the empty string `&quot;&quot;`</span>
<span class="term-fg32">+    &#47;&#47;&#47; - balance is zero</span>
<span class="term-fg32">+    &#47;&#47;&#47; - nonce is zero</span>
<span class="term-fg32">+    pub fn is_empty(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        let code_empty = self.is_empty_code_hash() || self.code_hash.is_zero();</span>
<span class="term-fg32">+        code_empty &amp;&amp; self.balance.is_zero() &amp;&amp; self.nonce == 0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns `true` if the account is not empty.</span>
<span class="term-fg32">+    pub fn exists(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        !self.is_empty()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns `true` if account has no nonce and code.</span>
<span class="term-fg32">+    pub fn has_no_code_and_nonce(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.is_empty_code_hash() &amp;&amp; self.nonce == 0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return bytecode hash associated with this account.</span>
<span class="term-fg32">+    &#47;&#47;&#47; If account does not have code, it returns `KECCAK_EMPTY` hash.</span>
<span class="term-fg32">+    pub const fn code_hash(&amp;self) -&gt; B256 {</span>
<span class="term-fg32">+        self.code_hash</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns true if the code hash is the Keccak256 hash of the empty string `&quot;&quot;`.</span>
<span class="term-fg32">+    #[inline]</span>
<span class="term-fg32">+    pub fn is_empty_code_hash(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.code_hash == KECCAK_EMPTY</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Take bytecode from account. Code will be set to None.</span>
<span class="term-fg32">+    pub fn take_bytecode(&amp;mut self) -&gt; Option&lt;Bytecode&gt; {</span>
<span class="term-fg32">+        self.code.take()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns a [`ScrollAccountInfo`] with only balance.</span>
<span class="term-fg32">+    pub fn from_balance(balance: U256) -&gt; Self {</span>
<span class="term-fg32">+        Self { balance, ..Default::default() }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns a [`ScrollAccountInfo`] with defaults for balance and nonce.</span>
<span class="term-fg32">+    &#47;&#47;&#47; Computes the Keccak and Poseidon hash of the provided bytecode.</span>
<span class="term-fg32">+    pub fn from_bytecode(bytecode: Bytecode) -&gt; Self {</span>
<span class="term-fg32">+        let hash = bytecode.hash_slow();</span>
<span class="term-fg32">+        let code_size = bytecode.len() as u64;</span>
<span class="term-fg32">+        let poseidon_code_hash = hash_code(bytecode.bytecode());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            code: Some(bytecode),</span>
<span class="term-fg32">+            code_hash: hash,</span>
<span class="term-fg32">+            code_size,</span>
<span class="term-fg32">+            poseidon_code_hash,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8e06e941f785e6e21664dfe7" role="button"
                       aria-expanded="false" aria-controls="id-8e06e941f785e6e21664dfe7">
                        <code>crates/scroll/revm/src/states/bundle.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/revm/src/states/bundle.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+762</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8e06e941f785e6e21664dfe7"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..172e826fcab345d920eeba54edf1316531b97000</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle.rs</span>
<span class="term-fg36">@@ -0,0 +1,762 @@</span>
<span class="term-fg32">+use super::bundle_account::ScrollBundleAccount;</span>
<span class="term-fg32">+use crate::states::{</span>
<span class="term-fg32">+    changes::{ScrollPlainStateReverts, ScrollStateChangeset},</span>
<span class="term-fg32">+    reverts::ScrollReverts,</span>
<span class="term-fg32">+    ScrollAccountInfo, ScrollAccountInfoRevert, ScrollAccountRevert,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_scroll_primitives::ScrollPostExecutionContext;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::{</span>
<span class="term-fg32">+        states::{PlainStorageChangeset, StorageSlot},</span>
<span class="term-fg32">+        AccountStatus, BundleState, OriginalValuesKnown, RevertToSlot,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    primitives::{</span>
<span class="term-fg32">+        map::{Entry, HashMap, HashSet},</span>
<span class="term-fg32">+        Address, Bytecode, B256, KECCAK_EMPTY, U256,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use std::{</span>
<span class="term-fg32">+    collections::{hash_map, BTreeMap, BTreeSet},</span>
<span class="term-fg32">+    ops::RangeInclusive,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A code copy of the [`BundleState`] modified with Scroll compatible fields.</span>
<span class="term-fg32">+#[derive(Default, Debug, Clone, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollBundleState {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account state.</span>
<span class="term-fg32">+    pub state: HashMap&lt;Address, ScrollBundleAccount&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; All created contracts in this block.</span>
<span class="term-fg32">+    pub contracts: HashMap&lt;B256, Bytecode&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Changes to revert.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Note: Inside vector is *not* sorted by address.</span>
<span class="term-fg32">+    &#47;&#47;&#47; But it is unique by address.</span>
<span class="term-fg32">+    pub reverts: ScrollReverts,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The size of the plain state in the bundle state.</span>
<span class="term-fg32">+    pub state_size: usize,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The size of reverts in the bundle state.</span>
<span class="term-fg32">+    pub reverts_size: usize,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(BundleState, &amp;ScrollPostExecutionContext)&gt; for ScrollBundleState {</span>
<span class="term-fg32">+    fn from((bundle, context): (BundleState, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        &#47;&#47; we need to clone the reverts because there is no way to take ownership of</span>
<span class="term-fg32">+        &#47;&#47; the inner Vec from the `Reverts` wrapper.</span>
<span class="term-fg32">+        let reverts = bundle</span>
<span class="term-fg32">+            .reverts</span>
<span class="term-fg32">+            .iter()</span>
<span class="term-fg32">+            .map(|reverts| {</span>
<span class="term-fg32">+                reverts</span>
<span class="term-fg32">+                    .iter()</span>
<span class="term-fg32">+                    .map(|(add, revert)| (*add, (revert.clone(), context).into()))</span>
<span class="term-fg32">+                    .collect()</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let state = bundle</span>
<span class="term-fg32">+            .state</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|(add, account)| (add, (account, context).into()))</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            state,</span>
<span class="term-fg32">+            contracts: bundle.contracts,</span>
<span class="term-fg32">+            reverts: ScrollReverts::new(reverts),</span>
<span class="term-fg32">+            state_size: bundle.state_size,</span>
<span class="term-fg32">+            reverts_size: bundle.reverts_size,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl From&lt;BundleState&gt; for ScrollBundleState {</span>
<span class="term-fg32">+    fn from(bundle: BundleState) -&gt; Self {</span>
<span class="term-fg32">+        (bundle, &amp;ScrollPostExecutionContext::default()).into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl From&lt;(BundleState, &amp;())&gt; for ScrollBundleState {</span>
<span class="term-fg32">+    fn from((bundle, _): (BundleState, &amp;())) -&gt; Self {</span>
<span class="term-fg32">+        bundle.into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollBundleState {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return builder instance for further manipulation</span>
<span class="term-fg32">+    pub fn builder(revert_range: RangeInclusive&lt;u64&gt;) -&gt; ScrollBundleBuilder {</span>
<span class="term-fg32">+        ScrollBundleBuilder::new(revert_range)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create it with new and old values of both Storage and [`ScrollAccountInfo`].</span>
<span class="term-fg32">+    pub fn new(</span>
<span class="term-fg32">+        state: impl IntoIterator&lt;</span>
<span class="term-fg32">+            Item = (</span>
<span class="term-fg32">+                Address,</span>
<span class="term-fg32">+                Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+                Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+                HashMap&lt;U256, (U256, U256)&gt;,</span>
<span class="term-fg32">+            ),</span>
<span class="term-fg32">+        &gt;,</span>
<span class="term-fg32">+        reverts: impl IntoIterator&lt;</span>
<span class="term-fg32">+            Item = impl IntoIterator&lt;</span>
<span class="term-fg32">+                Item = (</span>
<span class="term-fg32">+                    Address,</span>
<span class="term-fg32">+                    Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;,</span>
<span class="term-fg32">+                    impl IntoIterator&lt;Item = (U256, U256)&gt;,</span>
<span class="term-fg32">+                ),</span>
<span class="term-fg32">+            &gt;,</span>
<span class="term-fg32">+        &gt;,</span>
<span class="term-fg32">+        contracts: impl IntoIterator&lt;Item = (B256, Bytecode)&gt;,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        &#47;&#47; Create state from iterator.</span>
<span class="term-fg32">+        let mut state_size = 0;</span>
<span class="term-fg32">+        let state = state</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|(address, original, present, storage)| {</span>
<span class="term-fg32">+                let account = ScrollBundleAccount::new(</span>
<span class="term-fg32">+                    original,</span>
<span class="term-fg32">+                    present,</span>
<span class="term-fg32">+                    storage</span>
<span class="term-fg32">+                        .into_iter()</span>
<span class="term-fg32">+                        .map(|(k, (o_val, p_val))| (k, StorageSlot::new_changed(o_val, p_val)))</span>
<span class="term-fg32">+                        .collect(),</span>
<span class="term-fg32">+                    AccountStatus::Changed,</span>
<span class="term-fg32">+                );</span>
<span class="term-fg32">+                state_size += account.size_hint();</span>
<span class="term-fg32">+                (address, account)</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; Create reverts from iterator.</span>
<span class="term-fg32">+        let mut reverts_size = 0;</span>
<span class="term-fg32">+        let reverts = reverts</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|block_reverts| {</span>
<span class="term-fg32">+                block_reverts</span>
<span class="term-fg32">+                    .into_iter()</span>
<span class="term-fg32">+                    .map(|(address, account, storage)| {</span>
<span class="term-fg32">+                        let account = match account {</span>
<span class="term-fg32">+                            Some(Some(account)) =&gt; ScrollAccountInfoRevert::RevertTo(account),</span>
<span class="term-fg32">+                            Some(None) =&gt; ScrollAccountInfoRevert::DeleteIt,</span>
<span class="term-fg32">+                            None =&gt; ScrollAccountInfoRevert::DoNothing,</span>
<span class="term-fg32">+                        };</span>
<span class="term-fg32">+                        let revert = ScrollAccountRevert {</span>
<span class="term-fg32">+                            account,</span>
<span class="term-fg32">+                            storage: storage</span>
<span class="term-fg32">+                                .into_iter()</span>
<span class="term-fg32">+                                .map(|(k, v)| (k, RevertToSlot::Some(v)))</span>
<span class="term-fg32">+                                .collect(),</span>
<span class="term-fg32">+                            previous_status: AccountStatus::Changed,</span>
<span class="term-fg32">+                            wipe_storage: false,</span>
<span class="term-fg32">+                        };</span>
<span class="term-fg32">+                        reverts_size += revert.size_hint();</span>
<span class="term-fg32">+                        (address, revert)</span>
<span class="term-fg32">+                    })</span>
<span class="term-fg32">+                    .collect::&lt;Vec&lt;_&gt;&gt;()</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect::&lt;Vec&lt;_&gt;&gt;();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            state,</span>
<span class="term-fg32">+            contracts: contracts.into_iter().collect(),</span>
<span class="term-fg32">+            reverts: ScrollReverts::new(reverts),</span>
<span class="term-fg32">+            state_size,</span>
<span class="term-fg32">+            reverts_size,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the approximate size of changes in the bundle state.</span>
<span class="term-fg32">+    &#47;&#47;&#47; The estimation is not precise, because the information about the number of</span>
<span class="term-fg32">+    &#47;&#47;&#47; destroyed entries that need to be removed is not accessible to the bundle state.</span>
<span class="term-fg32">+    pub fn size_hint(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.state_size + self.reverts_size + self.contracts.len()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return reference to the state.</span>
<span class="term-fg32">+    pub const fn state(&amp;self) -&gt; &amp;HashMap&lt;Address, ScrollBundleAccount&gt; {</span>
<span class="term-fg32">+        &amp;self.state</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Is bundle state empty.</span>
<span class="term-fg32">+    pub fn is_empty(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.len() == 0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return number of changed accounts.</span>
<span class="term-fg32">+    pub fn len(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.state.len()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Get account from state</span>
<span class="term-fg32">+    pub fn account(&amp;self, address: &amp;Address) -&gt; Option&lt;&amp;ScrollBundleAccount&gt; {</span>
<span class="term-fg32">+        self.state.get(address)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Get bytecode from state</span>
<span class="term-fg32">+    pub fn bytecode(&amp;self, hash: &amp;B256) -&gt; Option&lt;Bytecode&gt; {</span>
<span class="term-fg32">+        self.contracts.get(hash).cloned()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Extend the bundle with other state</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Update the `other` state only if `other` is not flagged as destroyed.</span>
<span class="term-fg32">+    pub fn extend_state(&amp;mut self, other_state: HashMap&lt;Address, ScrollBundleAccount&gt;) {</span>
<span class="term-fg32">+        for (address, other_account) in other_state {</span>
<span class="term-fg32">+            match self.state.entry(address) {</span>
<span class="term-fg32">+                Entry::Occupied(mut entry) =&gt; {</span>
<span class="term-fg32">+                    let this = entry.get_mut();</span>
<span class="term-fg32">+                    self.state_size -= this.size_hint();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                    &#47;&#47; if other was destroyed. replace `this` storage with</span>
<span class="term-fg32">+                    &#47;&#47; the `other one.</span>
<span class="term-fg32">+                    if other_account.was_destroyed() {</span>
<span class="term-fg32">+                        this.storage = other_account.storage;</span>
<span class="term-fg32">+                    } else {</span>
<span class="term-fg32">+                        &#47;&#47; otherwise extend this storage with other</span>
<span class="term-fg32">+                        for (key, storage_slot) in other_account.storage {</span>
<span class="term-fg32">+                            &#47;&#47; update present value or insert storage slot.</span>
<span class="term-fg32">+                            this.storage.entry(key).or_insert(storage_slot).present_value =</span>
<span class="term-fg32">+                                storage_slot.present_value;</span>
<span class="term-fg32">+                        }</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                    this.info = other_account.info;</span>
<span class="term-fg32">+                    this.status.transition(other_account.status);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                    &#47;&#47; Update the state size</span>
<span class="term-fg32">+                    self.state_size += this.size_hint();</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                hash_map::Entry::Vacant(entry) =&gt; {</span>
<span class="term-fg32">+                    &#47;&#47; just insert if empty</span>
<span class="term-fg32">+                    self.state_size += other_account.size_hint();</span>
<span class="term-fg32">+                    entry.insert(other_account);</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Extend the state with state that is build on top of it.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; If storage was wiped in `other` state, copy `this` plain state</span>
<span class="term-fg32">+    &#47;&#47;&#47; and put it inside `other` revert (if there is no duplicates of course).</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; If `this` and `other` accounts were both destroyed invalidate second</span>
<span class="term-fg32">+    &#47;&#47;&#47; wipe flag (from `other`). As wiping from database should be done only once</span>
<span class="term-fg32">+    &#47;&#47;&#47; and we already transferred all potentially missing storages to the `other` revert.</span>
<span class="term-fg32">+    pub fn extend(&amp;mut self, mut other: Self) {</span>
<span class="term-fg32">+        &#47;&#47; iterate over reverts and if its storage is wiped try to add previous bundle</span>
<span class="term-fg32">+        &#47;&#47; state as there is potential missing slots.</span>
<span class="term-fg32">+        for (address, revert) in other.reverts.iter_mut().flatten() {</span>
<span class="term-fg32">+            if revert.wipe_storage {</span>
<span class="term-fg32">+                &#47;&#47; If there is wipe storage in `other` revert</span>
<span class="term-fg32">+                &#47;&#47; we need to move storage from present state.</span>
<span class="term-fg32">+                if let Some(this_account) = self.state.get_mut(address) {</span>
<span class="term-fg32">+                    &#47;&#47; As this account was destroyed inside `other` bundle.</span>
<span class="term-fg32">+                    &#47;&#47; we are fine to wipe&#47;drain this storage and put it inside revert.</span>
<span class="term-fg32">+                    for (key, value) in this_account.storage.drain() {</span>
<span class="term-fg32">+                        revert</span>
<span class="term-fg32">+                            .storage</span>
<span class="term-fg32">+                            .entry(key)</span>
<span class="term-fg32">+                            .or_insert(RevertToSlot::Some(value.present_value));</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                    &#47;&#47; nullify `other` wipe as primary database wipe is done in `this`.</span>
<span class="term-fg32">+                    if this_account.was_destroyed() {</span>
<span class="term-fg32">+                        revert.wipe_storage = false;</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; Increment reverts size for each of the updated reverts.</span>
<span class="term-fg32">+            self.reverts_size += revert.size_hint();</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        &#47;&#47; Extension of state</span>
<span class="term-fg32">+        self.extend_state(other.state);</span>
<span class="term-fg32">+        &#47;&#47; Contract can be just extended, when counter is introduced we will take into account that.</span>
<span class="term-fg32">+        self.contracts.extend(other.contracts);</span>
<span class="term-fg32">+        &#47;&#47; Reverts can be just extended</span>
<span class="term-fg32">+        self.reverts.extend(other.reverts);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Generate a [`ScrollStateChangeset`] from the bundle state without consuming</span>
<span class="term-fg32">+    &#47;&#47;&#47; it.</span>
<span class="term-fg32">+    pub fn to_plain_state(&amp;self, is_value_known: OriginalValuesKnown) -&gt; ScrollStateChangeset {</span>
<span class="term-fg32">+        &#47;&#47; pessimistically pre-allocate assuming _all_ accounts changed.</span>
<span class="term-fg32">+        let state_len = self.state.len();</span>
<span class="term-fg32">+        let mut accounts = Vec::with_capacity(state_len);</span>
<span class="term-fg32">+        let mut storage = Vec::with_capacity(state_len);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        for (address, account) in &amp;self.state {</span>
<span class="term-fg32">+            &#47;&#47; append account info if it is changed.</span>
<span class="term-fg32">+            let was_destroyed = account.was_destroyed();</span>
<span class="term-fg32">+            if is_value_known.is_not_known() || account.is_info_changed() {</span>
<span class="term-fg32">+                let info = account.info.as_ref().map(ScrollAccountInfo::copy_without_code);</span>
<span class="term-fg32">+                accounts.push((*address, info));</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; append storage changes</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; NOTE: Assumption is that revert is going to remove whole plain storage from</span>
<span class="term-fg32">+            &#47;&#47; database so we can check if plain state was wiped or not.</span>
<span class="term-fg32">+            let mut account_storage_changed = Vec::with_capacity(account.storage.len());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            for (key, slot) in account.storage.iter().map(|(k, v)| (*k, *v)) {</span>
<span class="term-fg32">+                &#47;&#47; If storage was destroyed that means that storage was wiped.</span>
<span class="term-fg32">+                &#47;&#47; In that case we need to check if present storage value is different then ZERO.</span>
<span class="term-fg32">+                let destroyed_and_not_zero = was_destroyed &amp;&amp; !slot.present_value.is_zero();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                &#47;&#47; If account is not destroyed check if original values was changed,</span>
<span class="term-fg32">+                &#47;&#47; so we can update it.</span>
<span class="term-fg32">+                let not_destroyed_and_changed = !was_destroyed &amp;&amp; slot.is_changed();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                if is_value_known.is_not_known() ||</span>
<span class="term-fg32">+                    destroyed_and_not_zero ||</span>
<span class="term-fg32">+                    not_destroyed_and_changed</span>
<span class="term-fg32">+                {</span>
<span class="term-fg32">+                    account_storage_changed.push((key, slot.present_value));</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            if !account_storage_changed.is_empty() || was_destroyed {</span>
<span class="term-fg32">+                &#47;&#47; append storage changes to account.</span>
<span class="term-fg32">+                storage.push(PlainStorageChangeset {</span>
<span class="term-fg32">+                    address: *address,</span>
<span class="term-fg32">+                    wipe_storage: was_destroyed,</span>
<span class="term-fg32">+                    storage: account_storage_changed,</span>
<span class="term-fg32">+                });</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let contracts = self</span>
<span class="term-fg32">+            .contracts</span>
<span class="term-fg32">+            .iter()</span>
<span class="term-fg32">+            &#47;&#47; remove empty bytecodes</span>
<span class="term-fg32">+            .filter(|(b, _)| **b != KECCAK_EMPTY)</span>
<span class="term-fg32">+            .map(|(b, code)| (*b, code.clone()))</span>
<span class="term-fg32">+            .collect::&lt;Vec&lt;_&gt;&gt;();</span>
<span class="term-fg32">+        ScrollStateChangeset { accounts, storage, contracts }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Generate a [`ScrollStateChangeset`] and [`ScrollPlainStateReverts`] from the bundle</span>
<span class="term-fg32">+    &#47;&#47;&#47; state.</span>
<span class="term-fg32">+    pub fn to_plain_state_and_reverts(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        is_value_known: OriginalValuesKnown,</span>
<span class="term-fg32">+    ) -&gt; (ScrollStateChangeset, ScrollPlainStateReverts) {</span>
<span class="term-fg32">+        (self.to_plain_state(is_value_known), self.reverts.to_plain_state_reverts())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Take first N raw reverts from the [`ScrollBundleState`].</span>
<span class="term-fg32">+    pub fn take_n_reverts(&amp;mut self, reverts_to_take: usize) -&gt; ScrollReverts {</span>
<span class="term-fg32">+        &#47;&#47; split is done as [0, num) and [num, len].</span>
<span class="term-fg32">+        if reverts_to_take &gt; self.reverts.len() {</span>
<span class="term-fg32">+            return self.take_all_reverts();</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        let (detach, this) = self.reverts.split_at(reverts_to_take);</span>
<span class="term-fg32">+        let detached_reverts = ScrollReverts::new(detach.to_vec());</span>
<span class="term-fg32">+        self.reverts_size =</span>
<span class="term-fg32">+            this.iter().flatten().fold(0, |acc, (_, revert)| acc + revert.size_hint());</span>
<span class="term-fg32">+        self.reverts = ScrollReverts::new(this.to_vec());</span>
<span class="term-fg32">+        detached_reverts</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return and clear all reverts from [`ScrollBundleState`]</span>
<span class="term-fg32">+    pub fn take_all_reverts(&amp;mut self) -&gt; ScrollReverts {</span>
<span class="term-fg32">+        self.reverts_size = 0;</span>
<span class="term-fg32">+        core::mem::take(&amp;mut self.reverts)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Reverts the state changes by N transitions back.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; See also [`Self::revert_latest`]</span>
<span class="term-fg32">+    pub fn revert(&amp;mut self, mut num_transitions: usize) {</span>
<span class="term-fg32">+        if num_transitions == 0 {</span>
<span class="term-fg32">+            return;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        while self.revert_latest() {</span>
<span class="term-fg32">+            num_transitions -= 1;</span>
<span class="term-fg32">+            if num_transitions == 0 {</span>
<span class="term-fg32">+                &#47;&#47; break the loop.</span>
<span class="term-fg32">+                break;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Reverts the state changes of the latest transition</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Note: This is the same as `BundleState::revert(1)`</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns true if the state was reverted.</span>
<span class="term-fg32">+    pub fn revert_latest(&amp;mut self) -&gt; bool {</span>
<span class="term-fg32">+        &#47;&#47; revert the latest recorded state</span>
<span class="term-fg32">+        if let Some(reverts) = self.reverts.pop() {</span>
<span class="term-fg32">+            for (address, revert_account) in reverts {</span>
<span class="term-fg32">+                self.reverts_size -= revert_account.size_hint();</span>
<span class="term-fg32">+                match self.state.entry(address) {</span>
<span class="term-fg32">+                    Entry::Occupied(mut entry) =&gt; {</span>
<span class="term-fg32">+                        let account = entry.get_mut();</span>
<span class="term-fg32">+                        self.state_size -= account.size_hint();</span>
<span class="term-fg32">+                        if account.revert(revert_account) {</span>
<span class="term-fg32">+                            entry.remove();</span>
<span class="term-fg32">+                        } else {</span>
<span class="term-fg32">+                            self.state_size += account.size_hint();</span>
<span class="term-fg32">+                        }</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                    Entry::Vacant(entry) =&gt; {</span>
<span class="term-fg32">+                        &#47;&#47; create empty account that we will revert on.</span>
<span class="term-fg32">+                        &#47;&#47; Only place where this account is not existing is if revert is DeleteIt.</span>
<span class="term-fg32">+                        let mut account = ScrollBundleAccount::new(</span>
<span class="term-fg32">+                            None,</span>
<span class="term-fg32">+                            None,</span>
<span class="term-fg32">+                            HashMap::default(),</span>
<span class="term-fg32">+                            AccountStatus::LoadedNotExisting,</span>
<span class="term-fg32">+                        );</span>
<span class="term-fg32">+                        if !account.revert(revert_account) {</span>
<span class="term-fg32">+                            self.state_size += account.size_hint();</span>
<span class="term-fg32">+                            entry.insert(account);</span>
<span class="term-fg32">+                        }</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            return true;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        false</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; This builder is used to help to facilitate the initialization of [`ScrollBundleState`] struct.</span>
<span class="term-fg32">+&#47;&#47;&#47; This is a code copy of the [`revm::db::states::BundleBuilder`] to accommodate the</span>
<span class="term-fg32">+&#47;&#47;&#47; [`ScrollBundleState`].</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct ScrollBundleBuilder {</span>
<span class="term-fg32">+    states: HashSet&lt;Address&gt;,</span>
<span class="term-fg32">+    state_original: HashMap&lt;Address, ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+    state_present: HashMap&lt;Address, ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+    state_storage: HashMap&lt;Address, HashMap&lt;U256, (U256, U256)&gt;&gt;,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    reverts: BTreeSet&lt;(u64, Address)&gt;,</span>
<span class="term-fg32">+    revert_range: RangeInclusive&lt;u64&gt;,</span>
<span class="term-fg32">+    revert_account: HashMap&lt;(u64, Address), Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;&gt;,</span>
<span class="term-fg32">+    revert_storage: HashMap&lt;(u64, Address), Vec&lt;(U256, U256)&gt;&gt;,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    contracts: HashMap&lt;B256, Bytecode&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Default for ScrollBundleBuilder {</span>
<span class="term-fg32">+    fn default() -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            states: HashSet::default(),</span>
<span class="term-fg32">+            state_original: HashMap::default(),</span>
<span class="term-fg32">+            state_present: HashMap::default(),</span>
<span class="term-fg32">+            state_storage: HashMap::default(),</span>
<span class="term-fg32">+            reverts: BTreeSet::new(),</span>
<span class="term-fg32">+            revert_range: 0..=0,</span>
<span class="term-fg32">+            revert_account: HashMap::default(),</span>
<span class="term-fg32">+            revert_storage: HashMap::default(),</span>
<span class="term-fg32">+            contracts: HashMap::default(),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollBundleBuilder {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create builder instance</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; `revert_range` indicates the size of [`ScrollBundleState`] `reverts` field</span>
<span class="term-fg32">+    pub fn new(revert_range: RangeInclusive&lt;u64&gt;) -&gt; Self {</span>
<span class="term-fg32">+        Self { revert_range, ..Default::default() }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Apply a transformation to the builder.</span>
<span class="term-fg32">+    pub fn apply&lt;F&gt;(self, f: F) -&gt; Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        F: FnOnce(Self) -&gt; Self,</span>
<span class="term-fg32">+    {</span>
<span class="term-fg32">+        f(self)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Apply a mutable transformation to the builder.</span>
<span class="term-fg32">+    pub fn apply_mut&lt;F&gt;(&amp;mut self, f: F) -&gt; &amp;mut Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        F: FnOnce(&amp;mut Self),</span>
<span class="term-fg32">+    {</span>
<span class="term-fg32">+        f(self);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect address info of [`ScrollBundleState`] state</span>
<span class="term-fg32">+    pub fn state_address(mut self, address: Address) -&gt; Self {</span>
<span class="term-fg32">+        self.set_state_address(address);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect account info of [`ScrollBundleState`] state</span>
<span class="term-fg32">+    pub fn state_original_account_info(</span>
<span class="term-fg32">+        mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        original: ScrollAccountInfo,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        self.set_state_original_account_info(address, original);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect account info of [`ScrollBundleState`] state</span>
<span class="term-fg32">+    pub fn state_present_account_info(</span>
<span class="term-fg32">+        mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        present: ScrollAccountInfo,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        self.set_state_present_account_info(address, present);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect storage info of [`ScrollBundleState`] state</span>
<span class="term-fg32">+    pub fn state_storage(mut self, address: Address, storage: HashMap&lt;U256, (U256, U256)&gt;) -&gt; Self {</span>
<span class="term-fg32">+        self.set_state_storage(address, storage);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect address info of [`ScrollBundleState`] reverts</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; `block_number` must respect `revert_range`, or the input</span>
<span class="term-fg32">+    &#47;&#47;&#47; will be ignored during the final build process</span>
<span class="term-fg32">+    pub fn revert_address(mut self, block_number: u64, address: Address) -&gt; Self {</span>
<span class="term-fg32">+        self.set_revert_address(block_number, address);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect account info of [`ScrollBundleState`] reverts</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; `block_number` must respect `revert_range`, or the input</span>
<span class="term-fg32">+    &#47;&#47;&#47; will be ignored during the final build process</span>
<span class="term-fg32">+    pub fn revert_account_info(</span>
<span class="term-fg32">+        mut self,</span>
<span class="term-fg32">+        block_number: u64,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        account: Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        self.set_revert_account_info(block_number, address, account);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect storage info of [`ScrollBundleState`] reverts</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; `block_number` must respect `revert_range`, or the input</span>
<span class="term-fg32">+    &#47;&#47;&#47; will be ignored during the final build process</span>
<span class="term-fg32">+    pub fn revert_storage(</span>
<span class="term-fg32">+        mut self,</span>
<span class="term-fg32">+        block_number: u64,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        storage: Vec&lt;(U256, U256)&gt;,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        self.set_revert_storage(block_number, address, storage);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect contracts info</span>
<span class="term-fg32">+    pub fn contract(mut self, address: B256, bytecode: Bytecode) -&gt; Self {</span>
<span class="term-fg32">+        self.set_contract(address, bytecode);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set address info of [`ScrollBundleState`] state.</span>
<span class="term-fg32">+    pub fn set_state_address(&amp;mut self, address: Address) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.states.insert(address);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set original account info of [`ScrollBundleState`] state.</span>
<span class="term-fg32">+    pub fn set_state_original_account_info(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        original: ScrollAccountInfo,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.states.insert(address);</span>
<span class="term-fg32">+        self.state_original.insert(address, original);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set present account info of [`ScrollBundleState`] state.</span>
<span class="term-fg32">+    pub fn set_state_present_account_info(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        present: ScrollAccountInfo,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.states.insert(address);</span>
<span class="term-fg32">+        self.state_present.insert(address, present);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set storage info of [`ScrollBundleState`] state.</span>
<span class="term-fg32">+    pub fn set_state_storage(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        storage: HashMap&lt;U256, (U256, U256)&gt;,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.states.insert(address);</span>
<span class="term-fg32">+        self.state_storage.insert(address, storage);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set address info of [`ScrollBundleState`] reverts.</span>
<span class="term-fg32">+    pub fn set_revert_address(&amp;mut self, block_number: u64, address: Address) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.reverts.insert((block_number, address));</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set account info of [`ScrollBundleState`] reverts.</span>
<span class="term-fg32">+    pub fn set_revert_account_info(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        block_number: u64,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        account: Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.reverts.insert((block_number, address));</span>
<span class="term-fg32">+        self.revert_account.insert((block_number, address), account);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set storage info of [`ScrollBundleState`] reverts.</span>
<span class="term-fg32">+    pub fn set_revert_storage(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        block_number: u64,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        storage: Vec&lt;(U256, U256)&gt;,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.reverts.insert((block_number, address));</span>
<span class="term-fg32">+        self.revert_storage.insert((block_number, address), storage);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set contracts info.</span>
<span class="term-fg32">+    pub fn set_contract(&amp;mut self, address: B256, bytecode: Bytecode) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.contracts.insert(address, bytecode);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create [`ScrollBundleState`] instance based on collected information</span>
<span class="term-fg32">+    pub fn build(mut self) -&gt; ScrollBundleState {</span>
<span class="term-fg32">+        let mut state_size = 0;</span>
<span class="term-fg32">+        let state = self</span>
<span class="term-fg32">+            .states</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|address| {</span>
<span class="term-fg32">+                let storage = self</span>
<span class="term-fg32">+                    .state_storage</span>
<span class="term-fg32">+                    .remove(&amp;address)</span>
<span class="term-fg32">+                    .map(|s| {</span>
<span class="term-fg32">+                        s.into_iter()</span>
<span class="term-fg32">+                            .map(|(k, (o_val, p_val))| (k, StorageSlot::new_changed(o_val, p_val)))</span>
<span class="term-fg32">+                            .collect()</span>
<span class="term-fg32">+                    })</span>
<span class="term-fg32">+                    .unwrap_or_default();</span>
<span class="term-fg32">+                let bundle_account = ScrollBundleAccount::new(</span>
<span class="term-fg32">+                    self.state_original.remove(&amp;address),</span>
<span class="term-fg32">+                    self.state_present.remove(&amp;address),</span>
<span class="term-fg32">+                    storage,</span>
<span class="term-fg32">+                    AccountStatus::Changed,</span>
<span class="term-fg32">+                );</span>
<span class="term-fg32">+                state_size += bundle_account.size_hint();</span>
<span class="term-fg32">+                (address, bundle_account)</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut reverts_size = 0;</span>
<span class="term-fg32">+        let mut reverts_map = BTreeMap::new();</span>
<span class="term-fg32">+        for block_number in self.revert_range {</span>
<span class="term-fg32">+            reverts_map.insert(block_number, Vec::new());</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        self.reverts.into_iter().for_each(|(block_number, address)| {</span>
<span class="term-fg32">+            let account =</span>
<span class="term-fg32">+                match self.revert_account.remove(&amp;(block_number, address)).unwrap_or_default() {</span>
<span class="term-fg32">+                    Some(Some(account)) =&gt; ScrollAccountInfoRevert::RevertTo(account),</span>
<span class="term-fg32">+                    Some(None) =&gt; ScrollAccountInfoRevert::DeleteIt,</span>
<span class="term-fg32">+                    None =&gt; ScrollAccountInfoRevert::DoNothing,</span>
<span class="term-fg32">+                };</span>
<span class="term-fg32">+            let storage = self</span>
<span class="term-fg32">+                .revert_storage</span>
<span class="term-fg32">+                .remove(&amp;(block_number, address))</span>
<span class="term-fg32">+                .map(|s| s.into_iter().map(|(k, v)| (k, RevertToSlot::Some(v))).collect())</span>
<span class="term-fg32">+                .unwrap_or_default();</span>
<span class="term-fg32">+            let account_revert = ScrollAccountRevert {</span>
<span class="term-fg32">+                account,</span>
<span class="term-fg32">+                storage,</span>
<span class="term-fg32">+                previous_status: AccountStatus::Changed,</span>
<span class="term-fg32">+                wipe_storage: false,</span>
<span class="term-fg32">+            };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            if reverts_map.contains_key(&amp;block_number) {</span>
<span class="term-fg32">+                reverts_size += account_revert.size_hint();</span>
<span class="term-fg32">+                reverts_map</span>
<span class="term-fg32">+                    .entry(block_number)</span>
<span class="term-fg32">+                    .or_insert(Vec::new())</span>
<span class="term-fg32">+                    .push((address, account_revert));</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        });</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        ScrollBundleState {</span>
<span class="term-fg32">+            state,</span>
<span class="term-fg32">+            contracts: self.contracts,</span>
<span class="term-fg32">+            reverts: ScrollReverts::new(reverts_map.into_values().collect()),</span>
<span class="term-fg32">+            state_size,</span>
<span class="term-fg32">+            reverts_size,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Getter for `states` field</span>
<span class="term-fg32">+    pub const fn get_states(&amp;self) -&gt; &amp;HashSet&lt;Address&gt; {</span>
<span class="term-fg32">+        &amp;self.states</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `states` field</span>
<span class="term-fg32">+    pub fn get_states_mut(&amp;mut self) -&gt; &amp;mut HashSet&lt;Address&gt; {</span>
<span class="term-fg32">+        &amp;mut self.states</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `state_original` field</span>
<span class="term-fg32">+    pub fn get_state_original_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;Address, ScrollAccountInfo&gt; {</span>
<span class="term-fg32">+        &amp;mut self.state_original</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `state_present` field</span>
<span class="term-fg32">+    pub fn get_state_present_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;Address, ScrollAccountInfo&gt; {</span>
<span class="term-fg32">+        &amp;mut self.state_present</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `state_storage` field</span>
<span class="term-fg32">+    pub fn get_state_storage_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;Address, HashMap&lt;U256, (U256, U256)&gt;&gt; {</span>
<span class="term-fg32">+        &amp;mut self.state_storage</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `reverts` field</span>
<span class="term-fg32">+    pub fn get_reverts_mut(&amp;mut self) -&gt; &amp;mut BTreeSet&lt;(u64, Address)&gt; {</span>
<span class="term-fg32">+        &amp;mut self.reverts</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `revert_range` field</span>
<span class="term-fg32">+    pub fn get_revert_range_mut(&amp;mut self) -&gt; &amp;mut RangeInclusive&lt;u64&gt; {</span>
<span class="term-fg32">+        &amp;mut self.revert_range</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `revert_account` field</span>
<span class="term-fg32">+    pub fn get_revert_account_mut(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut HashMap&lt;(u64, Address), Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;&gt; {</span>
<span class="term-fg32">+        &amp;mut self.revert_account</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `revert_storage` field</span>
<span class="term-fg32">+    pub fn get_revert_storage_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;(u64, Address), Vec&lt;(U256, U256)&gt;&gt; {</span>
<span class="term-fg32">+        &amp;mut self.revert_storage</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `contracts` field</span>
<span class="term-fg32">+    pub fn get_contracts_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;B256, Bytecode&gt; {</span>
<span class="term-fg32">+        &amp;mut self.contracts</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-db225660422a8be729a471aa" role="button"
                       aria-expanded="false" aria-controls="id-db225660422a8be729a471aa">
                        <code>crates/scroll/revm/src/states/bundle_account.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/revm/src/states/bundle_account.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+130</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-db225660422a8be729a471aa"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle_account.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle_account.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..29be890314d719b72b67dcb41e3375334d2777ce</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle_account.rs</span>
<span class="term-fg36">@@ -0,0 +1,130 @@</span>
<span class="term-fg32">+use crate::states::{ScrollAccountInfo, ScrollAccountInfoRevert, ScrollAccountRevert};</span>
<span class="term-fg32">+use reth_scroll_primitives::ScrollPostExecutionContext;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::{</span>
<span class="term-fg32">+        states::StorageSlot, AccountStatus, BundleAccount, RevertToSlot, StorageWithOriginalValues,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    interpreter::primitives::U256,</span>
<span class="term-fg32">+    primitives::map::HashMap,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The scroll account bundle. Originally defined in [`BundleAccount`], a</span>
<span class="term-fg32">+&#47;&#47;&#47; scroll version of the bundle is needed for the [`crate::states::ScrollBundleState`].</span>
<span class="term-fg32">+#[derive(Debug, Clone, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollBundleAccount {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The current account&#39;s information</span>
<span class="term-fg32">+    pub info: Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The original account&#39;s information</span>
<span class="term-fg32">+    pub original_info: Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Contains both original and present state.</span>
<span class="term-fg32">+    &#47;&#47;&#47; When extracting changeset we compare if original value is different from present value.</span>
<span class="term-fg32">+    &#47;&#47;&#47; If it is different we add it to changeset.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; If Account was destroyed we ignore original value and compare present state with</span>
<span class="term-fg32">+    &#47;&#47;&#47; [`U256::ZERO`].</span>
<span class="term-fg32">+    pub storage: StorageWithOriginalValues,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account status.</span>
<span class="term-fg32">+    pub status: AccountStatus,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(BundleAccount, &amp;ScrollPostExecutionContext)&gt; for ScrollBundleAccount {</span>
<span class="term-fg32">+    fn from((account, context): (BundleAccount, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        let info = account.info.map(|info| (info, context).into());</span>
<span class="term-fg32">+        let original_info = account.original_info.map(|info| (info, context).into());</span>
<span class="term-fg32">+        Self { info, original_info, storage: account.storage, status: account.status }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollBundleAccount {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates a [`ScrollBundleAccount`].</span>
<span class="term-fg32">+    pub const fn new(</span>
<span class="term-fg32">+        original_info: Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+        present_info: Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+        storage: StorageWithOriginalValues,</span>
<span class="term-fg32">+        status: AccountStatus,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        Self { info: present_info, original_info, storage, status }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; The approximate size of changes needed to store this account.</span>
<span class="term-fg32">+    &#47;&#47;&#47; `1 + storage_len`</span>
<span class="term-fg32">+    pub fn size_hint(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        1 + self.storage.len()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return storage slot if it exists.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; In case we know that account is newly created or destroyed, return `Some(U256::ZERO)`</span>
<span class="term-fg32">+    pub fn storage_slot(&amp;self, slot: U256) -&gt; Option&lt;U256&gt; {</span>
<span class="term-fg32">+        let slot = self.storage.get(&amp;slot).map(|s| s.present_value);</span>
<span class="term-fg32">+        if slot.is_some() {</span>
<span class="term-fg32">+            slot</span>
<span class="term-fg32">+        } else if self.status.is_storage_known() {</span>
<span class="term-fg32">+            Some(U256::ZERO)</span>
<span class="term-fg32">+        } else {</span>
<span class="term-fg32">+            None</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Fetch account info if it exists.</span>
<span class="term-fg32">+    pub fn account_info(&amp;self) -&gt; Option&lt;ScrollAccountInfo&gt; {</span>
<span class="term-fg32">+        self.info.clone()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Was this account destroyed.</span>
<span class="term-fg32">+    pub fn was_destroyed(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.status.was_destroyed()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return true of account info was changed.</span>
<span class="term-fg32">+    pub fn is_info_changed(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.info != self.original_info</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return true if contract was changed</span>
<span class="term-fg32">+    pub fn is_contract_changed(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.info.as_ref().map(|a| a.code_hash) != self.original_info.as_ref().map(|a| a.code_hash)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Revert account to previous state and return true if account can be removed.</span>
<span class="term-fg32">+    pub fn revert(&amp;mut self, revert: ScrollAccountRevert) -&gt; bool {</span>
<span class="term-fg32">+        self.status = revert.previous_status;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        match revert.account {</span>
<span class="term-fg32">+            ScrollAccountInfoRevert::DoNothing =&gt; (),</span>
<span class="term-fg32">+            ScrollAccountInfoRevert::DeleteIt =&gt; {</span>
<span class="term-fg32">+                self.info = None;</span>
<span class="term-fg32">+                if self.original_info.is_none() {</span>
<span class="term-fg32">+                    self.storage = HashMap::default();</span>
<span class="term-fg32">+                    return true;</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                &#47;&#47; set all storage to zero but preserve original values.</span>
<span class="term-fg32">+                self.storage.iter_mut().for_each(|(_, v)| {</span>
<span class="term-fg32">+                    v.present_value = U256::ZERO;</span>
<span class="term-fg32">+                });</span>
<span class="term-fg32">+                return false;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            ScrollAccountInfoRevert::RevertTo(info) =&gt; self.info = Some(info),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        &#47;&#47; revert storage</span>
<span class="term-fg32">+        for (key, slot) in revert.storage {</span>
<span class="term-fg32">+            match slot {</span>
<span class="term-fg32">+                RevertToSlot::Some(value) =&gt; {</span>
<span class="term-fg32">+                    &#47;&#47; Don&#39;t overwrite original values if present</span>
<span class="term-fg32">+                    &#47;&#47; if storage is not present set original value as current value.</span>
<span class="term-fg32">+                    self.storage</span>
<span class="term-fg32">+                        .entry(key)</span>
<span class="term-fg32">+                        .or_insert_with(|| StorageSlot::new(value))</span>
<span class="term-fg32">+                        .present_value = value;</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                RevertToSlot::Destroyed =&gt; {</span>
<span class="term-fg32">+                    &#47;&#47; if it was destroyed this means that storage was created and we need to remove</span>
<span class="term-fg32">+                    &#47;&#47; it.</span>
<span class="term-fg32">+                    self.storage.remove(&amp;key);</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        false</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7f51852b7f571ed577cf08c6" role="button"
                       aria-expanded="false" aria-controls="id-7f51852b7f571ed577cf08c6">
                        <code>crates/scroll/revm/src/states/changes.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/revm/src/states/changes.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+67</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7f51852b7f571ed577cf08c6"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;changes.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;changes.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..5343d47c9e03b1be347c872d2cc38ea67a1c5972</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;changes.rs</span>
<span class="term-fg36">@@ -0,0 +1,67 @@</span>
<span class="term-fg32">+use crate::states::ScrollAccountInfo;</span>
<span class="term-fg32">+use reth_scroll_primitives::ScrollPostExecutionContext;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::states::{PlainStateReverts, PlainStorageChangeset, PlainStorageRevert, StateChangeset},</span>
<span class="term-fg32">+    primitives::{Address, Bytecode, B256},</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy equivalent of the [`StateChangeset`] to accommodate for the [`ScrollAccountInfo`].</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct ScrollStateChangeset {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of **not** sorted accounts information.</span>
<span class="term-fg32">+    pub accounts: Vec&lt;(Address, Option&lt;ScrollAccountInfo&gt;)&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of **not** sorted storage.</span>
<span class="term-fg32">+    pub storage: Vec&lt;PlainStorageChangeset&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of contracts by bytecode hash. **not** sorted.</span>
<span class="term-fg32">+    pub contracts: Vec&lt;(B256, Bytecode)&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(StateChangeset, &amp;ScrollPostExecutionContext)&gt; for ScrollStateChangeset {</span>
<span class="term-fg32">+    fn from((changeset, context): (StateChangeset, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            accounts: changeset</span>
<span class="term-fg32">+                .accounts</span>
<span class="term-fg32">+                .into_iter()</span>
<span class="term-fg32">+                .map(|(add, acc)| (add, acc.map(|a| (a, context).into())))</span>
<span class="term-fg32">+                .collect(),</span>
<span class="term-fg32">+            storage: changeset.storage,</span>
<span class="term-fg32">+            contracts: changeset.contracts,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy of the [`PlainStateReverts`] to accommodate for [`ScrollAccountInfo`].</span>
<span class="term-fg32">+#[derive(Clone, Debug, Default)]</span>
<span class="term-fg32">+pub struct ScrollPlainStateReverts {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of account with removed contracts bytecode</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Note: If [`ScrollAccountInfo`] is None means that account needs to be removed.</span>
<span class="term-fg32">+    pub accounts: Vec&lt;Vec&lt;(Address, Option&lt;ScrollAccountInfo&gt;)&gt;&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of storage with its address.</span>
<span class="term-fg32">+    pub storage: Vec&lt;Vec&lt;PlainStorageRevert&gt;&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(PlainStateReverts, &amp;ScrollPostExecutionContext)&gt; for ScrollPlainStateReverts {</span>
<span class="term-fg32">+    fn from((reverts, context): (PlainStateReverts, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            accounts: reverts</span>
<span class="term-fg32">+                .accounts</span>
<span class="term-fg32">+                .into_iter()</span>
<span class="term-fg32">+                .map(|accounts| {</span>
<span class="term-fg32">+                    accounts</span>
<span class="term-fg32">+                        .into_iter()</span>
<span class="term-fg32">+                        .map(|(add, acc)| (add, acc.map(|a| (a, context).into())))</span>
<span class="term-fg32">+                        .collect()</span>
<span class="term-fg32">+                })</span>
<span class="term-fg32">+                .collect(),</span>
<span class="term-fg32">+            storage: reverts.storage,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollPlainStateReverts {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Constructs new [`ScrollPlainStateReverts`] with pre-allocated capacity.</span>
<span class="term-fg32">+    pub fn with_capacity(capacity: usize) -&gt; Self {</span>
<span class="term-fg32">+        Self { accounts: Vec::with_capacity(capacity), storage: Vec::with_capacity(capacity) }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-100ca751e82ed168e92de4c0" role="button"
                       aria-expanded="false" aria-controls="id-100ca751e82ed168e92de4c0">
                        <code>crates/scroll/revm/src/states/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/revm/src/states/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+16</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-100ca751e82ed168e92de4c0"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;mod.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;mod.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..c6f9e969f8052c7920530aa1a2babd1aead61a63</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;mod.rs</span>
<span class="term-fg36">@@ -0,0 +1,16 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll `revm` states types redefinitions.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use account_info::ScrollAccountInfo;</span>
<span class="term-fg32">+mod account_info;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use bundle::{ScrollBundleBuilder, ScrollBundleState};</span>
<span class="term-fg32">+mod bundle;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use bundle_account::ScrollBundleAccount;</span>
<span class="term-fg32">+mod bundle_account;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use changes::{ScrollPlainStateReverts, ScrollStateChangeset};</span>
<span class="term-fg32">+mod changes;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use reverts::{ScrollAccountInfoRevert, ScrollAccountRevert, ScrollReverts};</span>
<span class="term-fg32">+mod reverts;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e1d8d1bf1af93d5ee19638ed" role="button"
                       aria-expanded="false" aria-controls="id-e1d8d1bf1af93d5ee19638ed">
                        <code>crates/scroll/revm/src/states/reverts.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/revm/src/states/reverts.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+153</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e1d8d1bf1af93d5ee19638ed"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;reverts.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;reverts.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..e10034000d8bb3e8cb724f96e93438c527b6236a</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;reverts.rs</span>
<span class="term-fg36">@@ -0,0 +1,153 @@</span>
<span class="term-fg32">+use crate::states::{changes::ScrollPlainStateReverts, ScrollAccountInfo};</span>
<span class="term-fg32">+use reth_scroll_primitives::ScrollPostExecutionContext;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::{</span>
<span class="term-fg32">+        states::{reverts::AccountInfoRevert, PlainStorageRevert},</span>
<span class="term-fg32">+        AccountRevert, AccountStatus, RevertToSlot,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    primitives::{map::HashMap, Address, U256},</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use std::ops::{Deref, DerefMut};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy of a [`revm::db::states::reverts::Reverts`] compatible with the</span>
<span class="term-fg32">+&#47;&#47;&#47; [`crate::states::ScrollBundleState`].</span>
<span class="term-fg32">+#[derive(Clone, Debug, Default, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollReverts(Vec&lt;Vec&lt;(Address, ScrollAccountRevert)&gt;&gt;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Deref for ScrollReverts {</span>
<span class="term-fg32">+    type Target = Vec&lt;Vec&lt;(Address, ScrollAccountRevert)&gt;&gt;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn deref(&amp;self) -&gt; &amp;Self::Target {</span>
<span class="term-fg32">+        &amp;self.0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl DerefMut for ScrollReverts {</span>
<span class="term-fg32">+    fn deref_mut(&amp;mut self) -&gt; &amp;mut Self::Target {</span>
<span class="term-fg32">+        &amp;mut self.0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollReverts {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create new reverts</span>
<span class="term-fg32">+    pub const fn new(reverts: Vec&lt;Vec&lt;(Address, ScrollAccountRevert)&gt;&gt;) -&gt; Self {</span>
<span class="term-fg32">+        Self(reverts)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Extend reverts with other reverts.</span>
<span class="term-fg32">+    pub fn extend(&amp;mut self, other: Self) {</span>
<span class="term-fg32">+        self.0.extend(other.0);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Sort account inside transition by their address.</span>
<span class="term-fg32">+    pub fn sort(&amp;mut self) {</span>
<span class="term-fg32">+        for revert in &amp;mut self.0 {</span>
<span class="term-fg32">+            revert.sort_by_key(|(address, _)| *address);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Generate a [`ScrollPlainStateReverts`].</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Note that account are sorted by address.</span>
<span class="term-fg32">+    pub fn to_plain_state_reverts(&amp;self) -&gt; ScrollPlainStateReverts {</span>
<span class="term-fg32">+        let mut state_reverts = ScrollPlainStateReverts::with_capacity(self.0.len());</span>
<span class="term-fg32">+        for reverts in &amp;self.0 {</span>
<span class="term-fg32">+            &#47;&#47; pessimistically pre-allocate assuming _all_ accounts changed.</span>
<span class="term-fg32">+            let mut accounts = Vec::with_capacity(reverts.len());</span>
<span class="term-fg32">+            let mut storage = Vec::with_capacity(reverts.len());</span>
<span class="term-fg32">+            for (address, revert_account) in reverts {</span>
<span class="term-fg32">+                match &amp;revert_account.account {</span>
<span class="term-fg32">+                    ScrollAccountInfoRevert::RevertTo(acc) =&gt; {</span>
<span class="term-fg32">+                        &#47;&#47; cloning is cheap, because account info has 3 small</span>
<span class="term-fg32">+                        &#47;&#47; fields and a Bytes</span>
<span class="term-fg32">+                        accounts.push((*address, Some(acc.clone())))</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                    ScrollAccountInfoRevert::DeleteIt =&gt; accounts.push((*address, None)),</span>
<span class="term-fg32">+                    ScrollAccountInfoRevert::DoNothing =&gt; (),</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                if revert_account.wipe_storage || !revert_account.storage.is_empty() {</span>
<span class="term-fg32">+                    storage.push(PlainStorageRevert {</span>
<span class="term-fg32">+                        address: *address,</span>
<span class="term-fg32">+                        wiped: revert_account.wipe_storage,</span>
<span class="term-fg32">+                        storage_revert: revert_account</span>
<span class="term-fg32">+                            .storage</span>
<span class="term-fg32">+                            .iter()</span>
<span class="term-fg32">+                            .map(|(k, v)| (*k, *v))</span>
<span class="term-fg32">+                            .collect::&lt;Vec&lt;_&gt;&gt;(),</span>
<span class="term-fg32">+                    });</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            state_reverts.accounts.push(accounts);</span>
<span class="term-fg32">+            state_reverts.storage.push(storage);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        state_reverts</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy of a [`AccountRevert`] compatible with  [`ScrollReverts`].</span>
<span class="term-fg32">+#[derive(Clone, Default, Debug, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollAccountRevert {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account info revert</span>
<span class="term-fg32">+    pub account: ScrollAccountInfoRevert,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Storage revert</span>
<span class="term-fg32">+    pub storage: HashMap&lt;U256, RevertToSlot&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Previous status</span>
<span class="term-fg32">+    pub previous_status: AccountStatus,</span>
<span class="term-fg32">+    &#47;&#47;&#47; If true wipes storage</span>
<span class="term-fg32">+    pub wipe_storage: bool,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(AccountRevert, &amp;ScrollPostExecutionContext)&gt; for ScrollAccountRevert {</span>
<span class="term-fg32">+    fn from((account, context): (AccountRevert, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            account: (account.account, context).into(),</span>
<span class="term-fg32">+            storage: account.storage,</span>
<span class="term-fg32">+            previous_status: account.previous_status,</span>
<span class="term-fg32">+            wipe_storage: account.wipe_storage,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollAccountRevert {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The approximate size of changes needed to store this account revert.</span>
<span class="term-fg32">+    &#47;&#47;&#47; `1 + storage_reverts_len`</span>
<span class="term-fg32">+    pub fn size_hint(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        1 + self.storage.len()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns `true` if there is nothing to revert,</span>
<span class="term-fg32">+    &#47;&#47;&#47; by checking that:</span>
<span class="term-fg32">+    &#47;&#47;&#47; * both account info and storage have been left untouched</span>
<span class="term-fg32">+    &#47;&#47;&#47; * we don&#39;t need to wipe storage</span>
<span class="term-fg32">+    pub fn is_empty(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.account == ScrollAccountInfoRevert::DoNothing &amp;&amp;</span>
<span class="term-fg32">+            self.storage.is_empty() &amp;&amp;</span>
<span class="term-fg32">+            !self.wipe_storage</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy of a [`AccountInfoRevert`] compatible with the</span>
<span class="term-fg32">+&#47;&#47;&#47; [`ScrollAccountInfo`].</span>
<span class="term-fg32">+#[derive(Clone, Default, Debug, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub enum ScrollAccountInfoRevert {</span>
<span class="term-fg32">+    #[default]</span>
<span class="term-fg32">+    &#47;&#47;&#47; Nothing changed</span>
<span class="term-fg32">+    DoNothing,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account was created and on revert we need to remove it with all storage.</span>
<span class="term-fg32">+    DeleteIt,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account was changed and on revert we need to put old state.</span>
<span class="term-fg32">+    RevertTo(ScrollAccountInfo),</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(AccountInfoRevert, &amp;ScrollPostExecutionContext)&gt; for ScrollAccountInfoRevert {</span>
<span class="term-fg32">+    fn from((account, context): (AccountInfoRevert, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        match account {</span>
<span class="term-fg32">+            AccountInfoRevert::DoNothing =&gt; Self::DoNothing,</span>
<span class="term-fg32">+            AccountInfoRevert::DeleteIt =&gt; Self::DeleteIt,</span>
<span class="term-fg32">+            AccountInfoRevert::RevertTo(account) =&gt; Self::RevertTo((account, context).into()),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e3ff04dab57d9ce7f5afe57f" role="button"
                       aria-expanded="false" aria-controls="id-e3ff04dab57d9ce7f5afe57f">
                        <code>crates/scroll/revm/src/test_utils.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/revm/src/test_utils.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+101</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e3ff04dab57d9ce7f5afe57f"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;test_utils.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;test_utils.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..278b16ab0ef6e1ee9c6e4aee8f779e21682ff9ba</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;test_utils.rs</span>
<span class="term-fg36">@@ -0,0 +1,101 @@</span>
<span class="term-fg32">+use crate::{</span>
<span class="term-fg32">+    shared::AccountInfo,</span>
<span class="term-fg32">+    states::{</span>
<span class="term-fg32">+        ScrollAccountInfo, ScrollAccountInfoRevert, ScrollAccountRevert, ScrollPlainStateReverts,</span>
<span class="term-fg32">+        ScrollStateChangeset,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_scroll_primitives::poseidon::{hash_code, POSEIDON_EMPTY};</span>
<span class="term-fg32">+use revm::db::{</span>
<span class="term-fg32">+    states::{reverts::AccountInfoRevert, PlainStateReverts, StateChangeset},</span>
<span class="term-fg32">+    AccountRevert,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+impl From&lt;StateChangeset&gt; for ScrollStateChangeset {</span>
<span class="term-fg32">+    fn from(changeset: StateChangeset) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            accounts: changeset</span>
<span class="term-fg32">+                .accounts</span>
<span class="term-fg32">+                .into_iter()</span>
<span class="term-fg32">+                .map(|(add, acc)| (add, acc.map(Into::into)))</span>
<span class="term-fg32">+                .collect(),</span>
<span class="term-fg32">+            storage: changeset.storage,</span>
<span class="term-fg32">+            contracts: changeset.contracts,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+impl From&lt;PlainStateReverts&gt; for ScrollPlainStateReverts {</span>
<span class="term-fg32">+    fn from(reverts: PlainStateReverts) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            accounts: reverts</span>
<span class="term-fg32">+                .accounts</span>
<span class="term-fg32">+                .into_iter()</span>
<span class="term-fg32">+                .map(|accounts| {</span>
<span class="term-fg32">+                    accounts.into_iter().map(|(add, acc)| (add, acc.map(Into::into))).collect()</span>
<span class="term-fg32">+                })</span>
<span class="term-fg32">+                .collect(),</span>
<span class="term-fg32">+            storage: reverts.storage,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+impl From&lt;AccountInfoRevert&gt; for ScrollAccountInfoRevert {</span>
<span class="term-fg32">+    fn from(account: AccountInfoRevert) -&gt; Self {</span>
<span class="term-fg32">+        match account {</span>
<span class="term-fg32">+            AccountInfoRevert::DoNothing =&gt; Self::DoNothing,</span>
<span class="term-fg32">+            AccountInfoRevert::DeleteIt =&gt; Self::DeleteIt,</span>
<span class="term-fg32">+            AccountInfoRevert::RevertTo(account) =&gt; Self::RevertTo(account.into()),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+impl From&lt;AccountRevert&gt; for ScrollAccountRevert {</span>
<span class="term-fg32">+    fn from(account: AccountRevert) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            account: account.account.into(),</span>
<span class="term-fg32">+            storage: account.storage,</span>
<span class="term-fg32">+            previous_status: account.previous_status,</span>
<span class="term-fg32">+            wipe_storage: account.wipe_storage,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+impl From&lt;AccountInfo&gt; for ScrollAccountInfo {</span>
<span class="term-fg32">+    fn from(info: AccountInfo) -&gt; Self {</span>
<span class="term-fg32">+        let (code_size, poseidon_code_hash) = info</span>
<span class="term-fg32">+            .code</span>
<span class="term-fg32">+            .as_ref()</span>
<span class="term-fg32">+            .map(|code| (code.len() as u64, hash_code(code.original_byte_slice())))</span>
<span class="term-fg32">+            .unwrap_or((0, POSEIDON_EMPTY));</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: info.balance,</span>
<span class="term-fg32">+            nonce: info.nonce,</span>
<span class="term-fg32">+            code_hash: info.code_hash,</span>
<span class="term-fg32">+            code: info.code,</span>
<span class="term-fg32">+            code_size,</span>
<span class="term-fg32">+            poseidon_code_hash,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion causes a loss of information.</span>
<span class="term-fg32">+impl From&lt;ScrollAccountInfo&gt; for AccountInfo {</span>
<span class="term-fg32">+    fn from(info: ScrollAccountInfo) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: info.balance,</span>
<span class="term-fg32">+            nonce: info.nonce,</span>
<span class="term-fg32">+            code_hash: info.code_hash,</span>
<span class="term-fg32">+            code: info.code,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: info.code_size as usize,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: info.poseidon_code_hash,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-05cbdaa72f8fc53dda1778fd" role="button"
                       aria-expanded="false" aria-controls="id-05cbdaa72f8fc53dda1778fd">
                        <code>crates/scroll/state-commitment/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/state-commitment/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+81</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-05cbdaa72f8fc53dda1778fd"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;state-commitment&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..abcd753a85ed3407c92ec1ab9c66d3edc87eead4</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,81 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-state-commitment&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+reth-db.workspace = true </span>
<span class="term-fg32">+reth-execution-errors.workspace = true</span>
<span class="term-fg32">+reth-primitives.workspace = true</span>
<span class="term-fg32">+reth-primitives-traits.workspace = true</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+reth-scroll-trie.workspace = true</span>
<span class="term-fg32">+reth-trie.workspace = true</span>
<span class="term-fg32">+reth-trie-db.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# alloy</span>
<span class="term-fg32">+alloy-consensus.workspace = true</span>
<span class="term-fg32">+alloy-genesis.workspace = true</span>
<span class="term-fg32">+alloy-primitives.workspace = true</span>
<span class="term-fg32">+alloy-rlp.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# `metrics` feature</span>
<span class="term-fg32">+reth-metrics = { workspace = true, optional = true }</span>
<span class="term-fg32">+metrics = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# zktrie</span>
<span class="term-fg32">+poseidon-bn254.workspace = true</span>
<span class="term-fg32">+zktrie_rust = { git = &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;zktrie.git&quot;, rev = &quot;309160464c1cd2b87a578ed6d9b6e98205ae4640&quot;, optional = true }</span>
<span class="term-fg32">+zktrie = { git = &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;zktrie.git&quot;, rev = &quot;309160464c1cd2b87a578ed6d9b6e98205ae4640&quot;, features = [&quot;rs_zktrie&quot;], optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# misc</span>
<span class="term-fg32">+tracing.workspace = true</span>
<span class="term-fg32">+itertools.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dev-dependencies]</span>
<span class="term-fg32">+reth-db-api.workspace = true</span>
<span class="term-fg32">+reth-primitives = { workspace = true, features = [&quot;test-utils&quot;, &quot;arbitrary&quot;] }</span>
<span class="term-fg32">+reth-scroll-state-commitment = { workspace = true, features = [&quot;test-utils&quot;] }</span>
<span class="term-fg32">+reth-trie = { workspace = true, features = [&quot;test-utils&quot; ] }</span>
<span class="term-fg32">+reth-trie-common = { workspace = true, features = [&quot;test-utils&quot;, &quot;arbitrary&quot;] }</span>
<span class="term-fg32">+reth-provider = { workspace = true, features = [&quot;test-utils&quot; ] }</span>
<span class="term-fg32">+alloy-consensus.workspace = true</span>
<span class="term-fg32">+zktrie_rust = { git = &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;zktrie.git&quot;, rev = &quot;309160464c1cd2b87a578ed6d9b6e98205ae4640&quot; }</span>
<span class="term-fg32">+zktrie = { git = &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;zktrie.git&quot;, rev = &quot;309160464c1cd2b87a578ed6d9b6e98205ae4640&quot;, features = [&quot;rs_zktrie&quot;] }</span>
<span class="term-fg32">+proptest.workspace = true</span>
<span class="term-fg32">+proptest-arbitrary-interop.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+test-utils = [</span>
<span class="term-fg32">+    &quot;dep:zktrie_rust&quot;, </span>
<span class="term-fg32">+    &quot;dep:zktrie&quot;,</span>
<span class="term-fg32">+    &quot;reth-db&#47;test-utils&quot;,</span>
<span class="term-fg32">+    &quot;reth-db&#47;mdbx&quot;,</span>
<span class="term-fg32">+    &quot;reth-db-api&#47;test-utils&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;test-utils&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives-traits&#47;test-utils&quot;,</span>
<span class="term-fg32">+    &quot;reth-provider&#47;test-utils&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-execution&#47;test-utils&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-state-commitment&#47;test-utils&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;test-utils&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie-common&#47;test-utils&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie-db&#47;test-utils&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+metrics = [&quot;reth-metrics&quot;, &quot;dep:metrics&quot;]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a3b7cd2ab208e3b4c3ddf9bd" role="button"
                       aria-expanded="false" aria-controls="id-a3b7cd2ab208e3b4c3ddf9bd">
                        <code>crates/scroll/state-commitment/src/account.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/state-commitment/src/account.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+69</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a3b7cd2ab208e3b4c3ddf9bd"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;account.rs scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;account.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..5499e016baacb6e64ac9e6e28c75cee0777cd16a</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;account.rs</span>
<span class="term-fg36">@@ -0,0 +1,69 @@</span>
<span class="term-fg32">+use alloy_consensus::constants::KECCAK_EMPTY;</span>
<span class="term-fg32">+use alloy_genesis::GenesisAccount;</span>
<span class="term-fg32">+use alloy_primitives::{keccak256, B256, U256};</span>
<span class="term-fg32">+use reth_primitives_traits::Account;</span>
<span class="term-fg32">+use reth_scroll_primitives::poseidon::POSEIDON_EMPTY;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A Scroll account as represented in the trie.</span>
<span class="term-fg32">+#[derive(Debug, Clone)]</span>
<span class="term-fg32">+pub struct ScrollTrieAccount {</span>
<span class="term-fg32">+    &#47;&#47;&#47; nonce</span>
<span class="term-fg32">+    pub nonce: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; code size</span>
<span class="term-fg32">+    pub code_size: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; balance</span>
<span class="term-fg32">+    pub balance: U256,</span>
<span class="term-fg32">+    &#47;&#47;&#47; storage root</span>
<span class="term-fg32">+    pub storage_root: B256,</span>
<span class="term-fg32">+    &#47;&#47;&#47; keccak code hash</span>
<span class="term-fg32">+    pub code_hash: B256,</span>
<span class="term-fg32">+    &#47;&#47;&#47; poseidon code hash</span>
<span class="term-fg32">+    pub poseidon_code_hash: B256,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(Account, B256)&gt; for ScrollTrieAccount {</span>
<span class="term-fg32">+    fn from((account, storage_root): (Account, B256)) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            nonce: account.nonce,</span>
<span class="term-fg32">+            balance: account.balance,</span>
<span class="term-fg32">+            storage_root,</span>
<span class="term-fg32">+            code_hash: account.get_bytecode_hash(),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: account.get_poseidon_code_hash(),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: account.get_code_size(),</span>
<span class="term-fg32">+            #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+            poseidon_code_hash: B256::default(),</span>
<span class="term-fg32">+            #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+            code_size: 0,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;GenesisAccount&gt; for ScrollTrieAccount {</span>
<span class="term-fg32">+    fn from(account: GenesisAccount) -&gt; Self {</span>
<span class="term-fg32">+        let storage_root = account</span>
<span class="term-fg32">+            .storage</span>
<span class="term-fg32">+            .map(|storage| {</span>
<span class="term-fg32">+                crate::storage_root_unhashed(</span>
<span class="term-fg32">+                    storage</span>
<span class="term-fg32">+                        .into_iter()</span>
<span class="term-fg32">+                        .filter(|(_, value)| !value.is_zero())</span>
<span class="term-fg32">+                        .map(|(slot, value)| (slot, U256::from_be_bytes(*value))),</span>
<span class="term-fg32">+                )</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .unwrap_or(reth_scroll_primitives::poseidon::EMPTY_ROOT_HASH);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            nonce: account.nonce.unwrap_or_default(),</span>
<span class="term-fg32">+            balance: account.balance,</span>
<span class="term-fg32">+            storage_root,</span>
<span class="term-fg32">+            code_hash: account.code.as_ref().map_or(KECCAK_EMPTY, keccak256),</span>
<span class="term-fg32">+            poseidon_code_hash: account</span>
<span class="term-fg32">+                .code</span>
<span class="term-fg32">+                .as_ref()</span>
<span class="term-fg32">+                .map_or(POSEIDON_EMPTY, reth_scroll_primitives::poseidon::hash_code),</span>
<span class="term-fg32">+            code_size: account.code.map(|c| c.len()).unwrap_or_default() as u64,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cdb12fe7521912b982934a1a" role="button"
                       aria-expanded="false" aria-controls="id-cdb12fe7521912b982934a1a">
                        <code>crates/scroll/state-commitment/src/commitment.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/state-commitment/src/commitment.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+26</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cdb12fe7521912b982934a1a"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;commitment.rs scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;commitment.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..bf6c27721706c76b4170e482f5fae2827f99c2d1</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;commitment.rs</span>
<span class="term-fg36">@@ -0,0 +1,26 @@</span>
<span class="term-fg32">+use super::{PoseidonKeyHasher, StateRoot, StorageRoot};</span>
<span class="term-fg32">+use reth_db::transaction::DbTx;</span>
<span class="term-fg32">+use reth_trie_db::{DatabaseHashedCursorFactory, DatabaseTrieCursorFactory, StateCommitment};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The state commitment type for Scroll&#39;s binary Merkle Patricia Trie.</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+#[non_exhaustive]</span>
<span class="term-fg32">+pub struct BinaryMerklePatriciaTrie;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl StateCommitment for BinaryMerklePatriciaTrie {</span>
<span class="term-fg32">+    type KeyHasher = PoseidonKeyHasher;</span>
<span class="term-fg32">+    type StateRoot&lt;&#39;a, TX: DbTx + &#39;a&gt; =</span>
<span class="term-fg32">+        StateRoot&lt;DatabaseTrieCursorFactory&lt;&#39;a, TX&gt;, DatabaseHashedCursorFactory&lt;&#39;a, TX&gt;&gt;;</span>
<span class="term-fg32">+    type StorageRoot&lt;&#39;a, TX: DbTx + &#39;a&gt; =</span>
<span class="term-fg32">+        StorageRoot&lt;DatabaseTrieCursorFactory&lt;&#39;a, TX&gt;, DatabaseHashedCursorFactory&lt;&#39;a, TX&gt;&gt;;</span>
<span class="term-fg32">+    &#47;&#47; TODO(scroll): replace with scroll proof type</span>
<span class="term-fg32">+    type StateProof&lt;&#39;a, TX: DbTx + &#39;a&gt; = reth_trie::proof::Proof&lt;</span>
<span class="term-fg32">+        DatabaseTrieCursorFactory&lt;&#39;a, TX&gt;,</span>
<span class="term-fg32">+        DatabaseHashedCursorFactory&lt;&#39;a, TX&gt;,</span>
<span class="term-fg32">+    &gt;;</span>
<span class="term-fg32">+    &#47;&#47; TODO(scroll): replace with scroll witness type</span>
<span class="term-fg32">+    type StateWitness&lt;&#39;a, TX: DbTx + &#39;a&gt; = reth_trie::witness::TrieWitness&lt;</span>
<span class="term-fg32">+        DatabaseTrieCursorFactory&lt;&#39;a, TX&gt;,</span>
<span class="term-fg32">+        DatabaseHashedCursorFactory&lt;&#39;a, TX&gt;,</span>
<span class="term-fg32">+    &gt;;</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-de9ded11bcebd92f1ac2e5f5" role="button"
                       aria-expanded="false" aria-controls="id-de9ded11bcebd92f1ac2e5f5">
                        <code>crates/scroll/state-commitment/src/key.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/state-commitment/src/key.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+26</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-de9ded11bcebd92f1ac2e5f5"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;key.rs scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;key.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..844f2c4f70f7557fc3b2cdc6e080431e10251870</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;key.rs</span>
<span class="term-fg36">@@ -0,0 +1,26 @@</span>
<span class="term-fg32">+use alloy_primitives::B256;</span>
<span class="term-fg32">+use reth_scroll_primitives::poseidon::{</span>
<span class="term-fg32">+    split_and_hash_be_bytes, PrimeField, FIELD_ELEMENT_REPR_BYTES,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_trie::KeyHasher;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; An implementation of a key hasher that uses Poseidon.</span>
<span class="term-fg32">+#[derive(Clone, Debug, Default)]</span>
<span class="term-fg32">+pub struct PoseidonKeyHasher;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl KeyHasher for PoseidonKeyHasher {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Hashes the key using the Poseidon hash function.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; The bytes are expected to be provided in big endian format.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Panics if the number of bytes provided is greater than the number of bytes in the</span>
<span class="term-fg32">+    &#47;&#47;&#47; binary representation of a field element (32).</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the hash digest in little endian representation with bits reversed.</span>
<span class="term-fg32">+    fn hash_key&lt;T: AsRef&lt;[u8]&gt;&gt;(bytes: T) -&gt; B256 {</span>
<span class="term-fg32">+        debug_assert!(bytes.as_ref().len() &lt;= FIELD_ELEMENT_REPR_BYTES);</span>
<span class="term-fg32">+        let mut bytes = split_and_hash_be_bytes(bytes.as_ref()).to_repr();</span>
<span class="term-fg32">+        bytes.iter_mut().for_each(|byte| *byte = byte.reverse_bits());</span>
<span class="term-fg32">+        bytes.into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9ca0192c9f0b9596f3e9cf1f" role="button"
                       aria-expanded="false" aria-controls="id-9ca0192c9f0b9596f3e9cf1f">
                        <code>crates/scroll/state-commitment/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/state-commitment/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+23</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9ca0192c9f0b9596f3e9cf1f"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..c9b7c300b5485c4e33324429788f9ac461d6725e</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,23 @@</span>
<span class="term-fg32">+&#47;&#47;! The implementation of scrolls binary Merkle Patricia Trie used a cryptographic state commitment.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod account;</span>
<span class="term-fg32">+pub use account::ScrollTrieAccount;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod commitment;</span>
<span class="term-fg32">+pub use commitment::BinaryMerklePatriciaTrie;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod root;</span>
<span class="term-fg32">+pub use root::*;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod key;</span>
<span class="term-fg32">+pub use key::PoseidonKeyHasher;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod value;</span>
<span class="term-fg32">+pub use value::PoseidonValueHasher;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; test utils for the state commitment</span>
<span class="term-fg32">+#[cfg(feature = &quot;test-utils&quot;)]</span>
<span class="term-fg32">+pub mod test_utils;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(all(test, feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+mod test;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-00874225fbf8ae156a33f5b4" role="button"
                       aria-expanded="false" aria-controls="id-00874225fbf8ae156a33f5b4">
                        <code>crates/scroll/state-commitment/src/root/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/state-commitment/src/root/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+630</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-00874225fbf8ae156a33f5b4"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;root&#47;mod.rs scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;root&#47;mod.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..5336955521a56a7daf0cc429a27b0c617df88d26</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;root&#47;mod.rs</span>
<span class="term-fg36">@@ -0,0 +1,630 @@</span>
<span class="term-fg32">+use super::{PoseidonKeyHasher, PoseidonValueHasher, ScrollTrieAccount};</span>
<span class="term-fg32">+use alloy_primitives::{Address, BlockNumber, B256};</span>
<span class="term-fg32">+use reth_db::transaction::DbTx;</span>
<span class="term-fg32">+use reth_execution_errors::{StateRootError, StorageRootError};</span>
<span class="term-fg32">+use reth_scroll_primitives::poseidon::EMPTY_ROOT_HASH;</span>
<span class="term-fg32">+use reth_scroll_trie::HashBuilder;</span>
<span class="term-fg32">+use reth_trie::{</span>
<span class="term-fg32">+    hashed_cursor::{HashedCursorFactory, HashedPostStateCursorFactory, HashedStorageCursor},</span>
<span class="term-fg32">+    node_iter::{TrieElement, TrieNodeIter},</span>
<span class="term-fg32">+    prefix_set::{PrefixSet, TriePrefixSets},</span>
<span class="term-fg32">+    stats::TrieTracker,</span>
<span class="term-fg32">+    trie_cursor::{InMemoryTrieCursorFactory, TrieCursorFactory},</span>
<span class="term-fg32">+    updates::{StorageTrieUpdates, TrieUpdates},</span>
<span class="term-fg32">+    walker::TrieWalker,</span>
<span class="term-fg32">+    BitsCompatibility, HashedPostState, HashedPostStateSorted, HashedStorage,</span>
<span class="term-fg32">+    IntermediateStateRootState, KeyHasher, Nibbles, StateRootProgress, TrieInput,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use tracing::{debug, trace};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;metrics&quot;)]</span>
<span class="term-fg32">+use reth_trie::metrics::{StateRootMetrics, TrieRootMetrics, TrieType};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod utils;</span>
<span class="term-fg32">+pub use utils::*;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; TODO(scroll): Instead of introducing this new type we should make StateRoot generic over</span>
<span class="term-fg32">+&#47;&#47; the [`HashBuilder`] and key traversal types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; `StateRoot` is used to compute the root node of a state trie.</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct StateRoot&lt;T, H&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The factory for trie cursors.</span>
<span class="term-fg32">+    pub trie_cursor_factory: T,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The factory for hashed cursors.</span>
<span class="term-fg32">+    pub hashed_cursor_factory: H,</span>
<span class="term-fg32">+    &#47;&#47;&#47; A set of prefix sets that have changed.</span>
<span class="term-fg32">+    pub prefix_sets: TriePrefixSets,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Previous intermediate state.</span>
<span class="term-fg32">+    previous_state: Option&lt;IntermediateStateRootState&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The number of updates after which the intermediate progress should be returned.</span>
<span class="term-fg32">+    threshold: u64,</span>
<span class="term-fg32">+    #[cfg(feature = &quot;metrics&quot;)]</span>
<span class="term-fg32">+    &#47;&#47;&#47; State root metrics.</span>
<span class="term-fg32">+    metrics: StateRootMetrics,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;T, H&gt; StateRoot&lt;T, H&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates [`StateRoot`] with `trie_cursor_factory` and `hashed_cursor_factory`. All other</span>
<span class="term-fg32">+    &#47;&#47;&#47; parameters are set to reasonable defaults.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; The cursors created by given factories are then used to walk through the accounts and</span>
<span class="term-fg32">+    &#47;&#47;&#47; calculate the state root value with.</span>
<span class="term-fg32">+    pub fn new(trie_cursor_factory: T, hashed_cursor_factory: H) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            trie_cursor_factory,</span>
<span class="term-fg32">+            hashed_cursor_factory,</span>
<span class="term-fg32">+            prefix_sets: TriePrefixSets::default(),</span>
<span class="term-fg32">+            previous_state: None,</span>
<span class="term-fg32">+            threshold: 100_000,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;metrics&quot;)]</span>
<span class="term-fg32">+            metrics: StateRootMetrics::default(),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set the prefix sets.</span>
<span class="term-fg32">+    pub fn with_prefix_sets(mut self, prefix_sets: TriePrefixSets) -&gt; Self {</span>
<span class="term-fg32">+        self.prefix_sets = prefix_sets;</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set the threshold.</span>
<span class="term-fg32">+    pub const fn with_threshold(mut self, threshold: u64) -&gt; Self {</span>
<span class="term-fg32">+        self.threshold = threshold;</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set the threshold to maximum value so that intermediate progress is not returned.</span>
<span class="term-fg32">+    pub const fn with_no_threshold(mut self) -&gt; Self {</span>
<span class="term-fg32">+        self.threshold = u64::MAX;</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set the previously recorded intermediate state.</span>
<span class="term-fg32">+    pub fn with_intermediate_state(mut self, state: Option&lt;IntermediateStateRootState&gt;) -&gt; Self {</span>
<span class="term-fg32">+        self.previous_state = state;</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set the hashed cursor factory.</span>
<span class="term-fg32">+    pub fn with_hashed_cursor_factory&lt;HF&gt;(self, hashed_cursor_factory: HF) -&gt; StateRoot&lt;T, HF&gt; {</span>
<span class="term-fg32">+        StateRoot {</span>
<span class="term-fg32">+            trie_cursor_factory: self.trie_cursor_factory,</span>
<span class="term-fg32">+            hashed_cursor_factory,</span>
<span class="term-fg32">+            prefix_sets: self.prefix_sets,</span>
<span class="term-fg32">+            threshold: self.threshold,</span>
<span class="term-fg32">+            previous_state: self.previous_state,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;metrics&quot;)]</span>
<span class="term-fg32">+            metrics: self.metrics,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set the trie cursor factory.</span>
<span class="term-fg32">+    pub fn with_trie_cursor_factory&lt;TF&gt;(self, trie_cursor_factory: TF) -&gt; StateRoot&lt;TF, H&gt; {</span>
<span class="term-fg32">+        StateRoot {</span>
<span class="term-fg32">+            trie_cursor_factory,</span>
<span class="term-fg32">+            hashed_cursor_factory: self.hashed_cursor_factory,</span>
<span class="term-fg32">+            prefix_sets: self.prefix_sets,</span>
<span class="term-fg32">+            threshold: self.threshold,</span>
<span class="term-fg32">+            previous_state: self.previous_state,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;metrics&quot;)]</span>
<span class="term-fg32">+            metrics: self.metrics,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;T, H&gt; StateRoot&lt;T, H&gt;</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    T: TrieCursorFactory + Clone,</span>
<span class="term-fg32">+    H: HashedCursorFactory + Clone,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    &#47;&#47;&#47; Walks the intermediate nodes of existing state trie (if any) and hashed entries. Feeds the</span>
<span class="term-fg32">+    &#47;&#47;&#47; nodes into the hash builder. Collects the updates in the process.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Ignores the threshold.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; # Returns</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; The intermediate progress of state root computation and the trie updates.</span>
<span class="term-fg32">+    pub fn root_with_updates(self) -&gt; Result&lt;(B256, TrieUpdates), StateRootError&gt; {</span>
<span class="term-fg32">+        match self.with_no_threshold().calculate(true)? {</span>
<span class="term-fg32">+            StateRootProgress::Complete(root, _, updates) =&gt; Ok((root, updates)),</span>
<span class="term-fg32">+            StateRootProgress::Progress(..) =&gt; unreachable!(), &#47;&#47; unreachable threshold</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Walks the intermediate nodes of existing state trie (if any) and hashed entries. Feeds the</span>
<span class="term-fg32">+    &#47;&#47;&#47; nodes into the hash builder.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; # Returns</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; The state root hash.</span>
<span class="term-fg32">+    pub fn root(self) -&gt; Result&lt;B256, StateRootError&gt; {</span>
<span class="term-fg32">+        match self.calculate(false)? {</span>
<span class="term-fg32">+            StateRootProgress::Complete(root, _, _) =&gt; Ok(root),</span>
<span class="term-fg32">+            StateRootProgress::Progress(..) =&gt; unreachable!(), &#47;&#47; update retenion is disabled</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Walks the intermediate nodes of existing state trie (if any) and hashed entries. Feeds the</span>
<span class="term-fg32">+    &#47;&#47;&#47; nodes into the hash builder. Collects the updates in the process.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; # Returns</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; The intermediate progress of state root computation.</span>
<span class="term-fg32">+    pub fn root_with_progress(self) -&gt; Result&lt;StateRootProgress, StateRootError&gt; {</span>
<span class="term-fg32">+        self.calculate(true)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn calculate(self, retain_updates: bool) -&gt; Result&lt;StateRootProgress, StateRootError&gt; {</span>
<span class="term-fg32">+        trace!(target: &quot;trie::state_root&quot;, &quot;calculating state root&quot;);</span>
<span class="term-fg32">+        let mut tracker = TrieTracker::default();</span>
<span class="term-fg32">+        let mut trie_updates = TrieUpdates::default();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let trie_cursor = self.trie_cursor_factory.account_trie_cursor()?;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let hashed_account_cursor = self.hashed_cursor_factory.hashed_account_cursor()?;</span>
<span class="term-fg32">+        let (mut hash_builder, mut account_node_iter) = match self.previous_state {</span>
<span class="term-fg32">+            Some(state) =&gt; {</span>
<span class="term-fg32">+                let hash_builder = state.hash_builder.with_updates(retain_updates).into();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                let walker = TrieWalker::from_stack(</span>
<span class="term-fg32">+                    trie_cursor,</span>
<span class="term-fg32">+                    state.walker_stack,</span>
<span class="term-fg32">+                    self.prefix_sets.account_prefix_set,</span>
<span class="term-fg32">+                )</span>
<span class="term-fg32">+                .with_deletions_retained(retain_updates);</span>
<span class="term-fg32">+                let node_iter = TrieNodeIter::new(walker, hashed_account_cursor)</span>
<span class="term-fg32">+                    .with_last_hashed_key(state.last_account_key);</span>
<span class="term-fg32">+                (hash_builder, node_iter)</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            None =&gt; {</span>
<span class="term-fg32">+                let hash_builder = HashBuilder::default().with_updates(retain_updates);</span>
<span class="term-fg32">+                let walker = TrieWalker::new(trie_cursor, self.prefix_sets.account_prefix_set)</span>
<span class="term-fg32">+                    .with_deletions_retained(retain_updates);</span>
<span class="term-fg32">+                let node_iter = TrieNodeIter::new(walker, hashed_account_cursor);</span>
<span class="term-fg32">+                (hash_builder, node_iter)</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut hashed_entries_walked = 0;</span>
<span class="term-fg32">+        let mut updated_storage_nodes = 0;</span>
<span class="term-fg32">+        while let Some(node) = account_node_iter.try_next()? {</span>
<span class="term-fg32">+            match node {</span>
<span class="term-fg32">+                TrieElement::Branch(node) =&gt; {</span>
<span class="term-fg32">+                    tracker.inc_branch();</span>
<span class="term-fg32">+                    hash_builder.add_branch(node.key, node.value, node.children_are_in_trie);</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                TrieElement::Leaf(hashed_address, account) =&gt; {</span>
<span class="term-fg32">+                    tracker.inc_leaf();</span>
<span class="term-fg32">+                    hashed_entries_walked += 1;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                    &#47;&#47; We assume we can always calculate a storage root without</span>
<span class="term-fg32">+                    &#47;&#47; OOMing. This opens us up to a potential DOS vector if</span>
<span class="term-fg32">+                    &#47;&#47; a contract had too many storage entries and they were</span>
<span class="term-fg32">+                    &#47;&#47; all buffered w&#47;o us returning and committing our intermediate</span>
<span class="term-fg32">+                    &#47;&#47; progress.</span>
<span class="term-fg32">+                    &#47;&#47; TODO: We can consider introducing the TrieProgress::Progress&#47;Complete</span>
<span class="term-fg32">+                    &#47;&#47; abstraction inside StorageRoot, but let&#39;s give it a try as-is for now.</span>
<span class="term-fg32">+                    let storage_root_calculator = StorageRoot::new_hashed(</span>
<span class="term-fg32">+                        self.trie_cursor_factory.clone(),</span>
<span class="term-fg32">+                        self.hashed_cursor_factory.clone(),</span>
<span class="term-fg32">+                        hashed_address,</span>
<span class="term-fg32">+                        #[cfg(feature = &quot;metrics&quot;)]</span>
<span class="term-fg32">+                        self.metrics.storage_trie.clone(),</span>
<span class="term-fg32">+                    )</span>
<span class="term-fg32">+                    .with_prefix_set(</span>
<span class="term-fg32">+                        self.prefix_sets</span>
<span class="term-fg32">+                            .storage_prefix_sets</span>
<span class="term-fg32">+                            .get(&amp;hashed_address)</span>
<span class="term-fg32">+                            .cloned()</span>
<span class="term-fg32">+                            .unwrap_or_default(),</span>
<span class="term-fg32">+                    );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                    let storage_root = if retain_updates {</span>
<span class="term-fg32">+                        let (root, storage_slots_walked, updates) =</span>
<span class="term-fg32">+                            storage_root_calculator.root_with_updates()?;</span>
<span class="term-fg32">+                        hashed_entries_walked += storage_slots_walked;</span>
<span class="term-fg32">+                        &#47;&#47; We only walk over hashed address once, so it&#39;s safe to insert.</span>
<span class="term-fg32">+                        updated_storage_nodes += updates.len();</span>
<span class="term-fg32">+                        trie_updates.insert_storage_updates(hashed_address, updates);</span>
<span class="term-fg32">+                        root</span>
<span class="term-fg32">+                    } else {</span>
<span class="term-fg32">+                        storage_root_calculator.root()?</span>
<span class="term-fg32">+                    };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                    let account = ScrollTrieAccount::from((account, storage_root));</span>
<span class="term-fg32">+                    let account_hash = PoseidonValueHasher::hash_account(account);</span>
<span class="term-fg32">+                    hash_builder</span>
<span class="term-fg32">+                        .add_leaf(Nibbles::unpack_bits(hashed_address), account_hash.as_slice());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                    &#47;&#47; Decide if we need to return intermediate progress.</span>
<span class="term-fg32">+                    let total_updates_len = updated_storage_nodes +</span>
<span class="term-fg32">+                        account_node_iter.walker.removed_keys_len() +</span>
<span class="term-fg32">+                        hash_builder.updates_len();</span>
<span class="term-fg32">+                    if retain_updates &amp;&amp; total_updates_len as u64 &gt;= self.threshold {</span>
<span class="term-fg32">+                        let (walker_stack, walker_deleted_keys) = account_node_iter.walker.split();</span>
<span class="term-fg32">+                        trie_updates.removed_nodes.extend(walker_deleted_keys);</span>
<span class="term-fg32">+                        let (hash_builder, hash_builder_updates) = hash_builder.split();</span>
<span class="term-fg32">+                        trie_updates.account_nodes.extend(hash_builder_updates);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                        let state = IntermediateStateRootState {</span>
<span class="term-fg32">+                            hash_builder: hash_builder.into(),</span>
<span class="term-fg32">+                            walker_stack,</span>
<span class="term-fg32">+                            last_account_key: hashed_address,</span>
<span class="term-fg32">+                        };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                        return Ok(StateRootProgress::Progress(</span>
<span class="term-fg32">+                            Box::new(state),</span>
<span class="term-fg32">+                            hashed_entries_walked,</span>
<span class="term-fg32">+                            trie_updates,</span>
<span class="term-fg32">+                        ))</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let root = hash_builder.root();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let removed_keys = account_node_iter.walker.take_removed_keys();</span>
<span class="term-fg32">+        trie_updates.finalize(</span>
<span class="term-fg32">+            hash_builder.into(),</span>
<span class="term-fg32">+            removed_keys,</span>
<span class="term-fg32">+            self.prefix_sets.destroyed_accounts,</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let stats = tracker.finish();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        #[cfg(feature = &quot;metrics&quot;)]</span>
<span class="term-fg32">+        self.metrics.state_trie.record(stats);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        trace!(</span>
<span class="term-fg32">+            target: &quot;trie::state_root&quot;,</span>
<span class="term-fg32">+            %root,</span>
<span class="term-fg32">+            duration = ?stats.duration(),</span>
<span class="term-fg32">+            branches_added = stats.branches_added(),</span>
<span class="term-fg32">+            leaves_added = stats.leaves_added(),</span>
<span class="term-fg32">+            &quot;calculated state root&quot;</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(StateRootProgress::Complete(root, hashed_entries_walked, trie_updates))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; `StorageRoot` is used to compute the root node of an account storage trie.</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct StorageRoot&lt;T, H&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; A reference to the database transaction.</span>
<span class="term-fg32">+    pub trie_cursor_factory: T,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The factory for hashed cursors.</span>
<span class="term-fg32">+    pub hashed_cursor_factory: H,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The hashed address of an account.</span>
<span class="term-fg32">+    pub hashed_address: B256,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The set of storage slot prefixes that have changed.</span>
<span class="term-fg32">+    pub prefix_set: PrefixSet,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Storage root metrics.</span>
<span class="term-fg32">+    #[cfg(feature = &quot;metrics&quot;)]</span>
<span class="term-fg32">+    metrics: TrieRootMetrics,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;T, H&gt; StorageRoot&lt;T, H&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates a new storage root calculator given a raw address.</span>
<span class="term-fg32">+    pub fn new(</span>
<span class="term-fg32">+        trie_cursor_factory: T,</span>
<span class="term-fg32">+        hashed_cursor_factory: H,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        #[cfg(feature = &quot;metrics&quot;)] metrics: TrieRootMetrics,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        Self::new_hashed(</span>
<span class="term-fg32">+            trie_cursor_factory,</span>
<span class="term-fg32">+            hashed_cursor_factory,</span>
<span class="term-fg32">+            PoseidonKeyHasher::hash_key(address),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;metrics&quot;)]</span>
<span class="term-fg32">+            metrics,</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates a new storage root calculator given a hashed address.</span>
<span class="term-fg32">+    pub fn new_hashed(</span>
<span class="term-fg32">+        trie_cursor_factory: T,</span>
<span class="term-fg32">+        hashed_cursor_factory: H,</span>
<span class="term-fg32">+        hashed_address: B256,</span>
<span class="term-fg32">+        #[cfg(feature = &quot;metrics&quot;)] metrics: TrieRootMetrics,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            trie_cursor_factory,</span>
<span class="term-fg32">+            hashed_cursor_factory,</span>
<span class="term-fg32">+            hashed_address,</span>
<span class="term-fg32">+            prefix_set: PrefixSet::default(),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;metrics&quot;)]</span>
<span class="term-fg32">+            metrics,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set the changed prefixes.</span>
<span class="term-fg32">+    pub fn with_prefix_set(mut self, prefix_set: PrefixSet) -&gt; Self {</span>
<span class="term-fg32">+        self.prefix_set = prefix_set;</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set the hashed cursor factory.</span>
<span class="term-fg32">+    pub fn with_hashed_cursor_factory&lt;HF&gt;(self, hashed_cursor_factory: HF) -&gt; StorageRoot&lt;T, HF&gt; {</span>
<span class="term-fg32">+        StorageRoot {</span>
<span class="term-fg32">+            trie_cursor_factory: self.trie_cursor_factory,</span>
<span class="term-fg32">+            hashed_cursor_factory,</span>
<span class="term-fg32">+            hashed_address: self.hashed_address,</span>
<span class="term-fg32">+            prefix_set: self.prefix_set,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;metrics&quot;)]</span>
<span class="term-fg32">+            metrics: self.metrics,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set the trie cursor factory.</span>
<span class="term-fg32">+    pub fn with_trie_cursor_factory&lt;TF&gt;(self, trie_cursor_factory: TF) -&gt; StorageRoot&lt;TF, H&gt; {</span>
<span class="term-fg32">+        StorageRoot {</span>
<span class="term-fg32">+            trie_cursor_factory,</span>
<span class="term-fg32">+            hashed_cursor_factory: self.hashed_cursor_factory,</span>
<span class="term-fg32">+            hashed_address: self.hashed_address,</span>
<span class="term-fg32">+            prefix_set: self.prefix_set,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;metrics&quot;)]</span>
<span class="term-fg32">+            metrics: self.metrics,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;T, H&gt; StorageRoot&lt;T, H&gt;</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    T: TrieCursorFactory,</span>
<span class="term-fg32">+    H: HashedCursorFactory,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    &#47;&#47;&#47; Walks the hashed storage table entries for a given address and calculates the storage root.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; # Returns</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; The storage root and storage trie updates for a given address.</span>
<span class="term-fg32">+    pub fn root_with_updates(self) -&gt; Result&lt;(B256, usize, StorageTrieUpdates), StorageRootError&gt; {</span>
<span class="term-fg32">+        self.calculate(true)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Walks the hashed storage table entries for a given address and calculates the storage root.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; # Returns</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; The storage root.</span>
<span class="term-fg32">+    pub fn root(self) -&gt; Result&lt;B256, StorageRootError&gt; {</span>
<span class="term-fg32">+        let (root, _, _) = self.calculate(false)?;</span>
<span class="term-fg32">+        Ok(root)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Walks the hashed storage table entries for a given address and calculates the storage root.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; # Returns</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; The storage root, number of walked entries and trie updates</span>
<span class="term-fg32">+    &#47;&#47;&#47; for a given address if requested.</span>
<span class="term-fg32">+    pub fn calculate(</span>
<span class="term-fg32">+        self,</span>
<span class="term-fg32">+        retain_updates: bool,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;(B256, usize, StorageTrieUpdates), StorageRootError&gt; {</span>
<span class="term-fg32">+        trace!(target: &quot;trie::storage_root&quot;, hashed_address = ?self.hashed_address, &quot;calculating storage root&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut hashed_storage_cursor =</span>
<span class="term-fg32">+            self.hashed_cursor_factory.hashed_storage_cursor(self.hashed_address)?;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; short circuit on empty storage</span>
<span class="term-fg32">+        if hashed_storage_cursor.is_storage_empty()? {</span>
<span class="term-fg32">+            return Ok((EMPTY_ROOT_HASH, 0, StorageTrieUpdates::deleted()))</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut tracker = TrieTracker::default();</span>
<span class="term-fg32">+        let trie_cursor = self.trie_cursor_factory.storage_trie_cursor(self.hashed_address)?;</span>
<span class="term-fg32">+        let walker =</span>
<span class="term-fg32">+            TrieWalker::new(trie_cursor, self.prefix_set).with_deletions_retained(retain_updates);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut hash_builder = HashBuilder::default().with_updates(retain_updates);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut storage_node_iter = TrieNodeIter::new(walker, hashed_storage_cursor);</span>
<span class="term-fg32">+        while let Some(node) = storage_node_iter.try_next()? {</span>
<span class="term-fg32">+            match node {</span>
<span class="term-fg32">+                TrieElement::Branch(node) =&gt; {</span>
<span class="term-fg32">+                    tracker.inc_branch();</span>
<span class="term-fg32">+                    hash_builder.add_branch(node.key, node.value, node.children_are_in_trie);</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                TrieElement::Leaf(hashed_slot, value) =&gt; {</span>
<span class="term-fg32">+                    let hashed_value = PoseidonValueHasher::hash_storage(value);</span>
<span class="term-fg32">+                    tracker.inc_leaf();</span>
<span class="term-fg32">+                    hash_builder.add_leaf(Nibbles::unpack_bits(hashed_slot), hashed_value.as_ref());</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let root = hash_builder.root();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut trie_updates = StorageTrieUpdates::default();</span>
<span class="term-fg32">+        let removed_keys = storage_node_iter.walker.take_removed_keys();</span>
<span class="term-fg32">+        trie_updates.finalize(hash_builder.into(), removed_keys);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let stats = tracker.finish();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        #[cfg(feature = &quot;metrics&quot;)]</span>
<span class="term-fg32">+        self.metrics.record(stats);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        trace!(</span>
<span class="term-fg32">+            target: &quot;trie::storage_root&quot;,</span>
<span class="term-fg32">+            %root,</span>
<span class="term-fg32">+            hashed_address = %self.hashed_address,</span>
<span class="term-fg32">+            duration = ?stats.duration(),</span>
<span class="term-fg32">+            branches_added = stats.branches_added(),</span>
<span class="term-fg32">+            leaves_added = stats.leaves_added(),</span>
<span class="term-fg32">+            &quot;calculated storage root&quot;</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let storage_slots_walked = stats.leaves_added() as usize;</span>
<span class="term-fg32">+        Ok((root, storage_slots_walked, trie_updates))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use reth_trie_db::{</span>
<span class="term-fg32">+    DatabaseHashedCursorFactory, DatabaseStateRoot, DatabaseStorageRoot, DatabaseTrieCursorFactory,</span>
<span class="term-fg32">+    PrefixSetLoader,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use std::ops::RangeInclusive;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;&#39;a, TX: DbTx&gt; DatabaseStateRoot&lt;&#39;a, TX&gt;</span>
<span class="term-fg32">+    for StateRoot&lt;DatabaseTrieCursorFactory&lt;&#39;a, TX&gt;, DatabaseHashedCursorFactory&lt;&#39;a, TX&gt;&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn from_tx(tx: &amp;&#39;a TX) -&gt; Self {</span>
<span class="term-fg32">+        Self::new(DatabaseTrieCursorFactory::new(tx), DatabaseHashedCursorFactory::new(tx))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn incremental_root_calculator(</span>
<span class="term-fg32">+        tx: &amp;&#39;a TX,</span>
<span class="term-fg32">+        range: RangeInclusive&lt;BlockNumber&gt;,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;Self, StateRootError&gt; {</span>
<span class="term-fg32">+        let loaded_prefix_sets = PrefixSetLoader::&lt;_, PoseidonKeyHasher&gt;::new(tx).load(range)?;</span>
<span class="term-fg32">+        Ok(Self::from_tx(tx).with_prefix_sets(loaded_prefix_sets))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn incremental_root(</span>
<span class="term-fg32">+        tx: &amp;&#39;a TX,</span>
<span class="term-fg32">+        range: RangeInclusive&lt;BlockNumber&gt;,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;B256, StateRootError&gt; {</span>
<span class="term-fg32">+        debug!(target: &quot;trie::loader&quot;, ?range, &quot;incremental state root&quot;);</span>
<span class="term-fg32">+        Self::incremental_root_calculator(tx, range)?.root()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn incremental_root_with_updates(</span>
<span class="term-fg32">+        tx: &amp;&#39;a TX,</span>
<span class="term-fg32">+        range: RangeInclusive&lt;BlockNumber&gt;,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;(B256, TrieUpdates), StateRootError&gt; {</span>
<span class="term-fg32">+        debug!(target: &quot;trie::loader&quot;, ?range, &quot;incremental state root&quot;);</span>
<span class="term-fg32">+        Self::incremental_root_calculator(tx, range)?.root_with_updates()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn incremental_root_with_progress(</span>
<span class="term-fg32">+        tx: &amp;&#39;a TX,</span>
<span class="term-fg32">+        range: RangeInclusive&lt;BlockNumber&gt;,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;StateRootProgress, StateRootError&gt; {</span>
<span class="term-fg32">+        debug!(target: &quot;trie::loader&quot;, ?range, &quot;incremental state root with progress&quot;);</span>
<span class="term-fg32">+        Self::incremental_root_calculator(tx, range)?.root_with_progress()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn overlay_root(tx: &amp;&#39;a TX, post_state: HashedPostState) -&gt; Result&lt;B256, StateRootError&gt; {</span>
<span class="term-fg32">+        let prefix_sets = post_state.construct_prefix_sets().freeze();</span>
<span class="term-fg32">+        let state_sorted = post_state.into_sorted();</span>
<span class="term-fg32">+        StateRoot::new(</span>
<span class="term-fg32">+            DatabaseTrieCursorFactory::new(tx),</span>
<span class="term-fg32">+            HashedPostStateCursorFactory::new(DatabaseHashedCursorFactory::new(tx), &amp;state_sorted),</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+        .with_prefix_sets(prefix_sets)</span>
<span class="term-fg32">+        .root()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn overlay_root_with_updates(</span>
<span class="term-fg32">+        tx: &amp;&#39;a TX,</span>
<span class="term-fg32">+        post_state: HashedPostState,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;(B256, TrieUpdates, HashedPostStateSorted), StateRootError&gt; {</span>
<span class="term-fg32">+        let prefix_sets = post_state.construct_prefix_sets().freeze();</span>
<span class="term-fg32">+        let state_sorted = post_state.into_sorted();</span>
<span class="term-fg32">+        let (root, updates) = StateRoot::new(</span>
<span class="term-fg32">+            DatabaseTrieCursorFactory::new(tx),</span>
<span class="term-fg32">+            HashedPostStateCursorFactory::new(DatabaseHashedCursorFactory::new(tx), &amp;state_sorted),</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+        .with_prefix_sets(prefix_sets)</span>
<span class="term-fg32">+        .root_with_updates()?;</span>
<span class="term-fg32">+        Ok((root, updates, state_sorted))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn overlay_root_from_nodes(tx: &amp;&#39;a TX, input: TrieInput) -&gt; Result&lt;B256, StateRootError&gt; {</span>
<span class="term-fg32">+        let state_sorted = input.state.into_sorted();</span>
<span class="term-fg32">+        let nodes_sorted = input.nodes.into_sorted();</span>
<span class="term-fg32">+        StateRoot::new(</span>
<span class="term-fg32">+            InMemoryTrieCursorFactory::new(DatabaseTrieCursorFactory::new(tx), &amp;nodes_sorted),</span>
<span class="term-fg32">+            HashedPostStateCursorFactory::new(DatabaseHashedCursorFactory::new(tx), &amp;state_sorted),</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+        .with_prefix_sets(input.prefix_sets.freeze())</span>
<span class="term-fg32">+        .root()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn overlay_root_from_nodes_with_updates(</span>
<span class="term-fg32">+        tx: &amp;&#39;a TX,</span>
<span class="term-fg32">+        input: TrieInput,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;(B256, TrieUpdates), StateRootError&gt; {</span>
<span class="term-fg32">+        let state_sorted = input.state.into_sorted();</span>
<span class="term-fg32">+        let nodes_sorted = input.nodes.into_sorted();</span>
<span class="term-fg32">+        StateRoot::new(</span>
<span class="term-fg32">+            InMemoryTrieCursorFactory::new(DatabaseTrieCursorFactory::new(tx), &amp;nodes_sorted),</span>
<span class="term-fg32">+            HashedPostStateCursorFactory::new(DatabaseHashedCursorFactory::new(tx), &amp;state_sorted),</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+        .with_prefix_sets(input.prefix_sets.freeze())</span>
<span class="term-fg32">+        .root_with_updates()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn root(tx: &amp;&#39;a TX) -&gt; Result&lt;B256, StateRootError&gt; {</span>
<span class="term-fg32">+        Self::from_tx(tx).root()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn root_with_updates(tx: &amp;&#39;a TX) -&gt; Result&lt;(B256, TrieUpdates), StateRootError&gt; {</span>
<span class="term-fg32">+        Self::from_tx(tx).root_with_updates()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn root_from_prefix_sets_with_updates(</span>
<span class="term-fg32">+        tx: &amp;&#39;a TX,</span>
<span class="term-fg32">+        prefix_sets: TriePrefixSets,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;(B256, TrieUpdates), StateRootError&gt; {</span>
<span class="term-fg32">+        Self::from_tx(tx).with_prefix_sets(prefix_sets).root_with_updates()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn root_with_progress(</span>
<span class="term-fg32">+        tx: &amp;&#39;a TX,</span>
<span class="term-fg32">+        state: Option&lt;IntermediateStateRootState&gt;,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;StateRootProgress, StateRootError&gt; {</span>
<span class="term-fg32">+        Self::from_tx(tx).with_intermediate_state(state).root_with_progress()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;&#39;a, TX: DbTx&gt; DatabaseStorageRoot&lt;&#39;a, TX&gt;</span>
<span class="term-fg32">+    for StorageRoot&lt;DatabaseTrieCursorFactory&lt;&#39;a, TX&gt;, DatabaseHashedCursorFactory&lt;&#39;a, TX&gt;&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn from_tx(tx: &amp;&#39;a TX, address: Address) -&gt; Self {</span>
<span class="term-fg32">+        Self::new(</span>
<span class="term-fg32">+            DatabaseTrieCursorFactory::new(tx),</span>
<span class="term-fg32">+            DatabaseHashedCursorFactory::new(tx),</span>
<span class="term-fg32">+            address,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;metrics&quot;)]</span>
<span class="term-fg32">+            TrieRootMetrics::new(TrieType::Storage),</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn from_tx_hashed(tx: &amp;&#39;a TX, hashed_address: B256) -&gt; Self {</span>
<span class="term-fg32">+        Self::new_hashed(</span>
<span class="term-fg32">+            DatabaseTrieCursorFactory::new(tx),</span>
<span class="term-fg32">+            DatabaseHashedCursorFactory::new(tx),</span>
<span class="term-fg32">+            hashed_address,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;metrics&quot;)]</span>
<span class="term-fg32">+            TrieRootMetrics::new(TrieType::Storage),</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn overlay_root(</span>
<span class="term-fg32">+        tx: &amp;&#39;a TX,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        hashed_storage: HashedStorage,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;B256, StorageRootError&gt; {</span>
<span class="term-fg32">+        let prefix_set = hashed_storage.construct_prefix_set().freeze();</span>
<span class="term-fg32">+        let state_sorted = HashedPostState::from_hashed_storage(</span>
<span class="term-fg32">+            PoseidonKeyHasher::hash_key(address),</span>
<span class="term-fg32">+            hashed_storage,</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+        .into_sorted();</span>
<span class="term-fg32">+        StorageRoot::new(</span>
<span class="term-fg32">+            DatabaseTrieCursorFactory::new(tx),</span>
<span class="term-fg32">+            HashedPostStateCursorFactory::new(DatabaseHashedCursorFactory::new(tx), &amp;state_sorted),</span>
<span class="term-fg32">+            address,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;metrics&quot;)]</span>
<span class="term-fg32">+            TrieRootMetrics::new(TrieType::Storage),</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+        .with_prefix_set(prefix_set)</span>
<span class="term-fg32">+        .root()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fac209fda22e79aeaadbbac0" role="button"
                       aria-expanded="false" aria-controls="id-fac209fda22e79aeaadbbac0">
                        <code>crates/scroll/state-commitment/src/root/utils.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/state-commitment/src/root/utils.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+66</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fac209fda22e79aeaadbbac0"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;root&#47;utils.rs scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;root&#47;utils.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..e51bbef53b7f24c20393e1c1f78fd00afd0d0e89</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;root&#47;utils.rs</span>
<span class="term-fg36">@@ -0,0 +1,66 @@</span>
<span class="term-fg32">+&#47;&#47;! Utilities for computing state root and storage root from a plain provided state.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use crate::{PoseidonKeyHasher, PoseidonValueHasher, ScrollTrieAccount};</span>
<span class="term-fg32">+use alloy_primitives::{Address, B256, U256};</span>
<span class="term-fg32">+use itertools::Itertools;</span>
<span class="term-fg32">+use reth_scroll_trie::HashBuilder;</span>
<span class="term-fg32">+use reth_trie::{BitsCompatibility, KeyHasher, Nibbles};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Hashes and sorts account keys, then proceeds to calculating the root hash of the state</span>
<span class="term-fg32">+&#47;&#47;&#47; represented as MPT.</span>
<span class="term-fg32">+pub fn state_root_ref_unhashed&lt;&#39;a, A: Into&lt;ScrollTrieAccount&gt; + Clone + &#39;a&gt;(</span>
<span class="term-fg32">+    state: impl IntoIterator&lt;Item = (&amp;&#39;a Address, &amp;&#39;a A)&gt;,</span>
<span class="term-fg32">+) -&gt; B256 {</span>
<span class="term-fg32">+    state_root_unsorted(</span>
<span class="term-fg32">+        state</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|(address, account)| (PoseidonKeyHasher::hash_key(address), account.clone())),</span>
<span class="term-fg32">+    )</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Sorts the hashed account keys and calculates the root hash of the state represented as MPT.</span>
<span class="term-fg32">+pub fn state_root_unsorted&lt;A: Into&lt;ScrollTrieAccount&gt;&gt;(</span>
<span class="term-fg32">+    state: impl IntoIterator&lt;Item = (B256, A)&gt;,</span>
<span class="term-fg32">+) -&gt; B256 {</span>
<span class="term-fg32">+    state_root(state.into_iter().sorted_unstable_by_key(|(key, _)| *key))</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Calculates the root hash of the state represented as BMPT.</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; # Panics</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; If the items are not in sorted order.</span>
<span class="term-fg32">+pub fn state_root&lt;A: Into&lt;ScrollTrieAccount&gt;&gt;(state: impl IntoIterator&lt;Item = (B256, A)&gt;) -&gt; B256 {</span>
<span class="term-fg32">+    let mut hb = HashBuilder::default();</span>
<span class="term-fg32">+    for (hashed_key, account) in state {</span>
<span class="term-fg32">+        let account_hash = PoseidonValueHasher::hash_account(account.into());</span>
<span class="term-fg32">+        hb.add_leaf(Nibbles::unpack_bits(hashed_key), account_hash.as_slice());</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+    hb.root()</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Hashes storage keys, sorts them and them calculates the root hash of the storage trie.</span>
<span class="term-fg32">+pub fn storage_root_unhashed(storage: impl IntoIterator&lt;Item = (B256, U256)&gt;) -&gt; B256 {</span>
<span class="term-fg32">+    storage_root_unsorted(</span>
<span class="term-fg32">+        storage.into_iter().map(|(slot, value)| (PoseidonKeyHasher::hash_key(slot), value)),</span>
<span class="term-fg32">+    )</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Sorts and calculates the root hash of account storage trie.</span>
<span class="term-fg32">+pub fn storage_root_unsorted(storage: impl IntoIterator&lt;Item = (B256, U256)&gt;) -&gt; B256 {</span>
<span class="term-fg32">+    storage_root(storage.into_iter().sorted_unstable_by_key(|(key, _)| *key))</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Calculates the root hash of account storage trie.</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; # Panics</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; If the items are not in sorted order.</span>
<span class="term-fg32">+pub fn storage_root(storage: impl IntoIterator&lt;Item = (B256, U256)&gt;) -&gt; B256 {</span>
<span class="term-fg32">+    let mut hb = HashBuilder::default();</span>
<span class="term-fg32">+    for (hashed_slot, value) in storage {</span>
<span class="term-fg32">+        let hashed_value = PoseidonValueHasher::hash_storage(value);</span>
<span class="term-fg32">+        hb.add_leaf(Nibbles::unpack_bits(hashed_slot), hashed_value.as_ref());</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+    hb.root()</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4e94a742e2ee7c777b7aab9a" role="button"
                       aria-expanded="false" aria-controls="id-4e94a742e2ee7c777b7aab9a">
                        <code>crates/scroll/state-commitment/src/test.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/state-commitment/src/test.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+328</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4e94a742e2ee7c777b7aab9a"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;test.rs scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;test.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..24cb205f190ff251139a25d7d81faeaeb2fc4ef6</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;test.rs</span>
<span class="term-fg36">@@ -0,0 +1,328 @@</span>
<span class="term-fg32">+#![allow(missing_docs)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use alloy_primitives::{Address, Uint, B256, U256};</span>
<span class="term-fg32">+use proptest::{prelude::ProptestConfig, proptest};</span>
<span class="term-fg32">+use proptest_arbitrary_interop::arb;</span>
<span class="term-fg32">+use reth_db::{</span>
<span class="term-fg32">+    cursor::{DbCursorRO, DbCursorRW, DbDupCursorRW},</span>
<span class="term-fg32">+    tables,</span>
<span class="term-fg32">+    transaction::DbTxMut,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_primitives::{Account, StorageEntry};</span>
<span class="term-fg32">+use reth_provider::{test_utils::create_test_provider_factory, StorageTrieWriter, TrieWriter};</span>
<span class="term-fg32">+use reth_scroll_state_commitment::{test_utils::*, PoseidonKeyHasher, StateRoot, StorageRoot};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use reth_scroll_state_commitment::state_root_unsorted;</span>
<span class="term-fg32">+use reth_trie::{</span>
<span class="term-fg32">+    prefix_set::{PrefixSetMut, TriePrefixSets},</span>
<span class="term-fg32">+    trie_cursor::InMemoryTrieCursorFactory,</span>
<span class="term-fg32">+    updates::TrieUpdates,</span>
<span class="term-fg32">+    BitsCompatibility, HashedPostState, HashedStorage, KeyHasher, Nibbles,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_trie_db::{DatabaseStateRoot, DatabaseStorageRoot, DatabaseTrieCursorFactory};</span>
<span class="term-fg32">+use std::collections::BTreeMap;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+proptest! {</span>
<span class="term-fg32">+    #![proptest_config(ProptestConfig {</span>
<span class="term-fg32">+        cases: 12, ..ProptestConfig::default()</span>
<span class="term-fg32">+    })]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn fuzz_in_memory_account_nodes(mut init_state: BTreeMap&lt;B256, (u32, U256, Option&lt;(B256, B256, u64)&gt;)&gt;, state_updates: [BTreeMap&lt;B256, Option&lt;U256&gt;&gt;; 10]) {</span>
<span class="term-fg32">+        let init_state: BTreeMap&lt;B256, Account&gt; = init_state.into_iter().map(|(hashed_address, (nonce, balance, code))| {</span>
<span class="term-fg32">+            let hashed_address = b256_clear_last_byte(hashed_address);</span>
<span class="term-fg32">+            let balance = u256_clear_msb(balance);</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            let account_extension = code.map( |(_, code_hash, code_size)| (code_size, b256_clear_first_byte(code_hash)).into()).or_else(|| Some(Default::default()));</span>
<span class="term-fg32">+            let account = Account { balance, nonce: nonce.into(), bytecode_hash: code.as_ref().map(|(code_hash, _, _)| *code_hash),</span>
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension</span>
<span class="term-fg32">+            };</span>
<span class="term-fg32">+            (hashed_address, account)</span>
<span class="term-fg32">+        }).collect();</span>
<span class="term-fg32">+        let state_updates: Vec&lt;BTreeMap&lt;_, _&gt;&gt; = state_updates.into_iter().map(|update| {</span>
<span class="term-fg32">+            update.into_iter().map(|(hashed_address, update)| {</span>
<span class="term-fg32">+                let hashed_address = b256_clear_last_byte(hashed_address);</span>
<span class="term-fg32">+                let account = update.map(|balance| Account {</span>
<span class="term-fg32">+                    balance: u256_clear_msb(balance),</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(Default::default()),</span>
<span class="term-fg32">+                    ..Default::default() });</span>
<span class="term-fg32">+                (hashed_address, account)</span>
<span class="term-fg32">+            }).collect::&lt;BTreeMap&lt;_, _&gt;&gt;()</span>
<span class="term-fg32">+        }).collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let factory = create_test_provider_factory();</span>
<span class="term-fg32">+        let provider = factory.provider_rw().unwrap();</span>
<span class="term-fg32">+        let mut hashed_account_cursor = provider.tx_ref().cursor_write::&lt;tables::HashedAccounts&gt;().unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; Insert init state into database</span>
<span class="term-fg32">+        for (hashed_address, account) in init_state.clone() {</span>
<span class="term-fg32">+            hashed_account_cursor.upsert(b256_reverse_bits(hashed_address), account).unwrap();</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; Compute initial root and updates</span>
<span class="term-fg32">+        let (_, mut trie_nodes) = StateRoot::from_tx(provider.tx_ref())</span>
<span class="term-fg32">+            .root_with_updates()</span>
<span class="term-fg32">+            .unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut state = init_state;</span>
<span class="term-fg32">+        for state_update in state_updates {</span>
<span class="term-fg32">+            &#47;&#47; Insert state updates into database</span>
<span class="term-fg32">+            let mut hashed_state = HashedPostState::default();</span>
<span class="term-fg32">+            for (hashed_address, account) in state_update {</span>
<span class="term-fg32">+                if let Some(account) = account {</span>
<span class="term-fg32">+                    hashed_account_cursor.upsert(b256_reverse_bits(hashed_address), account).unwrap();</span>
<span class="term-fg32">+                    hashed_state.accounts.insert(b256_reverse_bits(hashed_address), Some(account));</span>
<span class="term-fg32">+                    state.insert(hashed_address, account);</span>
<span class="term-fg32">+                } else {</span>
<span class="term-fg32">+                    hashed_state.accounts.insert(b256_reverse_bits(hashed_address), None);</span>
<span class="term-fg32">+                    state.remove(&amp;hashed_address);</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; Compute root with in-memory trie nodes overlay</span>
<span class="term-fg32">+            let (state_root, trie_updates) = StateRoot::from_tx(provider.tx_ref())</span>
<span class="term-fg32">+                .with_prefix_sets(hashed_state.construct_prefix_sets().freeze())</span>
<span class="term-fg32">+                .with_trie_cursor_factory(InMemoryTrieCursorFactory::new(</span>
<span class="term-fg32">+                    DatabaseTrieCursorFactory::new(provider.tx_ref()), &amp;trie_nodes.clone().into_sorted())</span>
<span class="term-fg32">+                )</span>
<span class="term-fg32">+                .root_with_updates()</span>
<span class="term-fg32">+                .unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            trie_nodes.extend(trie_updates);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; Verify the result</span>
<span class="term-fg32">+            let expected_root = reth_scroll_state_commitment::test_utils::state_root(</span>
<span class="term-fg32">+                state.iter().map(|(key, account)| (*key, (*account, std::iter::empty())))</span>
<span class="term-fg32">+            );</span>
<span class="term-fg32">+            assert_eq!(expected_root.0, state_root.0);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn fuzz_in_memory_storage_nodes(mut init_storage: BTreeMap&lt;B256, U256&gt;, storage_updates: [(bool, BTreeMap&lt;B256, U256&gt;); 10]) {</span>
<span class="term-fg32">+        let hashed_address = B256::random();</span>
<span class="term-fg32">+        let factory = create_test_provider_factory();</span>
<span class="term-fg32">+        let provider = factory.provider_rw().unwrap();</span>
<span class="term-fg32">+        let mut hashed_storage_cursor =</span>
<span class="term-fg32">+            provider.tx_ref().cursor_write::&lt;tables::HashedStorages&gt;().unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; Insert init state into database</span>
<span class="term-fg32">+        let init_storage: BTreeMap&lt;B256, U256&gt; = init_storage.into_iter().map(|(slot, value)| {</span>
<span class="term-fg32">+            let hashed_slot = b256_clear_last_byte(slot);</span>
<span class="term-fg32">+            hashed_storage_cursor</span>
<span class="term-fg32">+                .upsert(hashed_address, StorageEntry { key: b256_reverse_bits(hashed_slot), value })</span>
<span class="term-fg32">+                .unwrap();</span>
<span class="term-fg32">+            (hashed_slot, value)</span>
<span class="term-fg32">+        }).collect();</span>
<span class="term-fg32">+        let storage_updates: Vec&lt;(bool, BTreeMap&lt;B256, U256&gt;)&gt; = storage_updates.into_iter().map(|(is_deleted, updates)| {</span>
<span class="term-fg32">+            let updates = updates.into_iter().map(|(slot, value)| {</span>
<span class="term-fg32">+                let slot = b256_clear_last_byte(slot);</span>
<span class="term-fg32">+                (slot, value)</span>
<span class="term-fg32">+            }).collect();</span>
<span class="term-fg32">+            (is_deleted, updates)</span>
<span class="term-fg32">+        }).collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; Compute initial storage root and updates</span>
<span class="term-fg32">+        let (_, _, mut storage_trie_nodes) =</span>
<span class="term-fg32">+            StorageRoot::from_tx_hashed(provider.tx_ref(), hashed_address).root_with_updates().unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut storage = init_storage;</span>
<span class="term-fg32">+        for (is_deleted, mut storage_update) in storage_updates {</span>
<span class="term-fg32">+            &#47;&#47; Insert state updates into database</span>
<span class="term-fg32">+            if is_deleted &amp;&amp; hashed_storage_cursor.seek_exact(hashed_address).unwrap().is_some() {</span>
<span class="term-fg32">+                hashed_storage_cursor.delete_current_duplicates().unwrap();</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            let mut hashed_storage = HashedStorage::new(is_deleted);</span>
<span class="term-fg32">+            for (hashed_slot, value) in storage_update.clone() {</span>
<span class="term-fg32">+                hashed_storage_cursor</span>
<span class="term-fg32">+                    .upsert(hashed_address, StorageEntry { key: b256_reverse_bits(hashed_slot), value })</span>
<span class="term-fg32">+                    .unwrap();</span>
<span class="term-fg32">+                hashed_storage.storage.insert(b256_reverse_bits(hashed_slot), value);</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; Compute root with in-memory trie nodes overlay</span>
<span class="term-fg32">+            let mut trie_nodes = TrieUpdates::default();</span>
<span class="term-fg32">+            trie_nodes.insert_storage_updates(hashed_address, storage_trie_nodes.clone());</span>
<span class="term-fg32">+            let (storage_root, _, trie_updates) =</span>
<span class="term-fg32">+                StorageRoot::from_tx_hashed(provider.tx_ref(), hashed_address)</span>
<span class="term-fg32">+                    .with_prefix_set(hashed_storage.construct_prefix_set().freeze())</span>
<span class="term-fg32">+                    .with_trie_cursor_factory(InMemoryTrieCursorFactory::new(</span>
<span class="term-fg32">+                        DatabaseTrieCursorFactory::new(provider.tx_ref()),</span>
<span class="term-fg32">+                        &amp;trie_nodes.into_sorted(),</span>
<span class="term-fg32">+                    ))</span>
<span class="term-fg32">+                    .root_with_updates()</span>
<span class="term-fg32">+                    .unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            storage_trie_nodes.extend(trie_updates);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; Verify the result</span>
<span class="term-fg32">+            if is_deleted {</span>
<span class="term-fg32">+                storage.clear();</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            storage.append(&amp;mut storage_update);</span>
<span class="term-fg32">+            let expected_root = reth_scroll_state_commitment::test_utils::storage_root(storage.clone());</span>
<span class="term-fg32">+            assert_eq!(expected_root, storage_root);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn fuzz_state_root_incremental_database(account_changes: [BTreeMap&lt;B256, U256&gt;; 5]) {</span>
<span class="term-fg32">+        let factory = create_test_provider_factory();</span>
<span class="term-fg32">+        let tx = factory.provider_rw().unwrap();</span>
<span class="term-fg32">+        let mut hashed_account_cursor = tx.tx_ref().cursor_write::&lt;tables::HashedAccounts&gt;().unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut state = BTreeMap::default();</span>
<span class="term-fg32">+        for accounts in account_changes {</span>
<span class="term-fg32">+            let should_generate_changeset = !state.is_empty();</span>
<span class="term-fg32">+            let mut changes = PrefixSetMut::default();</span>
<span class="term-fg32">+            let accounts = accounts.into_iter().map(|(hashed_address, balance)| {</span>
<span class="term-fg32">+                let balance = u256_clear_msb(balance);</span>
<span class="term-fg32">+                let hashed_address = b256_clear_last_byte(hashed_address);</span>
<span class="term-fg32">+                (hashed_address, balance)</span>
<span class="term-fg32">+            }).collect::&lt;BTreeMap&lt;_, _&gt;&gt;();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            for (hashed_address, balance) in accounts.clone() {</span>
<span class="term-fg32">+                hashed_account_cursor.upsert(hashed_address, Account { balance, ..Default::default() }).unwrap();</span>
<span class="term-fg32">+                if should_generate_changeset {</span>
<span class="term-fg32">+                    changes.insert(Nibbles::unpack_bits(hashed_address));</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            let (state_root, trie_updates) = StateRoot::from_tx(tx.tx_ref())</span>
<span class="term-fg32">+                .with_prefix_sets(TriePrefixSets { account_prefix_set: changes.freeze(), ..Default::default() })</span>
<span class="term-fg32">+                .root_with_updates()</span>
<span class="term-fg32">+                .unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            state.append(&amp;mut accounts.clone());</span>
<span class="term-fg32">+            let expected_root = state_root_unsorted(</span>
<span class="term-fg32">+                state.iter().map(|(&amp;key, &amp;balance)| (key, (Account { balance, ..Default::default() }, B256::default())))</span>
<span class="term-fg32">+            );</span>
<span class="term-fg32">+            assert_eq!(expected_root, state_root);</span>
<span class="term-fg32">+            tx.write_trie_updates(&amp;trie_updates).unwrap();</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn incremental_storage_root_database(address: Address, storage_changes: [BTreeMap&lt;B256, U256&gt;; 5]) {</span>
<span class="term-fg32">+        let hashed_address = PoseidonKeyHasher::hash_key(address);</span>
<span class="term-fg32">+        let factory = create_test_provider_factory();</span>
<span class="term-fg32">+        let tx = factory.provider_rw().unwrap();</span>
<span class="term-fg32">+        let mut hashed_storage_cursor = tx.tx_ref().cursor_write::&lt;tables::HashedStorages&gt;().unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut storage = BTreeMap::default();</span>
<span class="term-fg32">+        for change_set in storage_changes {</span>
<span class="term-fg32">+            let should_generate_changeset =  !storage.is_empty();</span>
<span class="term-fg32">+            let mut changes = PrefixSetMut::default();</span>
<span class="term-fg32">+            let change_set = change_set.into_iter().map(|(slot, value)| {</span>
<span class="term-fg32">+                let slot = b256_clear_last_byte(slot);</span>
<span class="term-fg32">+                (slot, value)</span>
<span class="term-fg32">+            }).collect::&lt;BTreeMap&lt;_, _&gt;&gt;();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            for (hashed_slot, value) in change_set.clone() {</span>
<span class="term-fg32">+                hashed_storage_cursor.upsert(hashed_address, StorageEntry { key: hashed_slot, value }).unwrap();</span>
<span class="term-fg32">+                if should_generate_changeset {</span>
<span class="term-fg32">+                    changes.insert(Nibbles::unpack_bits(hashed_slot));</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            let (storage_root, _, trie_updates) = StorageRoot::from_tx_hashed(tx.tx_ref(), hashed_address)</span>
<span class="term-fg32">+                .with_prefix_set(changes.freeze())</span>
<span class="term-fg32">+                .root_with_updates()</span>
<span class="term-fg32">+                .unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            storage.append(&amp;mut change_set.clone());</span>
<span class="term-fg32">+            let expected_root = reth_scroll_state_commitment::storage_root_unsorted(storage.clone());</span>
<span class="term-fg32">+            assert_eq!(expected_root, storage_root);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            tx.write_individual_storage_trie_updates(hashed_address, &amp;trie_updates).unwrap();</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[test]</span>
<span class="term-fg32">+fn test_basic_state_root_with_updates_succeeds() {</span>
<span class="term-fg32">+    let address_1 = Address::with_last_byte(0);</span>
<span class="term-fg32">+    let address_2 = Address::with_last_byte(3);</span>
<span class="term-fg32">+    let address_3 = Address::with_last_byte(7);</span>
<span class="term-fg32">+    let account_1 = Account {</span>
<span class="term-fg32">+        balance: Uint::from(1),</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        ..Default::default()</span>
<span class="term-fg32">+    };</span>
<span class="term-fg32">+    let account_2 = Account {</span>
<span class="term-fg32">+        balance: Uint::from(2),</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        ..Default::default()</span>
<span class="term-fg32">+    };</span>
<span class="term-fg32">+    let account_3 = Account {</span>
<span class="term-fg32">+        balance: Uint::from(3),</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        ..Default::default()</span>
<span class="term-fg32">+    };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    let factory = create_test_provider_factory();</span>
<span class="term-fg32">+    let tx = factory.provider_rw().unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    insert_account(tx.tx_ref(), address_1, account_1, &amp;Default::default());</span>
<span class="term-fg32">+    insert_account(tx.tx_ref(), address_2, account_2, &amp;Default::default());</span>
<span class="term-fg32">+    insert_account(tx.tx_ref(), address_3, account_3, &amp;Default::default());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    tx.commit().unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    let tx = factory.provider_rw().unwrap();</span>
<span class="term-fg32">+    let (_root, _updates) = StateRoot::from_tx(tx.tx_ref()).root_with_updates().unwrap();</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+fn insert_account(</span>
<span class="term-fg32">+    tx: &amp;impl DbTxMut,</span>
<span class="term-fg32">+    address: Address,</span>
<span class="term-fg32">+    account: Account,</span>
<span class="term-fg32">+    storage: &amp;BTreeMap&lt;B256, U256&gt;,</span>
<span class="term-fg32">+) {</span>
<span class="term-fg32">+    let hashed_address = PoseidonKeyHasher::hash_key(address);</span>
<span class="term-fg32">+    tx.put::&lt;tables::HashedAccounts&gt;(hashed_address, account).unwrap();</span>
<span class="term-fg32">+    insert_storage(tx, hashed_address, storage);</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+fn insert_storage(tx: &amp;impl DbTxMut, hashed_address: B256, storage: &amp;BTreeMap&lt;B256, U256&gt;) {</span>
<span class="term-fg32">+    for (k, v) in storage {</span>
<span class="term-fg32">+        tx.put::&lt;tables::HashedStorages&gt;(</span>
<span class="term-fg32">+            hashed_address,</span>
<span class="term-fg32">+            StorageEntry { key: PoseidonKeyHasher::hash_key(k), value: *v },</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+        .unwrap();</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[test]</span>
<span class="term-fg32">+fn arbitrary_storage_root() {</span>
<span class="term-fg32">+    proptest!(ProptestConfig::with_cases(10), |(item in arb::&lt;(Address, std::collections::BTreeMap&lt;B256, U256&gt;)&gt;())| {</span>
<span class="term-fg32">+        let (address, storage) = item;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let hashed_address = PoseidonKeyHasher::hash_key(address);</span>
<span class="term-fg32">+        let factory = create_test_provider_factory();</span>
<span class="term-fg32">+        let tx = factory.provider_rw().unwrap();</span>
<span class="term-fg32">+        let storage: BTreeMap&lt;B256, U256&gt; = storage.into_iter().map(|(key, value)|  {</span>
<span class="term-fg32">+            let key = b256_clear_last_byte(key);</span>
<span class="term-fg32">+            tx.tx_ref().put::&lt;tables::HashedStorages&gt;(</span>
<span class="term-fg32">+                hashed_address,</span>
<span class="term-fg32">+                StorageEntry { key, value },</span>
<span class="term-fg32">+            )</span>
<span class="term-fg32">+            .unwrap();</span>
<span class="term-fg32">+            (b256_reverse_bits(key), value)</span>
<span class="term-fg32">+        }).collect();</span>
<span class="term-fg32">+        tx.commit().unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let tx =  factory.provider_rw().unwrap();</span>
<span class="term-fg32">+        let got = StorageRoot::from_tx(tx.tx_ref(), address).root().unwrap();</span>
<span class="term-fg32">+        let expected = reth_scroll_state_commitment::test_utils::storage_root(storage.into_iter());</span>
<span class="term-fg32">+        assert_eq!(expected, got);</span>
<span class="term-fg32">+    });</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-14ec287cf0bef4a081415a9e" role="button"
                       aria-expanded="false" aria-controls="id-14ec287cf0bef4a081415a9e">
                        <code>crates/scroll/state-commitment/src/test_utils.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/state-commitment/src/test_utils.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+112</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-14ec287cf0bef4a081415a9e"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;test_utils.rs scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;test_utils.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..8791c6eeb36a9a30147582381f9d6cf1b7e4f2ee</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;test_utils.rs</span>
<span class="term-fg36">@@ -0,0 +1,112 @@</span>
<span class="term-fg32">+use alloy_consensus::constants::KECCAK_EMPTY;</span>
<span class="term-fg32">+use alloy_primitives::{B256, U256};</span>
<span class="term-fg32">+use poseidon_bn254::{hash_with_domain, Fr, PrimeField};</span>
<span class="term-fg32">+use reth_primitives::Account;</span>
<span class="term-fg32">+use zktrie::HashField;</span>
<span class="term-fg32">+use zktrie_rust::{db::SimpleDb, hash::AsHash, types::Hashable};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+const ACCOUNT_COMPRESSION_FLAG: u32 = 8;</span>
<span class="term-fg32">+const STORAGE_COMPRESSION_FLAG: u32 = 1;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Reverses the ordering of bits in a [`B256`] type.</span>
<span class="term-fg32">+pub fn b256_reverse_bits(b256: B256) -&gt; B256 {</span>
<span class="term-fg32">+    let mut b256 = b256.0;</span>
<span class="term-fg32">+    for byte in &amp;mut b256 {</span>
<span class="term-fg32">+        *byte = byte.reverse_bits();</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+    B256::from(b256)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Clear the last byte of a [`B256`] type.</span>
<span class="term-fg32">+pub fn b256_clear_last_byte(mut b256: B256) -&gt; B256 {</span>
<span class="term-fg32">+    &#47;&#47; set the largest byte to 0</span>
<span class="term-fg32">+    &lt;B256 as AsMut&lt;[u8; 32]&gt;&gt;::as_mut(&amp;mut b256)[31] = 0;</span>
<span class="term-fg32">+    b256</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Clear the first byte of a [`B256`] type.</span>
<span class="term-fg32">+pub fn b256_clear_first_byte(mut b256: B256) -&gt; B256 {</span>
<span class="term-fg32">+    &#47;&#47; set the smallest byte to 0</span>
<span class="term-fg32">+    &lt;B256 as AsMut&lt;[u8; 32]&gt;&gt;::as_mut(&amp;mut b256)[0] = 0;</span>
<span class="term-fg32">+    b256</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Clear the most significant byte of a [`U256`] type.</span>
<span class="term-fg32">+pub fn u256_clear_msb(mut balance: U256) -&gt; U256 {</span>
<span class="term-fg32">+    &#47;&#47; set the most significant 8 bits to 0</span>
<span class="term-fg32">+    unsafe {</span>
<span class="term-fg32">+        balance.as_limbs_mut()[3] &amp;= 0x00FFFFFFFFFFFFFF;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+    balance</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Calculates the state root of a set of accounts and their storage entries using the zktrie</span>
<span class="term-fg32">+&#47;&#47;&#47; implementation.</span>
<span class="term-fg32">+pub fn state_root&lt;I, S&gt;(accounts: I) -&gt; B256</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    I: IntoIterator&lt;Item = (B256, (Account, S))&gt;,</span>
<span class="term-fg32">+    S: IntoIterator&lt;Item = (B256, U256)&gt;,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    let mut trie = zktrie();</span>
<span class="term-fg32">+    for (address, (account, storage)) in accounts {</span>
<span class="term-fg32">+        let key = parse_key_as_hash(address);</span>
<span class="term-fg32">+        let mut account_bytes = Vec::with_capacity(5);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let code_size = account.get_code_size();</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let code_size = 0;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let poseidon_code_hash = account.get_poseidon_code_hash();</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let poseidon_code_hash = B256::default();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        account_bytes.push(U256::from_limbs([account.nonce, code_size, 0, 0]).to_be_bytes());</span>
<span class="term-fg32">+        account_bytes.push(account.balance.to_be_bytes());</span>
<span class="term-fg32">+        account_bytes.push(storage_root(storage).0);</span>
<span class="term-fg32">+        account_bytes.push(account.bytecode_hash.unwrap_or(KECCAK_EMPTY).0);</span>
<span class="term-fg32">+        account_bytes.push(poseidon_code_hash.0);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        trie.try_update(&amp;key, ACCOUNT_COMPRESSION_FLAG, account_bytes).unwrap();</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+    trie.prepare_root().unwrap();</span>
<span class="term-fg32">+    let root = trie.root().to_bytes();</span>
<span class="term-fg32">+    B256::from_slice(&amp;root)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Calculates the storage root of a set of storage entries using the zktrie implementation.</span>
<span class="term-fg32">+pub fn storage_root&lt;S&gt;(storage: S) -&gt; B256</span>
<span class="term-fg32">+where</span>
<span class="term-fg32">+    S: IntoIterator&lt;Item = (B256, U256)&gt;,</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    let mut storage_trie = zktrie();</span>
<span class="term-fg32">+    for (key, value) in storage {</span>
<span class="term-fg32">+        let key = parse_key_as_hash(key);</span>
<span class="term-fg32">+        storage_trie.try_update(&amp;key, STORAGE_COMPRESSION_FLAG, vec![value.to_be_bytes()]).unwrap();</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+    storage_trie.prepare_root().unwrap();</span>
<span class="term-fg32">+    let root = storage_trie.root().to_bytes();</span>
<span class="term-fg32">+    B256::from_slice(&amp;root)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+fn parse_key_as_hash(key: B256) -&gt; AsHash&lt;HashField&gt; {</span>
<span class="term-fg32">+    let mut key = key.0;</span>
<span class="term-fg32">+    key.reverse();</span>
<span class="term-fg32">+    AsHash::from_bytes(&amp;key).unwrap()</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+fn poseidon_hash_scheme(a: &amp;[u8; 32], b: &amp;[u8; 32], domain: &amp;[u8; 32]) -&gt; Option&lt;[u8; 32]&gt; {</span>
<span class="term-fg32">+    let a = Fr::from_repr_vartime(*a)?;</span>
<span class="term-fg32">+    let b = Fr::from_repr_vartime(*b)?;</span>
<span class="term-fg32">+    let domain = Fr::from_repr_vartime(*domain)?;</span>
<span class="term-fg32">+    Some(hash_with_domain(&amp;[a, b], domain).to_repr())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+fn zktrie() -&gt; zktrie_rust::raw::ZkTrieImpl&lt;AsHash&lt;HashField&gt;, SimpleDb, 248&gt; {</span>
<span class="term-fg32">+    zktrie::init_hash_scheme_simple(poseidon_hash_scheme);</span>
<span class="term-fg32">+    zktrie_rust::raw::ZkTrieImpl::&lt;AsHash&lt;HashField&gt;, SimpleDb, 248&gt;::new_zktrie_impl(</span>
<span class="term-fg32">+        SimpleDb::new(),</span>
<span class="term-fg32">+    )</span>
<span class="term-fg32">+    .unwrap()</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9aede30d68a6f02bb5f73b05" role="button"
                       aria-expanded="false" aria-controls="id-9aede30d68a6f02bb5f73b05">
                        <code>crates/scroll/state-commitment/src/value.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/state-commitment/src/value.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+55</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9aede30d68a6f02bb5f73b05"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;value.rs scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;value.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..387d7fd9640843f69ea2e78c1821a60ebb5c8031</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;state-commitment&#47;src&#47;value.rs</span>
<span class="term-fg36">@@ -0,0 +1,55 @@</span>
<span class="term-fg32">+use crate::ScrollTrieAccount;</span>
<span class="term-fg32">+use alloy_primitives::{B256, U256};</span>
<span class="term-fg32">+use reth_scroll_primitives::poseidon::{</span>
<span class="term-fg32">+    field_element_from_be_bytes, hash_with_domain, split_and_hash_be_bytes, FieldElementBytes, Fr,</span>
<span class="term-fg32">+    PrimeField, DOMAIN_MULTIPLIER_PER_FIELD_ELEMENT,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; An implementation of a value hasher that uses Poseidon.</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; This hash provides hashing of a [`ScrollTrieAccount`] and a storage entry ([`U256`]).</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct PoseidonValueHasher;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl PoseidonValueHasher {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The number of field elements in the account hashing.</span>
<span class="term-fg32">+    const ACCOUNT_HASHING_FIELD_ELEMENTS: u64 = 5;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; The domain for hashing the account.</span>
<span class="term-fg32">+    const ACCOUNT_HASHING_DOMAIN: Fr = Fr::from_raw([</span>
<span class="term-fg32">+        Self::ACCOUNT_HASHING_FIELD_ELEMENTS * DOMAIN_MULTIPLIER_PER_FIELD_ELEMENT,</span>
<span class="term-fg32">+        0,</span>
<span class="term-fg32">+        0,</span>
<span class="term-fg32">+        0,</span>
<span class="term-fg32">+    ]);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Hashes the account using Poseidon hash function.</span>
<span class="term-fg32">+    pub(crate) fn hash_account(account: ScrollTrieAccount) -&gt; B256 {</span>
<span class="term-fg32">+        &#47;&#47; combine nonce and code size and parse into field element</span>
<span class="term-fg32">+        let nonce_code_size_bytes = field_element_from_be_bytes(</span>
<span class="term-fg32">+            &#47;&#47; TODO(scroll): Replace with native handling of bytes instead of using U256.</span>
<span class="term-fg32">+            U256::from_limbs([account.nonce, account.code_size, 0, 0]).to_be_bytes(),</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; parse remaining field elements</span>
<span class="term-fg32">+        let balance = field_element_from_be_bytes(account.balance.to_be_bytes());</span>
<span class="term-fg32">+        let keccak_code_hash = split_and_hash_be_bytes(account.code_hash);</span>
<span class="term-fg32">+        let storage_root = field_element_from_be_bytes(account.storage_root.0);</span>
<span class="term-fg32">+        let poseidon_code_hash = field_element_from_be_bytes(account.poseidon_code_hash.0);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; hash field elements</span>
<span class="term-fg32">+        let digest_1 =</span>
<span class="term-fg32">+            hash_with_domain(&amp;[nonce_code_size_bytes, balance], Self::ACCOUNT_HASHING_DOMAIN);</span>
<span class="term-fg32">+        let digest_2 =</span>
<span class="term-fg32">+            hash_with_domain(&amp;[storage_root, keccak_code_hash], Self::ACCOUNT_HASHING_DOMAIN);</span>
<span class="term-fg32">+        let digest = hash_with_domain(&amp;[digest_1, digest_2], Self::ACCOUNT_HASHING_DOMAIN);</span>
<span class="term-fg32">+        let digest = hash_with_domain(&amp;[digest, poseidon_code_hash], Self::ACCOUNT_HASHING_DOMAIN);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        digest.to_repr().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Hashes the storage entry using Poseidon hash function.</span>
<span class="term-fg32">+    pub(crate) fn hash_storage(entry: U256) -&gt; B256 {</span>
<span class="term-fg32">+        split_and_hash_be_bytes::&lt;FieldElementBytes&gt;(entry.to_be_bytes()).to_repr().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4f6ca6519e239304f848b4ab" role="button"
                       aria-expanded="false" aria-controls="id-4f6ca6519e239304f848b4ab">
                        <code>crates/scroll/storage/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/storage/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+37</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4f6ca6519e239304f848b4ab"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;storage&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;storage&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..aad2207902bcff57811370715257613c404a0748</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;storage&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,37 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-storage&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# alloy</span>
<span class="term-fg32">+alloy-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-revm.workspace = true</span>
<span class="term-fg32">+reth-storage-errors.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+reth-scroll-revm.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dev-dependencies]</span>
<span class="term-fg32">+eyre.workspace = true</span>
<span class="term-fg32">+reth-codecs = { workspace = true, features = [&quot;test-utils&quot;] }</span>
<span class="term-fg32">+reth-primitives-traits.workspace = true</span>
<span class="term-fg32">+reth-revm = { workspace = true, features = [&quot;test-utils&quot;] }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c6d7df109b1447dd067b58f5" role="button"
                       aria-expanded="false" aria-controls="id-c6d7df109b1447dd067b58f5">
                        <code>crates/scroll/storage/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/storage/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+185</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c6d7df109b1447dd067b58f5"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;storage&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;storage&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..5e333750e0b23b27f2a0202110854ad4fd01168d</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;storage&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,185 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll storage implementation.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![cfg_attr(all(not(test), feature = &quot;scroll&quot;), warn(unused_crate_dependencies))]</span>
<span class="term-fg32">+&#47;&#47; The `scroll` feature must be enabled to use this crate.</span>
<span class="term-fg32">+#![cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use alloy_primitives::{Address, B256, U256};</span>
<span class="term-fg32">+use reth_revm::{database::EvmStateProvider, primitives::Bytecode, Database, DatabaseRef};</span>
<span class="term-fg32">+use reth_scroll_primitives::{AccountExtension, ScrollPostExecutionContext};</span>
<span class="term-fg32">+use reth_scroll_revm::shared::AccountInfo;</span>
<span class="term-fg32">+use reth_storage_errors::provider::ProviderError;</span>
<span class="term-fg32">+use std::ops::{Deref, DerefMut};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A similar construct as `StateProviderDatabase` which captures additional Scroll context for</span>
<span class="term-fg32">+&#47;&#47;&#47; touched accounts during execution.</span>
<span class="term-fg32">+#[derive(Clone, Debug)]</span>
<span class="term-fg32">+pub struct ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Scroll post execution context.</span>
<span class="term-fg32">+    pub post_execution_context: ScrollPostExecutionContext,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The database.</span>
<span class="term-fg32">+    pub db: DB,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB&gt; Deref for ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    type Target = DB;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn deref(&amp;self) -&gt; &amp;Self::Target {</span>
<span class="term-fg32">+        &amp;self.db</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB&gt; DerefMut for ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    fn deref_mut(&amp;mut self) -&gt; &amp;mut Self::Target {</span>
<span class="term-fg32">+        &amp;mut self.db</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB&gt; ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates a [`ScrollStateProviderDatabase`] from the provided DB.</span>
<span class="term-fg32">+    pub fn new(db: DB) -&gt; Self {</span>
<span class="term-fg32">+        Self { db, post_execution_context: Default::default() }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Consume [`ScrollStateProviderDatabase`] and return inner [`EvmStateProvider`].</span>
<span class="term-fg32">+    pub fn into_inner(self) -&gt; DB {</span>
<span class="term-fg32">+        self.db</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; Database for ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    type Error = ProviderError;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Retrieves basic account information for a given address. Caches the Scroll account extension</span>
<span class="term-fg32">+    &#47;&#47;&#47; for the touched account if it has bytecode.</span>
<span class="term-fg32">+    fn basic(&amp;mut self, address: Address) -&gt; Result&lt;Option&lt;AccountInfo&gt;, Self::Error&gt; {</span>
<span class="term-fg32">+        let Some(account) = self.db.basic_account(address)? else { return Ok(None) };</span>
<span class="term-fg32">+        let Some(code_hash) = account.bytecode_hash else { return Ok(Some(account.into())) };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        if let Some(AccountExtension { code_size, poseidon_code_hash: Some(hash) }) =</span>
<span class="term-fg32">+            account.account_extension</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+            self.post_execution_context.entry(code_hash).or_insert((code_size, hash));</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(Some(account.into()))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn code_by_hash(&amp;mut self, code_hash: B256) -&gt; Result&lt;Bytecode, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.bytecode_by_hash(code_hash)?.unwrap_or_default().0)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn storage(&amp;mut self, address: Address, index: U256) -&gt; Result&lt;U256, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.storage(address, B256::new(index.to_be_bytes()))?.unwrap_or_default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn block_hash(&amp;mut self, number: u64) -&gt; Result&lt;B256, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.block_hash(number)?.unwrap_or_default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; DatabaseRef for ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    type Error = ProviderError;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn basic_ref(&amp;self, address: Address) -&gt; Result&lt;Option&lt;AccountInfo&gt;, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.basic_account(address)?.map(Into::into))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn code_by_hash_ref(&amp;self, code_hash: B256) -&gt; Result&lt;Bytecode, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.bytecode_by_hash(code_hash)?.unwrap_or_default().0)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn storage_ref(&amp;self, address: Address, index: U256) -&gt; Result&lt;U256, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.storage(address, B256::new(index.to_be_bytes()))?.unwrap_or_default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn block_hash_ref(&amp;self, number: u64) -&gt; Result&lt;B256, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.block_hash(number)?.unwrap_or_default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(test)]</span>
<span class="term-fg32">+mod tests {</span>
<span class="term-fg32">+    use crate::ScrollStateProviderDatabase;</span>
<span class="term-fg32">+    use alloy_primitives::{keccak256, Address, Bytes, U256};</span>
<span class="term-fg32">+    use reth_codecs::{test_utils::UnusedBits, validate_bitflag_backwards_compat};</span>
<span class="term-fg32">+    use reth_primitives_traits::Account;</span>
<span class="term-fg32">+    use reth_revm::{test_utils::StateProviderTest, Database};</span>
<span class="term-fg32">+    use reth_scroll_primitives::{poseidon::hash_code, AccountExtension};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_ensure_account_backwards_compatibility() {</span>
<span class="term-fg32">+        &#47;&#47; See `reth-codecs&#47;src&#47;test-utils` for details.</span>
<span class="term-fg32">+        assert_eq!(Account::bitflag_encoded_bytes(), 2);</span>
<span class="term-fg32">+        assert_eq!(AccountExtension::bitflag_encoded_bytes(), 1);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; In case of failure, refer to the documentation of the</span>
<span class="term-fg32">+        &#47;&#47; [`validate_bitflag_backwards_compat`] macro for detailed instructions on handling</span>
<span class="term-fg32">+        &#47;&#47; it.</span>
<span class="term-fg32">+        validate_bitflag_backwards_compat!(Account, UnusedBits::NotZero);</span>
<span class="term-fg32">+        validate_bitflag_backwards_compat!(AccountExtension, UnusedBits::NotZero);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_scroll_post_execution_context() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        let mut db = StateProviderTest::default();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; insert an eoa in the db</span>
<span class="term-fg32">+        let eoa_address = Address::random();</span>
<span class="term-fg32">+        let eoa = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::MAX,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            account_extension: Some(AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        db.insert_account(eoa_address, eoa, None, Default::default());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; insert a contract account in the db</span>
<span class="term-fg32">+        let contract_address = Address::random();</span>
<span class="term-fg32">+        let bytecode = Bytes::copy_from_slice(&amp;[0x0, 0x1, 0x2, 0x3, 0x4, 0x5]);</span>
<span class="term-fg32">+        let bytecode_hash = keccak256(&amp;bytecode);</span>
<span class="term-fg32">+        let contract = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::MAX,</span>
<span class="term-fg32">+            bytecode_hash: Some(bytecode_hash),</span>
<span class="term-fg32">+            account_extension: Some(AccountExtension::from_bytecode(&amp;bytecode)),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        db.insert_account(contract_address, contract, Some(bytecode.clone()), Default::default());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; insert an empty contract account in the db</span>
<span class="term-fg32">+        let empty_contract_address = Address::random();</span>
<span class="term-fg32">+        let empty_bytecode = Bytes::copy_from_slice(&amp;[]);</span>
<span class="term-fg32">+        let empty_contract = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::MAX,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            account_extension: Some(AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        db.insert_account(</span>
<span class="term-fg32">+            empty_contract_address,</span>
<span class="term-fg32">+            empty_contract,</span>
<span class="term-fg32">+            Some(empty_bytecode),</span>
<span class="term-fg32">+            Default::default(),</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut provider = ScrollStateProviderDatabase::new(db);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check eoa is in db</span>
<span class="term-fg32">+        let _ = provider.basic(eoa_address)?.unwrap();</span>
<span class="term-fg32">+        &#47;&#47; check contract is in db</span>
<span class="term-fg32">+        let _ = provider.basic(contract_address)?.unwrap();</span>
<span class="term-fg32">+        &#47;&#47; check empty contract is in db</span>
<span class="term-fg32">+        let _ = provider.basic(empty_contract_address)?.unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check provider context only contains contract</span>
<span class="term-fg32">+        let post_execution_context = provider.post_execution_context;</span>
<span class="term-fg32">+        assert_eq!(post_execution_context.len(), 1);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check post execution context is correct for contract</span>
<span class="term-fg32">+        let (code_size, poseidon_code_hash) = post_execution_context.get(&amp;bytecode_hash).unwrap();</span>
<span class="term-fg32">+        assert_eq!(*code_size, 6);</span>
<span class="term-fg32">+        assert_eq!(*poseidon_code_hash, hash_code(&amp;bytecode));</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a4610d52d971d0d476f2d8db" role="button"
                       aria-expanded="false" aria-controls="id-a4610d52d971d0d476f2d8db">
                        <code>crates/scroll/trie/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/trie/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+25</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a4610d52d971d0d476f2d8db"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;trie&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;trie&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..0c694d6bb0b02a0bb0286b29df6fa7ca264587e2</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;trie&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,26 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-trie&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+reth-trie.workspace = true</span>
<span class="term-fg32">+alloy-trie = { workspace = true, features = [&quot;serde&quot;] }</span>
<span class="term-fg32">+alloy-primitives.workspace = true</span>
<span class="term-fg32">+tracing.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dev-dependencies]</span>
<span class="term-fg32">+hex-literal = &quot;0.4&quot;</span>
<span class="term-fg32">+proptest-arbitrary-interop.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [&quot;reth-trie&#47;scroll&quot;]</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9f6d1dd8c626a65e6aa72b7c" role="button"
                       aria-expanded="false" aria-controls="id-9f6d1dd8c626a65e6aa72b7c">
                        <code>crates/scroll/trie/README.md</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/trie/README.md" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9f6d1dd8c626a65e6aa72b7c"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;trie&#47;README.md scroll-reth&#47;crates&#47;scroll&#47;trie&#47;README.md</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..8645b5efadd58f51d8d04146614741788a95febd</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;trie&#47;README.md</span>
<span class="term-fg36">@@ -0,0 +1,5 @@</span>
<span class="term-fg32">+# scroll-trie</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+Fast binary Merkle-Patricia Trie (zktrie) state root calculator and proof generator for prefix-sorted bits.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+Please see the specification of zktrie [here](assets&#47;zktrie.md).</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d10bb87b209288367719a417" role="button"
                       aria-expanded="false" aria-controls="id-d10bb87b209288367719a417">
                        <code>crates/scroll/trie/assets/arch.png</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/trie/assets/arch.png" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <span class="text-secondary">(binary file)</span>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d10bb87b209288367719a417"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;trie&#47;assets&#47;arch.png scroll-reth&#47;crates&#47;scroll&#47;trie&#47;assets&#47;arch.png</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..aca3f8d0c5ce4eedb5d40b8dedb39d226e57efbe</span>
<span class="term-fg1">Binary files &#47;dev&#47;null and scroll-reth&#47;crates&#47;scroll&#47;trie&#47;assets&#47;arch.png differ</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f07ddbd003365512c9b316ec" role="button"
                       aria-expanded="false" aria-controls="id-f07ddbd003365512c9b316ec">
                        <code>crates/scroll/trie/assets/deletion.png</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/trie/assets/deletion.png" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <span class="text-secondary">(binary file)</span>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f07ddbd003365512c9b316ec"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;trie&#47;assets&#47;deletion.png scroll-reth&#47;crates&#47;scroll&#47;trie&#47;assets&#47;deletion.png</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..6c699226e0996a30199a3ff4d2441700390cb8e2</span>
<span class="term-fg1">Binary files &#47;dev&#47;null and scroll-reth&#47;crates&#47;scroll&#47;trie&#47;assets&#47;deletion.png differ</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-18d1453edb811f2b76e3a35d" role="button"
                       aria-expanded="false" aria-controls="id-18d1453edb811f2b76e3a35d">
                        <code>crates/scroll/trie/assets/insertion.png</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/trie/assets/insertion.png" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <span class="text-secondary">(binary file)</span>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-18d1453edb811f2b76e3a35d"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;trie&#47;assets&#47;insertion.png scroll-reth&#47;crates&#47;scroll&#47;trie&#47;assets&#47;insertion.png</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..942338a07f2ea46e33fc899fd222b6ae6671f5e4</span>
<span class="term-fg1">Binary files &#47;dev&#47;null and scroll-reth&#47;crates&#47;scroll&#47;trie&#47;assets&#47;insertion.png differ</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2c73bba2f20abfe25f938bd7" role="button"
                       aria-expanded="false" aria-controls="id-2c73bba2f20abfe25f938bd7">
                        <code>crates/scroll/trie/assets/zktrie.md</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/trie/assets/zktrie.md" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+186</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2c73bba2f20abfe25f938bd7"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;trie&#47;assets&#47;zktrie.md scroll-reth&#47;crates&#47;scroll&#47;trie&#47;assets&#47;zktrie.md</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..b86e1a016ab8bae8e13f7e1b9f7fe1d29bfc7711</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;trie&#47;assets&#47;zktrie.md</span>
<span class="term-fg36">@@ -0,0 +1,186 @@</span>
<span class="term-fg32">+# zkTrie Spec</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+## 1. Tree Structure</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&lt;figure&gt;</span>
<span class="term-fg32">+&lt;img src=&quot;https:&#47;&#47;raw.githubusercontent.com&#47;scroll-tech&#47;reth&#47;refs&#47;heads&#47;scroll&#47;crates&#47;scroll&#47;trie&#47;assets&#47;arch.png&quot; alt=&quot;zkTrie Structure&quot; style=&quot;width:80%&quot;&gt;</span>
<span class="term-fg32">+&lt;figcaption align = &quot;center&quot;&gt;&lt;b&gt;Figure 1. zkTrie Structure&lt;&#47;b&gt;&lt;&#47;figcaption&gt;</span>
<span class="term-fg32">+&lt;&#47;figure&gt;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+In essence, zkTrie is a sparse binary Merkle Patricia Trie, depicted in the above figure.</span>
<span class="term-fg32">+Before diving into the Sparse Binary Merkle Patricia Trie, let&#39;s briefly touch on Merkle Trees and Patricia Tries.</span>
<span class="term-fg32">+* **Merkle Tree**: A Merkle Tree is a tree where each leaf node represents a hash of a data block, and each non-leaf node represents the hash of its child nodes.</span>
<span class="term-fg32">+* **Patricia Trie**: A Patricia Trie is a type of radix tree or compressed trie used to store key-value pairs efficiently. It encodes the nodes with same prefix of the key to share the common path, where the path is determined by the value of the node key.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+As illustrated in the Figure 1, there are three types of nodes in the zkTrie.</span>
<span class="term-fg32">+- Parent Node (type: 0): Given the zkTrie is a binary tree, a parent node has two children.</span>
<span class="term-fg32">+- Leaf Node (type: 1): A leaf node holds the data of a key-value pair.</span>
<span class="term-fg32">+- Empty Node (type: 2): An empty node is a special type of node, indicating the sub-trie that shares the same prefix is empty.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+In zkTrie, we use Poseidon hash to compute the node hash because it&#39;s more friendly and efficient to prove it in the zk circuit.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+## 2. Tree Construction</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+Given a key-value pair, we first compute a *secure key* for the corresponding leaf node by hashing the original key (i.e., account address and storage key) using the Poseidon hash function. This can make the key uniformly distributed over the key space. The node key hashing method is described in the [Node Hashing](#3-node-hashing) section below.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+We then encode the path of a new leaf node by traversing the secure key from Least Significant Bit (LSB) to the Most Significant Bit (MSB). At each step, if the bit is 0, we will traverse to the left child; otherwise, traverse to the right child.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+We limit the maximum depth of zkTrie to 248, meaning that the tree will only traverse the lower 248 bits of the key. This is because the secure key space is a finite field used by Poseidon hash that doesn&#39;t occupy the full range of power of 2. This leads to an ambiguous bit representation of the key in a finite field and thus causes a soundness issue in the zk circuit. But if we truncate the key to lower 248 bits, the key space can fully occupy the range of $2^{248}$ and won&#39;t have the ambiguity in the bit representation.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+We also apply an optimization to reduce the tree depth by contracting a subtree that has only one leaf node to a single leaf node. For example, in the Figure 1, the tree has three nodes in total, with keys `0100`, `0010`, and `1010`. Because there is only one node that has key with suffix `00`, the leaf node for key `0100` only traverses the suffix `00` and doesn&#39;t fully expand its key which would have resulted in depth of 4.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+## 3. Node Hashing</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+In this section, we will describe how leaf secure key and node merkle hash are computed. We use Poseidon hash in both hashing computation, denoted as `h` in the doc below.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&lt;aside&gt;</span>
<span class="term-fg32">+💡 Note: We use `init_state = 0` in the Poseidon hash function for all use cases in the zkTrie.</span>
<span class="term-fg32">+&lt;&#47;aside&gt;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### 3.1 Empty Node</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The node hash of an empty node is 0.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### 3.2 Parent Node</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The parent node hash is computed as follows</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+```go</span>
<span class="term-fg32">+parentNodeHash = h(leftChildHash, rightChildHash)</span>
<span class="term-fg32">+```</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### 3.3 Leaf Node</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The node hash of a leaf node is computed as follows</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+```go</span>
<span class="term-fg32">+leafNodeHash = h(h(1, nodeKey), valueHash)</span>
<span class="term-fg32">+```</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The leaf node can hold two types of values: Ethereum accounts and storage key-value pairs. Next, we will describe how the node key and value hash are computed for each leaf node type.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Ethereum Account Leaf Node</span>
<span class="term-fg32">+For an Ethereum Account Leaf Node, it consists of an Ethereum address and a state account struct. The secure key is derived from the Ethereum address.</span>
<span class="term-fg32">+```</span>
<span class="term-fg32">+address[0:20] (20 bytes in big-endian)</span>
<span class="term-fg32">+valHi = address[0:16]</span>
<span class="term-fg32">+valLo = address[16:20] * 2^96 (padding 12 bytes of 0 at the end)</span>
<span class="term-fg32">+nodeKey = h(valHi, valLo)</span>
<span class="term-fg32">+```</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+A state account struct in the Scroll consists of the following fields (`Fr` indicates the finite field used in Poseidon hash and is a 254-bit value)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- `Nonce`: u64</span>
<span class="term-fg32">+- `Balance`: u256, but treated as Fr</span>
<span class="term-fg32">+- `StorageRoot`: Fr</span>
<span class="term-fg32">+- `KeccakCodeHash`: u256</span>
<span class="term-fg32">+- `PoseidonCodeHash`: Fr</span>
<span class="term-fg32">+- `CodeSize`: u64</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+Before computing the value hash, the state account is first marshaled into a list of `u256` values. The marshaling scheme is</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+```</span>
<span class="term-fg32">+(The following scheme assumes the big-endian encoding)</span>
<span class="term-fg32">+[0:32] (bytes in big-endian)</span>
<span class="term-fg32">+	[0:16] Reserved with all 0</span>
<span class="term-fg32">+	[16:24] CodeSize, uint64 in big-endian</span>
<span class="term-fg32">+	[24:32] Nonce, uint64 in big-endian</span>
<span class="term-fg32">+[32:64] Balance</span>
<span class="term-fg32">+[64:96] StorageRoot</span>
<span class="term-fg32">+[96:128] KeccakCodeHash</span>
<span class="term-fg32">+[128:160] PoseidonCodehash</span>
<span class="term-fg32">+(total 160 bytes)</span>
<span class="term-fg32">+```</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The marshal function also returns a `flag` value along with a vector of `u256` values. The `flag` is a bitmap that indicates whether a `u256` value CANNOT be treated as a field element (Fr). The `flag` value for state account is 8, shown below.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+```</span>
<span class="term-fg32">++--------------------+---------+------+----------+----------+</span>
<span class="term-fg32">+|          0         |    1    |   2  |     3    |     4    | (index)</span>
<span class="term-fg32">++--------------------+---------+------+----------+----------+</span>
<span class="term-fg32">+| nonce||codesize||0 | balance | root |  keccak  | poseidon | (u256)</span>
<span class="term-fg32">++--------------------+---------+------+----------+----------+</span>
<span class="term-fg32">+|          0         |    0    |   0  |     1    |     0    | (flag bits)</span>
<span class="term-fg32">++--------------------+---------+------+----------+----------+</span>
<span class="term-fg32">+(LSB)                                                   (MSB)</span>
<span class="term-fg32">+```</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The value hash is computed in two steps:</span>
<span class="term-fg32">+1. Convert the value that cannot be represented as a field element of the Poseidon hash to the field element.</span>
<span class="term-fg32">+2. Combine field elements in a binary tree structure till the tree root is treated as the value hash.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+In the first step, when the bit in the `flag` is 1 indicating the `u256` value that cannot be treated as a field element, we split the value into a high-128bit value and a low-128bit value, and then pass them to a Poseidon hash to derive a field element value, `h(valueHi, valueLo)`.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+Based on the definition, the value hash of the state account is computed as follows.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+```</span>
<span class="term-fg32">+valueHash =</span>
<span class="term-fg32">+h(</span>
<span class="term-fg32">+    h(</span>
<span class="term-fg32">+        h(nonce||codesize||0, balance),</span>
<span class="term-fg32">+        h(</span>
<span class="term-fg32">+            storageRoot,</span>
<span class="term-fg32">+            h(keccakCodeHash[0:16], keccakCodeHash[16:32]), &#47;&#47; convert Keccak codehash to a field element</span>
<span class="term-fg32">+        ),</span>
<span class="term-fg32">+    ),</span>
<span class="term-fg32">+    poseidonCodeHash,</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+```</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#### Storage Leaf Node</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+For a Storage Leaf Node, it is a key-value pair, which both are a `u256` value. The secure key of this leaf node is derived from the storage key.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+```</span>
<span class="term-fg32">+storageKey[0:32] (32 bytes in big-endian)</span>
<span class="term-fg32">+valHi = storageKey[0:16]</span>
<span class="term-fg32">+valLo = storageKey[16:32]</span>
<span class="term-fg32">+nodeKey = h(valHi, valLo)</span>
<span class="term-fg32">+```</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The storage value is a `u256` value. The `flag` for the storage value is 1, showed below.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+```</span>
<span class="term-fg32">++--------------+</span>
<span class="term-fg32">+|      0       | (index)</span>
<span class="term-fg32">++--------------+</span>
<span class="term-fg32">+| storageValue | (u256)</span>
<span class="term-fg32">++--------------+</span>
<span class="term-fg32">+|      1       | (flag bits)</span>
<span class="term-fg32">++--------------+</span>
<span class="term-fg32">+```</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The value hash is computed as follows</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+```go</span>
<span class="term-fg32">+valueHash = h(storageValue[0:16], storageValue[16:32])</span>
<span class="term-fg32">+```</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+## 4. Tree Operations</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### 4.1 Insertion</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&lt;figure&gt;</span>
<span class="term-fg32">+&lt;img src=&quot;https:&#47;&#47;raw.githubusercontent.com&#47;scroll-tech&#47;reth&#47;refs&#47;heads&#47;scroll&#47;crates&#47;scroll&#47;trie&#47;assets&#47;insertion.png&quot; alt=&quot;zkTrie Structure&quot; style=&quot;width:80%&quot;&gt;</span>
<span class="term-fg32">+&lt;figcaption align = &quot;center&quot;&gt;&lt;b&gt;Figure 2. Insert a new leaf node to zkTrie&lt;&#47;b&gt;&lt;&#47;figcaption&gt;</span>
<span class="term-fg32">+&lt;&#47;figure&gt;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+When we insert a new leaf node to the existing zkTrie, there could be two cases illustrated in the Figure 2.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+1. When traversing the path of the node key, it reaches an empty node (Figure 2(b)). In this case, we just need to replace this empty node by this leaf node and backtrace the path to update the merkle hash of parent nodes till the root.</span>
<span class="term-fg32">+2. When traversing the path of the node key, it reaches another leaf node `b` (Figure 2(c)). In this case, we need to push down the existing leaf node `b` until the next bit in the node keys of two leaf nodes differs. At each push-down step, we need to insert an empty sibling node when necessary. When we reach the level where the bits differ, we then place two leaf nodes `b` and `c` as the left child and the right child depending on their bits. At last, we backtrace the path and update the merkle hash of all parent nodes.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+### 4.2 Deletion</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&lt;figure&gt;</span>
<span class="term-fg32">+&lt;img src=&quot;https:&#47;&#47;raw.githubusercontent.com&#47;scroll-tech&#47;reth&#47;refs&#47;heads&#47;scroll&#47;crates&#47;scroll&#47;trie&#47;assets&#47;deletion.png&quot; alt=&quot;zkTrie Structure&quot; style=&quot;width:80%&quot;&gt;</span>
<span class="term-fg32">+&lt;figcaption align = &quot;center&quot;&gt;&lt;b&gt;Figure 3. Delete a leaf node from the zkTrie&lt;&#47;b&gt;&lt;&#47;figcaption&gt;</span>
<span class="term-fg32">+&lt;&#47;figure&gt;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The deletion of a leaf node is similar to the insertion. There are two cases illustrated in the Figure 3.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+1. The sibling node of to-be-deleted leaf node is a parent node (Figure 3(b)). In this case, we can just replace the node `a` by an empty node and update the node hash of its ancestors till the root node.</span>
<span class="term-fg32">+2. The node of to-be-deleted leaf node is a leaf node (Figure 3(c)). Similarly, we first replace the leaf node by an empty node and start to contract its sibling node upwards until its sibling node is not an empty node. For example, in Figure 3(c), we first replace the leaf node `b` by an empty node. During the contraction, since the sibling of node `c` now becomes an empty node, we move node `c` one level upward to replace its parent node. The new sibling of node `c`, node `e`, is still an empty node. So again we move node `c` upward. Now that the sibling of node `c` is node `a`, the deletion process is finished.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+Note that the sibling of a leaf node in a valid zkTrie cannot be an empty node. Otherwise, we should always prune the subtree and move the leaf node upwards.</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2f64b280222edd514fe466ac" role="button"
                       aria-expanded="false" aria-controls="id-2f64b280222edd514fe466ac">
                        <code>crates/scroll/trie/src/branch.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/trie/src/branch.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+155</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2f64b280222edd514fe466ac"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;trie&#47;src&#47;branch.rs scroll-reth&#47;crates&#47;scroll&#47;trie&#47;src&#47;branch.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..4599749c1ef1790708518c9a54d2724911637371</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;trie&#47;src&#47;branch.rs</span>
<span class="term-fg36">@@ -0,0 +1,155 @@</span>
<span class="term-fg32">+use super::{</span>
<span class="term-fg32">+    BRANCH_NODE_LBRB_DOMAIN, BRANCH_NODE_LBRT_DOMAIN, BRANCH_NODE_LTRB_DOMAIN,</span>
<span class="term-fg32">+    BRANCH_NODE_LTRT_DOMAIN,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use alloy_primitives::{hex, B256};</span>
<span class="term-fg32">+use alloy_trie::TrieMask;</span>
<span class="term-fg32">+use core::{fmt, ops::Range, slice::Iter};</span>
<span class="term-fg32">+use reth_scroll_primitives::poseidon::{hash_with_domain, Fr, PrimeField};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[allow(unused_imports)]</span>
<span class="term-fg32">+use alloc::vec::Vec;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The range of valid child indexes.</span>
<span class="term-fg32">+pub(crate) const CHILD_INDEX_RANGE: Range&lt;u8&gt; = 0..2;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A trie mask to extract the two child indexes from a branch node.</span>
<span class="term-fg32">+pub(crate) const CHILD_INDEX_MASK: TrieMask = TrieMask::new(0b11);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A reference to branch node and its state mask.</span>
<span class="term-fg32">+&#47;&#47;&#47; NOTE: The stack may contain more items that specified in the state mask.</span>
<span class="term-fg32">+#[derive(Clone)]</span>
<span class="term-fg32">+pub(crate) struct BranchNodeRef&lt;&#39;a&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Reference to the collection of hash nodes.</span>
<span class="term-fg32">+    &#47;&#47;&#47; NOTE: The referenced stack might have more items than the number of children</span>
<span class="term-fg32">+    &#47;&#47;&#47; for this node. We should only ever access items starting from</span>
<span class="term-fg32">+    &#47;&#47;&#47; [`BranchNodeRef::first_child_index`].</span>
<span class="term-fg32">+    pub stack: &amp;&#39;a [B256],</span>
<span class="term-fg32">+    &#47;&#47;&#47; Reference to bitmask indicating the presence of children at</span>
<span class="term-fg32">+    &#47;&#47;&#47; the respective nibble positions.</span>
<span class="term-fg32">+    pub state_mask: TrieMask,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl fmt::Debug for BranchNodeRef&lt;&#39;_&gt; {</span>
<span class="term-fg32">+    fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;&#39;_&gt;) -&gt; fmt::Result {</span>
<span class="term-fg32">+        f.debug_struct(&quot;BranchNodeRef&quot;)</span>
<span class="term-fg32">+            .field(&quot;stack&quot;, &amp;self.stack.iter().map(hex::encode).collect::&lt;Vec&lt;_&gt;&gt;())</span>
<span class="term-fg32">+            .field(&quot;state_mask&quot;, &amp;self.state_mask)</span>
<span class="term-fg32">+            .field(&quot;first_child_index&quot;, &amp;self.first_child_index())</span>
<span class="term-fg32">+            .finish()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;&#39;a&gt; BranchNodeRef&lt;&#39;a&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create a new branch node from the stack of nodes.</span>
<span class="term-fg32">+    #[inline]</span>
<span class="term-fg32">+    pub(crate) const fn new(stack: &amp;&#39;a [B256], state_mask: TrieMask) -&gt; Self {</span>
<span class="term-fg32">+        Self { stack, state_mask }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the stack index of the first child for this node.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; # Panics</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; If the stack length is less than number of children specified in state mask.</span>
<span class="term-fg32">+    &#47;&#47;&#47; Means that the node is in inconsistent state.</span>
<span class="term-fg32">+    #[inline]</span>
<span class="term-fg32">+    pub(crate) fn first_child_index(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.stack</span>
<span class="term-fg32">+            .len()</span>
<span class="term-fg32">+            .checked_sub((self.state_mask &amp; CHILD_INDEX_MASK).count_ones() as usize)</span>
<span class="term-fg32">+            .expect(&quot;branch node stack is in inconsistent state&quot;)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[inline]</span>
<span class="term-fg32">+    fn children(&amp;self) -&gt; impl Iterator&lt;Item = (u8, Option&lt;&amp;B256&gt;)&gt; + &#39;_ {</span>
<span class="term-fg32">+        BranchChildrenIter::new(self)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Given the hash mask of children, return an iterator over stack items</span>
<span class="term-fg32">+    &#47;&#47;&#47; that match the mask.</span>
<span class="term-fg32">+    #[inline]</span>
<span class="term-fg32">+    pub(crate) fn child_hashes(&amp;self, hash_mask: TrieMask) -&gt; impl Iterator&lt;Item = B256&gt; + &#39;_ {</span>
<span class="term-fg32">+        self.children()</span>
<span class="term-fg32">+            .filter_map(|(i, c)| c.map(|c| (i, c)))</span>
<span class="term-fg32">+            .filter(move |(index, _)| hash_mask.is_bit_set(*index))</span>
<span class="term-fg32">+            .map(|(_, child)| B256::from_slice(&amp;child[..]))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    pub(crate) fn hash(&amp;self) -&gt; B256 {</span>
<span class="term-fg32">+        let mut children_iter = self.children();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let left_child = children_iter</span>
<span class="term-fg32">+            .next()</span>
<span class="term-fg32">+            .map(|(_, c)| *c.unwrap_or_default())</span>
<span class="term-fg32">+            .expect(&quot;branch node has two children&quot;);</span>
<span class="term-fg32">+        let left_child =</span>
<span class="term-fg32">+            Fr::from_repr_vartime(left_child.0).expect(&quot;left child is a valid field element&quot;);</span>
<span class="term-fg32">+        let right_child = children_iter</span>
<span class="term-fg32">+            .next()</span>
<span class="term-fg32">+            .map(|(_, c)| *c.unwrap_or_default())</span>
<span class="term-fg32">+            .expect(&quot;branch node has two children&quot;);</span>
<span class="term-fg32">+        let right_child =</span>
<span class="term-fg32">+            Fr::from_repr_vartime(right_child.0).expect(&quot;right child is a valid field element&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        hash_with_domain(&amp;[left_child, right_child], self.hashing_domain()).to_repr().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn hashing_domain(&amp;self) -&gt; Fr {</span>
<span class="term-fg32">+        match *self.state_mask {</span>
<span class="term-fg32">+            0b1011 =&gt; BRANCH_NODE_LBRT_DOMAIN,</span>
<span class="term-fg32">+            0b1111 =&gt; BRANCH_NODE_LTRT_DOMAIN,</span>
<span class="term-fg32">+            0b0111 =&gt; BRANCH_NODE_LTRB_DOMAIN,</span>
<span class="term-fg32">+            0b0011 =&gt; BRANCH_NODE_LBRB_DOMAIN,</span>
<span class="term-fg32">+            _ =&gt; unreachable!(&quot;invalid branch node state mask&quot;),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Iterator over branch node children.</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+struct BranchChildrenIter&lt;&#39;a&gt; {</span>
<span class="term-fg32">+    range: Range&lt;u8&gt;,</span>
<span class="term-fg32">+    state_mask: TrieMask,</span>
<span class="term-fg32">+    stack_iter: Iter&lt;&#39;a, B256&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;&#39;a&gt; BranchChildrenIter&lt;&#39;a&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create new iterator over branch node children.</span>
<span class="term-fg32">+    fn new(node: &amp;BranchNodeRef&lt;&#39;a&gt;) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            range: CHILD_INDEX_RANGE,</span>
<span class="term-fg32">+            state_mask: node.state_mask,</span>
<span class="term-fg32">+            stack_iter: node.stack[node.first_child_index()..].iter(),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;&#39;a&gt; Iterator for BranchChildrenIter&lt;&#39;a&gt; {</span>
<span class="term-fg32">+    type Item = (u8, Option&lt;&amp;&#39;a B256&gt;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[inline]</span>
<span class="term-fg32">+    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; {</span>
<span class="term-fg32">+        let i = self.range.next()?;</span>
<span class="term-fg32">+        let value = self</span>
<span class="term-fg32">+            .state_mask</span>
<span class="term-fg32">+            .is_bit_set(i)</span>
<span class="term-fg32">+            .then(|| unsafe { self.stack_iter.next().unwrap_unchecked() });</span>
<span class="term-fg32">+        Some((i, value))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[inline]</span>
<span class="term-fg32">+    fn size_hint(&amp;self) -&gt; (usize, Option&lt;usize&gt;) {</span>
<span class="term-fg32">+        let len = self.len();</span>
<span class="term-fg32">+        (len, Some(len))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl core::iter::FusedIterator for BranchChildrenIter&lt;&#39;_&gt; {}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ExactSizeIterator for BranchChildrenIter&lt;&#39;_&gt; {</span>
<span class="term-fg32">+    #[inline]</span>
<span class="term-fg32">+    fn len(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.range.len()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9f7a720fdeaa307c12bf01fe" role="button"
                       aria-expanded="false" aria-controls="id-9f7a720fdeaa307c12bf01fe">
                        <code>crates/scroll/trie/src/hash_builder.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/trie/src/hash_builder.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+585</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9f7a720fdeaa307c12bf01fe"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;trie&#47;src&#47;hash_builder.rs scroll-reth&#47;crates&#47;scroll&#47;trie&#47;src&#47;hash_builder.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..8eacab8d15445bcda8509f48acdc481826ce7a7b</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;trie&#47;src&#47;hash_builder.rs</span>
<span class="term-fg36">@@ -0,0 +1,585 @@</span>
<span class="term-fg32">+use crate::{</span>
<span class="term-fg32">+    branch::{BranchNodeRef, CHILD_INDEX_MASK},</span>
<span class="term-fg32">+    leaf::HashLeaf,</span>
<span class="term-fg32">+    sub_tree::SubTreeRef,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use alloy_primitives::{map::HashMap, B256};</span>
<span class="term-fg32">+use alloy_trie::{</span>
<span class="term-fg32">+    hash_builder::{HashBuilderValue, HashBuilderValueRef},</span>
<span class="term-fg32">+    nodes::LeafNodeRef,</span>
<span class="term-fg32">+    proof::{ProofNodes, ProofRetainer},</span>
<span class="term-fg32">+    BranchNodeCompact, Nibbles, TrieMask,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use core::cmp;</span>
<span class="term-fg32">+use reth_scroll_primitives::poseidon::EMPTY_ROOT_HASH;</span>
<span class="term-fg32">+use tracing::trace;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[derive(Debug, Default)]</span>
<span class="term-fg32">+#[allow(missing_docs)]</span>
<span class="term-fg32">+pub struct HashBuilder {</span>
<span class="term-fg32">+    pub key: Nibbles,</span>
<span class="term-fg32">+    pub value: HashBuilderValue,</span>
<span class="term-fg32">+    pub stack: Vec&lt;B256&gt;,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47; TODO(scroll): Introduce terminator &#47; leaf masks</span>
<span class="term-fg32">+    pub state_masks: Vec&lt;TrieMask&gt;,</span>
<span class="term-fg32">+    pub tree_masks: Vec&lt;TrieMask&gt;,</span>
<span class="term-fg32">+    pub hash_masks: Vec&lt;TrieMask&gt;,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    pub stored_in_database: bool,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    pub updated_branch_nodes: Option&lt;HashMap&lt;Nibbles, BranchNodeCompact&gt;&gt;,</span>
<span class="term-fg32">+    pub proof_retainer: Option&lt;ProofRetainer&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashBuilder {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Enables the Hash Builder to store updated branch nodes.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Call [`HashBuilder::split`] to get the updates to branch nodes.</span>
<span class="term-fg32">+    pub fn with_updates(mut self, retain_updates: bool) -&gt; Self {</span>
<span class="term-fg32">+        self.set_updates(retain_updates);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Enable specified proof retainer.</span>
<span class="term-fg32">+    pub fn with_proof_retainer(mut self, retainer: ProofRetainer) -&gt; Self {</span>
<span class="term-fg32">+        self.proof_retainer = Some(retainer);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Enables the Hash Builder to store updated branch nodes.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Call [`HashBuilder::split`] to get the updates to branch nodes.</span>
<span class="term-fg32">+    pub fn set_updates(&amp;mut self, retain_updates: bool) {</span>
<span class="term-fg32">+        if retain_updates {</span>
<span class="term-fg32">+            self.updated_branch_nodes = Some(HashMap::default());</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Splits the [`HashBuilder`] into a [`HashBuilder`] and hash builder updates.</span>
<span class="term-fg32">+    pub fn split(mut self) -&gt; (Self, HashMap&lt;Nibbles, BranchNodeCompact&gt;) {</span>
<span class="term-fg32">+        let updates = self.updated_branch_nodes.take();</span>
<span class="term-fg32">+        (self, updates.unwrap_or_default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Take and return retained proof nodes.</span>
<span class="term-fg32">+    pub fn take_proof_nodes(&amp;mut self) -&gt; ProofNodes {</span>
<span class="term-fg32">+        self.proof_retainer.take().map(ProofRetainer::into_proof_nodes).unwrap_or_default()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; The number of total updates accrued.</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns `0` if [`Self::with_updates`] was not called.</span>
<span class="term-fg32">+    pub fn updates_len(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.updated_branch_nodes.as_ref().map(|u| u.len()).unwrap_or(0)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Print the current stack of the Hash Builder.</span>
<span class="term-fg32">+    pub fn print_stack(&amp;self) {</span>
<span class="term-fg32">+        println!(&quot;============ STACK ===============&quot;);</span>
<span class="term-fg32">+        for item in &amp;self.stack {</span>
<span class="term-fg32">+            println!(&quot;{}&quot;, alloy_primitives::hex::encode(item));</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        println!(&quot;============ END STACK ===============&quot;);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Adds a new leaf element and its value to the trie hash builder.</span>
<span class="term-fg32">+    pub fn add_leaf(&amp;mut self, key: Nibbles, value: &amp;[u8]) {</span>
<span class="term-fg32">+        assert!(key &gt; self.key, &quot;add_leaf key {:?} self.key {:?}&quot;, key, self.key);</span>
<span class="term-fg32">+        if !self.key.is_empty() {</span>
<span class="term-fg32">+            self.update(&amp;key);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        self.set_key_value(key, HashBuilderValueRef::Bytes(value));</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Adds a new branch element and its hash to the trie hash builder.</span>
<span class="term-fg32">+    pub fn add_branch(&amp;mut self, key: Nibbles, value: B256, stored_in_database: bool) {</span>
<span class="term-fg32">+        assert!(</span>
<span class="term-fg32">+            key &gt; self.key || (self.key.is_empty() &amp;&amp; key.is_empty()),</span>
<span class="term-fg32">+            &quot;add_branch key {:?} self.key {:?}&quot;,</span>
<span class="term-fg32">+            key,</span>
<span class="term-fg32">+            self.key</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+        if !self.key.is_empty() {</span>
<span class="term-fg32">+            self.update(&amp;key);</span>
<span class="term-fg32">+        } else if key.is_empty() {</span>
<span class="term-fg32">+            self.stack.push(value);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        self.set_key_value(key, HashBuilderValueRef::Hash(&amp;value));</span>
<span class="term-fg32">+        self.stored_in_database = stored_in_database;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the current root hash of the trie builder.</span>
<span class="term-fg32">+    pub fn root(&amp;mut self) -&gt; B256 {</span>
<span class="term-fg32">+        &#47;&#47; Clears the internal state</span>
<span class="term-fg32">+        if !self.key.is_empty() {</span>
<span class="term-fg32">+            self.update(&amp;Nibbles::default());</span>
<span class="term-fg32">+            self.key.clear();</span>
<span class="term-fg32">+            self.value.clear();</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        let root = self.current_root();</span>
<span class="term-fg32">+        if root == EMPTY_ROOT_HASH {</span>
<span class="term-fg32">+            if let Some(proof_retainer) = self.proof_retainer.as_mut() {</span>
<span class="term-fg32">+                proof_retainer.retain(&amp;Nibbles::default(), &amp;[])</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        root</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[inline]</span>
<span class="term-fg32">+    fn set_key_value(&amp;mut self, key: Nibbles, value: HashBuilderValueRef&lt;&#39;_&gt;) {</span>
<span class="term-fg32">+        self.log_key_value(&quot;old value&quot;);</span>
<span class="term-fg32">+        self.key = key;</span>
<span class="term-fg32">+        self.value.set_from_ref(value);</span>
<span class="term-fg32">+        self.log_key_value(&quot;new value&quot;);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn log_key_value(&amp;self, msg: &amp;str) {</span>
<span class="term-fg32">+        trace!(target: &quot;trie::hash_builder&quot;,</span>
<span class="term-fg32">+            key = ?self.key,</span>
<span class="term-fg32">+            value = ?self.value,</span>
<span class="term-fg32">+            &quot;{msg}&quot;,</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn current_root(&amp;self) -&gt; B256 {</span>
<span class="term-fg32">+        if let Some(node_ref) = self.stack.last() {</span>
<span class="term-fg32">+            let mut root = *node_ref;</span>
<span class="term-fg32">+            root.reverse();</span>
<span class="term-fg32">+            root</span>
<span class="term-fg32">+        } else {</span>
<span class="term-fg32">+            EMPTY_ROOT_HASH</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Given a new element, it appends it to the stack and proceeds to loop through the stack state</span>
<span class="term-fg32">+    &#47;&#47;&#47; and convert the nodes it can into branch &#47; extension nodes and hash them. This ensures</span>
<span class="term-fg32">+    &#47;&#47;&#47; that the top of the stack always contains the merkle root corresponding to the trie</span>
<span class="term-fg32">+    &#47;&#47;&#47; built so far.</span>
<span class="term-fg32">+    fn update(&amp;mut self, succeeding: &amp;Nibbles) {</span>
<span class="term-fg32">+        let mut build_extensions = false;</span>
<span class="term-fg32">+        &#47;&#47; current &#47; self.key is always the latest added element in the trie</span>
<span class="term-fg32">+        let mut current = self.key.clone();</span>
<span class="term-fg32">+        debug_assert!(!current.is_empty());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        trace!(target: &quot;trie::hash_builder&quot;, ?current, ?succeeding, &quot;updating merkle tree&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut i = 0usize;</span>
<span class="term-fg32">+        loop {</span>
<span class="term-fg32">+            let _span = tracing::trace_span!(target: &quot;trie::hash_builder&quot;, &quot;loop&quot;, i, ?current, build_extensions).entered();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            let preceding_exists = !self.state_masks.is_empty();</span>
<span class="term-fg32">+            let preceding_len = self.state_masks.len().saturating_sub(1);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            let common_prefix_len = succeeding.common_prefix_length(current.as_slice());</span>
<span class="term-fg32">+            let len = cmp::max(preceding_len, common_prefix_len);</span>
<span class="term-fg32">+            assert!(len &lt; current.len(), &quot;len {} current.len {}&quot;, len, current.len());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            trace!(</span>
<span class="term-fg32">+                target: &quot;trie::hash_builder&quot;,</span>
<span class="term-fg32">+                ?len,</span>
<span class="term-fg32">+                ?common_prefix_len,</span>
<span class="term-fg32">+                ?preceding_len,</span>
<span class="term-fg32">+                preceding_exists,</span>
<span class="term-fg32">+                &quot;prefix lengths after comparing keys&quot;</span>
<span class="term-fg32">+            );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; Adjust the state masks for branch calculation</span>
<span class="term-fg32">+            let extra_digit = current[len];</span>
<span class="term-fg32">+            if self.state_masks.len() &lt;= len {</span>
<span class="term-fg32">+                let new_len = len + 1;</span>
<span class="term-fg32">+                trace!(target: &quot;trie::hash_builder&quot;, new_len, old_len = self.state_masks.len(), &quot;scaling state masks to fit&quot;);</span>
<span class="term-fg32">+                self.state_masks.resize(new_len, TrieMask::default());</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            self.state_masks[len] |= TrieMask::from_nibble(extra_digit);</span>
<span class="term-fg32">+            trace!(</span>
<span class="term-fg32">+                target: &quot;trie::hash_builder&quot;,</span>
<span class="term-fg32">+                ?extra_digit,</span>
<span class="term-fg32">+                groups = ?self.state_masks,</span>
<span class="term-fg32">+            );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; Adjust the tree masks for exporting to the DB</span>
<span class="term-fg32">+            if self.tree_masks.len() &lt; current.len() {</span>
<span class="term-fg32">+                self.resize_masks(current.len());</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            let mut len_from = len;</span>
<span class="term-fg32">+            if !succeeding.is_empty() || preceding_exists {</span>
<span class="term-fg32">+                len_from += 1;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            trace!(target: &quot;trie::hash_builder&quot;, &quot;skipping {len_from} nibbles&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; The key without the common prefix</span>
<span class="term-fg32">+            let short_node_key = current.slice(len_from..);</span>
<span class="term-fg32">+            trace!(target: &quot;trie::hash_builder&quot;, ?short_node_key);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; Concatenate the 2 nodes together</span>
<span class="term-fg32">+            if !build_extensions {</span>
<span class="term-fg32">+                match self.value.as_ref() {</span>
<span class="term-fg32">+                    HashBuilderValueRef::Bytes(leaf_value) =&gt; {</span>
<span class="term-fg32">+                        &#47;&#47; TODO(scroll): Replace with terminator masks</span>
<span class="term-fg32">+                        &#47;&#47; Set the terminator mask for the leaf node</span>
<span class="term-fg32">+                        self.state_masks[len] |= TrieMask::new(0b100 &lt;&lt; extra_digit);</span>
<span class="term-fg32">+                        let leaf_node = LeafNodeRef::new(&amp;current, leaf_value);</span>
<span class="term-fg32">+                        let leaf_hash = leaf_node.hash_leaf();</span>
<span class="term-fg32">+                        trace!(</span>
<span class="term-fg32">+                            target: &quot;trie::hash_builder&quot;,</span>
<span class="term-fg32">+                            ?leaf_node,</span>
<span class="term-fg32">+                            ?leaf_hash,</span>
<span class="term-fg32">+                            &quot;pushing leaf node&quot;,</span>
<span class="term-fg32">+                        );</span>
<span class="term-fg32">+                        self.stack.push(leaf_hash);</span>
<span class="term-fg32">+                        &#47;&#47; self.retain_proof_from_stack(&amp;current.slice(..len_from));</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                    HashBuilderValueRef::Hash(hash) =&gt; {</span>
<span class="term-fg32">+                        trace!(target: &quot;trie::hash_builder&quot;, ?hash, &quot;pushing branch node hash&quot;);</span>
<span class="term-fg32">+                        self.stack.push(*hash);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                        if self.stored_in_database {</span>
<span class="term-fg32">+                            self.tree_masks[current.len() - 1] |= TrieMask::from_nibble(</span>
<span class="term-fg32">+                                current</span>
<span class="term-fg32">+                                    .last()</span>
<span class="term-fg32">+                                    .expect(&quot;must have at least a single bit in the current key&quot;),</span>
<span class="term-fg32">+                            );</span>
<span class="term-fg32">+                        }</span>
<span class="term-fg32">+                        self.hash_masks[current.len() - 1] |= TrieMask::from_nibble(</span>
<span class="term-fg32">+                            current</span>
<span class="term-fg32">+                                .last()</span>
<span class="term-fg32">+                                .expect(&quot;must have at least a single bit in the current key&quot;),</span>
<span class="term-fg32">+                        );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                        build_extensions = true;</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            if build_extensions &amp;&amp; !short_node_key.is_empty() {</span>
<span class="term-fg32">+                self.update_masks(&amp;current, len_from);</span>
<span class="term-fg32">+                let stack_last = self.stack.pop().expect(&quot;there should be at least one stack item&quot;);</span>
<span class="term-fg32">+                let sub_tree = SubTreeRef::new(&amp;short_node_key, &amp;stack_last);</span>
<span class="term-fg32">+                let sub_tree_root = sub_tree.root();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                trace!(</span>
<span class="term-fg32">+                    target: &quot;trie::hash_builder&quot;,</span>
<span class="term-fg32">+                    ?short_node_key,</span>
<span class="term-fg32">+                    ?sub_tree_root,</span>
<span class="term-fg32">+                    &quot;pushing subtree root&quot;,</span>
<span class="term-fg32">+                );</span>
<span class="term-fg32">+                self.stack.push(sub_tree_root);</span>
<span class="term-fg32">+                &#47;&#47; self.retain_proof_from_stack(&amp;current.slice(..len_from));</span>
<span class="term-fg32">+                self.resize_masks(len_from);</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            if preceding_len &lt;= common_prefix_len &amp;&amp; !succeeding.is_empty() {</span>
<span class="term-fg32">+                trace!(target: &quot;trie::hash_builder&quot;, &quot;no common prefix to create branch nodes from, returning&quot;);</span>
<span class="term-fg32">+                return;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; Insert branch nodes in the stack</span>
<span class="term-fg32">+            if !succeeding.is_empty() || preceding_exists {</span>
<span class="term-fg32">+                &#47;&#47; Pushes the corresponding branch node to the stack</span>
<span class="term-fg32">+                let children = self.push_branch_node(&amp;current, len);</span>
<span class="term-fg32">+                &#47;&#47; Need to store the branch node in an efficient format outside of the hash builder</span>
<span class="term-fg32">+                self.store_branch_node(&amp;current, len, children);</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            self.state_masks.resize(len, TrieMask::default());</span>
<span class="term-fg32">+            self.resize_masks(len);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            if preceding_len == 0 {</span>
<span class="term-fg32">+                trace!(target: &quot;trie::hash_builder&quot;, &quot;0 or 1 state masks means we have no more elements to process&quot;);</span>
<span class="term-fg32">+                return;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            current.truncate(preceding_len);</span>
<span class="term-fg32">+            trace!(target: &quot;trie::hash_builder&quot;, ?current, &quot;truncated nibbles to {} bytes&quot;, preceding_len);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            trace!(target: &quot;trie::hash_builder&quot;, groups = ?self.state_masks, &quot;popping empty state masks&quot;);</span>
<span class="term-fg32">+            while self.state_masks.last() == Some(&amp;TrieMask::default()) {</span>
<span class="term-fg32">+                self.state_masks.pop();</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            build_extensions = true;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            i += 1;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Given the size of the longest common prefix, it proceeds to create a branch node</span>
<span class="term-fg32">+    &#47;&#47;&#47; from the state mask and existing stack state, and store its RLP to the top of the stack,</span>
<span class="term-fg32">+    &#47;&#47;&#47; after popping all the relevant elements from the stack.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the hashes of the children of the branch node, only if `updated_branch_nodes` is</span>
<span class="term-fg32">+    &#47;&#47;&#47; enabled.</span>
<span class="term-fg32">+    fn push_branch_node(&amp;mut self, _current: &amp;Nibbles, len: usize) -&gt; Vec&lt;B256&gt; {</span>
<span class="term-fg32">+        let state_mask = self.state_masks[len];</span>
<span class="term-fg32">+        let hash_mask = self.hash_masks[len];</span>
<span class="term-fg32">+        let branch_node = BranchNodeRef::new(&amp;self.stack, state_mask);</span>
<span class="term-fg32">+        &#47;&#47; Avoid calculating this value if it&#39;s not needed.</span>
<span class="term-fg32">+        let children = if self.updated_branch_nodes.is_some() {</span>
<span class="term-fg32">+            branch_node.child_hashes(hash_mask).collect()</span>
<span class="term-fg32">+        } else {</span>
<span class="term-fg32">+            vec![]</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let branch_hash = branch_node.hash();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; TODO: enable proof retention</span>
<span class="term-fg32">+        &#47;&#47; self.retain_proof_from_stack(&amp;current.slice(..len));</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; Clears the stack from the branch node elements</span>
<span class="term-fg32">+        let first_child_idx = branch_node.first_child_index();</span>
<span class="term-fg32">+        trace!(</span>
<span class="term-fg32">+            target: &quot;trie::hash_builder&quot;,</span>
<span class="term-fg32">+            new_len = first_child_idx,</span>
<span class="term-fg32">+            old_len = self.stack.len(),</span>
<span class="term-fg32">+            &quot;resizing stack to prepare branch node&quot;</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+        self.stack.resize_with(first_child_idx, Default::default);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        trace!(target: &quot;trie::hash_builder&quot;, ?branch_hash, &quot;pushing branch node with {state_mask:?} mask</span>
<span class="term-fg32">+        from stack&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        self.stack.push(branch_hash);</span>
<span class="term-fg32">+        children</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Given the current nibble prefix and the highest common prefix length, proceeds</span>
<span class="term-fg32">+    &#47;&#47;&#47; to update the masks for the next level and store the branch node and the</span>
<span class="term-fg32">+    &#47;&#47;&#47; masks in the database. We will use that when consuming the intermediate nodes</span>
<span class="term-fg32">+    &#47;&#47;&#47; from the database to efficiently build the trie.</span>
<span class="term-fg32">+    fn store_branch_node(&amp;mut self, current: &amp;Nibbles, len: usize, children: Vec&lt;B256&gt;) {</span>
<span class="term-fg32">+        trace!(target: &quot;trie::hash_builder&quot;, ?current, ?len, ?children, &quot;store branch node&quot;);</span>
<span class="term-fg32">+        if len &gt; 0 {</span>
<span class="term-fg32">+            let parent_index = len - 1;</span>
<span class="term-fg32">+            self.hash_masks[parent_index] |= TrieMask::from_nibble(current[parent_index]);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let store_in_db_trie = !self.tree_masks[len].is_empty() || !self.hash_masks[len].is_empty();</span>
<span class="term-fg32">+        if store_in_db_trie {</span>
<span class="term-fg32">+            if len &gt; 0 {</span>
<span class="term-fg32">+                let parent_index = len - 1;</span>
<span class="term-fg32">+                self.tree_masks[parent_index] |= TrieMask::from_nibble(current[parent_index]);</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            if self.updated_branch_nodes.is_some() {</span>
<span class="term-fg32">+                let common_prefix = current.slice(..len);</span>
<span class="term-fg32">+                let node = BranchNodeCompact::new(</span>
<span class="term-fg32">+                    self.state_masks[len] &amp; CHILD_INDEX_MASK,</span>
<span class="term-fg32">+                    self.tree_masks[len],</span>
<span class="term-fg32">+                    self.hash_masks[len],</span>
<span class="term-fg32">+                    children,</span>
<span class="term-fg32">+                    (len == 0).then(|| self.current_root()),</span>
<span class="term-fg32">+                );</span>
<span class="term-fg32">+                trace!(target: &quot;trie::hash_builder&quot;, ?node, &quot;storing updated intermediate node&quot;);</span>
<span class="term-fg32">+                self.updated_branch_nodes</span>
<span class="term-fg32">+                    .as_mut()</span>
<span class="term-fg32">+                    .expect(&quot;updates_branch_nodes is some&quot;)</span>
<span class="term-fg32">+                    .insert(common_prefix, node);</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47; TODO(scroll): Enable proof retention</span>
<span class="term-fg32">+    &#47;&#47; fn retain_proof_from_stack(&amp;mut self, prefix: &amp;Nibbles) {</span>
<span class="term-fg32">+    &#47;&#47;     if let Some(proof_retainer) = self.proof_retainer.as_mut() {</span>
<span class="term-fg32">+    &#47;&#47;         proof_retainer.retain(</span>
<span class="term-fg32">+    &#47;&#47;             prefix,</span>
<span class="term-fg32">+    &#47;&#47;             self.stack.last().expect(&quot;there should be at least one stack item&quot;).as_ref(),</span>
<span class="term-fg32">+    &#47;&#47;         );</span>
<span class="term-fg32">+    &#47;&#47;     }</span>
<span class="term-fg32">+    &#47;&#47; }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn update_masks(&amp;mut self, current: &amp;Nibbles, len_from: usize) {</span>
<span class="term-fg32">+        if len_from &gt; 0 {</span>
<span class="term-fg32">+            let flag = TrieMask::from_nibble(current[len_from - 1]);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            self.hash_masks[len_from - 1] &amp;= !flag;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            if !self.tree_masks[current.len() - 1].is_empty() {</span>
<span class="term-fg32">+                self.tree_masks[len_from - 1] |= flag;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn resize_masks(&amp;mut self, new_len: usize) {</span>
<span class="term-fg32">+        trace!(</span>
<span class="term-fg32">+            target: &quot;trie::hash_builder&quot;,</span>
<span class="term-fg32">+            new_len,</span>
<span class="term-fg32">+            old_tree_mask_len = self.tree_masks.len(),</span>
<span class="term-fg32">+            old_hash_mask_len = self.hash_masks.len(),</span>
<span class="term-fg32">+            &quot;resizing tree&#47;hash masks&quot;</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+        self.tree_masks.resize(new_len, TrieMask::default());</span>
<span class="term-fg32">+        self.hash_masks.resize(new_len, TrieMask::default());</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; TODO(scroll): Introduce generic for the HashBuilder.</span>
<span class="term-fg32">+impl From&lt;reth_trie::HashBuilder&gt; for HashBuilder {</span>
<span class="term-fg32">+    fn from(hash_builder: reth_trie::HashBuilder) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            key: hash_builder.key,</span>
<span class="term-fg32">+            value: hash_builder.value,</span>
<span class="term-fg32">+            stack: hash_builder</span>
<span class="term-fg32">+                .stack</span>
<span class="term-fg32">+                .into_iter()</span>
<span class="term-fg32">+                .map(|x| x.as_slice().try_into().expect(&quot;RlpNode contains 32 byte hashes&quot;))</span>
<span class="term-fg32">+                .collect(),</span>
<span class="term-fg32">+            state_masks: hash_builder.groups,</span>
<span class="term-fg32">+            tree_masks: hash_builder.tree_masks,</span>
<span class="term-fg32">+            hash_masks: hash_builder.hash_masks,</span>
<span class="term-fg32">+            stored_in_database: hash_builder.stored_in_database,</span>
<span class="term-fg32">+            updated_branch_nodes: hash_builder.updated_branch_nodes,</span>
<span class="term-fg32">+            proof_retainer: hash_builder.proof_retainer,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;HashBuilder&gt; for reth_trie::HashBuilder {</span>
<span class="term-fg32">+    fn from(value: HashBuilder) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            key: value.key,</span>
<span class="term-fg32">+            value: value.value,</span>
<span class="term-fg32">+            stack: value</span>
<span class="term-fg32">+                .stack</span>
<span class="term-fg32">+                .into_iter()</span>
<span class="term-fg32">+                .map(|x| {</span>
<span class="term-fg32">+                    reth_trie::RlpNode::from_raw(&amp;x.0).expect(&quot;32 byte hash can be cast to RlpNode&quot;)</span>
<span class="term-fg32">+                })</span>
<span class="term-fg32">+                .collect(),</span>
<span class="term-fg32">+            groups: value.state_masks,</span>
<span class="term-fg32">+            tree_masks: value.tree_masks,</span>
<span class="term-fg32">+            hash_masks: value.hash_masks,</span>
<span class="term-fg32">+            stored_in_database: value.stored_in_database,</span>
<span class="term-fg32">+            updated_branch_nodes: value.updated_branch_nodes,</span>
<span class="term-fg32">+            proof_retainer: value.proof_retainer,</span>
<span class="term-fg32">+            rlp_buf: Default::default(),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(test)]</span>
<span class="term-fg32">+mod test {</span>
<span class="term-fg32">+    use super::*;</span>
<span class="term-fg32">+    use alloc::collections::BTreeMap;</span>
<span class="term-fg32">+    use hex_literal::hex;</span>
<span class="term-fg32">+    use reth_scroll_primitives::poseidon::{hash_with_domain, Fr, PrimeField};</span>
<span class="term-fg32">+    use reth_trie::BitsCompatibility;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_convert_to_bit_representation() {</span>
<span class="term-fg32">+        let nibbles = Nibbles::unpack_bits(vec![7, 8]);</span>
<span class="term-fg32">+        let expected = [0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0];</span>
<span class="term-fg32">+        assert_eq!(nibbles.as_slice(), expected);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_convert_to_bit_representation_truncation() {</span>
<span class="term-fg32">+        &#47;&#47; 64 byte nibble</span>
<span class="term-fg32">+        let hex = hex!(&quot;0102030405060708090a0b0c0d0e0f0102030405060708090a0b0c0d0e0f0102030405060708090a0b0c0d0e0f0102030405060708090a0b0c0d0e0f01020304&quot;);</span>
<span class="term-fg32">+        assert_eq!(hex.len(), 64);</span>
<span class="term-fg32">+        let nibbles = Nibbles::unpack_bits(hex);</span>
<span class="term-fg32">+        assert_eq!(nibbles.len(), 254);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_basic_trie() {</span>
<span class="term-fg32">+        &#47;&#47; Test a basic trie consisting of three key value pairs:</span>
<span class="term-fg32">+        &#47;&#47; (0, 0, 0, 0, ... , 0)</span>
<span class="term-fg32">+        &#47;&#47; (0, 0, 0, 1, ... , 0)</span>
<span class="term-fg32">+        &#47;&#47; (0, 0, 1, 0, ... , 0)</span>
<span class="term-fg32">+        &#47;&#47; (1, 1, 1, 0, ... , 0)</span>
<span class="term-fg32">+        &#47;&#47; (1, 1, 1, 1, ... , 0)</span>
<span class="term-fg32">+        &#47;&#47; The branch associated with key 0xF will be collapsed into a single leaf.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let leaf_1_key = Nibbles::from_nibbles_unchecked([</span>
<span class="term-fg32">+            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span>
<span class="term-fg32">+            0, 0, 0,</span>
<span class="term-fg32">+        ]);</span>
<span class="term-fg32">+        let leaf_2_key = Nibbles::from_nibbles_unchecked([</span>
<span class="term-fg32">+            0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span>
<span class="term-fg32">+            0, 0, 0,</span>
<span class="term-fg32">+        ]);</span>
<span class="term-fg32">+        let leaf_3_key = Nibbles::from_nibbles_unchecked([</span>
<span class="term-fg32">+            0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span>
<span class="term-fg32">+            0, 0, 0,</span>
<span class="term-fg32">+        ]);</span>
<span class="term-fg32">+        let leaf_4_key = Nibbles::from_nibbles_unchecked([</span>
<span class="term-fg32">+            1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span>
<span class="term-fg32">+            0, 0, 0,</span>
<span class="term-fg32">+        ]);</span>
<span class="term-fg32">+        let leaf_5_key = Nibbles::from_nibbles_unchecked([</span>
<span class="term-fg32">+            1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span>
<span class="term-fg32">+            0, 0, 0,</span>
<span class="term-fg32">+        ]);</span>
<span class="term-fg32">+        let leaf_keys = [</span>
<span class="term-fg32">+            leaf_1_key.clone(),</span>
<span class="term-fg32">+            leaf_2_key.clone(),</span>
<span class="term-fg32">+            leaf_3_key.clone(),</span>
<span class="term-fg32">+            leaf_4_key.clone(),</span>
<span class="term-fg32">+            leaf_5_key.clone(),</span>
<span class="term-fg32">+        ];</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let leaf_values = leaf_keys</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .enumerate()</span>
<span class="term-fg32">+            .map(|(i, key)| {</span>
<span class="term-fg32">+                let mut leaf_value = [0u8; 32];</span>
<span class="term-fg32">+                leaf_value[0] = i as u8 + 1;</span>
<span class="term-fg32">+                (key, leaf_value)</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect::&lt;BTreeMap&lt;_, _&gt;&gt;();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let leaf_hashes: BTreeMap&lt;_, _&gt; = leaf_values</span>
<span class="term-fg32">+            .iter()</span>
<span class="term-fg32">+            .map(|(key, value)| {</span>
<span class="term-fg32">+                let key_fr = Fr::from_repr_vartime(key.encode_leaf_key())</span>
<span class="term-fg32">+                    .expect(&quot;key is valid field element&quot;);</span>
<span class="term-fg32">+                let value = Fr::from_repr_vartime(*value).expect(&quot;value is a valid field element&quot;);</span>
<span class="term-fg32">+                let hash = hash_with_domain(&amp;[key_fr, value], crate::LEAF_NODE_DOMAIN);</span>
<span class="term-fg32">+                (key.clone(), hash)</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut hb = HashBuilder::default().with_updates(true);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        for (key, val) in &amp;leaf_values {</span>
<span class="term-fg32">+            hb.add_leaf(key.clone(), val);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let root = hb.root();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; node_000 -&gt; hash(leaf_1, leaf_2) LTRT</span>
<span class="term-fg32">+        &#47;&#47; node_00 -&gt; hash(node_000, leaf_3) LBRT</span>
<span class="term-fg32">+        &#47;&#47; node_0 -&gt; hash(node_00, EMPTY) LBRT</span>
<span class="term-fg32">+        &#47;&#47; node_111 -&gt; hash(leaf_4, leaf_5) LTRT</span>
<span class="term-fg32">+        &#47;&#47; node_11 -&gt; hash(EMPTY, node_111) LTRB</span>
<span class="term-fg32">+        &#47;&#47; node_1 -&gt; hash(EMPTY, node_11) LTRB</span>
<span class="term-fg32">+        &#47;&#47; root -&gt; hash(node_0, node_1) LBRB</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let expected: B256 = {</span>
<span class="term-fg32">+            let node_000 = hash_with_domain(</span>
<span class="term-fg32">+                &amp;[*leaf_hashes.get(&amp;leaf_1_key).unwrap(), *leaf_hashes.get(&amp;leaf_2_key).unwrap()],</span>
<span class="term-fg32">+                crate::BRANCH_NODE_LTRT_DOMAIN,</span>
<span class="term-fg32">+            );</span>
<span class="term-fg32">+            let node_00 = hash_with_domain(</span>
<span class="term-fg32">+                &amp;[node_000, *leaf_hashes.get(&amp;leaf_3_key).unwrap()],</span>
<span class="term-fg32">+                crate::BRANCH_NODE_LBRT_DOMAIN,</span>
<span class="term-fg32">+            );</span>
<span class="term-fg32">+            let node_0 = hash_with_domain(&amp;[node_00, Fr::zero()], crate::BRANCH_NODE_LBRT_DOMAIN);</span>
<span class="term-fg32">+            let node_111 = hash_with_domain(</span>
<span class="term-fg32">+                &amp;[*leaf_hashes.get(&amp;leaf_4_key).unwrap(), *leaf_hashes.get(&amp;leaf_5_key).unwrap()],</span>
<span class="term-fg32">+                crate::BRANCH_NODE_LTRT_DOMAIN,</span>
<span class="term-fg32">+            );</span>
<span class="term-fg32">+            let node_11 = hash_with_domain(&amp;[Fr::zero(), node_111], crate::BRANCH_NODE_LTRB_DOMAIN);</span>
<span class="term-fg32">+            let node_1 = hash_with_domain(&amp;[Fr::zero(), node_11], crate::BRANCH_NODE_LTRB_DOMAIN);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            let mut root =</span>
<span class="term-fg32">+                hash_with_domain(&amp;[node_0, node_1], crate::BRANCH_NODE_LBRB_DOMAIN).to_repr();</span>
<span class="term-fg32">+            root.reverse();</span>
<span class="term-fg32">+            root.into()</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        assert_eq!(expected, root);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6df22cbb9149e603ce93036a" role="button"
                       aria-expanded="false" aria-controls="id-6df22cbb9149e603ce93036a">
                        <code>crates/scroll/trie/src/leaf.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/trie/src/leaf.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+22</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6df22cbb9149e603ce93036a"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;trie&#47;src&#47;leaf.rs scroll-reth&#47;crates&#47;scroll&#47;trie&#47;src&#47;leaf.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..55a3df25a3b2776e4b09c3ebdf0091196581cdfd</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;trie&#47;src&#47;leaf.rs</span>
<span class="term-fg36">@@ -0,0 +1,22 @@</span>
<span class="term-fg32">+use super::LEAF_NODE_DOMAIN;</span>
<span class="term-fg32">+use alloy_primitives::B256;</span>
<span class="term-fg32">+use reth_scroll_primitives::poseidon::{hash_with_domain, Fr, PrimeField};</span>
<span class="term-fg32">+use reth_trie::{BitsCompatibility, LeafNodeRef};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A trait used to hash the leaf node.</span>
<span class="term-fg32">+pub(crate) trait HashLeaf {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Hash the leaf node.</span>
<span class="term-fg32">+    fn hash_leaf(&amp;self) -&gt; B256;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashLeaf for LeafNodeRef&lt;&#39;_&gt; {</span>
<span class="term-fg32">+    fn hash_leaf(&amp;self) -&gt; B256 {</span>
<span class="term-fg32">+        let leaf_key = Fr::from_repr_vartime(self.key.encode_leaf_key())</span>
<span class="term-fg32">+            .expect(&quot;leaf key is a valid field element&quot;);</span>
<span class="term-fg32">+        let leaf_value = Fr::from_repr_vartime(</span>
<span class="term-fg32">+            &lt;[u8; 32]&gt;::try_from(self.value).expect(&quot;leaf value is 32 bytes&quot;),</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+        .expect(&quot;leaf value is a valid field element&quot;);</span>
<span class="term-fg32">+        hash_with_domain(&amp;[leaf_key, leaf_value], LEAF_NODE_DOMAIN).to_repr().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d6212aa63cd8dc5fb1a1bc09" role="button"
                       aria-expanded="false" aria-controls="id-d6212aa63cd8dc5fb1a1bc09">
                        <code>crates/scroll/trie/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/trie/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+32</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d6212aa63cd8dc5fb1a1bc09"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;trie&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;trie&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..c5cd075acc762d1434fbd536ed4efbc6ca886c64</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;trie&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,32 @@</span>
<span class="term-fg32">+&#47;&#47;! Fast binary Merkle-Patricia Trie (zktrie) state root calculator and proof generator for</span>
<span class="term-fg32">+&#47;&#47;! prefix-sorted bits.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![cfg_attr(not(doctest), doc = include_str!(&quot;..&#47;assets&#47;zktrie.md&quot;))]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[macro_use]</span>
<span class="term-fg32">+#[allow(unused_imports)]</span>
<span class="term-fg32">+extern crate alloc;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+mod branch;</span>
<span class="term-fg32">+mod hash_builder;</span>
<span class="term-fg32">+mod leaf;</span>
<span class="term-fg32">+mod sub_tree;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use hash_builder::HashBuilder;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use reth_scroll_primitives::poseidon::Fr;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The hashing domain for leaf nodes.</span>
<span class="term-fg32">+pub const LEAF_NODE_DOMAIN: Fr = Fr::from_raw([4, 0, 0, 0]);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The hashing domain for a branch node with two terminal children.</span>
<span class="term-fg32">+pub const BRANCH_NODE_LTRT_DOMAIN: Fr = Fr::from_raw([6, 0, 0, 0]);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The hashing domain for a branch node with a left terminal child and a right branch child.</span>
<span class="term-fg32">+pub const BRANCH_NODE_LTRB_DOMAIN: Fr = Fr::from_raw([7, 0, 0, 0]);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The hashing domain for a branch node with a left branch child and a right terminal child.</span>
<span class="term-fg32">+pub const BRANCH_NODE_LBRT_DOMAIN: Fr = Fr::from_raw([8, 0, 0, 0]);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The hashing domain for a branch node with two branch children.</span>
<span class="term-fg32">+pub const BRANCH_NODE_LBRB_DOMAIN: Fr = Fr::from_raw([9, 0, 0, 0]);</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6279c0df47b32ac50ef71a89" role="button"
                       aria-expanded="false" aria-controls="id-6279c0df47b32ac50ef71a89">
                        <code>crates/scroll/trie/src/sub_tree.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/scroll/trie/src/sub_tree.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+44</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6279c0df47b32ac50ef71a89"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;trie&#47;src&#47;sub_tree.rs scroll-reth&#47;crates&#47;scroll&#47;trie&#47;src&#47;sub_tree.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..eed916b8ae7be538632d9ac082ca0e5cdb262816</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;trie&#47;src&#47;sub_tree.rs</span>
<span class="term-fg36">@@ -0,0 +1,44 @@</span>
<span class="term-fg32">+use super::{BRANCH_NODE_LBRT_DOMAIN, BRANCH_NODE_LTRB_DOMAIN};</span>
<span class="term-fg32">+use alloy_primitives::{hex, B256};</span>
<span class="term-fg32">+use alloy_trie::Nibbles;</span>
<span class="term-fg32">+use core::fmt;</span>
<span class="term-fg32">+use reth_scroll_primitives::poseidon::{hash_with_domain, Fr, PrimeField};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; [`SubTreeRef`] is a structure that allows for calculation of the root of a sparse binary Merkle</span>
<span class="term-fg32">+&#47;&#47;&#47; tree consisting of a single leaf node.</span>
<span class="term-fg32">+pub(crate) struct SubTreeRef&lt;&#39;a&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The key to the child node.</span>
<span class="term-fg32">+    pub key: &amp;&#39;a Nibbles,</span>
<span class="term-fg32">+    &#47;&#47;&#47; A pointer to the child node.</span>
<span class="term-fg32">+    pub child: &amp;&#39;a B256,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;&#39;a&gt; SubTreeRef&lt;&#39;a&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates a new subtree with the given key and a pointer to the child.</span>
<span class="term-fg32">+    #[inline]</span>
<span class="term-fg32">+    pub(crate) const fn new(key: &amp;&#39;a Nibbles, child: &amp;&#39;a B256) -&gt; Self {</span>
<span class="term-fg32">+        Self { key, child }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    pub(crate) fn root(&amp;self) -&gt; B256 {</span>
<span class="term-fg32">+        let mut tree_root =</span>
<span class="term-fg32">+            Fr::from_repr_vartime(self.child.0).expect(&quot;child is a valid field element&quot;);</span>
<span class="term-fg32">+        for bit in self.key.as_slice().iter().rev() {</span>
<span class="term-fg32">+            tree_root = if *bit == 0 {</span>
<span class="term-fg32">+                hash_with_domain(&amp;[tree_root, Fr::zero()], BRANCH_NODE_LBRT_DOMAIN)</span>
<span class="term-fg32">+            } else {</span>
<span class="term-fg32">+                hash_with_domain(&amp;[Fr::zero(), tree_root], BRANCH_NODE_LTRB_DOMAIN)</span>
<span class="term-fg32">+            };</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        tree_root.to_repr().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl fmt::Debug for SubTreeRef&lt;&#39;_&gt; {</span>
<span class="term-fg32">+    fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;&#39;_&gt;) -&gt; fmt::Result {</span>
<span class="term-fg32">+        f.debug_struct(&quot;SubTreeRef&quot;)</span>
<span class="term-fg32">+            .field(&quot;key&quot;, &amp;self.key)</span>
<span class="term-fg32">+            .field(&quot;node&quot;, &amp;hex::encode(self.child))</span>
<span class="term-fg32">+            .finish()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-f21c7e7db9e3f344feac3267"role="button" aria-expanded="false" aria-controls="id-f21c7e7db9e3f344feac3267">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/ethereum</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+72</span></div>
                    <div class="text-start"><span class="text-danger">-18</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-f21c7e7db9e3f344feac3267">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b033868eb19c564077f32aee" role="button"
                       aria-expanded="false" aria-controls="id-b033868eb19c564077f32aee">
                        <code>crates/ethereum/consensus/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/consensus/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/ethereum/consensus/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b033868eb19c564077f32aee"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;consensus&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;ethereum&#47;consensus&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 2c260c4a7d1c8de050e3d4d7bf47f42981d40bfa..26edfe0e443a28a9b09be3a59ba9275ab95a61cb 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;consensus&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;consensus&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -26,7 +26,7 @@</span> &#47;&#47;&#47; The bound divisor of the gas limit, used in update calculations.
 pub const GAS_LIMIT_BOUND_DIVISOR: u64 = 1024;
&nbsp;
 mod validation;
<span class="term-fg31">-pub use validation::validate_block_post_execution;</span>
<span class="term-fg32">+pub use validation::{validate_block_post_execution, verify_receipts};</span>
&nbsp;
 &#47;&#47;&#47; Ethereum beacon consensus
 &#47;&#47;&#47;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-927e519aff8f7e61f7289867" role="button"
                       aria-expanded="false" aria-controls="id-927e519aff8f7e61f7289867">
                        <code>crates/ethereum/consensus/src/validation.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/consensus/src/validation.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/ethereum/consensus/src/validation.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-927e519aff8f7e61f7289867"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;consensus&#47;src&#47;validation.rs scroll-reth&#47;crates&#47;ethereum&#47;consensus&#47;src&#47;validation.rs</span>
<span class="term-fg1">index f990ecc57d82db23ce7f49edbac64099cf1350cb..b07df409d36e7174e3285acc9563641a8e4fa111 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;consensus&#47;src&#47;validation.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;consensus&#47;src&#47;validation.rs</span>
<span class="term-fg36">@@ -55,7 +55,7 @@</span> }
&nbsp;
 &#47;&#47;&#47; Calculate the receipts root, and compare it against against the expected receipts root and logs
 &#47;&#47;&#47; bloom.
<span class="term-fg31">-fn verify_receipts(</span>
<span class="term-fg32">+pub fn verify_receipts(</span>
     expected_receipts_root: B256,
     expected_logs_bloom: Bloom,
     receipts: &amp;[Receipt],</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e0af34923a7f0444e3d28868" role="button"
                       aria-expanded="false" aria-controls="id-e0af34923a7f0444e3d28868">
                        <code>crates/ethereum/evm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/evm/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/ethereum/evm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+9</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e0af34923a7f0444e3d28868"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;evm&#47;Cargo.toml scroll-reth&#47;crates&#47;ethereum&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">index 17e870e61113458c1bc459d7e306e85cbe39aafa..52555b23abe36bf8a0b5ad5459962d8b7a9891c8 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;evm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -23,6 +23,9 @@</span>
 # Ethereum
 revm-primitives.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+</span>
 # Alloy
 alloy-primitives.workspace = true
 alloy-eips.workspace = true
<span class="term-fg36">@@ -38,6 +41,8 @@</span> reth-execution-types.workspace = true
 secp256k1.workspace = true
 serde_json.workspace = true
 alloy-genesis.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
&nbsp;
 [features]
 default = [&quot;std&quot;]
<span class="term-fg36">@@ -52,3 +57,7 @@</span> 	&quot;alloy-primitives&#47;std&quot;,
 	&quot;revm-primitives&#47;std&quot;,
 	&quot;secp256k1&#47;std&quot;
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-testing-utils&#47;scroll&quot;,</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c84935268ec1ed8861f42222" role="button"
                       aria-expanded="false" aria-controls="id-c84935268ec1ed8861f42222">
                        <code>crates/ethereum/evm/src/execute.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/evm/src/execute.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/ethereum/evm/src/execute.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+34</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c84935268ec1ed8861f42222"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;evm&#47;src&#47;execute.rs scroll-reth&#47;crates&#47;ethereum&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">index 8642df89698d84fa5d96c7b051574871709334ec..e22cf55e5c2388a4bd4290b6ebd0c78b9494b582 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg36">@@ -21,7 +21,8 @@</span>     system_calls::{OnStateHook, SystemCaller},
     ConfigureEvm, TxEnvOverrides,
 };
 use reth_primitives::{BlockWithSenders, Receipt};
<span class="term-fg31">-use reth_revm::db::State;</span>
<span class="term-fg32">+use reth_revm::db::{BundleState, State};</span>
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use revm_primitives::{
     db::{Database, DatabaseCommit},
     EnvWithHandlerCfg, ResultAndState, U256,
<span class="term-fg36">@@ -60,12 +61,15 @@</span> where
     EvmConfig:
         Clone + Unpin + Sync + Send + &#39;static + ConfigureEvm&lt;Header = alloy_consensus::Header&gt;,
 {
<span class="term-fg31">-    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        EthExecutionStrategy&lt;DB, EvmConfig&gt;;</span>
<span class="term-fg32">+    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = EthExecutionStrategy&lt;DB, EvmConfig&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn create_strategy&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Strategy&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         let state =
             State::builder().with_database(db).with_bundle_update().without_state_clear().build();
<span class="term-fg36">@@ -125,6 +129,7 @@</span>
 impl&lt;DB, EvmConfig&gt; BlockExecutionStrategy&lt;DB&gt; for EthExecutionStrategy&lt;DB, EvmConfig&gt;
 where
     DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     EvmConfig: ConfigureEvm&lt;Header = alloy_consensus::Header&gt;,
 {
     type Error = BlockExecutionError;
<span class="term-fg36">@@ -334,6 +339,10 @@</span>         let beacon_root_contract_account = Account {
             balance: U256::ZERO,
             bytecode_hash: Some(keccak256(BEACON_ROOTS_CODE.clone())),
             nonce: 1,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;BEACON_ROOTS_CODE,</span>
<span class="term-fg32">+            )),</span>
         };
&nbsp;
         db.insert_account(
<span class="term-fg36">@@ -353,6 +362,10 @@</span>         let withdrawal_requests_contract_account = Account {
             nonce: 1,
             balance: U256::ZERO,
             bytecode_hash: Some(keccak256(WITHDRAWAL_REQUEST_PREDEPLOY_CODE.clone())),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;WITHDRAWAL_REQUEST_PREDEPLOY_CODE,</span>
<span class="term-fg32">+            )),</span>
         };
&nbsp;
         db.insert_account(
<span class="term-fg36">@@ -716,6 +729,10 @@</span>         let blockhashes_contract_account = Account {
             balance: U256::ZERO,
             bytecode_hash: Some(keccak256(HISTORY_STORAGE_CODE.clone())),
             nonce: 1,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;HISTORY_STORAGE_CODE,</span>
<span class="term-fg32">+            )),</span>
         };
&nbsp;
         db.insert_account(
<span class="term-fg36">@@ -1068,7 +1085,13 @@</span>         let sender_address = public_key_to_address(sender_key_pair.public_key());
&nbsp;
         db.insert_account(
             sender_address,
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(ETH_TO_WEI), bytecode_hash: None },</span>
<span class="term-fg32">+            Account {</span>
<span class="term-fg32">+                nonce: 1,</span>
<span class="term-fg32">+                balance: U256::from(ETH_TO_WEI),</span>
<span class="term-fg32">+                bytecode_hash: None,</span>
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+            },</span>
             None,
             HashMap::default(),
         );
<span class="term-fg36">@@ -1150,7 +1173,13 @@</span>
         &#47;&#47; Insert the sender account into the state with a nonce of 1 and a balance of 1 ETH in Wei
         db.insert_account(
             sender_address,
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(ETH_TO_WEI), bytecode_hash: None },</span>
<span class="term-fg32">+            Account {</span>
<span class="term-fg32">+                nonce: 1,</span>
<span class="term-fg32">+                balance: U256::from(ETH_TO_WEI),</span>
<span class="term-fg32">+                bytecode_hash: None,</span>
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+            },</span>
             None,
             HashMap::default(),
         );</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fb0d1d7b3edb5967ca8478ef" role="button"
                       aria-expanded="false" aria-controls="id-fb0d1d7b3edb5967ca8478ef">
                        <code>crates/ethereum/node/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/node/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/ethereum/node/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fb0d1d7b3edb5967ca8478ef"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;node&#47;Cargo.toml scroll-reth&#47;crates&#47;ethereum&#47;node&#47;Cargo.toml</span>
<span class="term-fg1">index e6f47483b5866cfddb01473e08b533607743d2a9..3058a6b056424a197f8bd45ad6cc87b82679515e 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;node&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;node&#47;Cargo.toml</span>
<span class="term-fg36">@@ -85,3 +85,4 @@</span>     &quot;reth-trie-db&#47;test-utils&quot;,
     &quot;revm&#47;test-utils&quot;,
     &quot;reth-evm&#47;test-utils&quot;,
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fd407cd7c824ac7829fce008" role="button"
                       aria-expanded="false" aria-controls="id-fd407cd7c824ac7829fce008">
                        <code>crates/ethereum/node/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/node/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/ethereum/node/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fd407cd7c824ac7829fce008"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;node&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;ethereum&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 421cee37fb038e54502311c6120840766f85e3da..e86240a7433415a4ac6c5d659e38806b0c9400e4 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -7,6 +7,9 @@</span>     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use reth_revm as _;
 use revm as _;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-81041a0ed32b0a62cdf6370e" role="button"
                       aria-expanded="false" aria-controls="id-81041a0ed32b0a62cdf6370e">
                        <code>crates/ethereum/node/tests/e2e/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/node/tests/e2e/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/ethereum/node/tests/e2e/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-81041a0ed32b0a62cdf6370e"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;e2e&#47;main.rs scroll-reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg1">index 4ed8ac5fcb635b10b14775b983a9379be44a6795..3459db247654c4b711a52b2e42e86111125e5363 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg36">@@ -1,4 +1,7 @@</span>
 #![allow(missing_docs)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 mod blobs;
 mod dev;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5b9f80beb93447fd20a52028" role="button"
                       aria-expanded="false" aria-controls="id-5b9f80beb93447fd20a52028">
                        <code>crates/ethereum/node/tests/it/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/node/tests/it/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/ethereum/node/tests/it/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5b9f80beb93447fd20a52028"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;it&#47;main.rs scroll-reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg1">index 0f85adda31d0847f57e5047648129f97e62cfbbc..18240081f1e4f9af277fe57029f36d4cd42f4353 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg36">@@ -1,4 +1,7 @@</span>
 #![allow(missing_docs)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 mod builder;
 mod exex;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6fedc1d1445a305aac0ab36c" role="button"
                       aria-expanded="false" aria-controls="id-6fedc1d1445a305aac0ab36c">
                        <code>crates/ethereum/payload/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/payload/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/ethereum/payload/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6fedc1d1445a305aac0ab36c"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;payload&#47;Cargo.toml scroll-reth&#47;crates&#47;ethereum&#47;payload&#47;Cargo.toml</span>
<span class="term-fg1">index 4e0880d1d153097f90fd0971908651c6acb10937..0a06e0f3d68296e9a56d349d7950f2bc2f5e8b26 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;payload&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;payload&#47;Cargo.toml</span>
<span class="term-fg36">@@ -25,7 +25,6 @@</span> reth-basic-payload-builder.workspace = true
 reth-evm.workspace = true
 reth-evm-ethereum.workspace = true
 reth-errors.workspace = true
<span class="term-fg31">-reth-trie.workspace = true</span>
 reth-chain-state.workspace = true
 reth-chainspec.workspace = true
&nbsp;
<span class="term-fg36">@@ -39,3 +38,6 @@</span> alloy-primitives.workspace = true
&nbsp;
 # misc
 tracing.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-10a307df06a59af40a63802e" role="button"
                       aria-expanded="false" aria-controls="id-10a307df06a59af40a63802e">
                        <code>crates/ethereum/payload/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/ethereum/payload/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/ethereum/payload/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-10</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-10a307df06a59af40a63802e"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;payload&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;ethereum&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 43bb045048845f9f82a6b0f5547d5f15f46b79de..06dbe67890bd9c9d35fb3a9ff2cc74aa29513de5 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -35,7 +35,6 @@</span> use reth_transaction_pool::{
     error::InvalidPoolTransactionError, noop::NoopTransactionPool, BestTransactions,
     BestTransactionsAttributes, TransactionPool, ValidPoolTransaction,
 };
<span class="term-fg31">-use reth_trie::HashedPostState;</span>
 use revm::{
     db::{states::bundle_state::BundleRetention, State},
     primitives::{
<span class="term-fg36">@@ -379,7 +378,10 @@</span>     db.merge_transitions(BundleRetention::Reverts);
&nbsp;
     let requests_hash = requests.as_ref().map(|requests| requests.requests_hash());
     let execution_outcome = ExecutionOutcome::new(
<span class="term-fg31">-        db.take_bundle(),</span>
<span class="term-fg32">+        &#47;&#47; TODO(scroll): allow the information loss of the Scroll account fields for the Ethereum</span>
<span class="term-fg32">+        &#47;&#47; payload builder. Remove once we transition to the `ScrollPayloadBuilder`.</span>
<span class="term-fg32">+        #[allow(clippy::useless_conversion)]</span>
<span class="term-fg32">+        db.take_bundle().into(),</span>
         vec![receipts].into(),
         block_number,
         vec![requests.clone().unwrap_or_default()],
<span class="term-fg36">@@ -389,15 +391,17 @@</span>         execution_outcome.receipts_root_slow(block_number).expect(&quot;Number is in range&quot;);
     let logs_bloom = execution_outcome.block_logs_bloom(block_number).expect(&quot;Number is in range&quot;);
&nbsp;
     &#47;&#47; calculate the state root
<span class="term-fg31">-    let hashed_state = HashedPostState::from_bundle_state(&amp;execution_outcome.state().state);</span>
<span class="term-fg32">+    let hashed_state = db.database.db.hashed_post_state(execution_outcome.state());</span>
     let (state_root, trie_output) = {
<span class="term-fg31">-        db.database.inner().state_root_with_updates(hashed_state.clone()).inspect_err(|err| {</span>
<span class="term-fg31">-            warn!(target: &quot;payload_builder&quot;,</span>
<span class="term-fg31">-                parent_hash=%parent_header.hash(),</span>
<span class="term-fg31">-                %err,</span>
<span class="term-fg31">-                &quot;failed to calculate state root for payload&quot;</span>
<span class="term-fg31">-            );</span>
<span class="term-fg31">-        })?</span>
<span class="term-fg32">+        db.database.inner().state_root_from_state_with_updates(hashed_state.clone()).inspect_err(</span>
<span class="term-fg32">+            |err| {</span>
<span class="term-fg32">+                warn!(target: &quot;payload_builder&quot;,</span>
<span class="term-fg32">+                    parent_hash=%parent_header.hash(),</span>
<span class="term-fg32">+                    %err,</span>
<span class="term-fg32">+                    &quot;failed to calculate state root for payload&quot;</span>
<span class="term-fg32">+                );</span>
<span class="term-fg32">+            },</span>
<span class="term-fg32">+        )?</span>
     };
&nbsp;
     &#47;&#47; create the block header</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-a1bb91b7784ddaeb10253368"role="button" aria-expanded="false" aria-controls="id-a1bb91b7784ddaeb10253368">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/optimism</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+51</span></div>
                    <div class="text-start"><span class="text-danger">-19</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-a1bb91b7784ddaeb10253368">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2a8df35427e6d8b6cb82f3db" role="button"
                       aria-expanded="false" aria-controls="id-2a8df35427e6d8b6cb82f3db">
                        <code>crates/optimism/bin/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/bin/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/bin/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2a8df35427e6d8b6cb82f3db"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;bin&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;bin&#47;Cargo.toml</span>
<span class="term-fg1">index 45f4492e82b60cf492ff5ff5223a2fe3e0d13fe9..efbea77454cca22287f6a2f83a225e606f75e2d4 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;bin&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;bin&#47;Cargo.toml</span>
<span class="term-fg36">@@ -46,6 +46,7 @@</span> 	&quot;reth-optimism-payload-builder&#47;optimism&quot;,
 	&quot;reth-optimism-rpc&#47;optimism&quot;,
 	&quot;reth-provider&#47;optimism&quot;
 ]
<span class="term-fg32">+scroll = []</span>
&nbsp;
 dev = [
 	&quot;reth-optimism-cli&#47;dev&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b9974b3425e742c85856eac2" role="button"
                       aria-expanded="false" aria-controls="id-b9974b3425e742c85856eac2">
                        <code>crates/optimism/bin/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/bin/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/bin/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b9974b3425e742c85856eac2"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 21c28f7c5470f38893c52fa10198a0feed2323f7..b3e274e678f577e7f76827917b387f033c2011a7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -24,8 +24,9 @@</span>     html_favicon_url = &quot;https:&#47;&#47;avatars0.githubusercontent.com&#47;u&#47;97369466?s=256&quot;,
     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
<span class="term-fg31">-#![cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
&nbsp;
 &#47;&#47;&#47; Re-exported from `reth_optimism_cli`.
 pub mod cli {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-42ad625cd952728b9ba997d8" role="button"
                       aria-expanded="false" aria-controls="id-42ad625cd952728b9ba997d8">
                        <code>crates/optimism/bin/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/bin/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/bin/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-42ad625cd952728b9ba997d8"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;main.rs scroll-reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;main.rs</span>
<span class="term-fg1">index 6494298ba393b461323b9430d440a640cb1e0e61..4fb016b34757ec8d0cec23cefa495145c0b58804 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,6 +1,7 @@</span>
 #![allow(missing_docs, rustdoc::missing_crate_level_docs)]
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
<span class="term-fg31">-#![cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
&nbsp;
 use clap::Parser;
 use reth_node_builder::{engine_tree_config::TreeConfig, EngineNodeLauncher};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e374ecf382f4d05530786e4b" role="button"
                       aria-expanded="false" aria-controls="id-e374ecf382f4d05530786e4b">
                        <code>crates/optimism/cli/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/cli/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/cli/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e374ecf382f4d05530786e4b"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;cli&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;cli&#47;Cargo.toml</span>
<span class="term-fg1">index b61a4628f4d2b5abc96356d8414385deceef1d37..b13eac3b52ea749688a268a563ef17ef7f2d90e4 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;cli&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;cli&#47;Cargo.toml</span>
<span class="term-fg36">@@ -123,3 +123,4 @@</span> 	&quot;reth-execution-types&#47;serde&quot;,
 	&quot;reth-provider&#47;serde&quot;,
 	&quot;reth-optimism-primitives&#47;serde&quot;,
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-93ea3cf57a711e9cdbf3104e" role="button"
                       aria-expanded="false" aria-controls="id-93ea3cf57a711e9cdbf3104e">
                        <code>crates/optimism/cli/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/cli/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/cli/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-93ea3cf57a711e9cdbf3104e"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;cli&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;cli&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 23eaa99b521330609777f97db7bdd0bab92857ee..900d4ddf4c9943083928def576acbb18c3ce24ef 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;cli&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;cli&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -7,8 +7,9 @@</span>     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(all(not(test), feature = &quot;optimism&quot;), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
<span class="term-fg31">-#![cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
&nbsp;
 &#47;&#47;&#47; Optimism chain specification parser.
 pub mod chainspec;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e4c03e097d2de11d6fc7373a" role="button"
                       aria-expanded="false" aria-controls="id-e4c03e097d2de11d6fc7373a">
                        <code>crates/optimism/consensus/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/consensus/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/consensus/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e4c03e097d2de11d6fc7373a"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;consensus&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;consensus&#47;Cargo.toml</span>
<span class="term-fg1">index 0dffceaddca990215aa790a2fdeee46c5b370ea6..bfe2e3d52665579072d09180dd57a8c3f758d321 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;consensus&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;consensus&#47;Cargo.toml</span>
<span class="term-fg36">@@ -36,3 +36,4 @@</span> reth-optimism-chainspec.workspace = true
&nbsp;
 [features]
 optimism = [&quot;reth-primitives&#47;optimism&quot;]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-96087e98d914157dcc6200f6" role="button"
                       aria-expanded="false" aria-controls="id-96087e98d914157dcc6200f6">
                        <code>crates/optimism/consensus/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/consensus/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/consensus/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-96087e98d914157dcc6200f6"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;consensus&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;consensus&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 69d943785821e5721fd72da5843904d3da511fa4..35c8d6a9d8fdac9122c59de1812ac61fdb733b36 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;consensus&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;consensus&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -6,8 +6,9 @@</span>     html_favicon_url = &quot;https:&#47;&#47;avatars0.githubusercontent.com&#47;u&#47;97369466?s=256&quot;,
     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
<span class="term-fg31">-#![cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
&nbsp;
 use alloy_consensus::{Header, EMPTY_OMMER_ROOT_HASH};
 use alloy_primitives::{B64, U256};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1fb026f0bf936933a22fb8db" role="button"
                       aria-expanded="false" aria-controls="id-1fb026f0bf936933a22fb8db">
                        <code>crates/optimism/evm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/evm/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/evm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1fb026f0bf936933a22fb8db"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;evm&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">index 807f224ca4b8ea23d95fe5334014ee9262822c70..901d9c31534ee83c48d7ad9175851b6429428915 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;evm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -33,6 +33,9 @@</span> reth-optimism-consensus.workspace = true
 reth-optimism-chainspec.workspace = true
 reth-optimism-forks.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+</span>
 # revm
 revm.workspace = true
 revm-primitives.workspace = true
<span class="term-fg36">@@ -70,3 +73,4 @@</span> 	&quot;reth-optimism-consensus&#47;optimism&quot;,
 	&quot;revm&#47;optimism&quot;,
 	&quot;revm-primitives&#47;optimism&quot;
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-888d00d099b484135c62d64e" role="button"
                       aria-expanded="false" aria-controls="id-888d00d099b484135c62d64e">
                        <code>crates/optimism/evm/src/execute.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/evm/src/execute.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/evm/src/execute.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-888d00d099b484135c62d64e"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;execute.rs scroll-reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">index 1c93d2b71d03aabaa302c8853a977856f2d10f98..8546b9867b3a09af336c94c25c9eb42e09516bbd 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg36">@@ -22,6 +22,8 @@</span> use reth_optimism_consensus::validate_block_post_execution;
 use reth_optimism_forks::OpHardfork;
 use reth_primitives::{BlockWithSenders, Receipt, TxType};
 use reth_revm::{Database, State};
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
<span class="term-fg32">+use revm::db::BundleState;</span>
 use revm_primitives::{db::DatabaseCommit, EnvWithHandlerCfg, ResultAndState, U256};
 use tracing::trace;
&nbsp;
<span class="term-fg36">@@ -53,12 +55,15 @@</span> where
     EvmConfig:
         Clone + Unpin + Sync + Send + &#39;static + ConfigureEvm&lt;Header = alloy_consensus::Header&gt;,
 {
<span class="term-fg31">-    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        OpExecutionStrategy&lt;DB, EvmConfig&gt;;</span>
<span class="term-fg32">+    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = OpExecutionStrategy&lt;DB, EvmConfig&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn create_strategy&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Strategy&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         let state =
             State::builder().with_database(db).with_bundle_update().without_state_clear().build();
<span class="term-fg36">@@ -112,6 +117,7 @@</span>
 impl&lt;DB, EvmConfig&gt; BlockExecutionStrategy&lt;DB&gt; for OpExecutionStrategy&lt;DB, EvmConfig&gt;
 where
     DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     EvmConfig: ConfigureEvm&lt;Header = alloy_consensus::Header&gt;,
 {
     type Error = BlockExecutionError;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8a4bcb052dd5fa60d78f5b72" role="button"
                       aria-expanded="false" aria-controls="id-8a4bcb052dd5fa60d78f5b72">
                        <code>crates/optimism/evm/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/evm/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/evm/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8a4bcb052dd5fa60d78f5b72"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 176864de6dc57829c3752646bac7a71394ba11f8..df56087e492c65b8044c570464e92ec3ef13da05 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -7,8 +7,9 @@</span>     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![cfg_attr(not(feature = &quot;std&quot;), no_std)]
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
<span class="term-fg31">-#![cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
&nbsp;
 extern crate alloc;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-03a3baef8e6c300a881a4bb4" role="button"
                       aria-expanded="false" aria-controls="id-03a3baef8e6c300a881a4bb4">
                        <code>crates/optimism/node/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/node/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/node/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-03a3baef8e6c300a881a4bb4"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;node&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;node&#47;Cargo.toml</span>
<span class="term-fg1">index 5f100f0a28d1c7c409115538f7dc5beaa5d83b39..4c080d7d0e855473ea1f26e58912158940dcfc11 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;node&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;node&#47;Cargo.toml</span>
<span class="term-fg36">@@ -130,3 +130,4 @@</span> reth-codec = [
     &quot;reth-primitives&#47;reth-codec&quot;,
     &quot;reth-optimism-primitives&#47;reth-codec&quot;,
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9f2d612320345d8197aaa50e" role="button"
                       aria-expanded="false" aria-controls="id-9f2d612320345d8197aaa50e">
                        <code>crates/optimism/node/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/node/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/node/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9f2d612320345d8197aaa50e"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;node&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 7af0f3b8a722f3be89f2441ced4248d4587ea825..f228ae1fa2fdc1ee7541ca84805a5b99b2a885b3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -6,8 +6,9 @@</span>     html_favicon_url = &quot;https:&#47;&#47;avatars0.githubusercontent.com&#47;u&#47;97369466?s=256&quot;,
     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
<span class="term-fg31">-#![cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
&nbsp;
 &#47;&#47;&#47; CLI argument parsing for the optimism node.
 pub mod args;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2fcf05c4fcb596eec021a6aa" role="button"
                       aria-expanded="false" aria-controls="id-2fcf05c4fcb596eec021a6aa">
                        <code>crates/optimism/node/tests/e2e/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/node/tests/e2e/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/node/tests/e2e/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2fcf05c4fcb596eec021a6aa"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;e2e&#47;main.rs scroll-reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg1">index 7f4b22ba7e04eb795bc6286c44f1464f5c9f6c1c..d0c12c52cd61cc88872dc69bb9b017f300198ec7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg36">@@ -1,6 +1,9 @@</span>
 #![allow(missing_docs)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
<span class="term-fg31">-#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
 mod p2p;
&nbsp;
 const fn main() {}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c595d8d41e08cb5cc2446a5c" role="button"
                       aria-expanded="false" aria-controls="id-c595d8d41e08cb5cc2446a5c">
                        <code>crates/optimism/node/tests/it/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/node/tests/it/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/node/tests/it/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c595d8d41e08cb5cc2446a5c"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;it&#47;main.rs scroll-reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg1">index d0533fc4541ca1543d060df932dad643f9e3ab5c..6ac5cf6cf1c660ff7b1f0aee082b93b0ad0bc2df 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg36">@@ -1,9 +1,12 @@</span>
 #![allow(missing_docs)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
<span class="term-fg31">-#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
 mod builder;
&nbsp;
<span class="term-fg31">-#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
 mod priority;
&nbsp;
 const fn main() {}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8e8ad7096941d562d05cbff7" role="button"
                       aria-expanded="false" aria-controls="id-8e8ad7096941d562d05cbff7">
                        <code>crates/optimism/payload/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/payload/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/payload/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8e8ad7096941d562d05cbff7"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;payload&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;payload&#47;Cargo.toml</span>
<span class="term-fg1">index 7f47da7e23606048ab1af463c18f61894dd55f0b..8bf0c4e3ea92a204823a985ff20d4de888973ba7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;payload&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;payload&#47;Cargo.toml</span>
<span class="term-fg36">@@ -26,7 +26,6 @@</span> reth-payload-builder-primitives.workspace = true
 reth-payload-util.workspace = true
 reth-payload-primitives = { workspace = true, features = [&quot;op&quot;] }
 reth-basic-payload-builder.workspace = true
<span class="term-fg31">-reth-trie.workspace = true</span>
 reth-chain-state.workspace = true
&nbsp;
 # op-reth
<span class="term-fg36">@@ -59,4 +58,5 @@</span> 	&quot;reth-optimism-evm&#47;optimism&quot;,
 	&quot;revm&#47;optimism&quot;,
 	&quot;reth-execution-types&#47;optimism&quot;,
 	&quot;reth-optimism-consensus&#47;optimism&quot;
<span class="term-fg31">-]</span>
<span class="term-fg31">\ No newline at end of file</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = []</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e9f769b4a327188013c5bc5c" role="button"
                       aria-expanded="false" aria-controls="id-e9f769b4a327188013c5bc5c">
                        <code>crates/optimism/payload/src/builder.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/payload/src/builder.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/payload/src/builder.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e9f769b4a327188013c5bc5c"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;builder.rs scroll-reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;builder.rs</span>
<span class="term-fg1">index fbf99c78d9e7c30eda1515b809f09920c3962a95..108bbca94fd65f5e898ef088324f6b8df9aa8c7f 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;builder.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;builder.rs</span>
<span class="term-fg36">@@ -21,12 +21,14 @@</span> use reth_payload_util::PayloadTransactions;
 use reth_primitives::{
     proofs, Block, BlockBody, BlockExt, Receipt, SealedHeader, TransactionSigned, TxType,
 };
<span class="term-fg31">-use reth_provider::{ProviderError, StateProofProvider, StateProviderFactory, StateRootProvider};</span>
<span class="term-fg32">+use reth_provider::{</span>
<span class="term-fg32">+    HashedPostStateProvider, ProviderError, StateProofProvider, StateProviderFactory,</span>
<span class="term-fg32">+    StateRootProvider,</span>
<span class="term-fg32">+};</span>
 use reth_revm::database::StateProviderDatabase;
 use reth_transaction_pool::{
     noop::NoopTransactionPool, BestTransactionsAttributes, TransactionPool,
 };
<span class="term-fg31">-use reth_trie::HashedPostState;</span>
 use revm::{
     db::{states::bundle_state::BundleRetention, State},
     primitives::{
<span class="term-fg36">@@ -338,7 +340,7 @@</span>     ) -&gt; Result&lt;BuildOutcomeKind&lt;OpBuiltPayload&gt;, PayloadBuilderError&gt;
     where
         EvmConfig: ConfigureEvm&lt;Header = Header&gt;,
         DB: Database&lt;Error = ProviderError&gt; + AsRef&lt;P&gt;,
<span class="term-fg31">-        P: StateRootProvider,</span>
<span class="term-fg32">+        P: StateRootProvider + HashedPostStateProvider,</span>
     {
         let ExecutedPayload { info, withdrawals_root } = match self.execute(&amp;mut state, &amp;ctx)? {
             BuildOutcomeKind::Better { payload } | BuildOutcomeKind::Freeze(payload) =&gt; payload,
<span class="term-fg36">@@ -366,9 +368,10 @@</span>         let logs_bloom =
             execution_outcome.block_logs_bloom(block_number).expect(&quot;Number is in range&quot;);
&nbsp;
         &#47;&#47; &#47;&#47; calculate the state root
<span class="term-fg31">-        let hashed_state = HashedPostState::from_bundle_state(&amp;execution_outcome.state().state);</span>
<span class="term-fg32">+        let state_provider = state.database.as_ref();</span>
<span class="term-fg32">+        let hashed_state = state_provider.hashed_post_state(execution_outcome.state());</span>
         let (state_root, trie_output) = {
<span class="term-fg31">-            state.database.as_ref().state_root_with_updates(hashed_state.clone()).inspect_err(</span>
<span class="term-fg32">+            state_provider.state_root_from_state_with_updates(hashed_state.clone()).inspect_err(</span>
                 |err| {
                     warn!(target: &quot;payload_builder&quot;,
                     parent_header=%ctx.parent().hash(),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-36ae34370dfb3c19b909a578" role="button"
                       aria-expanded="false" aria-controls="id-36ae34370dfb3c19b909a578">
                        <code>crates/optimism/payload/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/payload/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/payload/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-36ae34370dfb3c19b909a578"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 8447026d783a3fd65a755da88e20b9b75f5734e8..ab7f9897bc83bb711dd1d5a99a5d4e473fc55f22 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -8,8 +8,9 @@</span> )]
 #![cfg_attr(all(not(test), feature = &quot;optimism&quot;), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![allow(clippy::useless_let_if_seq)]
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
<span class="term-fg31">-#![cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
&nbsp;
 pub mod builder;
 pub use builder::OpPayloadBuilder;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-bd3cd707619544d81cbdb47d" role="button"
                       aria-expanded="false" aria-controls="id-bd3cd707619544d81cbdb47d">
                        <code>crates/optimism/rpc/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/rpc/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/rpc/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-bd3cd707619544d81cbdb47d"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;rpc&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg1">index 50194f39aa3c941f14a0272f6e2e95000277c824..09a0b81170d7da5d5f4e93a481b55920753ee9f3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg36">@@ -75,3 +75,4 @@</span> 	&quot;revm&#47;optimism&quot;,
 	&quot;reth-optimism-consensus&#47;optimism&quot;,
 	&quot;reth-optimism-payload-builder&#47;optimism&quot;
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6f1bcf653f3325a1ade9a022" role="button"
                       aria-expanded="false" aria-controls="id-6f1bcf653f3325a1ade9a022">
                        <code>crates/optimism/rpc/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/optimism/rpc/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/optimism/rpc/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6f1bcf653f3325a1ade9a022"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;rpc&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;rpc&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 0fa0debdf33dbb4dbc78f71a53d0f84c27f331be..0f925459abab1bedb3c22c01e93f55eab2a6531e 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;rpc&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;rpc&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -7,8 +7,9 @@</span>     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(all(not(test), feature = &quot;optimism&quot;), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
<span class="term-fg31">-#![cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#![cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
&nbsp;
 pub mod error;
 pub mod eth;</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-8eef94102162a455f2f91db9"role="button" aria-expanded="false" aria-controls="id-8eef94102162a455f2f91db9">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/primitives</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+584</span></div>
                    <div class="text-start"><span class="text-danger">-135</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-8eef94102162a455f2f91db9">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-46fd114077873c2fbf7ab650" role="button"
                       aria-expanded="false" aria-controls="id-46fd114077873c2fbf7ab650">
                        <code>crates/primitives-traits/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives-traits/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/primitives-traits/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-46fd114077873c2fbf7ab650"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives-traits&#47;Cargo.toml scroll-reth&#47;crates&#47;primitives-traits&#47;Cargo.toml</span>
<span class="term-fg1">index df4491b2d126f719746ed52a8bf1d933491d3dce..87a96bec480e76640c16d4225eafce3b0d8f6a96 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives-traits&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives-traits&#47;Cargo.toml</span>
<span class="term-fg36">@@ -21,7 +21,10 @@</span> alloy-eips.workspace = true
 alloy-genesis.workspace = true
 alloy-primitives.workspace = true
 alloy-rlp.workspace = true
<span class="term-fg31">-revm-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# revm-primitives scroll re-export</span>
<span class="term-fg32">+revm-primitives = { package = &quot;reth-scroll-revm&quot;, path = &quot;..&#47;scroll&#47;revm&quot;, features = [&quot;serde&quot;] }</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
&nbsp;
 # misc
 byteorder = { workspace = true, optional = true }
<span class="term-fg36">@@ -65,7 +68,8 @@</span> 	&quot;serde?&#47;std&quot;
 ]
 test-utils = [
 	&quot;arbitrary&quot;,
<span class="term-fg31">-	&quot;reth-codecs?&#47;test-utils&quot;</span>
<span class="term-fg32">+	&quot;reth-codecs?&#47;test-utils&quot;,</span>
<span class="term-fg32">+	&quot;revm-primitives&#47;test-utils&quot;</span>
 ]
 arbitrary = [
 	&quot;std&quot;,
<span class="term-fg36">@@ -76,7 +80,8 @@</span> 	&quot;dep:proptest&quot;,
 	&quot;dep:proptest-arbitrary-interop&quot;,
 	&quot;alloy-eips&#47;arbitrary&quot;,
 	&quot;revm-primitives&#47;arbitrary&quot;,
<span class="term-fg31">-	&quot;reth-codecs?&#47;arbitrary&quot;</span>
<span class="term-fg32">+	&quot;reth-codecs?&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives?&#47;arbitrary&quot;</span>
 ]
 serde-bincode-compat = [
 	&quot;serde&quot;,
<span class="term-fg36">@@ -92,12 +97,17 @@</span>     &quot;alloy-primitives&#47;serde&quot;,
     &quot;bytes&#47;serde&quot;,
     &quot;rand&#47;serde&quot;,
     &quot;reth-codecs?&#47;serde&quot;,
<span class="term-fg31">-    &quot;revm-primitives&#47;serde&quot;,</span>
     &quot;roaring&#47;serde&quot;,
 	&quot;revm-primitives&#47;serde&quot;,
<span class="term-fg32">+	&quot;reth-scroll-primitives?&#47;serde&quot;</span>
 ]
 reth-codec = [
 	&quot;dep:reth-codecs&quot;,
 	&quot;dep:modular-bitfield&quot;,
 	&quot;dep:byteorder&quot;,
 ]
<span class="term-fg32">+</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+	&quot;revm-primitives&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f7fd9548f2ff5dd9bf5fbe42" role="button"
                       aria-expanded="false" aria-controls="id-f7fd9548f2ff5dd9bf5fbe42">
                        <code>crates/primitives-traits/src/account.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives-traits/src/account.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/primitives-traits/src/account.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+150</span></div>
                            <div class="text-start"><span class="text-danger">-11</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f7fd9548f2ff5dd9bf5fbe42"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives-traits&#47;src&#47;account.rs scroll-reth&#47;crates&#47;primitives-traits&#47;src&#47;account.rs</span>
<span class="term-fg1">index c8504f3b63cba932923146ca3960e189d565a1c1..d1914c3f86976e7e7a31abd9f30502a594cf9d0c 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives-traits&#47;src&#47;account.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives-traits&#47;src&#47;account.rs</span>
<span class="term-fg36">@@ -25,7 +25,7 @@</span> }
&nbsp;
 &#47;&#47;&#47; An Ethereum account.
 #[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]
<span class="term-fg31">-#[derive(Clone, Copy, Debug, PartialEq, Eq, Default)]</span>
<span class="term-fg32">+#[derive(Clone, Copy, Debug, PartialEq, Eq)]</span>
 #[cfg_attr(any(test, feature = &quot;arbitrary&quot;), derive(arbitrary::Arbitrary))]
 #[cfg_attr(any(test, feature = &quot;reth-codec&quot;), derive(reth_codecs::Compact))]
 #[cfg_attr(any(test, feature = &quot;reth-codec&quot;), reth_codecs::add_arbitrary_tests(compact))]
<span class="term-fg36">@@ -36,6 +36,27 @@</span>     &#47;&#47;&#47; Account balance.
     pub balance: U256,
     &#47;&#47;&#47; Hash of the account&#39;s bytecode.
     pub bytecode_hash: Option&lt;B256&gt;,
<span class="term-fg32">+    &#47;&#47;&#47; The extension for a Scroll account. This `Option` should always be `Some` and is used</span>
<span class="term-fg32">+    &#47;&#47;&#47; in order to maintain backward compatibility in case additional fields are added on the</span>
<span class="term-fg32">+    &#47;&#47;&#47; `Account` due to the way storage compaction is performed.</span>
<span class="term-fg32">+    &#47;&#47;&#47; Adding the `code_size` and the `poseidon_code_hash` fields on the `Account` without the</span>
<span class="term-fg32">+    &#47;&#47;&#47; extension caused the used bits of the bitflag struct to reach 16 bits, meaning no</span>
<span class="term-fg32">+    &#47;&#47;&#47; additional bitflag was available. See [reth codecs](reth_codecs::test_utils) for more</span>
<span class="term-fg32">+    &#47;&#47;&#47; details.</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    pub account_extension: Option&lt;reth_scroll_primitives::AccountExtension&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Default for Account {</span>
<span class="term-fg32">+    fn default() -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
 }
&nbsp;
 impl Account {
<span class="term-fg36">@@ -49,7 +70,7 @@</span>     &#47;&#47;&#47; &amp;&amp; bytecode = None (or hash is [`KECCAK_EMPTY`]).
     pub fn is_empty(&amp;self) -&gt; bool {
         self.nonce == 0 &amp;&amp;
             self.balance.is_zero() &amp;&amp;
<span class="term-fg31">-            self.bytecode_hash.map_or(true, |hash| hash == KECCAK_EMPTY)</span>
<span class="term-fg32">+            self.bytecode_hash.is_none_or(|hash| hash == KECCAK_EMPTY)</span>
     }
&nbsp;
     &#47;&#47;&#47; Returns an account bytecode&#39;s hash.
<span class="term-fg36">@@ -57,6 +78,44 @@</span>     &#47;&#47;&#47; In case of no bytecode, returns [`KECCAK_EMPTY`].
     pub fn get_bytecode_hash(&amp;self) -&gt; B256 {
         self.bytecode_hash.unwrap_or(KECCAK_EMPTY)
     }
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Convert an [`revm_primitives::shared::AccountInfo`] into an [`Account`]</span>
<span class="term-fg32">+    pub fn from_account_info(info: revm_primitives::shared::AccountInfo) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: info.balance,</span>
<span class="term-fg32">+            nonce: info.nonce,</span>
<span class="term-fg32">+            bytecode_hash: (info.code_hash != KECCAK_EMPTY).then_some(info.code_hash),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension {</span>
<span class="term-fg32">+                code_size: (info.poseidon_code_hash !=</span>
<span class="term-fg32">+                    reth_scroll_primitives::poseidon::POSEIDON_EMPTY)</span>
<span class="term-fg32">+                    .then_some(info.code_size as u64)</span>
<span class="term-fg32">+                    .unwrap_or_default(),</span>
<span class="term-fg32">+                poseidon_code_hash: (info.poseidon_code_hash !=</span>
<span class="term-fg32">+                    reth_scroll_primitives::poseidon::POSEIDON_EMPTY)</span>
<span class="term-fg32">+                    .then_some(info.poseidon_code_hash),</span>
<span class="term-fg32">+            }),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+impl Account {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the code size (number of bytes) for the code in this account.</span>
<span class="term-fg32">+    &#47;&#47;&#47; In case of no bytecode, returns 0.</span>
<span class="term-fg32">+    pub fn get_code_size(&amp;self) -&gt; u64 {</span>
<span class="term-fg32">+        self.account_extension.as_ref().unwrap().code_size</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the account poseidon code hash.</span>
<span class="term-fg32">+    &#47;&#47;&#47; In the case of no bytecode returns [`reth_scroll_primitives::poseidon::POSEIDON_EMPTY`]</span>
<span class="term-fg32">+    pub fn get_poseidon_code_hash(&amp;self) -&gt; B256 {</span>
<span class="term-fg32">+        self.account_extension</span>
<span class="term-fg32">+            .as_ref()</span>
<span class="term-fg32">+            .unwrap()</span>
<span class="term-fg32">+            .poseidon_code_hash</span>
<span class="term-fg32">+            .unwrap_or(reth_scroll_primitives::poseidon::POSEIDON_EMPTY)</span>
<span class="term-fg32">+    }</span>
 }
&nbsp;
 &#47;&#47;&#47; Bytecode for an account.
<span class="term-fg36">@@ -172,6 +231,10 @@</span>         Self {
             nonce: value.nonce.unwrap_or_default(),
             balance: value.balance,
             bytecode_hash: value.code.as_ref().map(keccak256),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                value.code.as_ref().unwrap_or_default(),</span>
<span class="term-fg32">+            )),</span>
         }
     }
 }
<span class="term-fg36">@@ -183,6 +246,8 @@</span>         Self {
             balance: revm_acc.balance,
             nonce: revm_acc.nonce,
             bytecode_hash: (code_hash != KECCAK_EMPTY).then_some(code_hash),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some((revm_acc.code_size, revm_acc.poseidon_code_hash).into()),</span>
         }
     }
 }
<span class="term-fg36">@@ -194,10 +259,45 @@</span>             balance: reth_acc.balance,
             nonce: reth_acc.nonce,
             code_hash: reth_acc.bytecode_hash.unwrap_or(KECCAK_EMPTY),
             code: None,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: reth_acc.account_extension.unwrap_or_default().code_size,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: reth_acc</span>
<span class="term-fg32">+                .account_extension</span>
<span class="term-fg32">+                .unwrap_or_default()</span>
<span class="term-fg32">+                .poseidon_code_hash</span>
<span class="term-fg32">+                .unwrap_or(reth_scroll_primitives::poseidon::POSEIDON_EMPTY),</span>
         }
     }
 }
&nbsp;
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+impl From&lt;Account&gt; for revm_primitives::shared::AccountInfo {</span>
<span class="term-fg32">+    fn from(reth_acc: Account) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: reth_acc.balance,</span>
<span class="term-fg32">+            nonce: reth_acc.nonce,</span>
<span class="term-fg32">+            code_size: reth_acc</span>
<span class="term-fg32">+                .account_extension</span>
<span class="term-fg32">+                .map(|acc| acc.code_size as usize)</span>
<span class="term-fg32">+                .unwrap_or_default(),</span>
<span class="term-fg32">+            code_hash: reth_acc.bytecode_hash.unwrap_or(KECCAK_EMPTY),</span>
<span class="term-fg32">+            poseidon_code_hash: reth_acc</span>
<span class="term-fg32">+                .account_extension</span>
<span class="term-fg32">+                .and_then(|acc| acc.poseidon_code_hash)</span>
<span class="term-fg32">+                .unwrap_or(reth_scroll_primitives::poseidon::POSEIDON_EMPTY),</span>
<span class="term-fg32">+            code: None,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;scroll&quot;, feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl From&lt;revm_primitives::shared::AccountInfo&gt; for Account {</span>
<span class="term-fg32">+    fn from(info: revm_primitives::shared::AccountInfo) -&gt; Self {</span>
<span class="term-fg32">+        Self::from_account_info(info)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 #[cfg(test)]
 mod tests {
     use alloy_primitives::{hex_literal::hex, B256, U256};
<span class="term-fg36">@@ -224,7 +324,13 @@</span>     }
&nbsp;
     #[test]
     fn test_empty_account() {
<span class="term-fg31">-        let mut acc = Account { nonce: 0, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg32">+        let mut acc = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         &#47;&#47; Nonce 0, balance 0, and bytecode hash set to None is considered empty.
         assert!(acc.is_empty());
&nbsp;
<span class="term-fg36">@@ -276,12 +382,23 @@</span>
     #[test]
     fn test_account_has_bytecode() {
         &#47;&#47; Account with no bytecode (None)
<span class="term-fg31">-        let acc_no_bytecode = Account { nonce: 1, balance: U256::from(1000), bytecode_hash: None };</span>
<span class="term-fg32">+        let acc_no_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(1000),</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         assert!(!acc_no_bytecode.has_bytecode(), &quot;Account should not have bytecode&quot;);
&nbsp;
         &#47;&#47; Account with bytecode hash set to KECCAK_EMPTY (should have bytecode)
<span class="term-fg31">-        let acc_empty_bytecode =</span>
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(1000), bytecode_hash: Some(KECCAK_EMPTY) };</span>
<span class="term-fg32">+        let acc_empty_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(1000),</span>
<span class="term-fg32">+            bytecode_hash: Some(KECCAK_EMPTY),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         assert!(acc_empty_bytecode.has_bytecode(), &quot;Account should have bytecode&quot;);
&nbsp;
         &#47;&#47; Account with a non-empty bytecode hash
<span class="term-fg36">@@ -289,6 +406,10 @@</span>         let acc_with_bytecode = Account {
             nonce: 1,
             balance: U256::from(1000),
             bytecode_hash: Some(B256::from_slice(&amp;[0x11u8; 32])),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;[0x11u8; 32],</span>
<span class="term-fg32">+            )),</span>
         };
         assert!(acc_with_bytecode.has_bytecode(), &quot;Account should have bytecode&quot;);
     }
<span class="term-fg36">@@ -296,12 +417,23 @@</span>
     #[test]
     fn test_account_get_bytecode_hash() {
         &#47;&#47; Account with no bytecode (should return KECCAK_EMPTY)
<span class="term-fg31">-        let acc_no_bytecode = Account { nonce: 0, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg32">+        let acc_no_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         assert_eq!(acc_no_bytecode.get_bytecode_hash(), KECCAK_EMPTY, &quot;Should return KECCAK_EMPTY&quot;);
&nbsp;
         &#47;&#47; Account with bytecode hash set to KECCAK_EMPTY
<span class="term-fg31">-        let acc_empty_bytecode =</span>
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(1000), bytecode_hash: Some(KECCAK_EMPTY) };</span>
<span class="term-fg32">+        let acc_empty_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(1000),</span>
<span class="term-fg32">+            bytecode_hash: Some(KECCAK_EMPTY),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         assert_eq!(
             acc_empty_bytecode.get_bytecode_hash(),
             KECCAK_EMPTY,
<span class="term-fg36">@@ -310,8 +442,15 @@</span>         );
&nbsp;
         &#47;&#47; Account with a valid bytecode hash
         let bytecode_hash = B256::from_slice(&amp;[0x11u8; 32]);
<span class="term-fg31">-        let acc_with_bytecode =</span>
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(1000), bytecode_hash: Some(bytecode_hash) };</span>
<span class="term-fg32">+        let acc_with_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(1000),</span>
<span class="term-fg32">+            bytecode_hash: Some(bytecode_hash),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;[0x11u8; 32],</span>
<span class="term-fg32">+            )),</span>
<span class="term-fg32">+        };</span>
         assert_eq!(
             acc_with_bytecode.get_bytecode_hash(),
             bytecode_hash,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ee71fda091f06794c2a4a7dd" role="button"
                       aria-expanded="false" aria-controls="id-ee71fda091f06794c2a4a7dd">
                        <code>crates/primitives/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/primitives/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+16</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ee71fda091f06794c2a4a7dd"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;Cargo.toml scroll-reth&#47;crates&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">index 9787c9f3a6a9da33416da5f2a6f42701c8711cdf..92bb28bc416758b0673cf9199f7a8398803eda11 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg36">@@ -16,7 +16,6 @@</span> # reth
 reth-primitives-traits = { workspace = true, features = [&quot;serde&quot;] }
 reth-ethereum-forks.workspace = true
 reth-static-file-types.workspace = true
<span class="term-fg31">-revm-primitives = { workspace = true, features = [&quot;serde&quot;] }</span>
 reth-codecs = { workspace = true, optional = true }
&nbsp;
 # ethereum
<span class="term-fg36">@@ -28,6 +27,10 @@</span> alloy-rpc-types = { workspace = true, optional = true }
 alloy-serde = { workspace = true, optional = true }
 alloy-eips = { workspace = true, features = [&quot;serde&quot;] }
 alloy-trie = { workspace = true, features = [&quot;serde&quot;] }
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+revm-primitives = { package = &quot;reth-scroll-revm&quot;, path = &quot;..&#47;scroll&#47;revm&quot;, features = [&quot;serde&quot;] }</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true, features = [&quot;serde&quot;] }</span>
&nbsp;
 # optimism
 op-alloy-rpc-types = { workspace = true, optional = true }
<span class="term-fg36">@@ -67,7 +70,7 @@</span> reth-codecs = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-primitives-traits = { workspace = true, features = [&quot;arbitrary&quot;] }
 reth-testing-utils.workspace = true
 reth-trie-common = { workspace = true, features = [&quot;arbitrary&quot;] }
<span class="term-fg31">-revm-primitives = { workspace = true, features = [&quot;arbitrary&quot;] }</span>
<span class="term-fg32">+revm-primitives = { package = &quot;reth-scroll-revm&quot;, path = &quot;..&#47;scroll&#47;revm&quot;, features = [&quot;arbitrary&quot;] }</span>
&nbsp;
 alloy-eips = { workspace = true, features = [&quot;arbitrary&quot;] }
 alloy-genesis.workspace = true
<span class="term-fg36">@@ -130,7 +133,8 @@</span> 	&quot;op-alloy-consensus?&#47;arbitrary&quot;,
 	&quot;op-alloy-rpc-types?&#47;arbitrary&quot;,
 	&quot;reth-codecs?&#47;arbitrary&quot;,
 	&quot;alloy-trie&#47;arbitrary&quot;,
<span class="term-fg31">-	&quot;reth-trie-common&#47;arbitrary&quot;</span>
<span class="term-fg32">+	&quot;reth-trie-common&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives?&#47;arbitrary&quot;</span>
 ]
 secp256k1 = [&quot;dep:secp256k1&quot;]
 c-kzg = [
<span class="term-fg36">@@ -148,7 +152,7 @@</span> alloy-compat = [
 	&quot;dep:alloy-rpc-types&quot;,
 	&quot;dep:alloy-serde&quot;,
 	&quot;dep:op-alloy-rpc-types&quot;,
<span class="term-fg31">-    &quot;dep:alloy-network&quot;,</span>
<span class="term-fg32">+	&quot;dep:alloy-network&quot;,</span>
 ]
 test-utils = [
 	&quot;reth-primitives-traits&#47;test-utils&quot;,
<span class="term-fg36">@@ -156,6 +160,7 @@</span> 	&quot;reth-chainspec&#47;test-utils&quot;,
 	&quot;reth-codecs?&#47;test-utils&quot;,
 	&quot;reth-trie-common&#47;test-utils&quot;,
 	&quot;arbitrary&quot;,
<span class="term-fg32">+	&quot;revm-primitives&#47;test-utils&quot;</span>
 ]
 serde-bincode-compat = [
 	&quot;serde_with&quot;,
<span class="term-fg36">@@ -164,6 +169,13 @@</span> 	&quot;alloy-consensus&#47;serde-bincode-compat&quot;,
 	&quot;op-alloy-consensus?&#47;serde-bincode-compat&quot;,
 	&quot;reth-primitives-traits&#47;serde-bincode-compat&quot;,
 	&quot;reth-trie-common&#47;serde-bincode-compat&quot;,
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-trie-common&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-testing-utils&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+	&quot;reth-chainspec&#47;scroll&quot;,</span>
 ]
&nbsp;
 [[bench]]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ebbb405da8cde016b8b70764" role="button"
                       aria-expanded="false" aria-controls="id-ebbb405da8cde016b8b70764">
                        <code>crates/primitives/src/alloy_compat.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/alloy_compat.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/primitives/src/alloy_compat.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+102</span></div>
                            <div class="text-start"><span class="text-danger">-27</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ebbb405da8cde016b8b70764"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;alloy_compat.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;alloy_compat.rs</span>
<span class="term-fg1">index a72c83996c011cc0305385af3845014beeec1bd1..550b79f6d68263ac45a43e564a805ba05364e61f 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;alloy_compat.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;alloy_compat.rs</span>
<span class="term-fg36">@@ -123,34 +123,64 @@</span>             AnyTxEnvelope::Ethereum(TxEnvelope::Eip7702(tx)) =&gt; {
                 let (tx, signature, hash) = tx.into_parts();
                 (Transaction::Eip7702(tx), signature, hash)
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg31">-            AnyTxEnvelope::Unknown(alloy_network::UnknownTxEnvelope { hash, inner }) =&gt; {</span>
<span class="term-fg32">+            #[cfg(any(feature = &quot;optimism&quot;, feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+            AnyTxEnvelope::Unknown(alloy_network::UnknownTxEnvelope { hash: _hash, inner }) =&gt; {</span>
                 use alloy_consensus::Transaction as _;
&nbsp;
<span class="term-fg31">-                if inner.ty() == crate::TxType::Deposit {</span>
<span class="term-fg31">-                    let fields: op_alloy_rpc_types::OpTransactionFields = inner</span>
<span class="term-fg31">-                        .fields</span>
<span class="term-fg31">-                        .clone()</span>
<span class="term-fg31">-                        .deserialize_into::&lt;op_alloy_rpc_types::OpTransactionFields&gt;()</span>
<span class="term-fg31">-                        .map_err(|e| ConversionError::Custom(e.to_string()))?;</span>
<span class="term-fg31">-                    (</span>
<span class="term-fg31">-                        Transaction::Deposit(op_alloy_consensus::TxDeposit {</span>
<span class="term-fg31">-                            source_hash: fields.source_hash.ok_or_else(|| {</span>
<span class="term-fg31">-                                ConversionError::Custom(&quot;MissingSourceHash&quot;.to_string())</span>
<span class="term-fg31">-                            })?,</span>
<span class="term-fg31">-                            from: tx.from,</span>
<span class="term-fg31">-                            to: revm_primitives::TxKind::from(inner.to()),</span>
<span class="term-fg31">-                            mint: fields.mint.filter(|n| *n != 0),</span>
<span class="term-fg31">-                            value: inner.value(),</span>
<span class="term-fg31">-                            gas_limit: inner.gas_limit(),</span>
<span class="term-fg31">-                            is_system_transaction: fields.is_system_tx.unwrap_or(false),</span>
<span class="term-fg31">-                            input: inner.input().clone(),</span>
<span class="term-fg31">-                        }),</span>
<span class="term-fg31">-                        op_alloy_consensus::TxDeposit::signature(),</span>
<span class="term-fg31">-                        hash,</span>
<span class="term-fg31">-                    )</span>
<span class="term-fg31">-                } else {</span>
<span class="term-fg31">-                    return Err(ConversionError::Custom(&quot;unknown transaction type&quot;.to_string()))</span>
<span class="term-fg32">+                match TryInto::&lt;crate::TxType&gt;::try_into(inner.ty())</span>
<span class="term-fg32">+                    .map_err(|e| ConversionError::Custom(e.to_string()))?</span>
<span class="term-fg32">+                {</span>
<span class="term-fg32">+                    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
<span class="term-fg32">+                    crate::TxType::Deposit =&gt; {</span>
<span class="term-fg32">+                        let fields: op_alloy_rpc_types::OpTransactionFields = inner</span>
<span class="term-fg32">+                            .fields</span>
<span class="term-fg32">+                            .clone()</span>
<span class="term-fg32">+                            .deserialize_into::&lt;op_alloy_rpc_types::OpTransactionFields&gt;()</span>
<span class="term-fg32">+                            .map_err(|e| ConversionError::Custom(e.to_string()))?;</span>
<span class="term-fg32">+                        (</span>
<span class="term-fg32">+                            Transaction::Deposit(op_alloy_consensus::TxDeposit {</span>
<span class="term-fg32">+                                source_hash: fields.source_hash.ok_or_else(|| {</span>
<span class="term-fg32">+                                    ConversionError::Custom(&quot;MissingSourceHash&quot;.to_string())</span>
<span class="term-fg32">+                                })?,</span>
<span class="term-fg32">+                                from: tx.from,</span>
<span class="term-fg32">+                                to: revm_primitives::TxKind::from(inner.to()),</span>
<span class="term-fg32">+                                mint: fields.mint.filter(|n| *n != 0),</span>
<span class="term-fg32">+                                value: inner.value(),</span>
<span class="term-fg32">+                                gas_limit: inner.gas_limit(),</span>
<span class="term-fg32">+                                is_system_transaction: fields.is_system_tx.unwrap_or(false),</span>
<span class="term-fg32">+                                input: inner.input().clone(),</span>
<span class="term-fg32">+                            }),</span>
<span class="term-fg32">+                            op_alloy_consensus::TxDeposit::signature(),</span>
<span class="term-fg32">+                            _hash,</span>
<span class="term-fg32">+                        )</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                    #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                    crate::TxType::L1Message =&gt; {</span>
<span class="term-fg32">+                        let fields =</span>
<span class="term-fg32">+                            inner</span>
<span class="term-fg32">+                                .fields</span>
<span class="term-fg32">+                                .clone()</span>
<span class="term-fg32">+                                .deserialize_into::&lt;reth_scroll_primitives::ScrollL1MessageTransactionFields&gt;()</span>
<span class="term-fg32">+                                .map_err(|e| ConversionError::Custom(e.to_string()))?;</span>
<span class="term-fg32">+                        (</span>
<span class="term-fg32">+                            Transaction::L1Message(reth_scroll_primitives::TxL1Message {</span>
<span class="term-fg32">+                                queue_index: fields.queue_index,</span>
<span class="term-fg32">+                                gas_limit: inner.gas_limit(),</span>
<span class="term-fg32">+                                to: inner.to().ok_or_else(|| ConversionError::Custom(</span>
<span class="term-fg32">+                                    &quot;Scroll L1 message transaction do not support create transaction&quot;</span>
<span class="term-fg32">+                                        .to_string(),</span>
<span class="term-fg32">+                                ))?,</span>
<span class="term-fg32">+                                value: inner.value(),</span>
<span class="term-fg32">+                                sender: fields.sender,</span>
<span class="term-fg32">+                                input: inner.input().clone(),</span>
<span class="term-fg32">+                            }),</span>
<span class="term-fg32">+                            reth_scroll_primitives::TxL1Message::signature(),</span>
<span class="term-fg32">+                            _hash,</span>
<span class="term-fg32">+                        )</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                    _ =&gt; {</span>
<span class="term-fg32">+                        return Err(ConversionError::Custom(&quot;unknown transaction type&quot;.to_string()))</span>
<span class="term-fg32">+                    }</span>
                 }
             }
             _ =&gt; return Err(ConversionError::Custom(&quot;unknown transaction type&quot;.to_string())),
<span class="term-fg36">@@ -161,7 +191,7 @@</span>     }
 }
&nbsp;
 #[cfg(test)]
<span class="term-fg31">-#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
 mod tests {
     use super::*;
     use alloy_primitives::{address, Address, B256, U256};
<span class="term-fg36">@@ -270,3 +300,48 @@</span>             panic!(&quot;Expected Deposit transaction&quot;);
         }
     }
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(test)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+mod tests {</span>
<span class="term-fg32">+    use super::*;</span>
<span class="term-fg32">+    use alloy_primitives::{address, U256};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_scroll_l1_message_tx() {</span>
<span class="term-fg32">+        &#47;&#47; https:&#47;&#47;scrollscan.com&#47;tx&#47;0x36199419dbdb7823235de4b73e3d90a61c7b1f343b7a682a271c3055249e81f9</span>
<span class="term-fg32">+        let input = r#&quot;{</span>
<span class="term-fg32">+            &quot;hash&quot;:&quot;0x36199419dbdb7823235de4b73e3d90a61c7b1f343b7a682a271c3055249e81f9&quot;,</span>
<span class="term-fg32">+            &quot;nonce&quot;:&quot;0x0&quot;,</span>
<span class="term-fg32">+            &quot;blockHash&quot;:&quot;0x4aca26460c31be3948e8466681ad87891326a964422c9370d4c1913f3bed4b10&quot;,</span>
<span class="term-fg32">+            &quot;blockNumber&quot;:&quot;0xabf06f&quot;,</span>
<span class="term-fg32">+            &quot;transactionIndex&quot;:&quot;0x0&quot;,</span>
<span class="term-fg32">+            &quot;from&quot;:&quot;0x7885bcbd5cecef1336b5300fb5186a12ddd8c478&quot;,</span>
<span class="term-fg32">+            &quot;to&quot;:&quot;0x781e90f1c8fc4611c9b7497c3b47f99ef6969cbc&quot;,</span>
<span class="term-fg32">+            &quot;value&quot;:&quot;0x0&quot;,</span>
<span class="term-fg32">+            &quot;gasPrice&quot;:&quot;0x0&quot;,</span>
<span class="term-fg32">+            &quot;gas&quot;:&quot;0x1e8480&quot;,</span>
<span class="term-fg32">+            &quot;input&quot;:&quot;0x8ef1332e000000000000000000000000c186fa914353c44b2e33ebe05f21846f1048beda0000000000000000000000003bad7ad0728f9917d1bf08af5782dcbd516cdd96000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e76ab00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000044493a4f84f464e58d4bfa93bcc57abfb14dbe1b8ff46cd132b5709aab227f269727943d2f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;,</span>
<span class="term-fg32">+            &quot;r&quot;:&quot;0x0&quot;,</span>
<span class="term-fg32">+            &quot;s&quot;:&quot;0x0&quot;,</span>
<span class="term-fg32">+            &quot;v&quot;:&quot;0x0&quot;,</span>
<span class="term-fg32">+            &quot;type&quot;:&quot;0x7e&quot;,</span>
<span class="term-fg32">+            &quot;queueIndex&quot;:&quot;0xe76ab&quot;,</span>
<span class="term-fg32">+            &quot;sender&quot;:&quot;0x7885bcbd5cecef1336b5300fb5186a12ddd8c478&quot;</span>
<span class="term-fg32">+        }&quot;#;</span>
<span class="term-fg32">+        let alloy_tx: WithOtherFields&lt;alloy_rpc_types::Transaction&lt;AnyTxEnvelope&gt;&gt; =</span>
<span class="term-fg32">+            serde_json::from_str(input).expect(&quot;failed to deserialize&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let TransactionSigned { transaction: reth_tx, .. } =</span>
<span class="term-fg32">+            alloy_tx.try_into().expect(&quot;failed to convert&quot;);</span>
<span class="term-fg32">+        if let Transaction::L1Message(l1_message_tx) = reth_tx {</span>
<span class="term-fg32">+            assert_eq!(l1_message_tx.queue_index, 0xe76ab);</span>
<span class="term-fg32">+            assert_eq!(l1_message_tx.gas_limit, 0x1e8480);</span>
<span class="term-fg32">+            assert_eq!(l1_message_tx.to, address!(&quot;781e90f1c8fc4611c9b7497c3b47f99ef6969cbc&quot;));</span>
<span class="term-fg32">+            assert_eq!(l1_message_tx.value, U256::ZERO);</span>
<span class="term-fg32">+            assert_eq!(l1_message_tx.sender, address!(&quot;7885bcbd5cecef1336b5300fb5186a12ddd8c478&quot;));</span>
<span class="term-fg32">+        } else {</span>
<span class="term-fg32">+            panic!(&quot;Expected L1 message transaction&quot;);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-029a9e376c0dfc188732db7b" role="button"
                       aria-expanded="false" aria-controls="id-029a9e376c0dfc188732db7b">
                        <code>crates/primitives/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/primitives/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-029a9e376c0dfc188732db7b"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 224e025f39d5c37301e45714d220b03dfc395644..7062858f4110e341c06be99c75e6b716b1d73d8a 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -19,6 +19,11 @@</span> #![cfg_attr(not(test), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![cfg_attr(not(feature = &quot;std&quot;), no_std)]
&nbsp;
<span class="term-fg32">+#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+use op_alloy_consensus as _;</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+use reth_scroll_primitives as _;</span>
<span class="term-fg32">+</span>
 extern crate alloc;
&nbsp;
 mod traits;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b936e74eff0c2ef9d6fce07a" role="button"
                       aria-expanded="false" aria-controls="id-b936e74eff0c2ef9d6fce07a">
                        <code>crates/primitives/src/proofs.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/proofs.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/primitives/src/proofs.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b936e74eff0c2ef9d6fce07a"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;proofs.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;proofs.rs</span>
<span class="term-fg1">index 81c26d7180e0be9059d22fafe8cf6e17f78bf278..f1931bcab95e1367e7b4147ab0e51f8cf9c71a83 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;proofs.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;proofs.rs</span>
<span class="term-fg36">@@ -94,6 +94,8 @@</span>                 tx_type: TxType::Eip2930,
                 success: true,
                 cumulative_gas_used: 102068,
                 logs,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                l1_fee: U256::from(0xffffff),</span>
             },
             bloom,
         };</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-76afe9007a1d81e2fa72e263" role="button"
                       aria-expanded="false" aria-controls="id-76afe9007a1d81e2fa72e263">
                        <code>crates/primitives/src/receipt.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/receipt.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/primitives/src/receipt.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+55</span></div>
                            <div class="text-start"><span class="text-danger">-25</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-76afe9007a1d81e2fa72e263"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;receipt.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;receipt.rs</span>
<span class="term-fg1">index 95d707d1b2d5709f6bc96d67c891ec625201bb14..4b9cc09f95d122e93eb3f9199f78495df3dbb1d3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;receipt.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;receipt.rs</span>
<span class="term-fg36">@@ -7,6 +7,8 @@</span>     constants::{EIP1559_TX_TYPE_ID, EIP2930_TX_TYPE_ID, EIP4844_TX_TYPE_ID, EIP7702_TX_TYPE_ID},
     Eip658Value, TxReceipt,
 };
 use alloy_eips::eip2718::Encodable2718;
<span class="term-fg32">+#[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+use alloy_primitives::U256;</span>
 use alloy_primitives::{Bloom, Log, B256};
 use alloy_rlp::{length_of_length, Decodable, Encodable, RlpDecodable, RlpEncodable};
 use bytes::{Buf, BufMut};
<span class="term-fg36">@@ -40,7 +42,7 @@</span>     pub cumulative_gas_used: u64,
     &#47;&#47;&#47; Log send from contracts.
     pub logs: Vec&lt;Log&gt;,
     &#47;&#47;&#47; Deposit nonce for Optimism deposit transactions
<span class="term-fg31">-    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
     pub deposit_nonce: Option&lt;u64&gt;,
     &#47;&#47;&#47; Deposit receipt version for Optimism deposit transactions
     &#47;&#47;&#47;
<span class="term-fg36">@@ -48,8 +50,14 @@</span>     &#47;&#47;&#47;
     &#47;&#47;&#47; The deposit receipt version was introduced in Canyon to indicate an update to how
     &#47;&#47;&#47; receipt hashes should be computed when set. The state transition process
     &#47;&#47;&#47; ensures this is only set for post-Canyon deposit transactions.
<span class="term-fg31">-    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
     pub deposit_receipt_version: Option&lt;u64&gt;,
<span class="term-fg32">+    &#47;&#47;&#47; Additional fee to cover l1 data availability costs.</span>
<span class="term-fg32">+    &#47;&#47;&#47; L1 fee is not part of the consensus encoding of a receipt.</span>
<span class="term-fg32">+    &#47;&#47;&#47; &lt;https:&#47;&#47;github.com&#47;scroll-tech&#47;go-ethereum&#47;blob&#47;9fff27e4f34fb5097100ed76ee725ce056267f4b&#47;core&#47;types&#47;receipt.go#L96-L102&gt;</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+    #[rlp(skip)]</span>
<span class="term-fg32">+    pub l1_fee: U256,</span>
 }
&nbsp;
 impl Receipt {
<span class="term-fg36">@@ -233,7 +241,7 @@</span>         let cumulative_gas_used = u64::arbitrary(u)?;
         let logs = Vec::&lt;Log&gt;::arbitrary(u)?;
&nbsp;
         &#47;&#47; Only receipts for deposit transactions may contain a deposit nonce
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         let (deposit_nonce, deposit_receipt_version) = if tx_type == TxType::Deposit {
             let deposit_nonce = Option::&lt;u64&gt;::arbitrary(u)?;
             let deposit_nonce_version =
<span class="term-fg36">@@ -248,10 +256,12 @@</span>             tx_type,
             success,
             cumulative_gas_used,
             logs,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             deposit_nonce,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             deposit_receipt_version,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            l1_fee: U256::arbitrary(u)?,</span>
         })
     }
 }
<span class="term-fg36">@@ -313,7 +323,7 @@</span>         let bloom = Decodable::decode(b)?;
         let logs = alloy_rlp::Decodable::decode(b)?;
&nbsp;
         let receipt = match tx_type {
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             TxType::Deposit =&gt; {
                 let remaining = |b: &amp;[u8]| rlp_head.payload_length - (started_len - b.len()) &gt; 0;
                 let deposit_nonce =
<span class="term-fg36">@@ -335,10 +345,12 @@</span>                 tx_type,
                 success,
                 cumulative_gas_used,
                 logs,
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_nonce: None,
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_receipt_version: None,
<span class="term-fg32">+                #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             },
         };
&nbsp;
<span class="term-fg36">@@ -397,7 +409,7 @@</span>                     EIP7702_TX_TYPE_ID =&gt; {
                         buf.advance(1);
                         Self::decode_receipt(buf, TxType::Eip7702)
                     }
<span class="term-fg31">-                    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                     op_alloy_consensus::DEPOSIT_TX_TYPE_ID =&gt; {
                         buf.advance(1);
                         Self::decode_receipt(buf, TxType::Deposit)
<span class="term-fg36">@@ -470,7 +482,7 @@</span>         rlp_head.payload_length += self.receipt.cumulative_gas_used.length();
         rlp_head.payload_length += self.bloom.length();
         rlp_head.payload_length += self.receipt.logs.length();
&nbsp;
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         if self.receipt.tx_type == TxType::Deposit {
             if let Some(deposit_nonce) = self.receipt.deposit_nonce {
                 rlp_head.payload_length += deposit_nonce.length();
<span class="term-fg36">@@ -490,7 +502,7 @@</span>         self.receipt.success.encode(out);
         self.receipt.cumulative_gas_used.encode(out);
         self.bloom.encode(out);
         self.receipt.logs.encode(out);
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         if self.receipt.tx_type == TxType::Deposit {
             if let Some(deposit_nonce) = self.receipt.deposit_nonce {
                 deposit_nonce.encode(out)
<span class="term-fg36">@@ -532,9 +544,13 @@</span>             }
             TxType::Eip7702 =&gt; {
                 out.put_u8(EIP7702_TX_TYPE_ID);
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             TxType::Deposit =&gt; {
                 out.put_u8(op_alloy_consensus::DEPOSIT_TX_TYPE_ID);
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            TxType::L1Message =&gt; {</span>
<span class="term-fg32">+                out.put_u8(reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE);</span>
             }
         }
         out.put_slice(payload.as_ref());
<span class="term-fg36">@@ -572,9 +588,13 @@</span>     use reth_codecs::Compact;
&nbsp;
     #[test]
     fn test_decode_receipt() {
<span class="term-fg31">-        #[cfg(not(feature = &quot;optimism&quot;))]</span>
<span class="term-fg32">+        #[cfg(all(not(feature = &quot;optimism&quot;), not(feature = &quot;scroll&quot;)))]</span>
         reth_codecs::test_utils::test_decode::&lt;Receipt&gt;(&amp;hex!(
             &quot;c428b52ffd23fc42696156b10200f034792b6a94c3850215c2fef7aea361a0c31b79d9a32652eefc0d4e2e730036061cff7344b6fc6132b50cda0ed810a991ae58ef013150c12b2522533cb3b3a8b19b7786a8b5ff1d3cdc84225e22b02def168c8858df&quot;
<span class="term-fg32">+        ));</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        reth_codecs::test_utils::test_decode::&lt;Receipt&gt;(&amp;hex!(</span>
<span class="term-fg32">+            &quot;c42128b52ffd23fc42696159c90200f034792b6a94c3850215c2fef7aea361a0c31b79d9a32652eefc0d4e2e730036061cff7344b6fc6132b50cda0ed810a991ae58ef013150c12b2522533cb3b3a8b19b7786a8b5ff1d3cdc84225e22b02def168c8858dfffffff&quot;</span>
         ));
         #[cfg(feature = &quot;optimism&quot;)]
         reth_codecs::test_utils::test_decode::&lt;Receipt&gt;(&amp;hex!(
<span class="term-fg36">@@ -601,10 +621,12 @@</span>                     ],
                     bytes!(&quot;0100ff&quot;),
                 )],
                 success: false,
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_nonce: None,
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_receipt_version: None,
<span class="term-fg32">+                #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             },
             bloom: [0; 256].into(),
         };
<span class="term-fg36">@@ -635,10 +657,12 @@</span>                     ],
                     bytes!(&quot;0100ff&quot;),
                 )],
                 success: false,
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_nonce: None,
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_receipt_version: None,
<span class="term-fg32">+                #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             },
             bloom: [0; 256].into(),
         };
<span class="term-fg36">@@ -647,7 +671,7 @@</span>         let receipt = ReceiptWithBloom::decode(&amp;mut &amp;data[..]).unwrap();
         assert_eq!(receipt, expected);
     }
&nbsp;
<span class="term-fg31">-    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
     #[test]
     fn decode_deposit_receipt_regolith_roundtrip() {
         let data = hex!(&quot;7ef9010c0182b741b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0833d3bbf&quot;);
<span class="term-fg36">@@ -673,7 +697,7 @@</span>         receipt.encode_inner(&amp;mut buf, false);
         assert_eq!(buf, &amp;data[..]);
     }
&nbsp;
<span class="term-fg31">-    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
     #[test]
     fn decode_deposit_receipt_canyon_roundtrip() {
         let data = hex!(&quot;7ef9010d0182b741b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0833d3bbf01&quot;);
<span class="term-fg36">@@ -717,10 +741,12 @@</span>                     vec![b256!(&quot;8cca58667b1e9ffa004720ac99a3d61a138181963b294d270d91c53d36402ae2&quot;)],
                     Bytes::from(vec![1; 0xffffff]),
                 ),
             ],
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             deposit_nonce: None,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             deposit_receipt_version: None,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            l1_fee: U256::from(0xffffff),</span>
         };
&nbsp;
         let mut data = vec![];
<span class="term-fg36">@@ -737,10 +763,12 @@</span>                 tx_type: TxType::Eip1559,
                 success: true,
                 cumulative_gas_used: 21000,
                 logs: vec![],
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_nonce: None,
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_receipt_version: None,
<span class="term-fg32">+                #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                l1_fee: U256::from(0xffffff),</span>
             },
             bloom: Bloom::default(),
         };
<span class="term-fg36">@@ -759,10 +787,12 @@</span>                 tx_type: TxType::Legacy,
                 success: true,
                 cumulative_gas_used: 21000,
                 logs: vec![],
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_nonce: None,
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 deposit_receipt_version: None,
<span class="term-fg32">+                #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                l1_fee: U256::from(0xffffff),</span>
             },
             bloom: Bloom::default(),
         };</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1b479410e7f7dc47133de45c" role="button"
                       aria-expanded="false" aria-controls="id-1b479410e7f7dc47133de45c">
                        <code>crates/primitives/src/traits.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/traits.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/primitives/src/traits.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1b479410e7f7dc47133de45c"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;traits.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;traits.rs</span>
<span class="term-fg1">index ec4e75c8c6d034eadf1ff0fd0adfd7e22c15cee4..307443c00b8c9b421e7d0a6d17e2498d3be494c2 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;traits.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;traits.rs</span>
<span class="term-fg36">@@ -5,7 +5,7 @@</span> };
 use alloc::vec::Vec;
 use alloy_eips::{eip2718::Encodable2718, BlockNumHash};
 use reth_primitives_traits::{Block, BlockBody, BlockHeader, SealedHeader, SignedTransaction};
<span class="term-fg31">-use revm_primitives::{Address, B256};</span>
<span class="term-fg32">+use revm_primitives::primitives::{Address, B256};</span>
&nbsp;
 &#47;&#47;&#47; Extension trait for [`reth_primitives_traits::Block`] implementations
 &#47;&#47;&#47; allowing for conversions into common block parts containers such as [`SealedBlock`],</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-95a60fdd70d9f107aa2e9f00" role="button"
                       aria-expanded="false" aria-controls="id-95a60fdd70d9f107aa2e9f00">
                        <code>crates/primitives/src/transaction/compat.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/transaction/compat.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/primitives/src/transaction/compat.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+29</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-95a60fdd70d9f107aa2e9f00"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;compat.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;compat.rs</span>
<span class="term-fg1">index 883c89c45f51e3d3f9569f312e01d42b0167e921..0bca4c7aa391238a965522a6bc1025b44af24f35 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;compat.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;compat.rs</span>
<span class="term-fg36">@@ -1,6 +1,6 @@</span>
 use crate::{Transaction, TransactionSigned};
 use alloy_primitives::{Address, TxKind, U256};
<span class="term-fg31">-#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
 use op_alloy_consensus::DepositTransaction;
 use revm_primitives::{AuthorizationList, TxEnv};
&nbsp;
<span class="term-fg36">@@ -12,7 +12,10 @@</span> }
&nbsp;
 impl FillTxEnv for TransactionSigned {
     fn fill_tx_env(&amp;self, tx_env: &amp;mut TxEnv, sender: Address) {
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(any(</span>
<span class="term-fg32">+            all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)),</span>
<span class="term-fg32">+            all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;))</span>
<span class="term-fg32">+        ))]</span>
         let envelope = alloy_eips::eip2718::Encodable2718::encoded_2718(self);
&nbsp;
         tx_env.caller = sender;
<span class="term-fg36">@@ -88,7 +91,7 @@</span>                 tx_env.max_fee_per_blob_gas.take();
                 tx_env.authorization_list =
                     Some(AuthorizationList::Signed(tx.authorization_list.clone()));
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Transaction::Deposit(tx) =&gt; {
                 tx_env.access_list.clear();
                 tx_env.gas_limit = tx.gas_limit;
<span class="term-fg36">@@ -109,9 +112,25 @@</span>                     enveloped_tx: Some(envelope.into()),
                 };
                 return;
             }
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Transaction::L1Message(tx) =&gt; {</span>
<span class="term-fg32">+                tx_env.access_list.clear();</span>
<span class="term-fg32">+                tx_env.gas_limit = tx.gas_limit;</span>
<span class="term-fg32">+                tx_env.gas_price = U256::ZERO;</span>
<span class="term-fg32">+                tx_env.gas_priority_fee = None;</span>
<span class="term-fg32">+                tx_env.transact_to = tx.to();</span>
<span class="term-fg32">+                tx_env.value = tx.value;</span>
<span class="term-fg32">+                tx_env.data = tx.input.clone();</span>
<span class="term-fg32">+                tx_env.chain_id = None;</span>
<span class="term-fg32">+                tx_env.nonce = None;</span>
<span class="term-fg32">+                tx_env.authorization_list = None;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                tx_env.scroll.is_l1_msg = true;</span>
<span class="term-fg32">+                tx_env.scroll.rlp_bytes = None;</span>
<span class="term-fg32">+            }</span>
         }
&nbsp;
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         if !self.is_deposit() {
             tx_env.optimism = revm_primitives::OptimismFields {
                 source_hash: None,
<span class="term-fg36">@@ -119,6 +138,12 @@</span>                 mint: None,
                 is_system_transaction: Some(false),
                 enveloped_tx: Some(envelope.into()),
             }
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+        if !self.is_l1_message() {</span>
<span class="term-fg32">+            tx_env.scroll.is_l1_msg = false;</span>
<span class="term-fg32">+            tx_env.scroll.rlp_bytes = Some(envelope.into());</span>
         }
     }
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b673bc404046fc11bf09c0ce" role="button"
                       aria-expanded="false" aria-controls="id-b673bc404046fc11bf09c0ce">
                        <code>crates/primitives/src/transaction/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/transaction/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/primitives/src/transaction/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+162</span></div>
                            <div class="text-start"><span class="text-danger">-46</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b673bc404046fc11bf09c0ce"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;mod.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;mod.rs</span>
<span class="term-fg1">index db789d1f6de8509b3a10945101b23caf511b9711..ef3037db505a9cedbc8f96ac04ca123dc3f416fd 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;mod.rs</span>
<span class="term-fg36">@@ -19,12 +19,14 @@</span> use derive_more::{AsRef, Deref};
 use once_cell as _;
 #[cfg(not(feature = &quot;std&quot;))]
 use once_cell::sync::{Lazy as LazyLock, OnceCell as OnceLock};
<span class="term-fg31">-#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
 use op_alloy_consensus::DepositTransaction;
<span class="term-fg31">-#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
 use op_alloy_consensus::TxDeposit;
 use rayon::prelude::{IntoParallelIterator, ParallelIterator};
 use reth_primitives_traits::{InMemorySize, SignedTransaction};
<span class="term-fg32">+#[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+use reth_scroll_primitives::l1_transaction::TxL1Message;</span>
 use revm_primitives::{AuthorizationList, TxEnv};
 use serde::{Deserialize, Serialize};
 use signature::decode_with_eip155_chain_id;
<span class="term-fg36">@@ -123,11 +125,14 @@</span>     &#47;&#47;&#47; EOA for a single transaction. This allows for temporarily adding smart contract
     &#47;&#47;&#47; functionality to the EOA.
     Eip7702(TxEip7702),
     &#47;&#47;&#47; Optimism deposit transaction.
<span class="term-fg31">-    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
     Deposit(TxDeposit),
<span class="term-fg32">+    &#47;&#47;&#47; Scroll L1 messaging transaction.</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+    L1Message(TxL1Message),</span>
 }
&nbsp;
<span class="term-fg31">-#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
 impl DepositTransaction for Transaction {
     fn source_hash(&amp;self) -&gt; Option&lt;B256&gt; {
         match self {
<span class="term-fg36">@@ -177,10 +182,15 @@</span>             TxType::Eip7702 =&gt; {
                 let tx = TxEip7702::arbitrary(u)?;
                 Self::Eip7702(tx)
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             TxType::Deposit =&gt; {
                 let tx = TxDeposit::arbitrary(u)?;
                 Self::Deposit(tx)
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            TxType::L1Message =&gt; {</span>
<span class="term-fg32">+                let tx = TxL1Message::arbitrary(u)?;</span>
<span class="term-fg32">+                Self::L1Message(tx)</span>
             }
         };
&nbsp;
<span class="term-fg36">@@ -205,8 +215,10 @@</span>             Self::Eip2930(tx) =&gt; tx.signature_hash(),
             Self::Eip1559(tx) =&gt; tx.signature_hash(),
             Self::Eip4844(tx) =&gt; tx.signature_hash(),
             Self::Eip7702(tx) =&gt; tx.signature_hash(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(_) =&gt; B256::ZERO,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(_) =&gt; B256::ZERO,</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -218,8 +230,10 @@</span>             Self::Eip2930(TxEip2930 { chain_id: ref mut c, .. }) |
             Self::Eip1559(TxEip1559 { chain_id: ref mut c, .. }) |
             Self::Eip4844(TxEip4844 { chain_id: ref mut c, .. }) |
             Self::Eip7702(TxEip7702 { chain_id: ref mut c, .. }) =&gt; *c = chain_id,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(_) =&gt; { &#47;* noop *&#47; }
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(_) =&gt; { &#47;* noop *&#47; }</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -231,8 +245,10 @@</span>             Self::Eip2930(_) =&gt; TxType::Eip2930,
             Self::Eip1559(_) =&gt; TxType::Eip1559,
             Self::Eip4844(_) =&gt; TxType::Eip4844,
             Self::Eip7702(_) =&gt; TxType::Eip7702,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(_) =&gt; TxType::Deposit,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(_) =&gt; TxType::L1Message,</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -285,8 +301,10 @@</span>             Self::Eip2930(tx) =&gt; tx.encode_for_signing(out),
             Self::Eip1559(tx) =&gt; tx.encode_for_signing(out),
             Self::Eip4844(tx) =&gt; tx.encode_for_signing(out),
             Self::Eip7702(tx) =&gt; tx.encode_for_signing(out),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(_) =&gt; {}
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(_) =&gt; {}</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -307,8 +325,10 @@</span>             Self::Eip4844(blob_tx) =&gt; blob_tx.eip2718_encode(signature, out),
             Self::Eip7702(set_code_tx) =&gt; {
                 set_code_tx.eip2718_encode(signature, out);
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(deposit_tx) =&gt; deposit_tx.eip2718_encode(out),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(l1_message_tx) =&gt; l1_message_tx.eip2718_encode(out),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -320,8 +340,10 @@</span>             Self::Eip2930(tx) =&gt; tx.gas_limit = gas_limit,
             Self::Eip1559(tx) =&gt; tx.gas_limit = gas_limit,
             Self::Eip4844(tx) =&gt; tx.gas_limit = gas_limit,
             Self::Eip7702(tx) =&gt; tx.gas_limit = gas_limit,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.gas_limit = gas_limit,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.gas_limit = gas_limit,</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -333,8 +355,10 @@</span>             Self::Eip2930(tx) =&gt; tx.nonce = nonce,
             Self::Eip1559(tx) =&gt; tx.nonce = nonce,
             Self::Eip4844(tx) =&gt; tx.nonce = nonce,
             Self::Eip7702(tx) =&gt; tx.nonce = nonce,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(_) =&gt; { &#47;* noop *&#47; }
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(_) =&gt; { &#47;* noop *&#47; }</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -346,8 +370,10 @@</span>             Self::Eip2930(tx) =&gt; tx.value = value,
             Self::Eip1559(tx) =&gt; tx.value = value,
             Self::Eip4844(tx) =&gt; tx.value = value,
             Self::Eip7702(tx) =&gt; tx.value = value,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.value = value,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.value = value,</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -359,8 +385,10 @@</span>             Self::Eip2930(tx) =&gt; tx.input = input,
             Self::Eip1559(tx) =&gt; tx.input = input,
             Self::Eip4844(tx) =&gt; tx.input = input,
             Self::Eip7702(tx) =&gt; tx.input = input,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.input = input,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.input = input,</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -392,6 +420,13 @@</span>     &#47;&#47;&#47; Returns true if the transaction is an EIP-7702 transaction.
     #[inline]
     pub const fn is_eip7702(&amp;self) -&gt; bool {
         matches!(self, Self::Eip7702(_))
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns true if the transaction is a Scroll L1 messaging transaction.</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+    #[inline]</span>
<span class="term-fg32">+    pub const fn is_l1_message(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        matches!(self, Self::L1Message(_))</span>
     }
&nbsp;
     &#47;&#47;&#47; Returns the [`TxLegacy`] variant if the transaction is a legacy transaction.
<span class="term-fg36">@@ -445,8 +480,10 @@</span>             Self::Eip2930(tx) =&gt; tx.size(),
             Self::Eip1559(tx) =&gt; tx.size(),
             Self::Eip4844(tx) =&gt; tx.size(),
             Self::Eip7702(tx) =&gt; tx.size(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.size(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.size(),</span>
         }
     }
 }
<span class="term-fg36">@@ -476,8 +513,12 @@</span>             }
             Self::Eip7702(tx) =&gt; {
                 tx.to_compact(buf);
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; {
<span class="term-fg32">+                tx.to_compact(buf);</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; {</span>
                 tx.to_compact(buf);
             }
         }
<span class="term-fg36">@@ -524,11 +565,16 @@</span>                     alloy_consensus::constants::EIP7702_TX_TYPE_ID =&gt; {
                         let (tx, buf) = TxEip7702::from_compact(buf, buf.len());
                         (Self::Eip7702(tx), buf)
                     }
<span class="term-fg31">-                    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                     op_alloy_consensus::DEPOSIT_TX_TYPE_ID =&gt; {
                         let (tx, buf) = TxDeposit::from_compact(buf, buf.len());
                         (Self::Deposit(tx), buf)
                     }
<span class="term-fg32">+                    #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                    reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE =&gt; {</span>
<span class="term-fg32">+                        let (tx, buf) = TxL1Message::from_compact(buf, buf.len());</span>
<span class="term-fg32">+                        (Self::L1Message(tx), buf)</span>
<span class="term-fg32">+                    }</span>
                     _ =&gt; unreachable!(
                         &quot;Junk data in database: unknown Transaction variant: {identifier}&quot;
                     ),
<span class="term-fg36">@@ -553,8 +599,10 @@</span>             Self::Eip2930(tx) =&gt; tx.chain_id(),
             Self::Eip1559(tx) =&gt; tx.chain_id(),
             Self::Eip4844(tx) =&gt; tx.chain_id(),
             Self::Eip7702(tx) =&gt; tx.chain_id(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.chain_id(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.chain_id(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -565,8 +613,10 @@</span>             Self::Eip2930(tx) =&gt; tx.nonce(),
             Self::Eip1559(tx) =&gt; tx.nonce(),
             Self::Eip4844(tx) =&gt; tx.nonce(),
             Self::Eip7702(tx) =&gt; tx.nonce(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.nonce(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.nonce(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -577,8 +627,10 @@</span>             Self::Eip2930(tx) =&gt; tx.gas_limit(),
             Self::Eip1559(tx) =&gt; tx.gas_limit(),
             Self::Eip4844(tx) =&gt; tx.gas_limit(),
             Self::Eip7702(tx) =&gt; tx.gas_limit(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.gas_limit(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.gas_limit(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -589,8 +641,10 @@</span>             Self::Eip2930(tx) =&gt; tx.gas_price(),
             Self::Eip1559(tx) =&gt; tx.gas_price(),
             Self::Eip4844(tx) =&gt; tx.gas_price(),
             Self::Eip7702(tx) =&gt; tx.gas_price(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.gas_price(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.gas_price(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -601,8 +655,10 @@</span>             Self::Eip2930(tx) =&gt; tx.max_fee_per_gas(),
             Self::Eip1559(tx) =&gt; tx.max_fee_per_gas(),
             Self::Eip4844(tx) =&gt; tx.max_fee_per_gas(),
             Self::Eip7702(tx) =&gt; tx.max_fee_per_gas(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.max_fee_per_gas(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.max_fee_per_gas(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -613,8 +669,10 @@</span>             Self::Eip2930(tx) =&gt; tx.max_priority_fee_per_gas(),
             Self::Eip1559(tx) =&gt; tx.max_priority_fee_per_gas(),
             Self::Eip4844(tx) =&gt; tx.max_priority_fee_per_gas(),
             Self::Eip7702(tx) =&gt; tx.max_priority_fee_per_gas(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.max_priority_fee_per_gas(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.max_priority_fee_per_gas(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -625,8 +683,10 @@</span>             Self::Eip2930(tx) =&gt; tx.max_fee_per_blob_gas(),
             Self::Eip1559(tx) =&gt; tx.max_fee_per_blob_gas(),
             Self::Eip4844(tx) =&gt; tx.max_fee_per_blob_gas(),
             Self::Eip7702(tx) =&gt; tx.max_fee_per_blob_gas(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.max_fee_per_blob_gas(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.max_fee_per_blob_gas(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -637,8 +697,10 @@</span>             Self::Eip2930(tx) =&gt; tx.priority_fee_or_price(),
             Self::Eip1559(tx) =&gt; tx.priority_fee_or_price(),
             Self::Eip4844(tx) =&gt; tx.priority_fee_or_price(),
             Self::Eip7702(tx) =&gt; tx.priority_fee_or_price(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.priority_fee_or_price(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.priority_fee_or_price(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -649,8 +711,10 @@</span>             Self::Eip2930(tx) =&gt; tx.effective_gas_price(base_fee),
             Self::Eip1559(tx) =&gt; tx.effective_gas_price(base_fee),
             Self::Eip4844(tx) =&gt; tx.effective_gas_price(base_fee),
             Self::Eip7702(tx) =&gt; tx.effective_gas_price(base_fee),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.effective_gas_price(base_fee),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.effective_gas_price(base_fee),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -658,8 +722,10 @@</span>     fn is_dynamic_fee(&amp;self) -&gt; bool {
         match self {
             Self::Legacy(_) | Self::Eip2930(_) =&gt; false,
             Self::Eip1559(_) | Self::Eip4844(_) | Self::Eip7702(_) =&gt; true,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(_) =&gt; false,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.is_dynamic_fee(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -670,8 +736,10 @@</span>             Self::Eip2930(tx) =&gt; tx.kind(),
             Self::Eip1559(tx) =&gt; tx.kind(),
             Self::Eip4844(tx) =&gt; tx.kind(),
             Self::Eip7702(tx) =&gt; tx.kind(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.kind(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.kind(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -682,8 +750,10 @@</span>             Self::Eip2930(tx) =&gt; tx.value(),
             Self::Eip1559(tx) =&gt; tx.value(),
             Self::Eip4844(tx) =&gt; tx.value(),
             Self::Eip7702(tx) =&gt; tx.value(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.value(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.value(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -694,8 +764,10 @@</span>             Self::Eip2930(tx) =&gt; tx.input(),
             Self::Eip1559(tx) =&gt; tx.input(),
             Self::Eip4844(tx) =&gt; tx.input(),
             Self::Eip7702(tx) =&gt; tx.input(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.input(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.input(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -706,8 +778,10 @@</span>             Self::Eip2930(tx) =&gt; tx.ty(),
             Self::Eip1559(tx) =&gt; tx.ty(),
             Self::Eip4844(tx) =&gt; tx.ty(),
             Self::Eip7702(tx) =&gt; tx.ty(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.ty(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.ty(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -718,8 +792,10 @@</span>             Self::Eip2930(tx) =&gt; tx.access_list(),
             Self::Eip1559(tx) =&gt; tx.access_list(),
             Self::Eip4844(tx) =&gt; tx.access_list(),
             Self::Eip7702(tx) =&gt; tx.access_list(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.access_list(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.access_list(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -730,8 +806,10 @@</span>             Self::Eip2930(tx) =&gt; tx.blob_versioned_hashes(),
             Self::Eip1559(tx) =&gt; tx.blob_versioned_hashes(),
             Self::Eip4844(tx) =&gt; tx.blob_versioned_hashes(),
             Self::Eip7702(tx) =&gt; tx.blob_versioned_hashes(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.blob_versioned_hashes(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.blob_versioned_hashes(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -742,8 +820,10 @@</span>             Self::Eip2930(tx) =&gt; tx.authorization_list(),
             Self::Eip1559(tx) =&gt; tx.authorization_list(),
             Self::Eip4844(tx) =&gt; tx.authorization_list(),
             Self::Eip7702(tx) =&gt; tx.authorization_list(),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit(tx) =&gt; tx.authorization_list(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message(tx) =&gt; tx.authorization_list(),</span>
         }
     }
 }
<span class="term-fg36">@@ -799,9 +879,14 @@</span>     &#47;&#47;&#47; Returns `None` if the transaction&#39;s signature is invalid, see also [`Self::recover_signer`].
     pub fn recover_signer(&amp;self) -&gt; Option&lt;Address&gt; {
         &#47;&#47; Optimism&#39;s Deposit transaction does not have a signature. Directly return the
         &#47;&#47; `from` address.
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         if let Transaction::Deposit(TxDeposit { from, .. }) = self.transaction {
             return Some(from)
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        &#47;&#47; Scroll L1 messages don&#39;t have a signature.</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+        if let Transaction::L1Message(TxL1Message { sender, .. }) = self.transaction {</span>
<span class="term-fg32">+            return Some(sender)</span>
         }
&nbsp;
         let signature_hash = self.signature_hash();
<span class="term-fg36">@@ -827,7 +912,7 @@</span>         self.transaction.encode_for_signing(buffer);
&nbsp;
         &#47;&#47; Optimism&#39;s Deposit transaction does not have a signature. Directly return the
         &#47;&#47; `from` address.
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         {
             if let Transaction::Deposit(TxDeposit { from, .. }) = self.transaction {
                 return Some(from)
<span class="term-fg36">@@ -840,6 +925,10 @@</span>             &#47;&#47; NOTE: this is very hacky and only relevant for op-mainnet pre bedrock
             if self.is_legacy() &amp;&amp; self.signature == TxDeposit::signature() {
                 return Some(Address::ZERO)
             }
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+        if let Transaction::L1Message(TxL1Message { sender, .. }) = self.transaction {</span>
<span class="term-fg32">+            return Some(sender)</span>
         }
&nbsp;
         recover_signer_unchecked(&amp;self.signature, keccak256(buffer))
<span class="term-fg36">@@ -1237,9 +1326,13 @@</span>
     fn recover_signer(&amp;self) -&gt; Option&lt;Address&gt; {
         &#47;&#47; Optimism&#39;s Deposit transaction does not have a signature. Directly return the
         &#47;&#47; `from` address.
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         if let Transaction::Deposit(TxDeposit { from, .. }) = self.transaction {
             return Some(from)
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+        if let Transaction::L1Message(TxL1Message { sender, .. }) = self.transaction {</span>
<span class="term-fg32">+            return Some(sender)</span>
         }
         let signature_hash = self.signature_hash();
         recover_signer(&amp;self.signature, signature_hash)
<span class="term-fg36">@@ -1248,9 +1341,13 @@</span>
     fn recover_signer_unchecked(&amp;self) -&gt; Option&lt;Address&gt; {
         &#47;&#47; Optimism&#39;s Deposit transaction does not have a signature. Directly return the
         &#47;&#47; `from` address.
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         if let Transaction::Deposit(TxDeposit { from, .. }) = self.transaction {
             return Some(from)
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+        if let Transaction::L1Message(TxL1Message { sender, .. }) = self.transaction {</span>
<span class="term-fg32">+            return Some(sender)</span>
         }
         let signature_hash = self.signature_hash();
         recover_signer_unchecked(&amp;self.signature, signature_hash)
<span class="term-fg36">@@ -1332,8 +1429,10 @@</span>                 tx_env.max_fee_per_blob_gas.take();
                 tx_env.authorization_list =
                     Some(AuthorizationList::Signed(tx.authorization_list.clone()));
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Transaction::Deposit(_) =&gt; {}
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Transaction::L1Message(_) =&gt; {}</span>
         }
     }
 }
<span class="term-fg36">@@ -1497,8 +1596,10 @@</span>             Transaction::Eip4844(blob_tx) =&gt; blob_tx.eip2718_encoded_length(&amp;self.signature),
             Transaction::Eip7702(set_code_tx) =&gt; {
                 set_code_tx.eip2718_encoded_length(&amp;self.signature)
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Transaction::Deposit(deposit_tx) =&gt; deposit_tx.eip2718_encoded_length(),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Transaction::L1Message(l1_message_tx) =&gt; l1_message_tx.eip2718_encoded_length(),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -1531,10 +1632,15 @@</span>             TxType::Eip4844 =&gt; {
                 let (tx, signature, hash) = TxEip4844::rlp_decode_signed(buf)?.into_parts();
                 Ok(Self { transaction: Transaction::Eip4844(tx), signature, hash: hash.into() })
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             TxType::Deposit =&gt; Ok(Self::new_unhashed(
                 Transaction::Deposit(TxDeposit::rlp_decode(buf)?),
                 TxDeposit::signature(),
<span class="term-fg32">+            )),</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            TxType::L1Message =&gt; Ok(Self::new_unhashed(</span>
<span class="term-fg32">+                Transaction::L1Message(TxL1Message::rlp_decode(buf)?),</span>
<span class="term-fg32">+                TxL1Message::signature(),</span>
             )),
         }
     }
<span class="term-fg36">@@ -1587,18 +1693,22 @@</span>             transaction.signature_hash(),
         )
         .unwrap();
&nbsp;
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
         &#47;&#47; Both `Some(0)` and `None` values are encoded as empty string byte. This introduces
         &#47;&#47; ambiguity in roundtrip tests. Patch the mint value of deposit transaction here, so that
         &#47;&#47; it&#39;s `None` if zero.
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         if let Transaction::Deposit(ref mut tx_deposit) = transaction {
             if tx_deposit.mint == Some(0) {
                 tx_deposit.mint = None;
             }
         }
&nbsp;
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         let signature = if transaction.is_deposit() { TxDeposit::signature() } else { signature };
<span class="term-fg32">+        #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+        let signature =</span>
<span class="term-fg32">+            if transaction.is_l1_message() { TxL1Message::signature() } else { signature };</span>
<span class="term-fg32">+</span>
         Ok(Self::new_unhashed(transaction, signature))
     }
 }
<span class="term-fg36">@@ -1722,8 +1832,10 @@</span>         Eip2930(TxEip2930&lt;&#39;a&gt;),
         Eip1559(TxEip1559&lt;&#39;a&gt;),
         Eip4844(Cow&lt;&#39;a, TxEip4844&gt;),
         Eip7702(TxEip7702&lt;&#39;a&gt;),
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         Deposit(op_alloy_consensus::serde_bincode_compat::TxDeposit&lt;&#39;a&gt;),
<span class="term-fg32">+        #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+        L1Message(Cow&lt;&#39;a, reth_scroll_primitives::l1_transaction::TxL1Message&gt;),</span>
     }
&nbsp;
     impl&lt;&#39;a&gt; From&lt;&amp;&#39;a super::Transaction&gt; for Transaction&lt;&#39;a&gt; {
<span class="term-fg36">@@ -1734,10 +1846,12 @@</span>                 super::Transaction::Eip2930(tx) =&gt; Self::Eip2930(TxEip2930::from(tx)),
                 super::Transaction::Eip1559(tx) =&gt; Self::Eip1559(TxEip1559::from(tx)),
                 super::Transaction::Eip4844(tx) =&gt; Self::Eip4844(Cow::Borrowed(tx)),
                 super::Transaction::Eip7702(tx) =&gt; Self::Eip7702(TxEip7702::from(tx)),
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 super::Transaction::Deposit(tx) =&gt; {
                     Self::Deposit(op_alloy_consensus::serde_bincode_compat::TxDeposit::from(tx))
                 }
<span class="term-fg32">+                #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                super::Transaction::L1Message(tx) =&gt; Self::L1Message(Cow::Borrowed(tx)),</span>
             }
         }
     }
<span class="term-fg36">@@ -1750,8 +1864,10 @@</span>                 Transaction::Eip2930(tx) =&gt; Self::Eip2930(tx.into()),
                 Transaction::Eip1559(tx) =&gt; Self::Eip1559(tx.into()),
                 Transaction::Eip4844(tx) =&gt; Self::Eip4844(tx.into_owned()),
                 Transaction::Eip7702(tx) =&gt; Self::Eip7702(tx.into()),
<span class="term-fg31">-                #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                 Transaction::Deposit(tx) =&gt; Self::Deposit(tx.into()),
<span class="term-fg32">+                #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                Transaction::L1Message(tx) =&gt; Self::L1Message(tx.into_owned()),</span>
             }
         }
     }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0cd6cc0c1ded87d1a74813f2" role="button"
                       aria-expanded="false" aria-controls="id-0cd6cc0c1ded87d1a74813f2">
                        <code>crates/primitives/src/transaction/pooled.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/transaction/pooled.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/primitives/src/transaction/pooled.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0cd6cc0c1ded87d1a74813f2"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;pooled.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;pooled.rs</span>
<span class="term-fg1">index 145660f44c712b6814abb543f0bc6e958bb0d379..078e150b212ffa610cf7e7983a7572d824d1c85c 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;pooled.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;pooled.rs</span>
<span class="term-fg36">@@ -69,9 +69,12 @@</span>                 Ok(Self::Eip7702(Signed::new_unchecked(tx, signature, hash)))
             }
             &#47;&#47; Not supported because missing blob sidecar
             tx @ TransactionSigned { transaction: Transaction::Eip4844(_), .. } =&gt; Err(tx),
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             &#47;&#47; Not supported because deposit transactions are never pooled
             tx @ TransactionSigned { transaction: Transaction::Deposit(_), .. } =&gt; Err(tx),
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            &#47;&#47; Not supported because l1 message transactions are never pooled</span>
<span class="term-fg32">+            tx @ TransactionSigned { transaction: Transaction::L1Message(_), .. } =&gt; Err(tx),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -384,8 +387,10 @@</span>                         Signed::new_unchecked(tx, typed_tx.signature, hash)
                     )),
                     Transaction::Eip1559(tx) =&gt; Ok(Self::Eip1559( Signed::new_unchecked(tx, typed_tx.signature, hash))),
                     Transaction::Eip7702(tx) =&gt; Ok(Self::Eip7702( Signed::new_unchecked(tx, typed_tx.signature, hash))),
<span class="term-fg31">-                    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg31">-                    Transaction::Deposit(_) =&gt; Err(RlpError::Custom(&quot;Optimism deposit transaction cannot be decoded to PooledTransactionsElement&quot;).into())</span>
<span class="term-fg32">+                    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
<span class="term-fg32">+                    Transaction::Deposit(_) =&gt; Err(RlpError::Custom(&quot;Optimism deposit transaction cannot be decoded to PooledTransactionsElement&quot;).into()),</span>
<span class="term-fg32">+                    #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                    Transaction::L1Message(_) =&gt; Err(RlpError::Custom(&quot;Scroll L1 message transaction cannot be decoded to PooledTransactionsElement&quot;).into())</span>
                 }
             }
         }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-dd5efce3f4c35bbe87e727cd" role="button"
                       aria-expanded="false" aria-controls="id-dd5efce3f4c35bbe87e727cd">
                        <code>crates/primitives/src/transaction/tx_type.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/primitives/src/transaction/tx_type.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/primitives/src/transaction/tx_type.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+40</span></div>
                            <div class="text-start"><span class="text-danger">-10</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-dd5efce3f4c35bbe87e727cd"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;tx_type.rs scroll-reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;tx_type.rs</span>
<span class="term-fg1">index 784a976ab792b1bc5273f24e79a9c23055707681..9a2b0119124cdebec9d18749b05ff7ba813a8579 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;tx_type.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;src&#47;transaction&#47;tx_type.rs</span>
<span class="term-fg36">@@ -68,9 +68,13 @@</span>     &#47;&#47;&#47; EOA Contract Code Transactions - EIP-7702
     #[display(&quot;eip7702 (4)&quot;)]
     Eip7702 = 4_isize,
     &#47;&#47;&#47; Optimism Deposit transaction.
<span class="term-fg31">-    #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
     #[display(&quot;deposit (126)&quot;)]
     Deposit = 126_isize,
<span class="term-fg32">+    &#47;&#47;&#47; Scroll L1 message transaction.</span>
<span class="term-fg32">+    #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+    #[display(&quot;l1 message (126)&quot;)]</span>
<span class="term-fg32">+    L1Message = 126_isize,</span>
 }
&nbsp;
 impl TxType {
<span class="term-fg36">@@ -82,8 +86,10 @@</span>     pub const fn has_access_list(&amp;self) -&gt; bool {
         match self {
             Self::Legacy =&gt; false,
             Self::Eip2930 | Self::Eip1559 | Self::Eip4844 | Self::Eip7702 =&gt; true,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit =&gt; false,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message =&gt; false,</span>
         }
     }
 }
<span class="term-fg36">@@ -131,8 +137,10 @@</span>             TxType::Eip2930 =&gt; EIP2930_TX_TYPE_ID,
             TxType::Eip1559 =&gt; EIP1559_TX_TYPE_ID,
             TxType::Eip4844 =&gt; EIP4844_TX_TYPE_ID,
             TxType::Eip7702 =&gt; EIP7702_TX_TYPE_ID,
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             TxType::Deposit =&gt; op_alloy_consensus::DEPOSIT_TX_TYPE_ID,
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            TxType::L1Message =&gt; reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE,</span>
         }
     }
 }
<span class="term-fg36">@@ -147,9 +155,14 @@</span> impl TryFrom&lt;u8&gt; for TxType {
     type Error = &amp;&#39;static str;
&nbsp;
     fn try_from(value: u8) -&gt; Result&lt;Self, Self::Error&gt; {
<span class="term-fg31">-        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
         if value == Self::Deposit {
             return Ok(Self::Deposit)
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+        if value == Self::L1Message {</span>
<span class="term-fg32">+            return Ok(Self::L1Message)</span>
         }
&nbsp;
         if value == Self::Legacy {
<span class="term-fg36">@@ -205,11 +218,16 @@</span>             Self::Eip7702 =&gt; {
                 buf.put_u8(EIP7702_TX_TYPE_ID);
                 COMPACT_EXTENDED_IDENTIFIER_FLAG
             }
<span class="term-fg31">-            #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+            #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
             Self::Deposit =&gt; {
                 buf.put_u8(op_alloy_consensus::DEPOSIT_TX_TYPE_ID);
                 COMPACT_EXTENDED_IDENTIFIER_FLAG
             }
<span class="term-fg32">+            #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+            Self::L1Message =&gt; {</span>
<span class="term-fg32">+                buf.put_u8(reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE);</span>
<span class="term-fg32">+                COMPACT_EXTENDED_IDENTIFIER_FLAG</span>
<span class="term-fg32">+            }</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -228,8 +246,10 @@</span>                     let extended_identifier = buf.get_u8();
                     match extended_identifier {
                         EIP4844_TX_TYPE_ID =&gt; Self::Eip4844,
                         EIP7702_TX_TYPE_ID =&gt; Self::Eip7702,
<span class="term-fg31">-                        #[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+                        #[cfg(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)))]</span>
                         op_alloy_consensus::DEPOSIT_TX_TYPE_ID =&gt; Self::Deposit,
<span class="term-fg32">+                        #[cfg(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)))]</span>
<span class="term-fg32">+                        reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE =&gt; Self::L1Message,</span>
                         _ =&gt; panic!(&quot;Unsupported TxType identifier: {extended_identifier}&quot;),
                     }
                 }
<span class="term-fg36">@@ -292,9 +312,16 @@</span>     #[case(U64::from(EIP1559_TX_TYPE_ID), Ok(TxType::Eip1559))]
     #[case(U64::from(EIP4844_TX_TYPE_ID), Ok(TxType::Eip4844))]
     #[case(U64::from(EIP7702_TX_TYPE_ID), Ok(TxType::Eip7702))]
     #[cfg_attr(
<span class="term-fg31">-        feature = &quot;optimism&quot;,</span>
<span class="term-fg32">+        all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)),</span>
         case(U64::from(op_alloy_consensus::DEPOSIT_TX_TYPE_ID), Ok(TxType::Deposit))
     )]
<span class="term-fg32">+    #[cfg_attr(</span>
<span class="term-fg32">+        all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)),</span>
<span class="term-fg32">+        case(</span>
<span class="term-fg32">+            U64::from(reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE),</span>
<span class="term-fg32">+            Ok(TxType::L1Message)</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+    )]</span>
     #[case(U64::MAX, Err(&quot;invalid tx type&quot;))]
     fn test_u64_to_tx_type(#[case] input: U64, #[case] expected: Result&lt;TxType, &amp;&#39;static str&gt;) {
         let tx_type_result = TxType::try_from(input);
<span class="term-fg36">@@ -307,7 +334,8 @@</span>     #[case(TxType::Eip2930, COMPACT_IDENTIFIER_EIP2930, vec![])]
     #[case(TxType::Eip1559, COMPACT_IDENTIFIER_EIP1559, vec![])]
     #[case(TxType::Eip4844, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![EIP4844_TX_TYPE_ID])]
     #[case(TxType::Eip7702, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![EIP7702_TX_TYPE_ID])]
<span class="term-fg31">-    #[cfg_attr(feature = &quot;optimism&quot;, case(TxType::Deposit, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![op_alloy_consensus::DEPOSIT_TX_TYPE_ID]))]</span>
<span class="term-fg32">+    #[cfg_attr(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)), case(TxType::Deposit, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![op_alloy_consensus::DEPOSIT_TX_TYPE_ID]))]</span>
<span class="term-fg32">+    #[cfg_attr(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)), case(TxType::L1Message, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE]))]</span>
     fn test_txtype_to_compact(
         #[case] tx_type: TxType,
         #[case] expected_identifier: usize,
<span class="term-fg36">@@ -326,7 +354,8 @@</span>     #[case(TxType::Eip2930, COMPACT_IDENTIFIER_EIP2930, vec![])]
     #[case(TxType::Eip1559, COMPACT_IDENTIFIER_EIP1559, vec![])]
     #[case(TxType::Eip4844, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![EIP4844_TX_TYPE_ID])]
     #[case(TxType::Eip7702, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![EIP7702_TX_TYPE_ID])]
<span class="term-fg31">-    #[cfg_attr(feature = &quot;optimism&quot;, case(TxType::Deposit, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![op_alloy_consensus::DEPOSIT_TX_TYPE_ID]))]</span>
<span class="term-fg32">+    #[cfg_attr(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)), case(TxType::Deposit, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![op_alloy_consensus::DEPOSIT_TX_TYPE_ID]))]</span>
<span class="term-fg32">+    #[cfg_attr(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)), case(TxType::L1Message, COMPACT_EXTENDED_IDENTIFIER_FLAG, vec![reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE]))]</span>
     fn test_txtype_from_compact(
         #[case] expected_type: TxType,
         #[case] identifier: usize,
<span class="term-fg36">@@ -345,7 +374,8 @@</span>     #[case(&amp;[EIP1559_TX_TYPE_ID], Ok(TxType::Eip1559))]
     #[case(&amp;[EIP4844_TX_TYPE_ID], Ok(TxType::Eip4844))]
     #[case(&amp;[EIP7702_TX_TYPE_ID], Ok(TxType::Eip7702))]
     #[case(&amp;[u8::MAX], Err(alloy_rlp::Error::InputTooShort))]
<span class="term-fg31">-    #[cfg_attr(feature = &quot;optimism&quot;, case(&amp;[op_alloy_consensus::DEPOSIT_TX_TYPE_ID], Ok(TxType::Deposit)))]</span>
<span class="term-fg32">+    #[cfg_attr(all(feature = &quot;optimism&quot;, not(feature = &quot;scroll&quot;)), case(&amp;[op_alloy_consensus::DEPOSIT_TX_TYPE_ID], Ok(TxType::Deposit)))]</span>
<span class="term-fg32">+    #[cfg_attr(all(feature = &quot;scroll&quot;, not(feature = &quot;optimism&quot;)), case(&amp;[reth_scroll_primitives::L1_MESSAGE_TRANSACTION_TYPE], Ok(TxType::L1Message)))]</span>
     fn decode_tx_type(#[case] input: &amp;[u8], #[case] expected: Result&lt;TxType, alloy_rlp::Error&gt;) {
         let tx_type_result = TxType::decode(&amp;mut &amp;input[..]);
         assert_eq!(tx_type_result, expected)</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-40ed4d2be9310756d439f5a5"role="button" aria-expanded="false" aria-controls="id-40ed4d2be9310756d439f5a5">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/stages</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+159</span></div>
                    <div class="text-start"><span class="text-danger">-36</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-40ed4d2be9310756d439f5a5">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-838b2acbcb94a2ff71d178f5" role="button"
                       aria-expanded="false" aria-controls="id-838b2acbcb94a2ff71d178f5">
                        <code>crates/stages/stages/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/stages/stages/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/stages/stages/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+21</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-838b2acbcb94a2ff71d178f5"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;Cargo.toml scroll-reth&#47;crates&#47;stages&#47;stages&#47;Cargo.toml</span>
<span class="term-fg1">index f97214f4643329336c9b061504d22960f9d6d869..691d618e4fc6f952f8f3696225da531b7b34e397 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;Cargo.toml</span>
<span class="term-fg36">@@ -39,6 +39,10 @@</span> reth-trie-db = { workspace = true, features = [&quot;metrics&quot;] }
&nbsp;
 reth-testing-utils = { workspace = true, optional = true }
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 alloy-eips.workspace = true
 alloy-primitives.workspace = true
 alloy-consensus.workspace = true
<span class="term-fg36">@@ -74,6 +78,8 @@</span> reth-testing-utils.workspace = true
 reth-trie = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-provider = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-network-peers.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
&nbsp;
 alloy-rlp.workspace = true
 itertools.workspace = true
<span class="term-fg36">@@ -114,6 +120,21 @@</span>     &quot;reth-db-api&#47;test-utils&quot;,
     &quot;reth-trie-db&#47;test-utils&quot;,
     &quot;reth-trie&#47;test-utils&quot;,
     &quot;reth-prune-types&#47;test-utils&quot;,
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-testing-utils?&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm-ethereum&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-exex&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-storage&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-primitives&quot;</span>
 ]
&nbsp;
 [[bench]]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-87afe60404a7b0ef3b4b36b4" role="button"
                       aria-expanded="false" aria-controls="id-87afe60404a7b0ef3b4b36b4">
                        <code>crates/stages/stages/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/stages/stages/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/stages/stages/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-87afe60404a7b0ef3b4b36b4"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;lib.rs</span>
<span class="term-fg1">index ce6a96cf3496aa9ea2af7181fe93c5339fb5f8a0..417bd8b24c63779d33da2bbe6b192d03e3377dff 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -80,6 +80,10 @@</span> )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
&nbsp;
<span class="term-fg32">+use reth_revm as _;</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+use reth_scroll_primitives as _;</span>
<span class="term-fg32">+</span>
 #[allow(missing_docs)]
 #[cfg(any(test, feature = &quot;test-utils&quot;))]
 pub mod test_utils;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-19fb97ae28a1d85ccf41714b" role="button"
                       aria-expanded="false" aria-controls="id-19fb97ae28a1d85ccf41714b">
                        <code>crates/stages/stages/src/stages/execution.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/stages/stages/src/stages/execution.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/stages/stages/src/stages/execution.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+68</span></div>
                            <div class="text-start"><span class="text-danger">-13</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-19fb97ae28a1d85ccf41714b"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;execution.rs scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;execution.rs</span>
<span class="term-fg1">index ce969f2577d8372605a69b3706f163ef3e069b48..64f6d5accba148f2ab723898c71149c0fc10ee57 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;execution.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;execution.rs</span>
<span class="term-fg36">@@ -20,7 +20,6 @@</span>     OriginalValuesKnown, ProviderError, StateCommitmentProvider, StateWriter,
     StaticFileProviderFactory, StatsReader, StorageLocation, TransactionVariant,
 };
 use reth_prune_types::PruneModes;
<span class="term-fg31">-use reth_revm::database::StateProviderDatabase;</span>
 use reth_stages_api::{
     BlockErrorKind, CheckpointBlockRange, EntitiesCheckpoint, ExecInput, ExecOutput,
     ExecutionCheckpoint, ExecutionStageThresholds, Stage, StageCheckpoint, StageError, StageId,
<span class="term-fg36">@@ -294,7 +293,11 @@</span>         let static_file_provider = provider.static_file_provider();
&nbsp;
         self.ensure_consistency(provider, input.checkpoint().block_number, None)?;
&nbsp;
<span class="term-fg31">-        let db = StateProviderDatabase(LatestStateProviderRef::new(provider));</span>
<span class="term-fg32">+        let state = LatestStateProviderRef::new(provider);</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let db = reth_scroll_storage::ScrollStateProviderDatabase::new(state);</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let db = reth_revm::database::StateProviderDatabase(state);</span>
         let mut executor = self.executor_provider.batch_executor(db);
         executor.set_tip(max_block);
         executor.set_prune_modes(prune_modes);
<span class="term-fg36">@@ -853,13 +856,27 @@</span>         let code_hash = keccak256(code);
         db_tx
             .put::&lt;tables::PlainAccountState&gt;(
                 acc1,
<span class="term-fg31">-                Account { nonce: 0, balance: U256::ZERO, bytecode_hash: Some(code_hash) },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance: U256::ZERO,</span>
<span class="term-fg32">+                    bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code),</span>
<span class="term-fg32">+                    ),</span>
<span class="term-fg32">+                },</span>
             )
             .unwrap();
         db_tx
             .put::&lt;tables::PlainAccountState&gt;(
                 acc2,
<span class="term-fg31">-                Account { nonce: 0, balance, bytecode_hash: None },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance,</span>
<span class="term-fg32">+                    bytecode_hash: None,</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                },</span>
             )
             .unwrap();
         db_tx.put::&lt;tables::Bytecodes&gt;(code_hash, Bytecode::new_raw(code.to_vec().into())).unwrap();
<span class="term-fg36">@@ -910,19 +927,30 @@</span>             let provider = factory.provider().unwrap();
&nbsp;
             &#47;&#47; check post state
             let account1 = address!(&quot;1000000000000000000000000000000000000000&quot;);
<span class="term-fg31">-            let account1_info =</span>
<span class="term-fg31">-                Account { balance: U256::ZERO, nonce: 0x00, bytecode_hash: Some(code_hash) };</span>
<span class="term-fg32">+            let account1_info = Account {</span>
<span class="term-fg32">+                balance: U256::ZERO,</span>
<span class="term-fg32">+                nonce: 0x00,</span>
<span class="term-fg32">+                bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                    &amp;code,</span>
<span class="term-fg32">+                )),</span>
<span class="term-fg32">+            };</span>
             let account2 = address!(&quot;2adc25665018aa1fe0e6bc666dac8fc2697ff9ba&quot;);
             let account2_info = Account {
                 balance: U256::from(0x1bc16d674ece94bau128),
                 nonce: 0x00,
                 bytecode_hash: None,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
             };
             let account3 = address!(&quot;a94f5374fce5edbc8e2a8697c15331677e6ebf0b&quot;);
             let account3_info = Account {
                 balance: U256::from(0x3635c9adc5de996b46u128),
                 nonce: 0x01,
                 bytecode_hash: None,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
             };
&nbsp;
             &#47;&#47; assert accounts
<span class="term-fg36">@@ -999,9 +1027,21 @@</span>         let provider = factory.provider_rw().unwrap();
&nbsp;
         let db_tx = provider.tx_ref();
         let acc1 = address!(&quot;1000000000000000000000000000000000000000&quot;);
<span class="term-fg31">-        let acc1_info = Account { nonce: 0, balance: U256::ZERO, bytecode_hash: Some(code_hash) };</span>
<span class="term-fg32">+        let acc1_info = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code)),</span>
<span class="term-fg32">+        };</span>
         let acc2 = address!(&quot;a94f5374fce5edbc8e2a8697c15331677e6ebf0b&quot;);
<span class="term-fg31">-        let acc2_info = Account { nonce: 0, balance, bytecode_hash: None };</span>
<span class="term-fg32">+        let acc2_info = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
&nbsp;
         db_tx.put::&lt;tables::PlainAccountState&gt;(acc1, acc1_info).unwrap();
         db_tx.put::&lt;tables::PlainAccountState&gt;(acc2, acc2_info).unwrap();
<span class="term-fg36">@@ -1120,9 +1160,20 @@</span>         let balance = U256::from(0x0de0b6b3a7640000u64);
         let code_hash = keccak256(code);
&nbsp;
         &#47;&#47; pre state
<span class="term-fg31">-        let caller_info = Account { nonce: 0, balance, bytecode_hash: None };</span>
<span class="term-fg31">-        let destroyed_info =</span>
<span class="term-fg31">-            Account { nonce: 0, balance: U256::ZERO, bytecode_hash: Some(code_hash) };</span>
<span class="term-fg32">+        let caller_info = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let destroyed_info = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code)),</span>
<span class="term-fg32">+        };</span>
&nbsp;
         &#47;&#47; set account
         let provider = test_db.factory.provider_rw().unwrap();
<span class="term-fg36">@@ -1181,7 +1232,9 @@</span>                     beneficiary_address,
                     Account {
                         nonce: 0,
                         balance: U256::from(0x1bc16d674eca30a0u64),
<span class="term-fg31">-                        bytecode_hash: None</span>
<span class="term-fg32">+                        bytecode_hash: None,</span>
<span class="term-fg32">+                        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                        account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
                     }
                 ),
                 (
<span class="term-fg36">@@ -1189,7 +1242,9 @@</span>                     caller_address,
                     Account {
                         nonce: 1,
                         balance: U256::from(0xde0b6b3a761cf60u64),
<span class="term-fg31">-                        bytecode_hash: None</span>
<span class="term-fg32">+                        bytecode_hash: None,</span>
<span class="term-fg32">+                        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                        account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
                     }
                 )
             ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-65933aceeeaf9bc7cb60e7cf" role="button"
                       aria-expanded="false" aria-controls="id-65933aceeeaf9bc7cb60e7cf">
                        <code>crates/stages/stages/src/stages/hashing_account.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/stages/stages/src/stages/hashing_account.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/stages/stages/src/stages/hashing_account.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+26</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-65933aceeeaf9bc7cb60e7cf"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_account.rs scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_account.rs</span>
<span class="term-fg1">index e6b1e548455fa8d42a6ab23d99c893d9ebe6800e..320972542a2407dbdad931b57b46c91f07470d1d 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_account.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_account.rs</span>
<span class="term-fg36">@@ -1,4 +1,4 @@</span>
<span class="term-fg31">-use alloy_primitives::{keccak256, B256};</span>
<span class="term-fg32">+use alloy_primitives::B256;</span>
 use itertools::Itertools;
 use reth_config::config::{EtlConfig, HashingConfig};
 use reth_db::{tables, RawKey, RawTable, RawValue};
<span class="term-fg36">@@ -8,12 +8,16 @@</span>     transaction::{DbTx, DbTxMut},
 };
 use reth_etl::Collector;
 use reth_primitives::Account;
<span class="term-fg31">-use reth_provider::{AccountExtReader, DBProvider, HashingWriter, StatsReader};</span>
<span class="term-fg32">+use reth_provider::{</span>
<span class="term-fg32">+    AccountExtReader, DBProvider, HashingWriter, StateCommitmentProvider, StatsReader,</span>
<span class="term-fg32">+};</span>
 use reth_stages_api::{
     AccountHashingCheckpoint, EntitiesCheckpoint, ExecInput, ExecOutput, Stage, StageCheckpoint,
     StageError, StageId, UnwindInput, UnwindOutput,
 };
 use reth_storage_errors::provider::ProviderResult;
<span class="term-fg32">+use reth_trie::KeyHasher;</span>
<span class="term-fg32">+use reth_trie_db::StateCommitment;</span>
 use std::{
     fmt::Debug,
     ops::{Range, RangeInclusive},
<span class="term-fg36">@@ -109,6 +113,8 @@</span>                 let prev_acc = Account {
                     nonce: nonce - 1,
                     balance: balance - U256::from(1),
                     bytecode_hash: None,
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
                 };
                 let acc_before_tx = AccountBeforeTx { address: *addr, info: Some(prev_acc) };
                 acc_changeset_cursor.append(t, acc_before_tx)?;
<span class="term-fg36">@@ -131,7 +137,11 @@</span> }
&nbsp;
 impl&lt;Provider&gt; Stage&lt;Provider&gt; for AccountHashingStage
 where
<span class="term-fg31">-    Provider: DBProvider&lt;Tx: DbTxMut&gt; + HashingWriter + AccountExtReader + StatsReader,</span>
<span class="term-fg32">+    Provider: DBProvider&lt;Tx: DbTxMut&gt;</span>
<span class="term-fg32">+        + HashingWriter</span>
<span class="term-fg32">+        + AccountExtReader</span>
<span class="term-fg32">+        + StatsReader</span>
<span class="term-fg32">+        + StateCommitmentProvider,</span>
 {
     &#47;&#47;&#47; Return the id of the stage
     fn id(&amp;self) -&gt; StageId {
<span class="term-fg36">@@ -172,7 +182,14 @@</span>                 &#47;&#47; Spawn the hashing task onto the global rayon pool
                 rayon::spawn(move || {
                     for (address, account) in chunk {
                         let address = address.key().unwrap();
<span class="term-fg31">-                        let _ = tx.send((RawKey::new(keccak256(address)), account));</span>
<span class="term-fg32">+                        let _ = tx.send((</span>
<span class="term-fg32">+                            RawKey::new(</span>
<span class="term-fg32">+                                &lt;&lt;Provider::StateCommitment as StateCommitment&gt;::KeyHasher as KeyHasher&gt;::hash_key(</span>
<span class="term-fg32">+                                    address,</span>
<span class="term-fg32">+                                ),</span>
<span class="term-fg32">+                            ),</span>
<span class="term-fg32">+                            account,</span>
<span class="term-fg32">+                        ));</span>
                     }
                 });
&nbsp;
<span class="term-fg36">@@ -299,7 +316,7 @@</span>     use crate::test_utils::{
         stage_test_suite_ext, ExecuteStageTestRunner, StageTestRunner, TestRunnerError,
         UnwindStageTestRunner,
     };
<span class="term-fg31">-    use alloy_primitives::U256;</span>
<span class="term-fg32">+    use alloy_primitives::{keccak256, U256};</span>
     use assert_matches::assert_matches;
     use reth_primitives::Account;
     use reth_provider::providers::StaticFileWriter;
<span class="term-fg36">@@ -403,6 +420,10 @@</span>                         let old_acc = Account {
                             nonce: nonce - 1,
                             balance: balance - U256::from(1),
                             bytecode_hash: None,
<span class="term-fg32">+                            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                            account_extension: Some(</span>
<span class="term-fg32">+                                reth_scroll_primitives::AccountExtension::empty(),</span>
<span class="term-fg32">+                            ),</span>
                         };
                         let hashed_addr = keccak256(address);
                         if let Some((_, acc)) = hashed_acc_cursor.seek_exact(hashed_addr)? {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-65475b5018b694c468f4d38e" role="button"
                       aria-expanded="false" aria-controls="id-65475b5018b694c468f4d38e">
                        <code>crates/stages/stages/src/stages/hashing_storage.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/stages/stages/src/stages/hashing_storage.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/stages/stages/src/stages/hashing_storage.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+19</span></div>
                            <div class="text-start"><span class="text-danger">-6</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-65475b5018b694c468f4d38e"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_storage.rs scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_storage.rs</span>
<span class="term-fg1">index dcabbe83ee6444d640e7de13122b332a782dc7c2..3208113140eea15bf3985aa9574256e2b72adc6a 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_storage.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_storage.rs</span>
<span class="term-fg36">@@ -1,4 +1,4 @@</span>
<span class="term-fg31">-use alloy_primitives::{bytes::BufMut, keccak256, B256};</span>
<span class="term-fg32">+use alloy_primitives::{bytes::BufMut, B256};</span>
 use itertools::Itertools;
 use reth_config::config::{EtlConfig, HashingConfig};
 use reth_db::tables;
<span class="term-fg36">@@ -10,12 +10,16 @@</span>     transaction::{DbTx, DbTxMut},
 };
 use reth_etl::Collector;
 use reth_primitives::StorageEntry;
<span class="term-fg31">-use reth_provider::{DBProvider, HashingWriter, StatsReader, StorageReader};</span>
<span class="term-fg32">+use reth_provider::{</span>
<span class="term-fg32">+    DBProvider, HashingWriter, StateCommitmentProvider, StatsReader, StorageReader,</span>
<span class="term-fg32">+};</span>
 use reth_stages_api::{
     EntitiesCheckpoint, ExecInput, ExecOutput, Stage, StageCheckpoint, StageError, StageId,
     StorageHashingCheckpoint, UnwindInput, UnwindOutput,
 };
 use reth_storage_errors::provider::ProviderResult;
<span class="term-fg32">+use reth_trie::KeyHasher;</span>
<span class="term-fg32">+use reth_trie_db::StateCommitment;</span>
 use std::{
     fmt::Debug,
     sync::mpsc::{self, Receiver},
<span class="term-fg36">@@ -64,7 +68,11 @@</span> }
&nbsp;
 impl&lt;Provider&gt; Stage&lt;Provider&gt; for StorageHashingStage
 where
<span class="term-fg31">-    Provider: DBProvider&lt;Tx: DbTxMut&gt; + StorageReader + HashingWriter + StatsReader,</span>
<span class="term-fg32">+    Provider: DBProvider&lt;Tx: DbTxMut&gt;</span>
<span class="term-fg32">+        + StorageReader</span>
<span class="term-fg32">+        + HashingWriter</span>
<span class="term-fg32">+        + StatsReader</span>
<span class="term-fg32">+        + StateCommitmentProvider,</span>
 {
     &#47;&#47;&#47; Return the id of the stage
     fn id(&amp;self) -&gt; StageId {
<span class="term-fg36">@@ -103,8 +111,13 @@</span>                 &#47;&#47; Spawn the hashing task onto the global rayon pool
                 rayon::spawn(move || {
                     for (address, slot) in chunk {
                         let mut addr_key = Vec::with_capacity(64);
<span class="term-fg31">-                        addr_key.put_slice(keccak256(address).as_slice());</span>
<span class="term-fg31">-                        addr_key.put_slice(keccak256(slot.key).as_slice());</span>
<span class="term-fg32">+                        addr_key.put_slice(</span>
<span class="term-fg32">+                            &lt;&lt;Provider::StateCommitment as StateCommitment&gt;::KeyHasher as KeyHasher&gt;::hash_key(</span>
<span class="term-fg32">+                                address,</span>
<span class="term-fg32">+                            )</span>
<span class="term-fg32">+                            .as_slice(),</span>
<span class="term-fg32">+                        );</span>
<span class="term-fg32">+                        addr_key.put_slice(&lt;&lt;Provider::StateCommitment as StateCommitment&gt;::KeyHasher as KeyHasher&gt;::hash_key(slot.key).as_slice());</span>
                         let _ = tx.send((addr_key, CompactU256::from(slot.value)));
                     }
                 });
<span class="term-fg36">@@ -212,7 +225,7 @@</span>     use crate::test_utils::{
         stage_test_suite_ext, ExecuteStageTestRunner, StageTestRunner, TestRunnerError,
         TestStageDB, UnwindStageTestRunner,
     };
<span class="term-fg31">-    use alloy_primitives::{Address, U256};</span>
<span class="term-fg32">+    use alloy_primitives::{keccak256, Address, U256};</span>
     use assert_matches::assert_matches;
     use rand::Rng;
     use reth_db_api::{</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2b6e38929161604858dcb136" role="button"
                       aria-expanded="false" aria-controls="id-2b6e38929161604858dcb136">
                        <code>crates/stages/stages/src/stages/merkle.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/stages/stages/src/stages/merkle.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/stages/stages/src/stages/merkle.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-11</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2b6e38929161604858dcb136"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;merkle.rs scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;merkle.rs</span>
<span class="term-fg1">index 2d2503b539195dfa9449d98d9f5a96fb0fc08698..72122dd838b7c910c54b8e0503a080c555c68113 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;merkle.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;merkle.rs</span>
<span class="term-fg36">@@ -5,15 +5,14 @@</span> use reth_db::tables;
 use reth_db_api::transaction::{DbTx, DbTxMut};
 use reth_primitives::{GotExpected, SealedHeader};
 use reth_provider::{
<span class="term-fg31">-    DBProvider, HeaderProvider, ProviderError, StageCheckpointReader, StageCheckpointWriter,</span>
<span class="term-fg31">-    StatsReader, TrieWriter,</span>
<span class="term-fg32">+    DBProvider, HeaderProvider, LatestStateProviderRef, ProviderError, StageCheckpointReader,</span>
<span class="term-fg32">+    StageCheckpointWriter, StateCommitmentProvider, StateRootProviderExt, StatsReader, TrieWriter,</span>
 };
 use reth_stages_api::{
     BlockErrorKind, EntitiesCheckpoint, ExecInput, ExecOutput, MerkleCheckpoint, Stage,
     StageCheckpoint, StageError, StageId, UnwindInput, UnwindOutput,
 };
<span class="term-fg31">-use reth_trie::{IntermediateStateRootState, StateRoot, StateRootProgress, StoredSubNode};</span>
<span class="term-fg31">-use reth_trie_db::DatabaseStateRoot;</span>
<span class="term-fg32">+use reth_trie::{IntermediateStateRootState, StateRootProgress, StoredSubNode};</span>
 use std::fmt::Debug;
 use tracing::*;
&nbsp;
<span class="term-fg36">@@ -137,7 +136,8 @@</span>         + TrieWriter
         + StatsReader
         + HeaderProvider
         + StageCheckpointReader
<span class="term-fg31">-        + StageCheckpointWriter,</span>
<span class="term-fg32">+        + StageCheckpointWriter</span>
<span class="term-fg32">+        + StateCommitmentProvider,</span>
 {
     &#47;&#47;&#47; Return the id of the stage
     fn id(&amp;self) -&gt; StageId {
<span class="term-fg36">@@ -210,10 +210,8 @@</span>                     provider.count_entries::&lt;tables::HashedStorages&gt;()?)
                     as u64,
             });
&nbsp;
<span class="term-fg31">-            let tx = provider.tx_ref();</span>
<span class="term-fg31">-            let progress = StateRoot::from_tx(tx)</span>
<span class="term-fg31">-                .with_intermediate_state(checkpoint.map(IntermediateStateRootState::from))</span>
<span class="term-fg31">-                .root_with_progress()</span>
<span class="term-fg32">+            let progress = LatestStateProviderRef::new(provider).state_root_with_progress</span>
<span class="term-fg32">+                (checkpoint.map(IntermediateStateRootState::from))</span>
                 .map_err(|e| {
                     error!(target: &quot;sync::stages::merkle&quot;, %e, ?current_block_number, ?to_block, &quot;State root with progress failed! {INVALID_STATE_ROOT_ERROR_MESSAGE}&quot;);
                     StageError::Fatal(Box::new(e))
<span class="term-fg36">@@ -250,7 +248,7 @@</span>             }
         } else {
             debug!(target: &quot;sync::stages::merkle::exec&quot;, current = ?current_block_number, target = ?to_block, &quot;Updating trie&quot;);
             let (root, updates) =
<span class="term-fg31">-                StateRoot::incremental_root_with_updates(provider.tx_ref(), range)</span>
<span class="term-fg32">+                LatestStateProviderRef::new(provider).incremental_state_root_with_updates(range)</span>
                     .map_err(|e| {
                         error!(target: &quot;sync::stages::merkle&quot;, %e, ?current_block_number, ?to_block, &quot;Incremental state root failed! {INVALID_STATE_ROOT_ERROR_MESSAGE}&quot;);
                         StageError::Fatal(Box::new(e))
<span class="term-fg36">@@ -321,7 +319,8 @@</span>         &#47;&#47; Unwind trie only if there are transitions
         if range.is_empty() {
             info!(target: &quot;sync::stages::merkle::unwind&quot;, &quot;Nothing to unwind&quot;);
         } else {
<span class="term-fg31">-            let (block_root, updates) = StateRoot::incremental_root_with_updates(tx, range)</span>
<span class="term-fg32">+            let (block_root, updates) = LatestStateProviderRef::new(provider)</span>
<span class="term-fg32">+                .incremental_state_root_with_updates(range)</span>
                 .map_err(|e| StageError::Fatal(Box::new(e)))?;
&nbsp;
             &#47;&#47; Validate the calculated state root</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-19441c0accd287a23342dc07" role="button"
                       aria-expanded="false" aria-controls="id-19441c0accd287a23342dc07">
                        <code>crates/stages/stages/src/stages/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/stages/stages/src/stages/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/stages/stages/src/stages/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-19441c0accd287a23342dc07"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;mod.rs scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;mod.rs</span>
<span class="term-fg1">index 9d7cc685a7ef7875fef1d39fa5557cebe8f06271..b0bcebd5e9a7bd93faddcba27b9a8f0f5d2d3582 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;mod.rs</span>
<span class="term-fg36">@@ -117,7 +117,15 @@</span>         provider_rw
             .tx_ref()
             .put::&lt;tables::PlainAccountState&gt;(
                 address!(&quot;1000000000000000000000000000000000000000&quot;),
<span class="term-fg31">-                Account { nonce: 0, balance: U256::ZERO, bytecode_hash: Some(code_hash) },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance: U256::ZERO,</span>
<span class="term-fg32">+                    bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code),</span>
<span class="term-fg32">+                    ),</span>
<span class="term-fg32">+                },</span>
             )
             .unwrap();
         provider_rw
<span class="term-fg36">@@ -128,6 +136,8 @@</span>                 Account {
                     nonce: 0,
                     balance: U256::from(0x3635c9adc5dea00000u128),
                     bytecode_hash: None,
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
                 },
             )
             .unwrap();</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-32eb41c7400a2667ceb35352"role="button" aria-expanded="false" aria-controls="id-32eb41c7400a2667ceb35352">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/storage</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+637</span></div>
                    <div class="text-start"><span class="text-danger">-169</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-32eb41c7400a2667ceb35352">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8a21dce065201b9740ae532c" role="button"
                       aria-expanded="false" aria-controls="id-8a21dce065201b9740ae532c">
                        <code>crates/storage/db-api/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/db-api/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/db-api/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8a21dce065201b9740ae532c"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db-api&#47;Cargo.toml scroll-reth&#47;crates&#47;storage&#47;db-api&#47;Cargo.toml</span>
<span class="term-fg1">index 3aa908a600936423ec5ec52c2989344a778efa66..1071e0a4432a229360857c444234430c719c4f19 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db-api&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db-api&#47;Cargo.toml</span>
<span class="term-fg36">@@ -82,3 +82,4 @@</span>     &quot;reth-stages-types&#47;arbitrary&quot;,
     &quot;alloy-consensus&#47;arbitrary&quot;,
 ]
 optimism = [&quot;reth-primitives&#47;optimism&quot;, &quot;reth-codecs&#47;optimism&quot;]
<span class="term-fg32">+scroll = [&quot;reth-primitives&#47;scroll&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-02d80f47c5317d94b8e58099" role="button"
                       aria-expanded="false" aria-controls="id-02d80f47c5317d94b8e58099">
                        <code>crates/storage/db-api/src/models/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/db-api/src/models/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/db-api/src/models/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-02d80f47c5317d94b8e58099"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db-api&#47;src&#47;models&#47;mod.rs scroll-reth&#47;crates&#47;storage&#47;db-api&#47;src&#47;models&#47;mod.rs</span>
<span class="term-fg1">index 5d18711922edbe0a41d3cbffb7e5c1049350b532..83d2913c5bc50b66f922d5c2a5e62c4e1927124c 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db-api&#47;src&#47;models&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db-api&#47;src&#47;models&#47;mod.rs</span>
<span class="term-fg36">@@ -335,7 +335,10 @@</span>         assert_eq!(IndexHistoryCheckpoint::bitflag_encoded_bytes(), 0);
         assert_eq!(PruneCheckpoint::bitflag_encoded_bytes(), 1);
         assert_eq!(PruneMode::bitflag_encoded_bytes(), 1);
         assert_eq!(PruneSegment::bitflag_encoded_bytes(), 1);
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
         assert_eq!(Receipt::bitflag_encoded_bytes(), 1);
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        assert_eq!(Receipt::bitflag_encoded_bytes(), 2);</span>
         assert_eq!(StageCheckpoint::bitflag_encoded_bytes(), 1);
         assert_eq!(StageUnitCheckpoint::bitflag_encoded_bytes(), 1);
         assert_eq!(StoredBlockBodyIndices::bitflag_encoded_bytes(), 1);
<span class="term-fg36">@@ -356,7 +359,10 @@</span>         validate_bitflag_backwards_compat!(IndexHistoryCheckpoint, UnusedBits::Zero);
         validate_bitflag_backwards_compat!(PruneCheckpoint, UnusedBits::NotZero);
         validate_bitflag_backwards_compat!(PruneMode, UnusedBits::Zero);
         validate_bitflag_backwards_compat!(PruneSegment, UnusedBits::Zero);
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
         validate_bitflag_backwards_compat!(Receipt, UnusedBits::Zero);
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        validate_bitflag_backwards_compat!(Receipt, UnusedBits::NotZero);</span>
         validate_bitflag_backwards_compat!(StageCheckpoint, UnusedBits::NotZero);
         validate_bitflag_backwards_compat!(StageUnitCheckpoint, UnusedBits::Zero);
         validate_bitflag_backwards_compat!(StoredBlockBodyIndices, UnusedBits::Zero);</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-50b6fefe603bb3cdd46271f1" role="button"
                       aria-expanded="false" aria-controls="id-50b6fefe603bb3cdd46271f1">
                        <code>crates/storage/db-common/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/db-common/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/db-common/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-50b6fefe603bb3cdd46271f1"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db-common&#47;Cargo.toml scroll-reth&#47;crates&#47;storage&#47;db-common&#47;Cargo.toml</span>
<span class="term-fg1">index 9e4954357f84e7a05ab071bed9931a25a38e6780..662d1fdb0295b25b2bd830549f52c2517692a8fb 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db-common&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db-common&#47;Cargo.toml</span>
<span class="term-fg36">@@ -27,6 +27,9 @@</span> # eth
 alloy-genesis.workspace = true
 alloy-primitives.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # misc
 eyre.workspace = true
 thiserror.workspace = true
<span class="term-fg36">@@ -46,3 +49,6 @@</span> alloy-consensus.workspace = true
&nbsp;
 [lints]
 workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [&quot;reth-scroll-primitives&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-75ef7d539387570f930995a2" role="button"
                       aria-expanded="false" aria-controls="id-75ef7d539387570f930995a2">
                        <code>crates/storage/db-common/src/init.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/db-common/src/init.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/db-common/src/init.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-75ef7d539387570f930995a2"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db-common&#47;src&#47;init.rs scroll-reth&#47;crates&#47;storage&#47;db-common&#47;src&#47;init.rs</span>
<span class="term-fg1">index ec31edd068236db27050a09e3b0e1471d877eb2d..d0acfdb32066bb7d1f31f480c49b3351349708a6 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db-common&#47;src&#47;init.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db-common&#47;src&#47;init.rs</span>
<span class="term-fg36">@@ -215,6 +215,12 @@</span>                 Some(Account {
                     nonce: account.nonce.unwrap_or_default(),
                     balance: account.balance,
                     bytecode_hash,
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                            account.code.as_ref().unwrap_or_default(),</span>
<span class="term-fg32">+                        ),</span>
<span class="term-fg32">+                    ),</span>
                 }),
                 storage,
             ),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-74014befa40673fccb5eaca8" role="button"
                       aria-expanded="false" aria-controls="id-74014befa40673fccb5eaca8">
                        <code>crates/storage/db/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/db/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/db/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-74014befa40673fccb5eaca8"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db&#47;Cargo.toml scroll-reth&#47;crates&#47;storage&#47;db&#47;Cargo.toml</span>
<span class="term-fg1">index 4a4eff471238c901a023692591aefb7a589023ee..c723a3a37645761a6dc8962c06bd1c1475f1dcbb 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db&#47;Cargo.toml</span>
<span class="term-fg36">@@ -63,6 +63,8 @@</span> tempfile.workspace = true
 test-fuzz.workspace = true
 parking_lot.workspace = true
&nbsp;
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+</span>
 pprof = { workspace = true, features = [
     &quot;flamegraph&quot;,
     &quot;frame-pointer&quot;,
<span class="term-fg36">@@ -111,9 +113,15 @@</span>     &quot;alloy-primitives&#47;arbitrary&quot;,
     &quot;reth-prune-types&#47;arbitrary&quot;,
     &quot;reth-stages-types&#47;arbitrary&quot;,
     &quot;alloy-consensus&#47;arbitrary&quot;,
<span class="term-fg32">+    &quot;reth-scroll-primitives&#47;arbitrary&quot;</span>
 ]
 optimism = [&quot;reth-primitives&#47;optimism&quot;, &quot;reth-db-api&#47;optimism&quot;]
 disable-lock = []
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie-common&#47;scroll&quot;</span>
<span class="term-fg32">+]</span>
&nbsp;
 [[bench]]
 name = &quot;hash_keys&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-70101cc9b95665bc01f2bd4c" role="button"
                       aria-expanded="false" aria-controls="id-70101cc9b95665bc01f2bd4c">
                        <code>crates/storage/db/src/implementation/mdbx/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/db/src/implementation/mdbx/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/db/src/implementation/mdbx/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-70101cc9b95665bc01f2bd4c"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db&#47;src&#47;implementation&#47;mdbx&#47;mod.rs scroll-reth&#47;crates&#47;storage&#47;db&#47;src&#47;implementation&#47;mdbx&#47;mod.rs</span>
<span class="term-fg1">index 006213e4cb916f4667172f5fffe3f2a5579c1ba5..e564a25e859809be06abc5c58f4be15d169668a1 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db&#47;src&#47;implementation&#47;mdbx&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db&#47;src&#47;implementation&#47;mdbx&#47;mod.rs</span>
<span class="term-fg36">@@ -1178,6 +1178,8 @@</span>         let value = Account {
             nonce: 18446744073709551615,
             bytecode_hash: Some(B256::random()),
             balance: U256::MAX,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some((10u64, B256::random()).into()),</span>
         };
         let key = Address::from_str(&quot;0xa2c122be93b0074270ebee7f6b7292c7deb45047&quot;)
             .expect(ERROR_ETH_ADDRESS);</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d6271a86d1d242cd40a4e798" role="button"
                       aria-expanded="false" aria-controls="id-d6271a86d1d242cd40a4e798">
                        <code>crates/storage/provider/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/provider/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+16</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d6271a86d1d242cd40a4e798"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;Cargo.toml scroll-reth&#47;crates&#47;storage&#47;provider&#47;Cargo.toml</span>
<span class="term-fg1">index 2875b91149c51eee0d7aa441faf82a2cccca43dc..74924f1fbd9b97b5d53b4e75e90465b674d33cd7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;Cargo.toml</span>
<span class="term-fg36">@@ -42,6 +42,9 @@</span> alloy-rpc-types-engine.workspace = true
 alloy-consensus.workspace = true
 revm.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # optimism
 reth-optimism-primitives = { workspace = true, optional = true }
&nbsp;
<span class="term-fg36">@@ -79,6 +82,8 @@</span> reth-trie = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-testing-utils.workspace = true
 reth-ethereum-engine-primitives.workspace = true
&nbsp;
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+</span>
 parking_lot.workspace = true
 tempfile.workspace = true
 assert_matches.workspace = true
<span class="term-fg36">@@ -113,6 +118,7 @@</span>     &quot;reth-primitives-traits&#47;serde&quot;,
     &quot;reth-execution-types&#47;serde&quot;,
     &quot;reth-trie-db&#47;serde&quot;,
     &quot;reth-trie&#47;serde&quot;,
<span class="term-fg32">+    &quot;reth-scroll-primitives?&#47;serde&quot;</span>
 ]
 test-utils = [
     &quot;reth-db&#47;test-utils&quot;,
<span class="term-fg36">@@ -133,3 +139,13 @@</span>     &quot;reth-prune-types&#47;test-utils&quot;,
     &quot;reth-stages-types&#47;test-utils&quot;,
     &quot;reth-optimism-primitives?&#47;arbitrary&quot;,
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-testing-utils&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-primitives&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-404ee4b045aff695c79ce945" role="button"
                       aria-expanded="false" aria-controls="id-404ee4b045aff695c79ce945">
                        <code>crates/storage/provider/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/provider/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-404ee4b045aff695c79ce945"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;lib.rs</span>
<span class="term-fg1">index deccdea2831f712827302b5087c7c5a6f3132ea8..1549de8e779479564d99c371c8d37eb9c04b31b3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -12,6 +12,9 @@</span> )]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
&nbsp;
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+use reth_scroll_primitives as _;</span>
<span class="term-fg32">+</span>
 &#47;&#47;&#47; Various provider traits.
 mod traits;
 pub use traits::*;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-64d8d466dea6a5be9546a18b" role="button"
                       aria-expanded="false" aria-controls="id-64d8d466dea6a5be9546a18b">
                        <code>crates/storage/provider/src/providers/blockchain_provider.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/providers/blockchain_provider.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/provider/src/providers/blockchain_provider.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+23</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-64d8d466dea6a5be9546a18b"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;blockchain_provider.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;blockchain_provider.rs</span>
<span class="term-fg1">index 08f5e4680a2b8ef19a1cdc93d0ea1637e98c315e..cbdb12c24e811ce16bfccf91a4a0f10781021b6d 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;blockchain_provider.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;blockchain_provider.rs</span>
<span class="term-fg36">@@ -4,8 +4,8 @@</span>     providers::{ConsistentProvider, StaticFileProvider},
     AccountReader, BlockHashReader, BlockIdReader, BlockNumReader, BlockReader, BlockReaderIdExt,
     BlockSource, CanonChainTracker, CanonStateNotifications, CanonStateSubscriptions,
     ChainSpecProvider, ChainStateBlockReader, ChangeSetReader, DatabaseProvider,
<span class="term-fg31">-    DatabaseProviderFactory, EvmEnvProvider, FullProvider, HeaderProvider, ProviderError,</span>
<span class="term-fg31">-    ProviderFactory, PruneCheckpointReader, ReceiptProvider, ReceiptProviderIdExt,</span>
<span class="term-fg32">+    DatabaseProviderFactory, EvmEnvProvider, FullProvider, HashedPostStateProvider, HeaderProvider,</span>
<span class="term-fg32">+    ProviderError, ProviderFactory, PruneCheckpointReader, ReceiptProvider, ReceiptProviderIdExt,</span>
     StageCheckpointReader, StateProviderBox, StateProviderFactory, StateReader,
     StaticFileProviderFactory, TransactionVariant, TransactionsProvider, WithdrawalsProvider,
 };
<span class="term-fg36">@@ -34,9 +34,16 @@</span> };
 use reth_primitives_traits::BlockBody as _;
 use reth_prune_types::{PruneCheckpoint, PruneSegment};
 use reth_stages_types::{StageCheckpoint, StageId};
<span class="term-fg31">-use reth_storage_api::{DBProvider, NodePrimitivesProvider, StorageChangeSetReader};</span>
<span class="term-fg32">+use reth_storage_api::{</span>
<span class="term-fg32">+    DBProvider, NodePrimitivesProvider, StateCommitmentProvider, StorageChangeSetReader,</span>
<span class="term-fg32">+};</span>
 use reth_storage_errors::provider::ProviderResult;
<span class="term-fg31">-use revm::primitives::{BlockEnv, CfgEnvWithHandlerCfg};</span>
<span class="term-fg32">+use reth_trie::HashedPostState;</span>
<span class="term-fg32">+use reth_trie_db::StateCommitment;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::BundleState,</span>
<span class="term-fg32">+    primitives::{BlockEnv, CfgEnvWithHandlerCfg},</span>
<span class="term-fg32">+};</span>
 use std::{
     ops::{Add, RangeBounds, RangeInclusive, Sub},
     sync::Arc,
<span class="term-fg36">@@ -166,6 +173,10 @@</span>
     fn database_provider_rw(&amp;self) -&gt; ProviderResult&lt;Self::ProviderRW&gt; {
         self.database.database_provider_rw()
     }
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;N: ProviderNodeTypes&gt; StateCommitmentProvider for BlockchainProvider2&lt;N&gt; {</span>
<span class="term-fg32">+    type StateCommitment = N::StateCommitment;</span>
 }
&nbsp;
 impl&lt;N: ProviderNodeTypes&gt; StaticFileProviderFactory for BlockchainProvider2&lt;N&gt; {
<span class="term-fg36">@@ -649,6 +660,14 @@</span>                     .ok_or_else(|| ProviderError::HeaderNotFound(num.into()))?;
                 self.state_by_block_hash(hash)
             }
         }
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;N: NodeTypesWithDB&gt; HashedPostStateProvider for BlockchainProvider2&lt;N&gt; {</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, bundle_state: &amp;BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+        HashedPostState::from_bundle_state::&lt;&lt;N::StateCommitment as StateCommitment&gt;::KeyHasher&gt;(</span>
<span class="term-fg32">+            bundle_state.state(),</span>
<span class="term-fg32">+        )</span>
     }
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7e781d46efa36ee2fdef531c" role="button"
                       aria-expanded="false" aria-controls="id-7e781d46efa36ee2fdef531c">
                        <code>crates/storage/provider/src/providers/bundle_state_provider.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/providers/bundle_state_provider.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/provider/src/providers/bundle_state_provider.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+39</span></div>
                            <div class="text-start"><span class="text-danger">-17</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7e781d46efa36ee2fdef531c"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;bundle_state_provider.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;bundle_state_provider.rs</span>
<span class="term-fg1">index 652f6fb33fd271c274e01859153e0743f2624890..8536ccfbaa7d67d20a77f40dc2317d6d6a0c50ca 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;bundle_state_provider.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;bundle_state_provider.rs</span>
<span class="term-fg36">@@ -6,7 +6,10 @@</span>     map::{HashMap, HashSet},
     Address, BlockNumber, Bytes, B256,
 };
 use reth_primitives::{Account, Bytecode};
<span class="term-fg31">-use reth_storage_api::{StateProofProvider, StorageRootProvider};</span>
<span class="term-fg32">+use reth_storage_api::{</span>
<span class="term-fg32">+    HashedPostStateProvider, HashedStorageProvider, KeyHasherProvider, StateProofProvider,</span>
<span class="term-fg32">+    StorageRootProvider,</span>
<span class="term-fg32">+};</span>
 use reth_storage_errors::provider::ProviderResult;
 use reth_trie::{
     updates::TrieUpdates, AccountProof, HashedPostState, HashedStorage, MultiProof,
<span class="term-fg36">@@ -38,12 +41,7 @@</span>     fn get_hashed_storage(&amp;self, address: Address) -&gt; HashedStorage {
         let bundle_state = self.block_execution_data_provider.execution_outcome().state();
         bundle_state
             .account(&amp;address)
<span class="term-fg31">-            .map(|account| {</span>
<span class="term-fg31">-                HashedStorage::from_plain_storage(</span>
<span class="term-fg31">-                    account.status,</span>
<span class="term-fg31">-                    account.storage.iter().map(|(slot, value)| (slot, &amp;value.present_value)),</span>
<span class="term-fg31">-                )</span>
<span class="term-fg31">-            })</span>
<span class="term-fg32">+            .map(|account| self.state_provider.hashed_storage(account))</span>
             .unwrap_or_default()
     }
 }
<span class="term-fg36">@@ -85,25 +83,25 @@</span>
 impl&lt;SP: StateProvider, EDP: ExecutionDataProvider&gt; StateRootProvider
     for BundleStateProvider&lt;SP, EDP&gt;
 {
<span class="term-fg31">-    fn state_root(&amp;self, hashed_state: HashedPostState) -&gt; ProviderResult&lt;B256&gt; {</span>
<span class="term-fg32">+    fn state_root_from_state(&amp;self, hashed_state: HashedPostState) -&gt; ProviderResult&lt;B256&gt; {</span>
         let bundle_state = self.block_execution_data_provider.execution_outcome().state();
<span class="term-fg31">-        let mut state = HashedPostState::from_bundle_state(&amp;bundle_state.state);</span>
<span class="term-fg32">+        let mut state = self.hashed_post_state(bundle_state);</span>
         state.extend(hashed_state);
<span class="term-fg31">-        self.state_provider.state_root(state)</span>
<span class="term-fg32">+        self.state_provider.state_root_from_state(state)</span>
     }
&nbsp;
     fn state_root_from_nodes(&amp;self, _input: TrieInput) -&gt; ProviderResult&lt;B256&gt; {
         unimplemented!()
     }
&nbsp;
<span class="term-fg31">-    fn state_root_with_updates(</span>
<span class="term-fg32">+    fn state_root_from_state_with_updates(</span>
         &amp;self,
         hashed_state: HashedPostState,
     ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {
         let bundle_state = self.block_execution_data_provider.execution_outcome().state();
<span class="term-fg31">-        let mut state = HashedPostState::from_bundle_state(&amp;bundle_state.state);</span>
<span class="term-fg32">+        let mut state = self.hashed_post_state(bundle_state);</span>
         state.extend(hashed_state);
<span class="term-fg31">-        self.state_provider.state_root_with_updates(state)</span>
<span class="term-fg32">+        self.state_provider.state_root_from_state_with_updates(state)</span>
     }
&nbsp;
     fn state_root_from_nodes_with_updates(
<span class="term-fg36">@@ -111,7 +109,7 @@</span>         &amp;self,
         mut input: TrieInput,
     ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {
         let bundle_state = self.block_execution_data_provider.execution_outcome().state();
<span class="term-fg31">-        input.prepend(HashedPostState::from_bundle_state(&amp;bundle_state.state));</span>
<span class="term-fg32">+        input.prepend(self.hashed_post_state(bundle_state));</span>
         self.state_provider.state_root_from_nodes_with_updates(input)
     }
 }
<span class="term-fg36">@@ -162,7 +160,7 @@</span>         address: Address,
         slots: &amp;[B256],
     ) -&gt; ProviderResult&lt;AccountProof&gt; {
         let bundle_state = self.block_execution_data_provider.execution_outcome().state();
<span class="term-fg31">-        input.prepend(HashedPostState::from_bundle_state(&amp;bundle_state.state));</span>
<span class="term-fg32">+        input.prepend(self.hashed_post_state(bundle_state));</span>
         self.state_provider.proof(input, address, slots)
     }
&nbsp;
<span class="term-fg36">@@ -172,7 +170,7 @@</span>         mut input: reth_trie::TrieInput,
         targets: HashMap&lt;B256, HashSet&lt;B256&gt;&gt;,
     ) -&gt; ProviderResult&lt;MultiProof&gt; {
         let bundle_state = self.block_execution_data_provider.execution_outcome().state();
<span class="term-fg31">-        input.prepend(HashedPostState::from_bundle_state(&amp;bundle_state.state));</span>
<span class="term-fg32">+        input.prepend(self.hashed_post_state(bundle_state));</span>
         self.state_provider.multiproof(input, targets)
     }
&nbsp;
<span class="term-fg36">@@ -182,8 +180,32 @@</span>         mut input: TrieInput,
         target: HashedPostState,
     ) -&gt; ProviderResult&lt;HashMap&lt;B256, Bytes&gt;&gt; {
         let bundle_state = self.block_execution_data_provider.execution_outcome().state();
<span class="term-fg31">-        input.prepend(HashedPostState::from_bundle_state(&amp;bundle_state.state));</span>
<span class="term-fg32">+        input.prepend(self.hashed_post_state(bundle_state));</span>
         self.state_provider.witness(input, target)
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;SP: StateProvider, EDP: ExecutionDataProvider&gt; HashedPostStateProvider</span>
<span class="term-fg32">+    for BundleStateProvider&lt;SP, EDP&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, bundle_state: &amp;revm::db::BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+        self.state_provider.hashed_post_state(bundle_state)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;SP: StateProvider, EDP: ExecutionDataProvider&gt; HashedStorageProvider</span>
<span class="term-fg32">+    for BundleStateProvider&lt;SP, EDP&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn hashed_storage(&amp;self, account: &amp;revm::db::BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+        self.state_provider.hashed_storage(account)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;SP: StateProvider, EDP: ExecutionDataProvider&gt; KeyHasherProvider</span>
<span class="term-fg32">+    for BundleStateProvider&lt;SP, EDP&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn hash_key(&amp;self, bytes: &amp;[u8]) -&gt; B256 {</span>
<span class="term-fg32">+        self.state_provider.hash_key(bytes)</span>
     }
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7b9de7ea128a45c66df625cf" role="button"
                       aria-expanded="false" aria-controls="id-7b9de7ea128a45c66df625cf">
                        <code>crates/storage/provider/src/providers/consistent_view.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/providers/consistent_view.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/provider/src/providers/consistent_view.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7b9de7ea128a45c66df625cf"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;consistent_view.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;consistent_view.rs</span>
<span class="term-fg1">index 4640f4603354070489105ced574f538c971bc2a3..479537f120cca3a0ae83f9303c9764533769a939 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;consistent_view.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;consistent_view.rs</span>
<span class="term-fg36">@@ -2,11 +2,11 @@</span> use crate::{BlockNumReader, DatabaseProviderFactory, HeaderProvider};
 use alloy_primitives::B256;
 use reth_errors::ProviderError;
 use reth_primitives::GotExpected;
<span class="term-fg31">-use reth_storage_api::{BlockReader, DBProvider};</span>
<span class="term-fg32">+use reth_storage_api::{BlockReader, DBProvider, StateCommitmentProvider};</span>
 use reth_storage_errors::provider::ProviderResult;
&nbsp;
 use reth_trie::HashedPostState;
<span class="term-fg31">-use reth_trie_db::DatabaseHashedPostState;</span>
<span class="term-fg32">+use reth_trie_db::{DatabaseHashedPostState, StateCommitment};</span>
&nbsp;
 pub use reth_storage_errors::provider::ConsistentViewError;
&nbsp;
<span class="term-fg36">@@ -33,7 +33,7 @@</span> }
&nbsp;
 impl&lt;Factory&gt; ConsistentDbView&lt;Factory&gt;
 where
<span class="term-fg31">-    Factory: DatabaseProviderFactory&lt;Provider: BlockReader&gt;,</span>
<span class="term-fg32">+    Factory: DatabaseProviderFactory&lt;Provider: BlockReader&gt; + StateCommitmentProvider,</span>
 {
     &#47;&#47;&#47; Creates new consistent database view.
     pub const fn new(factory: Factory, tip: Option&lt;B256&gt;) -&gt; Self {
<span class="term-fg36">@@ -59,7 +59,9 @@</span>             block_number == provider.last_block_number()?
         {
             Ok(HashedPostState::default())
         } else {
<span class="term-fg31">-            Ok(HashedPostState::from_reverts(provider.tx_ref(), block_number + 1)?)</span>
<span class="term-fg32">+            Ok(HashedPostState::from_reverts::&lt;</span>
<span class="term-fg32">+                &lt;Factory::StateCommitment as StateCommitment&gt;::KeyHasher,</span>
<span class="term-fg32">+            &gt;(provider.tx_ref(), block_number + 1)?)</span>
         }
     }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e27565ee89f573a8e947b4fb" role="button"
                       aria-expanded="false" aria-controls="id-e27565ee89f573a8e947b4fb">
                        <code>crates/storage/provider/src/providers/database/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/providers/database/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/provider/src/providers/database/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+24</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e27565ee89f573a8e947b4fb"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;database&#47;mod.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;database&#47;mod.rs</span>
<span class="term-fg1">index 3c22a1a73a23c6fad24f6e906f76c7d14d0959aa..bea6c8adde2870fdf03cea69da801766482ae7b2 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;database&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;database&#47;mod.rs</span>
<span class="term-fg36">@@ -3,9 +3,9 @@</span>     providers::{state::latest::LatestStateProvider, StaticFileProvider},
     to_range,
     traits::{BlockSource, ReceiptProvider},
     BlockHashReader, BlockNumReader, BlockReader, ChainSpecProvider, DatabaseProviderFactory,
<span class="term-fg31">-    EvmEnvProvider, HeaderProvider, HeaderSyncGap, HeaderSyncGapProvider, ProviderError,</span>
<span class="term-fg31">-    PruneCheckpointReader, StageCheckpointReader, StateProviderBox, StaticFileProviderFactory,</span>
<span class="term-fg31">-    TransactionVariant, TransactionsProvider, WithdrawalsProvider,</span>
<span class="term-fg32">+    EvmEnvProvider, HashedPostStateProvider, HeaderProvider, HeaderSyncGap, HeaderSyncGapProvider,</span>
<span class="term-fg32">+    ProviderError, PruneCheckpointReader, StageCheckpointReader, StateProviderBox,</span>
<span class="term-fg32">+    StaticFileProviderFactory, TransactionVariant, TransactionsProvider, WithdrawalsProvider,</span>
 };
 use alloy_consensus::Header;
 use alloy_eips::{
<span class="term-fg36">@@ -26,9 +26,16 @@</span>     TransactionMeta,
 };
 use reth_prune_types::{PruneCheckpoint, PruneModes, PruneSegment};
 use reth_stages_types::{StageCheckpoint, StageId};
<span class="term-fg31">-use reth_storage_api::{NodePrimitivesProvider, TryIntoHistoricalStateProvider};</span>
<span class="term-fg32">+use reth_storage_api::{</span>
<span class="term-fg32">+    NodePrimitivesProvider, StateCommitmentProvider, TryIntoHistoricalStateProvider,</span>
<span class="term-fg32">+};</span>
 use reth_storage_errors::provider::ProviderResult;
<span class="term-fg31">-use revm::primitives::{BlockEnv, CfgEnvWithHandlerCfg};</span>
<span class="term-fg32">+use reth_trie::HashedPostState;</span>
<span class="term-fg32">+use reth_trie_db::StateCommitment;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::BundleState,</span>
<span class="term-fg32">+    primitives::{BlockEnv, CfgEnvWithHandlerCfg},</span>
<span class="term-fg32">+};</span>
 use std::{
     ops::{RangeBounds, RangeInclusive},
     path::Path,
<span class="term-fg36">@@ -218,6 +225,10 @@</span>
     fn database_provider_rw(&amp;self) -&gt; ProviderResult&lt;Self::ProviderRW&gt; {
         self.provider_rw().map(|provider| provider.0)
     }
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;N: NodeTypesWithDB&gt; StateCommitmentProvider for ProviderFactory&lt;N&gt; {</span>
<span class="term-fg32">+    type StateCommitment = N::StateCommitment;</span>
 }
&nbsp;
 impl&lt;N: NodeTypesWithDB&gt; StaticFileProviderFactory for ProviderFactory&lt;N&gt; {
<span class="term-fg36">@@ -640,6 +651,14 @@</span>     }
&nbsp;
     fn get_prune_checkpoints(&amp;self) -&gt; ProviderResult&lt;Vec&lt;(PruneSegment, PruneCheckpoint)&gt;&gt; {
         self.provider()?.get_prune_checkpoints()
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;N: ProviderNodeTypes&gt; HashedPostStateProvider for ProviderFactory&lt;N&gt; {</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, bundle_state: &amp;BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+        HashedPostState::from_bundle_state::&lt;&lt;N::StateCommitment as StateCommitment&gt;::KeyHasher&gt;(</span>
<span class="term-fg32">+            bundle_state.state(),</span>
<span class="term-fg32">+        )</span>
     }
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c0ad613c05e4f5d39dffcb5c" role="button"
                       aria-expanded="false" aria-controls="id-c0ad613c05e4f5d39dffcb5c">
                        <code>crates/storage/provider/src/providers/database/provider.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/providers/database/provider.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/provider/src/providers/database/provider.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+37</span></div>
                            <div class="text-start"><span class="text-danger">-27</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c0ad613c05e4f5d39dffcb5c"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;database&#47;provider.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;database&#47;provider.rs</span>
<span class="term-fg1">index cfbe20cf4b448dd4ddcb6767f2d8df8c1634027f..a6237e26b43980df23e639c8eec4ac9d9b7c8c4f 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;database&#47;provider.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;database&#47;provider.rs</span>
<span class="term-fg36">@@ -13,11 +13,12 @@</span>     AccountReader, BlockBodyWriter, BlockExecutionWriter, BlockHashReader, BlockNumReader,
     BlockReader, BlockWriter, BundleStateInit, ChainStateBlockReader, ChainStateBlockWriter,
     DBProvider, EvmEnvProvider, HashingWriter, HeaderProvider, HeaderSyncGap,
     HeaderSyncGapProvider, HistoricalStateProvider, HistoricalStateProviderRef, HistoryWriter,
<span class="term-fg31">-    LatestStateProvider, LatestStateProviderRef, OriginalValuesKnown, ProviderError,</span>
<span class="term-fg31">-    PruneCheckpointReader, PruneCheckpointWriter, RevertsInit, StageCheckpointReader,</span>
<span class="term-fg31">-    StateCommitmentProvider, StateProviderBox, StateWriter, StaticFileProviderFactory, StatsReader,</span>
<span class="term-fg31">-    StorageLocation, StorageReader, StorageTrieWriter, TransactionVariant, TransactionsProvider,</span>
<span class="term-fg31">-    TransactionsProviderExt, TrieWriter, WithdrawalsProvider,</span>
<span class="term-fg32">+    KeyHasherProvider, LatestStateProvider, LatestStateProviderRef, OriginalValuesKnown,</span>
<span class="term-fg32">+    ProviderError, PruneCheckpointReader, PruneCheckpointWriter, RevertsInit,</span>
<span class="term-fg32">+    StageCheckpointReader, StateCommitmentProvider, StateProviderBox, StateRootProviderExt,</span>
<span class="term-fg32">+    StateWriter, StaticFileProviderFactory, StatsReader, StorageLocation, StorageReader,</span>
<span class="term-fg32">+    StorageTrieWriter, TransactionVariant, TransactionsProvider, TransactionsProviderExt,</span>
<span class="term-fg32">+    TrieWriter, WithdrawalsProvider,</span>
 };
 use alloy_consensus::Header;
 use alloy_eips::{
<span class="term-fg36">@@ -65,10 +66,11 @@</span> };
 use reth_storage_errors::provider::{ProviderResult, RootMismatch};
 use reth_trie::{
     prefix_set::{PrefixSet, PrefixSetMut, TriePrefixSets},
<span class="term-fg32">+    unpack_nibbles,</span>
     updates::{StorageTrieUpdates, TrieUpdates},
<span class="term-fg31">-    HashedPostStateSorted, Nibbles, StateRoot, StoredNibbles,</span>
<span class="term-fg32">+    HashedPostStateSorted, KeyHasher, StoredNibbles,</span>
 };
<span class="term-fg31">-use reth_trie_db::{DatabaseStateRoot, DatabaseStorageTrieCursor};</span>
<span class="term-fg32">+use reth_trie_db::{DatabaseStorageTrieCursor, StateCommitment};</span>
 use revm::{
     db::states::{PlainStateReverts, PlainStorageChangeset, PlainStorageRevert, StateChangeset},
     primitives::{BlockEnv, CfgEnvWithHandlerCfg},
<span class="term-fg36">@@ -277,7 +279,7 @@</span>         let hashed_addresses = self.unwind_account_hashing(changed_accounts.iter())?;
         let mut account_prefix_set = PrefixSetMut::with_capacity(hashed_addresses.len());
         let mut destroyed_accounts = HashSet::default();
         for (hashed_address, account) in hashed_addresses {
<span class="term-fg31">-            account_prefix_set.insert(Nibbles::unpack(hashed_address));</span>
<span class="term-fg32">+            account_prefix_set.insert(unpack_nibbles(hashed_address));</span>
             if account.is_none() {
                 destroyed_accounts.insert(hashed_address);
             }
<span class="term-fg36">@@ -298,10 +300,10 @@</span>         &#47;&#47; sets.
         let mut storage_prefix_sets = HashMap::&lt;B256, PrefixSet&gt;::default();
         let storage_entries = self.unwind_storage_hashing(changed_storages.iter().copied())?;
         for (hashed_address, hashed_slots) in storage_entries {
<span class="term-fg31">-            account_prefix_set.insert(Nibbles::unpack(hashed_address));</span>
<span class="term-fg32">+            account_prefix_set.insert(unpack_nibbles(hashed_address));</span>
             let mut storage_prefix_set = PrefixSetMut::with_capacity(hashed_slots.len());
             for slot in hashed_slots {
<span class="term-fg31">-                storage_prefix_set.insert(Nibbles::unpack(slot));</span>
<span class="term-fg32">+                storage_prefix_set.insert(unpack_nibbles(slot));</span>
             }
             storage_prefix_sets.insert(hashed_address, storage_prefix_set.freeze());
         }
<span class="term-fg36">@@ -317,10 +319,8 @@</span>             account_prefix_set: account_prefix_set.freeze(),
             storage_prefix_sets,
             destroyed_accounts,
         };
<span class="term-fg31">-        let (new_state_root, trie_updates) = StateRoot::from_tx(&amp;self.tx)</span>
<span class="term-fg31">-            .with_prefix_sets(prefix_sets)</span>
<span class="term-fg31">-            .root_with_updates()</span>
<span class="term-fg31">-            .map_err(Into::&lt;reth_db::DatabaseError&gt;::into)?;</span>
<span class="term-fg32">+        let (new_state_root, trie_updates) = LatestStateProviderRef::new(self)</span>
<span class="term-fg32">+            .state_root_from_prefix_sets_with_updates(prefix_sets)?;</span>
&nbsp;
         let parent_number = range.start().saturating_sub(1);
         let parent_state_root = self
<span class="term-fg36">@@ -418,6 +418,12 @@</span> }
&nbsp;
 impl&lt;TX: DbTx + &#39;static, N: NodeTypes&gt; StateCommitmentProvider for DatabaseProvider&lt;TX, N&gt; {
     type StateCommitment = N::StateCommitment;
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;TX: DbTx + &#39;static, N: NodeTypes&gt; KeyHasherProvider for DatabaseProvider&lt;TX, N&gt; {</span>
<span class="term-fg32">+    fn hash_key(&amp;self, bytes: &amp;[u8]) -&gt; B256 {</span>
<span class="term-fg32">+        &lt;&lt;N::StateCommitment as StateCommitment&gt;::KeyHasher as KeyHasher&gt;::hash_key(bytes)</span>
<span class="term-fg32">+    }</span>
 }
&nbsp;
 impl&lt;Tx: DbTx + DbTxMut + &#39;static, N: NodeTypesForProvider + &#39;static&gt; DatabaseProvider&lt;Tx, N&gt; {
<span class="term-fg36">@@ -2383,7 +2389,7 @@</span>         &#47;&#47; Note that collecting and then reversing the order is necessary to ensure that the
         &#47;&#47; changes are applied in the correct order.
         let hashed_accounts = changesets
             .into_iter()
<span class="term-fg31">-            .map(|(_, e)| (keccak256(e.address), e.info))</span>
<span class="term-fg32">+            .map(|(_, e)| (self.hash_key(e.address.as_ref()), e.info))</span>
             .collect::&lt;Vec&lt;_&gt;&gt;()
             .into_iter()
             .rev()
<span class="term-fg36">@@ -2419,8 +2425,10 @@</span>         &amp;self,
         changesets: impl IntoIterator&lt;Item = (Address, Option&lt;Account&gt;)&gt;,
     ) -&gt; ProviderResult&lt;BTreeMap&lt;B256, Option&lt;Account&gt;&gt;&gt; {
         let mut hashed_accounts_cursor = self.tx.cursor_write::&lt;tables::HashedAccounts&gt;()?;
<span class="term-fg31">-        let hashed_accounts =</span>
<span class="term-fg31">-            changesets.into_iter().map(|(ad, ac)| (keccak256(ad), ac)).collect::&lt;BTreeMap&lt;_, _&gt;&gt;();</span>
<span class="term-fg32">+        let hashed_accounts = changesets</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|(ad, ac)| (self.hash_key(ad.as_ref()), ac))</span>
<span class="term-fg32">+            .collect::&lt;BTreeMap&lt;_, _&gt;&gt;();</span>
         for (hashed_address, account) in &amp;hashed_accounts {
             if let Some(account) = account {
                 hashed_accounts_cursor.upsert(*hashed_address, *account)?;
<span class="term-fg36">@@ -2439,7 +2447,11 @@</span>         &#47;&#47; Aggregate all block changesets and make list of accounts that have been changed.
         let mut hashed_storages = changesets
             .into_iter()
             .map(|(BlockNumberAddress((_, address)), storage_entry)| {
<span class="term-fg31">-                (keccak256(address), keccak256(storage_entry.key), storage_entry.value)</span>
<span class="term-fg32">+                (</span>
<span class="term-fg32">+                    self.hash_key(address.as_ref()),</span>
<span class="term-fg32">+                    self.hash_key(storage_entry.key.as_ref()),</span>
<span class="term-fg32">+                    storage_entry.value,</span>
<span class="term-fg32">+                )</span>
             })
             .collect::&lt;Vec&lt;_&gt;&gt;();
         hashed_storages.sort_by_key(|(ha, hk, _)| (*ha, *hk));
<span class="term-fg36">@@ -2486,10 +2498,10 @@</span>         &#47;&#47; hash values
         let hashed_storages =
             storages.into_iter().fold(BTreeMap::new(), |mut map, (address, storage)| {
                 let storage = storage.into_iter().fold(BTreeMap::new(), |mut map, entry| {
<span class="term-fg31">-                    map.insert(keccak256(entry.key), entry.value);</span>
<span class="term-fg32">+                    map.insert(self.hash_key(entry.key.as_ref()), entry.value);</span>
                     map
                 });
<span class="term-fg31">-                map.insert(keccak256(address), storage);</span>
<span class="term-fg32">+                map.insert(self.hash_key(address.as_ref()), storage);</span>
                 map
             });
&nbsp;
<span class="term-fg36">@@ -2540,12 +2552,12 @@</span>             let lists = self.changed_storages_with_range(range.clone())?;
             let storages = self.plain_state_storages(lists)?;
             let storage_entries = self.insert_storage_for_hashing(storages)?;
             for (hashed_address, hashed_slots) in storage_entries {
<span class="term-fg31">-                account_prefix_set.insert(Nibbles::unpack(hashed_address));</span>
<span class="term-fg32">+                account_prefix_set.insert(unpack_nibbles(hashed_address));</span>
                 for slot in hashed_slots {
                     storage_prefix_sets
                         .entry(hashed_address)
                         .or_default()
<span class="term-fg31">-                        .insert(Nibbles::unpack(slot));</span>
<span class="term-fg32">+                        .insert(unpack_nibbles(slot));</span>
                 }
             }
         }
<span class="term-fg36">@@ -2557,7 +2569,7 @@</span>             let lists = self.changed_accounts_with_range(range.clone())?;
             let accounts = self.basic_accounts(lists)?;
             let hashed_addresses = self.insert_account_for_hashing(accounts)?;
             for (hashed_address, account) in hashed_addresses {
<span class="term-fg31">-                account_prefix_set.insert(Nibbles::unpack(hashed_address));</span>
<span class="term-fg32">+                account_prefix_set.insert(unpack_nibbles(hashed_address));</span>
                 if account.is_none() {
                     destroyed_accounts.insert(hashed_address);
                 }
<span class="term-fg36">@@ -2577,10 +2589,8 @@</span>                     .map(|(k, v)| (k, v.freeze()))
                     .collect(),
                 destroyed_accounts,
             };
<span class="term-fg31">-            let (state_root, trie_updates) = StateRoot::from_tx(&amp;self.tx)</span>
<span class="term-fg31">-                .with_prefix_sets(prefix_sets)</span>
<span class="term-fg31">-                .root_with_updates()</span>
<span class="term-fg31">-                .map_err(Into::&lt;reth_db::DatabaseError&gt;::into)?;</span>
<span class="term-fg32">+            let (state_root, trie_updates) = LatestStateProviderRef::new(self)</span>
<span class="term-fg32">+                .state_root_from_prefix_sets_with_updates(prefix_sets)?;</span>
             if state_root != expected_state_root {
                 return Err(ProviderError::StateRootMismatch(Box::new(RootMismatch {
                     root: GotExpected { got: state_root, expected: expected_state_root },</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4e60e4e9a319daad82ff2a7e" role="button"
                       aria-expanded="false" aria-controls="id-4e60e4e9a319daad82ff2a7e">
                        <code>crates/storage/provider/src/providers/state/historical.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/providers/state/historical.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/provider/src/providers/state/historical.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+117</span></div>
                            <div class="text-start"><span class="text-danger">-21</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4e60e4e9a319daad82ff2a7e"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;historical.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;historical.rs</span>
<span class="term-fg1">index ad36a4a5ab3e1e199a172f2446a1f1dd9dd5ddc8..dfc7aed7166261f68a3d59ecef700cea9a81a19c 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;historical.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;historical.rs</span>
<span class="term-fg36">@@ -1,6 +1,6 @@</span>
 use crate::{
     providers::state::macros::delegate_provider_impls, AccountReader, BlockHashReader,
<span class="term-fg31">-    ProviderError, StateProvider, StateRootProvider,</span>
<span class="term-fg32">+    HashedPostStateProvider, ProviderError, StateProvider, StateRootProvider,</span>
 };
 use alloy_eips::merge::EPOCH_SLOTS;
 use alloy_primitives::{
<span class="term-fg36">@@ -16,19 +16,20 @@</span>     transaction::DbTx,
 };
 use reth_primitives::{Account, Bytecode};
 use reth_storage_api::{
<span class="term-fg31">-    BlockNumReader, DBProvider, StateCommitmentProvider, StateProofProvider, StorageRootProvider,</span>
<span class="term-fg32">+    BlockNumReader, DBProvider, HashedStorageProvider, KeyHasherProvider, StateCommitmentProvider,</span>
<span class="term-fg32">+    StateProofProvider, StorageRootProvider,</span>
 };
 use reth_storage_errors::provider::ProviderResult;
 use reth_trie::{
     proof::{Proof, StorageProof},
     updates::TrieUpdates,
     witness::TrieWitness,
<span class="term-fg31">-    AccountProof, HashedPostState, HashedStorage, MultiProof, StateRoot, StorageMultiProof,</span>
<span class="term-fg32">+    AccountProof, HashedPostState, HashedStorage, KeyHasher, MultiProof, StorageMultiProof,</span>
     StorageRoot, TrieInput,
 };
 use reth_trie_db::{
     DatabaseHashedPostState, DatabaseHashedStorage, DatabaseProof, DatabaseStateRoot,
<span class="term-fg31">-    DatabaseStorageProof, DatabaseStorageRoot, DatabaseTrieWitness,</span>
<span class="term-fg32">+    DatabaseStorageProof, DatabaseStorageRoot, DatabaseTrieWitness, StateCommitment,</span>
 };
 use std::fmt::Debug;
&nbsp;
<span class="term-fg36">@@ -136,7 +137,9 @@</span>                 &quot;Attempt to calculate state root for an old block might result in OOM&quot;
             );
         }
&nbsp;
<span class="term-fg31">-        Ok(HashedPostState::from_reverts(self.tx(), self.block_number)?)</span>
<span class="term-fg32">+        Ok(HashedPostState::from_reverts::&lt;</span>
<span class="term-fg32">+            &lt;Provider::StateCommitment as StateCommitment&gt;::KeyHasher,</span>
<span class="term-fg32">+        &gt;(self.tx(), self.block_number)?)</span>
     }
&nbsp;
     &#47;&#47;&#47; Retrieve revert hashed storage for this history provider and target address.
<span class="term-fg36">@@ -153,7 +156,13 @@</span>                 &quot;Attempt to calculate storage root for an old block might result in OOM&quot;
             );
         }
&nbsp;
<span class="term-fg31">-        Ok(HashedStorage::from_reverts(self.tx(), address, self.block_number)?)</span>
<span class="term-fg32">+        Ok(</span>
<span class="term-fg32">+            HashedStorage::from_reverts::&lt;&lt;Provider::StateCommitment as StateCommitment&gt;::KeyHasher&gt;(</span>
<span class="term-fg32">+                self.tx(),</span>
<span class="term-fg32">+                address,</span>
<span class="term-fg32">+                self.block_number,</span>
<span class="term-fg32">+            )?,</span>
<span class="term-fg32">+        )</span>
     }
&nbsp;
     fn history_info&lt;T, K&gt;(
<span class="term-fg36">@@ -288,27 +297,38 @@</span>
 impl&lt;Provider: DBProvider + BlockNumReader + StateCommitmentProvider&gt; StateRootProvider
     for HistoricalStateProviderRef&lt;&#39;_, Provider&gt;
 {
<span class="term-fg31">-    fn state_root(&amp;self, hashed_state: HashedPostState) -&gt; ProviderResult&lt;B256&gt; {</span>
<span class="term-fg32">+    fn state_root_from_state(&amp;self, hashed_state: HashedPostState) -&gt; ProviderResult&lt;B256&gt; {</span>
         let mut revert_state = self.revert_state()?;
         revert_state.extend(hashed_state);
<span class="term-fg31">-        StateRoot::overlay_root(self.tx(), revert_state)</span>
<span class="term-fg31">-            .map_err(|err| ProviderError::Database(err.into()))</span>
<span class="term-fg32">+        &lt;Provider::StateCommitment as StateCommitment&gt;::StateRoot::overlay_root(</span>
<span class="term-fg32">+            self.tx(),</span>
<span class="term-fg32">+            revert_state,</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+        .map_err(|err| ProviderError::Database(err.into()))</span>
     }
&nbsp;
     fn state_root_from_nodes(&amp;self, mut input: TrieInput) -&gt; ProviderResult&lt;B256&gt; {
         input.prepend(self.revert_state()?);
<span class="term-fg31">-        StateRoot::overlay_root_from_nodes(self.tx(), input)</span>
<span class="term-fg31">-            .map_err(|err| ProviderError::Database(err.into()))</span>
<span class="term-fg32">+        &lt;Provider::StateCommitment as StateCommitment&gt;::StateRoot::overlay_root_from_nodes(</span>
<span class="term-fg32">+            self.tx(),</span>
<span class="term-fg32">+            input,</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+        .map_err(|err| ProviderError::Database(err.into()))</span>
     }
&nbsp;
<span class="term-fg31">-    fn state_root_with_updates(</span>
<span class="term-fg32">+    fn state_root_from_state_with_updates(</span>
         &amp;self,
         hashed_state: HashedPostState,
     ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {
         let mut revert_state = self.revert_state()?;
         revert_state.extend(hashed_state);
<span class="term-fg31">-        StateRoot::overlay_root_with_updates(self.tx(), revert_state)</span>
<span class="term-fg31">-            .map_err(|err| ProviderError::Database(err.into()))</span>
<span class="term-fg32">+        let (root, updates, _state_sorted) =</span>
<span class="term-fg32">+            &lt;Provider::StateCommitment as StateCommitment&gt;::StateRoot::overlay_root_with_updates(</span>
<span class="term-fg32">+                self.tx(),</span>
<span class="term-fg32">+                revert_state,</span>
<span class="term-fg32">+            )</span>
<span class="term-fg32">+            .map_err(|err| ProviderError::Database(err.into()))?;</span>
<span class="term-fg32">+        Ok((root, updates))</span>
     }
&nbsp;
     fn state_root_from_nodes_with_updates(
<span class="term-fg36">@@ -316,7 +336,7 @@</span>         &amp;self,
         mut input: TrieInput,
     ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {
         input.prepend(self.revert_state()?);
<span class="term-fg31">-        StateRoot::overlay_root_from_nodes_with_updates(self.tx(), input)</span>
<span class="term-fg32">+        &lt;Provider::StateCommitment as StateCommitment&gt;::StateRoot::overlay_root_from_nodes_with_updates(self.tx(), input)</span>
             .map_err(|err| ProviderError::Database(err.into()))
     }
 }
<span class="term-fg36">@@ -394,6 +414,34 @@</span>         TrieWitness::overlay_witness(self.tx(), input, target).map_err(Into::&lt;ProviderError&gt;::into)
     }
 }
&nbsp;
<span class="term-fg32">+impl&lt;Provider: StateCommitmentProvider&gt; HashedPostStateProvider</span>
<span class="term-fg32">+    for HistoricalStateProviderRef&lt;&#39;_, Provider&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, bundle_state: &amp;revm::db::BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+        HashedPostState::from_bundle_state::&lt;</span>
<span class="term-fg32">+            &lt;Provider::StateCommitment as StateCommitment&gt;::KeyHasher,</span>
<span class="term-fg32">+        &gt;(bundle_state.state())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Provider: StateCommitmentProvider&gt; HashedStorageProvider</span>
<span class="term-fg32">+    for HistoricalStateProviderRef&lt;&#39;_, Provider&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn hashed_storage(&amp;self, account: &amp;revm::db::BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+        HashedStorage::from_bundle_account::&lt;</span>
<span class="term-fg32">+            &lt;Provider::StateCommitment as StateCommitment&gt;::KeyHasher,</span>
<span class="term-fg32">+        &gt;(account)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Provider: StateCommitmentProvider&gt; KeyHasherProvider</span>
<span class="term-fg32">+    for HistoricalStateProviderRef&lt;&#39;_, Provider&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn hash_key(&amp;self, bytes: &amp;[u8]) -&gt; B256 {</span>
<span class="term-fg32">+        &lt;&lt;Provider::StateCommitment as StateCommitment&gt;::KeyHasher as KeyHasher&gt;::hash_key(bytes)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 impl&lt;Provider: DBProvider + BlockNumReader + BlockHashReader + StateCommitmentProvider&gt;
     StateProvider for HistoricalStateProviderRef&lt;&#39;_, Provider&gt;
 {
<span class="term-fg36">@@ -433,6 +481,12 @@</span>         self.tx().get::&lt;tables::Bytecodes&gt;(code_hash).map_err(Into::into)
     }
 }
&nbsp;
<span class="term-fg32">+impl&lt;Provider: StateCommitmentProvider&gt; StateCommitmentProvider</span>
<span class="term-fg32">+    for HistoricalStateProviderRef&lt;&#39;_, Provider&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    type StateCommitment = Provider::StateCommitment;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47;&#47; State provider for a given block number.
 &#47;&#47;&#47; For more detailed description, see [`HistoricalStateProviderRef`].
 #[derive(Debug)]
<span class="term-fg36">@@ -482,6 +536,12 @@</span>         )
     }
 }
&nbsp;
<span class="term-fg32">+impl&lt;Provider: StateCommitmentProvider&gt; StateCommitmentProvider</span>
<span class="term-fg32">+    for HistoricalStateProvider&lt;Provider&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    type StateCommitment = Provider::StateCommitment;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; Delegates all provider impls to [HistoricalStateProviderRef]
 delegate_provider_impls!(HistoricalStateProvider&lt;Provider&gt; where [Provider: DBProvider + BlockNumReader + BlockHashReader + StateCommitmentProvider]);
&nbsp;
<span class="term-fg36">@@ -566,13 +626,49 @@</span>             BlockNumberList::new([4]).unwrap(),
         )
         .unwrap();
&nbsp;
<span class="term-fg31">-        let acc_plain = Account { nonce: 100, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg31">-        let acc_at15 = Account { nonce: 15, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg31">-        let acc_at10 = Account { nonce: 10, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg31">-        let acc_at7 = Account { nonce: 7, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg31">-        let acc_at3 = Account { nonce: 3, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg32">+        let acc_plain = Account {</span>
<span class="term-fg32">+            nonce: 100,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let acc_at15 = Account {</span>
<span class="term-fg32">+            nonce: 15,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let acc_at10 = Account {</span>
<span class="term-fg32">+            nonce: 10,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let acc_at7 = Account {</span>
<span class="term-fg32">+            nonce: 7,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let acc_at3 = Account {</span>
<span class="term-fg32">+            nonce: 3,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
&nbsp;
<span class="term-fg31">-        let higher_acc_plain = Account { nonce: 4, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg32">+        let higher_acc_plain = Account {</span>
<span class="term-fg32">+            nonce: 4,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
&nbsp;
         &#47;&#47; setup
         tx.put::&lt;tables::AccountChangeSets&gt;(1, AccountBeforeTx { address: ADDRESS, info: None })</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-954ac0ad929abddc60a17ea9" role="button"
                       aria-expanded="false" aria-controls="id-954ac0ad929abddc60a17ea9">
                        <code>crates/storage/provider/src/providers/state/latest.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/providers/state/latest.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/provider/src/providers/state/latest.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+120</span></div>
                            <div class="text-start"><span class="text-danger">-14</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-954ac0ad929abddc60a17ea9"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;latest.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;latest.rs</span>
<span class="term-fg1">index a2ec4972d10510316cbb0743531c752f25a28dac..e05313427c67ee0238e4d433f6e5feed8b928d1a 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;latest.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;latest.rs</span>
<span class="term-fg36">@@ -1,6 +1,6 @@</span>
 use crate::{
     providers::state::macros::delegate_provider_impls, AccountReader, BlockHashReader,
<span class="term-fg31">-    StateProvider, StateRootProvider,</span>
<span class="term-fg32">+    HashedPostStateProvider, StateProvider, StateRootProvider,</span>
 };
 use alloy_primitives::{
     map::{HashMap, HashSet},
<span class="term-fg36">@@ -10,19 +10,20 @@</span> use reth_db::tables;
 use reth_db_api::{cursor::DbDupCursorRO, transaction::DbTx};
 use reth_primitives::{Account, Bytecode};
 use reth_storage_api::{
<span class="term-fg31">-    DBProvider, StateCommitmentProvider, StateProofProvider, StorageRootProvider,</span>
<span class="term-fg32">+    DBProvider, HashedStorageProvider, KeyHasherProvider, StateCommitmentProvider,</span>
<span class="term-fg32">+    StateProofProvider, StateRootProviderExt, StorageRootProvider,</span>
 };
 use reth_storage_errors::provider::{ProviderError, ProviderResult};
 use reth_trie::{
     proof::{Proof, StorageProof},
     updates::TrieUpdates,
     witness::TrieWitness,
<span class="term-fg31">-    AccountProof, HashedPostState, HashedStorage, MultiProof, StateRoot, StorageMultiProof,</span>
<span class="term-fg32">+    AccountProof, HashedPostState, HashedStorage, KeyHasher, MultiProof, StorageMultiProof,</span>
     StorageRoot, TrieInput,
 };
 use reth_trie_db::{
     DatabaseProof, DatabaseStateRoot, DatabaseStorageProof, DatabaseStorageRoot,
<span class="term-fg31">-    DatabaseTrieWitness,</span>
<span class="term-fg32">+    DatabaseTrieWitness, StateCommitment,</span>
 };
&nbsp;
 &#47;&#47;&#47; State provider over latest state that takes tx reference.
<span class="term-fg36">@@ -67,33 +68,102 @@</span>
 impl&lt;Provider: DBProvider + StateCommitmentProvider&gt; StateRootProvider
     for LatestStateProviderRef&lt;&#39;_, Provider&gt;
 {
<span class="term-fg31">-    fn state_root(&amp;self, hashed_state: HashedPostState) -&gt; ProviderResult&lt;B256&gt; {</span>
<span class="term-fg31">-        StateRoot::overlay_root(self.tx(), hashed_state)</span>
<span class="term-fg31">-            .map_err(|err| ProviderError::Database(err.into()))</span>
<span class="term-fg32">+    fn state_root_from_state(&amp;self, hashed_state: HashedPostState) -&gt; ProviderResult&lt;B256&gt; {</span>
<span class="term-fg32">+        &lt;Provider::StateCommitment as StateCommitment&gt;::StateRoot::overlay_root(</span>
<span class="term-fg32">+            self.tx(),</span>
<span class="term-fg32">+            hashed_state,</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+        .map_err(|err| ProviderError::Database(err.into()))</span>
     }
&nbsp;
     fn state_root_from_nodes(&amp;self, input: TrieInput) -&gt; ProviderResult&lt;B256&gt; {
<span class="term-fg31">-        StateRoot::overlay_root_from_nodes(self.tx(), input)</span>
<span class="term-fg31">-            .map_err(|err| ProviderError::Database(err.into()))</span>
<span class="term-fg32">+        &lt;Provider::StateCommitment as StateCommitment&gt;::StateRoot::overlay_root_from_nodes(</span>
<span class="term-fg32">+            self.tx(),</span>
<span class="term-fg32">+            input,</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+        .map_err(|err| ProviderError::Database(err.into()))</span>
     }
&nbsp;
<span class="term-fg31">-    fn state_root_with_updates(</span>
<span class="term-fg32">+    fn state_root_from_state_with_updates(</span>
         &amp;self,
         hashed_state: HashedPostState,
     ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {
<span class="term-fg31">-        StateRoot::overlay_root_with_updates(self.tx(), hashed_state)</span>
<span class="term-fg31">-            .map_err(|err| ProviderError::Database(err.into()))</span>
<span class="term-fg32">+        let (root, updates, _state_sorted) =</span>
<span class="term-fg32">+            &lt;Provider::StateCommitment as StateCommitment&gt;::StateRoot::overlay_root_with_updates(</span>
<span class="term-fg32">+                self.tx(),</span>
<span class="term-fg32">+                hashed_state,</span>
<span class="term-fg32">+            )</span>
<span class="term-fg32">+            .map_err(|err| ProviderError::Database(err.into()))?;</span>
<span class="term-fg32">+        Ok((root, updates))</span>
     }
&nbsp;
     fn state_root_from_nodes_with_updates(
         &amp;self,
         input: TrieInput,
     ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {
<span class="term-fg31">-        StateRoot::overlay_root_from_nodes_with_updates(self.tx(), input)</span>
<span class="term-fg32">+        &lt;Provider::StateCommitment as StateCommitment&gt;::StateRoot::overlay_root_from_nodes_with_updates(self.tx(), input)</span>
             .map_err(|err| ProviderError::Database(err.into()))
     }
 }
&nbsp;
<span class="term-fg32">+impl&lt;Provider: DBProvider + StateCommitmentProvider&gt; StateRootProviderExt</span>
<span class="term-fg32">+    for LatestStateProviderRef&lt;&#39;_, Provider&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn state_root(&amp;self) -&gt; ProviderResult&lt;B256&gt; {</span>
<span class="term-fg32">+        &lt;Provider::StateCommitment as StateCommitment&gt;::StateRoot::root(self.tx())</span>
<span class="term-fg32">+            .map_err(|err| ProviderError::Database(err.into()))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn state_root_with_updates(&amp;self) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {</span>
<span class="term-fg32">+        &lt;Provider::StateCommitment as StateCommitment&gt;::StateRoot::root_with_updates(self.tx())</span>
<span class="term-fg32">+            .map_err(|err| ProviderError::Database(err.into()))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn incremental_state_root_with_updates(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        range: std::ops::RangeInclusive&lt;BlockNumber&gt;,</span>
<span class="term-fg32">+    ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {</span>
<span class="term-fg32">+        &lt;Provider::StateCommitment as StateCommitment&gt;::StateRoot::incremental_root_with_updates(</span>
<span class="term-fg32">+            self.tx(),</span>
<span class="term-fg32">+            range,</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+        .map_err(|err| ProviderError::Database(err.into()))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn state_root_from_prefix_sets_with_updates(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        prefix_set: reth_trie::prefix_set::TriePrefixSets,</span>
<span class="term-fg32">+    ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {</span>
<span class="term-fg32">+        &lt;Provider::StateCommitment as StateCommitment&gt;::StateRoot::root_from_prefix_sets_with_updates(</span>
<span class="term-fg32">+            self.tx(),</span>
<span class="term-fg32">+            prefix_set,</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+        .map_err(|err| ProviderError::Database(err.into()))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn state_root_with_progress(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        state: Option&lt;reth_trie::IntermediateStateRootState&gt;,</span>
<span class="term-fg32">+    ) -&gt; ProviderResult&lt;reth_trie::StateRootProgress&gt; {</span>
<span class="term-fg32">+        &lt;Provider::StateCommitment as StateCommitment&gt;::StateRoot::root_with_progress(</span>
<span class="term-fg32">+            self.tx(),</span>
<span class="term-fg32">+            state,</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+        .map_err(|err| ProviderError::Database(err.into()))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn state_root_from_state_with_updates_and_sorted_state(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        hashed_state: HashedPostState,</span>
<span class="term-fg32">+    ) -&gt; ProviderResult&lt;(B256, TrieUpdates, reth_trie::HashedPostStateSorted)&gt; {</span>
<span class="term-fg32">+        &lt;Provider::StateCommitment as StateCommitment&gt;::StateRoot::overlay_root_with_updates(</span>
<span class="term-fg32">+            self.tx(),</span>
<span class="term-fg32">+            hashed_state,</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+        .map_err(|err| ProviderError::Database(err.into()))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 impl&lt;Provider: DBProvider + StateCommitmentProvider&gt; StorageRootProvider
     for LatestStateProviderRef&lt;&#39;_, Provider&gt;
 {
<span class="term-fg36">@@ -157,6 +227,32 @@</span>         TrieWitness::overlay_witness(self.tx(), input, target).map_err(Into::&lt;ProviderError&gt;::into)
     }
 }
&nbsp;
<span class="term-fg32">+impl&lt;Provider: DBProvider + StateCommitmentProvider&gt; HashedPostStateProvider</span>
<span class="term-fg32">+    for LatestStateProviderRef&lt;&#39;_, Provider&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, bundle_state: &amp;revm::db::BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+        HashedPostState::from_bundle_state::&lt;</span>
<span class="term-fg32">+            &lt;Provider::StateCommitment as StateCommitment&gt;::KeyHasher,</span>
<span class="term-fg32">+        &gt;(bundle_state.state())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Provider: StateCommitmentProvider + Send + Sync&gt; HashedStorageProvider</span>
<span class="term-fg32">+    for LatestStateProviderRef&lt;&#39;_, Provider&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn hashed_storage&lt;&#39;a&gt;(&amp;self, account: &amp;revm::db::BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+        HashedStorage::from_bundle_account::&lt;</span>
<span class="term-fg32">+            &lt;Provider::StateCommitment as StateCommitment&gt;::KeyHasher,</span>
<span class="term-fg32">+        &gt;(account)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Provider: StateCommitmentProvider&gt; KeyHasherProvider for LatestStateProviderRef&lt;&#39;_, Provider&gt; {</span>
<span class="term-fg32">+    fn hash_key(&amp;self, bytes: &amp;[u8]) -&gt; B256 {</span>
<span class="term-fg32">+        &lt;&lt;Provider::StateCommitment as StateCommitment&gt;::KeyHasher as KeyHasher&gt;::hash_key(bytes)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 impl&lt;Provider: DBProvider + BlockHashReader + StateCommitmentProvider&gt; StateProvider
     for LatestStateProviderRef&lt;&#39;_, Provider&gt;
 {
<span class="term-fg36">@@ -181,11 +277,17 @@</span>         self.tx().get::&lt;tables::Bytecodes&gt;(code_hash).map_err(Into::into)
     }
 }
&nbsp;
<span class="term-fg32">+impl&lt;Provider: StateCommitmentProvider&gt; StateCommitmentProvider</span>
<span class="term-fg32">+    for LatestStateProviderRef&lt;&#39;_, Provider&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    type StateCommitment = Provider::StateCommitment;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47;&#47; State provider for the latest state.
 #[derive(Debug)]
 pub struct LatestStateProvider&lt;Provider&gt;(Provider);
&nbsp;
<span class="term-fg31">-impl&lt;Provider: DBProvider&gt; LatestStateProvider&lt;Provider&gt; {</span>
<span class="term-fg32">+impl&lt;Provider: DBProvider + StateCommitmentProvider&gt; LatestStateProvider&lt;Provider&gt; {</span>
     &#47;&#47;&#47; Create new state provider
     pub const fn new(db: Provider) -&gt; Self {
         Self(db)
<span class="term-fg36">@@ -196,6 +298,10 @@</span>     #[inline(always)]
     const fn as_ref(&amp;self) -&gt; LatestStateProviderRef&lt;&#39;_, Provider&gt; {
         LatestStateProviderRef::new(&amp;self.0)
     }
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;Provider: StateCommitmentProvider&gt; StateCommitmentProvider for LatestStateProvider&lt;Provider&gt; {</span>
<span class="term-fg32">+    type StateCommitment = Provider::StateCommitment;</span>
 }
&nbsp;
 &#47;&#47; Delegates all provider impls to [LatestStateProviderRef]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1261e58a21b11b3af4a440eb" role="button"
                       aria-expanded="false" aria-controls="id-1261e58a21b11b3af4a440eb">
                        <code>crates/storage/provider/src/providers/state/macros.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/providers/state/macros.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/provider/src/providers/state/macros.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1261e58a21b11b3af4a440eb"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;macros.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;macros.rs</span>
<span class="term-fg1">index f2648fb15e6a247ac0612d018b43b8ed209fa2bd..ba2f477efd268f3379d6f7e31ce27c0a75da24b2 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;macros.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;macros.rs</span>
<span class="term-fg36">@@ -42,9 +42,9 @@</span>                 fn storage(&amp;self, account: alloy_primitives::Address, storage_key: alloy_primitives::StorageKey) -&gt; reth_storage_errors::provider::ProviderResult&lt;Option&lt;alloy_primitives::StorageValue&gt;&gt;;
                 fn bytecode_by_hash(&amp;self, code_hash: alloy_primitives::B256) -&gt; reth_storage_errors::provider::ProviderResult&lt;Option&lt;reth_primitives::Bytecode&gt;&gt;;
             }
             StateRootProvider $(where [$($generics)*])? {
<span class="term-fg31">-                fn state_root(&amp;self, state: reth_trie::HashedPostState) -&gt; reth_storage_errors::provider::ProviderResult&lt;alloy_primitives::B256&gt;;</span>
<span class="term-fg32">+                fn state_root_from_state(&amp;self, state: reth_trie::HashedPostState) -&gt; reth_storage_errors::provider::ProviderResult&lt;alloy_primitives::B256&gt;;</span>
                 fn state_root_from_nodes(&amp;self, input: reth_trie::TrieInput) -&gt; reth_storage_errors::provider::ProviderResult&lt;alloy_primitives::B256&gt;;
<span class="term-fg31">-                fn state_root_with_updates(&amp;self, state: reth_trie::HashedPostState) -&gt; reth_storage_errors::provider::ProviderResult&lt;(alloy_primitives::B256, reth_trie::updates::TrieUpdates)&gt;;</span>
<span class="term-fg32">+                fn state_root_from_state_with_updates(&amp;self, state: reth_trie::HashedPostState) -&gt; reth_storage_errors::provider::ProviderResult&lt;(alloy_primitives::B256, reth_trie::updates::TrieUpdates)&gt;;</span>
                 fn state_root_from_nodes_with_updates(&amp;self, input: reth_trie::TrieInput) -&gt; reth_storage_errors::provider::ProviderResult&lt;(alloy_primitives::B256, reth_trie::updates::TrieUpdates)&gt;;
             }
             StorageRootProvider $(where [$($generics)*])? {
<span class="term-fg36">@@ -56,6 +56,15 @@</span>             StateProofProvider $(where [$($generics)*])? {
                 fn proof(&amp;self, input: reth_trie::TrieInput, address: alloy_primitives::Address, slots: &amp;[alloy_primitives::B256]) -&gt; reth_storage_errors::provider::ProviderResult&lt;reth_trie::AccountProof&gt;;
                 fn multiproof(&amp;self, input: reth_trie::TrieInput, targets: alloy_primitives::map::HashMap&lt;alloy_primitives::B256, alloy_primitives::map::HashSet&lt;alloy_primitives::B256&gt;&gt;) -&gt; reth_storage_errors::provider::ProviderResult&lt;reth_trie::MultiProof&gt;;
                 fn witness(&amp;self, input: reth_trie::TrieInput, target: reth_trie::HashedPostState) -&gt; reth_storage_errors::provider::ProviderResult&lt;alloy_primitives::map::HashMap&lt;alloy_primitives::B256, alloy_primitives::Bytes&gt;&gt;;
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            HashedPostStateProvider $(where [$($generics)*])? {</span>
<span class="term-fg32">+                fn hashed_post_state(&amp;self, bundle_state: &amp;revm::db::BundleState) -&gt; reth_trie::HashedPostState;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            HashedStorageProvider $(where [$($generics)*])? {</span>
<span class="term-fg32">+                fn hashed_storage(&amp;self, bundle_state: &amp;revm::db::BundleAccount) -&gt; reth_trie::HashedStorage;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            KeyHasherProvider $(where [$($generics)*])? {</span>
<span class="term-fg32">+                fn hash_key(&amp;self, bytes: &amp;[u8]) -&gt; alloy_primitives::B256;</span>
             }
         );
     }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-927851c6b6659510d8c528e1" role="button"
                       aria-expanded="false" aria-controls="id-927851c6b6659510d8c528e1">
                        <code>crates/storage/provider/src/test_utils/mock.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/test_utils/mock.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/provider/src/test_utils/mock.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+38</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-927851c6b6659510d8c528e1"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mock.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mock.rs</span>
<span class="term-fg1">index 12c0330ac0e0877a5774284de9a9c3cf49cd8803..81a8cd3ee6841939e836f33e9f64ecb34e047fa2 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mock.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mock.rs</span>
<span class="term-fg36">@@ -29,7 +29,8 @@</span> };
 use reth_primitives_traits::SignedTransaction;
 use reth_stages_types::{StageCheckpoint, StageId};
 use reth_storage_api::{
<span class="term-fg31">-    DatabaseProviderFactory, StageCheckpointReader, StateProofProvider, StorageRootProvider,</span>
<span class="term-fg32">+    DatabaseProviderFactory, HashedPostStateProvider, HashedStorageProvider, KeyHasherProvider,</span>
<span class="term-fg32">+    StageCheckpointReader, StateCommitmentProvider, StateProofProvider, StorageRootProvider,</span>
 };
 use reth_storage_errors::provider::{ConsistentViewError, ProviderError, ProviderResult};
 use reth_trie::{
<span class="term-fg36">@@ -83,7 +84,13 @@</span> impl ExtendedAccount {
     &#47;&#47;&#47; Create new instance of extended account
     pub fn new(nonce: u64, balance: U256) -&gt; Self {
         Self {
<span class="term-fg31">-            account: Account { nonce, balance, bytecode_hash: None },</span>
<span class="term-fg32">+            account: Account {</span>
<span class="term-fg32">+                nonce,</span>
<span class="term-fg32">+                balance,</span>
<span class="term-fg32">+                bytecode_hash: None,</span>
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+            },</span>
             bytecode: None,
             storage: Default::default(),
         }
<span class="term-fg36">@@ -91,6 +98,11 @@</span>     }
&nbsp;
     &#47;&#47;&#47; Set bytecode and bytecode hash on the extended account
     pub fn with_bytecode(mut self, bytecode: Bytes) -&gt; Self {
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+            self.account.account_extension =</span>
<span class="term-fg32">+                Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;bytecode));</span>
<span class="term-fg32">+        }</span>
         let hash = keccak256(&amp;bytecode);
         self.account.bytecode_hash = Some(hash);
         self.bytecode = Some(Bytecode::new_raw(bytecode));
<span class="term-fg36">@@ -162,6 +174,10 @@</span>     type Primitives = EthPrimitives;
     type ChainSpec = ChainSpec;
     type StateCommitment = MerklePatriciaTrie;
     type Storage = EthStorage;
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl StateCommitmentProvider for MockEthProvider {</span>
<span class="term-fg32">+    type StateCommitment = &lt;MockNode as NodeTypes&gt;::StateCommitment;</span>
 }
&nbsp;
 impl DatabaseProviderFactory for MockEthProvider {
<span class="term-fg36">@@ -600,7 +616,7 @@</span>     }
 }
&nbsp;
 impl StateRootProvider for MockEthProvider {
<span class="term-fg31">-    fn state_root(&amp;self, _state: HashedPostState) -&gt; ProviderResult&lt;B256&gt; {</span>
<span class="term-fg32">+    fn state_root_from_state(&amp;self, _state: HashedPostState) -&gt; ProviderResult&lt;B256&gt; {</span>
         Ok(self.state_roots.lock().pop().unwrap_or_default())
     }
&nbsp;
<span class="term-fg36">@@ -608,7 +624,7 @@</span>     fn state_root_from_nodes(&amp;self, _input: TrieInput) -&gt; ProviderResult&lt;B256&gt; {
         Ok(self.state_roots.lock().pop().unwrap_or_default())
     }
&nbsp;
<span class="term-fg31">-    fn state_root_with_updates(</span>
<span class="term-fg32">+    fn state_root_from_state_with_updates(</span>
         &amp;self,
         _state: HashedPostState,
     ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {
<span class="term-fg36">@@ -677,6 +693,24 @@</span>         _input: TrieInput,
         _target: HashedPostState,
     ) -&gt; ProviderResult&lt;HashMap&lt;B256, Bytes&gt;&gt; {
         Ok(HashMap::default())
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashedPostStateProvider for MockEthProvider {</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, _state: &amp;revm::db::BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+        HashedPostState::default()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashedStorageProvider for MockEthProvider {</span>
<span class="term-fg32">+    fn hashed_storage(&amp;self, _account: &amp;revm::db::BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+        HashedStorage::default()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl KeyHasherProvider for MockEthProvider {</span>
<span class="term-fg32">+    fn hash_key(&amp;self, _bytes: &amp;[u8]) -&gt; B256 {</span>
<span class="term-fg32">+        B256::default()</span>
     }
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-02b86c6bfca747c12db7f365" role="button"
                       aria-expanded="false" aria-controls="id-02b86c6bfca747c12db7f365">
                        <code>crates/storage/provider/src/test_utils/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/test_utils/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/provider/src/test_utils/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-6</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-02b86c6bfca747c12db7f365"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mod.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mod.rs</span>
<span class="term-fg1">index 2c3795573c209f3d05dfa427b579c50928f0589e..47551fa9db142ec1b62cd57412c3bb5d70cf42e5 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mod.rs</span>
<span class="term-fg36">@@ -1,5 +1,5 @@</span>
 use crate::{
<span class="term-fg31">-    providers::{ProviderNodeTypes, StaticFileProvider},</span>
<span class="term-fg32">+    providers::{LatestStateProviderRef, ProviderNodeTypes, StaticFileProvider},</span>
     HashingWriter, ProviderFactory, TrieWriter,
 };
 use alloy_primitives::B256;
<span class="term-fg36">@@ -11,8 +11,7 @@</span> };
 use reth_errors::ProviderResult;
 use reth_node_types::NodeTypesWithDBAdapter;
 use reth_primitives::{Account, StorageEntry};
<span class="term-fg31">-use reth_trie::StateRoot;</span>
<span class="term-fg31">-use reth_trie_db::DatabaseStateRoot;</span>
<span class="term-fg32">+use reth_storage_api::StateRootProviderExt;</span>
 use std::sync::Arc;
&nbsp;
 pub mod blocks;
<span class="term-fg36">@@ -78,9 +77,7 @@</span>         })
     });
     provider.insert_storage_for_hashing(alloc_storage)?;
&nbsp;
<span class="term-fg31">-    let (root, updates) = StateRoot::from_tx(provider.tx_ref())</span>
<span class="term-fg31">-        .root_with_updates()</span>
<span class="term-fg31">-        .map_err(Into::&lt;reth_db::DatabaseError&gt;::into)?;</span>
<span class="term-fg32">+    let (root, updates) = LatestStateProviderRef::new(&amp;provider.0).state_root_with_updates()?;</span>
     provider.write_trie_updates(&amp;updates).unwrap();
&nbsp;
     provider.commit()?;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-62f311f32b3d69cdb4d9bab9" role="button"
                       aria-expanded="false" aria-controls="id-62f311f32b3d69cdb4d9bab9">
                        <code>crates/storage/provider/src/test_utils/noop.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/test_utils/noop.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/provider/src/test_utils/noop.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+24</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-62f311f32b3d69cdb4d9bab9"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;noop.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;noop.rs</span>
<span class="term-fg1">index ff6b3fccbe109c29085f7fa735dcd539a138ea92..3c95d1c050cc979b5835857ae5c5832bc846d5fa 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;noop.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;noop.rs</span>
<span class="term-fg36">@@ -27,7 +27,10 @@</span>     SealedBlockWithSenders, SealedHeader, TransactionMeta, TransactionSigned,
 };
 use reth_prune_types::{PruneCheckpoint, PruneSegment};
 use reth_stages_types::{StageCheckpoint, StageId};
<span class="term-fg31">-use reth_storage_api::{NodePrimitivesProvider, StateProofProvider, StorageRootProvider};</span>
<span class="term-fg32">+use reth_storage_api::{</span>
<span class="term-fg32">+    HashedPostStateProvider, HashedStorageProvider, KeyHasherProvider, NodePrimitivesProvider,</span>
<span class="term-fg32">+    StateProofProvider, StorageRootProvider,</span>
<span class="term-fg32">+};</span>
 use reth_storage_errors::provider::ProviderResult;
 use reth_trie::{
     updates::TrieUpdates, AccountProof, HashedPostState, HashedStorage, MultiProof, TrieInput,
<span class="term-fg36">@@ -333,7 +336,7 @@</span>     }
 }
&nbsp;
 impl StateRootProvider for NoopProvider {
<span class="term-fg31">-    fn state_root(&amp;self, _state: HashedPostState) -&gt; ProviderResult&lt;B256&gt; {</span>
<span class="term-fg32">+    fn state_root_from_state(&amp;self, _state: HashedPostState) -&gt; ProviderResult&lt;B256&gt; {</span>
         Ok(B256::default())
     }
&nbsp;
<span class="term-fg36">@@ -341,7 +344,7 @@</span>     fn state_root_from_nodes(&amp;self, _input: TrieInput) -&gt; ProviderResult&lt;B256&gt; {
         Ok(B256::default())
     }
&nbsp;
<span class="term-fg31">-    fn state_root_with_updates(</span>
<span class="term-fg32">+    fn state_root_from_state_with_updates(</span>
         &amp;self,
         _state: HashedPostState,
     ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {
<span class="term-fg36">@@ -408,6 +411,24 @@</span>         _input: TrieInput,
         _target: HashedPostState,
     ) -&gt; ProviderResult&lt;HashMap&lt;B256, Bytes&gt;&gt; {
         Ok(HashMap::default())
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashedPostStateProvider for NoopProvider {</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, _bundle_state: &amp;revm::db::BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+        HashedPostState::default()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashedStorageProvider for NoopProvider {</span>
<span class="term-fg32">+    fn hashed_storage(&amp;self, _account: &amp;revm::db::BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+        HashedStorage::default()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl KeyHasherProvider for NoopProvider {</span>
<span class="term-fg32">+    fn hash_key(&amp;self, _bytes: &amp;[u8]) -&gt; B256 {</span>
<span class="term-fg32">+        B256::default()</span>
     }
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a5ff8e5a374ca52feba501dc" role="button"
                       aria-expanded="false" aria-controls="id-a5ff8e5a374ca52feba501dc">
                        <code>crates/storage/provider/src/writer/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/provider/src/writer/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/provider/src/writer/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+75</span></div>
                            <div class="text-start"><span class="text-danger">-55</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a5ff8e5a374ca52feba501dc"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;writer&#47;mod.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;writer&#47;mod.rs</span>
<span class="term-fg1">index 02e912050d5e16f60a701176b533bf8469f51a08..ad54e9b2bdf86852bba178ed91dcccc9137af6aa 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;writer&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;writer&#47;mod.rs</span>
<span class="term-fg36">@@ -221,6 +221,8 @@</span> }
&nbsp;
 #[cfg(test)]
 mod tests {
<span class="term-fg32">+    #![allow(clippy::useless_conversion)]</span>
<span class="term-fg32">+</span>
     use super::*;
     use crate::{
         test_utils::create_test_provider_factory, AccountReader, StorageTrieWriter, TrieWriter,
<span class="term-fg36">@@ -234,7 +236,7 @@</span>         transaction::{DbTx, DbTxMut},
     };
     use reth_execution_types::ExecutionOutcome;
     use reth_primitives::{Account, Receipt, Receipts, StorageEntry};
<span class="term-fg31">-    use reth_storage_api::DatabaseProviderFactory;</span>
<span class="term-fg32">+    use reth_storage_api::{DatabaseProviderFactory, HashedPostStateProvider};</span>
     use reth_trie::{
         test_utils::{state_root, storage_root_prehashed},
         HashedPostState, HashedStorage, StateRoot, StorageRoot,
<span class="term-fg36">@@ -320,13 +322,13 @@</span>             RevmAccountInfo { balance: U256::from(3), nonce: 3, ..Default::default() };
&nbsp;
         let mut state = State::builder().with_bundle_update().build();
         state.insert_not_existing(address_a);
<span class="term-fg31">-        state.insert_account(address_b, account_b.clone());</span>
<span class="term-fg32">+        state.insert_account(address_b, account_b.clone().into());</span>
&nbsp;
         &#47;&#47; 0x00.. is created
         state.commit(HashMap::from_iter([(
             address_a,
             RevmAccount {
<span class="term-fg31">-                info: account_a.clone(),</span>
<span class="term-fg32">+                info: account_a.clone().into(),</span>
                 status: AccountStatus::Touched | AccountStatus::Created,
                 storage: HashMap::default(),
             },
<span class="term-fg36">@@ -336,7 +338,7 @@</span>         &#47;&#47; 0xff.. is changed (balance + 1, nonce + 1)
         state.commit(HashMap::from_iter([(
             address_b,
             RevmAccount {
<span class="term-fg31">-                info: account_b_changed.clone(),</span>
<span class="term-fg32">+                info: account_b_changed.clone().into(),</span>
                 status: AccountStatus::Touched,
                 storage: HashMap::default(),
             },
<span class="term-fg36">@@ -346,8 +348,10 @@</span>         state.merge_transitions(BundleRetention::Reverts);
         let mut revm_bundle_state = state.take_bundle();
&nbsp;
         &#47;&#47; Write plain state and reverts separately.
<span class="term-fg31">-        let reverts = revm_bundle_state.take_all_reverts().to_plain_state_reverts();</span>
<span class="term-fg31">-        let plain_state = revm_bundle_state.to_plain_state(OriginalValuesKnown::Yes);</span>
<span class="term-fg32">+        let reverts: revm::db::states::PlainStateReverts =</span>
<span class="term-fg32">+            revm_bundle_state.take_all_reverts().to_plain_state_reverts().into();</span>
<span class="term-fg32">+        let plain_state: revm::db::states::StateChangeset =</span>
<span class="term-fg32">+            revm_bundle_state.to_plain_state(OriginalValuesKnown::Yes).into();</span>
         assert!(plain_state.storage.is_empty());
         assert!(plain_state.contracts.is_empty());
         provider.write_state_changes(plain_state).expect(&quot;Could not write plain state to DB&quot;);
<span class="term-fg36">@@ -388,14 +392,14 @@</span>             &quot;Account B changeset is wrong&quot;
         );
&nbsp;
         let mut state = State::builder().with_bundle_update().build();
<span class="term-fg31">-        state.insert_account(address_b, account_b_changed.clone());</span>
<span class="term-fg32">+        state.insert_account(address_b, account_b_changed.clone().into());</span>
&nbsp;
         &#47;&#47; 0xff.. is destroyed
         state.commit(HashMap::from_iter([(
             address_b,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: account_b_changed,</span>
<span class="term-fg32">+                info: account_b_changed.into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -404,8 +408,10 @@</span>         state.merge_transitions(BundleRetention::Reverts);
         let mut revm_bundle_state = state.take_bundle();
&nbsp;
         &#47;&#47; Write plain state and reverts separately.
<span class="term-fg31">-        let reverts = revm_bundle_state.take_all_reverts().to_plain_state_reverts();</span>
<span class="term-fg31">-        let plain_state = revm_bundle_state.to_plain_state(OriginalValuesKnown::Yes);</span>
<span class="term-fg32">+        let reverts: revm::db::states::PlainStateReverts =</span>
<span class="term-fg32">+            revm_bundle_state.take_all_reverts().to_plain_state_reverts().into();</span>
<span class="term-fg32">+        let plain_state: revm::db::states::StateChangeset =</span>
<span class="term-fg32">+            revm_bundle_state.to_plain_state(OriginalValuesKnown::Yes).into();</span>
         &#47;&#47; Account B selfdestructed so flag for it should be present.
         assert_eq!(
             plain_state.storage,
<span class="term-fg36">@@ -449,7 +455,7 @@</span>         let mut state = State::builder().with_bundle_update().build();
         state.insert_not_existing(address_a);
         state.insert_account_with_storage(
             address_b,
<span class="term-fg31">-            account_b.clone(),</span>
<span class="term-fg32">+            account_b.clone().into(),</span>
             HashMap::from_iter([(U256::from(1), U256::from(1))]),
         );
&nbsp;
<span class="term-fg36">@@ -458,7 +464,7 @@</span>             (
                 address_a,
                 RevmAccount {
                     status: AccountStatus::Touched | AccountStatus::Created,
<span class="term-fg31">-                    info: RevmAccountInfo::default(),</span>
<span class="term-fg32">+                    info: RevmAccountInfo::default().into(),</span>
                     &#47;&#47; 0x00 =&gt; 0 =&gt; 1
                     &#47;&#47; 0x01 =&gt; 0 =&gt; 2
                     storage: HashMap::from_iter([
<span class="term-fg36">@@ -477,7 +483,7 @@</span>             (
                 address_b,
                 RevmAccount {
                     status: AccountStatus::Touched,
<span class="term-fg31">-                    info: account_b,</span>
<span class="term-fg32">+                    info: account_b.into(),</span>
                     &#47;&#47; 0x01 =&gt; 1 =&gt; 2
                     storage: HashMap::from_iter([(
                         U256::from(1),
<span class="term-fg36">@@ -494,7 +500,7 @@</span>
         state.merge_transitions(BundleRetention::Reverts);
&nbsp;
         let outcome =
<span class="term-fg31">-            ExecutionOutcome::new(state.take_bundle(), Receipts::default(), 1, Vec::new());</span>
<span class="term-fg32">+            ExecutionOutcome::new(state.take_bundle().into(), Receipts::default(), 1, Vec::new());</span>
         provider
             .write_state(outcome, OriginalValuesKnown::Yes, StorageLocation::Database)
             .expect(&quot;Could not write bundle state to DB&quot;);
<span class="term-fg36">@@ -581,20 +587,20 @@</span>         );
&nbsp;
         &#47;&#47; Delete account A
         let mut state = State::builder().with_bundle_update().build();
<span class="term-fg31">-        state.insert_account(address_a, RevmAccountInfo::default());</span>
<span class="term-fg32">+        state.insert_account(address_a, RevmAccountInfo::default().into());</span>
&nbsp;
         state.commit(HashMap::from_iter([(
             address_a,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: RevmAccountInfo::default(),</span>
<span class="term-fg32">+                info: RevmAccountInfo::default().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
&nbsp;
         state.merge_transitions(BundleRetention::Reverts);
         let outcome =
<span class="term-fg31">-            ExecutionOutcome::new(state.take_bundle(), Receipts::default(), 2, Vec::new());</span>
<span class="term-fg32">+            ExecutionOutcome::new(state.take_bundle().into(), Receipts::default(), 2, Vec::new());</span>
         provider
             .write_state(outcome, OriginalValuesKnown::Yes, StorageLocation::Database)
             .expect(&quot;Could not write bundle state to DB&quot;);
<span class="term-fg36">@@ -642,7 +648,7 @@</span>         init_state.insert_not_existing(address1);
         init_state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 status: AccountStatus::Touched | AccountStatus::Created,
                 &#47;&#47; 0x00 =&gt; 0 =&gt; 1
                 &#47;&#47; 0x01 =&gt; 0 =&gt; 2
<span class="term-fg36">@@ -660,8 +666,12 @@</span>             },
         )]));
         init_state.merge_transitions(BundleRetention::Reverts);
&nbsp;
<span class="term-fg31">-        let outcome =</span>
<span class="term-fg31">-            ExecutionOutcome::new(init_state.take_bundle(), Receipts::default(), 0, Vec::new());</span>
<span class="term-fg32">+        let outcome = ExecutionOutcome::new(</span>
<span class="term-fg32">+            init_state.take_bundle().into(),</span>
<span class="term-fg32">+            Receipts::default(),</span>
<span class="term-fg32">+            0,</span>
<span class="term-fg32">+            Vec::new(),</span>
<span class="term-fg32">+        );</span>
         provider
             .write_state(outcome, OriginalValuesKnown::Yes, StorageLocation::Database)
             .expect(&quot;Could not write bundle state to DB&quot;);
<span class="term-fg36">@@ -669,7 +679,7 @@</span>
         let mut state = State::builder().with_bundle_update().build();
         state.insert_account_with_storage(
             address1,
<span class="term-fg31">-            account_info.clone(),</span>
<span class="term-fg32">+            account_info.clone().into(),</span>
             HashMap::from_iter([(U256::ZERO, U256::from(1)), (U256::from(1), U256::from(2))]),
         );
&nbsp;
<span class="term-fg36">@@ -678,7 +688,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 &#47;&#47; 0x00 =&gt; 1 =&gt; 2
                 storage: HashMap::from_iter([(
                     U256::ZERO,
<span class="term-fg36">@@ -697,7 +707,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -708,7 +718,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::Created,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -719,7 +729,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 &#47;&#47; 0x00 =&gt; 0 =&gt; 2
                 &#47;&#47; 0x02 =&gt; 0 =&gt; 4
                 &#47;&#47; 0x06 =&gt; 0 =&gt; 6
<span class="term-fg36">@@ -746,7 +756,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -757,7 +767,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::Created,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -765,7 +775,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 &#47;&#47; 0x00 =&gt; 0 =&gt; 2
                 storage: HashMap::from_iter([(
                     U256::ZERO,
<span class="term-fg36">@@ -777,7 +787,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -785,7 +795,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::Created,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -796,7 +806,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched,
<span class="term-fg31">-                info: account_info,</span>
<span class="term-fg32">+                info: account_info.into(),</span>
                 &#47;&#47; 0x00 =&gt; 0 =&gt; 9
                 storage: HashMap::from_iter([(
                     U256::ZERO,
<span class="term-fg36">@@ -806,7 +816,7 @@</span>             },
         )]));
         state.merge_transitions(BundleRetention::Reverts);
&nbsp;
<span class="term-fg31">-        let bundle = state.take_bundle();</span>
<span class="term-fg32">+        let bundle = state.take_bundle().into();</span>
&nbsp;
         let outcome: ExecutionOutcome =
             ExecutionOutcome::new(bundle, Receipts::default(), 1, Vec::new());
<span class="term-fg36">@@ -956,7 +966,7 @@</span>         init_state.insert_not_existing(address1);
         init_state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
<span class="term-fg31">-                info: account1.clone(),</span>
<span class="term-fg32">+                info: account1.clone().into(),</span>
                 status: AccountStatus::Touched | AccountStatus::Created,
                 &#47;&#47; 0x00 =&gt; 0 =&gt; 1
                 &#47;&#47; 0x01 =&gt; 0 =&gt; 2
<span class="term-fg36">@@ -973,8 +983,12 @@</span>                 ]),
             },
         )]));
         init_state.merge_transitions(BundleRetention::Reverts);
<span class="term-fg31">-        let outcome =</span>
<span class="term-fg31">-            ExecutionOutcome::new(init_state.take_bundle(), Receipts::default(), 0, Vec::new());</span>
<span class="term-fg32">+        let outcome = ExecutionOutcome::new(</span>
<span class="term-fg32">+            init_state.take_bundle().into(),</span>
<span class="term-fg32">+            Receipts::default(),</span>
<span class="term-fg32">+            0,</span>
<span class="term-fg32">+            Vec::new(),</span>
<span class="term-fg32">+        );</span>
         provider
             .write_state(outcome, OriginalValuesKnown::Yes, StorageLocation::Database)
             .expect(&quot;Could not write bundle state to DB&quot;);
<span class="term-fg36">@@ -982,7 +996,7 @@</span>
         let mut state = State::builder().with_bundle_update().build();
         state.insert_account_with_storage(
             address1,
<span class="term-fg31">-            account1.clone(),</span>
<span class="term-fg32">+            account1.clone().into(),</span>
             HashMap::from_iter([(U256::ZERO, U256::from(1)), (U256::from(1), U256::from(2))]),
         );
&nbsp;
<span class="term-fg36">@@ -991,7 +1005,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: account1.clone(),</span>
<span class="term-fg32">+                info: account1.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -1000,7 +1014,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::Created,
<span class="term-fg31">-                info: account1.clone(),</span>
<span class="term-fg32">+                info: account1.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -1009,7 +1023,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched,
<span class="term-fg31">-                info: account1,</span>
<span class="term-fg32">+                info: account1.into(),</span>
                 &#47;&#47; 0x01 =&gt; 0 =&gt; 5
                 storage: HashMap::from_iter([(
                     U256::from(1),
<span class="term-fg36">@@ -1021,7 +1035,7 @@</span>
         &#47;&#47; Commit block #1 changes to the database.
         state.merge_transitions(BundleRetention::Reverts);
         let outcome =
<span class="term-fg31">-            ExecutionOutcome::new(state.take_bundle(), Receipts::default(), 1, Vec::new());</span>
<span class="term-fg32">+            ExecutionOutcome::new(state.take_bundle().into(), Receipts::default(), 1, Vec::new());</span>
         provider
             .write_state(outcome, OriginalValuesKnown::Yes, StorageLocation::Database)
             .expect(&quot;Could not write bundle state to DB&quot;);
<span class="term-fg36">@@ -1085,7 +1099,13 @@</span>     fn bundle_state_state_root() {
         type PreState = BTreeMap&lt;Address, (Account, BTreeMap&lt;B256, U256&gt;)&gt;;
         let mut prestate: PreState = (0..10)
             .map(|key| {
<span class="term-fg31">-                let account = Account { nonce: 1, balance: U256::from(key), bytecode_hash: None };</span>
<span class="term-fg32">+                let account = Account {</span>
<span class="term-fg32">+                    nonce: 1,</span>
<span class="term-fg32">+                    balance: U256::from(key),</span>
<span class="term-fg32">+                    bytecode_hash: None,</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                };</span>
                 let storage =
                     (1..11).map(|key| (B256::with_last_byte(key), U256::from(key))).collect();
                 (Address::with_last_byte(key), (account, storage))
<span class="term-fg36">@@ -1115,18 +1135,13 @@</span>
         let mut state = State::builder().with_bundle_update().build();
&nbsp;
         let assert_state_root = |state: &amp;State&lt;EmptyDB&gt;, expected: &amp;PreState, msg| {
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            let bundle_state = &amp;(state.bundle_state.clone(), &amp;()).into();</span>
<span class="term-fg32">+            #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+            let bundle_state = &amp;state.bundle_state;</span>
             assert_eq!(
<span class="term-fg31">-                StateRoot::overlay_root(</span>
<span class="term-fg31">-                    tx,</span>
<span class="term-fg31">-                    ExecutionOutcome::&lt;Receipt&gt;::new(</span>
<span class="term-fg31">-                        state.bundle_state.clone(),</span>
<span class="term-fg31">-                        Receipts::default(),</span>
<span class="term-fg31">-                        0,</span>
<span class="term-fg31">-                        Vec::new()</span>
<span class="term-fg31">-                    )</span>
<span class="term-fg31">-                    .hash_state_slow(),</span>
<span class="term-fg31">-                )</span>
<span class="term-fg31">-                .unwrap(),</span>
<span class="term-fg32">+                StateRoot::overlay_root(tx, provider_factory.hashed_post_state(bundle_state))</span>
<span class="term-fg32">+                    .unwrap(),</span>
                 state_root(expected.clone().into_iter().map(|(address, (account, storage))| (
                     address,
                     (account, storage.into_iter())
<span class="term-fg36">@@ -1146,7 +1161,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: RevmAccountInfo::default(),</span>
<span class="term-fg32">+                info: RevmAccountInfo::default().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -1216,8 +1231,13 @@</span>         state.merge_transitions(BundleRetention::PlainState);
         assert_state_root(&amp;state, &amp;prestate, &quot;changed nonce&quot;);
&nbsp;
         &#47;&#47; recreate account 1
<span class="term-fg31">-        let account1_new =</span>
<span class="term-fg31">-            Account { nonce: 56, balance: U256::from(123), bytecode_hash: Some(B256::random()) };</span>
<span class="term-fg32">+        let account1_new = Account {</span>
<span class="term-fg32">+            nonce: 56,</span>
<span class="term-fg32">+            balance: U256::from(123),</span>
<span class="term-fg32">+            bytecode_hash: Some(B256::random()),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some((10, B256::random()).into()),</span>
<span class="term-fg32">+        };</span>
         prestate.insert(address1, (account1_new, BTreeMap::default()));
         state.commit(HashMap::from_iter([(
             address1,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-71a8177ad3f3c3ef8162dee5" role="button"
                       aria-expanded="false" aria-controls="id-71a8177ad3f3c3ef8162dee5">
                        <code>crates/storage/storage-api/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/storage-api/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/storage-api/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-71a8177ad3f3c3ef8162dee5"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;storage-api&#47;Cargo.toml scroll-reth&#47;crates&#47;storage&#47;storage-api&#47;Cargo.toml</span>
<span class="term-fg1">index ba2ccf1b15735d0a4e3705d99df37d02256c9318..7ebff976d135727f10ed8677dc79c404cc19c829 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;storage-api&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;storage-api&#47;Cargo.toml</span>
<span class="term-fg36">@@ -25,6 +25,7 @@</span> reth-storage-errors.workspace = true
 reth-trie.workspace = true
 reth-trie-db.workspace = true
 reth-db.workspace = true
<span class="term-fg32">+revm.workspace = true</span>
&nbsp;
 # ethereum
 alloy-eips.workspace = true</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1475472c946ccff2cd5e7ee1" role="button"
                       aria-expanded="false" aria-controls="id-1475472c946ccff2cd5e7ee1">
                        <code>crates/storage/storage-api/src/state.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/storage-api/src/state.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/storage-api/src/state.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+22</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1475472c946ccff2cd5e7ee1"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;state.rs scroll-reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;state.rs</span>
<span class="term-fg1">index 0cb26d3074344eecb9effcf388e53df5d53160c4..859e73eb61e98cc97860149a2c6cdb6d734b43c0 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;state.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;state.rs</span>
<span class="term-fg36">@@ -1,6 +1,6 @@</span>
 use super::{
<span class="term-fg31">-    AccountReader, BlockHashReader, BlockIdReader, StateProofProvider, StateRootProvider,</span>
<span class="term-fg31">-    StorageRootProvider,</span>
<span class="term-fg32">+    AccountReader, BlockHashReader, BlockIdReader, HashedStorageProvider, StateProofProvider,</span>
<span class="term-fg32">+    StateRootProvider, StorageRootProvider,</span>
 };
 use alloy_consensus::constants::KECCAK_EMPTY;
 use alloy_eips::{BlockId, BlockNumberOrTag};
<span class="term-fg36">@@ -8,7 +8,9 @@</span> use alloy_primitives::{Address, BlockHash, BlockNumber, StorageKey, StorageValue, B256, U256};
 use auto_impl::auto_impl;
 use reth_primitives::Bytecode;
 use reth_storage_errors::provider::ProviderResult;
<span class="term-fg32">+use reth_trie::HashedPostState;</span>
 use reth_trie_db::StateCommitment;
<span class="term-fg32">+use revm::db::states::BundleState;</span>
&nbsp;
 &#47;&#47;&#47; Type alias of boxed [`StateProvider`].
 pub type StateProviderBox = Box&lt;dyn StateProvider&gt;;
<span class="term-fg36">@@ -21,6 +23,9 @@</span>     + AccountReader
     + StateRootProvider
     + StorageRootProvider
     + StateProofProvider
<span class="term-fg32">+    + HashedPostStateProvider</span>
<span class="term-fg32">+    + HashedStorageProvider</span>
<span class="term-fg32">+    + KeyHasherProvider</span>
     + Send
     + Sync
 {
<span class="term-fg36">@@ -83,9 +88,23 @@</span>     }
 }
&nbsp;
 &#47;&#47;&#47; Trait implemented for database providers that can provide the [`StateCommitment`] type.
<span class="term-fg31">-pub trait StateCommitmentProvider {</span>
<span class="term-fg32">+pub trait StateCommitmentProvider: Send + Sync {</span>
     &#47;&#47;&#47; The [`StateCommitment`] type that can be used to perform state commitment operations.
     type StateCommitment: StateCommitment;
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Trait that provides the hashed state from various sources.</span>
<span class="term-fg32">+#[auto_impl(&amp;, Arc, Box)]</span>
<span class="term-fg32">+pub trait HashedPostStateProvider: Send + Sync {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the `HashedPostState` of the provided [`BundleState`].</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, bundle_state: &amp;BundleState) -&gt; HashedPostState;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Trait that provides a method to hash bytes to produce a [`B256`] hash.</span>
<span class="term-fg32">+#[auto_impl(&amp;, Arc, Box)]</span>
<span class="term-fg32">+pub trait KeyHasherProvider: Send + Sync {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Hashes the provided bytes into a 256-bit hash.</span>
<span class="term-fg32">+    fn hash_key(&amp;self, bytes: &amp;[u8]) -&gt; B256;</span>
 }
&nbsp;
 &#47;&#47;&#47; Trait implemented for database providers that can be converted into a historical state provider.</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-50d120ae4a9d3f63dcbf2022" role="button"
                       aria-expanded="false" aria-controls="id-50d120ae4a9d3f63dcbf2022">
                        <code>crates/storage/storage-api/src/storage.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/storage-api/src/storage.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/storage-api/src/storage.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+9</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-50d120ae4a9d3f63dcbf2022"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;storage.rs scroll-reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;storage.rs</span>
<span class="term-fg1">index e1443347e4bb86c3fd012e4dc9ca3cc3ffd22cc4..3e3fd92eaefe2d45200035637ad03c9fcf7fd5b0 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;storage.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;storage.rs</span>
<span class="term-fg36">@@ -2,6 +2,8 @@</span> use alloy_primitives::{Address, BlockNumber, B256};
 use reth_db_api::models::BlockNumberAddress;
 use reth_primitives::StorageEntry;
 use reth_storage_errors::provider::ProviderResult;
<span class="term-fg32">+use reth_trie::HashedStorage;</span>
<span class="term-fg32">+use revm::db::BundleAccount;</span>
 use std::{
     collections::{BTreeMap, BTreeSet},
     ops::RangeInclusive,
<span class="term-fg36">@@ -41,3 +43,10 @@</span>         &amp;self,
         block_number: BlockNumber,
     ) -&gt; ProviderResult&lt;Vec&lt;(BlockNumberAddress, StorageEntry)&gt;&gt;;
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Provider of [`HashedStorage`]</span>
<span class="term-fg32">+#[auto_impl::auto_impl(&amp;, Arc, Box)]</span>
<span class="term-fg32">+pub trait HashedStorageProvider: Send + Sync {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Construct [`HashedStorage`] from the provided [`BundleAccount`].</span>
<span class="term-fg32">+    fn hashed_storage(&amp;self, account: &amp;BundleAccount) -&gt; HashedStorage;</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cf2c6e6c08f11147483ec9a8" role="button"
                       aria-expanded="false" aria-controls="id-cf2c6e6c08f11147483ec9a8">
                        <code>crates/storage/storage-api/src/trie.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/storage/storage-api/src/trie.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/storage/storage-api/src/trie.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+40</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cf2c6e6c08f11147483ec9a8"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;trie.rs scroll-reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;trie.rs</span>
<span class="term-fg1">index ee1ca1de1800a70c434bd1c81c36bce05b22dcc7..b8c28dd88d9dce91c7d92d6c21c2c1c1cdedb8e9 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;trie.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;storage-api&#47;src&#47;trie.rs</span>
<span class="term-fg36">@@ -1,11 +1,13 @@</span>
 use alloy_primitives::{
     map::{HashMap, HashSet},
<span class="term-fg31">-    Address, Bytes, B256,</span>
<span class="term-fg32">+    Address, BlockNumber, Bytes, B256,</span>
 };
 use reth_storage_errors::provider::ProviderResult;
 use reth_trie::{
<span class="term-fg32">+    prefix_set::TriePrefixSets,</span>
     updates::{StorageTrieUpdates, TrieUpdates},
<span class="term-fg31">-    AccountProof, HashedPostState, HashedStorage, MultiProof, StorageMultiProof, StorageProof,</span>
<span class="term-fg32">+    AccountProof, HashedPostState, HashedPostStateSorted, HashedStorage,</span>
<span class="term-fg32">+    IntermediateStateRootState, MultiProof, StateRootProgress, StorageMultiProof, StorageProof,</span>
     TrieInput,
 };
&nbsp;
<span class="term-fg36">@@ -19,7 +21,7 @@</span>     &#47;&#47;&#47;
     &#47;&#47;&#47; It is recommended to provide a different implementation from
     &#47;&#47;&#47; `state_root_with_updates` since it affects the memory usage during state root
     &#47;&#47;&#47; computation.
<span class="term-fg31">-    fn state_root(&amp;self, hashed_state: HashedPostState) -&gt; ProviderResult&lt;B256&gt;;</span>
<span class="term-fg32">+    fn state_root_from_state(&amp;self, hashed_state: HashedPostState) -&gt; ProviderResult&lt;B256&gt;;</span>
&nbsp;
     &#47;&#47;&#47; Returns the state root of the `HashedPostState` on top of the current state but re-uses the
     &#47;&#47;&#47; intermediate nodes to speed up the computation. It&#39;s up to the caller to construct the
<span class="term-fg36">@@ -28,7 +30,7 @@</span>     fn state_root_from_nodes(&amp;self, input: TrieInput) -&gt; ProviderResult&lt;B256&gt;;
&nbsp;
     &#47;&#47;&#47; Returns the state root of the `HashedPostState` on top of the current state with trie
     &#47;&#47;&#47; updates to be committed to the database.
<span class="term-fg31">-    fn state_root_with_updates(</span>
<span class="term-fg32">+    fn state_root_from_state_with_updates(</span>
         &amp;self,
         hashed_state: HashedPostState,
     ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt;;
<span class="term-fg36">@@ -39,6 +41,40 @@</span>     fn state_root_from_nodes_with_updates(
         &amp;self,
         input: TrieInput,
     ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt;;
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A trait that is used to compute the state root of the latest state stored in the database.</span>
<span class="term-fg32">+pub trait StateRootProviderExt: Send + Sync {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the state root of the current state.</span>
<span class="term-fg32">+    fn state_root(&amp;self) -&gt; ProviderResult&lt;B256&gt;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the state root of the current state and trie updates.</span>
<span class="term-fg32">+    fn state_root_with_updates(&amp;self) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the state root with trie updates associated with the given block range.</span>
<span class="term-fg32">+    fn incremental_state_root_with_updates(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        range: std::ops::RangeInclusive&lt;BlockNumber&gt;,</span>
<span class="term-fg32">+    ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the state root progress.</span>
<span class="term-fg32">+    fn state_root_with_progress(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        state: Option&lt;IntermediateStateRootState&gt;,</span>
<span class="term-fg32">+    ) -&gt; ProviderResult&lt;StateRootProgress&gt;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the state root of the current state with the provided prefix sets updated.</span>
<span class="term-fg32">+    fn state_root_from_prefix_sets_with_updates(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        prefix_set: TriePrefixSets,</span>
<span class="term-fg32">+    ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the state root of the [`HashedPostState`] on top of the current, the trie updates</span>
<span class="term-fg32">+    &#47;&#47;&#47; and the sorted hashed post state ([`HashedPostStateSorted`]).</span>
<span class="term-fg32">+    fn state_root_from_state_with_updates_and_sorted_state(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        hashed_state: HashedPostState,</span>
<span class="term-fg32">+    ) -&gt; ProviderResult&lt;(B256, TrieUpdates, HashedPostStateSorted)&gt;;</span>
 }
&nbsp;
 &#47;&#47;&#47; A type that can compute the storage root for a given account.</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-82496b9aaf45c3e1d64fd44a"role="button" aria-expanded="false" aria-controls="id-82496b9aaf45c3e1d64fd44a">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/trie</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+404</span></div>
                    <div class="text-start"><span class="text-danger">-85</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-82496b9aaf45c3e1d64fd44a">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6bf6c3600d966dbe0abb19d3" role="button"
                       aria-expanded="false" aria-controls="id-6bf6c3600d966dbe0abb19d3">
                        <code>crates/trie/common/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/common/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/common/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+19</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6bf6c3600d966dbe0abb19d3"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;common&#47;Cargo.toml scroll-reth&#47;crates&#47;trie&#47;common&#47;Cargo.toml</span>
<span class="term-fg1">index 8b0d930b0c2cc223d1957d3fef6a4836c4c4374f..35bb4e78be7a0bd8a927d068e704f1adf353bee1 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;common&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;common&#47;Cargo.toml</span>
<span class="term-fg36">@@ -21,16 +21,21 @@</span> alloy-genesis.workspace = true
&nbsp;
 reth-primitives-traits.workspace = true
 reth-codecs.workspace = true
<span class="term-fg31">-revm-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# revm-primitives scroll re-export</span>
<span class="term-fg32">+revm-primitives = { package = &quot;reth-scroll-revm&quot;, path = &quot;..&#47;..&#47;scroll&#47;revm&quot; }</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
&nbsp;
 bytes.workspace = true
 derive_more.workspace = true
 itertools.workspace = true
 nybbles = { workspace = true, features = [&quot;rlp&quot;] }
<span class="term-fg32">+smallvec = { version = &quot;1.0&quot;, default-features = false, features = [</span>
<span class="term-fg32">+    &quot;const_new&quot;,</span>
<span class="term-fg32">+] }</span>
&nbsp;
 # `serde` feature
 serde = { workspace = true, optional = true }
<span class="term-fg31">-</span>
 serde_with = { workspace = true, optional = true }
&nbsp;
 # `test-utils` feature
<span class="term-fg36">@@ -52,18 +57,21 @@</span> bincode.workspace = true
 serde.workspace = true
 serde_json.workspace = true
 serde_with.workspace = true
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
&nbsp;
 [features]
 serde = [
     &quot;dep:serde&quot;,
     &quot;bytes&#47;serde&quot;,
     &quot;nybbles&#47;serde&quot;,
<span class="term-fg32">+    &quot;smallvec&#47;serde&quot;,</span>
     &quot;alloy-primitives&#47;serde&quot;,
     &quot;alloy-consensus&#47;serde&quot;,
     &quot;alloy-trie&#47;serde&quot;,
     &quot;revm-primitives&#47;serde&quot;,
     &quot;reth-primitives-traits&#47;serde&quot;,
<span class="term-fg31">-    &quot;reth-codecs&#47;serde&quot;</span>
<span class="term-fg32">+    &quot;reth-codecs&#47;serde&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-primitives?&#47;serde&quot;</span>
 ]
 serde-bincode-compat = [
     &quot;serde&quot;,
<span class="term-fg36">@@ -77,6 +85,7 @@</span>     &quot;dep:hash-db&quot;,
     &quot;arbitrary&quot;,
     &quot;reth-primitives-traits&#47;test-utils&quot;,
     &quot;reth-codecs&#47;test-utils&quot;,
<span class="term-fg32">+	&quot;revm-primitives&#47;test-utils&quot;</span>
 ]
 arbitrary = [
     &quot;alloy-trie&#47;arbitrary&quot;,
<span class="term-fg36">@@ -85,8 +94,15 @@</span>     &quot;reth-primitives-traits&#47;arbitrary&quot;,
     &quot;alloy-consensus&#47;arbitrary&quot;,
     &quot;alloy-primitives&#47;arbitrary&quot;,
     &quot;nybbles&#47;arbitrary&quot;,
<span class="term-fg32">+    &quot;smallvec&#47;arbitrary&quot;,</span>
     &quot;revm-primitives&#47;arbitrary&quot;,
     &quot;reth-codecs&#47;arbitrary&quot;,
<span class="term-fg32">+	&quot;reth-scroll-primitives?&#47;arbitrary&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;dep:reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+	&quot;revm-primitives&#47;scroll&quot;</span>
 ]
&nbsp;
 [[bench]]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-87e2ba4b08aebdf6e6535679" role="button"
                       aria-expanded="false" aria-controls="id-87e2ba4b08aebdf6e6535679">
                        <code>crates/trie/common/src/account.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/common/src/account.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/common/src/account.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-87e2ba4b08aebdf6e6535679"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;common&#47;src&#47;account.rs scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;account.rs</span>
<span class="term-fg1">index 0808837063cfab1bf9de63de1677cd744de9b773..b6666cfb7d463e7d157c0eedff93d8c8cd0626f1 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;common&#47;src&#47;account.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;account.rs</span>
<span class="term-fg36">@@ -135,7 +135,11 @@</span>             Into::&lt;TrieAccount&gt;::into((
                 Account {
                     nonce: 10,
                     balance: U256::from(1000),
<span class="term-fg31">-                    bytecode_hash: Some(keccak256([0x60, 0x61]))</span>
<span class="term-fg32">+                    bytecode_hash: Some(keccak256([0x60, 0x61])),</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(&amp;[0x60, 0x61])</span>
<span class="term-fg32">+                    )</span>
                 },
                 expected_storage_root
             )),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-80066465ca98f2c45f376b06" role="button"
                       aria-expanded="false" aria-controls="id-80066465ca98f2c45f376b06">
                        <code>crates/trie/common/src/key.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/common/src/key.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/common/src/key.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+111</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-80066465ca98f2c45f376b06"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;common&#47;src&#47;key.rs scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;key.rs</span>
<span class="term-fg1">index 71f8019bff54d8d8b3df65a31c0814d8b34201d1..c439c7eaf94e466aed9cf800e14ab438a85f8b1a 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;common&#47;src&#47;key.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;key.rs</span>
<span class="term-fg36">@@ -1,4 +1,6 @@</span>
<span class="term-fg32">+use crate::Nibbles;</span>
 use alloy_primitives::{keccak256, B256};
<span class="term-fg32">+use smallvec::SmallVec;</span>
&nbsp;
 &#47;&#47;&#47; Trait for hashing keys in state.
 pub trait KeyHasher: Default + Clone + Send + Sync + &#39;static {
<span class="term-fg36">@@ -15,3 +17,112 @@</span>     fn hash_key&lt;T: AsRef&lt;[u8]&gt;&gt;(bytes: T) -&gt; B256 {
         keccak256(bytes)
     }
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The maximum number of bits a key can contain.</span>
<span class="term-fg32">+const MAX_BITS: usize = 254;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The maximum number of bytes a key can contain.</span>
<span class="term-fg32">+const MAX_BYTES: usize = 32;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; TODO(scroll): Refactor this into a trait that is more generic and can be used by any</span>
<span class="term-fg32">+&#47;&#47; implementation that requires converting between nibbles and bits. Better yet we should use a</span>
<span class="term-fg32">+&#47;&#47; trait that allows for defining the key type via a GAT as opposed to using Nibbles.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A trait for converting a `Nibbles` representation to a bit representation.</span>
<span class="term-fg32">+pub trait BitsCompatibility: Sized {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Unpacks the bits from the provided bytes such that there is a byte for each bit in the</span>
<span class="term-fg32">+    &#47;&#47;&#47; input. The representation is big-endian with respect to the input.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; We truncate the Nibbles such that we only have 254 (bn254 field size) bits.</span>
<span class="term-fg32">+    fn unpack_bits&lt;T: AsRef&lt;[u8]&gt;&gt;(data: T) -&gt; Self;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Pack the bits into a byte representation.</span>
<span class="term-fg32">+    fn pack_bits(&amp;self) -&gt; SmallVec&lt;[u8; 32]&gt;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Encodes a leaf key represented as [`Nibbles`] into it&#39;s canonical little-endian</span>
<span class="term-fg32">+    &#47;&#47;&#47; representation.</span>
<span class="term-fg32">+    fn encode_leaf_key(&amp;self) -&gt; [u8; 32];</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Increment the key to the next key.</span>
<span class="term-fg32">+    fn increment_bit(&amp;self) -&gt; Option&lt;Self&gt;;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl BitsCompatibility for Nibbles {</span>
<span class="term-fg32">+    fn unpack_bits&lt;T: AsRef&lt;[u8]&gt;&gt;(data: T) -&gt; Self {</span>
<span class="term-fg32">+        let data = data.as_ref();</span>
<span class="term-fg32">+        let bits = data</span>
<span class="term-fg32">+            .iter()</span>
<span class="term-fg32">+            .take(MAX_BYTES)</span>
<span class="term-fg32">+            .flat_map(|&amp;byte| (0..8).rev().map(move |i| (byte &gt;&gt; i) &amp; 1))</span>
<span class="term-fg32">+            .take(MAX_BITS)</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Self::from_vec_unchecked(bits)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn pack_bits(&amp;self) -&gt; SmallVec&lt;[u8; 32]&gt; {</span>
<span class="term-fg32">+        let mut result = SmallVec::with_capacity((self.len() + 7) &#47; 8);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        for bits in self.as_slice().chunks(8) {</span>
<span class="term-fg32">+            let mut byte = 0;</span>
<span class="term-fg32">+            for (bit_index, bit) in bits.iter().enumerate() {</span>
<span class="term-fg32">+                byte |= *bit &lt;&lt; (7 - bit_index);</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            result.push(byte);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        result</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn encode_leaf_key(&amp;self) -&gt; [u8; 32] {</span>
<span class="term-fg32">+        &#47;&#47; This is strange we are now representing the leaf key using big endian??</span>
<span class="term-fg32">+        let mut result = [0u8; 32];</span>
<span class="term-fg32">+        for (byte_index, bytes) in self.as_slice().chunks(8).enumerate() {</span>
<span class="term-fg32">+            for (bit_index, byte) in bytes.iter().enumerate() {</span>
<span class="term-fg32">+                result[byte_index] |= byte &lt;&lt; bit_index;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        result</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn increment_bit(&amp;self) -&gt; Option&lt;Self&gt; {</span>
<span class="term-fg32">+        let mut incremented = self.clone();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        for nibble in incremented.as_mut_vec_unchecked().iter_mut().rev() {</span>
<span class="term-fg32">+            if *nibble &lt; 1 {</span>
<span class="term-fg32">+                *nibble += 1;</span>
<span class="term-fg32">+                return Some(incremented);</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            *nibble = 0;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        None</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Helper method to unpack into [`Nibbles`] from a byte slice.</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; For the `scroll` feature, this method will unpack the bits from the provided bytes such that</span>
<span class="term-fg32">+&#47;&#47;&#47; there is a byte for each bit in the input. The representation is big-endian with respect to the</span>
<span class="term-fg32">+&#47;&#47;&#47; input. When the `scroll` feature is not enabled, this method will unpack the bytes into nibbles.</span>
<span class="term-fg32">+pub fn unpack_nibbles&lt;T: AsRef&lt;[u8]&gt;&gt;(data: T) -&gt; Nibbles {</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    let nibbles = Nibbles::unpack_bits(data);</span>
<span class="term-fg32">+    #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+    let nibbles = Nibbles::unpack(data);</span>
<span class="term-fg32">+    nibbles</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Helper method to pack into a byte slice from [`Nibbles`].</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; For the `scroll` feature, this method will pack the bits into a byte representation. When the</span>
<span class="term-fg32">+&#47;&#47;&#47; `scroll` feature is not enabled, this method will pack the nibbles into bytes.</span>
<span class="term-fg32">+pub fn pack_nibbles(nibbles: &amp;Nibbles) -&gt; SmallVec&lt;[u8; 32]&gt; {</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    let packed = nibbles.pack_bits();</span>
<span class="term-fg32">+    #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+    let packed = nibbles.pack();</span>
<span class="term-fg32">+    packed</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5c7b133b7e91f2a2c5ee20df" role="button"
                       aria-expanded="false" aria-controls="id-5c7b133b7e91f2a2c5ee20df">
                        <code>crates/trie/common/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/common/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/common/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5c7b133b7e91f2a2c5ee20df"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;common&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 6647de67811c324b799be25dac369fdb92947443..8fd52ef4d42fe44bdb5bd7f5a1bf4b17af76151e 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;common&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -19,7 +19,7 @@</span> mod account;
 pub use account::TrieAccount;
&nbsp;
 mod key;
<span class="term-fg31">-pub use key::{KeccakKeyHasher, KeyHasher};</span>
<span class="term-fg32">+pub use key::{pack_nibbles, unpack_nibbles, BitsCompatibility, KeccakKeyHasher, KeyHasher};</span>
&nbsp;
 mod nibbles;
 pub use nibbles::{Nibbles, StoredNibbles, StoredNibblesSubKey};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-404a70124885da2245a0c341" role="button"
                       aria-expanded="false" aria-controls="id-404a70124885da2245a0c341">
                        <code>crates/trie/common/src/proofs.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/common/src/proofs.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/common/src/proofs.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-404a70124885da2245a0c341"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;common&#47;src&#47;proofs.rs scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;proofs.rs</span>
<span class="term-fg1">index 78659116c3e27bc3f2af4c8e6bd8a8d96a2dfec2..d86156d2e77c92c1481f1f46a60d280fe1ad801d 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;common&#47;src&#47;proofs.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;proofs.rs</span>
<span class="term-fg36">@@ -81,6 +81,11 @@</span>                             balance: account.balance,
                             nonce: account.nonce,
                             bytecode_hash: (account.code_hash != KECCAK_EMPTY)
                                 .then_some(account.code_hash),
<span class="term-fg32">+                            &#47;&#47; TODO (scroll): set the extension to the correct value.</span>
<span class="term-fg32">+                            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                            account_extension: Some(</span>
<span class="term-fg32">+                                reth_scroll_primitives::AccountExtension::empty(),</span>
<span class="term-fg32">+                            ),</span>
                         })
                     }
                 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-866e01945c8305b16fe7fddd" role="button"
                       aria-expanded="false" aria-controls="id-866e01945c8305b16fe7fddd">
                        <code>crates/trie/common/src/updates.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/common/src/updates.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/common/src/updates.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+9</span></div>
                            <div class="text-start"><span class="text-danger">-7</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-866e01945c8305b16fe7fddd"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;common&#47;src&#47;updates.rs scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;updates.rs</span>
<span class="term-fg1">index 6f80eb16553edd4c359186991fcb62216a1222a0..1dc38f22656edff481ca8569cb849c8a6b31bf31 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;common&#47;src&#47;updates.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;updates.rs</span>
<span class="term-fg36">@@ -229,7 +229,7 @@</span> &#47;&#47;&#47;
 &#47;&#47;&#47; This also sorts the set before serializing.
 #[cfg(any(test, feature = &quot;serde&quot;))]
 mod serde_nibbles_set {
<span class="term-fg31">-    use crate::Nibbles;</span>
<span class="term-fg32">+    use crate::{pack_nibbles, unpack_nibbles, Nibbles};</span>
     use alloy_primitives::map::HashSet;
     use serde::{de::Error, Deserialize, Deserializer, Serialize, Serializer};
&nbsp;
<span class="term-fg36">@@ -237,8 +237,10 @@</span>     pub(super) fn serialize&lt;S&gt;(map: &amp;HashSet&lt;Nibbles&gt;, serializer: S) -&gt; Result&lt;S::Ok, S::Error&gt;
     where
         S: Serializer,
     {
<span class="term-fg31">-        let mut storage_nodes =</span>
<span class="term-fg31">-            map.iter().map(|elem| alloy_primitives::hex::encode(elem.pack())).collect::&lt;Vec&lt;_&gt;&gt;();</span>
<span class="term-fg32">+        let mut storage_nodes = map</span>
<span class="term-fg32">+            .iter()</span>
<span class="term-fg32">+            .map(|elem| alloy_primitives::hex::encode(pack_nibbles(elem)))</span>
<span class="term-fg32">+            .collect::&lt;Vec&lt;_&gt;&gt;();</span>
         storage_nodes.sort_unstable();
         storage_nodes.serialize(serializer)
     }
<span class="term-fg36">@@ -250,7 +252,7 @@</span>     {
         Vec::&lt;String&gt;::deserialize(deserializer)?
             .into_iter()
             .map(|node| {
<span class="term-fg31">-                Ok(Nibbles::unpack(</span>
<span class="term-fg32">+                Ok(unpack_nibbles(</span>
                     alloy_primitives::hex::decode(node)
                         .map_err(|err| D::Error::custom(err.to_string()))?,
                 ))
<span class="term-fg36">@@ -265,7 +267,7 @@</span> &#47;&#47;&#47;
 &#47;&#47;&#47; This also sorts the map&#39;s keys before encoding and serializing.
 #[cfg(any(test, feature = &quot;serde&quot;))]
 mod serde_nibbles_map {
<span class="term-fg31">-    use crate::Nibbles;</span>
<span class="term-fg32">+    use crate::{pack_nibbles, unpack_nibbles, Nibbles};</span>
     use alloy_primitives::{hex, map::HashMap};
     use serde::{
         de::{Error, MapAccess, Visitor},
<span class="term-fg36">@@ -287,7 +289,7 @@</span>         let mut storage_nodes = Vec::from_iter(map);
         storage_nodes.sort_unstable_by_key(|node| node.0);
         for (k, v) in storage_nodes {
             &#47;&#47; pack, then hex encode the Nibbles
<span class="term-fg31">-            let packed = alloy_primitives::hex::encode(k.pack());</span>
<span class="term-fg32">+            let packed = alloy_primitives::hex::encode(pack_nibbles(k));</span>
             map_serializer.serialize_entry(&amp;packed, &amp;v)?;
         }
         map_serializer.end()
<span class="term-fg36">@@ -325,7 +327,7 @@</span>                 while let Some((key, value)) = map.next_entry::&lt;String, T&gt;()? {
                     let decoded_key =
                         hex::decode(&amp;key).map_err(|err| Error::custom(err.to_string()))?;
&nbsp;
<span class="term-fg31">-                    let nibbles = Nibbles::unpack(&amp;decoded_key);</span>
<span class="term-fg32">+                    let nibbles = unpack_nibbles(&amp;decoded_key);</span>
&nbsp;
                     result.insert(nibbles, value);
                 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-786fddba07f64bf2b2ffe1d7" role="button"
                       aria-expanded="false" aria-controls="id-786fddba07f64bf2b2ffe1d7">
                        <code>crates/trie/db/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/db/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/db/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-786fddba07f64bf2b2ffe1d7"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;Cargo.toml scroll-reth&#47;crates&#47;trie&#47;db&#47;Cargo.toml</span>
<span class="term-fg1">index 2fbdf1d5756119af2bb774b4c34842b5e9dae8b7..e6ae8f1774e3ee3e1d5b965ab6d1a537d704c41b 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;Cargo.toml</span>
<span class="term-fg36">@@ -54,6 +54,8 @@</span> reth-trie = { workspace = true, features = [&quot;test-utils&quot;] }
&nbsp;
 alloy-consensus.workspace = true
&nbsp;
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+</span>
 # trie
 triehash = &quot;0.8&quot;
&nbsp;
<span class="term-fg36">@@ -74,6 +76,7 @@</span> 	&quot;alloy-primitives&#47;serde&quot;,
 	&quot;reth-trie&#47;serde&quot;,
 	&quot;reth-trie-common&#47;serde&quot;,
 	&quot;reth-provider&#47;serde&quot;,
<span class="term-fg32">+	&quot;reth-scroll-primitives&#47;serde&quot;</span>
 ]
 test-utils = [
 	&quot;triehash&quot;,
<span class="term-fg36">@@ -86,3 +89,10 @@</span> 	&quot;reth-db-api&#47;test-utils&quot;,
 	&quot;reth-provider&#47;test-utils&quot;,
 	&quot;reth-trie&#47;test-utils&quot;,
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-trie-common&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;revm&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5d03132a140b370018338fda" role="button"
                       aria-expanded="false" aria-controls="id-5d03132a140b370018338fda">
                        <code>crates/trie/db/src/prefix_set.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/db/src/prefix_set.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/db/src/prefix_set.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+21</span></div>
                            <div class="text-start"><span class="text-danger">-12</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5d03132a140b370018338fda"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;src&#47;prefix_set.rs scroll-reth&#47;crates&#47;trie&#47;db&#47;src&#47;prefix_set.rs</span>
<span class="term-fg1">index ac8c3b05304cd6f3ab6efb9576dc55deb36fd2cf..b4a55ddb6851f08fa8f491ac2c621206a347a1e8 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;src&#47;prefix_set.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;src&#47;prefix_set.rs</span>
<span class="term-fg36">@@ -1,4 +1,4 @@</span>
<span class="term-fg31">-use alloy_primitives::{keccak256, BlockNumber, B256};</span>
<span class="term-fg32">+use alloy_primitives::{BlockNumber, B256};</span>
 use derive_more::Deref;
 use reth_db::tables;
 use reth_db_api::{
<span class="term-fg36">@@ -10,25 +10,34 @@</span> };
 use reth_primitives::StorageEntry;
 use reth_trie::{
     prefix_set::{PrefixSetMut, TriePrefixSets},
<span class="term-fg31">-    Nibbles,</span>
<span class="term-fg32">+    unpack_nibbles, KeyHasher,</span>
 };
 use std::{
     collections::{HashMap, HashSet},
<span class="term-fg32">+    marker::PhantomData,</span>
     ops::RangeInclusive,
 };
&nbsp;
 &#47;&#47;&#47; A wrapper around a database transaction that loads prefix sets within a given block range.
<span class="term-fg31">-#[derive(Deref, Debug)]</span>
<span class="term-fg31">-pub struct PrefixSetLoader&lt;&#39;a, TX&gt;(&amp;&#39;a TX);</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct PrefixSetLoader&lt;&#39;a, TX, KH&gt;(&amp;&#39;a TX, PhantomData&lt;KH&gt;);</span>
&nbsp;
<span class="term-fg31">-impl&lt;&#39;a, TX&gt; PrefixSetLoader&lt;&#39;a, TX&gt; {</span>
<span class="term-fg32">+impl&lt;&#39;a, TX, KH&gt; PrefixSetLoader&lt;&#39;a, TX, KH&gt; {</span>
     &#47;&#47;&#47; Create a new loader.
     pub const fn new(tx: &amp;&#39;a TX) -&gt; Self {
<span class="term-fg31">-        Self(tx)</span>
<span class="term-fg32">+        Self(tx, PhantomData)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;TX, KH&gt; Deref for PrefixSetLoader&lt;&#39;_, TX, KH&gt; {</span>
<span class="term-fg32">+    type Target = TX;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn deref(&amp;self) -&gt; &amp;Self::Target {</span>
<span class="term-fg32">+        self.0</span>
     }
 }
&nbsp;
<span class="term-fg31">-impl&lt;TX: DbTx&gt; PrefixSetLoader&lt;&#39;_, TX&gt; {</span>
<span class="term-fg32">+impl&lt;TX: DbTx, KH: KeyHasher&gt; PrefixSetLoader&lt;&#39;_, TX, KH&gt; {</span>
     &#47;&#47;&#47; Load all account and storage changes for the given block range.
     pub fn load(self, range: RangeInclusive&lt;BlockNumber&gt;) -&gt; Result&lt;TriePrefixSets, DatabaseError&gt; {
         &#47;&#47; Initialize prefix sets.
<span class="term-fg36">@@ -41,8 +50,8 @@</span>         let mut account_changeset_cursor = self.cursor_read::&lt;tables::AccountChangeSets&gt;()?;
         let mut account_hashed_state_cursor = self.cursor_read::&lt;tables::HashedAccounts&gt;()?;
         for account_entry in account_changeset_cursor.walk_range(range.clone())? {
             let (_, AccountBeforeTx { address, .. }) = account_entry?;
<span class="term-fg31">-            let hashed_address = keccak256(address);</span>
<span class="term-fg31">-            account_prefix_set.insert(Nibbles::unpack(hashed_address));</span>
<span class="term-fg32">+            let hashed_address = KH::hash_key(address);</span>
<span class="term-fg32">+            account_prefix_set.insert(unpack_nibbles(hashed_address));</span>
&nbsp;
             if account_hashed_state_cursor.seek_exact(hashed_address)?.is_none() {
                 destroyed_accounts.insert(hashed_address);
<span class="term-fg36">@@ -55,12 +64,12 @@</span>         let mut storage_cursor = self.cursor_dup_read::&lt;tables::StorageChangeSets&gt;()?;
         let storage_range = BlockNumberAddress::range(range);
         for storage_entry in storage_cursor.walk_range(storage_range)? {
             let (BlockNumberAddress((_, address)), StorageEntry { key, .. }) = storage_entry?;
<span class="term-fg31">-            let hashed_address = keccak256(address);</span>
<span class="term-fg31">-            account_prefix_set.insert(Nibbles::unpack(hashed_address));</span>
<span class="term-fg32">+            let hashed_address = KH::hash_key(address);</span>
<span class="term-fg32">+            account_prefix_set.insert(unpack_nibbles(hashed_address));</span>
             storage_prefix_sets
                 .entry(hashed_address)
                 .or_default()
<span class="term-fg31">-                .insert(Nibbles::unpack(keccak256(key)));</span>
<span class="term-fg32">+                .insert(unpack_nibbles(KH::hash_key(key)));</span>
         }
&nbsp;
         Ok(TriePrefixSets {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d16fab9921500c4a5e68449f" role="button"
                       aria-expanded="false" aria-controls="id-d16fab9921500c4a5e68449f">
                        <code>crates/trie/db/src/state.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/db/src/state.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/db/src/state.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+68</span></div>
                            <div class="text-start"><span class="text-danger">-15</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d16fab9921500c4a5e68449f"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;src&#47;state.rs scroll-reth&#47;crates&#47;trie&#47;db&#47;src&#47;state.rs</span>
<span class="term-fg1">index 6e2cea5051d0f5f0af01b419e9cdf723c6435e6e..1452fecbb48aac0695e432fb49ee1d3d8179bf59 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;src&#47;state.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;src&#47;state.rs</span>
<span class="term-fg36">@@ -1,5 +1,5 @@</span>
 use crate::{DatabaseHashedCursorFactory, DatabaseTrieCursorFactory, PrefixSetLoader};
<span class="term-fg31">-use alloy_primitives::{keccak256, Address, BlockNumber, B256, U256};</span>
<span class="term-fg32">+use alloy_primitives::{Address, BlockNumber, B256, U256};</span>
 use reth_db::tables;
 use reth_db_api::{
     cursor::DbCursorRO,
<span class="term-fg36">@@ -9,8 +9,10 @@</span> };
 use reth_execution_errors::StateRootError;
 use reth_storage_errors::db::DatabaseError;
 use reth_trie::{
<span class="term-fg31">-    hashed_cursor::HashedPostStateCursorFactory, trie_cursor::InMemoryTrieCursorFactory,</span>
<span class="term-fg31">-    updates::TrieUpdates, HashedPostState, HashedStorage, StateRoot, StateRootProgress, TrieInput,</span>
<span class="term-fg32">+    hashed_cursor::HashedPostStateCursorFactory, prefix_set::TriePrefixSets,</span>
<span class="term-fg32">+    trie_cursor::InMemoryTrieCursorFactory, updates::TrieUpdates, HashedPostState,</span>
<span class="term-fg32">+    HashedPostStateSorted, HashedStorage, IntermediateStateRootState, KeccakKeyHasher, KeyHasher,</span>
<span class="term-fg32">+    StateRoot, StateRootProgress, TrieInput,</span>
 };
 use std::{collections::HashMap, ops::RangeInclusive};
 use tracing::debug;
<span class="term-fg36">@@ -87,7 +89,13 @@</span>     &#47;&#47;&#47; &#47;&#47; Initialize hashed post state
     &#47;&#47;&#47; let mut hashed_state = HashedPostState::default();
     &#47;&#47;&#47; hashed_state.accounts.insert(
     &#47;&#47;&#47;     [0x11; 32].into(),
<span class="term-fg31">-    &#47;&#47;&#47;     Some(Account { nonce: 1, balance: U256::from(10), bytecode_hash: None }),</span>
<span class="term-fg32">+    &#47;&#47;&#47;     Some(Account {</span>
<span class="term-fg32">+    &#47;&#47;&#47;         nonce: 1,</span>
<span class="term-fg32">+    &#47;&#47;&#47;         balance: U256::from(10),</span>
<span class="term-fg32">+    &#47;&#47;&#47;         bytecode_hash: None,</span>
<span class="term-fg32">+    &#47;&#47;&#47;         #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    &#47;&#47;&#47;         account_extension: None,</span>
<span class="term-fg32">+    &#47;&#47;&#47;     }),</span>
     &#47;&#47;&#47; );
     &#47;&#47;&#47;
     &#47;&#47;&#47; &#47;&#47; Calculate the state root
<span class="term-fg36">@@ -105,7 +113,7 @@</span>     &#47;&#47;&#47; updates. See [`Self::overlay_root`] for more info.
     fn overlay_root_with_updates(
         tx: &amp;&#39;a TX,
         post_state: HashedPostState,
<span class="term-fg31">-    ) -&gt; Result&lt;(B256, TrieUpdates), StateRootError&gt;;</span>
<span class="term-fg32">+    ) -&gt; Result&lt;(B256, TrieUpdates, HashedPostStateSorted), StateRootError&gt;;</span>
&nbsp;
     &#47;&#47;&#47; Calculates the state root for provided [`HashedPostState`] using cached intermediate nodes.
     fn overlay_root_from_nodes(tx: &amp;&#39;a TX, input: TrieInput) -&gt; Result&lt;B256, StateRootError&gt;;
<span class="term-fg36">@@ -116,13 +124,34 @@</span>     fn overlay_root_from_nodes_with_updates(
         tx: &amp;&#39;a TX,
         input: TrieInput,
     ) -&gt; Result&lt;(B256, TrieUpdates), StateRootError&gt;;
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Calculates the state root for the current state stored in the database.</span>
<span class="term-fg32">+    fn root(tx: &amp;&#39;a TX) -&gt; Result&lt;B256, StateRootError&gt;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Calculates the state root for the current state stored in the database and returns</span>
<span class="term-fg32">+    &#47;&#47;&#47; trie updates.</span>
<span class="term-fg32">+    fn root_with_updates(tx: &amp;&#39;a TX) -&gt; Result&lt;(B256, TrieUpdates), StateRootError&gt;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Calculates the state root for the current state stored in the database updating the paths</span>
<span class="term-fg32">+    &#47;&#47;&#47; associated with the provided prefix sets and returns the trie updates.</span>
<span class="term-fg32">+    fn root_from_prefix_sets_with_updates(</span>
<span class="term-fg32">+        tx: &amp;&#39;a TX,</span>
<span class="term-fg32">+        prefix_sets: TriePrefixSets,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;(B256, TrieUpdates), StateRootError&gt;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Calculates the state root for the current state stored in the database and returns the</span>
<span class="term-fg32">+    &#47;&#47;&#47; intermediate progress of the computation.</span>
<span class="term-fg32">+    fn root_with_progress(</span>
<span class="term-fg32">+        tx: &amp;&#39;a TX,</span>
<span class="term-fg32">+        state: Option&lt;IntermediateStateRootState&gt;,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;StateRootProgress, StateRootError&gt;;</span>
 }
&nbsp;
 &#47;&#47;&#47; Extends [`HashedPostState`] with operations specific for working with a database transaction.
 pub trait DatabaseHashedPostState&lt;TX&gt;: Sized {
     &#47;&#47;&#47; Initializes [`HashedPostState`] from reverts. Iterates over state reverts from the specified
     &#47;&#47;&#47; block up to the current tip and aggregates them into hashed state in reverse.
<span class="term-fg31">-    fn from_reverts(tx: &amp;TX, from: BlockNumber) -&gt; Result&lt;Self, DatabaseError&gt;;</span>
<span class="term-fg32">+    fn from_reverts&lt;KH: KeyHasher&gt;(tx: &amp;TX, from: BlockNumber) -&gt; Result&lt;Self, DatabaseError&gt;;</span>
 }
&nbsp;
 impl&lt;&#39;a, TX: DbTx&gt; DatabaseStateRoot&lt;&#39;a, TX&gt;
<span class="term-fg36">@@ -136,7 +165,7 @@</span>     fn incremental_root_calculator(
         tx: &amp;&#39;a TX,
         range: RangeInclusive&lt;BlockNumber&gt;,
     ) -&gt; Result&lt;Self, StateRootError&gt; {
<span class="term-fg31">-        let loaded_prefix_sets = PrefixSetLoader::new(tx).load(range)?;</span>
<span class="term-fg32">+        let loaded_prefix_sets = PrefixSetLoader::&lt;_, KeccakKeyHasher&gt;::new(tx).load(range)?;</span>
         Ok(Self::from_tx(tx).with_prefix_sets(loaded_prefix_sets))
     }
&nbsp;
<span class="term-fg36">@@ -178,15 +207,16 @@</span>
     fn overlay_root_with_updates(
         tx: &amp;&#39;a TX,
         post_state: HashedPostState,
<span class="term-fg31">-    ) -&gt; Result&lt;(B256, TrieUpdates), StateRootError&gt; {</span>
<span class="term-fg32">+    ) -&gt; Result&lt;(B256, TrieUpdates, HashedPostStateSorted), StateRootError&gt; {</span>
         let prefix_sets = post_state.construct_prefix_sets().freeze();
         let state_sorted = post_state.into_sorted();
<span class="term-fg31">-        StateRoot::new(</span>
<span class="term-fg32">+        let (root, updates) = StateRoot::new(</span>
             DatabaseTrieCursorFactory::new(tx),
             HashedPostStateCursorFactory::new(DatabaseHashedCursorFactory::new(tx), &amp;state_sorted),
         )
         .with_prefix_sets(prefix_sets)
<span class="term-fg31">-        .root_with_updates()</span>
<span class="term-fg32">+        .root_with_updates()?;</span>
<span class="term-fg32">+        Ok((root, updates, state_sorted))</span>
     }
&nbsp;
     fn overlay_root_from_nodes(tx: &amp;&#39;a TX, input: TrieInput) -&gt; Result&lt;B256, StateRootError&gt; {
<span class="term-fg36">@@ -213,10 +243,32 @@</span>         )
         .with_prefix_sets(input.prefix_sets.freeze())
         .root_with_updates()
     }
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn root(tx: &amp;&#39;a TX) -&gt; Result&lt;B256, StateRootError&gt; {</span>
<span class="term-fg32">+        Self::from_tx(tx).root()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn root_with_updates(tx: &amp;&#39;a TX) -&gt; Result&lt;(B256, TrieUpdates), StateRootError&gt; {</span>
<span class="term-fg32">+        Self::from_tx(tx).root_with_updates()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn root_from_prefix_sets_with_updates(</span>
<span class="term-fg32">+        tx: &amp;&#39;a TX,</span>
<span class="term-fg32">+        prefix_sets: TriePrefixSets,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;(B256, TrieUpdates), StateRootError&gt; {</span>
<span class="term-fg32">+        Self::from_tx(tx).with_prefix_sets(prefix_sets).root_with_updates()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn root_with_progress(</span>
<span class="term-fg32">+        tx: &amp;&#39;a TX,</span>
<span class="term-fg32">+        state: Option&lt;IntermediateStateRootState&gt;,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;StateRootProgress, StateRootError&gt; {</span>
<span class="term-fg32">+        Self::from_tx(tx).with_intermediate_state(state).root_with_progress()</span>
<span class="term-fg32">+    }</span>
 }
&nbsp;
 impl&lt;TX: DbTx&gt; DatabaseHashedPostState&lt;TX&gt; for HashedPostState {
<span class="term-fg31">-    fn from_reverts(tx: &amp;TX, from: BlockNumber) -&gt; Result&lt;Self, DatabaseError&gt; {</span>
<span class="term-fg32">+    fn from_reverts&lt;KH: KeyHasher&gt;(tx: &amp;TX, from: BlockNumber) -&gt; Result&lt;Self, DatabaseError&gt; {</span>
         &#47;&#47; Iterate over account changesets and record value before first occurring account change.
         let mut accounts = HashMap::new();
         let mut account_changesets_cursor = tx.cursor_read::&lt;tables::AccountChangeSets&gt;()?;
<span class="term-fg36">@@ -237,19 +289,19 @@</span>             account_storage.entry(storage.key).or_insert(storage.value);
         }
&nbsp;
         let hashed_accounts =
<span class="term-fg31">-            accounts.into_iter().map(|(address, info)| (keccak256(address), info)).collect();</span>
<span class="term-fg32">+            accounts.into_iter().map(|(address, info)| (KH::hash_key(address), info)).collect();</span>
&nbsp;
         let hashed_storages = storages
             .into_iter()
             .map(|(address, storage)| {
                 (
<span class="term-fg31">-                    keccak256(address),</span>
<span class="term-fg32">+                    KH::hash_key(address),</span>
                     HashedStorage::from_iter(
                         &#47;&#47; The `wiped` flag indicates only whether previous storage entries
                         &#47;&#47; should be looked up in db or not. For reverts it&#39;s a noop since all
                         &#47;&#47; wiped changes had been written as storage reverts.
                         false,
<span class="term-fg31">-                        storage.into_iter().map(|(slot, value)| (keccak256(slot), value)),</span>
<span class="term-fg32">+                        storage.into_iter().map(|(slot, value)| (KH::hash_key(slot), value)),</span>
                     ),
                 )
             })
<span class="term-fg36">@@ -265,6 +317,7 @@</span>     use super::*;
     use alloy_primitives::{hex, map::HashMap, Address, U256};
     use reth_db::test_utils::create_test_rw_db;
     use reth_db_api::database::Database;
<span class="term-fg32">+    use reth_trie::KeccakKeyHasher;</span>
     use revm::{db::BundleState, primitives::AccountInfo};
&nbsp;
     #[test]
<span class="term-fg36">@@ -285,7 +338,7 @@</span>             .state_storage(address2, HashMap::from_iter([(slot2, (U256::ZERO, U256::from(20)))]))
             .build();
         assert_eq!(bundle_state.reverts.len(), 1);
&nbsp;
<span class="term-fg31">-        let post_state = HashedPostState::from_bundle_state(&amp;bundle_state.state);</span>
<span class="term-fg32">+        let post_state = HashedPostState::from_bundle_state::&lt;KeccakKeyHasher&gt;(&amp;bundle_state.state);</span>
         assert_eq!(post_state.accounts.len(), 2);
         assert_eq!(post_state.storages.len(), 2);
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-588a261220bb1e78095a0368" role="button"
                       aria-expanded="false" aria-controls="id-588a261220bb1e78095a0368">
                        <code>crates/trie/db/src/storage.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/db/src/storage.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/db/src/storage.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-588a261220bb1e78095a0368"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;src&#47;storage.rs scroll-reth&#47;crates&#47;trie&#47;db&#47;src&#47;storage.rs</span>
<span class="term-fg1">index 6a3bbe1b9651b56af613192a49ed9d28183ac4f2..c2aa04ee98adeba0349cf0408a3203f933e23c05 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;src&#47;storage.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;src&#47;storage.rs</span>
<span class="term-fg36">@@ -6,7 +6,8 @@</span> use reth_db::{cursor::DbCursorRO, models::BlockNumberAddress, tables, DatabaseError};
 use reth_db_api::transaction::DbTx;
 use reth_execution_errors::StorageRootError;
 use reth_trie::{
<span class="term-fg31">-    hashed_cursor::HashedPostStateCursorFactory, HashedPostState, HashedStorage, StorageRoot,</span>
<span class="term-fg32">+    hashed_cursor::HashedPostStateCursorFactory, HashedPostState, HashedStorage, KeyHasher,</span>
<span class="term-fg32">+    StorageRoot,</span>
 };
&nbsp;
 #[cfg(feature = &quot;metrics&quot;)]
<span class="term-fg36">@@ -32,7 +33,11 @@</span> &#47;&#47;&#47; Extends [`HashedStorage`] with operations specific for working with a database transaction.
 pub trait DatabaseHashedStorage&lt;TX&gt;: Sized {
     &#47;&#47;&#47; Initializes [`HashedStorage`] from reverts. Iterates over storage reverts from the specified
     &#47;&#47;&#47; block up to the current tip and aggregates them into hashed storage in reverse.
<span class="term-fg31">-    fn from_reverts(tx: &amp;TX, address: Address, from: BlockNumber) -&gt; Result&lt;Self, DatabaseError&gt;;</span>
<span class="term-fg32">+    fn from_reverts&lt;KH: KeyHasher&gt;(</span>
<span class="term-fg32">+        tx: &amp;TX,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        from: BlockNumber,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;Self, DatabaseError&gt;;</span>
 }
&nbsp;
 impl&lt;&#39;a, TX: DbTx&gt; DatabaseStorageRoot&lt;&#39;a, TX&gt;
<span class="term-fg36">@@ -79,13 +84,17 @@</span>     }
 }
&nbsp;
 impl&lt;TX: DbTx&gt; DatabaseHashedStorage&lt;TX&gt; for HashedStorage {
<span class="term-fg31">-    fn from_reverts(tx: &amp;TX, address: Address, from: BlockNumber) -&gt; Result&lt;Self, DatabaseError&gt; {</span>
<span class="term-fg32">+    fn from_reverts&lt;KH: KeyHasher&gt;(</span>
<span class="term-fg32">+        tx: &amp;TX,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        from: BlockNumber,</span>
<span class="term-fg32">+    ) -&gt; Result&lt;Self, DatabaseError&gt; {</span>
         let mut storage = Self::new(false);
         let mut storage_changesets_cursor = tx.cursor_read::&lt;tables::StorageChangeSets&gt;()?;
         for entry in storage_changesets_cursor.walk_range(BlockNumberAddress((from, address))..)? {
             let (BlockNumberAddress((_, storage_address)), storage_change) = entry?;
             if storage_address == address {
<span class="term-fg31">-                let hashed_slot = keccak256(storage_change.key);</span>
<span class="term-fg32">+                let hashed_slot = KH::hash_key(storage_change.key);</span>
                 if let hash_map::Entry::Vacant(entry) = storage.storage.entry(hashed_slot) {
                     entry.insert(storage_change.value);
                 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d66bcdadd60ab9e1172b4721" role="button"
                       aria-expanded="false" aria-controls="id-d66bcdadd60ab9e1172b4721">
                        <code>crates/trie/db/tests/proof.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/db/tests/proof.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/db/tests/proof.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d66bcdadd60ab9e1172b4721"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;tests&#47;proof.rs scroll-reth&#47;crates&#47;trie&#47;db&#47;tests&#47;proof.rs</span>
<span class="term-fg1">index eedeee276db895e8afefb16bcf0ad269cfeb27e0..c2e86d77025b2dc1ce3f92d9a82045305316ef26 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;tests&#47;proof.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;tests&#47;proof.rs</span>
<span class="term-fg36">@@ -198,7 +198,10 @@</span>         address: target,
         info:  Some(Account {
             balance: U256::ZERO,
             nonce: 0,
<span class="term-fg31">-            bytecode_hash: Some(B256::from_str(&quot;0x2034f79e0e33b0ae6bef948532021baceb116adf2616478703bec6b17329f1cc&quot;).unwrap())</span>
<span class="term-fg32">+            bytecode_hash: Some(B256::from_str(&quot;0x2034f79e0e33b0ae6bef948532021baceb116adf2616478703bec6b17329f1cc&quot;).unwrap()),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty())</span>
<span class="term-fg32">+</span>
         }),
         storage_root: B256::from_str(&quot;0x556a482068355939c95a3412bdb21213a301483edb1b64402fb66ac9f3583599&quot;).unwrap(),
         proof: convert_to_proof([</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4d4eb2d2e1f3b5480527e9d7" role="button"
                       aria-expanded="false" aria-controls="id-4d4eb2d2e1f3b5480527e9d7">
                        <code>crates/trie/db/tests/trie.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/db/tests/trie.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/db/tests/trie.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+50</span></div>
                            <div class="text-start"><span class="text-danger">-7</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4d4eb2d2e1f3b5480527e9d7"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;tests&#47;trie.rs scroll-reth&#47;crates&#47;trie&#47;db&#47;tests&#47;trie.rs</span>
<span class="term-fg1">index 4c614d83be6c8d67170f8bf9046aef41ab70c5ca..a0652107ca6a1137a4630da8f491aa3d0ac8b9b1 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;tests&#47;trie.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;tests&#47;trie.rs</span>
<span class="term-fg36">@@ -137,14 +137,26 @@</span>     let state: State = BTreeMap::from([
         (
             Address::random(),
             (
<span class="term-fg31">-                Account { nonce: 0, balance: U256::from(0), bytecode_hash: None },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance: U256::from(0),</span>
<span class="term-fg32">+                    bytecode_hash: None,</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                },</span>
                 BTreeMap::from([(B256::with_last_byte(0x4), U256::from(12))]),
             ),
         ),
         (
             Address::random(),
             (
<span class="term-fg31">-                Account { nonce: 0, balance: U256::from(0), bytecode_hash: None },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance: U256::from(0),</span>
<span class="term-fg32">+                    bytecode_hash: None,</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                },</span>
                 BTreeMap::default(),
             ),
         ),
<span class="term-fg36">@@ -155,6 +167,10 @@</span>                 Account {
                     nonce: 155,
                     balance: U256::from(414241124u32),
                     bytecode_hash: Some(keccak256(&quot;test&quot;)),
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(b&quot;test&quot;),</span>
<span class="term-fg32">+                    ),</span>
                 },
                 BTreeMap::from([
                     (B256::ZERO, U256::from(3)),
<span class="term-fg36">@@ -178,6 +194,8 @@</span>     let account = Account {
         nonce: 155,
         balance: U256::from(414241124u32),
         bytecode_hash: Some(keccak256(code)),
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code)),</span>
     };
     insert_account(tx.tx_ref(), address, account, &amp;Default::default());
     tx.commit().unwrap();
<span class="term-fg36">@@ -202,6 +220,8 @@</span>     let account = Account {
         nonce: 155,
         balance: U256::from(414241124u32),
         bytecode_hash: Some(keccak256(code)),
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code)),</span>
     };
&nbsp;
     insert_account(tx.tx_ref(), address, account, &amp;storage);
<span class="term-fg36">@@ -348,7 +368,13 @@</span>
     &#47;&#47; Insert first account
     let key1 =
         B256::from_str(&quot;b000000000000000000000000000000000000000000000000000000000000000&quot;).unwrap();
<span class="term-fg31">-    let account1 = Account { nonce: 0, balance: U256::from(3).mul(ether), bytecode_hash: None };</span>
<span class="term-fg32">+    let account1 = Account {</span>
<span class="term-fg32">+        nonce: 0,</span>
<span class="term-fg32">+        balance: U256::from(3).mul(ether),</span>
<span class="term-fg32">+        bytecode_hash: None,</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+    };</span>
     hashed_account_cursor.upsert(key1, account1).unwrap();
     hash_builder.add_leaf(Nibbles::unpack(key1), &amp;encode_account(account1, None));
&nbsp;
<span class="term-fg36">@@ -368,8 +394,13 @@</span>     assert_eq!(key3[0], 0xB0);
     assert_eq!(key3[1], 0x41);
     let code_hash =
         B256::from_str(&quot;5be74cad16203c4905c068b012a2e9fb6d19d036c410f16fd177f337541440dd&quot;).unwrap();
<span class="term-fg31">-    let account3 =</span>
<span class="term-fg31">-        Account { nonce: 0, balance: U256::from(2).mul(ether), bytecode_hash: Some(code_hash) };</span>
<span class="term-fg32">+    let account3 = Account {</span>
<span class="term-fg32">+        nonce: 0,</span>
<span class="term-fg32">+        balance: U256::from(2).mul(ether),</span>
<span class="term-fg32">+        bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some((10, B256::random()).into()),</span>
<span class="term-fg32">+    };</span>
     hashed_account_cursor.upsert(key3, account3).unwrap();
     for (hashed_slot, value) in storage {
         if hashed_storage_cursor
<span class="term-fg36">@@ -451,7 +482,13 @@</span>     &#47;&#47; Some address whose hash starts with 0xB1
     let address4b = Address::from_str(&quot;4f61f2d5ebd991b85aa1677db97307caf5215c91&quot;).unwrap();
     let key4b = keccak256(address4b);
     assert_eq!(key4b.0[0], key4a.0[0]);
<span class="term-fg31">-    let account4b = Account { nonce: 0, balance: U256::from(5).mul(ether), bytecode_hash: None };</span>
<span class="term-fg32">+    let account4b = Account {</span>
<span class="term-fg32">+        nonce: 0,</span>
<span class="term-fg32">+        balance: U256::from(5).mul(ether),</span>
<span class="term-fg32">+        bytecode_hash: None,</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+    };</span>
     hashed_account_cursor.upsert(key4b, account4b).unwrap();
&nbsp;
     let mut prefix_set = PrefixSetMut::default();
<span class="term-fg36">@@ -716,7 +753,13 @@</span>
 fn extension_node_trie&lt;N: ProviderNodeTypes&gt;(
     tx: &amp;DatabaseProviderRW&lt;Arc&lt;TempDatabase&lt;DatabaseEnv&gt;&gt;, N&gt;,
 ) -&gt; B256 {
<span class="term-fg31">-    let a = Account { nonce: 0, balance: U256::from(1u64), bytecode_hash: Some(B256::random()) };</span>
<span class="term-fg32">+    let a = Account {</span>
<span class="term-fg32">+        nonce: 0,</span>
<span class="term-fg32">+        balance: U256::from(1u64),</span>
<span class="term-fg32">+        bytecode_hash: Some(B256::random()),</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some((10, B256::random()).into()),</span>
<span class="term-fg32">+    };</span>
     let val = encode_account(a, None);
&nbsp;
     let mut hashed_accounts = tx.tx_ref().cursor_write::&lt;tables::HashedAccounts&gt;().unwrap();</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b1ea48b2fe95e193c1698e7f" role="button"
                       aria-expanded="false" aria-controls="id-b1ea48b2fe95e193c1698e7f">
                        <code>crates/trie/parallel/src/proof.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/parallel/src/proof.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/parallel/src/proof.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+7</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b1ea48b2fe95e193c1698e7f"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;parallel&#47;src&#47;proof.rs scroll-reth&#47;crates&#47;trie&#47;parallel&#47;src&#47;proof.rs</span>
<span class="term-fg1">index f285079f25263d2fd7c377b74e91a9f6809bc995..fbe7fa55baedba2c7e8b61c0082ae00f3876b0b5 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;parallel&#47;src&#47;proof.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;parallel&#47;src&#47;proof.rs</span>
<span class="term-fg36">@@ -9,6 +9,7 @@</span> use reth_db::DatabaseError;
 use reth_execution_errors::StorageRootError;
 use reth_provider::{
     providers::ConsistentDbView, BlockReader, DBProvider, DatabaseProviderFactory, ProviderError,
<span class="term-fg32">+    StateCommitmentProvider,</span>
 };
 use reth_trie::{
     hashed_cursor::{HashedCursorFactory, HashedPostStateCursorFactory},
<span class="term-fg36">@@ -53,7 +54,12 @@</span> }
&nbsp;
 impl&lt;Factory&gt; ParallelProof&lt;Factory&gt;
 where
<span class="term-fg31">-    Factory: DatabaseProviderFactory&lt;Provider: BlockReader&gt; + Clone + Send + Sync + &#39;static,</span>
<span class="term-fg32">+    Factory: DatabaseProviderFactory&lt;Provider: BlockReader&gt;</span>
<span class="term-fg32">+        + StateCommitmentProvider</span>
<span class="term-fg32">+        + Clone</span>
<span class="term-fg32">+        + Send</span>
<span class="term-fg32">+        + Sync</span>
<span class="term-fg32">+        + &#39;static,</span>
 {
     &#47;&#47;&#47; Generate a state multiproof according to specified targets.
     pub fn multiproof(</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6e3bae66c4e189f0fc71791b" role="button"
                       aria-expanded="false" aria-controls="id-6e3bae66c4e189f0fc71791b">
                        <code>crates/trie/parallel/src/root.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/parallel/src/root.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/parallel/src/root.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+7</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6e3bae66c4e189f0fc71791b"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;parallel&#47;src&#47;root.rs scroll-reth&#47;crates&#47;trie&#47;parallel&#47;src&#47;root.rs</span>
<span class="term-fg1">index 8d2b18f5e1113f358ef7493dcf57fdbb37a9b90f..e66d1f78213222690318783714c1eeade585a3e7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;parallel&#47;src&#47;root.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;parallel&#47;src&#47;root.rs</span>
<span class="term-fg36">@@ -8,6 +8,7 @@</span> use reth_db::DatabaseError;
 use reth_execution_errors::StorageRootError;
 use reth_provider::{
     providers::ConsistentDbView, BlockReader, DBProvider, DatabaseProviderFactory, ProviderError,
<span class="term-fg32">+    StateCommitmentProvider,</span>
 };
 use reth_trie::{
     hashed_cursor::{HashedCursorFactory, HashedPostStateCursorFactory},
<span class="term-fg36">@@ -58,7 +59,12 @@</span> }
&nbsp;
 impl&lt;Factory&gt; ParallelStateRoot&lt;Factory&gt;
 where
<span class="term-fg31">-    Factory: DatabaseProviderFactory&lt;Provider: BlockReader&gt; + Clone + Send + Sync + &#39;static,</span>
<span class="term-fg32">+    Factory: DatabaseProviderFactory&lt;Provider: BlockReader&gt;</span>
<span class="term-fg32">+        + StateCommitmentProvider</span>
<span class="term-fg32">+        + Clone</span>
<span class="term-fg32">+        + Send</span>
<span class="term-fg32">+        + Sync</span>
<span class="term-fg32">+        + &#39;static,</span>
 {
     &#47;&#47;&#47; Calculate incremental state root in parallel.
     pub fn incremental_root(self) -&gt; Result&lt;B256, ParallelStateRootError&gt; {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-276a5bd69c82de1f7cb1a1b8" role="button"
                       aria-expanded="false" aria-controls="id-276a5bd69c82de1f7cb1a1b8">
                        <code>crates/trie/trie/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/trie/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/trie/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-276a5bd69c82de1f7cb1a1b8"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;trie&#47;Cargo.toml scroll-reth&#47;crates&#47;trie&#47;trie&#47;Cargo.toml</span>
<span class="term-fg1">index c1c3ae4dd8763651c09445a386cf1edc260d9679..901941e744b6080d9621a205adbbbaec216bbbf7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;trie&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;trie&#47;Cargo.toml</span>
<span class="term-fg36">@@ -19,6 +19,8 @@</span> reth-stages-types.workspace = true
 reth-storage-errors.workspace = true
 reth-trie-common.workspace = true
&nbsp;
<span class="term-fg32">+# revm re-export scroll</span>
<span class="term-fg32">+reth-primitives-traits.workspace = true</span>
 revm.workspace = true
&nbsp;
 # alloy
<span class="term-fg36">@@ -63,14 +65,21 @@</span> 	&quot;alloy-primitives&#47;serde&quot;,
 	&quot;alloy-consensus&#47;serde&quot;,
 	&quot;alloy-trie&#47;serde&quot;,
 	&quot;revm&#47;serde&quot;,
<span class="term-fg31">-	&quot;reth-trie-common&#47;serde&quot;</span>
<span class="term-fg32">+	&quot;reth-trie-common&#47;serde&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;serde&quot;,</span>
 ]
 test-utils = [
 	&quot;triehash&quot;,
 	&quot;revm&#47;test-utils&quot;,
 	&quot;reth-primitives&#47;test-utils&quot;,
 	&quot;reth-trie-common&#47;test-utils&quot;,
<span class="term-fg31">-	&quot;reth-stages-types&#47;test-utils&quot;</span>
<span class="term-fg32">+	&quot;reth-stages-types&#47;test-utils&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;test-utils&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-trie-common&#47;scroll&quot;</span>
 ]
&nbsp;
 [[bench]]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d10ef6d48d2a4b8a412053bb" role="button"
                       aria-expanded="false" aria-controls="id-d10ef6d48d2a4b8a412053bb">
                        <code>crates/trie/trie/benches/hash_post_state.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/trie/benches/hash_post_state.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/trie/benches/hash_post_state.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d10ef6d48d2a4b8a412053bb"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;trie&#47;benches&#47;hash_post_state.rs scroll-reth&#47;crates&#47;trie&#47;trie&#47;benches&#47;hash_post_state.rs</span>
<span class="term-fg1">index 6e913ef78a3cbd419820a866dc84221a175fea1b..7111a785f4699617e5624a0c566a76eadad6ef7e 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;trie&#47;benches&#47;hash_post_state.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;trie&#47;benches&#47;hash_post_state.rs</span>
<span class="term-fg36">@@ -2,7 +2,7 @@</span> #![allow(missing_docs, unreachable_pub)]
 use alloy_primitives::{keccak256, map::HashMap, Address, B256, U256};
 use criterion::{criterion_group, criterion_main, BenchmarkId, Criterion};
 use proptest::{prelude::*, strategy::ValueTree, test_runner::TestRunner};
<span class="term-fg31">-use reth_trie::{HashedPostState, HashedStorage};</span>
<span class="term-fg32">+use reth_trie::{HashedPostState, HashedStorage, KeccakKeyHasher};</span>
 use revm::db::{states::BundleBuilder, BundleAccount};
&nbsp;
 pub fn hash_post_state(c: &amp;mut Criterion) {
<span class="term-fg36">@@ -19,7 +19,7 @@</span>         });
&nbsp;
         &#47;&#47; parallel
         group.bench_function(BenchmarkId::new(&quot;parallel hashing&quot;, size), |b| {
<span class="term-fg31">-            b.iter(|| HashedPostState::from_bundle_state(&amp;state))</span>
<span class="term-fg32">+            b.iter(|| HashedPostState::from_bundle_state::&lt;KeccakKeyHasher&gt;(&amp;state))</span>
         });
     }
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a8aa93adf83e579ba7e6cc48" role="button"
                       aria-expanded="false" aria-controls="id-a8aa93adf83e579ba7e6cc48">
                        <code>crates/trie/trie/src/node_iter.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/trie/src/node_iter.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/trie/src/node_iter.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a8aa93adf83e579ba7e6cc48"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;trie&#47;src&#47;node_iter.rs scroll-reth&#47;crates&#47;trie&#47;trie&#47;src&#47;node_iter.rs</span>
<span class="term-fg1">index 60219eedd7cb89d4750a934deb7eed3390f1fbbe..c38c3cc3155b73667068c1080d15498052c6c37e 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;trie&#47;src&#47;node_iter.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;trie&#47;src&#47;node_iter.rs</span>
<span class="term-fg36">@@ -1,6 +1,7 @@</span>
 use crate::{hashed_cursor::HashedCursor, trie_cursor::TrieCursor, walker::TrieWalker, Nibbles};
 use alloy_primitives::B256;
 use reth_storage_errors::db::DatabaseError;
<span class="term-fg32">+use reth_trie_common::unpack_nibbles;</span>
&nbsp;
 &#47;&#47;&#47; Represents a branch node in the trie.
 #[derive(Debug)]
<span class="term-fg36">@@ -106,7 +107,7 @@</span>             &#47;&#47; If there&#39;s a hashed entry...
             if let Some((hashed_key, value)) = self.current_hashed_entry.take() {
                 &#47;&#47; If the walker&#39;s key is less than the unpacked hashed key,
                 &#47;&#47; reset the checked status and continue
<span class="term-fg31">-                if self.walker.key().is_some_and(|key| key &lt; &amp;Nibbles::unpack(hashed_key)) {</span>
<span class="term-fg32">+                if self.walker.key().is_some_and(|key| key &lt; &amp;unpack_nibbles(hashed_key)) {</span>
                     self.current_walker_key_checked = false;
                     continue
                 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-37ab918e8febd1b04353d188" role="button"
                       aria-expanded="false" aria-controls="id-37ab918e8febd1b04353d188">
                        <code>crates/trie/trie/src/state.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/trie/src/state.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/trie/src/state.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+46</span></div>
                            <div class="text-start"><span class="text-danger">-23</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-37ab918e8febd1b04353d188"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;trie&#47;src&#47;state.rs scroll-reth&#47;crates&#47;trie&#47;trie&#47;src&#47;state.rs</span>
<span class="term-fg1">index fdfb86a53ddb26479bd59579b80d88afe3ebf7a6..e3a9c457c821a7029d06f60aa314f64220e640ac 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;trie&#47;src&#47;state.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;trie&#47;src&#47;state.rs</span>
<span class="term-fg36">@@ -1,15 +1,12 @@</span>
<span class="term-fg31">-use crate::{</span>
<span class="term-fg31">-    prefix_set::{PrefixSetMut, TriePrefixSetsMut},</span>
<span class="term-fg31">-    Nibbles,</span>
<span class="term-fg31">-};</span>
<span class="term-fg32">+use crate::prefix_set::{PrefixSetMut, TriePrefixSetsMut};</span>
 use alloy_primitives::{
<span class="term-fg31">-    keccak256,</span>
     map::{hash_map, HashMap, HashSet},
     Address, B256, U256,
 };
 use itertools::Itertools;
 use rayon::prelude::{IntoParallelIterator, ParallelIterator};
 use reth_primitives::Account;
<span class="term-fg32">+use reth_trie_common::{unpack_nibbles, KeyHasher};</span>
 use revm::db::{states::CacheAccount, AccountStatus, BundleAccount};
 use std::borrow::Cow;
&nbsp;
<span class="term-fg36">@@ -26,15 +23,15 @@</span> impl HashedPostState {
     &#47;&#47;&#47; Initialize [`HashedPostState`] from bundle state.
     &#47;&#47;&#47; Hashes all changed accounts and storage entries that are currently stored in the bundle
     &#47;&#47;&#47; state.
<span class="term-fg31">-    pub fn from_bundle_state&lt;&#39;a&gt;(</span>
<span class="term-fg32">+    pub fn from_bundle_state&lt;&#39;a, KH: KeyHasher&gt;(</span>
         state: impl IntoParallelIterator&lt;Item = (&amp;&#39;a Address, &amp;&#39;a BundleAccount)&gt;,
     ) -&gt; Self {
         let hashed = state
             .into_par_iter()
             .map(|(address, account)| {
<span class="term-fg31">-                let hashed_address = keccak256(address);</span>
<span class="term-fg32">+                let hashed_address = KH::hash_key(address);</span>
                 let hashed_account = account.info.clone().map(Into::into);
<span class="term-fg31">-                let hashed_storage = HashedStorage::from_plain_storage(</span>
<span class="term-fg32">+                let hashed_storage = HashedStorage::from_plain_storage::&lt;KH&gt;(</span>
                     account.status,
                     account.storage.iter().map(|(slot, value)| (slot, &amp;value.present_value)),
                 );
<span class="term-fg36">@@ -53,15 +50,16 @@</span>     }
&nbsp;
     &#47;&#47;&#47; Initialize [`HashedPostState`] from cached state.
     &#47;&#47;&#47; Hashes all changed accounts and storage entries that are currently stored in cache.
<span class="term-fg31">-    pub fn from_cache_state&lt;&#39;a&gt;(</span>
<span class="term-fg32">+    pub fn from_cache_state&lt;&#39;a, KH: KeyHasher&gt;(</span>
         state: impl IntoParallelIterator&lt;Item = (&amp;&#39;a Address, &amp;&#39;a CacheAccount)&gt;,
     ) -&gt; Self {
         let hashed = state
             .into_par_iter()
             .map(|(address, account)| {
<span class="term-fg31">-                let hashed_address = keccak256(address);</span>
<span class="term-fg31">-                let hashed_account = account.account.as_ref().map(|a| a.info.clone().into());</span>
<span class="term-fg31">-                let hashed_storage = HashedStorage::from_plain_storage(</span>
<span class="term-fg32">+                let hashed_address = KH::hash_key(address);</span>
<span class="term-fg32">+                let hashed_account =</span>
<span class="term-fg32">+                    account.account.as_ref().map(|a| Account::from_account_info(a.info.clone()));</span>
<span class="term-fg32">+                let hashed_storage = HashedStorage::from_plain_storage::&lt;KH&gt;(</span>
                     account.status,
                     account.account.as_ref().map(|a| a.storage.iter()).into_iter().flatten(),
                 );
<span class="term-fg36">@@ -117,7 +115,8 @@</span>         &#47;&#47; Populate account prefix set.
         let mut account_prefix_set = PrefixSetMut::with_capacity(self.accounts.len());
         let mut destroyed_accounts = HashSet::default();
         for (hashed_address, account) in &amp;self.accounts {
<span class="term-fg31">-            account_prefix_set.insert(Nibbles::unpack(hashed_address));</span>
<span class="term-fg32">+            &#47;&#47; TODO(scroll): replace this with abstraction.</span>
<span class="term-fg32">+            account_prefix_set.insert(unpack_nibbles(hashed_address));</span>
&nbsp;
             if account.is_none() {
                 destroyed_accounts.insert(*hashed_address);
<span class="term-fg36">@@ -128,7 +127,8 @@</span>         &#47;&#47; Populate storage prefix sets.
         let mut storage_prefix_sets =
             HashMap::with_capacity_and_hasher(self.storages.len(), Default::default());
         for (hashed_address, hashed_storage) in &amp;self.storages {
<span class="term-fg31">-            account_prefix_set.insert(Nibbles::unpack(hashed_address));</span>
<span class="term-fg32">+            &#47;&#47; TODO(scroll): replace this with abstraction.</span>
<span class="term-fg32">+            account_prefix_set.insert(unpack_nibbles(hashed_address));</span>
             storage_prefix_sets.insert(*hashed_address, hashed_storage.construct_prefix_set());
         }
&nbsp;
<span class="term-fg36">@@ -223,14 +223,25 @@</span>     pub fn from_iter(wiped: bool, iter: impl IntoIterator&lt;Item = (B256, U256)&gt;) -&gt; Self {
         Self { wiped, storage: HashMap::from_iter(iter) }
     }
&nbsp;
<span class="term-fg32">+    &#47;&#47;&#47; Create a new hashed storage from the provided [`BundleAccount`]</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; This function will use the present value of the storage slots in the account to create the</span>
<span class="term-fg32">+    &#47;&#47;&#47; hashed storage.</span>
<span class="term-fg32">+    pub fn from_bundle_account&lt;KH: KeyHasher&gt;(account: &amp;BundleAccount) -&gt; Self {</span>
<span class="term-fg32">+        Self::from_plain_storage::&lt;KH&gt;(</span>
<span class="term-fg32">+            account.status,</span>
<span class="term-fg32">+            account.storage.iter().map(|(slot, value)| (slot, &amp;value.present_value)),</span>
<span class="term-fg32">+        )</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
     &#47;&#47;&#47; Create new hashed storage from account status and plain storage.
<span class="term-fg31">-    pub fn from_plain_storage&lt;&#39;a&gt;(</span>
<span class="term-fg32">+    pub fn from_plain_storage&lt;&#39;a, KH: KeyHasher&gt;(</span>
         status: AccountStatus,
         storage: impl IntoIterator&lt;Item = (&amp;&#39;a U256, &amp;&#39;a U256)&gt;,
     ) -&gt; Self {
         Self::from_iter(
             status.was_destroyed(),
<span class="term-fg31">-            storage.into_iter().map(|(key, value)| (keccak256(B256::from(*key)), *value)),</span>
<span class="term-fg32">+            storage.into_iter().map(|(key, value)| (KH::hash_key(B256::from(*key)), *value)),</span>
         )
     }
&nbsp;
<span class="term-fg36">@@ -241,7 +252,7 @@</span>             PrefixSetMut::all()
         } else {
             let mut prefix_set = PrefixSetMut::with_capacity(self.storage.len());
             for hashed_slot in self.storage.keys() {
<span class="term-fg31">-                prefix_set.insert(Nibbles::unpack(hashed_slot));</span>
<span class="term-fg32">+                prefix_set.insert(unpack_nibbles(hashed_slot));</span>
             }
             prefix_set
         }
<span class="term-fg36">@@ -352,14 +363,17 @@</span> }
&nbsp;
 #[cfg(test)]
 mod tests {
<span class="term-fg32">+    #![allow(clippy::needless_update)]</span>
     use super::*;
<span class="term-fg31">-    use alloy_primitives::Bytes;</span>
<span class="term-fg32">+    use alloy_primitives::{keccak256, Address, Bytes};</span>
<span class="term-fg32">+    use reth_trie_common::KeccakKeyHasher;</span>
     use revm::{
         db::{
<span class="term-fg31">-            states::{plain_account::PlainStorage, StorageSlot},</span>
<span class="term-fg31">-            PlainAccount, StorageWithOriginalValues,</span>
<span class="term-fg32">+            states::{plain_account::PlainStorage, CacheAccount, StorageSlot},</span>
<span class="term-fg32">+            BundleAccount, StorageWithOriginalValues,</span>
         },
         primitives::{AccountInfo, Bytecode},
<span class="term-fg32">+        PlainAccount,</span>
     };
&nbsp;
     #[test]
<span class="term-fg36">@@ -447,6 +461,10 @@</span>             balance: U256::from(123),
             nonce: 42,
             code_hash: B256::random(),
             code: Some(Bytecode::LegacyRaw(Bytes::from(vec![1, 2]))),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: 2,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: B256::random(),</span>
         };
&nbsp;
         let mut storage = StorageWithOriginalValues::default();
<span class="term-fg36">@@ -467,7 +485,7 @@</span>         &#47;&#47; Create a vector of tuples representing the bundle state.
         let state = vec![(&amp;address, &amp;account)];
&nbsp;
         &#47;&#47; Convert the bundle state into a hashed post state.
<span class="term-fg31">-        let hashed_state = HashedPostState::from_bundle_state(state);</span>
<span class="term-fg32">+        let hashed_state = HashedPostState::from_bundle_state::&lt;KeccakKeyHasher&gt;(state);</span>
&nbsp;
         &#47;&#47; Validate the hashed post state.
         assert_eq!(hashed_state.accounts.len(), 1);
<span class="term-fg36">@@ -486,11 +504,12 @@</span>         &#47;&#47; Prepare a random Ethereum address.
         let address = Address::random();
&nbsp;
         &#47;&#47; Create mock account info.
<span class="term-fg31">-        let account_info = AccountInfo {</span>
<span class="term-fg32">+        let account_info = revm::shared::AccountInfo {</span>
             balance: U256::from(500),
             nonce: 5,
             code_hash: B256::random(),
             code: None,
<span class="term-fg32">+            ..Default::default()</span>
         };
&nbsp;
         let mut storage = PlainStorage::default();
<span class="term-fg36">@@ -506,7 +525,7 @@</span>         &#47;&#47; Create a vector of tuples representing the cache state.
         let state = vec![(&amp;address, &amp;account)];
&nbsp;
         &#47;&#47; Convert the cache state into a hashed post state.
<span class="term-fg31">-        let hashed_state = HashedPostState::from_cache_state(state);</span>
<span class="term-fg32">+        let hashed_state = HashedPostState::from_cache_state::&lt;KeccakKeyHasher&gt;(state);</span>
&nbsp;
         &#47;&#47; Validate the hashed post state.
         assert_eq!(hashed_state.accounts.len(), 1);
<span class="term-fg36">@@ -530,6 +549,10 @@</span>             balance: U256::from(1000),
             nonce: 1,
             code_hash: B256::random(),
             code: None,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: 10,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: B256::random(),</span>
         };
&nbsp;
         &#47;&#47; Create hashed accounts with addresses.</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0a6beb47f8ad4ad2f8cad079" role="button"
                       aria-expanded="false" aria-controls="id-0a6beb47f8ad4ad2f8cad079">
                        <code>crates/trie/trie/src/trie_cursor/subnode.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/trie/src/trie_cursor/subnode.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/trie/src/trie_cursor/subnode.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0a6beb47f8ad4ad2f8cad079"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;trie&#47;src&#47;trie_cursor&#47;subnode.rs scroll-reth&#47;crates&#47;trie&#47;trie&#47;src&#47;trie_cursor&#47;subnode.rs</span>
<span class="term-fg1">index c928028eb15766f459abe59f4198dff2dffea54b..457c1ba4685bb285f00d593a390ec411661c8373 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;trie&#47;src&#47;trie_cursor&#47;subnode.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;trie&#47;src&#47;trie_cursor&#47;subnode.rs</span>
<span class="term-fg36">@@ -76,7 +76,7 @@</span>     #[inline]
     pub fn state_flag(&amp;self) -&gt; bool {
         self.node
             .as_ref()
<span class="term-fg31">-            .map_or(true, |node| self.nibble &lt; 0 || node.state_mask.is_bit_set(self.nibble as u8))</span>
<span class="term-fg32">+            .is_none_or(|node| self.nibble &lt; 0 || node.state_mask.is_bit_set(self.nibble as u8))</span>
     }
&nbsp;
     &#47;&#47;&#47; Returns `true` if the tree flag is set for the current nibble.
<span class="term-fg36">@@ -84,7 +84,7 @@</span>     #[inline]
     pub fn tree_flag(&amp;self) -&gt; bool {
         self.node
             .as_ref()
<span class="term-fg31">-            .map_or(true, |node| self.nibble &lt; 0 || node.tree_mask.is_bit_set(self.nibble as u8))</span>
<span class="term-fg32">+            .is_none_or(|node| self.nibble &lt; 0 || node.tree_mask.is_bit_set(self.nibble as u8))</span>
     }
&nbsp;
     &#47;&#47;&#47; Returns `true` if the current nibble has a root hash.</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-72cc99c8b7d1e8be7dbbd240" role="button"
                       aria-expanded="false" aria-controls="id-72cc99c8b7d1e8be7dbbd240">
                        <code>crates/trie/trie/src/walker.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/trie/trie/src/walker.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/trie/trie/src/walker.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-72cc99c8b7d1e8be7dbbd240"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;trie&#47;src&#47;walker.rs scroll-reth&#47;crates&#47;trie&#47;trie&#47;src&#47;walker.rs</span>
<span class="term-fg1">index d1c5247966da32c9b73ecfa5ea3ea94ba946544d..654d20f5541edfdecf7be9b0624ab63a8ca94556 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;trie&#47;src&#47;walker.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;trie&#47;src&#47;walker.rs</span>
<span class="term-fg36">@@ -5,9 +5,13 @@</span>     BranchNodeCompact, Nibbles,
 };
 use alloy_primitives::{map::HashSet, B256};
 use reth_storage_errors::db::DatabaseError;
<span class="term-fg32">+use reth_trie_common::pack_nibbles;</span>
&nbsp;
 #[cfg(feature = &quot;metrics&quot;)]
 use crate::metrics::WalkerMetrics;
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+use crate::BitsCompatibility;</span>
&nbsp;
 &#47;&#47;&#47; `TrieWalker` is a structure that enables traversal of a Merkle trie.
 &#47;&#47;&#47; It allows moving through the trie in a depth-first manner, skipping certain branches
<span class="term-fg36">@@ -100,9 +104,14 @@</span>     pub fn next_unprocessed_key(&amp;self) -&gt; Option&lt;B256&gt; {
         self.key()
             .and_then(|key| {
                 if self.can_skip_current_node {
<span class="term-fg31">-                    key.increment().map(|inc| inc.pack())</span>
<span class="term-fg32">+                    &#47;&#47; TODO(scroll): replace this with key abstraction.</span>
<span class="term-fg32">+                    #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+                    let key = key.increment().map(|inc| inc.pack());</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    let key = key.increment_bit().map(|inc| inc.pack_bits());</span>
<span class="term-fg32">+                    key</span>
                 } else {
<span class="term-fg31">-                    Some(key.pack())</span>
<span class="term-fg32">+                    Some(pack_nibbles(key))</span>
                 }
             })
             .map(|mut key| {</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-e2daa3b96015f9b1a1258f76"role="button" aria-expanded="false" aria-controls="id-e2daa3b96015f9b1a1258f76">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>Other changes</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+1750</span></div>
                    <div class="text-start"><span class="text-danger">-683</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-e2daa3b96015f9b1a1258f76">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4bd0acb7f329cdfb61939ef4" role="button"
                       aria-expanded="false" aria-controls="id-4bd0acb7f329cdfb61939ef4">
                        <code>Cargo.lock</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/Cargo.lock" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/Cargo.lock" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+839</span></div>
                            <div class="text-start"><span class="text-danger">-444</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4bd0acb7f329cdfb61939ef4"><span class="term-fg1">diff --git reth&#47;Cargo.lock scroll-reth&#47;Cargo.lock</span>
<span class="term-fg1">index 04f3b854e9e42599678e2248b581bfd56a0409f3..758ec2ee7abd0950e46b4ef657d9e973b2321e77 100644</span>
<span class="term-fg1">--- reth&#47;Cargo.lock</span>
<span class="term-fg1">+++ scroll-reth&#47;Cargo.lock</span>
<span class="term-fg36">@@ -75,6 +75,15 @@</span>  &quot;memchr&quot;,
 ]
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;aligned-vec&quot;</span>
<span class="term-fg32">+version = &quot;0.6.1&quot;</span>
<span class="term-fg32">+source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg32">+checksum = &quot;7e0966165eaf052580bd70eb1b32cb3d6245774c0104d1b2793e9650bf83b52a&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;equator&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;alloc-no-stdlib&quot;
 version = &quot;2.0.4&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -91,15 +100,15 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;allocator-api2&quot;
<span class="term-fg31">-version = &quot;0.2.20&quot;</span>
<span class="term-fg32">+version = &quot;0.2.21&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;45862d1c77f2228b9e10bc609d5bc203d86ebc9b87ad8d5d5167a6c9abf739d9&quot;</span>
<span class="term-fg32">+checksum = &quot;683d7910e743518b0e34f1186f92494becacb047c7b6bf616c96772180fef923&quot;</span>
&nbsp;
 [[package]]
 name = &quot;alloy-chains&quot;
<span class="term-fg31">-version = &quot;0.1.47&quot;</span>
<span class="term-fg32">+version = &quot;0.1.48&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;18c5c520273946ecf715c0010b4e3503d7eba9893cd9ce6b7fff5654c4a3c470&quot;</span>
<span class="term-fg32">+checksum = &quot;a0161082e0edd9013d23083465cc04b20e44b7a15646d36ba7b0cdb7cd6fe18f&quot;</span>
 dependencies = [
  &quot;alloy-primitives&quot;,
  &quot;alloy-rlp&quot;,
<span class="term-fg36">@@ -107,7 +116,7 @@</span>  &quot;arbitrary&quot;,
  &quot;num_enum&quot;,
  &quot;proptest&quot;,
  &quot;serde&quot;,
<span class="term-fg31">- &quot;strum&quot;,</span>
<span class="term-fg32">+ &quot;strum 0.26.3&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -123,7 +132,7 @@</span>  &quot;alloy-serde&quot;,
  &quot;arbitrary&quot;,
  &quot;auto_impl&quot;,
  &quot;c-kzg&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;rand 0.8.5&quot;,
  &quot;serde&quot;,
  &quot;serde_with&quot;,
<span class="term-fg36">@@ -151,16 +160,16 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;alloy-dyn-abi&quot;
<span class="term-fg31">-version = &quot;0.8.12&quot;</span>
<span class="term-fg32">+version = &quot;0.8.14&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;ef2364c782a245cf8725ea6dbfca5f530162702b5d685992ea03ce64529136cc&quot;</span>
<span class="term-fg32">+checksum = &quot;80759b3f57b3b20fa7cd8fef6479930fc95461b58ff8adea6e87e618449c8a1d&quot;</span>
 dependencies = [
  &quot;alloy-json-abi&quot;,
  &quot;alloy-primitives&quot;,
  &quot;alloy-sol-type-parser&quot;,
  &quot;alloy-sol-types&quot;,
  &quot;const-hex&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;itoa&quot;,
  &quot;serde&quot;,
  &quot;serde_json&quot;,
<span class="term-fg36">@@ -170,8 +179,7 @@</span>
 [[package]]
 name = &quot;alloy-eip2930&quot;
 version = &quot;0.1.0&quot;
<span class="term-fg31">-source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg31">-checksum = &quot;0069cf0642457f87a01a014f6dc29d5d893cd4fd8fddf0c3cdfad1bb3ebafc41&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;alloy-eips?branch=v0.3.2#8d5fc83fc257b09510dc8d76561188218d9c0c32&quot;</span>
 dependencies = [
  &quot;alloy-primitives&quot;,
  &quot;alloy-rlp&quot;,
<span class="term-fg36">@@ -182,14 +190,14 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;alloy-eip7702&quot;
<span class="term-fg31">-version = &quot;0.4.1&quot;</span>
<span class="term-fg32">+version = &quot;0.4.2&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;5f6cee6a35793f3db8a5ffe60e86c695f321d081a567211245f503e8c498fce8&quot;</span>
<span class="term-fg32">+checksum = &quot;4c986539255fb839d1533c128e190e557e52ff652c9ef62939e233a81dd93f7e&quot;</span>
 dependencies = [
  &quot;alloy-primitives&quot;,
  &quot;alloy-rlp&quot;,
  &quot;arbitrary&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;k256&quot;,
  &quot;rand 0.8.5&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -209,7 +217,7 @@</span>  &quot;alloy-rlp&quot;,
  &quot;alloy-serde&quot;,
  &quot;arbitrary&quot;,
  &quot;c-kzg&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;ethereum_ssz&quot;,
  &quot;ethereum_ssz_derive&quot;,
  &quot;once_cell&quot;,
<span class="term-fg36">@@ -230,9 +238,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;alloy-json-abi&quot;
<span class="term-fg31">-version = &quot;0.8.12&quot;</span>
<span class="term-fg32">+version = &quot;0.8.14&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;b84c506bf264110fa7e90d9924f742f40ef53c6572ea56a0b0bd714a567ed389&quot;</span>
<span class="term-fg32">+checksum = &quot;ac4b22b3e51cac09fd2adfcc73b55f447b4df669f983c13f7894ec82b607c63f&quot;</span>
 dependencies = [
  &quot;alloy-primitives&quot;,
  &quot;alloy-sol-type-parser&quot;,
<span class="term-fg36">@@ -309,9 +317,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;alloy-primitives&quot;
<span class="term-fg31">-version = &quot;0.8.12&quot;</span>
<span class="term-fg32">+version = &quot;0.8.14&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;9fce5dbd6a4f118eecc4719eaa9c7ffc31c315e6c5ccde3642db927802312425&quot;</span>
<span class="term-fg32">+checksum = &quot;9db948902dfbae96a73c2fbf1f7abec62af034ab883e4c777c3fd29702bd6e2c&quot;</span>
 dependencies = [
  &quot;alloy-rlp&quot;,
  &quot;arbitrary&quot;,
<span class="term-fg36">@@ -319,12 +327,12 @@</span>  &quot;bytes&quot;,
  &quot;cfg-if&quot;,
  &quot;const-hex&quot;,
  &quot;derive_arbitrary&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;foldhash&quot;,
  &quot;getrandom 0.2.15&quot;,
<span class="term-fg31">- &quot;hashbrown 0.15.1&quot;,</span>
<span class="term-fg32">+ &quot;hashbrown 0.15.2&quot;,</span>
  &quot;hex-literal&quot;,
<span class="term-fg31">- &quot;indexmap 2.6.0&quot;,</span>
<span class="term-fg32">+ &quot;indexmap 2.7.0&quot;,</span>
  &quot;itoa&quot;,
  &quot;k256&quot;,
  &quot;keccak-asm&quot;,
<span class="term-fg36">@@ -333,7 +341,7 @@</span>  &quot;proptest&quot;,
  &quot;proptest-derive&quot;,
  &quot;rand 0.8.5&quot;,
  &quot;ruint&quot;,
<span class="term-fg31">- &quot;rustc-hash 2.0.0&quot;,</span>
<span class="term-fg32">+ &quot;rustc-hash 2.1.0&quot;,</span>
  &quot;serde&quot;,
  &quot;sha3&quot;,
  &quot;tiny-keccak&quot;,
<span class="term-fg36">@@ -418,7 +426,7 @@</span> checksum = &quot;2b09cae092c27b6f1bde952653a22708691802e57bfef4a2973b80bea21efd3f&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -518,14 +526,14 @@</span>  &quot;alloy-eips&quot;,
  &quot;alloy-primitives&quot;,
  &quot;alloy-rlp&quot;,
  &quot;alloy-serde&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;ethereum_ssz&quot;,
  &quot;ethereum_ssz_derive&quot;,
  &quot;jsonrpsee-types&quot;,
  &quot;jsonwebtoken&quot;,
  &quot;rand 0.8.5&quot;,
  &quot;serde&quot;,
<span class="term-fg31">- &quot;strum&quot;,</span>
<span class="term-fg32">+ &quot;strum 0.26.3&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -542,7 +550,7 @@</span>  &quot;alloy-rlp&quot;,
  &quot;alloy-serde&quot;,
  &quot;alloy-sol-types&quot;,
  &quot;arbitrary&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;itertools 0.13.0&quot;,
  &quot;jsonrpsee-types&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -634,56 +642,56 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;alloy-sol-macro&quot;
<span class="term-fg31">-version = &quot;0.8.12&quot;</span>
<span class="term-fg32">+version = &quot;0.8.14&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;9343289b4a7461ed8bab8618504c995c049c082b70c7332efd7b32125633dc05&quot;</span>
<span class="term-fg32">+checksum = &quot;3bfd7853b65a2b4f49629ec975fee274faf6dff15ab8894c620943398ef283c0&quot;</span>
 dependencies = [
  &quot;alloy-sol-macro-expander&quot;,
  &quot;alloy-sol-macro-input&quot;,
  &quot;proc-macro-error2&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
 name = &quot;alloy-sol-macro-expander&quot;
<span class="term-fg31">-version = &quot;0.8.12&quot;</span>
<span class="term-fg32">+version = &quot;0.8.14&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;4222d70bec485ceccc5d8fd4f2909edd65b5d5e43d4aca0b5dcee65d519ae98f&quot;</span>
<span class="term-fg32">+checksum = &quot;82ec42f342d9a9261699f8078e57a7a4fda8aaa73c1a212ed3987080e6a9cd13&quot;</span>
 dependencies = [
  &quot;alloy-sol-macro-input&quot;,
  &quot;const-hex&quot;,
<span class="term-fg31">- &quot;heck&quot;,</span>
<span class="term-fg31">- &quot;indexmap 2.6.0&quot;,</span>
<span class="term-fg32">+ &quot;heck 0.5.0&quot;,</span>
<span class="term-fg32">+ &quot;indexmap 2.7.0&quot;,</span>
  &quot;proc-macro-error2&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
  &quot;syn-solidity&quot;,
  &quot;tiny-keccak&quot;,
 ]
&nbsp;
 [[package]]
 name = &quot;alloy-sol-macro-input&quot;
<span class="term-fg31">-version = &quot;0.8.12&quot;</span>
<span class="term-fg32">+version = &quot;0.8.14&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;2e17f2677369571b976e51ea1430eb41c3690d344fef567b840bfc0b01b6f83a&quot;</span>
<span class="term-fg32">+checksum = &quot;ed2c50e6a62ee2b4f7ab3c6d0366e5770a21cad426e109c2f40335a1b3aff3df&quot;</span>
 dependencies = [
  &quot;const-hex&quot;,
  &quot;dunce&quot;,
<span class="term-fg31">- &quot;heck&quot;,</span>
<span class="term-fg32">+ &quot;heck 0.5.0&quot;,</span>
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
  &quot;syn-solidity&quot;,
 ]
&nbsp;
 [[package]]
 name = &quot;alloy-sol-type-parser&quot;
<span class="term-fg31">-version = &quot;0.8.12&quot;</span>
<span class="term-fg32">+version = &quot;0.8.14&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;aa64d80ae58ffaafdff9d5d84f58d03775f66c84433916dc9a64ed16af5755da&quot;</span>
<span class="term-fg32">+checksum = &quot;ac17c6e89a50fb4a758012e4b409d9a0ba575228e69b539fe37d7a1bd507ca4a&quot;</span>
 dependencies = [
  &quot;serde&quot;,
  &quot;winnow&quot;,
<span class="term-fg36">@@ -691,9 +699,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;alloy-sol-types&quot;
<span class="term-fg31">-version = &quot;0.8.12&quot;</span>
<span class="term-fg32">+version = &quot;0.8.14&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;6520d427d4a8eb7aa803d852d7a52ceb0c519e784c292f64bb339e636918cf27&quot;</span>
<span class="term-fg32">+checksum = &quot;c9dc0fffe397aa17628160e16b89f704098bf3c9d74d5d369ebc239575936de5&quot;</span>
 dependencies = [
  &quot;alloy-json-abi&quot;,
  &quot;alloy-primitives&quot;,
<span class="term-fg36">@@ -776,16 +784,16 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;alloy-trie&quot;
<span class="term-fg31">-version = &quot;0.7.4&quot;</span>
<span class="term-fg32">+version = &quot;0.7.6&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;b6b2e366c0debf0af77766c23694a3f863b02633050e71e096e257ffbd395e50&quot;</span>
<span class="term-fg32">+checksum = &quot;3a5fd8fea044cc9a8c8a50bb6f28e31f0385d820f116c5b98f6f4e55d6e5590b&quot;</span>
 dependencies = [
  &quot;alloy-primitives&quot;,
  &quot;alloy-rlp&quot;,
  &quot;arbitrary&quot;,
  &quot;arrayvec&quot;,
  &quot;derive_arbitrary&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;nybbles&quot;,
  &quot;proptest&quot;,
  &quot;proptest-derive&quot;,
<span class="term-fg36">@@ -866,9 +874,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;anyhow&quot;
<span class="term-fg31">-version = &quot;1.0.93&quot;</span>
<span class="term-fg32">+version = &quot;1.0.94&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;4c95c10ba0b00a02636238b814946408b1322d5ac4760326e6fb8ec956d85775&quot;</span>
<span class="term-fg32">+checksum = &quot;c1fd03a028ef38ba2276dce7e33fcd6369c158a1bca17946c4b1b701891c1ff7&quot;</span>
&nbsp;
 [[package]]
 name = &quot;aquamarine&quot;
<span class="term-fg36">@@ -881,7 +889,7 @@</span>  &quot;itertools 0.10.5&quot;,
  &quot;proc-macro-error2&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -1072,6 +1080,17 @@</span>  &quot;zstd-safe&quot;,
 ]
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;async-recursion&quot;</span>
<span class="term-fg32">+version = &quot;1.1.1&quot;</span>
<span class="term-fg32">+source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg32">+checksum = &quot;3b43422f69d8ff38f95f1b2bb76517c91589a924d1559a0e935d7c8ce0274c11&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;proc-macro2&quot;,</span>
<span class="term-fg32">+ &quot;quote&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;async-sse&quot;
 version = &quot;5.1.0&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -1104,7 +1123,7 @@</span> checksum = &quot;c7c24de15d275a1ecfd47a380fb4d5ec9bfe0933f309ed5e705b775596a3574d&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -1115,7 +1134,7 @@</span> checksum = &quot;721cae7de5c34fbb2acd27e21e6d2cf7b886dce0c27388d46c4e6c47ea4318dd&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -1153,7 +1172,7 @@</span> checksum = &quot;3c87f3f15e7794432337fc718554eaa4dc8f04c9677a950ffe366f20a162ae42&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -1259,7 +1278,7 @@</span>  &quot;quote&quot;,
  &quot;regex&quot;,
  &quot;rustc-hash 1.1.0&quot;,
  &quot;shlex&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -1346,6 +1365,32 @@</span>  &quot;zeroize&quot;,
 ]
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;bn254&quot;</span>
<span class="term-fg32">+version = &quot;0.1.0&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;bn254.git?branch=master#81e1dcc92ee9a2798b13b84b24de182e9c42256e&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;ff&quot;,</span>
<span class="term-fg32">+ &quot;getrandom 0.2.15&quot;,</span>
<span class="term-fg32">+ &quot;rand 0.8.5&quot;,</span>
<span class="term-fg32">+ &quot;rand_core 0.6.4&quot;,</span>
<span class="term-fg32">+ &quot;sp1-intrinsics&quot;,</span>
<span class="term-fg32">+ &quot;subtle&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;bn254&quot;</span>
<span class="term-fg32">+version = &quot;0.1.0&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;bn254#81e1dcc92ee9a2798b13b84b24de182e9c42256e&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;ff&quot;,</span>
<span class="term-fg32">+ &quot;getrandom 0.2.15&quot;,</span>
<span class="term-fg32">+ &quot;rand 0.8.5&quot;,</span>
<span class="term-fg32">+ &quot;rand_core 0.6.4&quot;,</span>
<span class="term-fg32">+ &quot;sp1-intrinsics&quot;,</span>
<span class="term-fg32">+ &quot;subtle&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;boa_ast&quot;
 version = &quot;0.19.1&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -1354,9 +1399,9 @@</span> dependencies = [
  &quot;bitflags 2.6.0&quot;,
  &quot;boa_interner&quot;,
  &quot;boa_macros&quot;,
<span class="term-fg31">- &quot;indexmap 2.6.0&quot;,</span>
<span class="term-fg32">+ &quot;indexmap 2.7.0&quot;,</span>
  &quot;num-bigint&quot;,
<span class="term-fg31">- &quot;rustc-hash 2.0.0&quot;,</span>
<span class="term-fg32">+ &quot;rustc-hash 2.1.0&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -1380,7 +1425,7 @@</span>  &quot;dashmap 5.5.3&quot;,
  &quot;fast-float&quot;,
  &quot;hashbrown 0.14.5&quot;,
  &quot;icu_normalizer&quot;,
<span class="term-fg31">- &quot;indexmap 2.6.0&quot;,</span>
<span class="term-fg32">+ &quot;indexmap 2.7.0&quot;,</span>
  &quot;intrusive-collections&quot;,
  &quot;itertools 0.13.0&quot;,
  &quot;num-bigint&quot;,
<span class="term-fg36">@@ -1392,7 +1437,7 @@</span>  &quot;pollster&quot;,
  &quot;portable-atomic&quot;,
  &quot;rand 0.8.5&quot;,
  &quot;regress&quot;,
<span class="term-fg31">- &quot;rustc-hash 2.0.0&quot;,</span>
<span class="term-fg32">+ &quot;rustc-hash 2.1.0&quot;,</span>
  &quot;ryu-js&quot;,
  &quot;serde&quot;,
  &quot;serde_json&quot;,
<span class="term-fg36">@@ -1426,10 +1471,10 @@</span> dependencies = [
  &quot;boa_gc&quot;,
  &quot;boa_macros&quot;,
  &quot;hashbrown 0.14.5&quot;,
<span class="term-fg31">- &quot;indexmap 2.6.0&quot;,</span>
<span class="term-fg32">+ &quot;indexmap 2.7.0&quot;,</span>
  &quot;once_cell&quot;,
  &quot;phf&quot;,
<span class="term-fg31">- &quot;rustc-hash 2.0.0&quot;,</span>
<span class="term-fg32">+ &quot;rustc-hash 2.1.0&quot;,</span>
  &quot;static_assertions&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -1441,7 +1486,7 @@</span> checksum = &quot;240f4126219a83519bad05c9a40bfc0303921eeb571fc2d7e44c17ffac99d3f1&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
  &quot;synstructure&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -1461,7 +1506,7 @@</span>  &quot;icu_properties&quot;,
  &quot;num-bigint&quot;,
  &quot;num-traits&quot;,
  &quot;regress&quot;,
<span class="term-fg31">- &quot;rustc-hash 2.0.0&quot;,</span>
<span class="term-fg32">+ &quot;rustc-hash 2.1.0&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -1478,7 +1523,7 @@</span> checksum = &quot;ae85205289bab1f2c7c8a30ddf0541cf89ba2ff7dbd144feef50bbfa664288d4&quot;
 dependencies = [
  &quot;fast-float&quot;,
  &quot;paste&quot;,
<span class="term-fg31">- &quot;rustc-hash 2.0.0&quot;,</span>
<span class="term-fg32">+ &quot;rustc-hash 2.1.0&quot;,</span>
  &quot;sptr&quot;,
  &quot;static_assertions&quot;,
 ]
<span class="term-fg36">@@ -1563,7 +1608,7 @@</span> checksum = &quot;bcfcc3cd946cb52f0bbfdbbcfa2f4e24f75ebb6c0e1002f7c25904fada18b9ec&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -1574,9 +1619,9 @@</span> checksum = &quot;1fd0f2584146f6f2ef48085050886acf353beff7305ebd1ae69500e27c67f64b&quot;
&nbsp;
 [[package]]
 name = &quot;bytes&quot;
<span class="term-fg31">-version = &quot;1.8.0&quot;</span>
<span class="term-fg32">+version = &quot;1.9.0&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;9ac0150caa2ae65ca5bd83f25c7de183dea78d4d366469f148435e2acfbad0da&quot;</span>
<span class="term-fg32">+checksum = &quot;325918d6fe32f23b19878fe4b34794ae41fc19ddbe53b10571a4874d44ffd39b&quot;</span>
 dependencies = [
  &quot;serde&quot;,
 ]
<span class="term-fg36">@@ -1607,9 +1652,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;cargo-platform&quot;
<span class="term-fg31">-version = &quot;0.1.8&quot;</span>
<span class="term-fg32">+version = &quot;0.1.9&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;24b1f0365a6c6bb4020cd05806fd0d33c44d38046b8bd7f0e40814b9763cabfc&quot;</span>
<span class="term-fg32">+checksum = &quot;e35af189006b9c0f00a064685c727031e3ed2d8020f7ba284d78cc2671bd36ea&quot;</span>
 dependencies = [
  &quot;serde&quot;,
 ]
<span class="term-fg36">@@ -1651,9 +1696,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;cc&quot;
<span class="term-fg31">-version = &quot;1.2.1&quot;</span>
<span class="term-fg32">+version = &quot;1.2.2&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;fd9de9f2205d5ef3fd67e685b0df337994ddd4495e2a28d185500d0e1edfea47&quot;</span>
<span class="term-fg32">+checksum = &quot;f34d93e62b03caf570cccc334cbc6c2fceca82f39211051345108adcba3eebdc&quot;</span>
 dependencies = [
  &quot;jobserver&quot;,
  &quot;libc&quot;,
<span class="term-fg36">@@ -1752,9 +1797,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;clap&quot;
<span class="term-fg31">-version = &quot;4.5.21&quot;</span>
<span class="term-fg32">+version = &quot;4.5.23&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;fb3b4b9e5a7c7514dfa52869339ee98b3156b0bfb4e8a77c4ff4babb64b1604f&quot;</span>
<span class="term-fg32">+checksum = &quot;3135e7ec2ef7b10c6ed8950f0f792ed96ee093fa088608f1c76e569722700c84&quot;</span>
 dependencies = [
  &quot;clap_builder&quot;,
  &quot;clap_derive&quot;,
<span class="term-fg36">@@ -1762,9 +1807,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;clap_builder&quot;
<span class="term-fg31">-version = &quot;4.5.21&quot;</span>
<span class="term-fg32">+version = &quot;4.5.23&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;b17a95aa67cc7b5ebd32aa5370189aa0d79069ef1c64ce893bd30fb24bff20ec&quot;</span>
<span class="term-fg32">+checksum = &quot;30582fc632330df2bd26877bde0c1f4470d57c582bbc070376afcd04d8cb4838&quot;</span>
 dependencies = [
  &quot;anstream&quot;,
  &quot;anstyle&quot;,
<span class="term-fg36">@@ -1778,17 +1823,17 @@</span> version = &quot;4.5.18&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;4ac6a0c7b1a9e9a5186361f67dfa1b88213572f427fb9ab038efb2bd8c582dab&quot;
 dependencies = [
<span class="term-fg31">- &quot;heck&quot;,</span>
<span class="term-fg32">+ &quot;heck 0.5.0&quot;,</span>
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
 name = &quot;clap_lex&quot;
<span class="term-fg31">-version = &quot;0.7.3&quot;</span>
<span class="term-fg32">+version = &quot;0.7.4&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;afb84c814227b90d6895e01398aee0d8033c00e7466aca416fb6a8e0eb19d8a7&quot;</span>
<span class="term-fg32">+checksum = &quot;f46ad14479a25103f283c0f10005961cf086d8dc42205bb44c46ac563475dca6&quot;</span>
&nbsp;
 [[package]]
 name = &quot;coins-bip32&quot;
<span class="term-fg36">@@ -1864,8 +1909,8 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;24f165e7b643266ea80cb858aed492ad9280e3e05ce24d4a99d7d7b889b6a4d9&quot;
 dependencies = [
  &quot;crossterm&quot;,
<span class="term-fg31">- &quot;strum&quot;,</span>
<span class="term-fg31">- &quot;strum_macros&quot;,</span>
<span class="term-fg32">+ &quot;strum 0.26.3&quot;,</span>
<span class="term-fg32">+ &quot;strum_macros 0.26.4&quot;,</span>
  &quot;unicode-width 0.2.0&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -1915,9 +1960,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;const-hex&quot;
<span class="term-fg31">-version = &quot;1.13.2&quot;</span>
<span class="term-fg32">+version = &quot;1.14.0&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;487981fa1af147182687064d0a2c336586d337a606595ced9ffb0c685c250c73&quot;</span>
<span class="term-fg32">+checksum = &quot;4b0485bab839b018a8f1723fc5391819fea5f8f0f32288ef8a735fd096b6160c&quot;</span>
 dependencies = [
  &quot;cfg-if&quot;,
  &quot;cpufeatures&quot;,
<span class="term-fg36">@@ -2125,7 +2170,7 @@</span> checksum = &quot;829d955a0bb380ef178a640b91779e3987da38c9aea133b20614cfed8cdea9c6&quot;
 dependencies = [
  &quot;bitflags 2.6.0&quot;,
  &quot;crossterm_winapi&quot;,
<span class="term-fg31">- &quot;mio 1.0.2&quot;,</span>
<span class="term-fg32">+ &quot;mio 1.0.3&quot;,</span>
  &quot;parking_lot&quot;,
  &quot;rustix&quot;,
  &quot;signal-hook&quot;,
<span class="term-fg36">@@ -2235,7 +2280,7 @@</span> checksum = &quot;f46882e17999c6cc590af592290432be3bce0428cb0d5f8b6715e4dc7b383eb3&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -2259,7 +2304,7 @@</span>  &quot;ident_case&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
  &quot;strsim&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -2270,7 +2315,7 @@</span> checksum = &quot;d336a2a514f6ccccaa3e09b02d41d35330c07ddf03a62165fcec10bb561c7806&quot;
 dependencies = [
  &quot;darling_core&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -2392,18 +2437,7 @@</span> checksum = &quot;30542c1ad912e0e3d22a1935c290e12e8a29d704a420177a31faad4a601a0800&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg31">-]</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-[[package]]</span>
<span class="term-fg31">-name = &quot;derive_more&quot;</span>
<span class="term-fg31">-version = &quot;0.99.18&quot;</span>
<span class="term-fg31">-source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg31">-checksum = &quot;5f33878137e4dafd7fa914ad4e259e18a4e8e532b9617a2d0150262bf53abfce&quot;</span>
<span class="term-fg31">-dependencies = [</span>
<span class="term-fg31">- &quot;proc-macro2&quot;,</span>
<span class="term-fg31">- &quot;quote&quot;,</span>
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -2424,7 +2458,7 @@</span> dependencies = [
  &quot;convert_case&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
  &quot;unicode-xid&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -2538,7 +2572,7 @@</span> checksum = &quot;97369cbbc041bc366949bc74d34658d6cda5621039731c6310521892a3a20ae0&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -2620,8 +2654,9 @@</span>  &quot;reth-evm-ethereum&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-stages&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_json&quot;,
  &quot;thiserror 1.0.69&quot;,
<span class="term-fg36">@@ -2685,10 +2720,10 @@</span> version = &quot;0.6.1&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;a1e6a265c649f3f5979b601d26f1d05ada116434c87741c9493cb56218f76cbc&quot;
 dependencies = [
<span class="term-fg31">- &quot;heck&quot;,</span>
<span class="term-fg32">+ &quot;heck 0.5.0&quot;,</span>
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -2699,7 +2734,27 @@</span> checksum = &quot;2f9ed6b3789237c8a0c1c505af1c7eb2c560df6186f01b098c3a1064ea532f38&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;equator&quot;</span>
<span class="term-fg32">+version = &quot;0.2.2&quot;</span>
<span class="term-fg32">+source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg32">+checksum = &quot;c35da53b5a021d2484a7cc49b2ac7f2d840f8236a286f84202369bd338d761ea&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;equator-macro&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;equator-macro&quot;</span>
<span class="term-fg32">+version = &quot;0.2.1&quot;</span>
<span class="term-fg32">+source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg32">+checksum = &quot;3bf679796c0322556351f287a51b49e48f7c4986e727b5dd78c972d30e2e16cc&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;proc-macro2&quot;,</span>
<span class="term-fg32">+ &quot;quote&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -2710,12 +2765,12 @@</span> checksum = &quot;5443807d6dff69373d433ab9ef5378ad8df50ca6298caf15de6e52e24aaf54d5&quot;
&nbsp;
 [[package]]
 name = &quot;errno&quot;
<span class="term-fg31">-version = &quot;0.3.9&quot;</span>
<span class="term-fg32">+version = &quot;0.3.10&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;534c5cf6194dfab3db3242765c03bbe257cf92f22b38f6bc0c58d59108a820ba&quot;</span>
<span class="term-fg32">+checksum = &quot;33d852cb9b869c2a9b3df2f71a3074817f01e1844f839a144f5fcef059a4eb5d&quot;</span>
 dependencies = [
  &quot;libc&quot;,
<span class="term-fg31">- &quot;windows-sys 0.52.0&quot;,</span>
<span class="term-fg32">+ &quot;windows-sys 0.59.0&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -2733,12 +2788,11 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;ethereum_ssz&quot;
<span class="term-fg31">-version = &quot;0.8.0&quot;</span>
<span class="term-fg32">+version = &quot;0.8.1&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;bfbba28f4f3f32d92c06a64f5bf6c4537b5d4e21f28c689bd2bbaecfea4e0d3e&quot;</span>
<span class="term-fg32">+checksum = &quot;036c84bd29bff35e29bbee3c8fc0e2fb95db12b6f2f3cae82a827fbc97256f3a&quot;</span>
 dependencies = [
  &quot;alloy-primitives&quot;,
<span class="term-fg31">- &quot;derivative&quot;,</span>
  &quot;ethereum_serde_utils&quot;,
  &quot;itertools 0.13.0&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -2749,14 +2803,14 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;ethereum_ssz_derive&quot;
<span class="term-fg31">-version = &quot;0.8.0&quot;</span>
<span class="term-fg32">+version = &quot;0.8.1&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;0d37845ba7c16bf4be8be4b5786f03a2ba5f2fda0d7f9e7cb2282f69cff420d7&quot;</span>
<span class="term-fg32">+checksum = &quot;9dc8e67e1f770f5aa4c2c2069aaaf9daee7ac21bed357a71b911b37a58966cfb&quot;</span>
 dependencies = [
  &quot;darling&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -2830,6 +2884,7 @@</span>  &quot;reth-evm&quot;,
  &quot;reth-evm-ethereum&quot;,
  &quot;reth-node-ethereum&quot;,
  &quot;reth-primitives&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -3145,9 +3200,9 @@</span>
 [[package]]
 name = &quot;ff&quot;
 version = &quot;0.13.0&quot;
<span class="term-fg31">-source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg31">-checksum = &quot;ded41244b729663b1e574f1b4fb731469f69f79c17667b5d776b16cda0479449&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;ff?branch=feat&#47;sp1#244b1098f6be1d19c5fd3f0ec60117ac2940e6ca&quot;</span>
 dependencies = [
<span class="term-fg32">+ &quot;bitvec&quot;,</span>
  &quot;rand_core 0.6.4&quot;,
  &quot;subtle&quot;,
 ]
<span class="term-fg36">@@ -3317,7 +3372,7 @@</span> checksum = &quot;162ee34ebcb7c64a8abebc059ce0fee27c2262618d7b60ed8faf72fef13c3650&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -3368,9 +3423,9 @@</span> checksum = &quot;42012b0f064e01aa58b545fe3727f90f7dd4020f4a3ea735b50344965f5a57e9&quot;
&nbsp;
 [[package]]
 name = &quot;generator&quot;
<span class="term-fg31">-version = &quot;0.8.3&quot;</span>
<span class="term-fg32">+version = &quot;0.8.4&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;dbb949699c3e4df3a183b1d2142cb24277057055ed23c68ed58894f76c517223&quot;</span>
<span class="term-fg32">+checksum = &quot;cc6bd114ceda131d3b1d665eba35788690ad37f5916457286b32ab6fd3c438dd&quot;</span>
 dependencies = [
  &quot;cfg-if&quot;,
  &quot;libc&quot;,
<span class="term-fg36">@@ -3484,6 +3539,14 @@</span>  &quot;web-sys&quot;,
 ]
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;gobuild&quot;</span>
<span class="term-fg32">+version = &quot;0.1.0-alpha.2&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;gobuild.git#24935c2b8f677841f22acd6710957621bb294e0e&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;cc&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;group&quot;
 version = &quot;0.13.0&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -3506,7 +3569,7 @@</span>  &quot;fnv&quot;,
  &quot;futures-core&quot;,
  &quot;futures-sink&quot;,
  &quot;http&quot;,
<span class="term-fg31">- &quot;indexmap 2.6.0&quot;,</span>
<span class="term-fg32">+ &quot;indexmap 2.7.0&quot;,</span>
  &quot;slab&quot;,
  &quot;tokio&quot;,
  &quot;tokio-util&quot;,
<span class="term-fg36">@@ -3553,9 +3616,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;hashbrown&quot;
<span class="term-fg31">-version = &quot;0.15.1&quot;</span>
<span class="term-fg32">+version = &quot;0.15.2&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;3a9bfc1af68b1726ea47d3d5109de126281def866b33970e10fbab11b5dafab3&quot;</span>
<span class="term-fg32">+checksum = &quot;bf151400ff0baff5465007dd2f3e717f3fe502074ca563069ce3a6629d07b289&quot;</span>
 dependencies = [
  &quot;allocator-api2&quot;,
  &quot;equivalent&quot;,
<span class="term-fg36">@@ -3581,6 +3644,12 @@</span> dependencies = [
  &quot;byteorder&quot;,
  &quot;num-traits&quot;,
 ]
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;heck&quot;</span>
<span class="term-fg32">+version = &quot;0.4.1&quot;</span>
<span class="term-fg32">+source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg32">+checksum = &quot;95505c38b4572b2d910cecb0281560f54b440a19336cbbcb27bf6ce6adc6f5a8&quot;</span>
&nbsp;
 [[package]]
 name = &quot;heck&quot;
<span class="term-fg36">@@ -3616,6 +3685,54 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;6fe2267d4ed49bc07b63801559be28c718ea06c4738b7a03c94df7386d2cde46&quot;
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;hickory-proto&quot;</span>
<span class="term-fg32">+version = &quot;0.25.0-alpha.4&quot;</span>
<span class="term-fg32">+source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg32">+checksum = &quot;d063c0692ee669aa6d261988aa19ca5510f1cc40e4f211024f50c888499a35d7&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;async-recursion&quot;,</span>
<span class="term-fg32">+ &quot;async-trait&quot;,</span>
<span class="term-fg32">+ &quot;cfg-if&quot;,</span>
<span class="term-fg32">+ &quot;data-encoding&quot;,</span>
<span class="term-fg32">+ &quot;enum-as-inner&quot;,</span>
<span class="term-fg32">+ &quot;futures-channel&quot;,</span>
<span class="term-fg32">+ &quot;futures-io&quot;,</span>
<span class="term-fg32">+ &quot;futures-util&quot;,</span>
<span class="term-fg32">+ &quot;idna&quot;,</span>
<span class="term-fg32">+ &quot;ipnet&quot;,</span>
<span class="term-fg32">+ &quot;once_cell&quot;,</span>
<span class="term-fg32">+ &quot;rand 0.8.5&quot;,</span>
<span class="term-fg32">+ &quot;serde&quot;,</span>
<span class="term-fg32">+ &quot;thiserror 2.0.4&quot;,</span>
<span class="term-fg32">+ &quot;tinyvec&quot;,</span>
<span class="term-fg32">+ &quot;tokio&quot;,</span>
<span class="term-fg32">+ &quot;tracing&quot;,</span>
<span class="term-fg32">+ &quot;url&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;hickory-resolver&quot;</span>
<span class="term-fg32">+version = &quot;0.25.0-alpha.4&quot;</span>
<span class="term-fg32">+source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg32">+checksum = &quot;42bc352e4412fb657e795f79b4efcf2bd60b59ee5ca0187f3554194cd1107a27&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;cfg-if&quot;,</span>
<span class="term-fg32">+ &quot;futures-util&quot;,</span>
<span class="term-fg32">+ &quot;hickory-proto&quot;,</span>
<span class="term-fg32">+ &quot;ipconfig&quot;,</span>
<span class="term-fg32">+ &quot;moka&quot;,</span>
<span class="term-fg32">+ &quot;once_cell&quot;,</span>
<span class="term-fg32">+ &quot;parking_lot&quot;,</span>
<span class="term-fg32">+ &quot;rand 0.8.5&quot;,</span>
<span class="term-fg32">+ &quot;resolv-conf&quot;,</span>
<span class="term-fg32">+ &quot;serde&quot;,</span>
<span class="term-fg32">+ &quot;smallvec&quot;,</span>
<span class="term-fg32">+ &quot;thiserror 2.0.4&quot;,</span>
<span class="term-fg32">+ &quot;tokio&quot;,</span>
<span class="term-fg32">+ &quot;tracing&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;hkdf&quot;
 version = &quot;0.12.4&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -3667,9 +3784,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;http&quot;
<span class="term-fg31">-version = &quot;1.1.0&quot;</span>
<span class="term-fg32">+version = &quot;1.2.0&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;21b9ddb458710bc376481b842f5da65cdf31522de232c1ca8146abce2a358258&quot;</span>
<span class="term-fg32">+checksum = &quot;f16ca2af56261c99fba8bac40a10251ce8188205a4c448fbb745a2e4daa76fea&quot;</span>
 dependencies = [
  &quot;bytes&quot;,
  &quot;fnv&quot;,
<span class="term-fg36">@@ -3701,9 +3818,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;http-range-header&quot;
<span class="term-fg31">-version = &quot;0.4.1&quot;</span>
<span class="term-fg32">+version = &quot;0.4.2&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;08a397c49fec283e3d6211adbe480be95aae5f304cfb923e9970e08956d5168a&quot;</span>
<span class="term-fg32">+checksum = &quot;9171a2ea8a68358193d15dd5d70c1c10a2afc3e7e4c5bc92bc9f025cebd7359c&quot;</span>
&nbsp;
 [[package]]
 name = &quot;http-types&quot;
<span class="term-fg36">@@ -3821,36 +3938,36 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;iai-callgrind&quot;
<span class="term-fg31">-version = &quot;0.13.4&quot;</span>
<span class="term-fg32">+version = &quot;0.14.0&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;4bd871e6374d5ca2d9b48dd23b3c7ef63a4201728621f6d75937dfcc66e91809&quot;</span>
<span class="term-fg32">+checksum = &quot;22275f8051874cd2f05b2aa1e0098d5cbec34df30ff92f1a1e2686a4cefed870&quot;</span>
 dependencies = [
  &quot;bincode&quot;,
<span class="term-fg31">- &quot;derive_more 0.99.18&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;iai-callgrind-macros&quot;,
  &quot;iai-callgrind-runner&quot;,
 ]
&nbsp;
 [[package]]
 name = &quot;iai-callgrind-macros&quot;
<span class="term-fg31">-version = &quot;0.4.1&quot;</span>
<span class="term-fg32">+version = &quot;0.5.0&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;397649417510422ded7033f86132f833cca8c2e5081d0dfbec939b2353da7021&quot;</span>
<span class="term-fg32">+checksum = &quot;e8e6677dc52bd798b988e62ffd6831bf7eb46e4348cb1c74c1164954ebd0e5a1&quot;</span>
 dependencies = [
<span class="term-fg31">- &quot;derive_more 0.99.18&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;proc-macro-error2&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
  &quot;serde&quot;,
  &quot;serde_json&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
 name = &quot;iai-callgrind-runner&quot;
<span class="term-fg31">-version = &quot;0.13.4&quot;</span>
<span class="term-fg32">+version = &quot;0.14.0&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;f3783c337f9e931af702b5d5835ff2a6824bf55e416461a4e042dfb4b8fdbbea&quot;</span>
<span class="term-fg32">+checksum = &quot;a02dd95fe4949513b45a328b5b18f527ee02e96f3428b48090aa7cf9043ab0b8&quot;</span>
 dependencies = [
  &quot;serde&quot;,
 ]
<span class="term-fg36">@@ -3993,7 +4110,7 @@</span> checksum = &quot;1ec89e9337638ecdc08744df490b221a7399bf8d164eb52a665454e60e075ad6&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -4004,16 +4121,6 @@</span> checksum = &quot;b9e0384b61958566e926dc50660321d12159025e767c18e043daf26b70104c39&quot;
&nbsp;
 [[package]]
 name = &quot;idna&quot;
<span class="term-fg31">-version = &quot;0.4.0&quot;</span>
<span class="term-fg31">-source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg31">-checksum = &quot;7d20d6b07bfbc108882d88ed8e37d39636dcc260e15e30c45e6ba089610b917c&quot;</span>
<span class="term-fg31">-dependencies = [</span>
<span class="term-fg31">- &quot;unicode-bidi&quot;,</span>
<span class="term-fg31">- &quot;unicode-normalization&quot;,</span>
<span class="term-fg31">-]</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-[[package]]</span>
<span class="term-fg31">-name = &quot;idna&quot;</span>
 version = &quot;1.0.3&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;686f825264d630750a544639377bae737628043f20d38bbc029e8f29ea968a7e&quot;
<span class="term-fg36">@@ -4060,7 +4167,7 @@</span> checksum = &quot;a0eb5a3343abf848c0984fe4604b2b105da9539376e24fc0a3b0007411ae4fd9&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -4101,13 +4208,13 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;indexmap&quot;
<span class="term-fg31">-version = &quot;2.6.0&quot;</span>
<span class="term-fg32">+version = &quot;2.7.0&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;707907fe3c25f5424cce2cb7e1cbcafee6bdbe735ca90ef77c29e84591e5b9da&quot;</span>
<span class="term-fg32">+checksum = &quot;62f822373a4fe84d4bb149bf54e584a7f4abec90e072ed49cda0edea5b95471f&quot;</span>
 dependencies = [
  &quot;arbitrary&quot;,
  &quot;equivalent&quot;,
<span class="term-fg31">- &quot;hashbrown 0.15.1&quot;,</span>
<span class="term-fg32">+ &quot;hashbrown 0.15.2&quot;,</span>
  &quot;serde&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -4130,7 +4237,7 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;232929e1d75fe899576a3d5c7416ad0d88dbfbb3c3d6aa00873a7408a50ddb88&quot;
 dependencies = [
  &quot;ahash&quot;,
<span class="term-fg31">- &quot;indexmap 2.6.0&quot;,</span>
<span class="term-fg32">+ &quot;indexmap 2.7.0&quot;,</span>
  &quot;is-terminal&quot;,
  &quot;itoa&quot;,
  &quot;log&quot;,
<span class="term-fg36">@@ -4182,7 +4289,7 @@</span>  &quot;indoc&quot;,
  &quot;pretty_assertions&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -4283,9 +4390,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;itoa&quot;
<span class="term-fg31">-version = &quot;1.0.13&quot;</span>
<span class="term-fg32">+version = &quot;1.0.14&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;540654e97a3f4470a492cd30ff187bc95d89557a903a2bbf112e2fae98104ef2&quot;</span>
<span class="term-fg32">+checksum = &quot;d75a2a4b1b190afb6f5425f10f6a8f959d2ea0b9c2b1d79553551850539e4674&quot;</span>
&nbsp;
 [[package]]
 name = &quot;jni&quot;
<span class="term-fg36">@@ -4318,10 +4425,11 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;js-sys&quot;
<span class="term-fg31">-version = &quot;0.3.72&quot;</span>
<span class="term-fg32">+version = &quot;0.3.74&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;6a88f1bda2bd75b0452a14784937d796722fdebfe50df998aeb3f0b7603019a9&quot;</span>
<span class="term-fg32">+checksum = &quot;a865e038f7f6ed956f788f0d7d60c541fff74c7bd74272c5d4cf15c63743e705&quot;</span>
 dependencies = [
<span class="term-fg32">+ &quot;once_cell&quot;,</span>
  &quot;wasm-bindgen&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -4385,7 +4493,7 @@</span>  &quot;jsonrpsee-types&quot;,
  &quot;parking_lot&quot;,
  &quot;pin-project&quot;,
  &quot;rand 0.8.5&quot;,
<span class="term-fg31">- &quot;rustc-hash 2.0.0&quot;,</span>
<span class="term-fg32">+ &quot;rustc-hash 2.1.0&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_json&quot;,
  &quot;thiserror 1.0.69&quot;,
<span class="term-fg36">@@ -4426,11 +4534,11 @@</span> version = &quot;0.24.7&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;c06c01ae0007548e73412c08e2285ffe5d723195bf268bce67b1b77c3bb2a14d&quot;
 dependencies = [
<span class="term-fg31">- &quot;heck&quot;,</span>
<span class="term-fg32">+ &quot;heck 0.5.0&quot;,</span>
  &quot;proc-macro-crate&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -4590,15 +4698,15 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;libc&quot;
<span class="term-fg31">-version = &quot;0.2.165&quot;</span>
<span class="term-fg32">+version = &quot;0.2.167&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;fcb4d3d38eab6c5239a362fa8bae48c03baf980a6e7079f063942d563ef3533e&quot;</span>
<span class="term-fg32">+checksum = &quot;09d6582e104315a817dff97f75133544b2e094ee22447d2acf4a74e189ba06fc&quot;</span>
&nbsp;
 [[package]]
 name = &quot;libloading&quot;
<span class="term-fg31">-version = &quot;0.8.5&quot;</span>
<span class="term-fg32">+version = &quot;0.8.6&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;4979f22fdb869068da03c9f7528f8297c6fd2606bc3a4affe42e6a823fdb8da4&quot;</span>
<span class="term-fg32">+checksum = &quot;fc2f4eb4bc735547cfed7c0a4922cbd04a4655978c09b54f1f7b228750664c34&quot;</span>
 dependencies = [
  &quot;cfg-if&quot;,
  &quot;windows-targets 0.52.6&quot;,
<span class="term-fg36">@@ -4763,16 +4871,7 @@</span> version = &quot;0.12.5&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;234cf4f4a04dc1f57e24b96cc0cd600cf2af460d4161ac5ecdd0af8e1f3b2a38&quot;
 dependencies = [
<span class="term-fg31">- &quot;hashbrown 0.15.1&quot;,</span>
<span class="term-fg31">-]</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-[[package]]</span>
<span class="term-fg31">-name = &quot;lru-cache&quot;</span>
<span class="term-fg31">-version = &quot;0.1.2&quot;</span>
<span class="term-fg31">-source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg31">-checksum = &quot;31e24f1ad8321ca0e8a1e0ac13f23cb668e6f5466c2c57319f6a5cf1cc8e3b1c&quot;</span>
<span class="term-fg31">-dependencies = [</span>
<span class="term-fg31">- &quot;linked-hash-map&quot;,</span>
<span class="term-fg32">+ &quot;hashbrown 0.15.2&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -4831,9 +4930,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;metrics&quot;
<span class="term-fg31">-version = &quot;0.24.0&quot;</span>
<span class="term-fg32">+version = &quot;0.24.1&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;8ae428771d17306715c5091d446327d1cfdedc82185c65ba8423ab404e45bf10&quot;</span>
<span class="term-fg32">+checksum = &quot;7a7deb012b3b2767169ff203fadb4c6b0b82b947512e5eb9e0b78c2e186ad9e3&quot;</span>
 dependencies = [
  &quot;ahash&quot;,
  &quot;portable-atomic&quot;,
<span class="term-fg36">@@ -4848,7 +4947,7 @@</span> dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
  &quot;regex&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -4858,7 +4957,7 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;85b6f8152da6d7892ff1b7a1c0fa3f435e92b5918ad67035c3bb432111d9a29b&quot;
 dependencies = [
  &quot;base64 0.22.1&quot;,
<span class="term-fg31">- &quot;indexmap 2.6.0&quot;,</span>
<span class="term-fg32">+ &quot;indexmap 2.7.0&quot;,</span>
  &quot;metrics&quot;,
  &quot;metrics-util&quot;,
  &quot;quanta&quot;,
<span class="term-fg36">@@ -4867,9 +4966,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;metrics-process&quot;
<span class="term-fg31">-version = &quot;2.3.1&quot;</span>
<span class="term-fg32">+version = &quot;2.4.0&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;57ca8ecd85575fbb143b2678cb123bb818779391ec0f745b1c4a9dbabadde407&quot;</span>
<span class="term-fg32">+checksum = &quot;4a82c8add4382f29a122fa64fff1891453ed0f6b2867d971e7d60cb8dfa322ff&quot;</span>
 dependencies = [
  &quot;libc&quot;,
  &quot;libproc&quot;,
<span class="term-fg36">@@ -4889,8 +4988,8 @@</span> checksum = &quot;15b482df36c13dd1869d73d14d28cd4855fbd6cfc32294bee109908a9f4a4ed7&quot;
 dependencies = [
  &quot;crossbeam-epoch&quot;,
  &quot;crossbeam-utils&quot;,
<span class="term-fg31">- &quot;hashbrown 0.15.1&quot;,</span>
<span class="term-fg31">- &quot;indexmap 2.6.0&quot;,</span>
<span class="term-fg32">+ &quot;hashbrown 0.15.2&quot;,</span>
<span class="term-fg32">+ &quot;indexmap 2.7.0&quot;,</span>
  &quot;metrics&quot;,
  &quot;ordered-float&quot;,
  &quot;quanta&quot;,
<span class="term-fg36">@@ -4962,11 +5061,10 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;mio&quot;
<span class="term-fg31">-version = &quot;1.0.2&quot;</span>
<span class="term-fg32">+version = &quot;1.0.3&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;80e04d1dcff3aae0704555fe5fee3bcfaf3d1fdf8a7e521d5b9d2b42acb52cec&quot;</span>
<span class="term-fg32">+checksum = &quot;2886843bf800fba2e3377cff24abf6379b4c4d5c6681eaf9ea5b0d15090450bd&quot;</span>
 dependencies = [
<span class="term-fg31">- &quot;hermit-abi 0.3.9&quot;,</span>
  &quot;libc&quot;,
  &quot;log&quot;,
  &quot;wasi 0.11.0+wasi-snapshot-preview1&quot;,
<span class="term-fg36">@@ -4996,7 +5094,7 @@</span> dependencies = [
  &quot;cfg-if&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -5021,6 +5119,26 @@</span>  &quot;syn 1.0.109&quot;,
 ]
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;moka&quot;</span>
<span class="term-fg32">+version = &quot;0.12.8&quot;</span>
<span class="term-fg32">+source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg32">+checksum = &quot;32cf62eb4dd975d2dde76432fb1075c49e3ee2331cf36f1f8fd4b66550d32b6f&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;crossbeam-channel&quot;,</span>
<span class="term-fg32">+ &quot;crossbeam-epoch&quot;,</span>
<span class="term-fg32">+ &quot;crossbeam-utils&quot;,</span>
<span class="term-fg32">+ &quot;once_cell&quot;,</span>
<span class="term-fg32">+ &quot;parking_lot&quot;,</span>
<span class="term-fg32">+ &quot;quanta&quot;,</span>
<span class="term-fg32">+ &quot;rustc_version 0.4.1&quot;,</span>
<span class="term-fg32">+ &quot;smallvec&quot;,</span>
<span class="term-fg32">+ &quot;tagptr&quot;,</span>
<span class="term-fg32">+ &quot;thiserror 1.0.69&quot;,</span>
<span class="term-fg32">+ &quot;triomphe&quot;,</span>
<span class="term-fg32">+ &quot;uuid&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;more-asserts&quot;
 version = &quot;0.3.1&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -5166,6 +5284,17 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;51d515d32fb182ee37cda2ccdcb92950d6a3c2893aa280e540671c2cd0f3b1d9&quot;
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;num-derive&quot;</span>
<span class="term-fg32">+version = &quot;0.3.3&quot;</span>
<span class="term-fg32">+source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg32">+checksum = &quot;876a53fff98e03a936a674b29568b0e605f06b29372c2489ff4de23f1949743d&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;proc-macro2&quot;,</span>
<span class="term-fg32">+ &quot;quote&quot;,</span>
<span class="term-fg32">+ &quot;syn 1.0.109&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;num-format&quot;
 version = &quot;0.4.4&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -5244,7 +5373,7 @@</span> dependencies = [
  &quot;proc-macro-crate&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -5307,10 +5436,10 @@</span>  &quot;alloy-primitives&quot;,
  &quot;alloy-rlp&quot;,
  &quot;alloy-serde&quot;,
  &quot;arbitrary&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_with&quot;,
<span class="term-fg31">- &quot;thiserror 2.0.3&quot;,</span>
<span class="term-fg32">+ &quot;thiserror 2.0.4&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -5325,7 +5454,7 @@</span>  &quot;alloy-primitives&quot;,
  &quot;alloy-sol-types&quot;,
  &quot;serde&quot;,
  &quot;serde_repr&quot;,
<span class="term-fg31">- &quot;thiserror 2.0.3&quot;,</span>
<span class="term-fg32">+ &quot;thiserror 2.0.4&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -5361,7 +5490,7 @@</span>  &quot;miniz_oxide&quot;,
  &quot;op-alloy-consensus&quot;,
  &quot;op-alloy-genesis&quot;,
  &quot;serde&quot;,
<span class="term-fg31">- &quot;thiserror 2.0.3&quot;,</span>
<span class="term-fg32">+ &quot;thiserror 2.0.4&quot;,</span>
  &quot;tracing&quot;,
  &quot;unsigned-varint&quot;,
 ]
<span class="term-fg36">@@ -5379,7 +5508,7 @@</span>  &quot;alloy-primitives&quot;,
  &quot;alloy-rpc-types-eth&quot;,
  &quot;alloy-serde&quot;,
  &quot;arbitrary&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;op-alloy-consensus&quot;,
  &quot;serde&quot;,
  &quot;serde_json&quot;,
<span class="term-fg36">@@ -5395,13 +5524,13 @@</span>  &quot;alloy-eips&quot;,
  &quot;alloy-primitives&quot;,
  &quot;alloy-rpc-types-engine&quot;,
  &quot;alloy-serde&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;ethereum_ssz&quot;,
  &quot;op-alloy-consensus&quot;,
  &quot;op-alloy-protocol&quot;,
  &quot;serde&quot;,
  &quot;snap&quot;,
<span class="term-fg31">- &quot;thiserror 2.0.3&quot;,</span>
<span class="term-fg32">+ &quot;thiserror 2.0.4&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -5481,9 +5610,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;parity-scale-codec&quot;
<span class="term-fg31">-version = &quot;3.7.0&quot;</span>
<span class="term-fg32">+version = &quot;3.6.12&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;8be4817d39f3272f69c59fe05d0535ae6456c2dc2fa1ba02910296c7e0a5c590&quot;</span>
<span class="term-fg32">+checksum = &quot;306800abfa29c7f16596b5970a588435e3d5b3149683d00c12b699cc19f895ee&quot;</span>
 dependencies = [
  &quot;arbitrary&quot;,
  &quot;arrayvec&quot;,
<span class="term-fg36">@@ -5492,20 +5621,19 @@</span>  &quot;byte-slice-cast&quot;,
  &quot;bytes&quot;,
  &quot;impl-trait-for-tuples&quot;,
  &quot;parity-scale-codec-derive&quot;,
<span class="term-fg31">- &quot;rustversion&quot;,</span>
  &quot;serde&quot;,
 ]
&nbsp;
 [[package]]
 name = &quot;parity-scale-codec-derive&quot;
<span class="term-fg31">-version = &quot;3.7.0&quot;</span>
<span class="term-fg32">+version = &quot;3.6.12&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;8781a75c6205af67215f382092b6e0a4ff3734798523e69073d4bcd294ec767b&quot;</span>
<span class="term-fg32">+checksum = &quot;d830939c76d294956402033aee57a6da7b438f2294eb94864c37b0569053a42c&quot;</span>
 dependencies = [
  &quot;proc-macro-crate&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 1.0.109&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -5620,7 +5748,7 @@</span>  &quot;phf_generator&quot;,
  &quot;phf_shared&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -5649,7 +5777,7 @@</span> checksum = &quot;3c0f5fad0874fc7abcd4d750e76917eaebbecaa2c20bde22e1dbeeba8beb758c&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -5742,6 +5870,25 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;280dc24453071f1b63954171985a0b0d30058d287960968b9b2aca264c8d4ee6&quot;
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;poseidon-bn254&quot;</span>
<span class="term-fg32">+version = &quot;0.1.0&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254?branch=master#254baa0e3e85c0975c16fe6f33042b1fa9ae0a44&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;bn254 0.1.0 (git+https:&#47;&#47;github.com&#47;scroll-tech&#47;bn254.git?branch=master)&quot;,</span>
<span class="term-fg32">+ &quot;itertools 0.13.0&quot;,</span>
<span class="term-fg32">+ &quot;sp1-intrinsics&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;poseidon-bn254&quot;</span>
<span class="term-fg32">+version = &quot;0.1.0&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254?rev=526a64a#526a64a81419bcab6bd8280a8a3f9808189e0373&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;bn254 0.1.0 (git+https:&#47;&#47;github.com&#47;scroll-tech&#47;bn254)&quot;,</span>
<span class="term-fg32">+ &quot;itertools 0.13.0&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;powerfmt&quot;
 version = &quot;0.2.0&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -5749,10 +5896,11 @@</span> checksum = &quot;439ee305def115ba05938db6eb1644ff94165c5ab5e9420d1c1bcedbba909391&quot;
&nbsp;
 [[package]]
 name = &quot;pprof&quot;
<span class="term-fg31">-version = &quot;0.13.0&quot;</span>
<span class="term-fg32">+version = &quot;0.14.0&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;ef5c97c51bd34c7e742402e216abdeb44d415fbe6ae41d56b114723e953711cb&quot;</span>
<span class="term-fg32">+checksum = &quot;ebbe2f8898beba44815fdc9e5a4ae9c929e21c5dc29b0c774a15555f7f58d6d0&quot;</span>
 dependencies = [
<span class="term-fg32">+ &quot;aligned-vec&quot;,</span>
  &quot;backtrace&quot;,
  &quot;cfg-if&quot;,
  &quot;criterion&quot;,
<span class="term-fg36">@@ -5821,7 +5969,7 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;64d1ec885c64d0457d564db4ec299b2dae3f9c02808b8ad9c3a089c591b18033&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -5872,7 +6020,7 @@</span> dependencies = [
  &quot;proc-macro-error-attr2&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -5970,7 +6118,7 @@</span> checksum = &quot;6ff7ff745a347b87471d859a377a9a404361e7efc2a971d73424a6d183c0fc77&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -6022,10 +6170,10 @@</span>  &quot;bytes&quot;,
  &quot;pin-project-lite&quot;,
  &quot;quinn-proto&quot;,
  &quot;quinn-udp&quot;,
<span class="term-fg31">- &quot;rustc-hash 2.0.0&quot;,</span>
<span class="term-fg32">+ &quot;rustc-hash 2.1.0&quot;,</span>
  &quot;rustls&quot;,
  &quot;socket2&quot;,
<span class="term-fg31">- &quot;thiserror 2.0.3&quot;,</span>
<span class="term-fg32">+ &quot;thiserror 2.0.4&quot;,</span>
  &quot;tokio&quot;,
  &quot;tracing&quot;,
 ]
<span class="term-fg36">@@ -6040,11 +6188,11 @@</span>  &quot;bytes&quot;,
  &quot;getrandom 0.2.15&quot;,
  &quot;rand 0.8.5&quot;,
  &quot;ring&quot;,
<span class="term-fg31">- &quot;rustc-hash 2.0.0&quot;,</span>
<span class="term-fg32">+ &quot;rustc-hash 2.1.0&quot;,</span>
  &quot;rustls&quot;,
  &quot;rustls-pki-types&quot;,
  &quot;slab&quot;,
<span class="term-fg31">- &quot;thiserror 2.0.3&quot;,</span>
<span class="term-fg32">+ &quot;thiserror 2.0.4&quot;,</span>
  &quot;tinyvec&quot;,
  &quot;tracing&quot;,
  &quot;web-time&quot;,
<span class="term-fg36">@@ -6174,8 +6322,8 @@</span>  &quot;instability&quot;,
  &quot;itertools 0.13.0&quot;,
  &quot;lru&quot;,
  &quot;paste&quot;,
<span class="term-fg31">- &quot;strum&quot;,</span>
<span class="term-fg31">- &quot;strum_macros&quot;,</span>
<span class="term-fg32">+ &quot;strum 0.26.3&quot;,</span>
<span class="term-fg32">+ &quot;strum_macros 0.26.4&quot;,</span>
  &quot;unicode-segmentation&quot;,
  &quot;unicode-truncate&quot;,
  &quot;unicode-width 0.1.14&quot;,
<span class="term-fg36">@@ -6415,8 +6563,6 @@</span>  &quot;reth-static-file&quot;,
  &quot;reth-tasks&quot;,
  &quot;reth-tracing&quot;,
  &quot;reth-transaction-pool&quot;,
<span class="term-fg31">- &quot;reth-trie&quot;,</span>
<span class="term-fg31">- &quot;reth-trie-db&quot;,</span>
  &quot;serde_json&quot;,
  &quot;similar-asserts&quot;,
  &quot;tempfile&quot;,
<span class="term-fg36">@@ -6445,9 +6591,9 @@</span>  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-tasks&quot;,
  &quot;reth-transaction-pool&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;tokio&quot;,
  &quot;tracing&quot;,
 ]
<span class="term-fg36">@@ -6572,6 +6718,8 @@</span>  &quot;reth-node-types&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-stages-api&quot;,
  &quot;reth-storage-errors&quot;,
  &quot;reth-testing-utils&quot;,
<span class="term-fg36">@@ -6604,7 +6752,7 @@</span>  &quot;alloy-eips&quot;,
  &quot;alloy-primitives&quot;,
  &quot;alloy-signer&quot;,
  &quot;alloy-signer-local&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;metrics&quot;,
  &quot;parking_lot&quot;,
  &quot;pin-project&quot;,
<span class="term-fg36">@@ -6615,10 +6763,10 @@</span>  &quot;reth-execution-types&quot;,
  &quot;reth-metrics&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-storage-api&quot;,
  &quot;reth-testing-utils&quot;,
  &quot;reth-trie&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;tokio&quot;,
  &quot;tokio-stream&quot;,
  &quot;tracing&quot;,
<span class="term-fg36">@@ -6636,7 +6784,7 @@</span>  &quot;alloy-primitives&quot;,
  &quot;alloy-rlp&quot;,
  &quot;alloy-trie&quot;,
  &quot;auto_impl&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;once_cell&quot;,
  &quot;reth-ethereum-forks&quot;,
  &quot;reth-network-peers&quot;,
<span class="term-fg36">@@ -6717,7 +6865,6 @@</span>  &quot;reth-static-file&quot;,
  &quot;reth-static-file-types&quot;,
  &quot;reth-trie&quot;,
  &quot;reth-trie-common&quot;,
<span class="term-fg31">- &quot;reth-trie-db&quot;,</span>
  &quot;secp256k1&quot;,
  &quot;serde&quot;,
  &quot;serde_json&quot;,
<span class="term-fg36">@@ -6783,7 +6930,7 @@</span>  &quot;convert_case&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
  &quot;similar-asserts&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -6810,7 +6957,7 @@</span>  &quot;alloy-consensus&quot;,
  &quot;alloy-eips&quot;,
  &quot;alloy-primitives&quot;,
  &quot;auto_impl&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
 ]
<span class="term-fg36">@@ -6865,7 +7012,7 @@</span>  &quot;arbitrary&quot;,
  &quot;assert_matches&quot;,
  &quot;bytes&quot;,
  &quot;criterion&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;eyre&quot;,
  &quot;iai-callgrind&quot;,
  &quot;metrics&quot;,
<span class="term-fg36">@@ -6882,14 +7029,15 @@</span>  &quot;reth-nippy-jar&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-prune-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
  &quot;reth-stages-types&quot;,
  &quot;reth-storage-errors&quot;,
  &quot;reth-tracing&quot;,
  &quot;reth-trie-common&quot;,
<span class="term-fg31">- &quot;rustc-hash 2.0.0&quot;,</span>
<span class="term-fg32">+ &quot;rustc-hash 2.1.0&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_json&quot;,
<span class="term-fg31">- &quot;strum&quot;,</span>
<span class="term-fg32">+ &quot;strum 0.26.3&quot;,</span>
  &quot;sysinfo&quot;,
  &quot;tempfile&quot;,
  &quot;test-fuzz&quot;,
<span class="term-fg36">@@ -6905,7 +7053,7 @@</span>  &quot;alloy-genesis&quot;,
  &quot;alloy-primitives&quot;,
  &quot;arbitrary&quot;,
  &quot;bytes&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;metrics&quot;,
  &quot;modular-bitfield&quot;,
  &quot;parity-scale-codec&quot;,
<span class="term-fg36">@@ -6944,6 +7092,7 @@</span>  &quot;reth-node-types&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-provider&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
  &quot;reth-stages-types&quot;,
  &quot;reth-trie&quot;,
  &quot;reth-trie-db&quot;,
<span class="term-fg36">@@ -7003,7 +7152,7 @@</span> version = &quot;1.1.2&quot;
 dependencies = [
  &quot;alloy-primitives&quot;,
  &quot;alloy-rlp&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;discv5&quot;,
  &quot;enr&quot;,
  &quot;futures&quot;,
<span class="term-fg36">@@ -7030,6 +7179,7 @@</span>  &quot;alloy-primitives&quot;,
  &quot;alloy-rlp&quot;,
  &quot;data-encoding&quot;,
  &quot;enr&quot;,
<span class="term-fg32">+ &quot;hickory-resolver&quot;,</span>
  &quot;linked_hash_set&quot;,
  &quot;parking_lot&quot;,
  &quot;rand 0.8.5&quot;,
<span class="term-fg36">@@ -7046,7 +7196,6 @@</span>  &quot;thiserror 1.0.69&quot;,
  &quot;tokio&quot;,
  &quot;tokio-stream&quot;,
  &quot;tracing&quot;,
<span class="term-fg31">- &quot;trust-dns-resolver&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -7101,7 +7250,7 @@</span>  &quot;alloy-rpc-types-engine&quot;,
  &quot;alloy-rpc-types-eth&quot;,
  &quot;alloy-signer&quot;,
  &quot;alloy-signer-local&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;eyre&quot;,
  &quot;futures-util&quot;,
  &quot;jsonrpsee&quot;,
<span class="term-fg36">@@ -7284,6 +7433,8 @@</span>  &quot;reth-prune&quot;,
  &quot;reth-prune-types&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc-types-compat&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-stages&quot;,
  &quot;reth-stages-api&quot;,
  &quot;reth-static-file&quot;,
<span class="term-fg36">@@ -7322,6 +7473,8 @@</span>  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc-types-compat&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-trie&quot;,
  &quot;revm-primitives&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -7354,7 +7507,7 @@</span>  &quot;alloy-rlp&quot;,
  &quot;arbitrary&quot;,
  &quot;async-stream&quot;,
  &quot;bytes&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;futures&quot;,
  &quot;pin-project&quot;,
  &quot;proptest&quot;,
<span class="term-fg36">@@ -7392,7 +7545,7 @@</span>  &quot;alloy-primitives&quot;,
  &quot;alloy-rlp&quot;,
  &quot;arbitrary&quot;,
  &quot;bytes&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;proptest&quot;,
  &quot;proptest-arbitrary-interop&quot;,
  &quot;rand 0.8.5&quot;,
<span class="term-fg36">@@ -7465,7 +7618,7 @@</span>  &quot;dyn-clone&quot;,
  &quot;once_cell&quot;,
  &quot;proptest&quot;,
  &quot;proptest-derive&quot;,
<span class="term-fg31">- &quot;rustc-hash 2.0.0&quot;,</span>
<span class="term-fg32">+ &quot;rustc-hash 2.1.0&quot;,</span>
  &quot;serde&quot;,
  &quot;thiserror-no-std&quot;,
 ]
<span class="term-fg36">@@ -7490,9 +7643,8 @@</span>  &quot;reth-payload-primitives&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-transaction-pool&quot;,
<span class="term-fg31">- &quot;reth-trie&quot;,</span>
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;tracing&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -7529,8 +7681,9 @@</span>  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-prune-types&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-storage-errors&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;revm-primitives&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -7551,6 +7704,8 @@</span>  &quot;reth-evm&quot;,
  &quot;reth-execution-types&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
  &quot;reth-testing-utils&quot;,
  &quot;revm-primitives&quot;,
  &quot;secp256k1&quot;,
<span class="term-fg36">@@ -7564,7 +7719,7 @@</span> dependencies = [
  &quot;alloy-eips&quot;,
  &quot;alloy-primitives&quot;,
  &quot;alloy-rlp&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;nybbles&quot;,
  &quot;reth-consensus&quot;,
  &quot;reth-prune-types&quot;,
<span class="term-fg36">@@ -7585,9 +7740,9 @@</span>  &quot;rand 0.8.5&quot;,
  &quot;reth-execution-errors&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-trie&quot;,
  &quot;reth-trie-common&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_with&quot;,
 ]
<span class="term-fg36">@@ -7623,6 +7778,7 @@</span>  &quot;reth-primitives-traits&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-prune-types&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-stages-api&quot;,
  &quot;reth-tasks&quot;,
  &quot;reth-testing-utils&quot;,
<span class="term-fg36">@@ -7714,6 +7870,9 @@</span>  &quot;reth-primitives-traits&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc-api&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-tracing&quot;,
  &quot;reth-trie&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -7750,8 +7909,8 @@</span>  &quot;bitflags 2.6.0&quot;,
  &quot;byteorder&quot;,
  &quot;criterion&quot;,
  &quot;dashmap 6.1.0&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg31">- &quot;indexmap 2.6.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
<span class="term-fg32">+ &quot;indexmap 2.7.0&quot;,</span>
  &quot;parking_lot&quot;,
  &quot;pprof&quot;,
  &quot;rand 0.8.5&quot;,
<span class="term-fg36">@@ -7816,7 +7975,7 @@</span>  &quot;alloy-rlp&quot;,
  &quot;aquamarine&quot;,
  &quot;auto_impl&quot;,
  &quot;criterion&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;discv5&quot;,
  &quot;enr&quot;,
  &quot;futures&quot;,
<span class="term-fg36">@@ -7851,7 +8010,7 @@</span>  &quot;reth-tasks&quot;,
  &quot;reth-tokio-util&quot;,
  &quot;reth-tracing&quot;,
  &quot;reth-transaction-pool&quot;,
<span class="term-fg31">- &quot;rustc-hash 2.0.0&quot;,</span>
<span class="term-fg32">+ &quot;rustc-hash 2.1.0&quot;,</span>
  &quot;schnellru&quot;,
  &quot;secp256k1&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -7873,7 +8032,7 @@</span> dependencies = [
  &quot;alloy-primitives&quot;,
  &quot;alloy-rpc-types-admin&quot;,
  &quot;auto_impl&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;enr&quot;,
  &quot;futures&quot;,
  &quot;reth-eth-wire-types&quot;,
<span class="term-fg36">@@ -7896,7 +8055,7 @@</span>  &quot;alloy-consensus&quot;,
  &quot;alloy-eips&quot;,
  &quot;alloy-primitives&quot;,
  &quot;auto_impl&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;futures&quot;,
  &quot;parking_lot&quot;,
  &quot;reth-consensus&quot;,
<span class="term-fg36">@@ -7945,7 +8104,7 @@</span> version = &quot;1.1.2&quot;
 dependencies = [
  &quot;anyhow&quot;,
  &quot;bincode&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;lz4_flex&quot;,
  &quot;memmap2&quot;,
  &quot;rand 0.8.5&quot;,
<span class="term-fg36">@@ -8053,7 +8212,7 @@</span>  &quot;alloy-primitives&quot;,
  &quot;alloy-rpc-types-engine&quot;,
  &quot;clap&quot;,
  &quot;const_format&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;dirs-next&quot;,
  &quot;eyre&quot;,
  &quot;futures&quot;,
<span class="term-fg36">@@ -8085,7 +8244,7 @@</span>  &quot;reth-transaction-pool&quot;,
  &quot;secp256k1&quot;,
  &quot;serde&quot;,
  &quot;shellexpand&quot;,
<span class="term-fg31">- &quot;strum&quot;,</span>
<span class="term-fg32">+ &quot;strum 0.26.3&quot;,</span>
  &quot;thiserror 1.0.69&quot;,
  &quot;tokio&quot;,
  &quot;toml&quot;,
<span class="term-fg36">@@ -8133,11 +8292,11 @@</span>  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc&quot;,
  &quot;reth-rpc-eth-api&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-tasks&quot;,
  &quot;reth-tracing&quot;,
  &quot;reth-transaction-pool&quot;,
  &quot;reth-trie-db&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde_json&quot;,
  &quot;tokio&quot;,
 ]
<span class="term-fg36">@@ -8208,7 +8367,7 @@</span>  &quot;alloy-consensus&quot;,
  &quot;alloy-eips&quot;,
  &quot;alloy-genesis&quot;,
  &quot;alloy-primitives&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;once_cell&quot;,
  &quot;op-alloy-rpc-types&quot;,
  &quot;reth-chainspec&quot;,
<span class="term-fg36">@@ -8228,7 +8387,7 @@</span>  &quot;alloy-eips&quot;,
  &quot;alloy-primitives&quot;,
  &quot;alloy-rlp&quot;,
  &quot;clap&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;eyre&quot;,
  &quot;futures-util&quot;,
  &quot;op-alloy-consensus&quot;,
<span class="term-fg36">@@ -8295,7 +8454,7 @@</span>  &quot;alloy-consensus&quot;,
  &quot;alloy-eips&quot;,
  &quot;alloy-genesis&quot;,
  &quot;alloy-primitives&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;op-alloy-consensus&quot;,
  &quot;reth-chainspec&quot;,
  &quot;reth-consensus&quot;,
<span class="term-fg36">@@ -8310,7 +8469,8 @@</span>  &quot;reth-optimism-primitives&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-prune-types&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;revm-primitives&quot;,
  &quot;tracing&quot;,
 ]
<span class="term-fg36">@@ -8370,11 +8530,11 @@</span>  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc-server-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-tasks&quot;,
  &quot;reth-tracing&quot;,
  &quot;reth-transaction-pool&quot;,
  &quot;reth-trie-db&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_json&quot;,
  &quot;tokio&quot;,
<span class="term-fg36">@@ -8409,9 +8569,8 @@</span>  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc-types-compat&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-transaction-pool&quot;,
<span class="term-fg31">- &quot;reth-trie&quot;,</span>
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;sha2 0.10.8&quot;,
  &quot;thiserror 1.0.69&quot;,
  &quot;tracing&quot;,
<span class="term-fg36">@@ -8427,7 +8586,7 @@</span>  &quot;alloy-primitives&quot;,
  &quot;alloy-rlp&quot;,
  &quot;arbitrary&quot;,
  &quot;bytes&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;op-alloy-consensus&quot;,
  &quot;reth-codecs&quot;,
  &quot;reth-primitives&quot;,
<span class="term-fg36">@@ -8445,7 +8604,7 @@</span>  &quot;alloy-eips&quot;,
  &quot;alloy-primitives&quot;,
  &quot;alloy-rpc-types-debug&quot;,
  &quot;alloy-rpc-types-eth&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;jsonrpsee-core&quot;,
  &quot;jsonrpsee-types&quot;,
  &quot;op-alloy-consensus&quot;,
<span class="term-fg36">@@ -8472,9 +8631,9 @@</span>  &quot;reth-rpc-api&quot;,
  &quot;reth-rpc-eth-api&quot;,
  &quot;reth-rpc-eth-types&quot;,
  &quot;reth-rpc-server-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-tasks&quot;,
  &quot;reth-transaction-pool&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde_json&quot;,
  &quot;thiserror 1.0.69&quot;,
  &quot;tokio&quot;,
<span class="term-fg36">@@ -8508,7 +8667,7 @@</span>  &quot;reth-metrics&quot;,
  &quot;reth-payload-builder-primitives&quot;,
  &quot;reth-payload-primitives&quot;,
  &quot;reth-primitives&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;tokio&quot;,
  &quot;tokio-stream&quot;,
  &quot;tracing&quot;,
<span class="term-fg36">@@ -8583,7 +8742,7 @@</span>  &quot;bincode&quot;,
  &quot;bytes&quot;,
  &quot;c-kzg&quot;,
  &quot;criterion&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;k256&quot;,
  &quot;modular-bitfield&quot;,
  &quot;once_cell&quot;,
<span class="term-fg36">@@ -8598,10 +8757,11 @@</span>  &quot;reth-chainspec&quot;,
  &quot;reth-codecs&quot;,
  &quot;reth-ethereum-forks&quot;,
  &quot;reth-primitives-traits&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-static-file-types&quot;,
  &quot;reth-testing-utils&quot;,
  &quot;reth-trie-common&quot;,
<span class="term-fg31">- &quot;revm-primitives&quot;,</span>
  &quot;rstest&quot;,
  &quot;secp256k1&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -8625,13 +8785,14 @@</span>  &quot;auto_impl&quot;,
  &quot;bincode&quot;,
  &quot;byteorder&quot;,
  &quot;bytes&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;modular-bitfield&quot;,
  &quot;proptest&quot;,
  &quot;proptest-arbitrary-interop&quot;,
  &quot;rand 0.8.5&quot;,
  &quot;reth-codecs&quot;,
<span class="term-fg31">- &quot;revm-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;roaring&quot;,
  &quot;serde&quot;,
  &quot;serde_json&quot;,
<span class="term-fg36">@@ -8676,14 +8837,15 @@</span>  &quot;reth-optimism-primitives&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-prune-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-stages-types&quot;,
  &quot;reth-storage-api&quot;,
  &quot;reth-storage-errors&quot;,
  &quot;reth-testing-utils&quot;,
  &quot;reth-trie&quot;,
  &quot;reth-trie-db&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
<span class="term-fg31">- &quot;strum&quot;,</span>
<span class="term-fg32">+ &quot;strum 0.26.3&quot;,</span>
  &quot;tempfile&quot;,
  &quot;tokio&quot;,
  &quot;tracing&quot;,
<span class="term-fg36">@@ -8715,7 +8877,7 @@</span>  &quot;reth-static-file-types&quot;,
  &quot;reth-testing-utils&quot;,
  &quot;reth-tokio-util&quot;,
  &quot;reth-tracing&quot;,
<span class="term-fg31">- &quot;rustc-hash 2.0.0&quot;,</span>
<span class="term-fg32">+ &quot;rustc-hash 2.1.0&quot;,</span>
  &quot;thiserror 1.0.69&quot;,
  &quot;tokio&quot;,
  &quot;tracing&quot;,
<span class="term-fg36">@@ -8729,7 +8891,7 @@</span>  &quot;alloy-primitives&quot;,
  &quot;arbitrary&quot;,
  &quot;assert_matches&quot;,
  &quot;bytes&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;modular-bitfield&quot;,
  &quot;proptest&quot;,
  &quot;proptest-arbitrary-interop&quot;,
<span class="term-fg36">@@ -8753,10 +8915,11 @@</span>  &quot;reth-execution-errors&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-prune-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-storage-api&quot;,
  &quot;reth-storage-errors&quot;,
  &quot;reth-trie&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -8783,7 +8946,7 @@</span>  &quot;alloy-serde&quot;,
  &quot;alloy-signer&quot;,
  &quot;alloy-signer-local&quot;,
  &quot;async-trait&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;futures&quot;,
  &quot;http&quot;,
  &quot;http-body&quot;,
<span class="term-fg36">@@ -8815,11 +8978,11 @@</span>  &quot;reth-rpc-eth-api&quot;,
  &quot;reth-rpc-eth-types&quot;,
  &quot;reth-rpc-server-types&quot;,
  &quot;reth-rpc-types-compat&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-tasks&quot;,
  &quot;reth-testing-utils&quot;,
  &quot;reth-transaction-pool&quot;,
<span class="term-fg31">- &quot;reth-trie&quot;,</span>
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;revm-inspectors&quot;,
  &quot;revm-primitives&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -8996,10 +9159,11 @@</span>  &quot;reth-revm&quot;,
  &quot;reth-rpc-eth-types&quot;,
  &quot;reth-rpc-server-types&quot;,
  &quot;reth-rpc-types-compat&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-tasks&quot;,
  &quot;reth-transaction-pool&quot;,
<span class="term-fg31">- &quot;reth-trie&quot;,</span>
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;revm-inspectors&quot;,
  &quot;revm-primitives&quot;,
  &quot;tokio&quot;,
<span class="term-fg36">@@ -9015,7 +9179,7 @@</span>  &quot;alloy-eips&quot;,
  &quot;alloy-primitives&quot;,
  &quot;alloy-rpc-types-eth&quot;,
  &quot;alloy-sol-types&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;futures&quot;,
  &quot;itertools 0.13.0&quot;,
  &quot;jsonrpsee-core&quot;,
<span class="term-fg36">@@ -9033,11 +9197,11 @@</span>  &quot;reth-primitives-traits&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc-server-types&quot;,
  &quot;reth-rpc-types-compat&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-storage-api&quot;,
  &quot;reth-tasks&quot;,
  &quot;reth-transaction-pool&quot;,
  &quot;reth-trie&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;revm-inspectors&quot;,
  &quot;revm-primitives&quot;,
  &quot;schnellru&quot;,
<span class="term-fg36">@@ -9078,7 +9242,7 @@</span>  &quot;jsonrpsee-types&quot;,
  &quot;reth-errors&quot;,
  &quot;reth-network-api&quot;,
  &quot;serde&quot;,
<span class="term-fg31">- &quot;strum&quot;,</span>
<span class="term-fg32">+ &quot;strum 0.26.3&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -9100,6 +9264,219 @@</span>  &quot;serde_json&quot;,
 ]
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;reth-scroll-chainspec&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;alloy-chains&quot;,</span>
<span class="term-fg32">+ &quot;alloy-consensus&quot;,</span>
<span class="term-fg32">+ &quot;alloy-eips&quot;,</span>
<span class="term-fg32">+ &quot;alloy-genesis&quot;,</span>
<span class="term-fg32">+ &quot;alloy-primitives&quot;,</span>
<span class="term-fg32">+ &quot;alloy-serde&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
<span class="term-fg32">+ &quot;once_cell&quot;,</span>
<span class="term-fg32">+ &quot;reth-chainspec&quot;,</span>
<span class="term-fg32">+ &quot;reth-ethereum-forks&quot;,</span>
<span class="term-fg32">+ &quot;reth-network-peers&quot;,</span>
<span class="term-fg32">+ &quot;reth-primitives-traits&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-forks&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-state-commitment&quot;,</span>
<span class="term-fg32">+ &quot;serde&quot;,</span>
<span class="term-fg32">+ &quot;serde_json&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-cli&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;clap&quot;,</span>
<span class="term-fg32">+ &quot;eyre&quot;,</span>
<span class="term-fg32">+ &quot;reth-cli&quot;,</span>
<span class="term-fg32">+ &quot;reth-cli-commands&quot;,</span>
<span class="term-fg32">+ &quot;reth-cli-runner&quot;,</span>
<span class="term-fg32">+ &quot;reth-db&quot;,</span>
<span class="term-fg32">+ &quot;reth-node-builder&quot;,</span>
<span class="term-fg32">+ &quot;reth-node-core&quot;,</span>
<span class="term-fg32">+ &quot;reth-node-metrics&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-chainspec&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-evm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-node&quot;,</span>
<span class="term-fg32">+ &quot;reth-tracing&quot;,</span>
<span class="term-fg32">+ &quot;tracing&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-consensus&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;eyre&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-evm&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;alloy-consensus&quot;,</span>
<span class="term-fg32">+ &quot;alloy-eips&quot;,</span>
<span class="term-fg32">+ &quot;auto_impl&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
<span class="term-fg32">+ &quot;eyre&quot;,</span>
<span class="term-fg32">+ &quot;reth-chainspec&quot;,</span>
<span class="term-fg32">+ &quot;reth-consensus&quot;,</span>
<span class="term-fg32">+ &quot;reth-ethereum-consensus&quot;,</span>
<span class="term-fg32">+ &quot;reth-evm&quot;,</span>
<span class="term-fg32">+ &quot;reth-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-primitives-traits&quot;,</span>
<span class="term-fg32">+ &quot;reth-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-chainspec&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-consensus&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-forks&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;thiserror 1.0.69&quot;,</span>
<span class="term-fg32">+ &quot;tracing&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-execution&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;reth-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-forks&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;alloy-chains&quot;,</span>
<span class="term-fg32">+ &quot;alloy-primitives&quot;,</span>
<span class="term-fg32">+ &quot;once_cell&quot;,</span>
<span class="term-fg32">+ &quot;reth-ethereum-forks&quot;,</span>
<span class="term-fg32">+ &quot;serde&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-node&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;alloy-primitives&quot;,</span>
<span class="term-fg32">+ &quot;alloy-rpc-types-engine&quot;,</span>
<span class="term-fg32">+ &quot;eyre&quot;,</span>
<span class="term-fg32">+ &quot;reth-consensus&quot;,</span>
<span class="term-fg32">+ &quot;reth-db&quot;,</span>
<span class="term-fg32">+ &quot;reth-ethereum-engine-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-ethereum-forks&quot;,</span>
<span class="term-fg32">+ &quot;reth-evm&quot;,</span>
<span class="term-fg32">+ &quot;reth-network&quot;,</span>
<span class="term-fg32">+ &quot;reth-node-builder&quot;,</span>
<span class="term-fg32">+ &quot;reth-node-types&quot;,</span>
<span class="term-fg32">+ &quot;reth-payload-builder&quot;,</span>
<span class="term-fg32">+ &quot;reth-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-provider&quot;,</span>
<span class="term-fg32">+ &quot;reth-rpc&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-chainspec&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-evm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-state-commitment&quot;,</span>
<span class="term-fg32">+ &quot;reth-tracing&quot;,</span>
<span class="term-fg32">+ &quot;reth-transaction-pool&quot;,</span>
<span class="term-fg32">+ &quot;tokio&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-primitives&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;alloy-consensus&quot;,</span>
<span class="term-fg32">+ &quot;alloy-eips&quot;,</span>
<span class="term-fg32">+ &quot;alloy-primitives&quot;,</span>
<span class="term-fg32">+ &quot;alloy-rlp&quot;,</span>
<span class="term-fg32">+ &quot;alloy-serde&quot;,</span>
<span class="term-fg32">+ &quot;arbitrary&quot;,</span>
<span class="term-fg32">+ &quot;bincode&quot;,</span>
<span class="term-fg32">+ &quot;bytes&quot;,</span>
<span class="term-fg32">+ &quot;modular-bitfield&quot;,</span>
<span class="term-fg32">+ &quot;poseidon-bn254 0.1.0 (git+https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254?rev=526a64a)&quot;,</span>
<span class="term-fg32">+ &quot;proptest&quot;,</span>
<span class="term-fg32">+ &quot;proptest-arbitrary-interop&quot;,</span>
<span class="term-fg32">+ &quot;rand 0.8.5&quot;,</span>
<span class="term-fg32">+ &quot;reth-codecs&quot;,</span>
<span class="term-fg32">+ &quot;reth-codecs-derive&quot;,</span>
<span class="term-fg32">+ &quot;serde&quot;,</span>
<span class="term-fg32">+ &quot;test-fuzz&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-revm&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;revm&quot;,</span>
<span class="term-fg32">+ &quot;serde&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-state-commitment&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;alloy-consensus&quot;,</span>
<span class="term-fg32">+ &quot;alloy-genesis&quot;,</span>
<span class="term-fg32">+ &quot;alloy-primitives&quot;,</span>
<span class="term-fg32">+ &quot;alloy-rlp&quot;,</span>
<span class="term-fg32">+ &quot;itertools 0.13.0&quot;,</span>
<span class="term-fg32">+ &quot;metrics&quot;,</span>
<span class="term-fg32">+ &quot;poseidon-bn254 0.1.0 (git+https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254?rev=526a64a)&quot;,</span>
<span class="term-fg32">+ &quot;proptest&quot;,</span>
<span class="term-fg32">+ &quot;proptest-arbitrary-interop&quot;,</span>
<span class="term-fg32">+ &quot;reth-db&quot;,</span>
<span class="term-fg32">+ &quot;reth-db-api&quot;,</span>
<span class="term-fg32">+ &quot;reth-execution-errors&quot;,</span>
<span class="term-fg32">+ &quot;reth-metrics&quot;,</span>
<span class="term-fg32">+ &quot;reth-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-primitives-traits&quot;,</span>
<span class="term-fg32">+ &quot;reth-provider&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-state-commitment&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-trie&quot;,</span>
<span class="term-fg32">+ &quot;reth-trie&quot;,</span>
<span class="term-fg32">+ &quot;reth-trie-common&quot;,</span>
<span class="term-fg32">+ &quot;reth-trie-db&quot;,</span>
<span class="term-fg32">+ &quot;tracing&quot;,</span>
<span class="term-fg32">+ &quot;zktrie&quot;,</span>
<span class="term-fg32">+ &quot;zktrie_rust&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-storage&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;alloy-primitives&quot;,</span>
<span class="term-fg32">+ &quot;eyre&quot;,</span>
<span class="term-fg32">+ &quot;reth-codecs&quot;,</span>
<span class="term-fg32">+ &quot;reth-primitives-traits&quot;,</span>
<span class="term-fg32">+ &quot;reth-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-storage-errors&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-trie&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;alloy-primitives&quot;,</span>
<span class="term-fg32">+ &quot;alloy-trie&quot;,</span>
<span class="term-fg32">+ &quot;hex-literal&quot;,</span>
<span class="term-fg32">+ &quot;proptest-arbitrary-interop&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-trie&quot;,</span>
<span class="term-fg32">+ &quot;tracing&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;reth-stages&quot;
 version = &quot;1.1.2&quot;
 dependencies = [
<span class="term-fg36">@@ -9138,6 +9515,8 @@</span>  &quot;reth-provider&quot;,
  &quot;reth-prune&quot;,
  &quot;reth-prune-types&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-stages-api&quot;,
  &quot;reth-static-file&quot;,
  &quot;reth-storage-errors&quot;,
<span class="term-fg36">@@ -9225,9 +9604,9 @@</span> version = &quot;1.1.2&quot;
 dependencies = [
  &quot;alloy-primitives&quot;,
  &quot;clap&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;serde&quot;,
<span class="term-fg31">- &quot;strum&quot;,</span>
<span class="term-fg32">+ &quot;strum 0.26.3&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -9247,6 +9626,7 @@</span>  &quot;reth-execution-types&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-prune-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-stages-types&quot;,
  &quot;reth-storage-errors&quot;,
  &quot;reth-trie&quot;,
<span class="term-fg36">@@ -9260,7 +9640,7 @@</span> dependencies = [
  &quot;alloy-eips&quot;,
  &quot;alloy-primitives&quot;,
  &quot;alloy-rlp&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;reth-fs-util&quot;,
  &quot;reth-primitives&quot;,
 ]
<span class="term-fg36">@@ -9350,11 +9730,11 @@</span>  &quot;reth-payload-util&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-provider&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-storage-api&quot;,
  &quot;reth-tasks&quot;,
  &quot;reth-tracing&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
<span class="term-fg31">- &quot;rustc-hash 2.0.0&quot;,</span>
<span class="term-fg32">+ &quot;rustc-hash 2.1.0&quot;,</span>
  &quot;schnellru&quot;,
  &quot;serde&quot;,
  &quot;serde_json&quot;,
<span class="term-fg36">@@ -9384,10 +9764,11 @@</span>  &quot;rayon&quot;,
  &quot;reth-execution-errors&quot;,
  &quot;reth-metrics&quot;,
  &quot;reth-primitives&quot;,
<span class="term-fg32">+ &quot;reth-primitives-traits&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-stages-types&quot;,
  &quot;reth-storage-errors&quot;,
  &quot;reth-trie-common&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde_json&quot;,
  &quot;tracing&quot;,
  &quot;triehash&quot;,
<span class="term-fg36">@@ -9406,7 +9787,7 @@</span>  &quot;arbitrary&quot;,
  &quot;bincode&quot;,
  &quot;bytes&quot;,
  &quot;criterion&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;hash-db&quot;,
  &quot;itertools 0.13.0&quot;,
  &quot;nybbles&quot;,
<span class="term-fg36">@@ -9415,10 +9796,12 @@</span>  &quot;proptest&quot;,
  &quot;proptest-arbitrary-interop&quot;,
  &quot;reth-codecs&quot;,
  &quot;reth-primitives-traits&quot;,
<span class="term-fg31">- &quot;revm-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_json&quot;,
  &quot;serde_with&quot;,
<span class="term-fg32">+ &quot;smallvec&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -9428,7 +9811,7 @@</span> dependencies = [
  &quot;alloy-consensus&quot;,
  &quot;alloy-primitives&quot;,
  &quot;alloy-rlp&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;metrics&quot;,
  &quot;proptest&quot;,
  &quot;proptest-arbitrary-interop&quot;,
<span class="term-fg36">@@ -9439,10 +9822,11 @@</span>  &quot;reth-execution-errors&quot;,
  &quot;reth-metrics&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-storage-errors&quot;,
  &quot;reth-trie&quot;,
  &quot;reth-trie-common&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_json&quot;,
  &quot;similar-asserts&quot;,
<span class="term-fg36">@@ -9457,7 +9841,7 @@</span> dependencies = [
  &quot;alloy-primitives&quot;,
  &quot;alloy-rlp&quot;,
  &quot;criterion&quot;,
<span class="term-fg31">- &quot;derive_more 1.0.0&quot;,</span>
<span class="term-fg32">+ &quot;derive_more&quot;,</span>
  &quot;itertools 0.13.0&quot;,
  &quot;metrics&quot;,
  &quot;proptest&quot;,
<span class="term-fg36">@@ -9503,8 +9887,7 @@</span>
 [[package]]
 name = &quot;revm&quot;
 version = &quot;18.0.0&quot;
<span class="term-fg31">-source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg31">-checksum = &quot;15689a3c6a8d14b647b4666f2e236ef47b5a5133cdfd423f545947986fff7013&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;revm.git?branch=scroll-evm-executor&#47;reth&#47;v50#a740f3d8086395c00fa77fad5474bc4fde5b195d&quot;</span>
 dependencies = [
  &quot;auto_impl&quot;,
  &quot;cfg-if&quot;,
<span class="term-fg36">@@ -9537,9 +9920,9 @@</span>
 [[package]]
 name = &quot;revm-interpreter&quot;
 version = &quot;14.0.0&quot;
<span class="term-fg31">-source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg31">-checksum = &quot;74e3f11d0fed049a4a10f79820c59113a79b38aed4ebec786a79d5c667bfeb51&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;revm.git?branch=scroll-evm-executor&#47;reth&#47;v50#a740f3d8086395c00fa77fad5474bc4fde5b195d&quot;</span>
 dependencies = [
<span class="term-fg32">+ &quot;cfg-if&quot;,</span>
  &quot;revm-primitives&quot;,
  &quot;serde&quot;,
 ]
<span class="term-fg36">@@ -9547,8 +9930,7 @@</span>
 [[package]]
 name = &quot;revm-precompile&quot;
 version = &quot;15.0.0&quot;
<span class="term-fg31">-source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg31">-checksum = &quot;e381060af24b750069a2b2d2c54bba273d84e8f5f9e8026fc9262298e26cc336&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;revm.git?branch=scroll-evm-executor&#47;reth&#47;v50#a740f3d8086395c00fa77fad5474bc4fde5b195d&quot;</span>
 dependencies = [
  &quot;aurora-engine-modexp&quot;,
  &quot;blst&quot;,
<span class="term-fg36">@@ -9567,8 +9949,7 @@</span>
 [[package]]
 name = &quot;revm-primitives&quot;
 version = &quot;14.0.0&quot;
<span class="term-fg31">-source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg31">-checksum = &quot;3702f132bb484f4f0d0ca4f6fbde3c82cfd745041abbedd6eda67730e1868ef0&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;revm.git?branch=scroll-evm-executor&#47;reth&#47;v50#a740f3d8086395c00fa77fad5474bc4fde5b195d&quot;</span>
 dependencies = [
  &quot;alloy-eip2930&quot;,
  &quot;alloy-eip7702&quot;,
<span class="term-fg36">@@ -9581,6 +9962,7 @@</span>  &quot;cfg-if&quot;,
  &quot;dyn-clone&quot;,
  &quot;enumn&quot;,
  &quot;hex&quot;,
<span class="term-fg32">+ &quot;poseidon-bn254 0.1.0 (git+https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254?branch=master)&quot;,</span>
  &quot;serde&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -9676,9 +10058,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;roaring&quot;
<span class="term-fg31">-version = &quot;0.10.6&quot;</span>
<span class="term-fg32">+version = &quot;0.10.7&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;8f4b84ba6e838ceb47b41de5194a60244fac43d9fe03b71dbe8c5a201081d6d1&quot;</span>
<span class="term-fg32">+checksum = &quot;f81dc953b2244ddd5e7860cb0bb2a790494b898ef321d4aff8e260efab60cc88&quot;</span>
 dependencies = [
  &quot;bytemuck&quot;,
  &quot;byteorder&quot;,
<span class="term-fg36">@@ -9726,7 +10108,7 @@</span>  &quot;quote&quot;,
  &quot;regex&quot;,
  &quot;relative-path&quot;,
  &quot;rustc_version 0.4.1&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
  &quot;unicode-ident&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -9775,9 +10157,9 @@</span> checksum = &quot;08d43f7aa6b08d49f382cde6a7982047c3426db949b1424bc4b7ec9ae12c6ce2&quot;
&nbsp;
 [[package]]
 name = &quot;rustc-hash&quot;
<span class="term-fg31">-version = &quot;2.0.0&quot;</span>
<span class="term-fg32">+version = &quot;2.1.0&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;583034fd73374156e66797ed8e5b0d5690409c9226b22d87cb7f19821c05d152&quot;</span>
<span class="term-fg32">+checksum = &quot;c7fb8039b3032c191086b10f11f319a6e99e1e82889c5cc6046f515c9db1d497&quot;</span>
 dependencies = [
  &quot;rand 0.8.5&quot;,
 ]
<span class="term-fg36">@@ -9821,9 +10203,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;rustls&quot;
<span class="term-fg31">-version = &quot;0.23.18&quot;</span>
<span class="term-fg32">+version = &quot;0.23.19&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;9c9cc1d47e243d655ace55ed38201c19ae02c148ae56412ab8750e8f0166ab7f&quot;</span>
<span class="term-fg32">+checksum = &quot;934b404430bb06b3fae2cba809eb45a1ab1aecd64491213d7c3301b88393f8d1&quot;</span>
 dependencies = [
  &quot;log&quot;,
  &quot;once_cell&quot;,
<span class="term-fg36">@@ -9996,6 +10378,18 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;94143f37725109f92c262ed2cf5e59bce7498c01bcc1502d7b9afe439a4e9f49&quot;
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;scroll-reth&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;clap&quot;,</span>
<span class="term-fg32">+ &quot;reth-cli-util&quot;,</span>
<span class="term-fg32">+ &quot;reth-node-builder&quot;,</span>
<span class="term-fg32">+ &quot;reth-provider&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-cli&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-node&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;sdd&quot;
 version = &quot;3.0.4&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -10128,7 +10522,7 @@</span> checksum = &quot;ad1e866f866923f252f05c889987993144fb74e722403468a4ebd70c3cd756c0&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -10137,7 +10531,7 @@</span> version = &quot;1.0.133&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;c7fceb2473b9166b2294ef05efcb65a3db80803f0b03ef86a5fc88a2b85ee377&quot;
 dependencies = [
<span class="term-fg31">- &quot;indexmap 2.6.0&quot;,</span>
<span class="term-fg32">+ &quot;indexmap 2.7.0&quot;,</span>
  &quot;itoa&quot;,
  &quot;memchr&quot;,
  &quot;ryu&quot;,
<span class="term-fg36">@@ -10163,7 +10557,7 @@</span> checksum = &quot;6c64451ba24fc7a6a2d60fc75dd9c83c90903b19028d4eff35e88fc1e86564e9&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -10197,7 +10591,7 @@</span>  &quot;base64 0.22.1&quot;,
  &quot;chrono&quot;,
  &quot;hex&quot;,
  &quot;indexmap 1.9.3&quot;,
<span class="term-fg31">- &quot;indexmap 2.6.0&quot;,</span>
<span class="term-fg32">+ &quot;indexmap 2.7.0&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_derive&quot;,
  &quot;serde_json&quot;,
<span class="term-fg36">@@ -10214,7 +10608,7 @@</span> dependencies = [
  &quot;darling&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -10237,7 +10631,7 @@</span> checksum = &quot;5d69265a08751de7844521fd15003ae0a888e035773ba05695c5c759a6f89eef&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -10336,7 +10730,7 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;34db1a06d485c9142248b7a054f034b349b212551f3dfd19c94d45a754a217cd&quot;
 dependencies = [
  &quot;libc&quot;,
<span class="term-fg31">- &quot;mio 1.0.2&quot;,</span>
<span class="term-fg32">+ &quot;mio 1.0.3&quot;,</span>
  &quot;signal-hook&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -10431,9 +10825,9 @@</span> checksum = &quot;1b6b67fb9a61334225b5b790716f609cd58395f895b3fe8b328786812a40bc3b&quot;
&nbsp;
 [[package]]
 name = &quot;socket2&quot;
<span class="term-fg31">-version = &quot;0.5.7&quot;</span>
<span class="term-fg32">+version = &quot;0.5.8&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;ce305eb0b4296696835b71df73eb912e0f1ffd2556a501fcede6e0c50349191c&quot;</span>
<span class="term-fg32">+checksum = &quot;c970269d99b64e60ec3bd6ad27270092a5394c4e309314b18ae3fe575695fbe8&quot;</span>
 dependencies = [
  &quot;libc&quot;,
  &quot;windows-sys 0.52.0&quot;,
<span class="term-fg36">@@ -10441,9 +10835,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;soketto&quot;
<span class="term-fg31">-version = &quot;0.8.0&quot;</span>
<span class="term-fg32">+version = &quot;0.8.1&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;37468c595637c10857701c990f93a40ce0e357cedb0953d1c26c8d8027f9bb53&quot;</span>
<span class="term-fg32">+checksum = &quot;2e859df029d160cb88608f5d7df7fb4753fd20fdfb4de5644f3d8b8440841721&quot;</span>
 dependencies = [
  &quot;base64 0.22.1&quot;,
  &quot;bytes&quot;,
<span class="term-fg36">@@ -10453,6 +10847,14 @@</span>  &quot;httparse&quot;,
  &quot;log&quot;,
  &quot;rand 0.8.5&quot;,
  &quot;sha1&quot;,
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;sp1-intrinsics&quot;</span>
<span class="term-fg32">+version = &quot;0.0.0&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;sp1-intrinsics.git?branch=master#7e038e60db0b2e847f6d8f49e148ccac8c6fc394&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;cfg-if&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -10503,11 +10905,30 @@</span> checksum = &quot;7da8b5736845d9f2fcb837ea5d9e2628564b3b043a70948a3f0b778838c5fb4f&quot;
&nbsp;
 [[package]]
 name = &quot;strum&quot;
<span class="term-fg32">+version = &quot;0.24.1&quot;</span>
<span class="term-fg32">+source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg32">+checksum = &quot;063e6045c0e62079840579a7e47a355ae92f60eb74daaf156fb1e84ba164e63f&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;strum&quot;</span>
 version = &quot;0.26.3&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;8fec0f0aef304996cf250b31b5a10dee7980c85da9d759361292b8bca5a18f06&quot;
 dependencies = [
<span class="term-fg31">- &quot;strum_macros&quot;,</span>
<span class="term-fg32">+ &quot;strum_macros 0.26.4&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;strum_macros&quot;</span>
<span class="term-fg32">+version = &quot;0.24.3&quot;</span>
<span class="term-fg32">+source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg32">+checksum = &quot;1e385be0d24f186b4ce2f9982191e7101bb737312ad61c1f2f984f34bcf85d59&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;heck 0.4.1&quot;,</span>
<span class="term-fg32">+ &quot;proc-macro2&quot;,</span>
<span class="term-fg32">+ &quot;quote&quot;,</span>
<span class="term-fg32">+ &quot;rustversion&quot;,</span>
<span class="term-fg32">+ &quot;syn 1.0.109&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -10516,11 +10937,11 @@</span> version = &quot;0.26.4&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;4c6bee85a5a24955dc440386795aa378cd9cf82acd5f764469152d2270e581be&quot;
 dependencies = [
<span class="term-fg31">- &quot;heck&quot;,</span>
<span class="term-fg32">+ &quot;heck 0.5.0&quot;,</span>
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
  &quot;rustversion&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -10544,9 +10965,9 @@</span> checksum = &quot;13c2bddecc57b384dee18652358fb23172facb8a2c51ccc10d74c157bdea3292&quot;
&nbsp;
 [[package]]
 name = &quot;symbolic-common&quot;
<span class="term-fg31">-version = &quot;12.12.1&quot;</span>
<span class="term-fg32">+version = &quot;12.12.3&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;3d4d73159efebfb389d819fd479afb2dbd57dcb3e3f4b7fcfa0e675f5a46c1cb&quot;</span>
<span class="term-fg32">+checksum = &quot;e5ba5365997a4e375660bed52f5b42766475d5bc8ceb1bb13fea09c469ea0f49&quot;</span>
 dependencies = [
  &quot;debugid&quot;,
  &quot;memmap2&quot;,
<span class="term-fg36">@@ -10556,9 +10977,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;symbolic-demangle&quot;
<span class="term-fg31">-version = &quot;12.12.1&quot;</span>
<span class="term-fg32">+version = &quot;12.12.3&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;a767859f6549c665011970874c3f541838b4835d5aaaa493d3ee383918be9f10&quot;</span>
<span class="term-fg32">+checksum = &quot;beff338b2788519120f38c59ff4bb15174f52a183e547bac3d6072c2c0aa48aa&quot;</span>
 dependencies = [
  &quot;cpp_demangle&quot;,
  &quot;rustc-demangle&quot;,
<span class="term-fg36">@@ -10578,9 +10999,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;syn&quot;
<span class="term-fg31">-version = &quot;2.0.89&quot;</span>
<span class="term-fg32">+version = &quot;2.0.90&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;44d46482f1c1c87acd84dea20c1bf5ebff4c757009ed6bf19cfd36fb10e92c4e&quot;</span>
<span class="term-fg32">+checksum = &quot;919d3b74a5dd0ccd15aeb8f93e7006bd9e14c295087c9896a110f490752bcf31&quot;</span>
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg36">@@ -10589,14 +11010,14 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;syn-solidity&quot;
<span class="term-fg31">-version = &quot;0.8.12&quot;</span>
<span class="term-fg32">+version = &quot;0.8.14&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;f76fe0a3e1476bdaa0775b9aec5b869ed9520c2b2fedfe9c6df3618f8ea6290b&quot;</span>
<span class="term-fg32">+checksum = &quot;da0523f59468a2696391f2a772edc089342aacd53c3caa2ac3264e598edf119b&quot;</span>
 dependencies = [
  &quot;paste&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -10622,7 +11043,7 @@</span> checksum = &quot;c8af7666ab7b6390ab78131fb5b0fce11d6b7a6951602017c35fa82800708971&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -10637,6 +11058,12 @@</span>  &quot;memchr&quot;,
  &quot;ntapi&quot;,
  &quot;windows 0.57.0&quot;,
 ]
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;tagptr&quot;</span>
<span class="term-fg32">+version = &quot;0.2.0&quot;</span>
<span class="term-fg32">+source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg32">+checksum = &quot;7b2093cf4c8eb1e67749a6762251bc9cd836b6fc171623bd0a9d324d37af2417&quot;</span>
&nbsp;
 [[package]]
 name = &quot;tap&quot;
<span class="term-fg36">@@ -10693,13 +11120,13 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;a7e6b4c7391a38f0f026972ec2200bcfd1ec45533aa266fdae5858d011afc500&quot;
 dependencies = [
  &quot;darling&quot;,
<span class="term-fg31">- &quot;heck&quot;,</span>
<span class="term-fg32">+ &quot;heck 0.5.0&quot;,</span>
  &quot;itertools 0.13.0&quot;,
  &quot;once_cell&quot;,
  &quot;prettyplease&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -10732,11 +11159,11 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;thiserror&quot;
<span class="term-fg31">-version = &quot;2.0.3&quot;</span>
<span class="term-fg32">+version = &quot;2.0.4&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;c006c85c7651b3cf2ada4584faa36773bd07bac24acfb39f3c431b36d7e667aa&quot;</span>
<span class="term-fg32">+checksum = &quot;2f49a1853cf82743e3b7950f77e0f4d622ca36cf4317cba00c767838bac8d490&quot;</span>
 dependencies = [
<span class="term-fg31">- &quot;thiserror-impl 2.0.3&quot;,</span>
<span class="term-fg32">+ &quot;thiserror-impl 2.0.4&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -10747,18 +11174,18 @@</span> checksum = &quot;4fee6c4efc90059e10f81e6d42c60a18f76588c3d74cb83a0b242a2b6c7504c1&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
 name = &quot;thiserror-impl&quot;
<span class="term-fg31">-version = &quot;2.0.3&quot;</span>
<span class="term-fg32">+version = &quot;2.0.4&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;f077553d607adc1caf65430528a576c757a71ed73944b66ebb58ef2bbd243568&quot;</span>
<span class="term-fg32">+checksum = &quot;8381894bb3efe0c4acac3ded651301ceee58a15d47c2e34885ed1908ad667061&quot;</span>
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -10833,9 +11260,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;time&quot;
<span class="term-fg31">-version = &quot;0.3.36&quot;</span>
<span class="term-fg32">+version = &quot;0.3.37&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;5dfd88e563464686c916c7e46e623e520ddc6d79fa6641390f2e3fa86e83e885&quot;</span>
<span class="term-fg32">+checksum = &quot;35e7868883861bd0e56d9ac6efcaaca0d6d5d82a2a7ec8209ff492c07cf37b21&quot;</span>
 dependencies = [
  &quot;deranged&quot;,
  &quot;itoa&quot;,
<span class="term-fg36">@@ -10857,9 +11284,9 @@</span> checksum = &quot;ef927ca75afb808a4d64dd374f00a2adf8d0fcff8e7b184af886c3c87ec4a3f3&quot;
&nbsp;
 [[package]]
 name = &quot;time-macros&quot;
<span class="term-fg31">-version = &quot;0.2.18&quot;</span>
<span class="term-fg32">+version = &quot;0.2.19&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;3f252a68540fde3a3877aeea552b832b40ab9a69e318efd078774a01ddee1ccf&quot;</span>
<span class="term-fg32">+checksum = &quot;2834e6017e3e5e4b9834939793b282bc03b37a3336245fa820e35e233e2a85de&quot;</span>
 dependencies = [
  &quot;num-conv&quot;,
  &quot;time-core&quot;,
<span class="term-fg36">@@ -10911,14 +11338,14 @@</span> checksum = &quot;1f3ccbac311fea05f86f61904b462b55fb3df8837a366dfc601a0161d0532f20&quot;
&nbsp;
 [[package]]
 name = &quot;tokio&quot;
<span class="term-fg31">-version = &quot;1.41.1&quot;</span>
<span class="term-fg32">+version = &quot;1.42.0&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;22cfb5bee7a6a52939ca9224d6ac897bb669134078daa8735560897f69de4d33&quot;</span>
<span class="term-fg32">+checksum = &quot;5cec9b21b0450273377fc97bd4c33a8acffc8c996c987a7c5b319a0083707551&quot;</span>
 dependencies = [
  &quot;backtrace&quot;,
  &quot;bytes&quot;,
  &quot;libc&quot;,
<span class="term-fg31">- &quot;mio 1.0.2&quot;,</span>
<span class="term-fg32">+ &quot;mio 1.0.3&quot;,</span>
  &quot;parking_lot&quot;,
  &quot;pin-project-lite&quot;,
  &quot;signal-hook-registry&quot;,
<span class="term-fg36">@@ -10935,17 +11362,16 @@</span> checksum = &quot;693d596312e88961bc67d7f1f97af8a70227d9f90c31bba5806eec004978d752&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
 name = &quot;tokio-rustls&quot;
<span class="term-fg31">-version = &quot;0.26.0&quot;</span>
<span class="term-fg32">+version = &quot;0.26.1&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;0c7bc40d0e5a97695bb96e27995cd3a08538541b0a846f65bba7a359f36700d4&quot;</span>
<span class="term-fg32">+checksum = &quot;5f6d0975eaace0cf0fcadee4e4aaa5da15b5c079146f2cffb67c113be122bf37&quot;</span>
 dependencies = [
  &quot;rustls&quot;,
<span class="term-fg31">- &quot;rustls-pki-types&quot;,</span>
  &quot;tokio&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -10979,9 +11405,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;tokio-util&quot;
<span class="term-fg31">-version = &quot;0.7.12&quot;</span>
<span class="term-fg32">+version = &quot;0.7.13&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;61e7c3654c13bcd040d4a03abee2c75b1d14a37b423cf5a813ceae1cc903ec6a&quot;</span>
<span class="term-fg32">+checksum = &quot;d7fcaa8d55a2bdd6b83ace262b016eca0d79ee02818c5c1bcdf0305114081078&quot;</span>
 dependencies = [
  &quot;bytes&quot;,
  &quot;futures-core&quot;,
<span class="term-fg36">@@ -11019,7 +11445,7 @@</span> version = &quot;0.22.22&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;4ae48d6208a266e853d946088ed816055e556cc6028c5e8e2b84d9fa5dd7c7f5&quot;
 dependencies = [
<span class="term-fg31">- &quot;indexmap 2.6.0&quot;,</span>
<span class="term-fg32">+ &quot;indexmap 2.7.0&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_spanned&quot;,
  &quot;toml_datetime&quot;,
<span class="term-fg36">@@ -11106,9 +11532,9 @@</span> checksum = &quot;8df9b6e13f2d32c91b9bd719c00d1958837bc7dec474d94952798cc8e69eeec3&quot;
&nbsp;
 [[package]]
 name = &quot;tracing&quot;
<span class="term-fg31">-version = &quot;0.1.40&quot;</span>
<span class="term-fg32">+version = &quot;0.1.41&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;c3523ab5a71916ccf420eebdf5521fcef02141234bbc0b8a49f2fdc4544364ef&quot;</span>
<span class="term-fg32">+checksum = &quot;784e0ac535deb450455cbfa28a6f0df145ea1bb7ae51b821cf5e7927fdcfbdd0&quot;</span>
 dependencies = [
  &quot;log&quot;,
  &quot;pin-project-lite&quot;,
<span class="term-fg36">@@ -11130,20 +11556,20 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;tracing-attributes&quot;
<span class="term-fg31">-version = &quot;0.1.27&quot;</span>
<span class="term-fg32">+version = &quot;0.1.28&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;34704c8d6ebcbc939824180af020566b01a7c01f80641264eba0999f6c2b6be7&quot;</span>
<span class="term-fg32">+checksum = &quot;395ae124c09f9e6918a2310af6038fba074bcf474ac352496d5910dd59a2226d&quot;</span>
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
 name = &quot;tracing-core&quot;
<span class="term-fg31">-version = &quot;0.1.32&quot;</span>
<span class="term-fg32">+version = &quot;0.1.33&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;c06d3da6113f116aaee68e4d601191614c9053067f9ab7f6edbcb161237daa54&quot;</span>
<span class="term-fg32">+checksum = &quot;e672c95779cf947c5311f83787af4fa8fffd12fb27e4993211a84bdfd9610f9c&quot;</span>
 dependencies = [
  &quot;once_cell&quot;,
  &quot;valuable&quot;,
<span class="term-fg36">@@ -11161,9 +11587,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;tracing-journald&quot;
<span class="term-fg31">-version = &quot;0.3.0&quot;</span>
<span class="term-fg32">+version = &quot;0.3.1&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;ba316a74e8fc3c3896a850dba2375928a9fa171b085ecddfc7c054d39970f3fd&quot;</span>
<span class="term-fg32">+checksum = &quot;fc0b4143302cf1022dac868d521e36e8b27691f72c84b3311750d5188ebba657&quot;</span>
 dependencies = [
  &quot;libc&quot;,
  &quot;tracing-core&quot;,
<span class="term-fg36">@@ -11195,9 +11621,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;tracing-serde&quot;
<span class="term-fg31">-version = &quot;0.1.3&quot;</span>
<span class="term-fg32">+version = &quot;0.2.0&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;bc6b213177105856957181934e4920de57730fc69bf42c37ee5bb664d406d9e1&quot;</span>
<span class="term-fg32">+checksum = &quot;704b1aeb7be0d0a84fc9828cae51dab5970fee5088f83d1dd7ee6f6246fc6ff1&quot;</span>
 dependencies = [
  &quot;serde&quot;,
  &quot;tracing-core&quot;,
<span class="term-fg36">@@ -11205,9 +11631,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;tracing-subscriber&quot;
<span class="term-fg31">-version = &quot;0.3.18&quot;</span>
<span class="term-fg32">+version = &quot;0.3.19&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;ad0f048c97dbd9faa9b7df56362b8ebcaa52adb06b498c050d2f4e32f90a7a8b&quot;</span>
<span class="term-fg32">+checksum = &quot;e8189decb5ac0fa7bc8b96b7cb9b2701d60d48805aca84a238004d665fcc4008&quot;</span>
 dependencies = [
  &quot;matchers&quot;,
  &quot;nu-ansi-term&quot;,
<span class="term-fg36">@@ -11257,51 +11683,10 @@</span>  &quot;rlp&quot;,
 ]
&nbsp;
 [[package]]
<span class="term-fg31">-name = &quot;trust-dns-proto&quot;</span>
<span class="term-fg31">-version = &quot;0.23.2&quot;</span>
<span class="term-fg31">-source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg31">-checksum = &quot;3119112651c157f4488931a01e586aa459736e9d6046d3bd9105ffb69352d374&quot;</span>
<span class="term-fg31">-dependencies = [</span>
<span class="term-fg31">- &quot;async-trait&quot;,</span>
<span class="term-fg31">- &quot;cfg-if&quot;,</span>
<span class="term-fg31">- &quot;data-encoding&quot;,</span>
<span class="term-fg31">- &quot;enum-as-inner&quot;,</span>
<span class="term-fg31">- &quot;futures-channel&quot;,</span>
<span class="term-fg31">- &quot;futures-io&quot;,</span>
<span class="term-fg31">- &quot;futures-util&quot;,</span>
<span class="term-fg31">- &quot;idna 0.4.0&quot;,</span>
<span class="term-fg31">- &quot;ipnet&quot;,</span>
<span class="term-fg31">- &quot;once_cell&quot;,</span>
<span class="term-fg31">- &quot;rand 0.8.5&quot;,</span>
<span class="term-fg31">- &quot;smallvec&quot;,</span>
<span class="term-fg31">- &quot;thiserror 1.0.69&quot;,</span>
<span class="term-fg31">- &quot;tinyvec&quot;,</span>
<span class="term-fg31">- &quot;tokio&quot;,</span>
<span class="term-fg31">- &quot;tracing&quot;,</span>
<span class="term-fg31">- &quot;url&quot;,</span>
<span class="term-fg31">-]</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-[[package]]</span>
<span class="term-fg31">-name = &quot;trust-dns-resolver&quot;</span>
<span class="term-fg31">-version = &quot;0.23.2&quot;</span>
<span class="term-fg32">+name = &quot;triomphe&quot;</span>
<span class="term-fg32">+version = &quot;0.1.11&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;10a3e6c3aff1718b3c73e395d1f35202ba2ffa847c6a62eea0db8fb4cfe30be6&quot;</span>
<span class="term-fg31">-dependencies = [</span>
<span class="term-fg31">- &quot;cfg-if&quot;,</span>
<span class="term-fg31">- &quot;futures-util&quot;,</span>
<span class="term-fg31">- &quot;ipconfig&quot;,</span>
<span class="term-fg31">- &quot;lru-cache&quot;,</span>
<span class="term-fg31">- &quot;once_cell&quot;,</span>
<span class="term-fg31">- &quot;parking_lot&quot;,</span>
<span class="term-fg31">- &quot;rand 0.8.5&quot;,</span>
<span class="term-fg31">- &quot;resolv-conf&quot;,</span>
<span class="term-fg31">- &quot;serde&quot;,</span>
<span class="term-fg31">- &quot;smallvec&quot;,</span>
<span class="term-fg31">- &quot;thiserror 1.0.69&quot;,</span>
<span class="term-fg31">- &quot;tokio&quot;,</span>
<span class="term-fg31">- &quot;tracing&quot;,</span>
<span class="term-fg31">- &quot;trust-dns-proto&quot;,</span>
<span class="term-fg31">-]</span>
<span class="term-fg32">+checksum = &quot;859eb650cfee7434994602c3a68b25d77ad9e68c8a6cd491616ef86661382eb3&quot;</span>
&nbsp;
 [[package]]
 name = &quot;try-lock&quot;
<span class="term-fg36">@@ -11378,27 +11763,12 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;7e51b68083f157f853b6379db119d1c1be0e6e4dec98101079dec41f6f5cf6df&quot;
&nbsp;
 [[package]]
<span class="term-fg31">-name = &quot;unicode-bidi&quot;</span>
<span class="term-fg31">-version = &quot;0.3.17&quot;</span>
<span class="term-fg31">-source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg31">-checksum = &quot;5ab17db44d7388991a428b2ee655ce0c212e862eff1768a455c58f9aad6e7893&quot;</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-[[package]]</span>
 name = &quot;unicode-ident&quot;
 version = &quot;1.0.14&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;adb9e6ca4f869e1180728b7950e35922a7fc6397f7b641499e8f3ef06e50dc83&quot;
&nbsp;
 [[package]]
<span class="term-fg31">-name = &quot;unicode-normalization&quot;</span>
<span class="term-fg31">-version = &quot;0.1.24&quot;</span>
<span class="term-fg31">-source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;</span>
<span class="term-fg31">-checksum = &quot;5033c97c4262335cded6d6fc3e5c18ab755e1a3dc96376350f3d8e9f009ad956&quot;</span>
<span class="term-fg31">-dependencies = [</span>
<span class="term-fg31">- &quot;tinyvec&quot;,</span>
<span class="term-fg31">-]</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-[[package]]</span>
 name = &quot;unicode-segmentation&quot;
 version = &quot;1.12.0&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -11462,7 +11832,7 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;32f8b686cadd1473f4bd0117a5d28d36b1ade384ea9b5069a1c40aefed7fda60&quot;
 dependencies = [
  &quot;form_urlencoded&quot;,
<span class="term-fg31">- &quot;idna 1.0.3&quot;,</span>
<span class="term-fg32">+ &quot;idna&quot;,</span>
  &quot;percent-encoding&quot;,
  &quot;serde&quot;,
 ]
<span class="term-fg36">@@ -11534,7 +11904,7 @@</span> checksum = &quot;d674d135b4a8c1d7e813e2f8d1c9a58308aee4a680323066025e53132218bd91&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -11585,9 +11955,9 @@</span> checksum = &quot;9c8d87e72b64a3b4db28d11ce29237c246188f4f51057d65a7eab63b7987e423&quot;
&nbsp;
 [[package]]
 name = &quot;wasm-bindgen&quot;
<span class="term-fg31">-version = &quot;0.2.95&quot;</span>
<span class="term-fg32">+version = &quot;0.2.97&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;128d1e363af62632b8eb57219c8fd7877144af57558fb2ef0368d0087bddeb2e&quot;</span>
<span class="term-fg32">+checksum = &quot;d15e63b4482863c109d70a7b8706c1e364eb6ea449b201a76c5b89cedcec2d5c&quot;</span>
 dependencies = [
  &quot;cfg-if&quot;,
  &quot;once_cell&quot;,
<span class="term-fg36">@@ -11596,36 +11966,37 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;wasm-bindgen-backend&quot;
<span class="term-fg31">-version = &quot;0.2.95&quot;</span>
<span class="term-fg32">+version = &quot;0.2.97&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;cb6dd4d3ca0ddffd1dd1c9c04f94b868c37ff5fac97c30b97cff2d74fce3a358&quot;</span>
<span class="term-fg32">+checksum = &quot;8d36ef12e3aaca16ddd3f67922bc63e48e953f126de60bd33ccc0101ef9998cd&quot;</span>
 dependencies = [
  &quot;bumpalo&quot;,
  &quot;log&quot;,
  &quot;once_cell&quot;,
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
  &quot;wasm-bindgen-shared&quot;,
 ]
&nbsp;
 [[package]]
 name = &quot;wasm-bindgen-futures&quot;
<span class="term-fg31">-version = &quot;0.4.45&quot;</span>
<span class="term-fg32">+version = &quot;0.4.47&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;cc7ec4f8827a71586374db3e87abdb5a2bb3a15afed140221307c3ec06b1f63b&quot;</span>
<span class="term-fg32">+checksum = &quot;9dfaf8f50e5f293737ee323940c7d8b08a66a95a419223d9f41610ca08b0833d&quot;</span>
 dependencies = [
  &quot;cfg-if&quot;,
  &quot;js-sys&quot;,
<span class="term-fg32">+ &quot;once_cell&quot;,</span>
  &quot;wasm-bindgen&quot;,
  &quot;web-sys&quot;,
 ]
&nbsp;
 [[package]]
 name = &quot;wasm-bindgen-macro&quot;
<span class="term-fg31">-version = &quot;0.2.95&quot;</span>
<span class="term-fg32">+version = &quot;0.2.97&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;e79384be7f8f5a9dd5d7167216f022090cf1f9ec128e6e6a482a2cb5c5422c56&quot;</span>
<span class="term-fg32">+checksum = &quot;705440e08b42d3e4b36de7d66c944be628d579796b8090bfa3471478a2260051&quot;</span>
 dependencies = [
  &quot;quote&quot;,
  &quot;wasm-bindgen-macro-support&quot;,
<span class="term-fg36">@@ -11633,22 +12004,22 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;wasm-bindgen-macro-support&quot;
<span class="term-fg31">-version = &quot;0.2.95&quot;</span>
<span class="term-fg32">+version = &quot;0.2.97&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;26c6ab57572f7a24a4985830b120de1594465e5d500f24afe89e16b4e833ef68&quot;</span>
<span class="term-fg32">+checksum = &quot;98c9ae5a76e46f4deecd0f0255cc223cfa18dc9b261213b8aa0c7b36f61b3f1d&quot;</span>
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
  &quot;wasm-bindgen-backend&quot;,
  &quot;wasm-bindgen-shared&quot;,
 ]
&nbsp;
 [[package]]
 name = &quot;wasm-bindgen-shared&quot;
<span class="term-fg31">-version = &quot;0.2.95&quot;</span>
<span class="term-fg32">+version = &quot;0.2.97&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;65fc09f10666a9f147042251e0dda9c18f166ff7de300607007e96bdebc1068d&quot;</span>
<span class="term-fg32">+checksum = &quot;6ee99da9c5ba11bd675621338ef6fa52296b76b83305e9b6e5c77d4c286d6d49&quot;</span>
&nbsp;
 [[package]]
 name = &quot;wasm-streams&quot;
<span class="term-fg36">@@ -11679,9 +12050,9 @@</span> ]
&nbsp;
 [[package]]
 name = &quot;web-sys&quot;
<span class="term-fg31">-version = &quot;0.3.72&quot;</span>
<span class="term-fg32">+version = &quot;0.3.74&quot;</span>
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg31">-checksum = &quot;f6488b90108c040df0fe62fa815cbdee25124641df01814dd7282749234c6112&quot;</span>
<span class="term-fg32">+checksum = &quot;a98bc3c33f0fe7e59ad7cd041b89034fa82a7c2d4365ca538dda6cdaf513863c&quot;</span>
 dependencies = [
  &quot;js-sys&quot;,
  &quot;wasm-bindgen&quot;,
<span class="term-fg36">@@ -11805,7 +12176,7 @@</span> checksum = &quot;9107ddc059d5b6fbfbffdfa7a7fe3e22a226def0b2608f72e9d552763d3e1ad7&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -11816,7 +12187,7 @@</span> checksum = &quot;2bbd5b46c938e506ecbce286b6628a02171d56153ba733b6c741fc627ec9579b&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -11827,7 +12198,7 @@</span> checksum = &quot;29bee4b38ea3cde66011baa44dba677c432a78593e202392d1e9070cf2a7fca7&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -11838,7 +12209,7 @@</span> checksum = &quot;053c4c462dc91d3b1504c6fe5a726dd15e216ba718e84a0e46a88fbe5ded3515&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -12113,7 +12484,7 @@</span> checksum = &quot;2380878cad4ac9aac1e2435f3eb4020e8374b5f13c296cb75b4620ff8e229154&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
  &quot;synstructure&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -12135,7 +12506,7 @@</span> checksum = &quot;fa4f8080344d4671fb4e831a13ad1e68092748387dfc4f55e356242fae12ce3e&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -12155,7 +12526,7 @@</span> checksum = &quot;595eed982f7d355beb85837f651fa22e90b3c044842dc7f2c2842c086f295808&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
  &quot;synstructure&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -12176,7 +12547,7 @@</span> checksum = &quot;ce36e65b0d2999d2aafac989fb249189a141aee1f53c612c1f37d72631959f69&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -12198,7 +12569,31 @@</span> checksum = &quot;6eafa6dfb17584ea3e2bd6e76e0cc15ad7af12b09abdd1ca55961bed9b1063c6&quot;
 dependencies = [
  &quot;proc-macro2&quot;,
  &quot;quote&quot;,
<span class="term-fg31">- &quot;syn 2.0.89&quot;,</span>
<span class="term-fg32">+ &quot;syn 2.0.90&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;zktrie&quot;</span>
<span class="term-fg32">+version = &quot;0.3.0&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;zktrie.git?rev=309160464c1cd2b87a578ed6d9b6e98205ae4640#309160464c1cd2b87a578ed6d9b6e98205ae4640&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;gobuild&quot;,</span>
<span class="term-fg32">+ &quot;zktrie_rust&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;zktrie_rust&quot;</span>
<span class="term-fg32">+version = &quot;0.3.0&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;zktrie.git?rev=309160464c1cd2b87a578ed6d9b6e98205ae4640#309160464c1cd2b87a578ed6d9b6e98205ae4640&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;hex&quot;,</span>
<span class="term-fg32">+ &quot;lazy_static&quot;,</span>
<span class="term-fg32">+ &quot;log&quot;,</span>
<span class="term-fg32">+ &quot;num&quot;,</span>
<span class="term-fg32">+ &quot;num-derive&quot;,</span>
<span class="term-fg32">+ &quot;num-traits&quot;,</span>
<span class="term-fg32">+ &quot;strum 0.24.1&quot;,</span>
<span class="term-fg32">+ &quot;strum_macros 0.24.3&quot;,</span>
 ]
&nbsp;
 [[package]]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f35a8e02ecb6ea802c2414ed" role="button"
                       aria-expanded="false" aria-controls="id-f35a8e02ecb6ea802c2414ed">
                        <code>Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+40</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f35a8e02ecb6ea802c2414ed"><span class="term-fg1">diff --git reth&#47;Cargo.toml scroll-reth&#47;Cargo.toml</span>
<span class="term-fg1">index 113d0661f3ffc1d4204e856727083a163a32df89..6e422147c09d5304e288c8246ebe36b47d7fb274 100644</span>
<span class="term-fg1">--- reth&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;Cargo.toml</span>
<span class="term-fg36">@@ -100,6 +100,19 @@</span>     &quot;crates&#47;rpc&#47;rpc-server-types&#47;&quot;,
     &quot;crates&#47;rpc&#47;rpc-testing-util&#47;&quot;,
     &quot;crates&#47;rpc&#47;rpc-types-compat&#47;&quot;,
     &quot;crates&#47;rpc&#47;rpc&#47;&quot;,
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;bin&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;chainspec&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;cli&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;consensus&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;evm&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;execution&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;hardforks&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;node&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;primitives&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;revm&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;storage&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;state-commitment&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;trie&quot;,</span>
     &quot;crates&#47;stages&#47;api&#47;&quot;,
     &quot;crates&#47;stages&#47;stages&#47;&quot;,
     &quot;crates&#47;stages&#47;types&#47;&quot;,
<span class="term-fg36">@@ -403,6 +416,18 @@</span> reth-rpc-eth-types = { path = &quot;crates&#47;rpc&#47;rpc-eth-types&quot;, default-features = false }
 reth-rpc-layer = { path = &quot;crates&#47;rpc&#47;rpc-layer&quot; }
 reth-rpc-server-types = { path = &quot;crates&#47;rpc&#47;rpc-server-types&quot; }
 reth-rpc-types-compat = { path = &quot;crates&#47;rpc&#47;rpc-types-compat&quot; }
<span class="term-fg32">+reth-scroll-chainspec = { path = &quot;crates&#47;scroll&#47;chainspec&quot; }</span>
<span class="term-fg32">+reth-scroll-cli = { path = &quot;crates&#47;scroll&#47;cli&quot; }</span>
<span class="term-fg32">+reth-scroll-consensus = { path = &quot;crates&#47;scroll&#47;consensus&quot; }</span>
<span class="term-fg32">+reth-scroll-evm = { path = &quot;crates&#47;scroll&#47;evm&quot; }</span>
<span class="term-fg32">+reth-scroll-execution = { path = &quot;crates&#47;scroll&#47;execution&quot; }</span>
<span class="term-fg32">+reth-scroll-forks = { path = &quot;crates&#47;scroll&#47;hardforks&quot; }</span>
<span class="term-fg32">+reth-scroll-node = { path = &quot;crates&#47;scroll&#47;node&quot; }</span>
<span class="term-fg32">+reth-scroll-primitives = { path = &quot;crates&#47;scroll&#47;primitives&quot; }</span>
<span class="term-fg32">+reth-scroll-state-commitment = { path = &quot;crates&#47;scroll&#47;state-commitment&quot; }</span>
<span class="term-fg32">+reth-scroll-trie = { path = &quot;crates&#47;scroll&#47;trie&quot; }</span>
<span class="term-fg32">+reth-scroll-revm = { path = &quot;crates&#47;scroll&#47;revm&quot; }</span>
<span class="term-fg32">+reth-scroll-storage = { path = &quot;crates&#47;scroll&#47;storage&quot; }</span>
 reth-stages = { path = &quot;crates&#47;stages&#47;stages&quot; }
 reth-stages-api = { path = &quot;crates&#47;stages&#47;api&quot; }
 reth-stages-types = { path = &quot;crates&#47;stages&#47;types&quot; }
<span class="term-fg36">@@ -422,7 +447,7 @@</span> reth-trie-parallel = { path = &quot;crates&#47;trie&#47;parallel&quot; }
 reth-trie-sparse = { path = &quot;crates&#47;trie&#47;sparse&quot; }
&nbsp;
 # revm
<span class="term-fg31">-revm = { version = &quot;18.0.0&quot;, features = [&quot;std&quot;], default-features = false }</span>
<span class="term-fg32">+revm = { package = &quot;reth-scroll-revm&quot;, path = &quot;crates&#47;scroll&#47;revm&quot;, default-features = false }</span>
 revm-inspectors = &quot;0.11.0&quot;
 revm-primitives = { version = &quot;14.0.0&quot;, features = [
     &quot;std&quot;,
<span class="term-fg36">@@ -471,6 +496,10 @@</span> ], default-features = false }
 alloy-transport-ipc = { version = &quot;0.6.4&quot;, default-features = false }
 alloy-transport-ws = { version = &quot;0.6.4&quot;, default-features = false }
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+# TODO (scroll): point to crates.io&#47;tag once the crate is published&#47;a tag is created.</span>
<span class="term-fg32">+poseidon-bn254 = { git = &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254&quot;, rev = &quot;526a64a&quot;, features = [&quot;bn254&quot;] }</span>
<span class="term-fg32">+</span>
 # op
 op-alloy-rpc-types = &quot;0.6.7&quot;
 op-alloy-rpc-types-engine = &quot;0.6.7&quot;
<span class="term-fg36">@@ -598,8 +627,8 @@</span> # misc-testing
 arbitrary = &quot;1.3&quot;
 assert_matches = &quot;1.5.0&quot;
 criterion = &quot;0.5&quot;
<span class="term-fg31">-iai-callgrind = &quot;0.13&quot;</span>
<span class="term-fg31">-pprof = &quot;0.13&quot;</span>
<span class="term-fg32">+iai-callgrind = &quot;0.14&quot;</span>
<span class="term-fg32">+pprof = &quot;0.14&quot;</span>
 proptest = &quot;1.4&quot;
 proptest-derive = &quot;0.5&quot;
 serial_test = { default-features = false, version = &quot;3&quot; }
<span class="term-fg36">@@ -644,3 +673,11 @@</span> #op-alloy-consensus = { git = &quot;https:&#47;&#47;github.com&#47;alloy-rs&#47;op-alloy&quot;, rev = &quot;6a042e7681b1&quot; }
 #op-alloy-network = { git = &quot;https:&#47;&#47;github.com&#47;alloy-rs&#47;op-alloy&quot;, rev = &quot;6a042e7681b1&quot; }
 #op-alloy-rpc-types = { git = &quot;https:&#47;&#47;github.com&#47;alloy-rs&#47;op-alloy&quot;, rev = &quot;6a042e7681b1&quot; }
 #op-alloy-rpc-types-engine = { git = &quot;https:&#47;&#47;github.com&#47;alloy-rs&#47;op-alloy&quot;, rev = &quot;6a042e7681b1&quot; }
<span class="term-fg32">+</span>
<span class="term-fg32">+[patch.crates-io]</span>
<span class="term-fg32">+revm = { git = &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;revm.git&quot;, branch = &quot;scroll-evm-executor&#47;reth&#47;v50&quot; }</span>
<span class="term-fg32">+revm-primitives = { git = &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;revm.git&quot;, branch = &quot;scroll-evm-executor&#47;reth&#47;v50&quot; }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+ff = { git = &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;ff&quot;, branch = &quot;feat&#47;sp1&quot; }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+alloy-eip2930 = { git = &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;alloy-eips&quot;, branch = &quot;v0.3.2&quot; }</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-eee9caaa6dcf25f8d34e0aa1" role="button"
                       aria-expanded="false" aria-controls="id-eee9caaa6dcf25f8d34e0aa1">
                        <code>Makefile</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/Makefile" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/Makefile" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+7</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-eee9caaa6dcf25f8d34e0aa1"><span class="term-fg1">diff --git reth&#47;Makefile scroll-reth&#47;Makefile</span>
<span class="term-fg1">index b1908d7b109d57e7732800f58f93d45a798f18a4..ea68ec84f4961af0eb35b9a258b88b0e8b58dc6c 100644</span>
<span class="term-fg1">--- reth&#47;Makefile</span>
<span class="term-fg1">+++ scroll-reth&#47;Makefile</span>
<span class="term-fg36">@@ -58,6 +58,13 @@</span> 		--features &quot;optimism $(FEATURES)&quot; \
 		--profile &quot;$(PROFILE)&quot; \
 		$(CARGO_INSTALL_EXTRA_FLAGS)
&nbsp;
<span class="term-fg32">+.PHONY: install-scroll</span>
<span class="term-fg32">+install-scroll: ## Build and install the scroll-reth binary under `~&#47;.cargo&#47;bin`.</span>
<span class="term-fg32">+	cargo install --path crates&#47;scroll&#47;bin --bin scroll-reth --force --locked \</span>
<span class="term-fg32">+		--features &quot;scroll&quot; \</span>
<span class="term-fg32">+		--profile &quot;$(PROFILE)&quot; \</span>
<span class="term-fg32">+		$(CARGO_INSTALL_EXTRA_FLAGS)</span>
<span class="term-fg32">+</span>
 .PHONY: build
 build: ## Build the reth binary into `target` directory.
 	cargo build --bin reth --features &quot;$(FEATURES)&quot; --profile &quot;$(PROFILE)&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4589b1b7940d62a1277724af" role="button"
                       aria-expanded="false" aria-controls="id-4589b1b7940d62a1277724af">
                        <code>bin/reth/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/bin/reth/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/bin/reth/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4589b1b7940d62a1277724af"><span class="term-fg1">diff --git reth&#47;bin&#47;reth&#47;Cargo.toml scroll-reth&#47;bin&#47;reth&#47;Cargo.toml</span>
<span class="term-fg1">index a152bea2681efabf538b14dd39a0f5f1e809b640..f0944bbbc4a1a56169e491e1e766332dc89deb2c 100644</span>
<span class="term-fg1">--- reth&#47;bin&#47;reth&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;bin&#47;reth&#47;Cargo.toml</span>
<span class="term-fg36">@@ -54,8 +54,6 @@</span> reth-payload-primitives.workspace = true
 reth-payload-validator.workspace = true
 reth-basic-payload-builder.workspace = true
 reth-static-file.workspace = true
<span class="term-fg31">-reth-trie = { workspace = true, features = [&quot;metrics&quot;] }</span>
<span class="term-fg31">-reth-trie-db = { workspace = true, features = [&quot;metrics&quot;] }</span>
 reth-node-api.workspace = true
 reth-node-core.workspace = true
 reth-ethereum-payload-builder.workspace = true
<span class="term-fg36">@@ -120,6 +118,7 @@</span> 	&quot;reth-cli-util&#47;jemalloc&quot;,
 	&quot;reth-cli-util&#47;jemalloc-prof&quot;
 ]
 tracy-allocator = [&quot;reth-cli-util&#47;tracy-allocator&quot;]
<span class="term-fg32">+scroll = []</span>
&nbsp;
 min-error-logs = [&quot;tracing&#47;release_max_level_error&quot;]
 min-warn-logs = [&quot;tracing&#47;release_max_level_warn&quot;]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c651d313e7d4cfab06ad5e47" role="button"
                       aria-expanded="false" aria-controls="id-c651d313e7d4cfab06ad5e47">
                        <code>bin/reth/src/commands/debug_cmd/build_block.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/bin/reth/src/commands/debug_cmd/build_block.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/bin/reth/src/commands/debug_cmd/build_block.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-8</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c651d313e7d4cfab06ad5e47"><span class="term-fg1">diff --git reth&#47;bin&#47;reth&#47;src&#47;commands&#47;debug_cmd&#47;build_block.rs scroll-reth&#47;bin&#47;reth&#47;src&#47;commands&#47;debug_cmd&#47;build_block.rs</span>
<span class="term-fg1">index dc00e07d8830d168cb02c3c7c34681d0ca8ac5a5..43de00b693fd7df99d44464e839460dfe7c675c7 100644</span>
<span class="term-fg1">--- reth&#47;bin&#47;reth&#47;src&#47;commands&#47;debug_cmd&#47;build_block.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;bin&#47;reth&#47;src&#47;commands&#47;debug_cmd&#47;build_block.rs</span>
<span class="term-fg36">@@ -43,8 +43,6 @@</span> use reth_transaction_pool::{
     blobstore::InMemoryBlobStore, BlobStore, EthPooledTransaction, PoolConfig, TransactionOrigin,
     TransactionPool, TransactionValidationTaskExecutor,
 };
<span class="term-fg31">-use reth_trie::StateRoot;</span>
<span class="term-fg31">-use reth_trie_db::DatabaseStateRoot;</span>
 use std::{path::PathBuf, str::FromStr, sync::Arc};
 use tracing::*;
&nbsp;
<span class="term-fg36">@@ -261,7 +259,8 @@</span>                 let senders = block.senders().expect(&quot;sender recovery failed&quot;);
                 let block_with_senders =
                     SealedBlockWithSenders::&lt;BlockTy&lt;N&gt;&gt;::new(block.clone(), senders).unwrap();
&nbsp;
<span class="term-fg31">-                let db = StateProviderDatabase::new(blockchain_db.latest()?);</span>
<span class="term-fg32">+                let state_provider = blockchain_db.latest()?;</span>
<span class="term-fg32">+                let db = StateProviderDatabase::new(&amp;state_provider);</span>
                 let executor =
                     EthExecutorProvider::ethereum(provider_factory.chain_spec()).executor(db);
&nbsp;
<span class="term-fg36">@@ -271,11 +270,9 @@</span>                 let execution_outcome =
                     ExecutionOutcome::from((block_execution_output, block.number));
                 debug!(target: &quot;reth::cli&quot;, ?execution_outcome, &quot;Executed block&quot;);
&nbsp;
<span class="term-fg31">-                let hashed_post_state = execution_outcome.hash_state_slow();</span>
<span class="term-fg31">-                let (state_root, trie_updates) = StateRoot::overlay_root_with_updates(</span>
<span class="term-fg31">-                    provider_factory.provider()?.tx_ref(),</span>
<span class="term-fg31">-                    hashed_post_state.clone(),</span>
<span class="term-fg31">-                )?;</span>
<span class="term-fg32">+                let hashed_post_state = state_provider.hashed_post_state(execution_outcome.state());</span>
<span class="term-fg32">+                let (state_root, trie_updates) =</span>
<span class="term-fg32">+                    state_provider.state_root_from_state_with_updates(hashed_post_state.clone())?;</span>
&nbsp;
                 if state_root != block_with_senders.state_root {
                     eyre::bail!(</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-40dec1e7029bd89d740bf376" role="button"
                       aria-expanded="false" aria-controls="id-40dec1e7029bd89d740bf376">
                        <code>bin/reth/src/commands/debug_cmd/in_memory_merkle.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/bin/reth/src/commands/debug_cmd/in_memory_merkle.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/bin/reth/src/commands/debug_cmd/in_memory_merkle.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-13</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-40dec1e7029bd89d740bf376"><span class="term-fg1">diff --git reth&#47;bin&#47;reth&#47;src&#47;commands&#47;debug_cmd&#47;in_memory_merkle.rs scroll-reth&#47;bin&#47;reth&#47;src&#47;commands&#47;debug_cmd&#47;in_memory_merkle.rs</span>
<span class="term-fg1">index 870dc1ddf2335d2112f58a35d7fa9885556b50a4..9b07549bd76d643513b953843d6f017ab5adddc2 100644</span>
<span class="term-fg1">--- reth&#47;bin&#47;reth&#47;src&#47;commands&#47;debug_cmd&#47;in_memory_merkle.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;bin&#47;reth&#47;src&#47;commands&#47;debug_cmd&#47;in_memory_merkle.rs</span>
<span class="term-fg36">@@ -24,14 +24,13 @@</span> use reth_node_ethereum::EthExecutorProvider;
 use reth_primitives::BlockExt;
 use reth_provider::{
     providers::ProviderNodeTypes, AccountExtReader, ChainSpecProvider, DatabaseProviderFactory,
<span class="term-fg31">-    HashingWriter, HeaderProvider, LatestStateProviderRef, OriginalValuesKnown, ProviderFactory,</span>
<span class="term-fg31">-    StageCheckpointReader, StateWriter, StorageLocation, StorageReader,</span>
<span class="term-fg32">+    HashedPostStateProvider, HashingWriter, HeaderProvider, LatestStateProviderRef,</span>
<span class="term-fg32">+    OriginalValuesKnown, ProviderFactory, StageCheckpointReader, StateRootProvider,</span>
<span class="term-fg32">+    StateRootProviderExt, StateWriter, StorageLocation, StorageReader,</span>
 };
 use reth_revm::database::StateProviderDatabase;
 use reth_stages::StageId;
 use reth_tasks::TaskExecutor;
<span class="term-fg31">-use reth_trie::StateRoot;</span>
<span class="term-fg31">-use reth_trie_db::DatabaseStateRoot;</span>
 use std::{path::PathBuf, sync::Arc};
 use tracing::*;
&nbsp;
<span class="term-fg36">@@ -142,7 +141,8 @@</span>                 |err, _| warn!(target: &quot;reth::cli&quot;, &quot;Error requesting body: {err}. Retrying...&quot;),
             )
             .await?;
&nbsp;
<span class="term-fg31">-        let db = StateProviderDatabase::new(LatestStateProviderRef::new(&amp;provider));</span>
<span class="term-fg32">+        let state_provider = LatestStateProviderRef::new(&amp;provider);</span>
<span class="term-fg32">+        let db = StateProviderDatabase::new(&amp;state_provider);</span>
&nbsp;
         let executor = EthExecutorProvider::ethereum(provider_factory.chain_spec()).executor(db);
&nbsp;
<span class="term-fg36">@@ -162,10 +162,10 @@</span>         )?;
         let execution_outcome = ExecutionOutcome::from((block_execution_output, block.number));
&nbsp;
         &#47;&#47; Unpacked `BundleState::state_root_slow` function
<span class="term-fg31">-        let (in_memory_state_root, in_memory_updates) = StateRoot::overlay_root_with_updates(</span>
<span class="term-fg31">-            provider.tx_ref(),</span>
<span class="term-fg31">-            execution_outcome.hash_state_slow(),</span>
<span class="term-fg31">-        )?;</span>
<span class="term-fg32">+        let (in_memory_state_root, in_memory_updates) = state_provider</span>
<span class="term-fg32">+            .state_root_from_state_with_updates(</span>
<span class="term-fg32">+                state_provider.hashed_post_state(execution_outcome.state()),</span>
<span class="term-fg32">+            )?;</span>
&nbsp;
         if in_memory_state_root == block.state_root {
             info!(target: &quot;reth::cli&quot;, state_root = ?in_memory_state_root, &quot;Computed in-memory state root matches&quot;);
<span class="term-fg36">@@ -193,10 +193,8 @@</span>         let account_lists = provider_rw.changed_accounts_with_range(block.number..=block.number)?;
         let accounts = provider_rw.basic_accounts(account_lists)?;
         provider_rw.insert_account_for_hashing(accounts)?;
&nbsp;
<span class="term-fg31">-        let (state_root, incremental_trie_updates) = StateRoot::incremental_root_with_updates(</span>
<span class="term-fg31">-            provider_rw.tx_ref(),</span>
<span class="term-fg31">-            block.number..=block.number,</span>
<span class="term-fg31">-        )?;</span>
<span class="term-fg32">+        let (state_root, incremental_trie_updates) =</span>
<span class="term-fg32">+            state_provider.incremental_state_root_with_updates(block.number..=block.number)?;</span>
         if state_root != block.state_root {
             eyre::bail!(
                 &quot;Computed incremental state root mismatch. Expected: {:?}. Got: {:?}&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e7d7bf4ee63717a01ea7d75f" role="button"
                       aria-expanded="false" aria-controls="id-e7d7bf4ee63717a01ea7d75f">
                        <code>bin/reth/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/bin/reth/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/bin/reth/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e7d7bf4ee63717a01ea7d75f"><span class="term-fg1">diff --git reth&#47;bin&#47;reth&#47;src&#47;lib.rs scroll-reth&#47;bin&#47;reth&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 53c592063eca67b13f1aed5f89672ecb1a4d08ef..dba3ff77c8fa2cd32156c59aef7cd29c58126410 100644</span>
<span class="term-fg1">--- reth&#47;bin&#47;reth&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;bin&#47;reth&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -26,6 +26,9 @@</span>     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 pub mod cli;
 pub mod commands;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0fa318827dd0e417005ae37f" role="button"
                       aria-expanded="false" aria-controls="id-0fa318827dd0e417005ae37f">
                        <code>bin/reth/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/bin/reth/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/bin/reth/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0fa318827dd0e417005ae37f"><span class="term-fg1">diff --git reth&#47;bin&#47;reth&#47;src&#47;main.rs scroll-reth&#47;bin&#47;reth&#47;src&#47;main.rs</span>
<span class="term-fg1">index e146912c06f995da5e3f934c62f0fdfceeb388c3..19053b8a20733f0d0215cb36e0e177718b0bc3b2 100644</span>
<span class="term-fg1">--- reth&#47;bin&#47;reth&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;bin&#47;reth&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,4 +1,7 @@</span>
 #![allow(missing_docs)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 #[global_allocator]
 static ALLOC: reth_cli_util::allocator::Allocator = reth_cli_util::allocator::new_allocator();</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8f2f3ac67b6d600a2075dc50" role="button"
                       aria-expanded="false" aria-controls="id-8f2f3ac67b6d600a2075dc50">
                        <code>crates/blockchain-tree/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/blockchain-tree/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/blockchain-tree/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+22</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8f2f3ac67b6d600a2075dc50"><span class="term-fg1">diff --git reth&#47;crates&#47;blockchain-tree&#47;Cargo.toml scroll-reth&#47;crates&#47;blockchain-tree&#47;Cargo.toml</span>
<span class="term-fg1">index 3fa6de2b402c26393d8d7f9ab9c4e4584f1eaf74..099add248009415f95072b87e612c89c5bd71eb0 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;blockchain-tree&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;blockchain-tree&#47;Cargo.toml</span>
<span class="term-fg36">@@ -24,7 +24,6 @@</span> reth-provider.workspace = true
 reth-execution-types.workspace = true
 reth-stages-api.workspace = true
 reth-trie = { workspace = true, features = [&quot;metrics&quot;] }
<span class="term-fg31">-reth-trie-db = { workspace = true, features = [&quot;metrics&quot;] }</span>
 reth-trie-parallel.workspace = true
 reth-network.workspace = true
 reth-consensus.workspace = true
<span class="term-fg36">@@ -33,6 +32,9 @@</span>
 # ethereum
 alloy-primitives.workspace = true
 alloy-eips.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
&nbsp;
 # common
 parking_lot.workspace = true
<span class="term-fg36">@@ -55,6 +57,7 @@</span> reth-provider = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-evm = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-consensus = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-testing-utils.workspace = true
<span class="term-fg32">+reth-trie-db = { workspace = true, features = [&quot;test-utils&quot;] }</span>
 reth-revm.workspace = true
 reth-evm-ethereum.workspace = true
 reth-execution-types.workspace = true
<span class="term-fg36">@@ -62,6 +65,7 @@</span> parking_lot.workspace = true
 assert_matches.workspace = true
 alloy-genesis.workspace = true
 alloy-consensus.workspace = true
<span class="term-fg32">+revm.workspace = true</span>
&nbsp;
 [features]
 test-utils = [
<span class="term-fg36">@@ -76,12 +80,27 @@</span> 	&quot;reth-db&#47;test-utils&quot;,
 	&quot;reth-db-api&#47;test-utils&quot;,
 	&quot;reth-provider&#47;test-utils&quot;,
 	&quot;reth-trie-db&#47;test-utils&quot;,
<span class="term-fg31">-	&quot;reth-trie&#47;test-utils&quot;</span>
<span class="term-fg32">+	&quot;reth-trie&#47;test-utils&quot;,</span>
<span class="term-fg32">+	&quot;revm&#47;test-utils&quot;</span>
 ]
 optimism = [
 	&quot;reth-primitives&#47;optimism&quot;,
 	&quot;reth-provider&#47;optimism&quot;,
 	&quot;reth-execution-types&#47;optimism&quot;,
 	&quot;reth-db&#47;optimism&quot;,
<span class="term-fg31">-	&quot;reth-db-api&#47;optimism&quot;</span>
<span class="term-fg32">+	&quot;reth-db-api&#47;optimism&quot;,</span>
<span class="term-fg32">+	&quot;revm&#47;optimism&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-trie-db&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-testing-utils&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-storage&#47;scroll&quot;</span>
 ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-71df69b8c5a6200d59447f7c" role="button"
                       aria-expanded="false" aria-controls="id-71df69b8c5a6200d59447f7c">
                        <code>crates/blockchain-tree/src/blockchain_tree.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/blockchain-tree/src/blockchain_tree.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/blockchain-tree/src/blockchain_tree.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+18</span></div>
                            <div class="text-start"><span class="text-danger">-20</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-71df69b8c5a6200d59447f7c"><span class="term-fg1">diff --git reth&#47;crates&#47;blockchain-tree&#47;src&#47;blockchain_tree.rs scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;blockchain_tree.rs</span>
<span class="term-fg1">index bbf1cb099617ad86be56b421cc133b9f288117eb..83ac21ba434cc8f3f293a42321951b324760dea3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;blockchain-tree&#47;src&#47;blockchain_tree.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;blockchain_tree.rs</span>
<span class="term-fg36">@@ -24,13 +24,12 @@</span> };
 use reth_provider::{
     BlockExecutionWriter, BlockNumReader, BlockWriter, CanonStateNotification,
     CanonStateNotificationSender, CanonStateNotifications, ChainSpecProvider, ChainSplit,
<span class="term-fg31">-    ChainSplitTarget, DBProvider, DisplayBlocksChain, HeaderProvider, ProviderError,</span>
<span class="term-fg31">-    StaticFileProviderFactory, StorageLocation,</span>
<span class="term-fg32">+    ChainSplitTarget, DBProvider, DisplayBlocksChain, HashedPostStateProvider, HeaderProvider,</span>
<span class="term-fg32">+    LatestStateProviderRef, ProviderError, StateRootProviderExt, StaticFileProviderFactory,</span>
<span class="term-fg32">+    StorageLocation,</span>
 };
 use reth_stages_api::{MetricEvent, MetricEventsSender};
 use reth_storage_errors::provider::{ProviderResult, RootMismatch};
<span class="term-fg31">-use reth_trie::{hashed_cursor::HashedPostStateCursorFactory, StateRoot};</span>
<span class="term-fg31">-use reth_trie_db::{DatabaseHashedCursorFactory, DatabaseStateRoot};</span>
 use std::{
     collections::{btree_map::Entry, BTreeMap, HashSet},
     sync::Arc,
<span class="term-fg36">@@ -1215,18 +1214,16 @@</span>         chain: Chain,
         recorder: &amp;mut MakeCanonicalDurationsRecorder,
     ) -&gt; Result&lt;(), CanonicalError&gt; {
         let (blocks, state, chain_trie_updates) = chain.into_inner();
<span class="term-fg31">-        let hashed_state = state.hash_state_slow();</span>
<span class="term-fg31">-        let prefix_sets = hashed_state.construct_prefix_sets().freeze();</span>
<span class="term-fg31">-        let hashed_state_sorted = hashed_state.into_sorted();</span>
<span class="term-fg32">+        let hashed_state = self.externals.provider_factory.hashed_post_state(state.state());</span>
&nbsp;
         &#47;&#47; Compute state root or retrieve cached trie updates before opening write transaction.
         let block_hash_numbers =
             blocks.iter().map(|(number, b)| (number, b.hash())).collect::&lt;Vec&lt;_&gt;&gt;();
<span class="term-fg31">-        let trie_updates = match chain_trie_updates {</span>
<span class="term-fg32">+        let (trie_updates, hashed_state_sorted) = match chain_trie_updates {</span>
             Some(updates) =&gt; {
                 debug!(target: &quot;blockchain_tree&quot;, blocks = ?block_hash_numbers, &quot;Using cached trie updates&quot;);
                 self.metrics.trie_updates_insert_cached.increment(1);
<span class="term-fg31">-                updates</span>
<span class="term-fg32">+                (updates, hashed_state.into_sorted())</span>
             }
             None =&gt; {
                 debug!(target: &quot;blockchain_tree&quot;, blocks = ?block_hash_numbers, &quot;Recomputing state root for insert&quot;);
<span class="term-fg36">@@ -1237,14 +1234,9 @@</span>                     .provider()?
                     &#47;&#47; State root calculation can take a while, and we&#39;re sure no write transaction
                     &#47;&#47; will be open in parallel. See https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;6168.
                     .disable_long_read_transaction_safety();
<span class="term-fg31">-                let (state_root, trie_updates) = StateRoot::from_tx(provider.tx_ref())</span>
<span class="term-fg31">-                    .with_hashed_cursor_factory(HashedPostStateCursorFactory::new(</span>
<span class="term-fg31">-                        DatabaseHashedCursorFactory::new(provider.tx_ref()),</span>
<span class="term-fg31">-                        &amp;hashed_state_sorted,</span>
<span class="term-fg31">-                    ))</span>
<span class="term-fg31">-                    .with_prefix_sets(prefix_sets)</span>
<span class="term-fg31">-                    .root_with_updates()</span>
<span class="term-fg31">-                    .map_err(Into::&lt;BlockValidationError&gt;::into)?;</span>
<span class="term-fg32">+                let (state_root, trie_updates, hashed_state_sorted) =</span>
<span class="term-fg32">+                    LatestStateProviderRef::new(&amp;provider)</span>
<span class="term-fg32">+                        .state_root_from_state_with_updates_and_sorted_state(hashed_state)?;</span>
                 let tip = blocks.tip();
                 if state_root != tip.state_root {
                     return Err(ProviderError::StateRootMismatch(Box::new(RootMismatch {
<span class="term-fg36">@@ -1255,7 +1247,7 @@</span>                     }))
                     .into())
                 }
                 self.metrics.trie_updates_insert_recomputed.increment(1);
<span class="term-fg31">-                trie_updates</span>
<span class="term-fg32">+                (trie_updates, hashed_state_sorted)</span>
             }
         };
         recorder.record_relative(MakeCanonicalAction::RetrieveStateTrieUpdates);
<span class="term-fg36">@@ -1400,9 +1392,10 @@</span>             MockNodeTypesWithDB,
         },
         ProviderFactory, StorageLocation,
     };
<span class="term-fg31">-    use reth_revm::primitives::AccountInfo;</span>
     use reth_stages_api::StageCheckpoint;
     use reth_trie::{root::state_root_unhashed, StateRoot};
<span class="term-fg32">+    use reth_trie_db::DatabaseStateRoot;</span>
<span class="term-fg32">+    use revm::AccountInfo;</span>
     use std::collections::HashMap;
&nbsp;
     fn setup_externals(
<span class="term-fg36">@@ -1880,7 +1873,12 @@</span>             CanonicalOutcome::Committed { head: block5.header.clone() }
         );
&nbsp;
         let provider = tree.externals.provider_factory.provider().unwrap();
<span class="term-fg31">-        let prefix_sets = exec5.hash_state_slow().construct_prefix_sets().freeze();</span>
<span class="term-fg32">+        let prefix_sets = tree</span>
<span class="term-fg32">+            .externals</span>
<span class="term-fg32">+            .provider_factory</span>
<span class="term-fg32">+            .hashed_post_state(exec5.state())</span>
<span class="term-fg32">+            .construct_prefix_sets()</span>
<span class="term-fg32">+            .freeze();</span>
         let state_root =
             StateRoot::from_tx(provider.tx_ref()).with_prefix_sets(prefix_sets).root().unwrap();
         assert_eq!(state_root, block5.state_root);</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-997890405474d5bed124f3df" role="button"
                       aria-expanded="false" aria-controls="id-997890405474d5bed124f3df">
                        <code>crates/blockchain-tree/src/chain.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/blockchain-tree/src/chain.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/blockchain-tree/src/chain.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-9</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-997890405474d5bed124f3df"><span class="term-fg1">diff --git reth&#47;crates&#47;blockchain-tree&#47;src&#47;chain.rs scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;chain.rs</span>
<span class="term-fg1">index 6ac39c316702c4bdf3ab57b6fdd387907fa32298..80c42d8dbb1109f9eb9572c19b2e76d425db2846 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;blockchain-tree&#47;src&#47;chain.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;chain.rs</span>
<span class="term-fg36">@@ -18,11 +18,10 @@</span> use reth_execution_types::{Chain, ExecutionOutcome};
 use reth_primitives::{GotExpected, SealedBlockWithSenders, SealedHeader};
 use reth_provider::{
     providers::{BundleStateProvider, ConsistentDbView, ProviderNodeTypes},
<span class="term-fg31">-    DBProvider, FullExecutionDataProvider, ProviderError, StateRootProvider,</span>
<span class="term-fg31">-    TryIntoHistoricalStateProvider,</span>
<span class="term-fg32">+    DBProvider, FullExecutionDataProvider, HashedPostStateProvider, ProviderError,</span>
<span class="term-fg32">+    StateRootProvider, TryIntoHistoricalStateProvider,</span>
 };
<span class="term-fg31">-use reth_revm::database::StateProviderDatabase;</span>
<span class="term-fg31">-use reth_trie::{updates::TrieUpdates, HashedPostState, TrieInput};</span>
<span class="term-fg32">+use reth_trie::{updates::TrieUpdates, TrieInput};</span>
 use reth_trie_parallel::root::ParallelStateRoot;
 use std::{
     collections::BTreeMap,
<span class="term-fg36">@@ -204,7 +203,10 @@</span>             .try_into_history_at_block(canonical_fork.number)?;
&nbsp;
         let provider = BundleStateProvider::new(state_provider, bundle_state_data_provider);
&nbsp;
<span class="term-fg31">-        let db = StateProviderDatabase::new(&amp;provider);</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let db = reth_revm::database::StateProviderDatabase::new(&amp;provider);</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let db = reth_scroll_storage::ScrollStateProviderDatabase::new(&amp;provider);</span>
         let executor = externals.executor_factory.executor(db);
         let block_hash = block.hash();
         let block = block.unseal();
<span class="term-fg36">@@ -228,15 +230,14 @@</span>                     provider.block_execution_data_provider.execution_outcome().clone();
                 execution_outcome.extend(initial_execution_outcome.clone());
                 ParallelStateRoot::new(
                     consistent_view,
<span class="term-fg31">-                    TrieInput::from_state(execution_outcome.hash_state_slow()),</span>
<span class="term-fg32">+                    TrieInput::from_state(provider.hashed_post_state(execution_outcome.state())),</span>
                 )
                 .incremental_root_with_updates()
                 .map(|(root, updates)| (root, Some(updates)))
                 .map_err(ProviderError::from)?
             } else {
<span class="term-fg31">-                let hashed_state =</span>
<span class="term-fg31">-                    HashedPostState::from_bundle_state(&amp;initial_execution_outcome.state().state);</span>
<span class="term-fg31">-                let state_root = provider.state_root(hashed_state)?;</span>
<span class="term-fg32">+                let hashed_state = provider.hashed_post_state(initial_execution_outcome.state());</span>
<span class="term-fg32">+                let state_root = provider.state_root_from_state(hashed_state)?;</span>
                 (state_root, None)
             };
             if block.state_root != state_root {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6817e8b228aa6ef009c59cb6" role="button"
                       aria-expanded="false" aria-controls="id-6817e8b228aa6ef009c59cb6">
                        <code>crates/blockchain-tree/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/blockchain-tree/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/blockchain-tree/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6817e8b228aa6ef009c59cb6"><span class="term-fg1">diff --git reth&#47;crates&#47;blockchain-tree&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 3f501bead071a6eef729a92e86ebe136e3403707..29e747a40a8786143af85ce9c75b55bee2f202fb 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;blockchain-tree&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -18,6 +18,8 @@</span> )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
&nbsp;
<span class="term-fg32">+use reth_revm as _;</span>
<span class="term-fg32">+</span>
 &#47;&#47;&#47; Re-export of the blockchain tree API.
 pub use reth_blockchain_tree_api::*;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-caacf7b3041c6ee43a3d8a01" role="button"
                       aria-expanded="false" aria-controls="id-caacf7b3041c6ee43a3d8a01">
                        <code>crates/chain-state/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/chain-state/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/chain-state/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-caacf7b3041c6ee43a3d8a01"><span class="term-fg1">diff --git reth&#47;crates&#47;chain-state&#47;Cargo.toml scroll-reth&#47;crates&#47;chain-state&#47;Cargo.toml</span>
<span class="term-fg1">index d2ef5870947b06f37d41da89e9ad6c1e74eed77e..2b06bd93707b4b37c0aa6f231001e855057f945a 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;chain-state&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;chain-state&#47;Cargo.toml</span>
<span class="term-fg36">@@ -26,6 +26,7 @@</span> # ethereum
 alloy-eips.workspace = true
 alloy-primitives.workspace = true
 alloy-consensus.workspace = true
<span class="term-fg32">+revm.workspace = true</span>
&nbsp;
 # async
 tokio = { workspace = true, default-features = false, features = [&quot;sync&quot;, &quot;macros&quot;] }
<span class="term-fg36">@@ -44,7 +45,6 @@</span> # optional deps for test-utils
 alloy-signer = { workspace = true, optional = true }
 alloy-signer-local = { workspace = true, optional = true }
 rand = { workspace = true, optional = true }
<span class="term-fg31">-revm = { workspace = true, optional = true }</span>
&nbsp;
 [dev-dependencies]
 reth-testing-utils.workspace = true
<span class="term-fg36">@@ -52,17 +52,15 @@</span> alloy-signer.workspace = true
 alloy-signer-local.workspace = true
 alloy-consensus.workspace = true
 rand.workspace = true
<span class="term-fg31">-revm.workspace = true</span>
&nbsp;
 [features]
 test-utils = [
     &quot;alloy-signer&quot;,
     &quot;alloy-signer-local&quot;,
     &quot;rand&quot;,
<span class="term-fg31">-    &quot;revm&quot;,</span>
     &quot;reth-chainspec&#47;test-utils&quot;,
     &quot;reth-primitives&#47;test-utils&quot;,
     &quot;reth-primitives-traits&#47;test-utils&quot;,
     &quot;reth-trie&#47;test-utils&quot;,
<span class="term-fg31">-    &quot;revm?&#47;test-utils&quot;,</span>
<span class="term-fg32">+    &quot;revm&#47;test-utils&quot;,</span>
 ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ef9a14c3c9cb33a9faff0370" role="button"
                       aria-expanded="false" aria-controls="id-ef9a14c3c9cb33a9faff0370">
                        <code>crates/chain-state/src/in_memory.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/chain-state/src/in_memory.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/chain-state/src/in_memory.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+25</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ef9a14c3c9cb33a9faff0370"><span class="term-fg1">diff --git reth&#47;crates&#47;chain-state&#47;src&#47;in_memory.rs scroll-reth&#47;crates&#47;chain-state&#47;src&#47;in_memory.rs</span>
<span class="term-fg1">index f43aae562e00bc769b026445dce06f0277e8589d..877b3c7ce375c04ea69139c1493263f36792b385 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;chain-state&#47;src&#47;in_memory.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;chain-state&#47;src&#47;in_memory.rs</span>
<span class="term-fg36">@@ -949,12 +949,15 @@</span>     use rand::Rng;
     use reth_errors::ProviderResult;
     use reth_primitives::{Account, Bytecode, EthPrimitives, Receipt};
     use reth_storage_api::{
<span class="term-fg31">-        AccountReader, BlockHashReader, StateProofProvider, StateProvider, StateRootProvider,</span>
<span class="term-fg32">+        AccountReader, BlockHashReader, HashedPostStateProvider, HashedStorageProvider,</span>
<span class="term-fg32">+        KeyHasherProvider, StateProofProvider, StateProvider, StateRootProvider,</span>
         StorageRootProvider,
     };
     use reth_trie::{
<span class="term-fg31">-        AccountProof, HashedStorage, MultiProof, StorageMultiProof, StorageProof, TrieInput,</span>
<span class="term-fg32">+        AccountProof, HashedStorage, KeccakKeyHasher, KeyHasher, MultiProof, StorageMultiProof,</span>
<span class="term-fg32">+        StorageProof, TrieInput,</span>
     };
<span class="term-fg32">+    use revm::db::BundleAccount;</span>
&nbsp;
     fn create_mock_state(
         test_block_builder: &amp;mut TestBlockBuilder&lt;EthPrimitives&gt;,
<span class="term-fg36">@@ -1024,7 +1027,7 @@</span>         }
     }
&nbsp;
     impl StateRootProvider for MockStateProvider {
<span class="term-fg31">-        fn state_root(&amp;self, _hashed_state: HashedPostState) -&gt; ProviderResult&lt;B256&gt; {</span>
<span class="term-fg32">+        fn state_root_from_state(&amp;self, _hashed_state: HashedPostState) -&gt; ProviderResult&lt;B256&gt; {</span>
             Ok(B256::random())
         }
&nbsp;
<span class="term-fg36">@@ -1032,7 +1035,7 @@</span>         fn state_root_from_nodes(&amp;self, _input: TrieInput) -&gt; ProviderResult&lt;B256&gt; {
             Ok(B256::random())
         }
&nbsp;
<span class="term-fg31">-        fn state_root_with_updates(</span>
<span class="term-fg32">+        fn state_root_from_state_with_updates(</span>
             &amp;self,
             _hashed_state: HashedPostState,
         ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {
<span class="term-fg36">@@ -1044,6 +1047,24 @@</span>             &amp;self,
             _input: TrieInput,
         ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {
             Ok((B256::random(), TrieUpdates::default()))
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    impl HashedPostStateProvider for MockStateProvider {</span>
<span class="term-fg32">+        fn hashed_post_state(&amp;self, _bundle_state: &amp;revm::db::BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+            HashedPostState::default()</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    impl HashedStorageProvider for MockStateProvider {</span>
<span class="term-fg32">+        fn hashed_storage(&amp;self, _account: &amp;BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+            HashedStorage::default()</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    impl KeyHasherProvider for MockStateProvider {</span>
<span class="term-fg32">+        fn hash_key(&amp;self, bytes: &amp;[u8]) -&gt; B256 {</span>
<span class="term-fg32">+            KeccakKeyHasher::hash_key(bytes)</span>
         }
     }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b438a015fd93b48c0d322ced" role="button"
                       aria-expanded="false" aria-controls="id-b438a015fd93b48c0d322ced">
                        <code>crates/chain-state/src/memory_overlay.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/chain-state/src/memory_overlay.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/chain-state/src/memory_overlay.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+26</span></div>
                            <div class="text-start"><span class="text-danger">-8</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b438a015fd93b48c0d322ced"><span class="term-fg1">diff --git reth&#47;crates&#47;chain-state&#47;src&#47;memory_overlay.rs scroll-reth&#47;crates&#47;chain-state&#47;src&#47;memory_overlay.rs</span>
<span class="term-fg1">index c84bd8c93f06505f3c6b6e03f733a028e63cc6b4..7615f551fe5bedec2e7dc511c247f34894be58e3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;chain-state&#47;src&#47;memory_overlay.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;chain-state&#47;src&#47;memory_overlay.rs</span>
<span class="term-fg36">@@ -1,20 +1,20 @@</span>
 use super::ExecutedBlock;
 use alloy_consensus::BlockHeader;
 use alloy_primitives::{
<span class="term-fg31">-    keccak256,</span>
     map::{HashMap, HashSet},
     Address, BlockNumber, Bytes, StorageKey, StorageValue, B256,
 };
 use reth_errors::ProviderResult;
 use reth_primitives::{Account, Bytecode, NodePrimitives};
 use reth_storage_api::{
<span class="term-fg31">-    AccountReader, BlockHashReader, StateProofProvider, StateProvider, StateRootProvider,</span>
<span class="term-fg31">-    StorageRootProvider,</span>
<span class="term-fg32">+    AccountReader, BlockHashReader, HashedPostStateProvider, HashedStorageProvider,</span>
<span class="term-fg32">+    KeyHasherProvider, StateProofProvider, StateProvider, StateRootProvider, StorageRootProvider,</span>
 };
 use reth_trie::{
     updates::TrieUpdates, AccountProof, HashedPostState, HashedStorage, MultiProof,
     StorageMultiProof, TrieInput,
 };
<span class="term-fg32">+use revm::db::{BundleAccount, BundleState};</span>
 use std::sync::OnceLock;
&nbsp;
 &#47;&#47;&#47; A state provider that stores references to in-memory blocks along with their state as well as a
<span class="term-fg36">@@ -119,7 +119,7 @@</span>             }
         }
&nbsp;
         impl $($tokens)* StateRootProvider for $type {
<span class="term-fg31">-            fn state_root(&amp;self, state: HashedPostState) -&gt; ProviderResult&lt;B256&gt; {</span>
<span class="term-fg32">+            fn state_root_from_state(&amp;self, state: HashedPostState) -&gt; ProviderResult&lt;B256&gt; {</span>
                 self.state_root_from_nodes(TrieInput::from_state(state))
             }
&nbsp;
<span class="term-fg36">@@ -129,7 +129,7 @@</span>                 input.prepend_cached(nodes, state);
                 self.historical.state_root_from_nodes(input)
             }
&nbsp;
<span class="term-fg31">-            fn state_root_with_updates(</span>
<span class="term-fg32">+            fn state_root_from_state_with_updates(</span>
                 &amp;self,
                 state: HashedPostState,
             ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {
<span class="term-fg36">@@ -151,7 +151,7 @@</span>             &#47;&#47; TODO: Currently this does not reuse available in-memory trie nodes.
             fn storage_root(&amp;self, address: Address, storage: HashedStorage) -&gt; ProviderResult&lt;B256&gt; {
                 let state = &amp;self.trie_state().state;
                 let mut hashed_storage =
<span class="term-fg31">-                    state.storages.get(&amp;keccak256(address)).cloned().unwrap_or_default();</span>
<span class="term-fg32">+                    state.storages.get(&amp;self.hash_key(address.as_ref())).cloned().unwrap_or_default();</span>
                 hashed_storage.extend(&amp;storage);
                 self.historical.storage_root(address, hashed_storage)
             }
<span class="term-fg36">@@ -165,7 +165,7 @@</span>                 storage: HashedStorage,
             ) -&gt; ProviderResult&lt;reth_trie::StorageProof&gt; {
                 let state = &amp;self.trie_state().state;
                 let mut hashed_storage =
<span class="term-fg31">-                    state.storages.get(&amp;keccak256(address)).cloned().unwrap_or_default();</span>
<span class="term-fg32">+                    state.storages.get(&amp;self.hash_key(address.as_ref())).cloned().unwrap_or_default();</span>
                 hashed_storage.extend(&amp;storage);
                 self.historical.storage_proof(address, slot, hashed_storage)
             }
<span class="term-fg36">@@ -179,7 +179,7 @@</span>                 storage: HashedStorage,
             ) -&gt; ProviderResult&lt;StorageMultiProof&gt; {
                 let state = &amp;self.trie_state().state;
                 let mut hashed_storage =
<span class="term-fg31">-                    state.storages.get(&amp;keccak256(address)).cloned().unwrap_or_default();</span>
<span class="term-fg32">+                    state.storages.get(&amp;self.hash_key(address.as_ref())).cloned().unwrap_or_default();</span>
                 hashed_storage.extend(&amp;storage);
                 self.historical.storage_multiproof(address, slots, hashed_storage)
             }
<span class="term-fg36">@@ -215,6 +215,24 @@</span>             ) -&gt; ProviderResult&lt;HashMap&lt;B256, Bytes&gt;&gt; {
                 let MemoryOverlayTrieState { nodes, state } = self.trie_state().clone();
                 input.prepend_cached(nodes, state);
                 self.historical.witness(input, target)
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        impl $($tokens)* HashedPostStateProvider for $type {</span>
<span class="term-fg32">+            fn hashed_post_state(&amp;self, bundle_state: &amp;BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+                self.historical.hashed_post_state(bundle_state)</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        impl $($tokens)* HashedStorageProvider for $type {</span>
<span class="term-fg32">+            fn hashed_storage(&amp;self, account: &amp;BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+                self.historical.hashed_storage(account)</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        impl $($tokens)* KeyHasherProvider for $type {</span>
<span class="term-fg32">+            fn hash_key(&amp;self, bytes: &amp;[u8]) -&gt; B256 {</span>
<span class="term-fg32">+                self.historical.hash_key(bytes)</span>
             }
         }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d8c06dfca87ba38e9641346b" role="button"
                       aria-expanded="false" aria-controls="id-d8c06dfca87ba38e9641346b">
                        <code>crates/chainspec/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/chainspec/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/chainspec/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d8c06dfca87ba38e9641346b"><span class="term-fg1">diff --git reth&#47;crates&#47;chainspec&#47;Cargo.toml scroll-reth&#47;crates&#47;chainspec&#47;Cargo.toml</span>
<span class="term-fg1">index 5bac582cd8b60a343cc07d7940467c366a40289c..23b81d79c1154ff3d2178e9acfa36deab9a8c9da 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;chainspec&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;chainspec&#47;Cargo.toml</span>
<span class="term-fg36">@@ -63,3 +63,7 @@</span> test-utils = [
 	&quot;reth-primitives-traits&#47;test-utils&quot;,
 	&quot;reth-trie-common&#47;test-utils&quot;
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-trie-common&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a7e60d6e186c3968671241e3" role="button"
                       aria-expanded="false" aria-controls="id-a7e60d6e186c3968671241e3">
                        <code>crates/chainspec/src/spec.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/chainspec/src/spec.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/chainspec/src/spec.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a7e60d6e186c3968671241e3"><span class="term-fg1">diff --git reth&#47;crates&#47;chainspec&#47;src&#47;spec.rs scroll-reth&#47;crates&#47;chainspec&#47;src&#47;spec.rs</span>
<span class="term-fg1">index 1f8ebd45f45d91db8f9b92f4bfa1e63c5cd7a06a..c04ab27371ec1ff342572b3e3a5eacec7a204d7c 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;chainspec&#47;src&#47;spec.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;chainspec&#47;src&#47;spec.rs</span>
<span class="term-fg36">@@ -24,7 +24,7 @@</span>     ForkFilter, ForkFilterKey, ForkHash, ForkId, Hardfork, Hardforks, Head, DEV_HARDFORKS,
 };
 use reth_network_peers::{
     base_nodes, base_testnet_nodes, holesky_nodes, mainnet_nodes, op_nodes, op_testnet_nodes,
<span class="term-fg31">-    sepolia_nodes, NodeRecord,</span>
<span class="term-fg32">+    scroll_nodes, scroll_sepolia_nodes, sepolia_nodes, NodeRecord,</span>
 };
 use reth_primitives_traits::SealedHeader;
 use reth_trie_common::root::state_root_ref_unhashed;
<span class="term-fg36">@@ -571,8 +571,10 @@</span>             C::Sepolia =&gt; Some(sepolia_nodes()),
             C::Holesky =&gt; Some(holesky_nodes()),
             C::Base =&gt; Some(base_nodes()),
             C::Optimism =&gt; Some(op_nodes()),
<span class="term-fg32">+            C::Scroll =&gt; Some(scroll_nodes()),</span>
             C::BaseGoerli | C::BaseSepolia =&gt; Some(base_testnet_nodes()),
             C::OptimismSepolia | C::OptimismGoerli | C::OptimismKovan =&gt; Some(op_testnet_nodes()),
<span class="term-fg32">+            C::ScrollSepolia =&gt; Some(scroll_sepolia_nodes()),</span>
             _ =&gt; None,
         }
     }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ccd6ab6f0a3fb0648aef8bd9" role="button"
                       aria-expanded="false" aria-controls="id-ccd6ab6f0a3fb0648aef8bd9">
                        <code>crates/cli/commands/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/cli/commands/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/cli/commands/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ccd6ab6f0a3fb0648aef8bd9"><span class="term-fg1">diff --git reth&#47;crates&#47;cli&#47;commands&#47;Cargo.toml scroll-reth&#47;crates&#47;cli&#47;commands&#47;Cargo.toml</span>
<span class="term-fg1">index 90acb82d71d777213a40a98040b8db77bd024a81..4c403c2d75a4707116522b73d54684fcaaf31639 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;cli&#47;commands&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;cli&#47;commands&#47;Cargo.toml</span>
<span class="term-fg36">@@ -45,8 +45,7 @@</span> reth-stages.workspace = true
 reth-stages-types = { workspace = true, optional = true }
 reth-static-file-types = { workspace = true, features = [&quot;clap&quot;] }
 reth-static-file.workspace = true
<span class="term-fg31">-reth-trie = { workspace = true, features = [&quot;metrics&quot;] }</span>
<span class="term-fg31">-reth-trie-db = { workspace = true, features = [&quot;metrics&quot;] }</span>
<span class="term-fg32">+reth-trie = { workspace = true, optional = true }</span>
 reth-trie-common = { workspace = true, optional = true }
&nbsp;
 # ethereum
<span class="term-fg36">@@ -113,6 +112,7 @@</span>     &quot;reth-trie-common&#47;test-utils&quot;,
     &quot;reth-codecs?&#47;arbitrary&quot;,
     &quot;reth-prune-types?&#47;arbitrary&quot;,
     &quot;reth-stages-types?&#47;arbitrary&quot;,
<span class="term-fg32">+    &quot;reth-trie&quot;,</span>
     &quot;reth-trie-common?&#47;arbitrary&quot;,
     &quot;alloy-consensus&#47;arbitrary&quot;,
 ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-40945c62f383416bdbbc647c" role="button"
                       aria-expanded="false" aria-controls="id-40945c62f383416bdbbc647c">
                        <code>crates/cli/commands/src/recover/storage_tries.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/cli/commands/src/recover/storage_tries.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/cli/commands/src/recover/storage_tries.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-40945c62f383416bdbbc647c"><span class="term-fg1">diff --git reth&#47;crates&#47;cli&#47;commands&#47;src&#47;recover&#47;storage_tries.rs scroll-reth&#47;crates&#47;cli&#47;commands&#47;src&#47;recover&#47;storage_tries.rs</span>
<span class="term-fg1">index f879c393c6b1277cb0fd09e33b37abfebcc4cd02..f9b65010fa325666705629d1e8405c51010104c0 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;cli&#47;commands&#47;src&#47;recover&#47;storage_tries.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;cli&#47;commands&#47;src&#47;recover&#47;storage_tries.rs</span>
<span class="term-fg36">@@ -8,9 +8,10 @@</span> use reth_db_api::{
     cursor::{DbCursorRO, DbDupCursorRW},
     transaction::DbTx,
 };
<span class="term-fg31">-use reth_provider::{BlockNumReader, HeaderProvider, ProviderError};</span>
<span class="term-fg31">-use reth_trie::StateRoot;</span>
<span class="term-fg31">-use reth_trie_db::DatabaseStateRoot;</span>
<span class="term-fg32">+use reth_provider::{</span>
<span class="term-fg32">+    BlockNumReader, HeaderProvider, LatestStateProviderRef, ProviderError, StateRootProviderExt,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
 use tracing::*;
&nbsp;
 &#47;&#47;&#47; `reth recover storage-tries` command
<span class="term-fg36">@@ -50,7 +51,7 @@</span>
             entry = storage_trie_cursor.next()?;
         }
&nbsp;
<span class="term-fg31">-        let state_root = StateRoot::from_tx(tx_mut).root()?;</span>
<span class="term-fg32">+        let state_root = LatestStateProviderRef::new(&amp;provider.0).state_root()?;</span>
         if state_root != best_header.state_root {
             eyre::bail!(
                 &quot;Recovery failed. Incorrect state root. Expected: {:?}. Received: {:?}&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e79239f796e049410d7ff672" role="button"
                       aria-expanded="false" aria-controls="id-e79239f796e049410d7ff672">
                        <code>crates/e2e-test-utils/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/e2e-test-utils/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/e2e-test-utils/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e79239f796e049410d7ff672"><span class="term-fg1">diff --git reth&#47;crates&#47;e2e-test-utils&#47;Cargo.toml scroll-reth&#47;crates&#47;e2e-test-utils&#47;Cargo.toml</span>
<span class="term-fg1">index bedacbecd7594080dae2d3f7a4f7fcc06d435b8f..9a11a3b11095feb205315ab6f025f8286c22aeb8 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;e2e-test-utils&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;e2e-test-utils&#47;Cargo.toml</span>
<span class="term-fg36">@@ -60,3 +60,6 @@</span> alloy-network.workspace = true
 alloy-consensus = { workspace = true, features = [&quot;kzg&quot;] }
 tracing.workspace = true
 derive_more.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6c0cd6210270881f58c3a276" role="button"
                       aria-expanded="false" aria-controls="id-6c0cd6210270881f58c3a276">
                        <code>crates/e2e-test-utils/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/e2e-test-utils/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/e2e-test-utils/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6c0cd6210270881f58c3a276"><span class="term-fg1">diff --git reth&#47;crates&#47;e2e-test-utils&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;e2e-test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 15065377fabf858b0b7c4b28a9146ef87ea9cb04..de833273ad98f876da8ecd43e321ab1d8bd5fe5f 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;e2e-test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;e2e-test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -1,5 +1,9 @@</span>
 &#47;&#47;! Utilities for end-to-end tests.
&nbsp;
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 use node::NodeTestContext;
 use reth_chainspec::EthChainSpec;
 use reth_db::{test_utils::TempDatabase, DatabaseEnv};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-31278ed01929fda65eb168af" role="button"
                       aria-expanded="false" aria-controls="id-31278ed01929fda65eb168af">
                        <code>crates/engine/invalid-block-hooks/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/invalid-block-hooks/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/engine/invalid-block-hooks/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+16</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-31278ed01929fda65eb168af"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;Cargo.toml scroll-reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;Cargo.toml</span>
<span class="term-fg1">index a7b0153d0d4b7d2968afc5b34e642bf2afdb65a2..2b215954e3e4d37a888fb1af282e84cc60af32b6 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;Cargo.toml</span>
<span class="term-fg36">@@ -29,6 +29,11 @@</span> alloy-rlp.workspace = true
 alloy-rpc-types-debug.workspace = true
 alloy-consensus.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+reth-scroll-revm = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # async
 futures.workspace = true
&nbsp;
<span class="term-fg36">@@ -38,3 +43,14 @@</span> jsonrpsee.workspace = true
 pretty_assertions = &quot;1.4&quot;
 serde.workspace = true
 serde_json.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-storage&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-revm&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ef5076a02a20acc94c1b647a" role="button"
                       aria-expanded="false" aria-controls="id-ef5076a02a20acc94c1b647a">
                        <code>crates/engine/invalid-block-hooks/src/witness.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/invalid-block-hooks/src/witness.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/engine/invalid-block-hooks/src/witness.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+27</span></div>
                            <div class="text-start"><span class="text-danger">-18</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ef5076a02a20acc94c1b647a"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;src&#47;witness.rs scroll-reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;src&#47;witness.rs</span>
<span class="term-fg1">index 98ee8dd2d1370efdf8b7499034f6d454882f575b..f141542507832b341fc39151ce866568f7be174f 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;src&#47;witness.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;src&#47;witness.rs</span>
<span class="term-fg36">@@ -1,5 +1,5 @@</span>
 use alloy_consensus::Header;
<span class="term-fg31">-use alloy_primitives::{keccak256, B256, U256};</span>
<span class="term-fg32">+use alloy_primitives::{B256, U256};</span>
 use alloy_rpc_types_debug::ExecutionWitness;
 use eyre::OptionExt;
 use pretty_assertions::Comparison;
<span class="term-fg36">@@ -12,12 +12,13 @@</span> use reth_primitives::{Receipt, SealedBlockWithSenders, SealedHeader};
 use reth_primitives_traits::SignedTransaction;
 use reth_provider::{BlockExecutionOutput, ChainSpecProvider, StateProviderFactory};
 use reth_revm::{
<span class="term-fg31">-    database::StateProviderDatabase, db::states::bundle_state::BundleRetention,</span>
<span class="term-fg31">-    primitives::EnvWithHandlerCfg, DatabaseCommit, StateBuilder,</span>
<span class="term-fg32">+    db::states::bundle_state::BundleRetention, primitives::EnvWithHandlerCfg, DatabaseCommit,</span>
<span class="term-fg32">+    StateBuilder,</span>
 };
 use reth_rpc_api::DebugApiClient;
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use reth_tracing::tracing::warn;
<span class="term-fg31">-use reth_trie::{updates::TrieUpdates, HashedPostState, HashedStorage};</span>
<span class="term-fg32">+use reth_trie::{updates::TrieUpdates, HashedStorage};</span>
 use serde::Serialize;
 use std::{collections::HashMap, fmt::Debug, fs::File, io::Write, path::PathBuf};
&nbsp;
<span class="term-fg36">@@ -66,12 +67,12 @@</span>     ) -&gt; eyre::Result&lt;()&gt; {
         &#47;&#47; TODO(alexey): unify with `DebugApi::debug_execution_witness`
&nbsp;
         &#47;&#47; Setup database.
<span class="term-fg31">-        let mut db = StateBuilder::new()</span>
<span class="term-fg31">-            .with_database(StateProviderDatabase::new(</span>
<span class="term-fg31">-                self.provider.state_by_block_hash(parent_header.hash())?,</span>
<span class="term-fg31">-            ))</span>
<span class="term-fg31">-            .with_bundle_update()</span>
<span class="term-fg31">-            .build();</span>
<span class="term-fg32">+        let provider = self.provider.state_by_block_hash(parent_header.hash())?;</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let state = reth_revm::database::StateProviderDatabase::new(&amp;provider);</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let state = reth_scroll_storage::ScrollStateProviderDatabase::new(&amp;provider);</span>
<span class="term-fg32">+        let mut db = StateBuilder::new().with_database(state).with_bundle_update().build();</span>
&nbsp;
         &#47;&#47; Setup environment for the execution.
         let (cfg, block_env) = self.evm_config.cfg_and_block_env(block.header(), U256::MAX);
<span class="term-fg36">@@ -117,7 +118,7 @@</span>         &#47;&#47; Merge all state transitions
         db.merge_transitions(BundleRetention::Reverts);
&nbsp;
         &#47;&#47; Take the bundle state
<span class="term-fg31">-        let mut bundle_state = db.take_bundle();</span>
<span class="term-fg32">+        let mut bundle_state = db.finalize();</span>
&nbsp;
         &#47;&#47; Initialize a map of preimages.
         let mut state_preimages = HashMap::default();
<span class="term-fg36">@@ -126,12 +127,20 @@</span>         &#47;&#47; Grab all account proofs for the data accessed during block execution.
         &#47;&#47;
         &#47;&#47; Note: We grab *all* accounts in the cache here, as the `BundleState` prunes
         &#47;&#47; referenced accounts + storage slots.
<span class="term-fg31">-        let mut hashed_state = HashedPostState::from_bundle_state(&amp;bundle_state.state);</span>
<span class="term-fg32">+        let mut hashed_state = db.database.hashed_post_state(&amp;bundle_state);</span>
         for (address, account) in db.cache.accounts {
<span class="term-fg31">-            let hashed_address = keccak256(address);</span>
<span class="term-fg31">-            hashed_state</span>
<span class="term-fg31">-                .accounts</span>
<span class="term-fg31">-                .insert(hashed_address, account.account.as_ref().map(|a| a.info.clone().into()));</span>
<span class="term-fg32">+            let hashed_address = provider.hash_key(address.as_ref());</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            let hashed_account = account.account.as_ref().map(|a| {</span>
<span class="term-fg32">+                Into::&lt;reth_scroll_revm::AccountInfo&gt;::into((</span>
<span class="term-fg32">+                    a.info.clone(),</span>
<span class="term-fg32">+                    &amp;db.database.post_execution_context,</span>
<span class="term-fg32">+                ))</span>
<span class="term-fg32">+                .into()</span>
<span class="term-fg32">+            });</span>
<span class="term-fg32">+            #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+            let hashed_account = account.account.as_ref().map(|a| a.info.clone().into());</span>
<span class="term-fg32">+            hashed_state.accounts.insert(hashed_address, hashed_account);</span>
&nbsp;
             let storage = hashed_state
                 .storages
<span class="term-fg36">@@ -143,7 +152,7 @@</span>                 state_preimages.insert(hashed_address, alloy_rlp::encode(address).into());
&nbsp;
                 for (slot, value) in account.storage {
                     let slot = B256::from(slot);
<span class="term-fg31">-                    let hashed_slot = keccak256(slot);</span>
<span class="term-fg32">+                    let hashed_slot = provider.hash_key(slot.as_ref());</span>
                     storage.storage.insert(hashed_slot, value);
&nbsp;
                     state_preimages.insert(hashed_slot, alloy_rlp::encode(slot).into());
<span class="term-fg36">@@ -233,7 +242,7 @@</span>
         &#47;&#47; Calculate the state root and trie updates after re-execution. They should match
         &#47;&#47; the original ones.
         let (re_executed_root, trie_output) =
<span class="term-fg31">-            state_provider.state_root_with_updates(hashed_state)?;</span>
<span class="term-fg32">+            state_provider.state_root_from_state_with_updates(hashed_state)?;</span>
         if let Some((original_updates, original_root)) = trie_updates {
             if re_executed_root != original_root {
                 let filename = format!(&quot;{}_{}.state_root.diff&quot;, block.number, block.hash());</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c5015dabd10aabe09824900e" role="button"
                       aria-expanded="false" aria-controls="id-c5015dabd10aabe09824900e">
                        <code>crates/engine/primitives/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/primitives/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/engine/primitives/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+7</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c5015dabd10aabe09824900e"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;primitives&#47;Cargo.toml scroll-reth&#47;crates&#47;engine&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">index 2da1be9c928e9558ec046103d340722b89f267cb..97d2959b32949b97e5abe5bde438922eeca95199 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg36">@@ -32,3 +32,10 @@</span>
 # misc
 serde.workspace = true
 thiserror.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c9d969bcd51c9a01b65cf13d" role="button"
                       aria-expanded="false" aria-controls="id-c9d969bcd51c9a01b65cf13d">
                        <code>crates/engine/tree/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/tree/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/engine/tree/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c9d969bcd51c9a01b65cf13d"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;tree&#47;Cargo.toml scroll-reth&#47;crates&#47;engine&#47;tree&#47;Cargo.toml</span>
<span class="term-fg1">index 680b6933ebe6df14a14fc71c010b442d6c49b5c3..417817a787a2734f2bfe4eda839d1eacb07041a3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;tree&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;tree&#47;Cargo.toml</span>
<span class="term-fg36">@@ -29,12 +29,16 @@</span> reth-primitives.workspace = true
 reth-provider.workspace = true
 reth-prune.workspace = true
 reth-revm.workspace = true
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
 reth-stages-api.workspace = true
 reth-tasks.workspace = true
 reth-trie-db.workspace = true
 reth-trie-parallel.workspace = true
 reth-trie-sparse.workspace = true
 reth-trie.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
&nbsp;
 # alloy
 alloy-consensus.workspace = true
<span class="term-fg36">@@ -116,3 +120,7 @@</span>     &quot;reth-trie&#47;test-utils&quot;,
     &quot;reth-prune-types?&#47;test-utils&quot;,
     &quot;reth-trie-db&#47;test-utils&quot;,
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-storage&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b3984a31e0e5d3015fd6380e" role="button"
                       aria-expanded="false" aria-controls="id-b3984a31e0e5d3015fd6380e">
                        <code>crates/engine/tree/benches/channel_perf.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/tree/benches/channel_perf.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/engine/tree/benches/channel_perf.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b3984a31e0e5d3015fd6380e"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;tree&#47;benches&#47;channel_perf.rs scroll-reth&#47;crates&#47;engine&#47;tree&#47;benches&#47;channel_perf.rs</span>
<span class="term-fg1">index c1c65e0a68e17288f41d538dee9d4ed268d1bd03..0103733691b1bcb9737add5a4e94e671664f7042 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;tree&#47;benches&#47;channel_perf.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;tree&#47;benches&#47;channel_perf.rs</span>
<span class="term-fg36">@@ -1,6 +1,7 @@</span>
 &#47;&#47;! Benchmark comparing `std::sync::mpsc` and `crossbeam` channels for `StateRootTask`.
&nbsp;
 #![allow(missing_docs)]
<span class="term-fg32">+#![allow(clippy::needless_update)]</span>
&nbsp;
 use criterion::{criterion_group, criterion_main, BatchSize, BenchmarkId, Criterion};
 use revm_primitives::{
<span class="term-fg36">@@ -23,6 +24,7 @@</span>                 balance: U256::from(100),
                 nonce: 10,
                 code_hash: B256::random(),
                 code: Default::default(),
<span class="term-fg32">+                ..Default::default()</span>
             },
             storage,
             status: AccountStatus::Loaded,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-991ee8fcccf2d87057cc27ea" role="button"
                       aria-expanded="false" aria-controls="id-991ee8fcccf2d87057cc27ea">
                        <code>crates/engine/tree/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/tree/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/engine/tree/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-991ee8fcccf2d87057cc27ea"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;tree&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;engine&#47;tree&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 100b71604f536a94b42032fc56718d486364ab94..7687bd11360f885f132e99882bafc57d02ae0240 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;tree&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;tree&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -90,7 +90,7 @@</span>     html_favicon_url = &quot;https:&#47;&#47;avatars0.githubusercontent.com&#47;u&#47;97369466?s=256&quot;,
     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg31">-#![cfg_attr(not(test), warn(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg_attr(not(any(test, feature = &quot;scroll&quot;)), warn(unused_crate_dependencies))]</span>
&nbsp;
 &#47;&#47;&#47; Re-export of the blockchain tree API.
 pub use reth_blockchain_tree_api::*;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0b500a71421d877842557dee" role="button"
                       aria-expanded="false" aria-controls="id-0b500a71421d877842557dee">
                        <code>crates/engine/tree/src/tree/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/tree/src/tree/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/engine/tree/src/tree/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-7</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0b500a71421d877842557dee"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;tree&#47;src&#47;tree&#47;mod.rs scroll-reth&#47;crates&#47;engine&#47;tree&#47;src&#47;tree&#47;mod.rs</span>
<span class="term-fg1">index 5dc8039afe65d35154aabb26668506ed39459b77..a50f5f325817cef58016101dd306cbde6a00a730 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;tree&#47;src&#47;tree&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;tree&#47;src&#47;tree&#47;mod.rs</span>
<span class="term-fg36">@@ -41,10 +41,9 @@</span>     SealedHeader,
 };
 use reth_provider::{
     providers::ConsistentDbView, BlockReader, DatabaseProviderFactory, ExecutionOutcome,
<span class="term-fg31">-    ProviderError, StateProviderBox, StateProviderFactory, StateReader, StateRootProvider,</span>
<span class="term-fg31">-    TransactionVariant,</span>
<span class="term-fg32">+    HashedPostStateProvider, ProviderError, StateCommitmentProvider, StateProviderBox,</span>
<span class="term-fg32">+    StateProviderFactory, StateReader, StateRootProvider, TransactionVariant,</span>
 };
<span class="term-fg31">-use reth_revm::database::StateProviderDatabase;</span>
 use reth_stages_api::ControlFlow;
 use reth_trie::{updates::TrieUpdates, HashedPostState, TrieInput};
 use reth_trie_parallel::root::{ParallelStateRoot, ParallelStateRootError};
<span class="term-fg36">@@ -545,6 +544,8 @@</span>     P: DatabaseProviderFactory
         + BlockReader&lt;Block = reth_primitives::Block&gt;
         + StateProviderFactory
         + StateReader&lt;Receipt = reth_primitives::Receipt&gt;
<span class="term-fg32">+        + StateCommitmentProvider</span>
<span class="term-fg32">+        + HashedPostStateProvider</span>
         + Clone
         + &#39;static,
     &lt;P as DatabaseProviderFactory&gt;::Provider: BlockReader,
<span class="term-fg36">@@ -1561,7 +1562,7 @@</span>         let execution_output = self
             .provider
             .get_state(block.number())?
             .ok_or_else(|| ProviderError::StateForNumberNotFound(block.number()))?;
<span class="term-fg31">-        let hashed_state = execution_output.hash_state_slow();</span>
<span class="term-fg32">+        let hashed_state = self.provider.hashed_post_state(execution_output.state());</span>
&nbsp;
         Ok(Some(ExecutedBlock {
             block: Arc::new(block),
<span class="term-fg36">@@ -2201,7 +2202,12 @@</span>             return Err(e.into())
         }
&nbsp;
         trace!(target: &quot;engine::tree&quot;, block=?block.num_hash(), &quot;Executing block&quot;);
<span class="term-fg31">-        let executor = self.executor_provider.executor(StateProviderDatabase::new(&amp;state_provider));</span>
<span class="term-fg32">+        &#47;&#47; TODO(scroll): remove once issue #76 is completed.</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let db = reth_scroll_storage::ScrollStateProviderDatabase::new(&amp;state_provider);</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let db = reth_revm::database::StateProviderDatabase::new(&amp;state_provider);</span>
<span class="term-fg32">+        let executor = self.executor_provider.executor(db);</span>
&nbsp;
         let block_number = block.number;
         let block_hash = block.hash();
<span class="term-fg36">@@ -2235,7 +2241,7 @@</span>             );
             return Err(err.into())
         }
&nbsp;
<span class="term-fg31">-        let hashed_state = HashedPostState::from_bundle_state(&amp;output.state.state);</span>
<span class="term-fg32">+        let hashed_state = self.provider.hashed_post_state(&amp;output.state);</span>
&nbsp;
         trace!(target: &quot;engine::tree&quot;, block=?sealed_block.num_hash(), &quot;Calculating block state root&quot;);
         let root_time = Instant::now();
<span class="term-fg36">@@ -2266,7 +2272,7 @@</span>         let (state_root, trie_output) = if let Some(result) = state_root_result {
             result
         } else {
             debug!(target: &quot;engine::tree&quot;, block=?sealed_block.num_hash(), persistence_in_progress, &quot;Failed to compute state root in parallel&quot;);
<span class="term-fg31">-            state_provider.state_root_with_updates(hashed_state.clone())?</span>
<span class="term-fg32">+            state_provider.state_root_from_state_with_updates(hashed_state.clone())?</span>
         };
&nbsp;
         if state_root != block.state_root {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ef93d77cbc733a345448ce2f" role="button"
                       aria-expanded="false" aria-controls="id-ef93d77cbc733a345448ce2f">
                        <code>crates/engine/tree/src/tree/root.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/tree/src/tree/root.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/engine/tree/src/tree/root.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+20</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ef93d77cbc733a345448ce2f"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;tree&#47;src&#47;tree&#47;root.rs scroll-reth&#47;crates&#47;engine&#47;tree&#47;src&#47;tree&#47;root.rs</span>
<span class="term-fg1">index 602e87a63dbeed2c1cc4c773186de59c221e1c97..2324276b9b27d4fff8c94a7978b190ba7481cde9 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;tree&#47;src&#47;tree&#47;root.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;tree&#47;src&#47;tree&#47;root.rs</span>
<span class="term-fg36">@@ -3,6 +3,7 @@</span>
 use alloy_primitives::map::{HashMap, HashSet};
 use reth_provider::{
     providers::ConsistentDbView, BlockReader, DBProvider, DatabaseProviderFactory,
<span class="term-fg32">+    StateCommitmentProvider,</span>
 };
 use reth_trie::{
     proof::Proof, updates::TrieUpdates, HashedPostState, HashedStorage, MultiProof, Nibbles,
<span class="term-fg36">@@ -176,7 +177,12 @@</span>
 #[allow(dead_code)]
 impl&lt;Factory&gt; StateRootTask&lt;Factory&gt;
 where
<span class="term-fg31">-    Factory: DatabaseProviderFactory&lt;Provider: BlockReader&gt; + Clone + Send + Sync + &#39;static,</span>
<span class="term-fg32">+    Factory: DatabaseProviderFactory&lt;Provider: BlockReader&gt;</span>
<span class="term-fg32">+        + StateCommitmentProvider</span>
<span class="term-fg32">+        + Clone</span>
<span class="term-fg32">+        + Send</span>
<span class="term-fg32">+        + Sync</span>
<span class="term-fg32">+        + &#39;static,</span>
 {
     &#47;&#47;&#47; Creates a new state root task with the unified message channel
     pub(crate) fn new(
<span class="term-fg36">@@ -226,7 +232,13 @@</span>             if account.is_touched() {
                 let hashed_address = keccak256(address);
&nbsp;
                 let destroyed = account.is_selfdestructed();
<span class="term-fg31">-                let info = if account.is_empty() { None } else { Some(account.info.into()) };</span>
<span class="term-fg32">+                let info = if account.is_empty() {</span>
<span class="term-fg32">+                    None</span>
<span class="term-fg32">+                } else {</span>
<span class="term-fg32">+                    &#47;&#47; TODO (scroll): once we transition to the sdk pattern, a solution</span>
<span class="term-fg32">+                    &#47;&#47; needs to be found for this.</span>
<span class="term-fg32">+                    Some(reth_primitives::Account::from_account_info(account.info))</span>
<span class="term-fg32">+                };</span>
                 hashed_state_update.accounts.insert(hashed_address, info);
&nbsp;
                 let mut changed_storage_iter = account
<span class="term-fg36">@@ -536,6 +548,7 @@</span> }
&nbsp;
 #[cfg(test)]
 mod tests {
<span class="term-fg32">+    #![allow(clippy::needless_update)]</span>
     use super::*;
     use reth_primitives::{Account as RethAccount, StorageEntry};
     use reth_provider::{
<span class="term-fg36">@@ -558,6 +571,10 @@</span>                 None
             } else {
                 Some(revm_account.info.code_hash)
             },
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: revm_account.info.code.as_ref().map(|code| {</span>
<span class="term-fg32">+                reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code.original_byte_slice())</span>
<span class="term-fg32">+            }),</span>
         }
     }
&nbsp;
<span class="term-fg36">@@ -590,6 +607,7 @@</span>                         balance: U256::from(rng.gen::&lt;u64&gt;()),
                         nonce: rng.gen::&lt;u64&gt;(),
                         code_hash: KECCAK_EMPTY,
                         code: Some(Default::default()),
<span class="term-fg32">+                        ..Default::default()</span>
                     },
                     storage,
                     status: AccountStatus::Touched,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fa7bb58ec4fb067b60427ebc" role="button"
                       aria-expanded="false" aria-controls="id-fa7bb58ec4fb067b60427ebc">
                        <code>crates/engine/util/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/util/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/engine/util/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fa7bb58ec4fb067b60427ebc"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;util&#47;Cargo.toml scroll-reth&#47;crates&#47;engine&#47;util&#47;Cargo.toml</span>
<span class="term-fg1">index 6eb22340ec100c5587d8bb43aeae8d01baa8463b..d7e89c400dfde400b5cddb31ac7b1b5284fc93df 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;util&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;util&#47;Cargo.toml</span>
<span class="term-fg36">@@ -31,6 +31,10 @@</span> alloy-primitives.workspace = true
 alloy-rpc-types-engine.workspace = true
 alloy-consensus.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # async
 tokio = { workspace = true, default-features = false }
 tokio-util.workspace = true
<span class="term-fg36">@@ -54,3 +58,4 @@</span>     &quot;reth-primitives&#47;optimism&quot;,
     &quot;reth-provider&#47;optimism&quot;,
     &quot;revm-primitives&#47;optimism&quot;,
 ]
<span class="term-fg32">+scroll = [&quot;reth-scroll-storage&#47;scroll&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c73da4fb13235fb8e46ccaf9" role="button"
                       aria-expanded="false" aria-controls="id-c73da4fb13235fb8e46ccaf9">
                        <code>crates/engine/util/src/reorg.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/engine/util/src/reorg.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/engine/util/src/reorg.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-11</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c73da4fb13235fb8e46ccaf9"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;util&#47;src&#47;reorg.rs scroll-reth&#47;crates&#47;engine&#47;util&#47;src&#47;reorg.rs</span>
<span class="term-fg1">index 20e2b21446ae3fcbf96ccd371a3ef51df18ff788..3af332b83b08d5c06bf46c0901d2a8e975ea7e9a 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;util&#47;src&#47;reorg.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;util&#47;src&#47;reorg.rs</span>
<span class="term-fg36">@@ -21,12 +21,11 @@</span> use reth_payload_validator::ExecutionPayloadValidator;
 use reth_primitives::{proofs, Block, BlockBody, BlockExt, Receipt, Receipts};
 use reth_provider::{BlockReader, ExecutionOutcome, ProviderError, StateProviderFactory};
 use reth_revm::{
<span class="term-fg31">-    database::StateProviderDatabase,</span>
     db::{states::bundle_state::BundleRetention, State},
     DatabaseCommit,
 };
 use reth_rpc_types_compat::engine::payload::block_to_payload;
<span class="term-fg31">-use reth_trie::HashedPostState;</span>
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use revm_primitives::{calc_excess_blob_gas, EVMError, EnvWithHandlerCfg};
 use std::{
     collections::VecDeque,
<span class="term-fg36">@@ -290,10 +289,11 @@</span>     debug!(target: &quot;engine::stream::reorg&quot;, number = reorg_target.number, hash = %previous_hash, &quot;Selected reorg target&quot;);
&nbsp;
     &#47;&#47; Configure state
     let state_provider = provider.state_by_block_hash(reorg_target.parent_hash)?;
<span class="term-fg31">-    let mut state = State::builder()</span>
<span class="term-fg31">-        .with_database_ref(StateProviderDatabase::new(&amp;state_provider))</span>
<span class="term-fg31">-        .with_bundle_update()</span>
<span class="term-fg31">-        .build();</span>
<span class="term-fg32">+    #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+    let mut db = reth_revm::database::StateProviderDatabase::new(&amp;state_provider);</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    let mut db = reth_scroll_storage::ScrollStateProviderDatabase::new(&amp;state_provider);</span>
<span class="term-fg32">+    let mut state = State::builder().with_database(&amp;mut db).with_bundle_update().build();</span>
&nbsp;
     &#47;&#47; Configure environments
     let (cfg, block_env) = evm_config.cfg_and_block_env(&amp;reorg_target.header, U256::MAX);
<span class="term-fg36">@@ -373,13 +373,13 @@</span>     &#47;&#47; merge all transitions into bundle state, this would apply the withdrawal balance changes
     &#47;&#47; and 4788 contract call
     state.merge_transitions(BundleRetention::PlainState);
&nbsp;
<span class="term-fg31">-    let outcome: ExecutionOutcome = ExecutionOutcome::new(</span>
<span class="term-fg31">-        state.take_bundle(),</span>
<span class="term-fg31">-        Receipts::from(vec![receipts]),</span>
<span class="term-fg32">+    let outcome = ExecutionOutcome::new(</span>
<span class="term-fg32">+        state.finalize(),</span>
<span class="term-fg32">+        Receipts::&lt;Receipt&gt;::from(vec![receipts]),</span>
         reorg_target.number,
         Default::default(),
     );
<span class="term-fg31">-    let hashed_state = HashedPostState::from_bundle_state(&amp;outcome.state().state);</span>
<span class="term-fg32">+    let hashed_state = state_provider.hashed_post_state(outcome.state());</span>
&nbsp;
     let (blob_gas_used, excess_blob_gas) =
         if chain_spec.is_cancun_active_at_timestamp(reorg_target.timestamp) {
<span class="term-fg36">@@ -419,7 +419,7 @@</span>             requests_hash: None, &#47;&#47; TODO(prague)
             gas_used: cumulative_gas_used,
             blob_gas_used: blob_gas_used.map(Into::into),
             excess_blob_gas: excess_blob_gas.map(Into::into),
<span class="term-fg31">-            state_root: state_provider.state_root(hashed_state)?,</span>
<span class="term-fg32">+            state_root: state_provider.state_root_from_state(hashed_state)?,</span>
         },
         body: BlockBody {
             transactions,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-82cbe643889933b70826c90b" role="button"
                       aria-expanded="false" aria-controls="id-82cbe643889933b70826c90b">
                        <code>crates/evm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/evm/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/evm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-82cbe643889933b70826c90b"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;Cargo.toml scroll-reth&#47;crates&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">index 9d6a616af983b45cbe24f43c186c145f8d3d73d7..155e54fa90d7c8f6d67592c065e10a5d6da93cde 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -24,8 +24,11 @@</span> reth-prune-types.workspace = true
 reth-revm.workspace = true
 reth-storage-errors.workspace = true
&nbsp;
<span class="term-fg32">+revm-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
 revm.workspace = true
<span class="term-fg31">-revm-primitives.workspace = true</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
&nbsp;
 # alloy
 alloy-primitives.workspace = true
<span class="term-fg36">@@ -66,5 +69,14 @@</span>     &quot;reth-primitives&#47;test-utils&quot;,
     &quot;reth-primitives-traits&#47;test-utils&quot;,
     &quot;reth-revm&#47;test-utils&quot;,
     &quot;revm&#47;test-utils&quot;,
<span class="term-fg31">-    &quot;reth-prune-types&#47;test-utils&quot;</span>
<span class="term-fg32">+    &quot;reth-prune-types&#47;test-utils&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-execution&#47;test-utils&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-execution&#47;scroll&quot;</span>
 ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8eac527f42f221f4dd80228d" role="button"
                       aria-expanded="false" aria-controls="id-8eac527f42f221f4dd80228d">
                        <code>crates/evm/execution-types/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/evm/execution-types/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/evm/execution-types/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8eac527f42f221f4dd80228d"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;execution-types&#47;Cargo.toml scroll-reth&#47;crates&#47;evm&#47;execution-types&#47;Cargo.toml</span>
<span class="term-fg1">index c7fbad673db1530d7d5c1a5db7bb7b3394fbc34c..9b5841f0d682fe0e7ec36ccf94ab6800820aed3c 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;execution-types&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;execution-types&#47;Cargo.toml</span>
<span class="term-fg36">@@ -65,3 +65,7 @@</span> 	&quot;serde?&#47;std&quot;,
 	&quot;reth-primitives-traits&#47;std&quot;,
     &quot;alloy-consensus&#47;std&quot;,
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-617d324ab86ca9b0f8171e75" role="button"
                       aria-expanded="false" aria-controls="id-617d324ab86ca9b0f8171e75">
                        <code>crates/evm/execution-types/src/chain.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/evm/execution-types/src/chain.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/evm/execution-types/src/chain.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-617d324ab86ca9b0f8171e75"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;chain.rs scroll-reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;chain.rs</span>
<span class="term-fg1">index 1767a7f43f6547e7b357854085189b82d4984151..143f8c31284776e308a6c6b71bf39a5a675db7a8 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;chain.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;chain.rs</span>
<span class="term-fg36">@@ -824,6 +824,8 @@</span>             tx_type: TxType::Legacy,
             cumulative_gas_used: 46913,
             logs: vec![],
             success: true,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            l1_fee: alloy_primitives::U256::ZERO,</span>
         };
&nbsp;
         &#47;&#47; Create another random receipt object, receipt2
<span class="term-fg36">@@ -832,6 +834,8 @@</span>             tx_type: TxType::Legacy,
             cumulative_gas_used: 1325345,
             logs: vec![],
             success: true,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            l1_fee: alloy_primitives::U256::ZERO,</span>
         };
&nbsp;
         &#47;&#47; Create a Receipts object with a vector of receipt vectors</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a61a8d84c9ad0eb5dcda046a" role="button"
                       aria-expanded="false" aria-controls="id-a61a8d84c9ad0eb5dcda046a">
                        <code>crates/evm/execution-types/src/execution_outcome.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/evm/execution-types/src/execution_outcome.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/evm/execution-types/src/execution_outcome.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+41</span></div>
                            <div class="text-start"><span class="text-danger">-7</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a61a8d84c9ad0eb5dcda046a"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;execution_outcome.rs scroll-reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;execution_outcome.rs</span>
<span class="term-fg1">index 412269ace9cd47214526a8ad5cdebb11d045318e..6c8240d2d5cfc89d5ba6f6fc4f69bdc075f8466f 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;execution_outcome.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;execution_outcome.rs</span>
<span class="term-fg36">@@ -4,7 +4,7 @@</span> use alloy_eips::eip7685::Requests;
 use alloy_primitives::{Address, BlockNumber, Bloom, Log, B256, U256};
 use reth_primitives::{logs_bloom, Account, Bytecode, Receipts, StorageEntry};
 use reth_primitives_traits::{receipt::ReceiptExt, Receipt};
<span class="term-fg31">-use reth_trie::HashedPostState;</span>
<span class="term-fg32">+use reth_trie::{HashedPostState, KeyHasher};</span>
 use revm::{
     db::{states::BundleState, BundleAccount},
     primitives::AccountInfo,
<span class="term-fg36">@@ -166,8 +166,8 @@</span>     }
&nbsp;
     &#47;&#47;&#47; Returns [`HashedPostState`] for this execution outcome.
     &#47;&#47;&#47; See [`HashedPostState::from_bundle_state`] for more info.
<span class="term-fg31">-    pub fn hash_state_slow(&amp;self) -&gt; HashedPostState {</span>
<span class="term-fg31">-        HashedPostState::from_bundle_state(&amp;self.bundle.state)</span>
<span class="term-fg32">+    pub fn hash_state_slow&lt;KH: KeyHasher&gt;(&amp;self) -&gt; HashedPostState {</span>
<span class="term-fg32">+        HashedPostState::from_bundle_state::&lt;KH&gt;(&amp;self.bundle.state)</span>
     }
&nbsp;
     &#47;&#47;&#47; Transform block number to the index of block.
<span class="term-fg36">@@ -398,6 +398,8 @@</span>                 tx_type: TxType::Legacy,
                 cumulative_gas_used: 46913,
                 logs: vec![],
                 success: true,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             })]],
         };
&nbsp;
<span class="term-fg36">@@ -460,6 +462,8 @@</span>                 tx_type: TxType::Legacy,
                 cumulative_gas_used: 46913,
                 logs: vec![],
                 success: true,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             })]],
         };
&nbsp;
<span class="term-fg36">@@ -495,6 +499,8 @@</span>                 tx_type: TxType::Legacy,
                 cumulative_gas_used: 46913,
                 logs: vec![Log::&lt;LogData&gt;::default()],
                 success: true,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             })]],
         };
&nbsp;
<span class="term-fg36">@@ -527,6 +533,8 @@</span>                 tx_type: TxType::Legacy,
                 cumulative_gas_used: 46913,
                 logs: vec![Log::&lt;LogData&gt;::default()],
                 success: true,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             })]],
         };
&nbsp;
<span class="term-fg36">@@ -553,6 +561,8 @@</span>                 tx_type: TxType::Legacy,
                 cumulative_gas_used: 46913,
                 logs: vec![Log::&lt;LogData&gt;::default()],
                 success: true,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             })]
         );
     }
<span class="term-fg36">@@ -567,6 +577,8 @@</span>                 tx_type: TxType::Legacy,
                 cumulative_gas_used: 46913,
                 logs: vec![Log::&lt;LogData&gt;::default()],
                 success: true,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                l1_fee: U256::ZERO,</span>
             })]],
         };
&nbsp;
<span class="term-fg36">@@ -615,6 +627,8 @@</span>             tx_type: TxType::Legacy,
             cumulative_gas_used: 46913,
             logs: vec![],
             success: true,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            l1_fee: U256::ZERO,</span>
         };
&nbsp;
         &#47;&#47; Create a Receipts object with a vector of receipt vectors
<span class="term-fg36">@@ -664,6 +678,8 @@</span>             tx_type: TxType::Legacy,
             cumulative_gas_used: 46913,
             logs: vec![],
             success: true,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            l1_fee: U256::ZERO,</span>
         };
&nbsp;
         &#47;&#47; Create a Receipts object containing the receipt.
<span class="term-fg36">@@ -708,6 +724,8 @@</span>             tx_type: TxType::Legacy,
             cumulative_gas_used: 46913,
             logs: vec![],
             success: true,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            l1_fee: U256::ZERO,</span>
         };
&nbsp;
         &#47;&#47; Create a Receipts object with a vector of receipt vectors
<span class="term-fg36">@@ -774,10 +792,26 @@</span>         let address2 = Address::random();
         let address3 = Address::random();
&nbsp;
         &#47;&#47; Set up account info with some changes
<span class="term-fg31">-        let account_info1 =</span>
<span class="term-fg31">-            AccountInfo { nonce: 1, balance: U256::from(100), code_hash: B256::ZERO, code: None };</span>
<span class="term-fg31">-        let account_info2 =</span>
<span class="term-fg31">-            AccountInfo { nonce: 2, balance: U256::from(200), code_hash: B256::ZERO, code: None };</span>
<span class="term-fg32">+        let account_info1 = AccountInfo {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(100),</span>
<span class="term-fg32">+            code_hash: B256::ZERO,</span>
<span class="term-fg32">+            code: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: 0,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: B256::ZERO,</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let account_info2 = AccountInfo {</span>
<span class="term-fg32">+            nonce: 2,</span>
<span class="term-fg32">+            balance: U256::from(200),</span>
<span class="term-fg32">+            code_hash: B256::ZERO,</span>
<span class="term-fg32">+            code: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: 0,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: B256::ZERO,</span>
<span class="term-fg32">+        };</span>
&nbsp;
         &#47;&#47; Set up the bundle state with these accounts
         let mut bundle_state = BundleState::default();</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9867465f478f155ea609abf1" role="button"
                       aria-expanded="false" aria-controls="id-9867465f478f155ea609abf1">
                        <code>crates/evm/src/either.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/evm/src/either.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/evm/src/either.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9867465f478f155ea609abf1"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;src&#47;either.rs scroll-reth&#47;crates&#47;evm&#47;src&#47;either.rs</span>
<span class="term-fg1">index 85bc7e7f9a79fa2790c39445a2c1a3c821edf705..167a89dc42d4f317b53822de8cd487c15658f273 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;src&#47;either.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;src&#47;either.rs</span>
<span class="term-fg36">@@ -12,27 +12,33 @@</span> use reth_execution_errors::BlockExecutionError;
 use reth_execution_types::{BlockExecutionInput, BlockExecutionOutput, ExecutionOutcome};
 use reth_primitives::{BlockWithSenders, Receipt};
 use reth_prune_types::PruneModes;
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use reth_storage_errors::provider::ProviderError;
<span class="term-fg32">+use revm::{db::BundleState, State};</span>
 use revm_primitives::db::Database;
&nbsp;
 &#47;&#47; re-export Either
 pub use futures_util::future::Either;
<span class="term-fg31">-use revm::State;</span>
&nbsp;
 impl&lt;A, B&gt; BlockExecutorProvider for Either&lt;A, B&gt;
 where
     A: BlockExecutorProvider,
     B: BlockExecutorProvider,
 {
<span class="term-fg31">-    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        Either&lt;A::Executor&lt;DB&gt;, B::Executor&lt;DB&gt;&gt;;</span>
<span class="term-fg32">+    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Either&lt;A::Executor&lt;DB&gt;, B::Executor&lt;DB&gt;&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
<span class="term-fg31">-    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        Either&lt;A::BatchExecutor&lt;DB&gt;, B::BatchExecutor&lt;DB&gt;&gt;;</span>
<span class="term-fg32">+    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Either&lt;A::BatchExecutor&lt;DB&gt;, B::BatchExecutor&lt;DB&gt;&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Executor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         match self {
             Self::Left(a) =&gt; Either::Left(a.executor(db)),
<span class="term-fg36">@@ -43,6 +49,7 @@</span>
     fn batch_executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         match self {
             Self::Left(a) =&gt; Either::Left(a.batch_executor(db)),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-38f48040fedb46cbf9448357" role="button"
                       aria-expanded="false" aria-controls="id-38f48040fedb46cbf9448357">
                        <code>crates/evm/src/execute.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/evm/src/execute.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/evm/src/execute.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+51</span></div>
                            <div class="text-start"><span class="text-danger">-16</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-38f48040fedb46cbf9448357"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;src&#47;execute.rs scroll-reth&#47;crates&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">index 42c756f4d93f9dae6f6ee62fce8a18cc9982d28e..1e157b83bf1c2c500053eecf0d094fc539005b41 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg36">@@ -16,6 +16,7 @@</span> use reth_consensus::ConsensusError;
 use reth_primitives::{BlockWithSenders, Receipt};
 use reth_prune_types::PruneModes;
 use reth_revm::batch::BlockBatchRecord;
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use revm::{
     db::{states::bundle_state::BundleRetention, BundleState},
     State,
<span class="term-fg36">@@ -146,7 +147,9 @@</span>         DB,
         Input&lt;&#39;a&gt; = BlockExecutionInput&lt;&#39;a, BlockWithSenders&gt;,
         Output = BlockExecutionOutput&lt;Receipt&gt;,
         Error = BlockExecutionError,
<span class="term-fg31">-    &gt;;</span>
<span class="term-fg32">+    &gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     &#47;&#47;&#47; An executor that can execute a batch of blocks given a database.
     type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;: for&lt;&#39;a&gt; BatchExecutor&lt;
<span class="term-fg36">@@ -154,14 +157,17 @@</span>         DB,
         Input&lt;&#39;a&gt; = BlockExecutionInput&lt;&#39;a, BlockWithSenders&gt;,
         Output = ExecutionOutcome,
         Error = BlockExecutionError,
<span class="term-fg31">-    &gt;;</span>
<span class="term-fg32">+    &gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     &#47;&#47;&#47; Creates a new executor for single block execution.
     &#47;&#47;&#47;
     &#47;&#47;&#47; This is used to execute a single block and get the changed state.
     fn executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Executor&lt;DB&gt;
     where
<span class="term-fg31">-        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;;</span>
<span class="term-fg32">+        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     &#47;&#47;&#47; Creates a new batch executor with the given database and pruning modes.
     &#47;&#47;&#47;
<span class="term-fg36">@@ -169,7 +175,8 @@</span>     &#47;&#47;&#47; Batch executor is used to execute multiple blocks in sequence and keep track of the state
     &#47;&#47;&#47; during historical sync which involves executing multiple blocks in sequence.
     fn batch_executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
     where
<span class="term-fg31">-        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;;</span>
<span class="term-fg32">+        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
 }
&nbsp;
 &#47;&#47;&#47; Helper type for the output of executing a block.
<span class="term-fg36">@@ -185,6 +192,7 @@</span> &#47;&#47;&#47; Defines the strategy for executing a single block.
 pub trait BlockExecutionStrategy&lt;DB&gt;
 where
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; The error type returned by this strategy&#39;s methods.
     type Error: From&lt;ProviderError&gt; + core::error::Error;
<span class="term-fg36">@@ -226,7 +234,7 @@</span>
     &#47;&#47;&#47; Returns the final bundle state.
     fn finish(&amp;mut self) -&gt; BundleState {
         self.state_mut().merge_transitions(BundleRetention::Reverts);
<span class="term-fg31">-        self.state_mut().take_bundle()</span>
<span class="term-fg32">+        self.state_mut().finalize()</span>
     }
&nbsp;
     &#47;&#47;&#47; Validate a block with regard to execution results.
<span class="term-fg36">@@ -246,12 +254,15 @@</span>     &#47;&#47;&#47; Associated strategy type.
     type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;: BlockExecutionStrategy&lt;
         DB,
         Error = BlockExecutionError,
<span class="term-fg31">-    &gt;;</span>
<span class="term-fg32">+    &gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     &#47;&#47;&#47; Creates a strategy using the give database.
     fn create_strategy&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Strategy&lt;DB&gt;
     where
<span class="term-fg31">-        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;;</span>
<span class="term-fg32">+        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
 }
&nbsp;
 impl&lt;F&gt; Clone for BasicBlockExecutorProvider&lt;F&gt;
<span class="term-fg36">@@ -280,15 +291,20 @@</span> impl&lt;F&gt; BlockExecutorProvider for BasicBlockExecutorProvider&lt;F&gt;
 where
     F: BlockExecutionStrategyFactory,
 {
<span class="term-fg31">-    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        BasicBlockExecutor&lt;F::Strategy&lt;DB&gt;, DB&gt;;</span>
<span class="term-fg32">+    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = BasicBlockExecutor&lt;F::Strategy&lt;DB&gt;, DB&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
<span class="term-fg31">-    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        BasicBatchExecutor&lt;F::Strategy&lt;DB&gt;, DB&gt;;</span>
<span class="term-fg32">+    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = BasicBatchExecutor&lt;F::Strategy&lt;DB&gt;, DB&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Executor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         let strategy = self.strategy_factory.create_strategy(db);
         BasicBlockExecutor::new(strategy)
<span class="term-fg36">@@ -297,6 +313,7 @@</span>
     fn batch_executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         let strategy = self.strategy_factory.create_strategy(db);
         let batch_record = BlockBatchRecord::default();
<span class="term-fg36">@@ -311,6 +328,7 @@</span> pub struct BasicBlockExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Block execution strategy.
     pub(crate) strategy: S,
<span class="term-fg36">@@ -321,6 +339,7 @@</span> impl&lt;S, DB&gt; BasicBlockExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Creates a new `BasicBlockExecutor` with the given strategy.
     pub const fn new(strategy: S) -&gt; Self {
<span class="term-fg36">@@ -332,6 +351,7 @@</span> impl&lt;S, DB&gt; Executor&lt;DB&gt; for BasicBlockExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     type Input&lt;&#39;a&gt; = BlockExecutionInput&lt;&#39;a, BlockWithSenders&gt;;
     type Output = BlockExecutionOutput&lt;Receipt&gt;;
<span class="term-fg36">@@ -408,6 +428,7 @@</span> pub struct BasicBatchExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Batch execution strategy.
     pub(crate) strategy: S,
<span class="term-fg36">@@ -420,6 +441,7 @@</span> impl&lt;S, DB&gt; BasicBatchExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Creates a new `BasicBatchExecutor` with the given strategy.
     pub const fn new(strategy: S, batch_record: BlockBatchRecord) -&gt; Self {
<span class="term-fg36">@@ -431,6 +453,7 @@</span> impl&lt;S, DB&gt; BatchExecutor&lt;DB&gt; for BasicBatchExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB, Error = BlockExecutionError&gt;,
     DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     type Input&lt;&#39;a&gt; = BlockExecutionInput&lt;&#39;a, BlockWithSenders&gt;;
     type Output = ExecutionOutcome;
<span class="term-fg36">@@ -466,7 +489,7 @@</span>     }
&nbsp;
     fn finalize(mut self) -&gt; Self::Output {
         ExecutionOutcome::new(
<span class="term-fg31">-            self.strategy.state_mut().take_bundle(),</span>
<span class="term-fg32">+            self.strategy.state_mut().finalize(),</span>
             self.batch_record.take_receipts(),
             self.batch_record.first_block().unwrap_or_default(),
             self.batch_record.take_requests(),
<span class="term-fg36">@@ -499,12 +522,19 @@</span>     #[derive(Clone, Default)]
     struct TestExecutorProvider;
&nbsp;
     impl BlockExecutorProvider for TestExecutorProvider {
<span class="term-fg31">-        type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = TestExecutor&lt;DB&gt;;</span>
<span class="term-fg31">-        type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = TestExecutor&lt;DB&gt;;</span>
<span class="term-fg32">+        type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+            = TestExecutor&lt;DB&gt;</span>
<span class="term-fg32">+        where</span>
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
<span class="term-fg32">+        type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+            = TestExecutor&lt;DB&gt;</span>
<span class="term-fg32">+        where</span>
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
         fn executor&lt;DB&gt;(&amp;self, _db: DB) -&gt; Self::Executor&lt;DB&gt;
         where
             DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
         {
             TestExecutor(PhantomData)
         }
<span class="term-fg36">@@ -512,6 +542,7 @@</span>
         fn batch_executor&lt;DB&gt;(&amp;self, _db: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
         where
             DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
         {
             TestExecutor(PhantomData)
         }
<span class="term-fg36">@@ -596,12 +627,15 @@</span>         finish_result: BundleState,
     }
&nbsp;
     impl BlockExecutionStrategyFactory for TestExecutorStrategyFactory {
<span class="term-fg31">-        type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-            TestExecutorStrategy&lt;DB, TestEvmConfig&gt;;</span>
<span class="term-fg32">+        type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+            = TestExecutorStrategy&lt;DB, TestEvmConfig&gt;</span>
<span class="term-fg32">+        where</span>
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
         fn create_strategy&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Strategy&lt;DB&gt;
         where
             DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
         {
             let state = State::builder()
                 .with_database(db)
<span class="term-fg36">@@ -625,6 +659,7 @@</span>
     impl&lt;DB&gt; BlockExecutionStrategy&lt;DB&gt; for TestExecutorStrategy&lt;DB, TestEvmConfig&gt;
     where
         DB: Database,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         type Error = BlockExecutionError;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5c0a8ec6510eea2aaacd98c7" role="button"
                       aria-expanded="false" aria-controls="id-5c0a8ec6510eea2aaacd98c7">
                        <code>crates/evm/src/metrics.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/evm/src/metrics.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/evm/src/metrics.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5c0a8ec6510eea2aaacd98c7"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;src&#47;metrics.rs scroll-reth&#47;crates&#47;evm&#47;src&#47;metrics.rs</span>
<span class="term-fg1">index 3464bb96f4c7da9da041f9d74ace8f37d709bf12..6f1b0cab47ccef6dfea2fbaf09a12c00ea4a0e04 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;src&#47;metrics.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;src&#47;metrics.rs</span>
<span class="term-fg36">@@ -143,6 +143,7 @@</span> }
&nbsp;
 #[cfg(test)]
 mod tests {
<span class="term-fg32">+    #![allow(clippy::needless_update)]</span>
     use super::*;
     use alloy_eips::eip7685::Requests;
     use metrics_util::debugging::{DebugValue, DebuggingRecorder, Snapshotter};
<span class="term-fg36">@@ -261,6 +262,7 @@</span>                             balance: U256::from(100),
                             nonce: 10,
                             code_hash: B256::random(),
                             code: Default::default(),
<span class="term-fg32">+                            ..Default::default()</span>
                         },
                         storage,
                         status: AccountStatus::Loaded,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-376bb5b4ce97eda1cad1d452" role="button"
                       aria-expanded="false" aria-controls="id-376bb5b4ce97eda1cad1d452">
                        <code>crates/evm/src/noop.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/evm/src/noop.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/evm/src/noop.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-376bb5b4ce97eda1cad1d452"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;src&#47;noop.rs scroll-reth&#47;crates&#47;evm&#47;src&#47;noop.rs</span>
<span class="term-fg1">index 4fdc6d367a2771a7c2b7f8adab1cc1dc1ad6fb8c..c0ad60b7fc2b9bcd9e52338d7486086147b8c754 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;src&#47;noop.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;src&#47;noop.rs</span>
<span class="term-fg36">@@ -6,8 +6,9 @@</span> use reth_execution_errors::BlockExecutionError;
 use reth_execution_types::{BlockExecutionInput, BlockExecutionOutput, ExecutionOutcome};
 use reth_primitives::{BlockWithSenders, Receipt};
 use reth_prune_types::PruneModes;
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use reth_storage_errors::provider::ProviderError;
<span class="term-fg31">-use revm::State;</span>
<span class="term-fg32">+use revm::{db::BundleState, State};</span>
 use revm_primitives::db::Database;
&nbsp;
 use crate::{
<span class="term-fg36">@@ -23,13 +24,20 @@</span> #[non_exhaustive]
 pub struct NoopBlockExecutorProvider;
&nbsp;
 impl BlockExecutorProvider for NoopBlockExecutorProvider {
<span class="term-fg31">-    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = Self;</span>
<span class="term-fg32">+    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
<span class="term-fg31">-    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = Self;</span>
<span class="term-fg32">+    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn executor&lt;DB&gt;(&amp;self, _: DB) -&gt; Self::Executor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         Self
     }
<span class="term-fg36">@@ -37,6 +45,7 @@</span>
     fn batch_executor&lt;DB&gt;(&amp;self, _: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         Self
     }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-da9f5642b45335986d071fdc" role="button"
                       aria-expanded="false" aria-controls="id-da9f5642b45335986d071fdc">
                        <code>crates/evm/src/test_utils.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/evm/src/test_utils.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/evm/src/test_utils.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-da9f5642b45335986d071fdc"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;src&#47;test_utils.rs scroll-reth&#47;crates&#47;evm&#47;src&#47;test_utils.rs</span>
<span class="term-fg1">index a4dc906494ce1f13499495c4e8b4b74a95fae11f..b3f338fa856e7f074f68837fe0308fce961d6353 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;src&#47;test_utils.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;src&#47;test_utils.rs</span>
<span class="term-fg36">@@ -14,8 +14,9 @@</span> use reth_execution_errors::BlockExecutionError;
 use reth_execution_types::ExecutionOutcome;
 use reth_primitives::{BlockWithSenders, Receipt, Receipts};
 use reth_prune_types::PruneModes;
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use reth_storage_errors::provider::ProviderError;
<span class="term-fg31">-use revm::State;</span>
<span class="term-fg32">+use revm::{db::BundleState, State};</span>
 use revm_primitives::db::Database;
 use std::{fmt::Display, sync::Arc};
&nbsp;
<span class="term-fg36">@@ -33,13 +34,20 @@</span>     }
 }
&nbsp;
 impl BlockExecutorProvider for MockExecutorProvider {
<span class="term-fg31">-    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = Self;</span>
<span class="term-fg32">+    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
<span class="term-fg31">-    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = Self;</span>
<span class="term-fg32">+    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn executor&lt;DB&gt;(&amp;self, _: DB) -&gt; Self::Executor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         self.clone()
     }
<span class="term-fg36">@@ -47,6 +55,7 @@</span>
     fn batch_executor&lt;DB&gt;(&amp;self, _: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         self.clone()
     }
<span class="term-fg36">@@ -120,6 +129,7 @@</span> impl&lt;S, DB&gt; BasicBlockExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Provides safe read access to the state
     pub fn with_state&lt;F, R&gt;(&amp;self, f: F) -&gt; R
<span class="term-fg36">@@ -142,6 +152,7 @@</span> impl&lt;S, DB&gt; BasicBatchExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Provides safe read access to the state
     pub fn with_state&lt;F, R&gt;(&amp;self, f: F) -&gt; R</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8700a3928b7411088b23386e" role="button"
                       aria-expanded="false" aria-controls="id-8700a3928b7411088b23386e">
                        <code>crates/exex/exex/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/exex/exex/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/exex/exex/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+17</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8700a3928b7411088b23386e"><span class="term-fg1">diff --git reth&#47;crates&#47;exex&#47;exex&#47;Cargo.toml scroll-reth&#47;crates&#47;exex&#47;exex&#47;Cargo.toml</span>
<span class="term-fg1">index b70fb921599efb66fb1858760c88678598d5cc1e..705f216c12aacbc2ef5b81468a22f1c0fd880a70 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;exex&#47;exex&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;exex&#47;exex&#47;Cargo.toml</span>
<span class="term-fg36">@@ -34,6 +34,9 @@</span> reth-stages-api.workspace = true
 reth-tasks.workspace = true
 reth-tracing.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # alloy
 alloy-consensus.workspace = true
 alloy-primitives.workspace = true
<span class="term-fg36">@@ -82,3 +85,17 @@</span> 	&quot;rand&#47;serde&quot;,
 	&quot;secp256k1&#47;serde&quot;,
 	&quot;reth-primitives-traits&#47;serde&quot;,
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-node-core&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-evm-ethereum&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-testing-utils&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-node-api&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-blockchain-tree&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-db-common&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-storage&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-16ac8feb7496d21e04b85025" role="button"
                       aria-expanded="false" aria-controls="id-16ac8feb7496d21e04b85025">
                        <code>crates/exex/exex/src/backfill/job.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/exex/exex/src/backfill/job.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/exex/exex/src/backfill/job.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+15</span></div>
                            <div class="text-start"><span class="text-danger">-6</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-16ac8feb7496d21e04b85025"><span class="term-fg1">diff --git reth&#47;crates&#47;exex&#47;exex&#47;src&#47;backfill&#47;job.rs scroll-reth&#47;crates&#47;exex&#47;exex&#47;src&#47;backfill&#47;job.rs</span>
<span class="term-fg1">index 7e670620472c3f1842089904e36acfad56e7e100..d3a3c0167627d5327bf892c21635f9b24cc16a2f 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;exex&#47;exex&#47;src&#47;backfill&#47;job.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;exex&#47;exex&#47;src&#47;backfill&#47;job.rs</span>
<span class="term-fg36">@@ -16,7 +16,6 @@</span> use reth_provider::{
     BlockReader, Chain, HeaderProvider, ProviderError, StateProviderFactory, TransactionVariant,
 };
 use reth_prune_types::PruneModes;
<span class="term-fg31">-use reth_revm::database::StateProviderDatabase;</span>
 use reth_stages_api::ExecutionStageThresholds;
 use reth_tracing::tracing::{debug, trace};
&nbsp;
<span class="term-fg36">@@ -78,9 +77,15 @@</span>             range = ?self.range,
             &quot;Executing block range&quot;
         );
&nbsp;
<span class="term-fg31">-        let mut executor = self.executor.batch_executor(StateProviderDatabase::new(</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let db = reth_revm::database::StateProviderDatabase::new(</span>
             self.provider.history_by_block_number(self.range.start().saturating_sub(1))?,
<span class="term-fg31">-        ));</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let db = reth_scroll_storage::ScrollStateProviderDatabase::new(</span>
<span class="term-fg32">+            self.provider.history_by_block_number(self.range.start().saturating_sub(1))?,</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+        let mut executor = self.executor.batch_executor(db);</span>
         executor.set_prune_modes(self.prune_modes.clone());
&nbsp;
         let mut fetch_block_duration = Duration::default();
<span class="term-fg36">@@ -207,9 +212,13 @@</span>             .block_with_senders(block_number.into(), TransactionVariant::WithHash)?
             .ok_or_else(|| ProviderError::HeaderNotFound(block_number.into()))?;
&nbsp;
         &#47;&#47; Configure the executor to use the previous block&#39;s state.
<span class="term-fg31">-        let executor = self.executor.executor(StateProviderDatabase::new(</span>
<span class="term-fg31">-            self.provider.history_by_block_number(block_number.saturating_sub(1))?,</span>
<span class="term-fg31">-        ));</span>
<span class="term-fg32">+        let provider = self.provider.history_by_block_number(block_number.saturating_sub(1))?;</span>
<span class="term-fg32">+        &#47;&#47; TODO(scroll): remove once issue #76 is completed.</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let db = reth_scroll_storage::ScrollStateProviderDatabase::new(provider);</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let db = reth_revm::database::StateProviderDatabase::new(provider);</span>
<span class="term-fg32">+        let executor = self.executor.executor(db);</span>
&nbsp;
         trace!(target: &quot;exex::backfill&quot;, number = block_number, txs = block_with_senders.block.body().transactions().len(), &quot;Executing block&quot;);
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-32771a381d34f5245480d7bc" role="button"
                       aria-expanded="false" aria-controls="id-32771a381d34f5245480d7bc">
                        <code>crates/exex/exex/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/exex/exex/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/exex/exex/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-32771a381d34f5245480d7bc"><span class="term-fg1">diff --git reth&#47;crates&#47;exex&#47;exex&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;exex&#47;exex&#47;src&#47;lib.rs</span>
<span class="term-fg1">index ce6641ff673414a1346e41fa63ef60aa9c862835..3b463962ce3b77722fbbac5c1553cdc2b3865925 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;exex&#47;exex&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;exex&#47;exex&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -34,6 +34,8 @@</span> )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
&nbsp;
<span class="term-fg32">+use reth_revm as _;</span>
<span class="term-fg32">+</span>
 mod backfill;
 pub use backfill::*;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b57108d963b5d92f82f42fff" role="button"
                       aria-expanded="false" aria-controls="id-b57108d963b5d92f82f42fff">
                        <code>crates/exex/test-utils/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/exex/test-utils/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/exex/test-utils/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b57108d963b5d92f82f42fff"><span class="term-fg1">diff --git reth&#47;crates&#47;exex&#47;test-utils&#47;Cargo.toml scroll-reth&#47;crates&#47;exex&#47;test-utils&#47;Cargo.toml</span>
<span class="term-fg1">index 6e5af981b31742fb8f31d2bed052e5441cb33dff..56701b7ebb272da1ddf94b7e7f0bf6ebd14bee46 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;exex&#47;test-utils&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;exex&#47;test-utils&#47;Cargo.toml</span>
<span class="term-fg36">@@ -45,3 +45,6 @@</span> eyre.workspace = true
 rand.workspace = true
 tempfile.workspace = true
 thiserror.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-68d246599e706093ffb5968d" role="button"
                       aria-expanded="false" aria-controls="id-68d246599e706093ffb5968d">
                        <code>crates/exex/test-utils/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/exex/test-utils/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/exex/test-utils/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-68d246599e706093ffb5968d"><span class="term-fg1">diff --git reth&#47;crates&#47;exex&#47;test-utils&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;exex&#47;test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg1">index ca0ea46551c5fa60cb6b87da62a5cad43dd84af9..ddd363712e04f03915fd978cb2edce5976294e68 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;exex&#47;test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;exex&#47;test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -7,6 +7,9 @@</span>     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use std::{
     fmt::Debug,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d1a083bfd1d0fe046f8caae7" role="button"
                       aria-expanded="false" aria-controls="id-d1a083bfd1d0fe046f8caae7">
                        <code>crates/net/dns/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/net/dns/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/net/dns/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d1a083bfd1d0fe046f8caae7"><span class="term-fg1">diff --git reth&#47;crates&#47;net&#47;dns&#47;Cargo.toml scroll-reth&#47;crates&#47;net&#47;dns&#47;Cargo.toml</span>
<span class="term-fg1">index a52f650574436b68b7df45d3d35d103cfbeb973a..1c3e298413f0aca0223961a893061e27a7cbb76e 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;net&#47;dns&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;net&#47;dns&#47;Cargo.toml</span>
<span class="term-fg36">@@ -27,7 +27,7 @@</span> tokio = { workspace = true, features = [&quot;io-util&quot;, &quot;net&quot;, &quot;time&quot;] }
 tokio-stream.workspace = true
&nbsp;
 # trust-dns
<span class="term-fg31">-trust-dns-resolver = &quot;0.23&quot;</span>
<span class="term-fg32">+hickory-resolver = { version = &quot;0.25.0-alpha.4&quot; }</span>
&nbsp;
 # misc
 data-encoding = &quot;2&quot;
<span class="term-fg36">@@ -58,5 +58,5 @@</span> 	&quot;linked_hash_set&#47;serde&quot;,
 	&quot;parking_lot&#47;serde&quot;,
 	&quot;rand&#47;serde&quot;,
 	&quot;secp256k1&#47;serde&quot;,
<span class="term-fg31">-	&quot;trust-dns-resolver&#47;serde&quot;</span>
<span class="term-fg32">+	&quot;hickory-resolver&#47;serde&quot;</span>
 ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-85c7d19cfe17cd13a66d006a" role="button"
                       aria-expanded="false" aria-controls="id-85c7d19cfe17cd13a66d006a">
                        <code>crates/net/dns/src/resolver.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/net/dns/src/resolver.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/net/dns/src/resolver.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+9</span></div>
                            <div class="text-start"><span class="text-danger">-9</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-85c7d19cfe17cd13a66d006a"><span class="term-fg1">diff --git reth&#47;crates&#47;net&#47;dns&#47;src&#47;resolver.rs scroll-reth&#47;crates&#47;net&#47;dns&#47;src&#47;resolver.rs</span>
<span class="term-fg1">index 42c444f89a75fb7d5ee1ae6ce79deee267cd28b3..eec3ea2a23d2ec6c5805af15dbdbeebea2482a45 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;net&#47;dns&#47;src&#47;resolver.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;net&#47;dns&#47;src&#47;resolver.rs</span>
<span class="term-fg36">@@ -1,10 +1,10 @@</span>
 &#47;&#47;! Perform DNS lookups
&nbsp;
<span class="term-fg32">+use hickory_resolver::name_server::ConnectionProvider;</span>
<span class="term-fg32">+pub use hickory_resolver::{ResolveError, TokioResolver};</span>
 use parking_lot::RwLock;
 use std::{collections::HashMap, future::Future};
 use tracing::trace;
<span class="term-fg31">-pub use trust_dns_resolver::{error::ResolveError, TokioAsyncResolver};</span>
<span class="term-fg31">-use trust_dns_resolver::{name_server::ConnectionProvider, AsyncResolver};</span>
&nbsp;
 &#47;&#47;&#47; A type that can lookup DNS entries
 pub trait Resolver: Send + Sync + Unpin + &#39;static {
<span class="term-fg36">@@ -12,7 +12,7 @@</span>     &#47;&#47;&#47; Performs a textual lookup and returns the first text
     fn lookup_txt(&amp;self, query: &amp;str) -&gt; impl Future&lt;Output = Option&lt;String&gt;&gt; + Send;
 }
&nbsp;
<span class="term-fg31">-impl&lt;P: ConnectionProvider&gt; Resolver for AsyncResolver&lt;P&gt; {</span>
<span class="term-fg32">+impl&lt;P: ConnectionProvider&gt; Resolver for hickory_resolver::Resolver&lt;P&gt; {</span>
     async fn lookup_txt(&amp;self, query: &amp;str) -&gt; Option&lt;String&gt; {
         &#47;&#47; See: [AsyncResolver::txt_lookup]
         &#47;&#47; &gt; *hint* queries that end with a &#39;.&#39; are fully qualified names and are cheaper lookups
<span class="term-fg36">@@ -33,7 +33,7 @@</span> }
&nbsp;
 &#47;&#47;&#47; An asynchronous DNS resolver
 &#47;&#47;&#47;
<span class="term-fg31">-&#47;&#47;&#47; See also [`TokioAsyncResolver`]</span>
<span class="term-fg32">+&#47;&#47;&#47; See also [`TokioResolver`]</span>
 &#47;&#47;&#47;
 &#47;&#47;&#47; ```
 &#47;&#47;&#47; # fn t() {
<span class="term-fg36">@@ -43,16 +43,16 @@</span> &#47;&#47;&#47; # }
 &#47;&#47;&#47; ```
 &#47;&#47;&#47;
 &#47;&#47;&#47; Note: This [Resolver] can send multiple lookup attempts, See also
<span class="term-fg31">-&#47;&#47;&#47; [`ResolverOpts`](trust_dns_resolver::config::ResolverOpts) which configures 2 attempts (1 retry)</span>
<span class="term-fg32">+&#47;&#47;&#47; [`ResolverOpts`](hickory_resolver::config::ResolverOpts) which configures 2 attempts (1 retry)</span>
 &#47;&#47;&#47; by default.
 #[derive(Clone, Debug)]
<span class="term-fg31">-pub struct DnsResolver(TokioAsyncResolver);</span>
<span class="term-fg32">+pub struct DnsResolver(TokioResolver);</span>
&nbsp;
 &#47;&#47; === impl DnsResolver ===
&nbsp;
 impl DnsResolver {
<span class="term-fg31">-    &#47;&#47;&#47; Create a new resolver by wrapping the given [`AsyncResolver`]</span>
<span class="term-fg31">-    pub const fn new(resolver: TokioAsyncResolver) -&gt; Self {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create a new resolver by wrapping the given [`TokioResolver`]</span>
<span class="term-fg32">+    pub const fn new(resolver: TokioResolver) -&gt; Self {</span>
         Self(resolver)
     }
&nbsp;
<span class="term-fg36">@@ -60,7 +60,7 @@</span>     &#47;&#47;&#47; Constructs a new Tokio based Resolver with the system configuration.
     &#47;&#47;&#47;
     &#47;&#47;&#47; This will use `&#47;etc&#47;resolv.conf` on Unix OSes and the registry on Windows.
     pub fn from_system_conf() -&gt; Result&lt;Self, ResolveError&gt; {
<span class="term-fg31">-        TokioAsyncResolver::tokio_from_system_conf().map(Self::new)</span>
<span class="term-fg32">+        TokioResolver::tokio_from_system_conf().map(Self::new)</span>
     }
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e83e908325bc60a4a3edbf30" role="button"
                       aria-expanded="false" aria-controls="id-e83e908325bc60a4a3edbf30">
                        <code>crates/net/eth-wire/src/capability.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/net/eth-wire/src/capability.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/net/eth-wire/src/capability.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e83e908325bc60a4a3edbf30"><span class="term-fg1">diff --git reth&#47;crates&#47;net&#47;eth-wire&#47;src&#47;capability.rs scroll-reth&#47;crates&#47;net&#47;eth-wire&#47;src&#47;capability.rs</span>
<span class="term-fg1">index 625971e0e7bd9b3c6a847beded0a5551852cc277..8d969eac889b47fde2173ad5227fcd00b82ae8a5 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;net&#47;eth-wire&#47;src&#47;capability.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;net&#47;eth-wire&#47;src&#47;capability.rs</span>
<span class="term-fg36">@@ -319,7 +319,7 @@</span>             &#47;&#47; If multiple versions are shared of the same (equal name) capability, the numerically
             &#47;&#47; highest wins, others are ignored
             if shared_capabilities
                 .get(&amp;peer_capability.name)
<span class="term-fg31">-                .map_or(true, |v| peer_capability.version &gt; v.version)</span>
<span class="term-fg32">+                .is_none_or(|v| peer_capability.version &gt; v.version)</span>
             {
                 shared_capabilities.insert(
                     peer_capability.name.clone(),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0eacd9b5ff3bf4dfc8e3928d" role="button"
                       aria-expanded="false" aria-controls="id-0eacd9b5ff3bf4dfc8e3928d">
                        <code>crates/net/network/src/transactions/validation.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/net/network/src/transactions/validation.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/net/network/src/transactions/validation.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0eacd9b5ff3bf4dfc8e3928d"><span class="term-fg1">diff --git reth&#47;crates&#47;net&#47;network&#47;src&#47;transactions&#47;validation.rs scroll-reth&#47;crates&#47;net&#47;network&#47;src&#47;transactions&#47;validation.rs</span>
<span class="term-fg1">index 1575d9f3374a83333ca078981b0934e2337e4714..2bba5222c3db01f6330949fa2f5a4f81755273ca 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;net&#47;network&#47;src&#47;transactions&#47;validation.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;net&#47;network&#47;src&#47;transactions&#47;validation.rs</span>
<span class="term-fg36">@@ -3,7 +3,7 @@</span> &#47;&#47;! and [`NewPooledTransactionHashes68`](reth_eth_wire::NewPooledTransactionHashes68)
 &#47;&#47;! announcements. Validation and filtering of announcements is network dependent.
&nbsp;
 use crate::metrics::{AnnouncedTxTypesMetrics, TxTypesCounter};
<span class="term-fg31">-use alloy_primitives::{Signature, TxHash};</span>
<span class="term-fg32">+use alloy_primitives::{PrimitiveSignature, TxHash};</span>
 use derive_more::{Deref, DerefMut};
 use reth_eth_wire::{
     DedupPayload, Eth68TxMetadata, HandleMempoolData, PartiallyValidData, ValidAnnouncementData,
<span class="term-fg36">@@ -14,7 +14,7 @@</span> use std::{fmt, fmt::Display, mem};
 use tracing::trace;
&nbsp;
 &#47;&#47;&#47; The size of a decoded signature in bytes.
<span class="term-fg31">-pub const SIGNATURE_DECODED_SIZE_BYTES: usize = mem::size_of::&lt;Signature&gt;();</span>
<span class="term-fg32">+pub const SIGNATURE_DECODED_SIZE_BYTES: usize = mem::size_of::&lt;PrimitiveSignature&gt;();</span>
&nbsp;
 &#47;&#47;&#47; Interface for validating a `(ty, size, hash)` tuple from a
 &#47;&#47;&#47; [`NewPooledTransactionHashes68`](reth_eth_wire::NewPooledTransactionHashes68)..</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3249c7f46636cd654f95e5d4" role="button"
                       aria-expanded="false" aria-controls="id-3249c7f46636cd654f95e5d4">
                        <code>crates/net/peers/src/bootnodes/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/net/peers/src/bootnodes/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/net/peers/src/bootnodes/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3249c7f46636cd654f95e5d4"><span class="term-fg1">diff --git reth&#47;crates&#47;net&#47;peers&#47;src&#47;bootnodes&#47;mod.rs scroll-reth&#47;crates&#47;net&#47;peers&#47;src&#47;bootnodes&#47;mod.rs</span>
<span class="term-fg1">index 31c91e5d1cea0b446ec9591f00a4b580d9fe22a2..e2c9a86502e6d0e371974970b04d53ef0962006a 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;net&#47;peers&#47;src&#47;bootnodes&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;net&#47;peers&#47;src&#47;bootnodes&#47;mod.rs</span>
<span class="term-fg36">@@ -8,6 +8,9 @@</span>
 mod optimism;
 pub use optimism::*;
&nbsp;
<span class="term-fg32">+mod scroll;</span>
<span class="term-fg32">+pub use scroll::*;</span>
<span class="term-fg32">+</span>
 &#47;&#47;&#47; Returns parsed mainnet nodes
 pub fn mainnet_nodes() -&gt; Vec&lt;NodeRecord&gt; {
     parse_nodes(&amp;MAINNET_BOOTNODES[..])
<span class="term-fg36">@@ -41,6 +44,16 @@</span>
 &#47;&#47;&#47; Returns parsed op-stack base testnet nodes
 pub fn base_testnet_nodes() -&gt; Vec&lt;NodeRecord&gt; {
     parse_nodes(OP_TESTNET_BOOTNODES)
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Returns parsed scroll mainnet nodes</span>
<span class="term-fg32">+pub fn scroll_nodes() -&gt; Vec&lt;NodeRecord&gt; {</span>
<span class="term-fg32">+    parse_nodes(SCROLL_BOOTNODES)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Returns parsed scroll seplo nodes</span>
<span class="term-fg32">+pub fn scroll_sepolia_nodes() -&gt; Vec&lt;NodeRecord&gt; {</span>
<span class="term-fg32">+    parse_nodes(SCROLL_SEPOLIA_BOOTNODES)</span>
 }
&nbsp;
 &#47;&#47;&#47; Parses all the nodes</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b58f033f3eda8219d3db36db" role="button"
                       aria-expanded="false" aria-controls="id-b58f033f3eda8219d3db36db">
                        <code>crates/net/peers/src/bootnodes/scroll.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/net/peers/src/bootnodes/scroll.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+17</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b58f033f3eda8219d3db36db"><span class="term-fg1">diff --git reth&#47;crates&#47;net&#47;peers&#47;src&#47;bootnodes&#47;scroll.rs scroll-reth&#47;crates&#47;net&#47;peers&#47;src&#47;bootnodes&#47;scroll.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..7d85fcc8d077b6ea67ea3a1c5426620fb2185500</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;net&#47;peers&#47;src&#47;bootnodes&#47;scroll.rs</span>
<span class="term-fg36">@@ -0,0 +1,17 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll bootnodes come from &lt;https:&#47;&#47;github.com&#47;scroll-tech&#47;go-ethereum&#47;blob&#47;develop&#47;params&#47;bootnodes.go&gt;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Scroll mainnet boot nodes.</span>
<span class="term-fg32">+pub static SCROLL_BOOTNODES: &amp;[&amp;str] = &amp;[</span>
<span class="term-fg32">+    &quot;enode:&#47;&#47;c6ac91f43df3d63916ac1ae411cdd5ba249d55d48a7bec7f8cd5bb351a31aba437e5a69e8a1de74d73fdfeba8af1cfe9caf9846ecd3abf60d1ffdf4925b55b23@54.186.123.248:30303&quot;,</span>
<span class="term-fg32">+    &quot;enode:&#47;&#47;fdcc807b5d1353f3a1e98b90208ce6ef1b7d446136e51eaa8ad657b55518a2f8b37655e42375d61622e6ea18f3faf9d070c9bbdf012cf5484bcbad33b7a15fb1@44.227.91.206:30303&quot;,</span>
<span class="term-fg32">+    &quot;enode:&#47;&#47;6beb5a3efbb39be73d17630b6da48e94c0ce7ec665172111463cb470197b20c12faa1fa6f835b81c28571277d1017e65c4e426cc92a46141cf69118ecf28ac03@44.237.194.52:30303&quot;,</span>
<span class="term-fg32">+    &quot;enode:&#47;&#47;7cf893d444eb8e129dca0f6485b3df579911606e7c728be4fa55fcc5f155a37c3ce07d217ccec5447798bde465ac2bdba2cb8763d107e9f3257e787579e9f27e@52.35.203.107:30303&quot;,</span>
<span class="term-fg32">+    &quot;enode:&#47;&#47;c7b2d94e95da343db6e667a01cef90376a592f2d277fbcbf6e9c9186734ed8003d01389571bd10cdbab7a6e5adfa6f0c7b55644d0db24e0b9deb4ec80f842075@54.70.236.187:30303&quot;,</span>
<span class="term-fg32">+];</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Scroll sepolia boot nodes.</span>
<span class="term-fg32">+pub static SCROLL_SEPOLIA_BOOTNODES: &amp;[&amp;str] = &amp;[</span>
<span class="term-fg32">+    &quot;enode:&#47;&#47;ceb1636bac5cbb262e5ad5b2cd22014bdb35ffe7f58b3506970d337a63099481814a338dbcd15f2d28757151e3ecd40ba38b41350b793cd0d910ff0436654f8c@35.85.84.250:30303&quot;,</span>
<span class="term-fg32">+    &quot;enode:&#47;&#47;29cee709c400533ae038a875b9ca975c8abef9eade956dcf3585e940acd5c0ae916968f514bd37d1278775aad1b7db30f7032a70202a87fd7365bd8de3c9f5fc@44.242.39.33:30303&quot;,</span>
<span class="term-fg32">+    &quot;enode:&#47;&#47;dd1ac5433c5c2b04ca3166f4cb726f8ff6d2da83dbc16d9b68b1ea83b7079b371eb16ef41c00441b6e85e32e33087f3b7753ea9e8b1e3f26d3e4df9208625e7f@54.148.111.168:30303&quot;,</span>
<span class="term-fg32">+];</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8c92e0c1d9e1cc7d1b334971" role="button"
                       aria-expanded="false" aria-controls="id-8c92e0c1d9e1cc7d1b334971">
                        <code>crates/node/api/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/node/api/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/node/api/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8c92e0c1d9e1cc7d1b334971"><span class="term-fg1">diff --git reth&#47;crates&#47;node&#47;api&#47;Cargo.toml scroll-reth&#47;crates&#47;node&#47;api&#47;Cargo.toml</span>
<span class="term-fg1">index ab4595d336243020ea928237736898f23e54e0c6..8279a83252295f608eec61c568cf80afe9a102c6 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;node&#47;api&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;node&#47;api&#47;Cargo.toml</span>
<span class="term-fg36">@@ -29,3 +29,11 @@</span> alloy-rpc-types-engine.workspace = true
 alloy-consensus.workspace = true
&nbsp;
 eyre.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-node-core&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-engine-primitives&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c5c4bdb18acd59e54ceab6c6" role="button"
                       aria-expanded="false" aria-controls="id-c5c4bdb18acd59e54ceab6c6">
                        <code>crates/node/builder/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/node/builder/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/node/builder/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+19</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c5c4bdb18acd59e54ceab6c6"><span class="term-fg1">diff --git reth&#47;crates&#47;node&#47;builder&#47;Cargo.toml scroll-reth&#47;crates&#47;node&#47;builder&#47;Cargo.toml</span>
<span class="term-fg1">index 781112d93c8a68cd16bde81188323ca5b175ac36..f3dcaaee523a3f0ca4e921d72751b9bde201f893 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;node&#47;builder&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;node&#47;builder&#47;Cargo.toml</span>
<span class="term-fg36">@@ -114,3 +114,22 @@</span>     &quot;reth-db-api&#47;test-utils&quot;,
     &quot;reth-provider&#47;test-utils&quot;,
     &quot;reth-transaction-pool&#47;test-utils&quot;,
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-chainspec&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-db-api&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-db?&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-rpc&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-node-core&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-node-api&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-exex&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-blockchain-tree&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-rpc-eth-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-stages&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-db-common&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-engine-tree&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-engine-util&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-invalid-block-hooks&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d743c435af85c605c1f92d79" role="button"
                       aria-expanded="false" aria-controls="id-d743c435af85c605c1f92d79">
                        <code>crates/node/core/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/node/core/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/node/core/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d743c435af85c605c1f92d79"><span class="term-fg1">diff --git reth&#47;crates&#47;node&#47;core&#47;Cargo.toml scroll-reth&#47;crates&#47;node&#47;core&#47;Cargo.toml</span>
<span class="term-fg1">index c667a56293c15c7de6b1a5a1394856a8f433b22e..b24430982025d1954b30a1b65f1370a1dca9e53b 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;node&#47;core&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;node&#47;core&#47;Cargo.toml</span>
<span class="term-fg36">@@ -80,6 +80,11 @@</span> optimism = [&quot;reth-primitives&#47;optimism&quot;, &quot;reth-db&#47;optimism&quot;]
 # Features for vergen to generate correct env vars
 jemalloc = [&quot;reth-cli-util&#47;jemalloc&quot;]
 asm-keccak = [&quot;reth-primitives&#47;asm-keccak&quot;, &quot;alloy-primitives&#47;asm-keccak&quot;]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-rpc-eth-types&#47;scroll&quot;,</span>
<span class="term-fg32">+]</span>
&nbsp;
 [build-dependencies]
 vergen = { version = &quot;8.0.0&quot;, features = [&quot;build&quot;, &quot;cargo&quot;, &quot;git&quot;, &quot;gitcl&quot;] }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fb17ec36e91b7c50b1c5b9c6" role="button"
                       aria-expanded="false" aria-controls="id-fb17ec36e91b7c50b1c5b9c6">
                        <code>crates/payload/basic/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/payload/basic/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/payload/basic/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fb17ec36e91b7c50b1c5b9c6"><span class="term-fg1">diff --git reth&#47;crates&#47;payload&#47;basic&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;payload&#47;basic&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 0ab411d3e600a08b3b71bacfaa5d5c2b6760dd58..c5a39d3a989d0ed6314916468e50431d84510e18 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;payload&#47;basic&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;payload&#47;basic&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -204,7 +204,12 @@</span>                 &#47;&#47; we want pre cache existing accounts and their storage
                 &#47;&#47; this only includes changed accounts and storage but is better than nothing
                 let storage =
                     acc.storage.iter().map(|(key, slot)| (*key, slot.present_value)).collect();
<span class="term-fg31">-                cached.insert_account(addr, info, storage);</span>
<span class="term-fg32">+                cached.insert_account(</span>
<span class="term-fg32">+                    addr,</span>
<span class="term-fg32">+                    #[allow(clippy::useless_conversion)]</span>
<span class="term-fg32">+                    info.into(),</span>
<span class="term-fg32">+                    storage,</span>
<span class="term-fg32">+                );</span>
             }
         }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d858efbe3dcc1e7856c15718" role="button"
                       aria-expanded="false" aria-controls="id-d858efbe3dcc1e7856c15718">
                        <code>crates/revm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/revm/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/revm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+9</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d858efbe3dcc1e7856c15718"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;Cargo.toml scroll-reth&#47;crates&#47;revm&#47;Cargo.toml</span>
<span class="term-fg1">index 95def23a44324287d5c1aee035cfc003d31e036a..cb7bb9be78ed5a81a03a9ca646a73df865500e65 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -21,6 +21,9 @@</span> reth-storage-api.workspace = true
 reth-trie = { workspace = true, optional = true }
 reth-primitives-traits.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # alloy
 alloy-eips.workspace = true
 alloy-primitives.workspace = true
<span class="term-fg36">@@ -60,4 +63,10 @@</span>     &quot;alloy-primitives&#47;serde&quot;,
     &quot;alloy-consensus&#47;serde&quot;,
     &quot;reth-primitives-traits&#47;serde&quot;,
     &quot;reth-trie?&#47;serde&quot;,
<span class="term-fg32">+    &quot;reth-scroll-primitives?&#47;serde&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie?&#47;scroll&quot;</span>
 ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fc335ba841e5fc372bb5f34e" role="button"
                       aria-expanded="false" aria-controls="id-fc335ba841e5fc372bb5f34e">
                        <code>crates/revm/src/batch.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/revm/src/batch.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/revm/src/batch.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fc335ba841e5fc372bb5f34e"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;src&#47;batch.rs scroll-reth&#47;crates&#47;revm&#47;src&#47;batch.rs</span>
<span class="term-fg1">index 15ba049250f5e736d759a8b3906494dbcb5f11da..f55c3aeee259c2a6b4b92d2d3b2038c4cc3bcd65 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;src&#47;batch.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;src&#47;batch.rs</span>
<span class="term-fg36">@@ -102,7 +102,7 @@</span>     }
&nbsp;
     &#47;&#47;&#47; Returns the [`BundleRetention`] for the given block based on the configured prune modes.
     pub fn bundle_retention(&amp;self, block_number: BlockNumber) -&gt; BundleRetention {
<span class="term-fg31">-        if self.tip.map_or(true, |tip| {</span>
<span class="term-fg32">+        if self.tip.is_none_or(|tip| {</span>
             !self
                 .prune_modes
                 .account_history</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3c28a4f697042f917483ad2d" role="button"
                       aria-expanded="false" aria-controls="id-3c28a4f697042f917483ad2d">
                        <code>crates/revm/src/cached.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/revm/src/cached.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/revm/src/cached.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3c28a4f697042f917483ad2d"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;src&#47;cached.rs scroll-reth&#47;crates&#47;revm&#47;src&#47;cached.rs</span>
<span class="term-fg1">index 5d5262adc5b3bde3a510d1fb75e8b40ea1608df5..81e44675f75fb00aac0bcd72dbc3c28d00049629 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;src&#47;cached.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;src&#47;cached.rs</span>
<span class="term-fg36">@@ -4,9 +4,12 @@</span>     map::{Entry, HashMap},
     Address, B256, U256,
 };
 use core::cell::RefCell;
<span class="term-fg31">-use revm::primitives::{</span>
<span class="term-fg31">-    db::{Database, DatabaseRef},</span>
<span class="term-fg31">-    AccountInfo, Bytecode,</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    primitives::{</span>
<span class="term-fg32">+        db::{Database, DatabaseRef},</span>
<span class="term-fg32">+        Bytecode,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    shared::AccountInfo,</span>
 };
&nbsp;
 &#47;&#47;&#47; A container type that caches reads from an underlying [`DatabaseRef`].</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c422242eb32bd32a276e629d" role="button"
                       aria-expanded="false" aria-controls="id-c422242eb32bd32a276e629d">
                        <code>crates/revm/src/database.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/revm/src/database.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/revm/src/database.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c422242eb32bd32a276e629d"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;src&#47;database.rs scroll-reth&#47;crates&#47;revm&#47;src&#47;database.rs</span>
<span class="term-fg1">index 682aca6cf3795201b9bcb6d6b5ae87e28a060062..9fd059194cfac1ad67e1c971c07aa46cc4ad92ea 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;src&#47;database.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;src&#47;database.rs</span>
<span class="term-fg36">@@ -3,11 +3,7 @@</span> use alloy_primitives::{Address, B256, U256};
 use core::ops::{Deref, DerefMut};
 use reth_primitives::Account;
 use reth_storage_errors::provider::{ProviderError, ProviderResult};
<span class="term-fg31">-use revm::{</span>
<span class="term-fg31">-    db::DatabaseRef,</span>
<span class="term-fg31">-    primitives::{AccountInfo, Bytecode},</span>
<span class="term-fg31">-    Database,</span>
<span class="term-fg31">-};</span>
<span class="term-fg32">+use revm::{db::DatabaseRef, primitives::Bytecode, shared::AccountInfo, Database};</span>
&nbsp;
 &#47;&#47;&#47; A helper trait responsible for providing state necessary for EVM execution.
 &#47;&#47;&#47;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ed6a517237d7ba2b7e9227d9" role="button"
                       aria-expanded="false" aria-controls="id-ed6a517237d7ba2b7e9227d9">
                        <code>crates/revm/src/either.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/revm/src/either.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/revm/src/either.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ed6a517237d7ba2b7e9227d9"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;src&#47;either.rs scroll-reth&#47;crates&#47;revm&#47;src&#47;either.rs</span>
<span class="term-fg1">index e93ba3a8d010e5372f10bf7267657b3934ebda57..c2521bc4801a6c748aa83f5350f3d71d637ed2b2 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;src&#47;either.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;src&#47;either.rs</span>
<span class="term-fg36">@@ -1,8 +1,5 @@</span>
 use alloy_primitives::{Address, B256, U256};
<span class="term-fg31">-use revm::{</span>
<span class="term-fg31">-    primitives::{AccountInfo, Bytecode},</span>
<span class="term-fg31">-    Database,</span>
<span class="term-fg31">-};</span>
<span class="term-fg32">+use revm::{primitives::Bytecode, shared::AccountInfo, Database};</span>
&nbsp;
 &#47;&#47;&#47; An enum type that can hold either of two different [`Database`] implementations.
 &#47;&#47;&#47;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3ae642e07db188f58c98d48c" role="button"
                       aria-expanded="false" aria-controls="id-3ae642e07db188f58c98d48c">
                        <code>crates/revm/src/test_utils.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/revm/src/test_utils.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/revm/src/test_utils.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+24</span></div>
                            <div class="text-start"><span class="text-danger">-6</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3ae642e07db188f58c98d48c"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;src&#47;test_utils.rs scroll-reth&#47;crates&#47;revm&#47;src&#47;test_utils.rs</span>
<span class="term-fg1">index 443d1d5ebcf22144462af10f3256e4d0f9cd203a..38ed20bed019915bbffb8129e168c1b295af6b32 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;src&#47;test_utils.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;src&#47;test_utils.rs</span>
<span class="term-fg36">@@ -6,13 +6,13 @@</span>     Address, BlockNumber, Bytes, StorageKey, B256, U256,
 };
 use reth_primitives::{Account, Bytecode};
 use reth_storage_api::{
<span class="term-fg31">-    AccountReader, BlockHashReader, StateProofProvider, StateProvider, StateRootProvider,</span>
<span class="term-fg31">-    StorageRootProvider,</span>
<span class="term-fg32">+    AccountReader, BlockHashReader, HashedPostStateProvider, HashedStorageProvider,</span>
<span class="term-fg32">+    KeyHasherProvider, StateProofProvider, StateProvider, StateRootProvider, StorageRootProvider,</span>
 };
 use reth_storage_errors::provider::ProviderResult;
 use reth_trie::{
<span class="term-fg31">-    updates::TrieUpdates, AccountProof, HashedPostState, HashedStorage, MultiProof,</span>
<span class="term-fg31">-    StorageMultiProof, StorageProof, TrieInput,</span>
<span class="term-fg32">+    updates::TrieUpdates, AccountProof, HashedPostState, HashedStorage, KeccakKeyHasher, KeyHasher,</span>
<span class="term-fg32">+    MultiProof, StorageMultiProof, StorageProof, TrieInput,</span>
 };
&nbsp;
 &#47;&#47;&#47; Mock state for testing
<span class="term-fg36">@@ -72,7 +72,7 @@</span>     }
 }
&nbsp;
 impl StateRootProvider for StateProviderTest {
<span class="term-fg31">-    fn state_root(&amp;self, _hashed_state: HashedPostState) -&gt; ProviderResult&lt;B256&gt; {</span>
<span class="term-fg32">+    fn state_root_from_state(&amp;self, _hashed_state: HashedPostState) -&gt; ProviderResult&lt;B256&gt; {</span>
         unimplemented!(&quot;state root computation is not supported&quot;)
     }
&nbsp;
<span class="term-fg36">@@ -80,7 +80,7 @@</span>     fn state_root_from_nodes(&amp;self, _input: TrieInput) -&gt; ProviderResult&lt;B256&gt; {
         unimplemented!(&quot;state root computation is not supported&quot;)
     }
&nbsp;
<span class="term-fg31">-    fn state_root_with_updates(</span>
<span class="term-fg32">+    fn state_root_from_state_with_updates(</span>
         &amp;self,
         _hashed_state: HashedPostState,
     ) -&gt; ProviderResult&lt;(B256, TrieUpdates)&gt; {
<span class="term-fg36">@@ -147,6 +147,24 @@</span>         _input: TrieInput,
         _target: HashedPostState,
     ) -&gt; ProviderResult&lt;HashMap&lt;B256, Bytes&gt;&gt; {
         unimplemented!(&quot;witness generation is not supported&quot;)
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashedPostStateProvider for StateProviderTest {</span>
<span class="term-fg32">+    fn hashed_post_state(&amp;self, bundle_state: &amp;revm::db::BundleState) -&gt; HashedPostState {</span>
<span class="term-fg32">+        HashedPostState::from_bundle_state::&lt;KeccakKeyHasher&gt;(bundle_state.state())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashedStorageProvider for StateProviderTest {</span>
<span class="term-fg32">+    fn hashed_storage(&amp;self, account: &amp;revm::db::BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+        HashedStorage::from_bundle_account::&lt;KeccakKeyHasher&gt;(account)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl KeyHasherProvider for StateProviderTest {</span>
<span class="term-fg32">+    fn hash_key(&amp;self, bytes: &amp;[u8]) -&gt; B256 {</span>
<span class="term-fg32">+        KeccakKeyHasher::hash_key(bytes)</span>
     }
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-09af5064aac163a9ce0f273f" role="button"
                       aria-expanded="false" aria-controls="id-09af5064aac163a9ce0f273f">
                        <code>crates/revm/src/witness.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/revm/src/witness.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/revm/src/witness.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+22</span></div>
                            <div class="text-start"><span class="text-danger">-6</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-09af5064aac163a9ce0f273f"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;src&#47;witness.rs scroll-reth&#47;crates&#47;revm&#47;src&#47;witness.rs</span>
<span class="term-fg1">index c40c87d324b30db1163739977714088c2b06d3c9..ab1ec0f7978531a4fd1c282885244b8d1e51b1fe 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;src&#47;witness.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;src&#47;witness.rs</span>
<span class="term-fg36">@@ -22,7 +22,11 @@</span> }
&nbsp;
 impl ExecutionWitnessRecord {
     &#47;&#47;&#47; Records the state after execution.
<span class="term-fg31">-    pub fn record_executed_state&lt;DB&gt;(&amp;mut self, statedb: &amp;State&lt;DB&gt;) {</span>
<span class="term-fg32">+    pub fn record_executed_state&lt;DB&gt;(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        statedb: &amp;State&lt;DB&gt;,</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)] context: &amp;reth_scroll_primitives::ScrollPostExecutionContext,</span>
<span class="term-fg32">+    ) {</span>
         self.codes = statedb
             .cache
             .contracts
<span class="term-fg36">@@ -43,9 +47,14 @@</span>             .collect();
&nbsp;
         for (address, account) in &amp;statedb.cache.accounts {
             let hashed_address = keccak256(address);
<span class="term-fg31">-            self.hashed_state</span>
<span class="term-fg31">-                .accounts</span>
<span class="term-fg31">-                .insert(hashed_address, account.account.as_ref().map(|a| a.info.clone().into()));</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            let hashed_account = account</span>
<span class="term-fg32">+                .account</span>
<span class="term-fg32">+                .as_ref()</span>
<span class="term-fg32">+                .map(|a| Into::&lt;revm::AccountInfo&gt;::into((a.info.clone(), context)).into());</span>
<span class="term-fg32">+            #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+            let hashed_account = account.account.as_ref().map(|a| a.info.clone().into());</span>
<span class="term-fg32">+            self.hashed_state.accounts.insert(hashed_address, hashed_account);</span>
&nbsp;
             let storage = self
                 .hashed_state
<span class="term-fg36">@@ -68,9 +77,16 @@</span>         }
     }
&nbsp;
     &#47;&#47;&#47; Creates the record from the state after execution.
<span class="term-fg31">-    pub fn from_executed_state&lt;DB&gt;(state: &amp;State&lt;DB&gt;) -&gt; Self {</span>
<span class="term-fg32">+    pub fn from_executed_state&lt;DB&gt;(</span>
<span class="term-fg32">+        state: &amp;State&lt;DB&gt;,</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)] context: &amp;reth_scroll_primitives::ScrollPostExecutionContext,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
         let mut record = Self::default();
<span class="term-fg31">-        record.record_executed_state(state);</span>
<span class="term-fg32">+        record.record_executed_state(</span>
<span class="term-fg32">+            state,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            context,</span>
<span class="term-fg32">+        );</span>
         record
     }
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-dc306f3203a7aa455b8fda66" role="button"
                       aria-expanded="false" aria-controls="id-dc306f3203a7aa455b8fda66">
                        <code>crates/rpc/rpc-eth-api/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/rpc/rpc-eth-api/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/rpc/rpc-eth-api/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-dc306f3203a7aa455b8fda66"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;Cargo.toml scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;Cargo.toml</span>
<span class="term-fg1">index e4b1b28074f05052996756178d6028f66091ac33..46a6d5136e95f448b948d2721d5935a426095fbc 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;Cargo.toml</span>
<span class="term-fg36">@@ -29,7 +29,6 @@</span> reth-execution-types.workspace = true
 reth-rpc-eth-types.workspace = true
 reth-rpc-server-types.workspace = true
 reth-network-api.workspace = true
<span class="term-fg31">-reth-trie.workspace = true</span>
 reth-node-api.workspace = true
&nbsp;
 # ethereum
<span class="term-fg36">@@ -42,6 +41,10 @@</span> alloy-primitives.workspace = true
 alloy-rpc-types-eth.workspace = true
 alloy-rpc-types-mev.workspace = true
 alloy-consensus.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
&nbsp;
 # rpc
 jsonrpsee = { workspace = true, features = [&quot;server&quot;, &quot;macros&quot;] }
<span class="term-fg36">@@ -61,3 +64,12 @@</span>
 [features]
 js-tracer = [&quot;revm-inspectors&#47;js-tracer&quot;, &quot;reth-rpc-eth-types&#47;js-tracer&quot;]
 client = [&quot;jsonrpsee&#47;client&quot;, &quot;jsonrpsee&#47;async-client&quot;]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-rpc-eth-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-storage&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-08f425a0a60247834b36d423" role="button"
                       aria-expanded="false" aria-controls="id-08f425a0a60247834b36d423">
                        <code>crates/rpc/rpc-eth-api/src/helpers/call.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/rpc/rpc-eth-api/src/helpers/call.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/rpc/rpc-eth-api/src/helpers/call.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-08f425a0a60247834b36d423"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;call.rs scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;call.rs</span>
<span class="term-fg1">index f9441f0630abe3ae63eb78569ca5e36a97135e50..d9b4b2c894c4a289fd608936015ab23f94792c90 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;call.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;call.rs</span>
<span class="term-fg36">@@ -110,6 +110,10 @@</span>             cfg.disable_eip3607 = true;
&nbsp;
             let this = self.clone();
             self.spawn_with_state_at_block(block, move |state| {
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                let mut db =</span>
<span class="term-fg32">+                    CacheDB::new(reth_scroll_storage::ScrollStateProviderDatabase::new(state));</span>
<span class="term-fg32">+                #[cfg(not(feature = &quot;scroll&quot;))]</span>
                 let mut db = CacheDB::new(StateProviderDatabase::new(state));
                 let mut blocks: Vec&lt;SimulatedBlock&lt;RpcBlock&lt;Self::NetworkTypes&gt;&gt;&gt; =
                     Vec::with_capacity(block_state_calls.len());</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5f98615565e4ce58ee337e49" role="button"
                       aria-expanded="false" aria-controls="id-5f98615565e4ce58ee337e49">
                        <code>crates/rpc/rpc-eth-api/src/helpers/pending_block.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/rpc/rpc-eth-api/src/helpers/pending_block.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/rpc/rpc-eth-api/src/helpers/pending_block.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-11</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5f98615565e4ce58ee337e49"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;pending_block.rs scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;pending_block.rs</span>
<span class="term-fg1">index e1cd8f5c3c2928b4fdbb17e421f0b69c59bc415a..f56a3d5b0ab65ccc97ba943263d79a5a56b1326b 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;pending_block.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;pending_block.rs</span>
<span class="term-fg36">@@ -24,18 +24,15 @@</span> use reth_provider::{
     BlockReader, BlockReaderIdExt, ChainSpecProvider, EvmEnvProvider, ProviderError,
     ProviderReceipt, ReceiptProvider, StateProviderFactory,
 };
<span class="term-fg31">-use reth_revm::{</span>
<span class="term-fg31">-    database::StateProviderDatabase,</span>
<span class="term-fg31">-    primitives::{</span>
<span class="term-fg31">-        BlockEnv, CfgEnv, CfgEnvWithHandlerCfg, EVMError, Env, ExecutionResult, InvalidTransaction,</span>
<span class="term-fg31">-        ResultAndState, SpecId,</span>
<span class="term-fg31">-    },</span>
<span class="term-fg32">+use reth_revm::primitives::{</span>
<span class="term-fg32">+    BlockEnv, CfgEnv, CfgEnvWithHandlerCfg, EVMError, Env, ExecutionResult, InvalidTransaction,</span>
<span class="term-fg32">+    ResultAndState, SpecId,</span>
 };
 use reth_rpc_eth_types::{EthApiError, PendingBlock, PendingBlockEnv, PendingBlockEnvOrigin};
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use reth_transaction_pool::{
     error::InvalidPoolTransactionError, BestTransactionsAttributes, TransactionPool,
 };
<span class="term-fg31">-use reth_trie::HashedPostState;</span>
 use revm::{db::states::bundle_state::BundleRetention, DatabaseCommit, State};
 use std::time::{Duration, Instant};
 use tokio::sync::Mutex;
<span class="term-fg36">@@ -239,7 +236,10 @@</span>         let state_provider = self
             .provider()
             .history_by_block_hash(parent_hash)
             .map_err(Self::Error::from_eth_err)?;
<span class="term-fg31">-        let state = StateProviderDatabase::new(state_provider);</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let state = reth_revm::database::StateProviderDatabase::new(state_provider);</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let state = reth_scroll_storage::ScrollStateProviderDatabase::new(state_provider);</span>
         let mut db = State::builder().with_database(state).with_bundle_update().build();
&nbsp;
         let mut cumulative_gas_used = 0;
<span class="term-fg36">@@ -419,12 +419,12 @@</span>         &#47;&#47; merge all transitions into bundle state.
         db.merge_transitions(BundleRetention::PlainState);
&nbsp;
         let execution_outcome = ExecutionOutcome::new(
<span class="term-fg31">-            db.take_bundle(),</span>
<span class="term-fg32">+            db.finalize(),</span>
             vec![receipts.clone()].into(),
             block_number,
             Vec::new(),
         );
<span class="term-fg31">-        let hashed_state = HashedPostState::from_bundle_state(&amp;execution_outcome.state().state);</span>
<span class="term-fg32">+        let hashed_state = db.database.hashed_post_state(execution_outcome.state());</span>
&nbsp;
         let receipts_root = self.receipts_root(&amp;block_env, &amp;execution_outcome, block_number);
&nbsp;
<span class="term-fg36">@@ -432,7 +432,8 @@</span>         let logs_bloom =
             execution_outcome.block_logs_bloom(block_number).expect(&quot;Block is present&quot;);
&nbsp;
         &#47;&#47; calculate the state root
<span class="term-fg31">-        let state_root = db.database.state_root(hashed_state).map_err(Self::Error::from_eth_err)?;</span>
<span class="term-fg32">+        let state_root =</span>
<span class="term-fg32">+            db.database.state_root_from_state(hashed_state).map_err(Self::Error::from_eth_err)?;</span>
&nbsp;
         &#47;&#47; create the block header
         let transactions_root = calculate_transaction_root(&amp;executed_txs);</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a5230cd64976630a5f4708d3" role="button"
                       aria-expanded="false" aria-controls="id-a5230cd64976630a5f4708d3">
                        <code>crates/rpc/rpc-eth-types/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/rpc/rpc-eth-types/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/rpc/rpc-eth-types/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a5230cd64976630a5f4708d3"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;Cargo.toml scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;Cargo.toml</span>
<span class="term-fg1">index 11bf6c6231d216160b54f0558d41e42c4810311c..056be5398cc8259a937b915a0f905b431f14603b 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;Cargo.toml</span>
<span class="term-fg36">@@ -34,9 +34,11 @@</span> alloy-primitives.workspace = true
 alloy-consensus.workspace = true
 alloy-sol-types.workspace = true
 alloy-rpc-types-eth.workspace = true
<span class="term-fg31">-revm.workspace = true</span>
 revm-inspectors.workspace = true
 revm-primitives = { workspace = true, features = [&quot;dev&quot;] }
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+revm.workspace = true</span>
&nbsp;
 # rpc
 jsonrpsee-core.workspace = true
<span class="term-fg36">@@ -65,3 +67,11 @@</span>
&nbsp;
 [features]
 js-tracer = [&quot;revm-inspectors&#47;js-tracer&quot;]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4811d88968e90d344d029e7c" role="button"
                       aria-expanded="false" aria-controls="id-4811d88968e90d344d029e7c">
                        <code>crates/rpc/rpc-eth-types/src/cache/db.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/rpc/rpc-eth-types/src/cache/db.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/rpc/rpc-eth-types/src/cache/db.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+28</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4811d88968e90d344d029e7c"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;src&#47;cache&#47;db.rs scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;src&#47;cache&#47;db.rs</span>
<span class="term-fg1">index 1fbe16a2ed9ca6e3453cc6cd8ef9b33a796ef9f3..2307adf40298524b02932028a5be0e0975656c9d 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;src&#47;cache&#47;db.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;src&#47;cache&#47;db.rs</span>
<span class="term-fg36">@@ -8,7 +8,9 @@</span>     Address, B256, U256,
 };
 use reth_errors::ProviderResult;
 use reth_revm::{database::StateProviderDatabase, db::CacheDB, DatabaseRef};
<span class="term-fg31">-use reth_storage_api::StateProvider;</span>
<span class="term-fg32">+use reth_storage_api::{</span>
<span class="term-fg32">+    HashedPostStateProvider, HashedStorageProvider, KeyHasherProvider, StateProvider,</span>
<span class="term-fg32">+};</span>
 use reth_trie::HashedStorage;
 use revm::Database;
&nbsp;
<span class="term-fg36">@@ -21,11 +23,11 @@</span> #[allow(missing_debug_implementations)]
 pub struct StateProviderTraitObjWrapper&lt;&#39;a&gt;(pub &amp;&#39;a dyn StateProvider);
&nbsp;
 impl reth_storage_api::StateRootProvider for StateProviderTraitObjWrapper&lt;&#39;_&gt; {
<span class="term-fg31">-    fn state_root(</span>
<span class="term-fg32">+    fn state_root_from_state(</span>
         &amp;self,
         hashed_state: reth_trie::HashedPostState,
     ) -&gt; reth_errors::ProviderResult&lt;B256&gt; {
<span class="term-fg31">-        self.0.state_root(hashed_state)</span>
<span class="term-fg32">+        self.0.state_root_from_state(hashed_state)</span>
     }
&nbsp;
     fn state_root_from_nodes(
<span class="term-fg36">@@ -35,11 +37,11 @@</span>     ) -&gt; reth_errors::ProviderResult&lt;B256&gt; {
         self.0.state_root_from_nodes(input)
     }
&nbsp;
<span class="term-fg31">-    fn state_root_with_updates(</span>
<span class="term-fg32">+    fn state_root_from_state_with_updates(</span>
         &amp;self,
         hashed_state: reth_trie::HashedPostState,
     ) -&gt; reth_errors::ProviderResult&lt;(B256, reth_trie::updates::TrieUpdates)&gt; {
<span class="term-fg31">-        self.0.state_root_with_updates(hashed_state)</span>
<span class="term-fg32">+        self.0.state_root_from_state_with_updates(hashed_state)</span>
     }
&nbsp;
     fn state_root_from_nodes_with_updates(
<span class="term-fg36">@@ -136,6 +138,27 @@</span>         start: alloy_primitives::BlockNumber,
         end: alloy_primitives::BlockNumber,
     ) -&gt; reth_errors::ProviderResult&lt;Vec&lt;B256&gt;&gt; {
         self.0.canonical_hashes_range(start, end)
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashedPostStateProvider for StateProviderTraitObjWrapper&lt;&#39;_&gt; {</span>
<span class="term-fg32">+    fn hashed_post_state(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        bundle_state: &amp;revm::db::BundleState,</span>
<span class="term-fg32">+    ) -&gt; reth_trie::HashedPostState {</span>
<span class="term-fg32">+        self.0.hashed_post_state(bundle_state)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl HashedStorageProvider for StateProviderTraitObjWrapper&lt;&#39;_&gt; {</span>
<span class="term-fg32">+    fn hashed_storage(&amp;self, account: &amp;revm::db::BundleAccount) -&gt; HashedStorage {</span>
<span class="term-fg32">+        self.0.hashed_storage(account)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl KeyHasherProvider for StateProviderTraitObjWrapper&lt;&#39;_&gt; {</span>
<span class="term-fg32">+    fn hash_key(&amp;self, bytes: &amp;[u8]) -&gt; B256 {</span>
<span class="term-fg32">+        self.0.hash_key(bytes)</span>
     }
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0ad2f101affe28a5c5b71554" role="button"
                       aria-expanded="false" aria-controls="id-0ad2f101affe28a5c5b71554">
                        <code>crates/rpc/rpc-eth-types/src/simulate.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/rpc/rpc-eth-types/src/simulate.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/rpc/rpc-eth-types/src/simulate.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0ad2f101affe28a5c5b71554"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;src&#47;simulate.rs scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;src&#47;simulate.rs</span>
<span class="term-fg1">index a10b4afff9d72450d90185f292185a4724ba1183..323253216e11b2fefde3eb98628279098c3ef22d 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;src&#47;simulate.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;src&#47;simulate.rs</span>
<span class="term-fg36">@@ -233,7 +233,8 @@</span>
     &#47;&#47;     let storage = hashed_state
     &#47;&#47;         .storages
     &#47;&#47;         .entry(hashed_address)
<span class="term-fg31">-    &#47;&#47;         .or_insert_with(|| HashedStorage::new(account.account_state.is_storage_cleared()));</span>
<span class="term-fg32">+    &#47;&#47;         .or_insert_with(||</span>
<span class="term-fg32">+    &#47;&#47; HashedStorage::new(account.account_state.is_storage_cleared()));</span>
&nbsp;
     &#47;&#47;     for (slot, value) in &amp;account.storage {
     &#47;&#47;         let slot = B256::from(*slot);</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c3ae8eaa72d2a7e3b97f5541" role="button"
                       aria-expanded="false" aria-controls="id-c3ae8eaa72d2a7e3b97f5541">
                        <code>crates/rpc/rpc/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/rpc/rpc/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/rpc/rpc/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+17</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c3ae8eaa72d2a7e3b97f5541"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc&#47;Cargo.toml scroll-reth&#47;crates&#47;rpc&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg1">index 834b1a963bfe52c577cdedf873ddd71e8528501e..9601bfc9030519ade43b2d2404feb05a65ccb2e1 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg36">@@ -34,7 +34,6 @@</span> reth-evm.workspace = true
 reth-rpc-eth-types.workspace = true
 reth-rpc-server-types.workspace = true
 reth-network-types.workspace = true
<span class="term-fg31">-reth-trie.workspace = true</span>
 reth-consensus.workspace = true
 reth-payload-validator.workspace = true
&nbsp;
<span class="term-fg36">@@ -64,6 +63,9 @@</span>     &quot;optional_eip3607&quot;,
     &quot;optional_no_base_fee&quot;,
 ] }
 revm-primitives = { workspace = true, features = [&quot;serde&quot;] }
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
&nbsp;
 # rpc
 jsonrpsee.workspace = true
<span class="term-fg36">@@ -103,3 +105,17 @@</span> jsonrpsee = { workspace = true, features = [&quot;client&quot;] }
&nbsp;
 [features]
 js-tracer = [&quot;revm-inspectors&#47;js-tracer&quot;, &quot;reth-rpc-eth-types&#47;js-tracer&quot;]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-rpc-eth-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-testing-utils&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm-ethereum&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-rpc-eth-api&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-storage&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-chainspec&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;revm-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;revm&#47;scroll&quot;,</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-17a4471437e5483b7847b6d9" role="button"
                       aria-expanded="false" aria-controls="id-17a4471437e5483b7847b6d9">
                        <code>crates/rpc/rpc/src/debug.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/rpc/rpc/src/debug.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/rpc/rpc/src/debug.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-17a4471437e5483b7847b6d9"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;debug.rs scroll-reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;debug.rs</span>
<span class="term-fg1">index 9fc1be93a2f2650f8c2db35823bee4eac6c0b03e..2e71419a19223121ae23a3d1487c32bcaeb1f15e 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;debug.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;debug.rs</span>
<span class="term-fg36">@@ -609,7 +609,10 @@</span>             .ok_or(EthApiError::HeaderNotFound(block_id.into()))?;
&nbsp;
         self.eth_api()
             .spawn_with_state_at_block(block.parent_hash.into(), move |state_provider| {
<span class="term-fg32">+                #[cfg(not(feature = &quot;scroll&quot;))]</span>
                 let db = StateProviderDatabase::new(&amp;state_provider);
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                let db = reth_scroll_storage::ScrollStateProviderDatabase::new(&amp;state_provider);</span>
                 let block_executor = this.inner.block_executor.executor(db);
&nbsp;
                 let mut witness_record = ExecutionWitnessRecord::default();
<span class="term-fg36">@@ -618,7 +621,11 @@</span>                 let _ = block_executor
                     .execute_with_state_closure(
                         (&amp;(*block).clone().unseal(), block.difficulty).into(),
                         |statedb: &amp;State&lt;_&gt;| {
<span class="term-fg31">-                            witness_record.record_executed_state(statedb);</span>
<span class="term-fg32">+                            witness_record.record_executed_state(</span>
<span class="term-fg32">+                                statedb,</span>
<span class="term-fg32">+                                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                                &amp;statedb.database.post_execution_context,</span>
<span class="term-fg32">+                            );</span>
                         },
                     )
                     .map_err(|err| EthApiError::Internal(err.into()))?;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-522858e3f0249b302c554947" role="button"
                       aria-expanded="false" aria-controls="id-522858e3f0249b302c554947">
                        <code>crates/rpc/rpc/src/validation.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/rpc/rpc/src/validation.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/rpc/rpc/src/validation.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+9</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-522858e3f0249b302c554947"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;validation.rs scroll-reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;validation.rs</span>
<span class="term-fg1">index a5e29bb739f97398ac3360106a70fb5cb8747c06..fb840bdb4272e77d9b8d06281edc7430a8d592b1 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;validation.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;validation.rs</span>
<span class="term-fg36">@@ -20,11 +20,10 @@</span> use reth_provider::{
     AccountReader, BlockExecutionInput, BlockExecutionOutput, BlockReaderIdExt, HeaderProvider,
     StateProviderFactory, WithdrawalsProvider,
 };
<span class="term-fg31">-use reth_revm::{cached::CachedReads, database::StateProviderDatabase};</span>
<span class="term-fg32">+use reth_revm::cached::CachedReads;</span>
 use reth_rpc_api::BlockSubmissionValidationApiServer;
 use reth_rpc_server_types::result::internal_rpc_err;
 use reth_tasks::TaskSpawner;
<span class="term-fg31">-use reth_trie::HashedPostState;</span>
 use revm_primitives::{Address, B256, U256};
 use serde::{Deserialize, Serialize};
 use std::{collections::HashSet, sync::Arc};
<span class="term-fg36">@@ -147,7 +146,12 @@</span>         let state_provider = self.provider.state_by_block_hash(latest_header_hash)?;
&nbsp;
         let mut request_cache = self.cached_reads(latest_header_hash).await;
&nbsp;
<span class="term-fg31">-        let cached_db = request_cache.as_db_mut(StateProviderDatabase::new(&amp;state_provider));</span>
<span class="term-fg32">+        &#47;&#47; TODO(scroll): remove once issue #76 is completed.</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let db = reth_scroll_storage::ScrollStateProviderDatabase::new(&amp;state_provider);</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let db = reth_revm::database::StateProviderDatabase::new(&amp;state_provider);</span>
<span class="term-fg32">+        let cached_db = request_cache.as_db_mut(db);</span>
         let executor = self.executor_provider.executor(cached_db);
&nbsp;
         let block = block.unseal();
<span class="term-fg36">@@ -179,8 +183,8 @@</span>         )?;
&nbsp;
         self.ensure_payment(&amp;block, &amp;output, &amp;message)?;
&nbsp;
<span class="term-fg31">-        let state_root =</span>
<span class="term-fg31">-            state_provider.state_root(HashedPostState::from_bundle_state(&amp;output.state.state))?;</span>
<span class="term-fg32">+        let state_root = state_provider</span>
<span class="term-fg32">+            .state_root_from_state(state_provider.hashed_post_state(&amp;output.state))?;</span>
&nbsp;
         if state_root != block.state_root {
             return Err(ConsensusError::BodyStateRootDiff(</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-95663e563c4c235300ea1781" role="button"
                       aria-expanded="false" aria-controls="id-95663e563c4c235300ea1781">
                        <code>crates/tracing/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/tracing/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/tracing/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-95663e563c4c235300ea1781"><span class="term-fg1">diff --git reth&#47;crates&#47;tracing&#47;Cargo.toml scroll-reth&#47;crates&#47;tracing&#47;Cargo.toml</span>
<span class="term-fg1">index 59631365d603358606a58e20799f554153781354..d944b5eeeb61091bccad2933697d9fd6b9d674d4 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;tracing&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;tracing&#47;Cargo.toml</span>
<span class="term-fg36">@@ -13,7 +13,7 @@</span> workspace = true
&nbsp;
 [dependencies]
 tracing.workspace = true
<span class="term-fg31">-tracing-subscriber = { version = &quot;0.3&quot;, default-features = false, features = [&quot;env-filter&quot;, &quot;fmt&quot;, &quot;json&quot;] }</span>
<span class="term-fg32">+tracing-subscriber = { version = &quot;0.3&quot;, default-features = false, features = [&quot;env-filter&quot;, &quot;fmt&quot;, &quot;ansi&quot;, &quot;json&quot;] }</span>
 tracing-appender.workspace = true
 tracing-journald = &quot;0.3&quot;
 tracing-logfmt = &quot;0.3.3&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0318bf77b552c21d932fa6a4" role="button"
                       aria-expanded="false" aria-controls="id-0318bf77b552c21d932fa6a4">
                        <code>crates/tracing/src/formatter.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/tracing/src/formatter.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/tracing/src/formatter.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0318bf77b552c21d932fa6a4"><span class="term-fg1">diff --git reth&#47;crates&#47;tracing&#47;src&#47;formatter.rs scroll-reth&#47;crates&#47;tracing&#47;src&#47;formatter.rs</span>
<span class="term-fg1">index 1322377f1c9faf5d01cad726db3ce9a6357d2543..202a92136d26212e2632a93a6cef71943fe809df 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;tracing&#47;src&#47;formatter.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;tracing&#47;src&#47;formatter.rs</span>
<span class="term-fg36">@@ -54,7 +54,7 @@</span>             .map(|val| val != &quot;0&quot;)
             .unwrap_or_else(|_|
                 &#47;&#47; If `RUST_LOG_TARGET` is not set, show target in logs only if the max enabled
                 &#47;&#47; level is higher than INFO (DEBUG, TRACE)
<span class="term-fg31">-                filter.max_level_hint().map_or(true, |max_level| max_level &gt; tracing::Level::INFO));</span>
<span class="term-fg32">+                filter.max_level_hint().is_none_or(|max_level| max_level &gt; tracing::Level::INFO));</span>
&nbsp;
         match self {
             Self::Json =&gt; {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2cf81dcd46b6f55825c5773f" role="button"
                       aria-expanded="false" aria-controls="id-2cf81dcd46b6f55825c5773f">
                        <code>crates/transaction-pool/src/maintain.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/transaction-pool/src/maintain.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/transaction-pool/src/maintain.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2cf81dcd46b6f55825c5773f"><span class="term-fg1">diff --git reth&#47;crates&#47;transaction-pool&#47;src&#47;maintain.rs scroll-reth&#47;crates&#47;transaction-pool&#47;src&#47;maintain.rs</span>
<span class="term-fg1">index 02f218d4b098b389b12e7d6cbd135c2c0bc07181..6763deb02e6031d6cfdb20857a8d3c9afee2b0fe 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;transaction-pool&#47;src&#47;maintain.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;transaction-pool&#47;src&#47;maintain.rs</span>
<span class="term-fg36">@@ -461,7 +461,7 @@</span>     fn update(&amp;mut self, finalized_block: Option&lt;BlockNumber&gt;) -&gt; Option&lt;BlockNumber&gt; {
         let finalized = finalized_block?;
         self.last_finalized_block
             .replace(finalized)
<span class="term-fg31">-            .map_or(true, |last| last &lt; finalized)</span>
<span class="term-fg32">+            .is_none_or(|last| last &lt; finalized)</span>
             .then_some(finalized)
     }
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7cfdb5e6fab52c6b1e8ea690" role="button"
                       aria-expanded="false" aria-controls="id-7cfdb5e6fab52c6b1e8ea690">
                        <code>crates/transaction-pool/src/pool/best.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/crates/transaction-pool/src/pool/best.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/crates/transaction-pool/src/pool/best.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7cfdb5e6fab52c6b1e8ea690"><span class="term-fg1">diff --git reth&#47;crates&#47;transaction-pool&#47;src&#47;pool&#47;best.rs scroll-reth&#47;crates&#47;transaction-pool&#47;src&#47;pool&#47;best.rs</span>
<span class="term-fg1">index a4c91aae726845676711d2e4a9c60b962485c7bd..ed94bc676236252de0750325c4c54af68defcd18 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;transaction-pool&#47;src&#47;pool&#47;best.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;transaction-pool&#47;src&#47;pool&#47;best.rs</span>
<span class="term-fg36">@@ -57,7 +57,7 @@</span>             &#47;&#47; the transaction
             if best.transaction.max_fee_per_gas() &gt;= self.base_fee as u128 &amp;&amp;
                 best.transaction
                     .max_fee_per_blob_gas()
<span class="term-fg31">-                    .map_or(true, |fee| fee &gt;= self.base_fee_per_blob_gas as u128)</span>
<span class="term-fg32">+                    .is_none_or(|fee| fee &gt;= self.base_fee_per_blob_gas as u128)</span>
             {
                 return Some(best);
             }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0ace8210c7e41d05a2cf40c7" role="button"
                       aria-expanded="false" aria-controls="id-0ace8210c7e41d05a2cf40c7">
                        <code>deny.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/deny.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/deny.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0ace8210c7e41d05a2cf40c7"><span class="term-fg1">diff --git reth&#47;deny.toml scroll-reth&#47;deny.toml</span>
<span class="term-fg1">index 8d0807f9de5c63618c5ca26f05ae75a198d95715..71715c505f30dd18c2a3ebd1ac53632a9e6e144a 100644</span>
<span class="term-fg1">--- reth&#47;deny.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;deny.toml</span>
<span class="term-fg36">@@ -67,6 +67,11 @@</span>     { allow = [&quot;MPL-2.0&quot;], name = &quot;option-ext&quot; },
     { allow = [&quot;MPL-2.0&quot;], name = &quot;webpki-roots&quot; },
 ]
&nbsp;
<span class="term-fg32">+# Skip the poseidon-bn254, bn254 and zktrie crates for license verification. We should at some point publish a license for them.</span>
<span class="term-fg32">+[licenses.private]</span>
<span class="term-fg32">+ignore = true</span>
<span class="term-fg32">+ignore-sources = [&quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254&quot;, &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;bn254&quot;, &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;zktrie.git&quot;]</span>
<span class="term-fg32">+</span>
 [[licenses.clarify]]
 name = &quot;ring&quot;
 expression = &quot;LicenseRef-ring&quot;
<span class="term-fg36">@@ -93,4 +98,13 @@</span>     &quot;https:&#47;&#47;github.com&#47;alloy-rs&#47;alloy&quot;,
     &quot;https:&#47;&#47;github.com&#47;foundry-rs&#47;block-explorers&quot;,
     &quot;https:&#47;&#47;github.com&#47;bluealloy&#47;revm&quot;,
     &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;revm-inspectors&quot;,
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;bn254&quot;,</span>
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;sp1-intrinsics&quot;,</span>
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254&quot;,</span>
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;zktrie.git&quot;,</span>
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;gobuild.git&quot;,</span>
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;alloy-eips&quot;,</span>
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;ff&quot;,</span>
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;revm.git&quot;,</span>
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;alloy-core.git&quot;</span>
 ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-01555c05b18e165013539ba3" role="button"
                       aria-expanded="false" aria-controls="id-01555c05b18e165013539ba3">
                        <code>examples/beacon-api-sidecar-fetcher/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/beacon-api-sidecar-fetcher/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/beacon-api-sidecar-fetcher/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-01555c05b18e165013539ba3"><span class="term-fg1">diff --git reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;Cargo.toml scroll-reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;Cargo.toml</span>
<span class="term-fg1">index d9590f87e07a3d38ead9152d257034000f9e4e47..d30ce6b0824442bcb0359a9d9c63aa20aad54a85 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;Cargo.toml</span>
<span class="term-fg36">@@ -20,3 +20,6 @@</span> reqwest.workspace = true
 serde_json.workspace = true
 serde.workspace = true
 thiserror.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-83fd455de52fc1c78861f725" role="button"
                       aria-expanded="false" aria-controls="id-83fd455de52fc1c78861f725">
                        <code>examples/beacon-api-sidecar-fetcher/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/beacon-api-sidecar-fetcher/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/beacon-api-sidecar-fetcher/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-83fd455de52fc1c78861f725"><span class="term-fg1">diff --git reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;src&#47;main.rs scroll-reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;src&#47;main.rs</span>
<span class="term-fg1">index a0b9b6e01ec8cf05e6b519649d2c40ad74aedfb0..473d986604d4561f7d7fa0651fcc82aec520284f 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -12,6 +12,9 @@</span> &#47;&#47;!
 &#47;&#47;! See beacon Node API: &lt;https:&#47;&#47;ethereum.github.io&#47;beacon-APIs&#47;&gt;
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use std::{
     collections::VecDeque,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ef2758a3c69714447cd2d9a4" role="button"
                       aria-expanded="false" aria-controls="id-ef2758a3c69714447cd2d9a4">
                        <code>examples/beacon-api-sse/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/beacon-api-sse/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/beacon-api-sse/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ef2758a3c69714447cd2d9a4"><span class="term-fg1">diff --git reth&#47;examples&#47;beacon-api-sse&#47;Cargo.toml scroll-reth&#47;examples&#47;beacon-api-sse&#47;Cargo.toml</span>
<span class="term-fg1">index ca49897c9ee067662d047d867e75e69cc6729683..6b759aa355501bee900b923c10edfc81f3b5a498 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;beacon-api-sse&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;beacon-api-sse&#47;Cargo.toml</span>
<span class="term-fg36">@@ -16,3 +16,6 @@</span> futures-util.workspace = true
 mev-share-sse = { version = &quot;0.4.0&quot;, default-features = false }
 tokio = { workspace = true, features = [&quot;time&quot;] }
 tracing.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7f07cc89e8055b8563eeba23" role="button"
                       aria-expanded="false" aria-controls="id-7f07cc89e8055b8563eeba23">
                        <code>examples/beacon-api-sse/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/beacon-api-sse/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/beacon-api-sse/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7f07cc89e8055b8563eeba23"><span class="term-fg1">diff --git reth&#47;examples&#47;beacon-api-sse&#47;src&#47;main.rs scroll-reth&#47;examples&#47;beacon-api-sse&#47;src&#47;main.rs</span>
<span class="term-fg1">index 243511d4960ee06f84d00cb62001886668eb9209..00af7b39f8189bd627380c7e013aa6804dc39149 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;beacon-api-sse&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;beacon-api-sse&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -16,6 +16,9 @@</span> &#47;&#47;!
 &#47;&#47;! See lighthouse beacon Node API: &lt;https:&#47;&#47;lighthouse-book.sigmaprime.io&#47;api-bn.html#beacon-node-api&gt;
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_rpc_types_beacon::events::PayloadAttributesEvent;
 use clap::Parser;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-82a4d5d17519acd9444427f0" role="button"
                       aria-expanded="false" aria-controls="id-82a4d5d17519acd9444427f0">
                        <code>examples/custom-beacon-withdrawals/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-beacon-withdrawals/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/custom-beacon-withdrawals/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-82a4d5d17519acd9444427f0"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-beacon-withdrawals&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-beacon-withdrawals&#47;Cargo.toml</span>
<span class="term-fg1">index c396ca11df8bd03b44535914a3dbe1643b4e67d3..b4a2e62e7b0e0629d16f75b0099914e3541fccc4 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-beacon-withdrawals&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-beacon-withdrawals&#47;Cargo.toml</span>
<span class="term-fg36">@@ -13,6 +13,9 @@</span> reth-chainspec.workspace = true
 reth-evm.workspace = true
 reth-primitives.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+</span>
 alloy-sol-macro = &quot;0.8.9&quot;
 alloy-sol-types.workspace = true
 alloy-eips.workspace = true
<span class="term-fg36">@@ -23,4 +26,5 @@</span>
 [features]
 optimism = [
   &quot;reth-primitives&#47;optimism&quot;
<span class="term-fg31">-]</span>
<span class="term-fg31">\ No newline at end of file</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = []</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2b56ca7ddb3aea42aa11cb56" role="button"
                       aria-expanded="false" aria-controls="id-2b56ca7ddb3aea42aa11cb56">
                        <code>examples/custom-beacon-withdrawals/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-beacon-withdrawals/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/custom-beacon-withdrawals/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2b56ca7ddb3aea42aa11cb56"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-beacon-withdrawals&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-beacon-withdrawals&#47;src&#47;main.rs</span>
<span class="term-fg1">index ccba73afbc1de796eede788736dde26cda16cdd3..ad0ae4bb2634efb87aefafa9f9d2d74174151fdc 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-beacon-withdrawals&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-beacon-withdrawals&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -2,6 +2,9 @@</span> &#47;&#47;! Example for how to modify a block post-execution step. It credits beacon withdrawals with a
 &#47;&#47;! custom mechanism instead of minting native tokens
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_eips::{eip4895::Withdrawal, eip7685::Requests};
 use alloy_sol_macro::sol;
<span class="term-fg36">@@ -16,6 +19,7 @@</span>     providers::ProviderError,
     revm::{
         interpreter::Host,
         primitives::{address, Address, Bytes, Env, EnvWithHandlerCfg, TransactTo, TxEnv, U256},
<span class="term-fg32">+        shared::BundleState,</span>
         Database, DatabaseCommit, Evm, State,
     },
 };
<span class="term-fg36">@@ -27,6 +31,7 @@</span> };
 use reth_evm_ethereum::EthEvmConfig;
 use reth_node_ethereum::{node::EthereumAddOns, BasicBlockExecutorProvider, EthereumNode};
 use reth_primitives::{BlockWithSenders, Receipt};
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use std::{fmt::Display, sync::Arc};
&nbsp;
 pub const SYSTEM_ADDRESS: Address = address!(&quot;fffffffffffffffffffffffffffffffffffffffe&quot;);
<span class="term-fg36">@@ -88,11 +93,15 @@</span>     evm_config: EthEvmConfig,
 }
&nbsp;
 impl BlockExecutionStrategyFactory for CustomExecutorStrategyFactory {
<span class="term-fg31">-    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = CustomExecutorStrategy&lt;DB&gt;;</span>
<span class="term-fg32">+    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = CustomExecutorStrategy&lt;DB&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn create_strategy&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Strategy&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         let state =
             State::builder().with_database(db).with_bundle_update().without_state_clear().build();
<span class="term-fg36">@@ -138,6 +147,7 @@</span>
 impl&lt;DB&gt; BlockExecutionStrategy&lt;DB&gt; for CustomExecutorStrategy&lt;DB&gt;
 where
     DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     type Error = BlockExecutionError;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b604dbbd98fe3eef5a0ff677" role="button"
                       aria-expanded="false" aria-controls="id-b604dbbd98fe3eef5a0ff677">
                        <code>examples/custom-dev-node/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-dev-node/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/custom-dev-node/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b604dbbd98fe3eef5a0ff677"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-dev-node&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-dev-node&#47;Cargo.toml</span>
<span class="term-fg1">index 8ed277686f4e53ac30d54cd8ffe6d943b67854ad..f101b22adbc3bbb863a15db612d368f89e555d8f 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-dev-node&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-dev-node&#47;Cargo.toml</span>
<span class="term-fg36">@@ -19,3 +19,6 @@</span> serde_json.workspace = true
&nbsp;
 alloy-genesis.workspace = true
 alloy-primitives.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e10fa444be8def83fe692b05" role="button"
                       aria-expanded="false" aria-controls="id-e10fa444be8def83fe692b05">
                        <code>examples/custom-dev-node/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-dev-node/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/custom-dev-node/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e10fa444be8def83fe692b05"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-dev-node&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-dev-node&#47;src&#47;main.rs</span>
<span class="term-fg1">index 42bb83782aa3e9a226efa45b0b451e805c1f7a4a..ffe6e002b94cc102eac8c5267d3b7f360076e66a 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-dev-node&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-dev-node&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -2,6 +2,9 @@</span> &#47;&#47;! This example shows how to run a custom dev node programmatically and submit a transaction
 &#47;&#47;! through rpc.
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use std::sync::Arc;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9c406b0bf014218478a7ea69" role="button"
                       aria-expanded="false" aria-controls="id-9c406b0bf014218478a7ea69">
                        <code>examples/custom-engine-types/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-engine-types/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/custom-engine-types/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9c406b0bf014218478a7ea69"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-engine-types&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-engine-types&#47;Cargo.toml</span>
<span class="term-fg1">index d6642a8edfe5e9dbef84c58672b4e326b7a4f707..68a72f676c1dd4606920c16c3402bb4f71b7b34e 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-engine-types&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-engine-types&#47;Cargo.toml</span>
<span class="term-fg36">@@ -25,3 +25,6 @@</span> eyre.workspace = true
 tokio.workspace = true
 thiserror.workspace = true
 serde.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1d62483acb5983a0cfbc379c" role="button"
                       aria-expanded="false" aria-controls="id-1d62483acb5983a0cfbc379c">
                        <code>examples/custom-engine-types/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-engine-types/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/custom-engine-types/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1d62483acb5983a0cfbc379c"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-engine-types&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-engine-types&#47;src&#47;main.rs</span>
<span class="term-fg1">index f9ac5c2386590321c0593946f227ffd31d05a8e1..c769e5bd53854beb642fe07647c2f560e4d762a6 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-engine-types&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-engine-types&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,21 +1,24 @@</span>
<span class="term-fg31">-&#47;&#47;! This example shows how to implement a custom [EngineTypes].</span>
<span class="term-fg32">+&#47;&#47;! This example shows how to implement a custom `EngineTypes`.</span>
 &#47;&#47;!
<span class="term-fg31">-&#47;&#47;! The [EngineTypes] trait can be implemented to configure the engine to work with custom types,</span>
<span class="term-fg32">+&#47;&#47;! The `EngineTypes` trait can be implemented to configure the engine to work with custom types,</span>
 &#47;&#47;! as long as those types implement certain traits.
 &#47;&#47;!
 &#47;&#47;! Custom payload attributes can be supported by implementing two main traits:
 &#47;&#47;!
<span class="term-fg31">-&#47;&#47;! [PayloadAttributes] can be implemented for payload attributes types that are used as</span>
<span class="term-fg32">+&#47;&#47;! `PayloadAttributes` can be implemented for payload attributes types that are used as</span>
 &#47;&#47;! arguments to the `engine_forkchoiceUpdated` method. This type should be used to define and
 &#47;&#47;! _spawn_ payload jobs.
 &#47;&#47;!
<span class="term-fg31">-&#47;&#47;! [PayloadBuilderAttributes] can be implemented for payload attributes types that _describe_</span>
<span class="term-fg32">+&#47;&#47;! `PayloadBuilderAttributes` can be implemented for payload attributes types that _describe_</span>
 &#47;&#47;! running payload jobs.
 &#47;&#47;!
<span class="term-fg31">-&#47;&#47;! Once traits are implemented and custom types are defined, the [EngineTypes] trait can be</span>
<span class="term-fg32">+&#47;&#47;! Once traits are implemented and custom types are defined, the `EngineTypes` trait can be</span>
 &#47;&#47;! implemented:
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_eips::eip4895::Withdrawals;
 use alloy_genesis::Genesis;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b4c3db833fbd8bec431dd054" role="button"
                       aria-expanded="false" aria-controls="id-b4c3db833fbd8bec431dd054">
                        <code>examples/custom-evm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-evm/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/custom-evm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b4c3db833fbd8bec431dd054"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-evm&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-evm&#47;Cargo.toml</span>
<span class="term-fg1">index e763a932eabfbc7d39d2d22560ab915491444406..a807fe3aa9b7474ac3316e4f427ca1530745132c 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-evm&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-evm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -20,3 +20,6 @@</span> alloy-consensus.workspace = true
&nbsp;
 eyre.workspace = true
 tokio.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8f06eec5571426c18b4841b1" role="button"
                       aria-expanded="false" aria-controls="id-8f06eec5571426c18b4841b1">
                        <code>examples/custom-evm/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-evm/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/custom-evm/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8f06eec5571426c18b4841b1"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-evm&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-evm&#47;src&#47;main.rs</span>
<span class="term-fg1">index b9a4fc26a95b4bce9d246c3123085f3f02c6c9ee..4958cb44ce2989f4436552cbb3544f580251bb79 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-evm&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-evm&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,6 +1,9 @@</span>
 &#47;&#47;! This example shows how to implement a node with a custom EVM
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_consensus::Header;
 use alloy_genesis::Genesis;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f287e5d1be4c5b729e6b40bf" role="button"
                       aria-expanded="false" aria-controls="id-f287e5d1be4c5b729e6b40bf">
                        <code>examples/custom-inspector/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-inspector/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/custom-inspector/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f287e5d1be4c5b729e6b40bf"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-inspector&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-inspector&#47;Cargo.toml</span>
<span class="term-fg1">index ee6f887e64c0db02e2e2be7000c1c5f27bc128c2..3566eb3557111c6e89491573d824bdc613f693e8 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-inspector&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-inspector&#47;Cargo.toml</span>
<span class="term-fg36">@@ -12,4 +12,8 @@</span> alloy-rpc-types-eth.workspace = true
 clap = { workspace = true, features = [&quot;derive&quot;] }
 futures-util.workspace = true
 alloy-primitives.workspace = true
<span class="term-fg32">+</span>
 alloy-eips.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-19086c99e975ed2bdf81c707" role="button"
                       aria-expanded="false" aria-controls="id-19086c99e975ed2bdf81c707">
                        <code>examples/custom-inspector/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-inspector/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/custom-inspector/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-19086c99e975ed2bdf81c707"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-inspector&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-inspector&#47;src&#47;main.rs</span>
<span class="term-fg1">index 67863d00e1e92124ba22aa229ef874a706bda8fc..dccc30eaecd3bdf9efb67eb67f945dd189622c73 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-inspector&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-inspector&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -9,6 +9,9 @@</span> &#47;&#47;!
 &#47;&#47;! If no recipients are specified, all transactions will be inspected.
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_eips::BlockNumberOrTag;
 use alloy_primitives::Address;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-bd94be2741b3c5f86827cf75" role="button"
                       aria-expanded="false" aria-controls="id-bd94be2741b3c5f86827cf75">
                        <code>examples/custom-node-components/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-node-components/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/custom-node-components/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-bd94be2741b3c5f86827cf75"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-node-components&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-node-components&#47;Cargo.toml</span>
<span class="term-fg1">index 507088970de863d51821329b0e56d5e51c1a8d98..43940db3e3c4e4f8ad9f1fb9ef27a4267917c462 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-node-components&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-node-components&#47;Cargo.toml</span>
<span class="term-fg36">@@ -13,3 +13,6 @@</span> reth-transaction-pool.workspace = true
 reth-tracing.workspace = true
&nbsp;
 eyre.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-834b6317c7cb67f6287321f3" role="button"
                       aria-expanded="false" aria-controls="id-834b6317c7cb67f6287321f3">
                        <code>examples/custom-node-components/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-node-components/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/custom-node-components/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-834b6317c7cb67f6287321f3"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-node-components&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-node-components&#47;src&#47;main.rs</span>
<span class="term-fg1">index 7924aabd86926d6e699362255f9f04c5412e632b..80cba50a843855218222c9c66bbf48f4724138d6 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-node-components&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-node-components&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,6 +1,9 @@</span>
 &#47;&#47;! This example shows how to configure custom components for a reth node.
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use reth::{
     api::NodeTypes,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-91314197dfff96efb733087f" role="button"
                       aria-expanded="false" aria-controls="id-91314197dfff96efb733087f">
                        <code>examples/custom-payload-builder/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-payload-builder/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/custom-payload-builder/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-91314197dfff96efb733087f"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-payload-builder&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-payload-builder&#47;Cargo.toml</span>
<span class="term-fg1">index b77a3f2945ca54fd8052fc2b9e06b7c5e88fa575..b60c87803c9423a28acaded02c72e9d094270191 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-payload-builder&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-payload-builder&#47;Cargo.toml</span>
<span class="term-fg36">@@ -21,3 +21,6 @@</span>
 tracing.workspace = true
 futures-util.workspace = true
 eyre.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0077cf722fd8616f641ce081" role="button"
                       aria-expanded="false" aria-controls="id-0077cf722fd8616f641ce081">
                        <code>examples/custom-payload-builder/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-payload-builder/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/custom-payload-builder/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0077cf722fd8616f641ce081"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-payload-builder&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-payload-builder&#47;src&#47;main.rs</span>
<span class="term-fg1">index 6047da0dd1ba480e8630d340d425c131acb7c1e4..81ecf29270e732632f67923b6562a24bfae8f68b 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-payload-builder&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-payload-builder&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -10,6 +10,9 @@</span> &#47;&#47;!
 &#47;&#47;! This launch the regular reth node overriding the engine api payload builder with our custom.
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use generator::EmptyBlockPayloadJobGenerator;
 use reth::{</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a5d769683e58b6c6147498db" role="button"
                       aria-expanded="false" aria-controls="id-a5d769683e58b6c6147498db">
                        <code>examples/custom-rlpx-subprotocol/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-rlpx-subprotocol/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/custom-rlpx-subprotocol/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a5d769683e58b6c6147498db"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-rlpx-subprotocol&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-rlpx-subprotocol&#47;Cargo.toml</span>
<span class="term-fg1">index 18c136671c06718e581b7cbcd978f69e38fb967f..5fd30de7fafacef5bad46146333f8da529d52dc1 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-rlpx-subprotocol&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-rlpx-subprotocol&#47;Cargo.toml</span>
<span class="term-fg36">@@ -19,3 +19,6 @@</span> eyre.workspace = true
 rand.workspace = true
 tracing.workspace = true
 alloy-primitives.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-76bc9ef7a899e216d373673d" role="button"
                       aria-expanded="false" aria-controls="id-76bc9ef7a899e216d373673d">
                        <code>examples/custom-rlpx-subprotocol/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/custom-rlpx-subprotocol/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/custom-rlpx-subprotocol/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-76bc9ef7a899e216d373673d"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-rlpx-subprotocol&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-rlpx-subprotocol&#47;src&#47;main.rs</span>
<span class="term-fg1">index 702d0e8cf5effe913b768b8832eb1959c0b50ce0..84a4f42645c597af71cb6abdd011a9b835dab8f8 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-rlpx-subprotocol&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-rlpx-subprotocol&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -8,6 +8,10 @@</span> &#47;&#47;! ```
 &#47;&#47;!
 &#47;&#47;! This launch a regular reth node with a custom rlpx subprotocol.
&nbsp;
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 mod subprotocol;
&nbsp;
 use std::net::{Ipv4Addr, SocketAddr, SocketAddrV4};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5c3057f472973170a987a790" role="button"
                       aria-expanded="false" aria-controls="id-5c3057f472973170a987a790">
                        <code>examples/db-access/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/db-access/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/db-access/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5c3057f472973170a987a790"><span class="term-fg1">diff --git reth&#47;examples&#47;db-access&#47;Cargo.toml scroll-reth&#47;examples&#47;db-access&#47;Cargo.toml</span>
<span class="term-fg1">index 3310d1cbd67646daa3771a2727a0bd68df1d441c..1d468700dba2dddc09c0014c7343412f3ef2b4bf 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;db-access&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;db-access&#47;Cargo.toml</span>
<span class="term-fg36">@@ -19,3 +19,6 @@</span> alloy-primitives.workspace = true
&nbsp;

 eyre.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ac66aa7fb8532bef279721a3" role="button"
                       aria-expanded="false" aria-controls="id-ac66aa7fb8532bef279721a3">
                        <code>examples/db-access/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/db-access/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/db-access/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ac66aa7fb8532bef279721a3"><span class="term-fg1">diff --git reth&#47;examples&#47;db-access&#47;src&#47;main.rs scroll-reth&#47;examples&#47;db-access&#47;src&#47;main.rs</span>
<span class="term-fg1">index 9f95fb51d91a472934b91cc02b7d512f1dd63615..7bc89b2a8f46b61a9dcecd2524b450a68f5c3fb3 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;db-access&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;db-access&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,3 +1,7 @@</span>
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 use alloy_primitives::{Address, B256};
 use alloy_rpc_types_eth::{Filter, FilteredParams};
 use reth_chainspec::ChainSpecBuilder;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1f3cc60b3dabff95b0cf30c0" role="button"
                       aria-expanded="false" aria-controls="id-1f3cc60b3dabff95b0cf30c0">
                        <code>examples/node-custom-rpc/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/node-custom-rpc/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/node-custom-rpc/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1f3cc60b3dabff95b0cf30c0"><span class="term-fg1">diff --git reth&#47;examples&#47;node-custom-rpc&#47;Cargo.toml scroll-reth&#47;examples&#47;node-custom-rpc&#47;Cargo.toml</span>
<span class="term-fg1">index e82254757ec1d34e2532256bf2a64a90955aa255..13aa5872fccf272e7f1049050cb4adfb09e4e7ac 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;node-custom-rpc&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;node-custom-rpc&#47;Cargo.toml</span>
<span class="term-fg36">@@ -15,3 +15,6 @@</span> jsonrpsee = { workspace = true, features = [&quot;server&quot;, &quot;macros&quot;] }
&nbsp;
 [dev-dependencies]
 tokio.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-93b5b22d1dc8ef2b0638436e" role="button"
                       aria-expanded="false" aria-controls="id-93b5b22d1dc8ef2b0638436e">
                        <code>examples/node-custom-rpc/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/node-custom-rpc/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/node-custom-rpc/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-93b5b22d1dc8ef2b0638436e"><span class="term-fg1">diff --git reth&#47;examples&#47;node-custom-rpc&#47;src&#47;main.rs scroll-reth&#47;examples&#47;node-custom-rpc&#47;src&#47;main.rs</span>
<span class="term-fg1">index 92e0bfea26e9b94af0c8ed2f48191377034024ee..889924b5e8d96b8277984cbdb9cc71ae6e5e499e 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;node-custom-rpc&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;node-custom-rpc&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -12,6 +12,10 @@</span> &#47;&#47;! ```sh
 &#47;&#47;! cast rpc txpoolExt_transactionCount
 &#47;&#47;! ```
&nbsp;
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 use clap::Parser;
 use jsonrpsee::{core::RpcResult, proc_macros::rpc};
 use reth::{chainspec::EthereumChainSpecParser, cli::Cli};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4516600d9c111fbf1d9acbf3" role="button"
                       aria-expanded="false" aria-controls="id-4516600d9c111fbf1d9acbf3">
                        <code>examples/node-event-hooks/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/node-event-hooks/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/node-event-hooks/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4516600d9c111fbf1d9acbf3"><span class="term-fg1">diff --git reth&#47;examples&#47;node-event-hooks&#47;Cargo.toml scroll-reth&#47;examples&#47;node-event-hooks&#47;Cargo.toml</span>
<span class="term-fg1">index 450f6f006b287fc58fb01e1ddd98df239161c8e0..2e01b99a8893b79b598c35fac9ab7c533369a75c 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;node-event-hooks&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;node-event-hooks&#47;Cargo.toml</span>
<span class="term-fg36">@@ -8,3 +8,6 @@</span>
 [dependencies]
 reth.workspace = true
 reth-node-ethereum.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-91091fb392d6cd7ffd2e4f27" role="button"
                       aria-expanded="false" aria-controls="id-91091fb392d6cd7ffd2e4f27">
                        <code>examples/node-event-hooks/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/node-event-hooks/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/node-event-hooks/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-91091fb392d6cd7ffd2e4f27"><span class="term-fg1">diff --git reth&#47;examples&#47;node-event-hooks&#47;src&#47;main.rs scroll-reth&#47;examples&#47;node-event-hooks&#47;src&#47;main.rs</span>
<span class="term-fg1">index e8a751840e0dab68d2c04d7e4599c973562a6229..a3dc823ccc0730d02f298f98bcd768e0cc706744 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;node-event-hooks&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;node-event-hooks&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -11,6 +11,10 @@</span> &#47;&#47;! This launch the regular reth node and also print:
 &#47;&#47;! &gt; &quot;All components initialized&quot; – once all components have been initialized
 &#47;&#47;! &gt; &quot;Node started&quot; – once the node has been started.
&nbsp;
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 use reth::cli::Cli;
 use reth_node_ethereum::EthereumNode;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0979699c91ff95d177f6fc65" role="button"
                       aria-expanded="false" aria-controls="id-0979699c91ff95d177f6fc65">
                        <code>examples/rpc-db/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/rpc-db/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/rpc-db/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0979699c91ff95d177f6fc65"><span class="term-fg1">diff --git reth&#47;examples&#47;rpc-db&#47;Cargo.toml scroll-reth&#47;examples&#47;rpc-db&#47;Cargo.toml</span>
<span class="term-fg1">index 262b3df8babc91f322e4482d81401e97c5f21ebd..cce1b763d7fa762901f263733d8edcb045ffbcba 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;rpc-db&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;rpc-db&#47;Cargo.toml</span>
<span class="term-fg36">@@ -15,3 +15,6 @@</span> reth-node-ethereum.workspace = true
 reth-provider = { workspace = true, features = [&quot;test-utils&quot;] }
 tokio = { workspace = true, features = [&quot;full&quot;] }
 eyre.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-19b6a3293f142bf637c7deee" role="button"
                       aria-expanded="false" aria-controls="id-19b6a3293f142bf637c7deee">
                        <code>examples/rpc-db/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/rpc-db/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/rpc-db/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-19b6a3293f142bf637c7deee"><span class="term-fg1">diff --git reth&#47;examples&#47;rpc-db&#47;src&#47;main.rs scroll-reth&#47;examples&#47;rpc-db&#47;src&#47;main.rs</span>
<span class="term-fg1">index 92ae86f00bb9b3464cfabb373660997b535f241b..99d152a7d0e157e1608792c3cf347bc123a5416b 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;rpc-db&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;rpc-db&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -12,6 +12,10 @@</span> &#47;&#47;! ```sh
 &#47;&#47;! cast rpc myrpcExt_customMethod
 &#47;&#47;! ```
&nbsp;
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 use std::{path::Path, sync::Arc};
&nbsp;
 use reth::{</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9f60ec3c90223b0b7842337a" role="button"
                       aria-expanded="false" aria-controls="id-9f60ec3c90223b0b7842337a">
                        <code>examples/stateful-precompile/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/stateful-precompile/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/stateful-precompile/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9f60ec3c90223b0b7842337a"><span class="term-fg1">diff --git reth&#47;examples&#47;stateful-precompile&#47;Cargo.toml scroll-reth&#47;examples&#47;stateful-precompile&#47;Cargo.toml</span>
<span class="term-fg1">index 478886d061f812d73f036c2f1c2b332097e5752b..7488cc497beed70400a84d8df6f6830395eebdec 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;stateful-precompile&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;stateful-precompile&#47;Cargo.toml</span>
<span class="term-fg36">@@ -21,3 +21,6 @@</span> eyre.workspace = true
 parking_lot.workspace = true
 schnellru.workspace = true
 tokio.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e4e9a8419f1bea4f3090c6c9" role="button"
                       aria-expanded="false" aria-controls="id-e4e9a8419f1bea4f3090c6c9">
                        <code>examples/stateful-precompile/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/stateful-precompile/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/stateful-precompile/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e4e9a8419f1bea4f3090c6c9"><span class="term-fg1">diff --git reth&#47;examples&#47;stateful-precompile&#47;src&#47;main.rs scroll-reth&#47;examples&#47;stateful-precompile&#47;src&#47;main.rs</span>
<span class="term-fg1">index f683af4e430a39189328f7cd498860ab6fe2873e..718779cab8290d3ac351dd87a11c7955d25340ca 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;stateful-precompile&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;stateful-precompile&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,6 +1,9 @@</span>
 &#47;&#47;! This example shows how to implement a node with a custom EVM that uses a stateful precompile
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_consensus::Header;
 use alloy_genesis::Genesis;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-84b844dbe71a5f553970e919" role="button"
                       aria-expanded="false" aria-controls="id-84b844dbe71a5f553970e919">
                        <code>examples/txpool-tracing/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/txpool-tracing/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/txpool-tracing/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-84b844dbe71a5f553970e919"><span class="term-fg1">diff --git reth&#47;examples&#47;txpool-tracing&#47;Cargo.toml scroll-reth&#47;examples&#47;txpool-tracing&#47;Cargo.toml</span>
<span class="term-fg1">index 38d0ad9409b6b5921f70922dbf7190b7123f3d53..67e45929a4d4fd2b2270674a344cc01581c50108 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;txpool-tracing&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;txpool-tracing&#47;Cargo.toml</span>
<span class="term-fg36">@@ -12,3 +12,6 @@</span> alloy-rpc-types-trace.workspace = true
 clap = { workspace = true, features = [&quot;derive&quot;] }
 futures-util.workspace = true
 alloy-primitives.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ed85ff399e69efb6fd491bb7" role="button"
                       aria-expanded="false" aria-controls="id-ed85ff399e69efb6fd491bb7">
                        <code>examples/txpool-tracing/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/examples/txpool-tracing/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/examples/txpool-tracing/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ed85ff399e69efb6fd491bb7"><span class="term-fg1">diff --git reth&#47;examples&#47;txpool-tracing&#47;src&#47;main.rs scroll-reth&#47;examples&#47;txpool-tracing&#47;src&#47;main.rs</span>
<span class="term-fg1">index 94f800987a967537325be98e7889b87f12214885..415fd46fad79accc51b2a898421692a372bfd46f 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;txpool-tracing&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;txpool-tracing&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -9,6 +9,9 @@</span> &#47;&#47;!
 &#47;&#47;! If no recipients are specified, all transactions will be traced.
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_primitives::Address;
 use alloy_rpc_types_trace::{parity::TraceType, tracerequest::TraceCallRequest};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-88e43c0c16b25ddec1fe9766" role="button"
                       aria-expanded="false" aria-controls="id-88e43c0c16b25ddec1fe9766">
                        <code>testing/ef-tests/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/testing/ef-tests/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/testing/ef-tests/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-88e43c0c16b25ddec1fe9766"><span class="term-fg1">diff --git reth&#47;testing&#47;ef-tests&#47;Cargo.toml scroll-reth&#47;testing&#47;ef-tests&#47;Cargo.toml</span>
<span class="term-fg1">index 2fc0c7512441691ca58f9bd67b6d2cc4e7f00bbd..72d1fb90893f42fe2d214d5c12cac2cd9113b1c8 100644</span>
<span class="term-fg1">--- reth&#47;testing&#47;ef-tests&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;testing&#47;ef-tests&#47;Cargo.toml</span>
<span class="term-fg36">@@ -18,6 +18,14 @@</span>     &quot;reth-primitives&#47;asm-keccak&quot;,
     &quot;alloy-primitives&#47;asm-keccak&quot;,
     &quot;revm&#47;asm-keccak&quot;,
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-stages&#47;scroll&quot;</span>
<span class="term-fg32">+]</span>
&nbsp;
 [dependencies]
 reth-chainspec.workspace = true
<span class="term-fg36">@@ -34,6 +42,8 @@</span> reth-evm-ethereum.workspace = true
 reth-revm = { workspace = true, features = [&quot;std&quot;] }
&nbsp;
 revm = { workspace = true, features = [&quot;secp256k1&quot;, &quot;blst&quot;, &quot;c-kzg&quot;] }
<span class="term-fg32">+</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
&nbsp;
 alloy-rlp.workspace = true
 alloy-primitives.workspace = true</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ec6762a4cb3f72572bac7d8e" role="button"
                       aria-expanded="false" aria-controls="id-ec6762a4cb3f72572bac7d8e">
                        <code>testing/ef-tests/src/models.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/testing/ef-tests/src/models.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/testing/ef-tests/src/models.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ec6762a4cb3f72572bac7d8e"><span class="term-fg1">diff --git reth&#47;testing&#47;ef-tests&#47;src&#47;models.rs scroll-reth&#47;testing&#47;ef-tests&#47;src&#47;models.rs</span>
<span class="term-fg1">index 292b32e8ce0f4393ac21fd7b8bb6cd29f077e7ae..3e3a25e45a1676951193cbfc47e75297a4d2ed66 100644</span>
<span class="term-fg1">--- reth&#47;testing&#47;ef-tests&#47;src&#47;models.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;testing&#47;ef-tests&#47;src&#47;models.rs</span>
<span class="term-fg36">@@ -162,6 +162,10 @@</span>             let reth_account = RethAccount {
                 balance: account.balance,
                 nonce: account.nonce.to::&lt;u64&gt;(),
                 bytecode_hash: code_hash,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                    &amp;account.code,</span>
<span class="term-fg32">+                )),</span>
             };
             tx.put::&lt;tables::PlainAccountState&gt;(address, reth_account)?;
             tx.put::&lt;tables::HashedAccounts&gt;(hashed_address, reth_account)?;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-67fabe72d75f3fc1a6c9d40a" role="button"
                       aria-expanded="false" aria-controls="id-67fabe72d75f3fc1a6c9d40a">
                        <code>testing/testing-utils/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/testing/testing-utils/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/testing/testing-utils/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-67fabe72d75f3fc1a6c9d40a"><span class="term-fg1">diff --git reth&#47;testing&#47;testing-utils&#47;Cargo.toml scroll-reth&#47;testing&#47;testing-utils&#47;Cargo.toml</span>
<span class="term-fg1">index a6197d7e0cf71510335d81676c278bf5ad085cba..654c526be8959ce3acf45764973d4f8e1ea564c4 100644</span>
<span class="term-fg1">--- reth&#47;testing&#47;testing-utils&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;testing&#47;testing-utils&#47;Cargo.toml</span>
<span class="term-fg36">@@ -25,3 +25,6 @@</span>
 [dev-dependencies]
 alloy-eips.workspace = true
 reth-primitives-traits .workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [&quot;reth-primitives&#47;scroll&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2510a5fc46422bace07a5a19" role="button"
                       aria-expanded="false" aria-controls="id-2510a5fc46422bace07a5a19">
                        <code>testing/testing-utils/src/generators.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/testing/testing-utils/src/generators.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/testing/testing-utils/src/generators.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2510a5fc46422bace07a5a19"><span class="term-fg1">diff --git reth&#47;testing&#47;testing-utils&#47;src&#47;generators.rs scroll-reth&#47;testing&#47;testing-utils&#47;src&#47;generators.rs</span>
<span class="term-fg1">index 9963b447e96d66bf9c361d56db6b43966e135f9e..ae45f0b6fc08e36c0ceab3c7a41fc623fe1b1bb6 100644</span>
<span class="term-fg1">--- reth&#47;testing&#47;testing-utils&#47;src&#47;generators.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;testing&#47;testing-utils&#47;src&#47;generators.rs</span>
<span class="term-fg36">@@ -386,7 +386,16 @@</span>     let nonce: u64 = rng.gen();
     let balance = U256::from(rng.gen::&lt;u32&gt;());
     let addr = rng.gen();
&nbsp;
<span class="term-fg31">-    (addr, Account { nonce, balance, bytecode_hash: None })</span>
<span class="term-fg32">+    (</span>
<span class="term-fg32">+        addr,</span>
<span class="term-fg32">+        Account {</span>
<span class="term-fg32">+            nonce,</span>
<span class="term-fg32">+            balance,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+    )</span>
 }
&nbsp;
 &#47;&#47;&#47; Generate random Externally Owned Accounts</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
        </div>
    </div>
</div>

                
                    <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-c59d3007aef9b0c4ed162f4d"role="button" aria-expanded="false" aria-controls="id-c59d3007aef9b0c4ed162f4d">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h4>Ignored changes</h4></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                
                    <div class="text-end"><span class="text-add-ignored">+138</span></div>
                    <div class="text-start"><span class="text-delete-ignored">-47</span></div>
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-c59d3007aef9b0c4ed162f4d">
        <div></div>
        <div>
            
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-49c9defa10d5ac6ceff9ffea" role="button"
                       aria-expanded="false" aria-controls="id-49c9defa10d5ac6ceff9ffea">
                        <code>.github/assets/check_wasm.sh</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/assets/check_wasm.sh" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/.github/assets/check_wasm.sh" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+3</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-49c9defa10d5ac6ceff9ffea"><span class="term-fg1">diff --git reth&#47;.github&#47;assets&#47;check_wasm.sh scroll-reth&#47;.github&#47;assets&#47;check_wasm.sh</span>
<span class="term-fg1">index 11e5b5e00b9e29ad8943e5b487817a6b324c587b..e887c8d985d1b34b7b4c71eec46054193f5140cd 100755</span>
<span class="term-fg1">--- reth&#47;.github&#47;assets&#47;check_wasm.sh</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;assets&#47;check_wasm.sh</span>
<span class="term-fg36">@@ -70,6 +70,9 @@</span>   reth-static-file # tokio
   reth-transaction-pool # c-kzg
   reth-trie-parallel # tokio
   reth-testing-utils
<span class="term-fg32">+  reth-scroll-cli # tokio</span>
<span class="term-fg32">+  reth-scroll-node # tokio</span>
<span class="term-fg32">+  reth-scroll # tokio</span>
 )
&nbsp;
 # Array to hold the results</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-0ecba966cd87a3323e7d4c51" role="button"
                       aria-expanded="false" aria-controls="id-0ecba966cd87a3323e7d4c51">
                        <code>.github/workflows/bench.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/bench.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/.github/workflows/bench.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+1</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0ecba966cd87a3323e7d4c51"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;bench.yml scroll-reth&#47;.github&#47;workflows&#47;bench.yml</span>
<span class="term-fg1">index 8ddc97441c2a843ca168ac54ddc180fda913838d..b647a81a2267eb91e49317db91a1cce2a1aa4465 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;bench.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;bench.yml</span>
<span class="term-fg36">@@ -18,8 +18,7 @@</span>
 name: bench
 jobs:
   iai:
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     # Only run benchmarks in merge groups and on main
     if: github.event_name != &#39;pull_request&#39;
     steps:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-131cadbabe284a7d32384e5f" role="button"
                       aria-expanded="false" aria-controls="id-131cadbabe284a7d32384e5f">
                        <code>.github/workflows/book.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/book.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/.github/workflows/book.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+2</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-131cadbabe284a7d32384e5f"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;book.yml scroll-reth&#47;.github&#47;workflows&#47;book.yml</span>
<span class="term-fg1">index 56d5c427466e0ef9eefe65daab422e86026b205d..d7f9fe34826e2b0010a0b15b496af508f58ab94c 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;book.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;book.yml</span>
<span class="term-fg36">@@ -4,9 +4,9 @@</span> name: book
&nbsp;
 on:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
   pull_request:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
   merge_group:
&nbsp;
 jobs:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-114aabc81190fdd63007b6e3" role="button"
                       aria-expanded="false" aria-controls="id-114aabc81190fdd63007b6e3">
                        <code>.github/workflows/compact.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/compact.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/.github/workflows/compact.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+4</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-114aabc81190fdd63007b6e3"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;compact.yml scroll-reth&#47;.github&#47;workflows&#47;compact.yml</span>
<span class="term-fg1">index 484b27c820d003caff9b8abdf50e9ce2f9fe3155..44939e4b447c1d33a4d61671b3bce9244bee7417 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;compact.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;compact.yml</span>
<span class="term-fg36">@@ -10,7 +10,7 @@</span>
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [scroll]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -18,8 +18,7 @@</span>
 name: compact-codec
 jobs:
   compact-codec:
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     strategy:
       matrix:
         bin:
<span class="term-fg36">@@ -33,8 +32,8 @@</span>           cache-on-failure: true
       - name: Checkout base
         uses: actions&#47;checkout@v4
         with:
<span class="term-fg31">-          ref: ${{ github.base_ref || &#39;main&#39; }}</span>
<span class="term-fg31">-      # On `main` branch, generates test vectors and serializes them to disk using `Compact`.</span>
<span class="term-fg32">+          ref: ${{ github.base_ref || &#39;scroll&#39; }}</span>
<span class="term-fg32">+      # On `scroll` branch, generates test vectors and serializes them to disk using `Compact`.</span>
       - name: Generate compact vectors
         run: |
           ${{ matrix.bin }} -- test-vectors compact --write</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-efaab804bc1ce59212f1ce8a" role="button"
                       aria-expanded="false" aria-controls="id-efaab804bc1ce59212f1ce8a">
                        <code>.github/workflows/deny.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/deny.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/.github/workflows/deny.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+2</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-efaab804bc1ce59212f1ce8a"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;deny.yml scroll-reth&#47;.github&#47;workflows&#47;deny.yml</span>
<span class="term-fg1">index f85484ca2ec21833a6942fdea82eaf6d15d4ebc4..6908a3d5a56117cac1a581d25953fa4670ba45cd 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;deny.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;deny.yml</span>
<span class="term-fg36">@@ -4,10 +4,10 @@</span> name: deny
&nbsp;
 on:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
     paths: [Cargo.lock]
   pull_request:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
     paths: [Cargo.lock]
   merge_group:
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-7e4f259d236e915001209b63" role="button"
                       aria-expanded="false" aria-controls="id-7e4f259d236e915001209b63">
                        <code>.github/workflows/hive.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/hive.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/.github/workflows/hive.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+4</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-8</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7e4f259d236e915001209b63"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;hive.yml scroll-reth&#47;.github&#47;workflows&#47;hive.yml</span>
<span class="term-fg1">index b8d3f378fca40be3a094856b6205b3139350ee4b..0d8ba91a00c53e7a5b01cb286343dca992ccee56 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;hive.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;hive.yml</span>
<span class="term-fg36">@@ -19,8 +19,7 @@</span> jobs:
   prepare-reth:
     if: github.repository == &#39;paradigmxyz&#47;reth&#39;
     timeout-minutes: 45
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     steps:
       - uses: actions&#47;checkout@v4
       - run: mkdir artifacts
<span class="term-fg36">@@ -53,8 +52,7 @@</span>
   prepare-hive:
     if: github.repository == &#39;paradigmxyz&#47;reth&#39;
     timeout-minutes: 45
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     steps:
       - uses: actions&#47;checkout@v4
       - name: Checkout hive tests
<span class="term-fg36">@@ -181,8 +179,7 @@</span>     needs:
       - prepare-reth
       - prepare-hive
     name: run ${{ matrix.scenario.sim }}${{ matrix.scenario.limit &amp;&amp; format(&#39; - {0}&#39;, matrix.scenario.limit) }}
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     permissions:
       issues: write
     steps:
<span class="term-fg36">@@ -249,8 +246,7 @@</span>           cat hivetests&#47;workspace&#47;logs&#47;reth&#47;client-*.log
   notify-on-error:
     needs: test
     if: failure()
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     steps:
       - name: Slack Webhook Action
         uses: rtCamp&#47;action-slack-notify@v2</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-597c14d0d58906ecb74f955b" role="button"
                       aria-expanded="false" aria-controls="id-597c14d0d58906ecb74f955b">
                        <code>.github/workflows/integration.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/integration.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/.github/workflows/integration.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+4</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-597c14d0d58906ecb74f955b"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;integration.yml scroll-reth&#47;.github&#47;workflows&#47;integration.yml</span>
<span class="term-fg1">index 82bd5705a32001b5e309a55df19974211618ee6e..7ba3395cce84576d6b304c4945f751e1bdc24080 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;integration.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;integration.yml</span>
<span class="term-fg36">@@ -6,7 +6,7 @@</span> on:
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -19,8 +19,7 @@</span>
 jobs:
   test:
     name: test &#47; ${{ matrix.network }}
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_BACKTRACE: 1
     strategy:
<span class="term-fg36">@@ -28,6 +27,8 @@</span>       matrix:
         network: [&quot;ethereum&quot;, &quot;optimism&quot;]
     timeout-minutes: 60
     steps:
<span class="term-fg32">+      - name: Free up disk space</span>
<span class="term-fg32">+        run: rm -rf &#47;opt&#47;hostedtoolcache</span>
       - uses: actions&#47;checkout@v4
       - uses: dtolnay&#47;rust-toolchain@stable
       - name: Install Geth</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-6f95ee78239460112d46002a" role="button"
                       aria-expanded="false" aria-controls="id-6f95ee78239460112d46002a">
                        <code>.github/workflows/lint.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/lint.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/.github/workflows/lint.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+13</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6f95ee78239460112d46002a"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;lint.yml scroll-reth&#47;.github&#47;workflows&#47;lint.yml</span>
<span class="term-fg1">index 7e6b8747fff5971fdd71848d8051a2aa4c7b4bb2..79162876f6e4f68c83c835d9fd3b98698e4819bc 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;lint.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;lint.yml</span>
<span class="term-fg36">@@ -4,7 +4,7 @@</span> on:
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -23,6 +23,9 @@</span>             features: &quot;ethereum asm-keccak jemalloc jemalloc-prof min-error-logs min-warn-logs min-info-logs min-debug-logs min-trace-logs&quot;
           - type: optimism
             args: --bin op-reth --workspace --lib --examples --tests --benches --locked
             features: &quot;optimism asm-keccak jemalloc jemalloc-prof min-error-logs min-warn-logs min-info-logs min-debug-logs min-trace-logs&quot;
<span class="term-fg32">+          - type: scroll</span>
<span class="term-fg32">+            args: --bin scroll-reth --workspace --lib --examples --tests --benches --locked</span>
<span class="term-fg32">+            features: &quot;scroll asm-keccak jemalloc jemalloc-prof min-error-logs min-warn-logs min-info-logs min-debug-logs min-trace-logs&quot;</span>
           - type: book
             args: --manifest-path book&#47;sources&#47;Cargo.toml --workspace --bins
             features: &quot;&quot;
<span class="term-fg36">@@ -85,7 +88,7 @@</span>       - uses: taiki-e&#47;install-action@cargo-hack
       - uses: Swatinem&#47;rust-cache@v2
         with:
           cache-on-failure: true
<span class="term-fg31">-      - run: cargo hack check --workspace --exclude op-reth</span>
<span class="term-fg32">+      - run: cargo hack check --workspace --exclude op-reth --exclude scroll-reth</span>
       - run: cargo check -p op-reth --features &quot;optimism&quot;
&nbsp;
   msrv:
<span class="term-fg36">@@ -152,7 +155,14 @@</span>       - uses: Swatinem&#47;rust-cache@v2
         with:
           cache-on-failure: true
       - uses: taiki-e&#47;install-action@cargo-udeps
<span class="term-fg31">-      - run: cargo udeps --workspace --lib --examples --tests --benches --all-features --locked</span>
<span class="term-fg32">+        # due to the scroll and optimism feature flag, we need to exclude some crates that were annotated with</span>
<span class="term-fg32">+        # #![cfg(not(feature = &quot;scroll))] or #![cfg(not(feature = &quot;optimism&quot;))].</span>
<span class="term-fg32">+      - run: |</span>
<span class="term-fg32">+          cargo udeps --workspace --lib --examples --tests --benches --all-features --locked \</span>
<span class="term-fg32">+            --exclude &quot;reth-optimism-*&quot; --exclude op-reth --exclude &quot;example-*&quot; --exclude reth \</span>
<span class="term-fg32">+            --exclude reth-e2e-test-utils --exclude reth-ethereum-payload-builder --exclude reth-exex-test-utils \</span>
<span class="term-fg32">+            --exclude reth-node-ethereum --exclude scroll-reth --exclude reth-scroll-cli --exclude reth-scroll-evm \</span>
<span class="term-fg32">+            --exclude reth-scroll-node</span>
&nbsp;
   book:
     name: book</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-2679043641650e35e7c73c6b" role="button"
                       aria-expanded="false" aria-controls="id-2679043641650e35e7c73c6b">
                        <code>.github/workflows/pages.yaml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/.github/workflows/pages.yaml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+32</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2679043641650e35e7c73c6b"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;pages.yaml scroll-reth&#47;.github&#47;workflows&#47;pages.yaml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..5717d4c95543c09d59a7d51803826ead2641a5c5</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;pages.yaml</span>
<span class="term-fg36">@@ -0,0 +1,33 @@</span>
<span class="term-fg32">+name: Build and publish forkdiff github-pages</span>
<span class="term-fg32">+permissions:</span>
<span class="term-fg32">+  contents: write</span>
<span class="term-fg32">+on:</span>
<span class="term-fg32">+  push:</span>
<span class="term-fg32">+    branches:</span>
<span class="term-fg32">+      - scroll</span>
<span class="term-fg32">+jobs:</span>
<span class="term-fg32">+  deploy:</span>
<span class="term-fg32">+    concurrency: ci-${{ github.ref }}</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+      - name: Checkout</span>
<span class="term-fg32">+        uses: actions&#47;checkout@v4</span>
<span class="term-fg32">+        with:</span>
<span class="term-fg32">+          fetch-depth: 1000  # make sure to fetch the old commit we diff against</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+      - name: Build forkdiff</span>
<span class="term-fg32">+        uses: &quot;docker:&#47;&#47;protolambda&#47;forkdiff:0.1.0&quot;</span>
<span class="term-fg32">+        with:</span>
<span class="term-fg32">+          args: -repo=&#47;github&#47;workspace -fork=&#47;github&#47;workspace&#47;fork.yaml -out=&#47;github&#47;workspace&#47;index.html</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+      - name: Build pages</span>
<span class="term-fg32">+        run: |</span>
<span class="term-fg32">+          mkdir -p tmp&#47;pages</span>
<span class="term-fg32">+          mv index.html tmp&#47;pages&#47;index.html</span>
<span class="term-fg32">+          touch tmp&#47;pages&#47;.nojekyll</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+      - name: Deploy</span>
<span class="term-fg32">+        uses: JamesIves&#47;github-pages-deploy-action@v4</span>
<span class="term-fg32">+        with:</span>
<span class="term-fg32">+          folder: tmp&#47;pages</span>
<span class="term-fg32">+          clean: true</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-a87fa2aee8a9877168f796b3" role="button"
                       aria-expanded="false" aria-controls="id-a87fa2aee8a9877168f796b3">
                        <code>.github/workflows/stage.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/stage.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/.github/workflows/stage.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+2</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a87fa2aee8a9877168f796b3"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;stage.yml scroll-reth&#47;.github&#47;workflows&#47;stage.yml</span>
<span class="term-fg1">index 60ffa8f73d728311d53e26e0005d5a2723437cce..b3988a0a0ef35b1d219eb76e2bea0226957ba46c 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;stage.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;stage.yml</span>
<span class="term-fg36">@@ -6,7 +6,7 @@</span> on:
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [ main ]</span>
<span class="term-fg32">+    branches: [ main, scroll ]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -22,8 +22,7 @@</span>   stage:
     name: stage-run-test
     # Only run stage commands test in merge groups
     if: github.event_name == &#39;merge_group&#39;
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_LOG: info,sync=error
       RUST_BACKTRACE: 1</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-ee5b1425fec41ddff3fe1fa8" role="button"
                       aria-expanded="false" aria-controls="id-ee5b1425fec41ddff3fe1fa8">
                        <code>.github/workflows/stale.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/stale.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/.github/workflows/stale.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+0</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ee5b1425fec41ddff3fe1fa8"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;stale.yml scroll-reth&#47;.github&#47;workflows&#47;stale.yml</span>
<span class="term-fg1">index 38cca2fb1a9b895f2c548d9db60678c3d6bea241..0d51a0e4eae60c0a8e5a7383eb134b85966b638a 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;stale.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;stale.yml</span>
<span class="term-fg36">@@ -4,8 +4,6 @@</span> name: stale issues
&nbsp;
 on:
   workflow_dispatch: {}
<span class="term-fg31">-  schedule:</span>
<span class="term-fg31">-    - cron: &quot;30 1 * * *&quot;</span>
&nbsp;
 jobs:
   close-issues:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-73b0e25f9697046136c30cf2" role="button"
                       aria-expanded="false" aria-controls="id-73b0e25f9697046136c30cf2">
                        <code>.github/workflows/sync.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/sync.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/.github/workflows/sync.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+9</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-73b0e25f9697046136c30cf2"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;sync.yml scroll-reth&#47;.github&#47;workflows&#47;sync.yml</span>
<span class="term-fg1">index 531d04b2e48918fc3b39e39b94402efc1c052346..897ce04b8a6dc5bfb8080598f1f04e6b245ab4df 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;sync.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;sync.yml</span>
<span class="term-fg36">@@ -4,6 +4,8 @@</span> name: sync test
&nbsp;
 on:
   merge_group:
<span class="term-fg32">+  push:</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -15,8 +17,7 @@</span>
 jobs:
   sync:
     name: sync (${{ matrix.chain.bin }})
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_LOG: info,sync=error
       RUST_BACKTRACE: 1
<span class="term-fg36">@@ -36,6 +37,12 @@</span>             chain: base
             tip: &quot;0xbb9b85352c7ebca6ba8efc63bd66cecd038c92ec8ebd02e153a3e0b197e672b7&quot;
             block: 10000
             unwind-target: &quot;0x118a6e922a8c6cab221fc5adfe5056d2b72d58c6580e9c5629de55299e2cf8de&quot;
<span class="term-fg32">+          - build: install-scroll</span>
<span class="term-fg32">+            bin: scroll-reth</span>
<span class="term-fg32">+            chain: scroll-mainnet</span>
<span class="term-fg32">+            tip: &quot;0x1f398ce1e03b9d7d7fcba8512dc43c9f84ecaffb15954ab178fab48151e84484&quot;</span>
<span class="term-fg32">+            block: 50000</span>
<span class="term-fg32">+            unwind-target: &quot;0xc434910471ff41b3f097360b8c5d20459018023833081192dbe490a12ae2937f&quot;</span>
     steps:
       - uses: actions&#47;checkout@v4
       - uses: dtolnay&#47;rust-toolchain@stable</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-516fe57cf282a48457de818e" role="button"
                       aria-expanded="false" aria-controls="id-516fe57cf282a48457de818e">
                        <code>.github/workflows/unit.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15/.github/workflows/unit.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/.github/workflows/unit.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+20</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-15</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-516fe57cf282a48457de818e"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;unit.yml scroll-reth&#47;.github&#47;workflows&#47;unit.yml</span>
<span class="term-fg1">index 4c927df8be004f5f5f673a083a36f3733194b093..539396277c2a6125b5fa9998f9cd6bb3d5b80cd4 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;unit.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;unit.yml</span>
<span class="term-fg36">@@ -6,7 +6,7 @@</span> on:
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -19,35 +19,40 @@</span>
 jobs:
   test:
     name: test &#47; ${{ matrix.type }} (${{ matrix.partition }}&#47;${{ matrix.total_partitions }})
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_BACKTRACE: 1
     strategy:
       matrix:
         include:
           - type: ethereum
<span class="term-fg31">-            args: --features &quot;asm-keccak ethereum&quot; --locked</span>
<span class="term-fg32">+            args: --features &quot;asm-keccak ethereum&quot; --locked --workspace --exclude ef-tests</span>
             partition: 1
             total_partitions: 2
           - type: ethereum
<span class="term-fg31">-            args: --features &quot;asm-keccak ethereum&quot; --locked</span>
<span class="term-fg32">+            args: --features &quot;asm-keccak ethereum&quot; --locked --workspace --exclude ef-tests</span>
             partition: 2
             total_partitions: 2
           - type: optimism
<span class="term-fg31">-            args: --features &quot;asm-keccak optimism&quot; --locked --exclude reth --exclude reth-bench --exclude &quot;example-*&quot; --exclude &quot;reth-ethereum-*&quot; --exclude &quot;*-ethereum&quot;</span>
<span class="term-fg32">+            args: --features &quot;asm-keccak optimism&quot; --locked --exclude reth --exclude reth-bench --exclude &quot;example-*&quot; --exclude &quot;reth-ethereum-*&quot; --exclude &quot;*-ethereum&quot; --workspace --exclude ef-tests</span>
             partition: 1
             total_partitions: 2
           - type: optimism
<span class="term-fg31">-            args: --features &quot;asm-keccak optimism&quot; --locked --exclude reth --exclude reth-bench --exclude &quot;example-*&quot; --exclude &quot;reth-ethereum-*&quot; --exclude &quot;*-ethereum&quot;</span>
<span class="term-fg32">+            args: --features &quot;asm-keccak optimism&quot; --locked --exclude reth --exclude reth-bench --exclude &quot;example-*&quot; --exclude &quot;reth-ethereum-*&quot; --exclude &quot;*-ethereum&quot; --workspace --exclude ef-tests</span>
             partition: 2
             total_partitions: 2
<span class="term-fg32">+          - type: scroll</span>
<span class="term-fg32">+            args: -p &quot;reth-scroll-*&quot; --locked --features &quot;scroll&quot;</span>
<span class="term-fg32">+            partition: 1</span>
<span class="term-fg32">+            total_partitions: 1</span>
           - type: book
<span class="term-fg31">-            args: --manifest-path book&#47;sources&#47;Cargo.toml</span>
<span class="term-fg32">+            args: --manifest-path book&#47;sources&#47;Cargo.toml --workspace --exclude ef-tests</span>
             partition: 1
             total_partitions: 1
     timeout-minutes: 30
     steps:
<span class="term-fg32">+      - name: Free up disk space</span>
<span class="term-fg32">+        run: rm -rf &#47;opt&#47;hostedtoolcache</span>
       - uses: actions&#47;checkout@v4
       - uses: dtolnay&#47;rust-toolchain@stable
       - uses: Swatinem&#47;rust-cache@v2
<span class="term-fg36">@@ -61,20 +66,21 @@</span>           repo-token: ${{ secrets.GITHUB_TOKEN }}
       - name: Run tests
         run: |
           cargo nextest run \
<span class="term-fg31">-            ${{ matrix.args }} --workspace \</span>
<span class="term-fg31">-            --exclude ef-tests --no-tests=warn \</span>
<span class="term-fg31">-            --partition hash:${{ matrix.partition }}&#47;2 \</span>
<span class="term-fg32">+            ${{ matrix.args }} \</span>
<span class="term-fg32">+            --no-tests=warn \</span>
<span class="term-fg32">+            --partition hash:${{ matrix.partition }}&#47;${{ matrix.total_partitions }} \</span>
             -E &quot;!kind(test)&quot;
&nbsp;
   state:
     name: Ethereum state tests
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_LOG: info,sync=error
       RUST_BACKTRACE: 1
     timeout-minutes: 30
     steps:
<span class="term-fg32">+      - name: Free up disk space</span>
<span class="term-fg32">+        run: rm -rf &#47;opt&#47;hostedtoolcache</span>
       - uses: actions&#47;checkout@v4
       - name: Checkout ethereum&#47;tests
         uses: actions&#47;checkout@v4
<span class="term-fg36">@@ -93,8 +99,7 @@</span>       - run: cargo nextest run --release -p ef-tests --features &quot;asm-keccak ef-tests&quot;
&nbsp;
   doc:
     name: doc tests (${{ matrix.network }})
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_BACKTRACE: 1
     timeout-minutes: 30</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-458e4349b7db62b823678b1f" role="button"
                       aria-expanded="false" aria-controls="id-458e4349b7db62b823678b1f">
                        <code>fork.yaml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/bb82d3b10960f953c363c2946b5876340a7b0ad9/fork.yaml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+42</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-458e4349b7db62b823678b1f"><span class="term-fg1">diff --git reth&#47;fork.yaml scroll-reth&#47;fork.yaml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..a63fb177f7a026d5d10e192f7fc229695206e6f8</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;fork.yaml</span>
<span class="term-fg36">@@ -0,0 +1,42 @@</span>
<span class="term-fg32">+title: &quot;scroll-reth - reth fork diff overview&quot;</span>
<span class="term-fg32">+footer: |</span>
<span class="term-fg32">+  Fork-diff overview of [`scroll-reth`](https:&#47;&#47;github.com&#47;scroll-tech&#47;reth), a fork of [`reth`](https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth).</span>
<span class="term-fg32">+base:</span>
<span class="term-fg32">+  name: reth</span>
<span class="term-fg32">+  url: https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth</span>
<span class="term-fg32">+  hash: 3f9816e1c4d5302bd5a3f743f4f10ab079c2fd15</span>
<span class="term-fg32">+fork:</span>
<span class="term-fg32">+  name: scroll-reth</span>
<span class="term-fg32">+  url: https:&#47;&#47;github.com&#47;scroll-tech&#47;reth</span>
<span class="term-fg32">+  ref: refs&#47;heads&#47;scroll</span>
<span class="term-fg32">+def:</span>
<span class="term-fg32">+  title: &quot;scroll-reth&quot;</span>
<span class="term-fg32">+  description: |</span>
<span class="term-fg32">+    This is an overview of the changes in [`scroll-reth`](https:&#47;&#47;github.com&#47;scroll-tech&#47;reth),</span>
<span class="term-fg32">+    a fork of [`reth`](https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth).</span>
<span class="term-fg32">+  sub:</span>
<span class="term-fg32">+    - title: &quot;crates&#47;scroll&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;scroll&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;ethereum&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;ethereum&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;optimism&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;optimism&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;primitives&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;primitives*&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;stages&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;stages&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;storage&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;storage&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;trie&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;trie&#47;**&#47;*&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+ignore:</span>
<span class="term-fg32">+  - &quot;fork.yaml&quot;</span>
<span class="term-fg32">+  - &quot;.github&#47;**&quot;</span></div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

                
            </div>
        </main>
    </div>

    <footer class="col-xl-10 col-xxl-8 mx-auto px-3 pt-5 my-5 text-muted border-top">
        <p>Fork-diff overview of <a href="https://github.com/scroll-tech/reth"><code>scroll-reth</code></a>, a fork of <a href="https://github.com/paradigmxyz/reth"><code>reth</code></a>.</p>

    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD" crossorigin="anonymous"></script>
    <script type="text/javascript">
        const storedTheme = localStorage.getItem('theme')

        // Get the preferred theme from the user's OS
        const getPreferredTheme = () => {
            if (storedTheme) {
                return storedTheme
            }

            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
        }

        // Set the bootstrap theme
        const setTheme = function (theme) {
            document.documentElement.setAttribute('data-bs-theme', theme)
            if (theme === 'dark') {
                document.getElementById('dark-mode-toggle').setAttribute('checked', true)
                document.getElementById('dark-mode-icon').classList.replace('bi-brightness-high-fill', 'bi-brightness-low')
            } else {
                document.getElementById('dark-mode-toggle').setAttribute('checked', false)
                document.getElementById('dark-mode-icon').classList.replace('bi-brightness-low', 'bi-brightness-high-fill')
            }
        }

        // Returns true if the current theme is dark
        const isDark = () => {
            return document.documentElement.getAttribute('data-bs-theme') === 'dark'
        }

        // Toggles dark mode
        const toggleDarkMode = () => {
            const newTheme = isDark() ? 'light' : 'dark'
            setTheme(newTheme)
            localStorage.setItem('theme', newTheme)
        }

        // Set the preferred theme on page load
        window.onload = () => {
            // Set preferred theme
            setTheme(getPreferredTheme());
            // Initialize tooltips
            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
            const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
        }

        // Toggle dark mode when the toggle button is clicked
        addEventListener("click", (event) => {
            if (event.target.id === 'dark-mode-toggle') {
                toggleDarkMode();
                // De-focus the toggle
                document.activeElement.blur()
            }
        });
    </script>
</body>
</html>
